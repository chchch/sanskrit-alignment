import{showSaveFilePicker as jt}from"https://cdn.jsdelivr.net/npm/native-file-system-adapter/mod.js";(function(){const w=document.createElement("link").relList;if(w&&w.supports&&w.supports("modulepreload"))return;for(const C of document.querySelectorAll('link[rel="modulepreload"]'))F(C);new MutationObserver(C=>{for(const k of C)if(k.type==="childList")for(const p of k.addedNodes)p.tagName==="LINK"&&p.rel==="modulepreload"&&F(p)}).observe(document,{childList:!0,subtree:!0});function N(C){const k={};return C.integrity&&(k.integrity=C.integrity),C.referrerPolicy&&(k.referrerPolicy=C.referrerPolicy),C.crossOrigin==="use-credentials"?k.credentials="include":C.crossOrigin==="anonymous"?k.credentials="omit":k.credentials="same-origin",k}function F(C){if(C.ep)return;C.ep=!0;const k=N(C);fetch(C.href,k)}})();var bn={};(function(h){h.__type__="csv";var w=typeof jQuery<"u"&&jQuery.Deferred||typeof _<"u"&&_.Deferred||function(){var a,o,g=new Promise(function(v,R){a=v,o=R});return{resolve:a,reject:o,promise:function(){return g}}};h.fetch=function(a){var o=new w;if(a.file){var g=new FileReader,v=a.encoding||"UTF-8";g.onload=function(I){var T=h.extractFields(h.parse(I.target.result,a),a);T.useMemoryStore=!0,T.metadata={filename:a.file.name},o.resolve(T)},g.onerror=function(I){o.reject({error:{message:"Failed to load file. Code: "+I.target.error.code}})},g.readAsText(a.file,v)}else if(a.data){var R=h.extractFields(h.parse(a.data,a),a);R.useMemoryStore=!0,o.resolve(R)}else if(a.url){var O=window.fetch||function(I){var T=jQuery.get(I),M={then:function(G){return T.done(G),M},catch:function(G){return T.fail(G),M}};return M};O(a.url).then(function(I){return I.text?I.text():I}).then(function(I){var T=h.extractFields(h.parse(I,a),a);T.useMemoryStore=!0,o.resolve(T)}).catch(function(I,T){o.reject({error:{message:"Failed to load file. "+I.statusText+". Code: "+I.status,request:I}})})}return o.promise()},h.extractFields=function(a,o){return o.noHeaderRow!==!0&&a.length>0?{fields:a[0],records:a.slice(1)}:{records:a}},h.normalizeDialectOptions=function(a){var o={delimiter:",",doublequote:!0,lineterminator:`
`,quotechar:'"',skipinitialspace:!0,skipinitialrows:0};for(var g in a)g==="trim"?o.skipinitialspace=a.trim:o[g.toLowerCase()]=a[g];return o},h.parse=function(a,o){(!o||o&&!o.lineterminator)&&(a=h.normalizeLineTerminator(a,o));var g=h.normalizeDialectOptions(o);a=p(a,g.lineterminator);var v="",R=!1,O=!1,I="",T=[],M=[],G,W;for(W=function(U){return O!==!0&&(U===""?U=null:g.skipinitialspace===!0&&(U=k(U)),N.test(U)?U=parseInt(U,10):F.test(U)&&(U=parseFloat(U,10))),U},G=0;G<a.length;G+=1)v=a.charAt(G),R===!1&&(v===g.delimiter||v===g.lineterminator)?(I=W(I),T.push(I),v===g.lineterminator&&(M.push(T),T=[]),I="",O=!1):v!==g.quotechar?I+=v:R?a.charAt(G+1)===g.quotechar?(I+=g.quotechar,G+=1):R=!1:(R=!0,O=!0);return I=W(I),T.push(I),M.push(T),g.skipinitialrows&&(M=M.slice(g.skipinitialrows)),M},h.normalizeLineTerminator=function(a,o){return o=o||{},o.lineterminator?a:a.replace(/(\r\n|\n|\r)/gm,`
`)},h.objectToArray=function(a){for(var o=[],g=[],v=[],R=0;R<a.fields.length;R++){var O=a.fields[R].id;v.push(O);var I=a.fields[R].label?a.fields[R].label:O;g.push(I)}o.push(g);for(var R=0;R<a.records.length;R++){for(var T=[],M=a.records[R],G=0;G<v.length;G++)T.push(M[v[G]]);o.push(T)}return o},h.serialize=function(a,o){var g=null;a instanceof Array?g=a:g=h.objectToArray(a);var v=h.normalizeDialectOptions(o),R="",O="",I="",T="",M,G,W;for(W=function(U){return U===null?U="":typeof U=="string"&&C.test(U)?(v.doublequote&&(U=U.replace(/"/g,'""')),U=v.quotechar+U+v.quotechar):typeof U=="number"&&(U=U.toString(10)),U},M=0;M<g.length;M+=1)for(R=g[M],G=0;G<R.length;G+=1)O=W(R[G]),G===R.length-1?(I+=O,T+=I+v.lineterminator,I=""):I+=O+v.delimiter,O="";return T};var N=/^\d+$/,F=/^\d*\.\d+$|^\d+\.\d*$/,C=/^\s|\s$|,|"|\n/,k=function(){return String.prototype.trim?function(a){return a.trim()}:function(a){return a.replace(/^\s*/,"").replace(/\s*$/,"")}}();function p(a,o){return a.charAt(a.length-o.length)!==o?a:a.substring(0,a.length-o.length)}})(bn);function wn(h){return h&&h.__esModule&&Object.prototype.hasOwnProperty.call(h,"default")?h.default:h}var Cn={exports:{}};(function(h,w){(function(N,F){h.exports=F()})(window,function(){return function(N){var F={};function C(k){if(F[k])return F[k].exports;var p=F[k]={i:k,l:!1,exports:{}};return N[k].call(p.exports,p,p.exports,C),p.l=!0,p.exports}return C.m=N,C.c=F,C.d=function(k,p,a){C.o(k,p)||Object.defineProperty(k,p,{enumerable:!0,get:a})},C.r=function(k){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(k,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(k,"__esModule",{value:!0})},C.t=function(k,p){if(1&p&&(k=C(k)),8&p||4&p&&typeof k=="object"&&k&&k.__esModule)return k;var a=Object.create(null);if(C.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:k}),2&p&&typeof k!="string")for(var o in k)C.d(a,o,(function(g){return k[g]}).bind(null,o));return a},C.n=function(k){var p=k&&k.__esModule?function(){return k.default}:function(){return k};return C.d(p,"a",p),p},C.o=function(k,p){return Object.prototype.hasOwnProperty.call(k,p)},C.p="",C(C.s=1)}([function(N,F,C){var k,p;k=[C(2)],(p=(function(a){function o(e){if(o.is(e,"function"))return g?e():a.on("raphael.DOMload",e);if(o.is(e,c))return o._engine.create[U](o,e.splice(0,3+o.is(e[0],ve))).add(e);var r=Array.prototype.slice.call(arguments,0);if(o.is(r[r.length-1],"function")){var i=r.pop();return g?i.call(o._engine.create[U](o,r)):a.on("raphael.DOMload",function(){i.call(o._engine.create[U](o,r))})}return o._engine.create[U](o,arguments)}o.version="2.3.0",o.eve=a;var g,v,R=/[, ]+/,O={circle:1,rect:1,path:1,ellipse:1,text:1,image:1},I=/\{(\d+)\}/g,T="hasOwnProperty",M={doc:document,win:window},G={was:Object.prototype[T].call(M.win,"Raphael"),is:M.win.Raphael},W=function(){this.ca=this.customAttributes={}},U="apply",V="concat",ae="ontouchstart"in window||window.TouchEvent||window.DocumentTouch&&document instanceof DocumentTouch,de="",be=" ",z=String,K="split",j="click dblclick mousedown mousemove mouseout mouseover mouseup touchstart touchmove touchend touchcancel"[K](be),D={mousedown:"touchstart",mousemove:"touchmove",mouseup:"touchend"},ce=z.prototype.toLowerCase,ne=Math,xe=ne.max,me=ne.min,Y=ne.abs,he=ne.pow,fe=ne.PI,ve="number",c="array",d=Object.prototype.toString,t=(o._ISURL=/^url\(['"]?(.+?)['"]?\)$/i,/^\s*((#[a-f\d]{6})|(#[a-f\d]{3})|rgba?\(\s*([\d\.]+%?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+%?(?:\s*,\s*[\d\.]+%?)?)\s*\)|hsba?\(\s*([\d\.]+(?:deg|\xb0|%)?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+(?:%?\s*,\s*[\d\.]+)?)%?\s*\)|hsla?\(\s*([\d\.]+(?:deg|\xb0|%)?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+(?:%?\s*,\s*[\d\.]+)?)%?\s*\))\s*$/i),n={NaN:1,Infinity:1,"-Infinity":1},s=/^(?:cubic-)?bezier\(([^,]+),([^,]+),([^,]+),([^\)]+)\)/,u=ne.round,f=parseFloat,x=parseInt,b=z.prototype.toUpperCase,B=o._availableAttrs={"arrow-end":"none","arrow-start":"none",blur:0,"clip-rect":"0 0 1e9 1e9",cursor:"default",cx:0,cy:0,fill:"#fff","fill-opacity":1,font:'10px "Arial"',"font-family":'"Arial"',"font-size":"10","font-style":"normal","font-weight":400,gradient:0,height:0,href:"http://raphaeljs.com/","letter-spacing":0,opacity:1,path:"M0,0",r:0,rx:0,ry:0,src:"",stroke:"#000","stroke-dasharray":"","stroke-linecap":"butt","stroke-linejoin":"butt","stroke-miterlimit":0,"stroke-opacity":1,"stroke-width":1,target:"_blank","text-anchor":"middle",title:"Raphael",transform:"",width:0,x:0,y:0,class:""},P=o._availableAnimAttrs={blur:ve,"clip-rect":"csv",cx:ve,cy:ve,fill:"colour","fill-opacity":ve,"font-size":ve,height:ve,opacity:ve,path:"path",r:ve,rx:ve,ry:ve,stroke:"colour","stroke-opacity":ve,"stroke-width":ve,transform:"transform",width:ve,x:ve,y:ve},$=/[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*/,X={hs:1,rg:1},te=/,?([achlmqrstvxz]),?/gi,ge=/([achlmrqstvz])[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029,]*((-?\d*\.?\d*(?:e[\-+]?\d+)?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*)+)/gi,_e=/([rstm])[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029,]*((-?\d*\.?\d*(?:e[\-+]?\d+)?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*)+)/gi,Ce=/(-?\d*\.?\d*(?:e[\-+]?\d+)?)[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*/gi,we=(o._radial_gradient=/^r(?:\(([^,]+?)[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*([^\)]+?)\))?/,{}),Se=function(e,r){return f(e)-f(r)},Le=function(e){return e},ye=o._rectPath=function(e,r,i,l,m){return m?[["M",e+m,r],["l",i-2*m,0],["a",m,m,0,0,1,m,m],["l",0,l-2*m],["a",m,m,0,0,1,-m,m],["l",2*m-i,0],["a",m,m,0,0,1,-m,-m],["l",0,2*m-l],["a",m,m,0,0,1,m,-m],["z"]]:[["M",e,r],["l",i,0],["l",0,l],["l",-i,0],["z"]]},Re=function(e,r,i,l){return l==null&&(l=i),[["M",e,r],["m",0,-l],["a",i,l,0,1,1,0,2*l],["a",i,l,0,1,1,0,-2*l],["z"]]},Be=o._getPath={path:function(e){return e.attr("path")},circle:function(e){var r=e.attrs;return Re(r.cx,r.cy,r.r)},ellipse:function(e){var r=e.attrs;return Re(r.cx,r.cy,r.rx,r.ry)},rect:function(e){var r=e.attrs;return ye(r.x,r.y,r.width,r.height,r.r)},image:function(e){var r=e.attrs;return ye(r.x,r.y,r.width,r.height)},text:function(e){var r=e._getBBox();return ye(r.x,r.y,r.width,r.height)},set:function(e){var r=e._getBBox();return ye(r.x,r.y,r.width,r.height)}},qe=o.mapPath=function(e,r){if(!r)return e;var i,l,m,S,E,A,L;for(m=0,E=(e=At(e)).length;m<E;m++)for(S=1,A=(L=e[m]).length;S<A;S+=2)i=r.x(L[S],L[S+1]),l=r.y(L[S],L[S+1]),L[S]=i,L[S+1]=l;return e};if(o._g=M,o.type=M.win.SVGAngle||M.doc.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1")?"SVG":"VML",o.type=="VML"){var Te,Me=M.doc.createElement("div");if(Me.innerHTML='<v:shape adj="1"/>',(Te=Me.firstChild).style.behavior="url(#default#VML)",!Te||typeof Te.adj!="object")return o.type=de;Me=null}function De(e){if(typeof e=="function"||Object(e)!==e)return e;var r=new e.constructor;for(var i in e)e[T](i)&&(r[i]=De(e[i]));return r}o.svg=!(o.vml=o.type=="VML"),o._Paper=W,o.fn=v=W.prototype=o.prototype,o._id=0,o.is=function(e,r){return(r=ce.call(r))=="finite"?!n[T](+e):r=="array"?e instanceof Array:r=="null"&&e===null||r==typeof e&&e!==null||r=="object"&&e===Object(e)||r=="array"&&Array.isArray&&Array.isArray(e)||d.call(e).slice(8,-1).toLowerCase()==r},o.angle=function(e,r,i,l,m,S){if(m==null){var E=e-i,A=r-l;return E||A?(180+180*ne.atan2(-A,-E)/fe+360)%360:0}return o.angle(e,r,m,S)-o.angle(i,l,m,S)},o.rad=function(e){return e%360*fe/180},o.deg=function(e){return Math.round(180*e/fe%360*1e3)/1e3},o.snapTo=function(e,r,i){if(i=o.is(i,"finite")?i:10,o.is(e,c)){for(var l=e.length;l--;)if(Y(e[l]-r)<=i)return e[l]}else{var m=r%(e=+e);if(m<i)return r-m;if(m>e-i)return r-m+e}return r};var ze,rt;o.createUUID=(ze=/[xy]/g,rt=function(e){var r=16*ne.random()|0;return(e=="x"?r:3&r|8).toString(16)},function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(ze,rt).toUpperCase()}),o.setWindow=function(e){a("raphael.setWindow",o,M.win,e),M.win=e,M.doc=M.win.document,o._engine.initWin&&o._engine.initWin(M.win)};var He=function(e){if(o.vml){var r,i=/^\s+|\s+$/g;try{var l=new ActiveXObject("htmlfile");l.write("<body>"),l.close(),r=l.body}catch{r=createPopup().document.body}var m=r.createTextRange();He=Oe(function(E){try{r.style.color=z(E).replace(i,de);var A=m.queryCommandValue("ForeColor");return"#"+("000000"+(A=(255&A)<<16|65280&A|(16711680&A)>>>16).toString(16)).slice(-6)}catch{return"none"}})}else{var S=M.doc.createElement("i");S.title="Raphaël Colour Picker",S.style.display="none",M.doc.body.appendChild(S),He=Oe(function(E){return S.style.color=E,M.doc.defaultView.getComputedStyle(S,de).getPropertyValue("color")})}return He(e)},je=function(){return"hsb("+[this.h,this.s,this.b]+")"},ct=function(){return"hsl("+[this.h,this.s,this.l]+")"},kt=function(){return this.hex},ut=function(e,r,i){if(r==null&&o.is(e,"object")&&"r"in e&&"g"in e&&"b"in e&&(i=e.b,r=e.g,e=e.r),r==null&&o.is(e,"string")){var l=o.getRGB(e);e=l.r,r=l.g,i=l.b}return(e>1||r>1||i>1)&&(e/=255,r/=255,i/=255),[e,r,i]},Tt=function(e,r,i,l){var m={r:e*=255,g:r*=255,b:i*=255,hex:o.rgb(e,r,i),toString:kt};return o.is(l,"finite")&&(m.opacity=l),m};function Oe(e,r,i){return function l(){var m=Array.prototype.slice.call(arguments,0),S=m.join("␀"),E=l.cache=l.cache||{},A=l.count=l.count||[];return E[T](S)?(function(L,H){for(var Q=0,ie=L.length;Q<ie;Q++)if(L[Q]===H)return L.push(L.splice(Q,1)[0])}(A,S),i?i(E[S]):E[S]):(A.length>=1e3&&delete E[A.shift()],A.push(S),E[S]=e[U](r,m),i?i(E[S]):E[S])}}o.color=function(e){var r;return o.is(e,"object")&&"h"in e&&"s"in e&&"b"in e?(r=o.hsb2rgb(e),e.r=r.r,e.g=r.g,e.b=r.b,e.hex=r.hex):o.is(e,"object")&&"h"in e&&"s"in e&&"l"in e?(r=o.hsl2rgb(e),e.r=r.r,e.g=r.g,e.b=r.b,e.hex=r.hex):(o.is(e,"string")&&(e=o.getRGB(e)),o.is(e,"object")&&"r"in e&&"g"in e&&"b"in e?(r=o.rgb2hsl(e),e.h=r.h,e.s=r.s,e.l=r.l,r=o.rgb2hsb(e),e.v=r.b):(e={hex:"none"}).r=e.g=e.b=e.h=e.s=e.v=e.l=-1),e.toString=kt,e},o.hsb2rgb=function(e,r,i,l){var m,S,E,A,L;return this.is(e,"object")&&"h"in e&&"s"in e&&"b"in e&&(i=e.b,r=e.s,l=e.o,e=e.h),A=(L=i*r)*(1-Y((e=(e*=360)%360/60)%2-1)),m=S=E=i-L,Tt(m+=[L,A,0,0,A,L][e=~~e],S+=[A,L,L,A,0,0][e],E+=[0,0,A,L,L,A][e],l)},o.hsl2rgb=function(e,r,i,l){var m,S,E,A,L;return this.is(e,"object")&&"h"in e&&"s"in e&&"l"in e&&(i=e.l,r=e.s,e=e.h),(e>1||r>1||i>1)&&(e/=360,r/=100,i/=100),A=(L=2*r*(i<.5?i:1-i))*(1-Y((e=(e*=360)%360/60)%2-1)),m=S=E=i-L/2,Tt(m+=[L,A,0,0,A,L][e=~~e],S+=[A,L,L,A,0,0][e],E+=[0,0,A,L,L,A][e],l)},o.rgb2hsb=function(e,r,i){var l,m;return e=(i=ut(e,r,i))[0],r=i[1],i=i[2],{h:(((m=(l=xe(e,r,i))-me(e,r,i))==0?null:l==e?(r-i)/m:l==r?(i-e)/m+2:(e-r)/m+4)+360)%6*60/360,s:m==0?0:m/l,b:l,toString:je}},o.rgb2hsl=function(e,r,i){var l,m,S,E;return e=(i=ut(e,r,i))[0],r=i[1],i=i[2],l=((m=xe(e,r,i))+(S=me(e,r,i)))/2,{h:(((E=m-S)==0?null:m==e?(r-i)/E:m==r?(i-e)/E+2:(e-r)/E+4)+360)%6*60/360,s:E==0?0:l<.5?E/(2*l):E/(2-2*l),l,toString:ct}},o._path2string=function(){return this.join(",").replace(te,"$1")},o._preload=function(e,r){var i=M.doc.createElement("img");i.style.cssText="position:absolute;left:-9999em;top:-9999em",i.onload=function(){r.call(this),this.onload=null,M.doc.body.removeChild(this)},i.onerror=function(){M.doc.body.removeChild(this)},M.doc.body.appendChild(i),i.src=e};function Qe(){return this.hex}function ht(e,r){for(var i=[],l=0,m=e.length;m-2*!r>l;l+=2){var S=[{x:+e[l-2],y:+e[l-1]},{x:+e[l],y:+e[l+1]},{x:+e[l+2],y:+e[l+3]},{x:+e[l+4],y:+e[l+5]}];r?l?m-4==l?S[3]={x:+e[0],y:+e[1]}:m-2==l&&(S[2]={x:+e[0],y:+e[1]},S[3]={x:+e[2],y:+e[3]}):S[0]={x:+e[m-2],y:+e[m-1]}:m-4==l?S[3]=S[2]:l||(S[0]={x:+e[l],y:+e[l+1]}),i.push(["C",(-S[0].x+6*S[1].x+S[2].x)/6,(-S[0].y+6*S[1].y+S[2].y)/6,(S[1].x+6*S[2].x-S[3].x)/6,(S[1].y+6*S[2].y-S[3].y)/6,S[2].x,S[2].y])}return i}o.getRGB=Oe(function(e){if(!e||(e=z(e)).indexOf("-")+1)return{r:-1,g:-1,b:-1,hex:"none",error:1,toString:Qe};if(e=="none")return{r:-1,g:-1,b:-1,hex:"none",toString:Qe};!X[T](e.toLowerCase().substring(0,2))&&e.charAt()!="#"&&(e=He(e));var r,i,l,m,S,E,A=e.match(t);return A?(A[2]&&(l=x(A[2].substring(5),16),i=x(A[2].substring(3,5),16),r=x(A[2].substring(1,3),16)),A[3]&&(l=x((S=A[3].charAt(3))+S,16),i=x((S=A[3].charAt(2))+S,16),r=x((S=A[3].charAt(1))+S,16)),A[4]&&(E=A[4][K]($),r=f(E[0]),E[0].slice(-1)=="%"&&(r*=2.55),i=f(E[1]),E[1].slice(-1)=="%"&&(i*=2.55),l=f(E[2]),E[2].slice(-1)=="%"&&(l*=2.55),A[1].toLowerCase().slice(0,4)=="rgba"&&(m=f(E[3])),E[3]&&E[3].slice(-1)=="%"&&(m/=100)),A[5]?(E=A[5][K]($),r=f(E[0]),E[0].slice(-1)=="%"&&(r*=2.55),i=f(E[1]),E[1].slice(-1)=="%"&&(i*=2.55),l=f(E[2]),E[2].slice(-1)=="%"&&(l*=2.55),(E[0].slice(-3)=="deg"||E[0].slice(-1)=="°")&&(r/=360),A[1].toLowerCase().slice(0,4)=="hsba"&&(m=f(E[3])),E[3]&&E[3].slice(-1)=="%"&&(m/=100),o.hsb2rgb(r,i,l,m)):A[6]?(E=A[6][K]($),r=f(E[0]),E[0].slice(-1)=="%"&&(r*=2.55),i=f(E[1]),E[1].slice(-1)=="%"&&(i*=2.55),l=f(E[2]),E[2].slice(-1)=="%"&&(l*=2.55),(E[0].slice(-3)=="deg"||E[0].slice(-1)=="°")&&(r/=360),A[1].toLowerCase().slice(0,4)=="hsla"&&(m=f(E[3])),E[3]&&E[3].slice(-1)=="%"&&(m/=100),o.hsl2rgb(r,i,l,m)):((A={r,g:i,b:l,toString:Qe}).hex="#"+(16777216|l|i<<8|r<<16).toString(16).slice(1),o.is(m,"finite")&&(A.opacity=m),A)):{r:-1,g:-1,b:-1,hex:"none",error:1,toString:Qe}},o),o.hsb=Oe(function(e,r,i){return o.hsb2rgb(e,r,i).hex}),o.hsl=Oe(function(e,r,i){return o.hsl2rgb(e,r,i).hex}),o.rgb=Oe(function(e,r,i){function l(m){return m+.5|0}return"#"+(16777216|l(i)|l(r)<<8|l(e)<<16).toString(16).slice(1)}),o.getColor=function(e){var r=this.getColor.start=this.getColor.start||{h:0,s:1,b:e||.75},i=this.hsb2rgb(r.h,r.s,r.b);return r.h+=.075,r.h>1&&(r.h=0,r.s-=.2,r.s<=0&&(this.getColor.start={h:0,s:1,b:r.b})),i.hex},o.getColor.reset=function(){delete this.start},o.parsePathString=function(e){if(!e)return null;var r=Xe(e);if(r.arr)return Ve(r.arr);var i={a:7,c:6,h:1,l:2,m:2,r:4,q:4,s:4,t:2,v:1,z:0},l=[];return o.is(e,c)&&o.is(e[0],c)&&(l=Ve(e)),l.length||z(e).replace(ge,function(m,S,E){var A=[],L=S.toLowerCase();if(E.replace(Ce,function(H,Q){Q&&A.push(+Q)}),L=="m"&&A.length>2&&(l.push([S][V](A.splice(0,2))),L="l",S=S=="m"?"l":"L"),L=="r")l.push([S][V](A));else for(;A.length>=i[L]&&(l.push([S][V](A.splice(0,i[L]))),i[L]););}),l.toString=o._path2string,r.arr=Ve(l),l},o.parseTransformString=Oe(function(e){if(!e)return null;var r=[];return o.is(e,c)&&o.is(e[0],c)&&(r=Ve(e)),r.length||z(e).replace(_e,function(i,l,m){var S=[];ce.call(l),m.replace(Ce,function(E,A){A&&S.push(+A)}),r.push([l][V](S))}),r.toString=o._path2string,r},this,function(e){if(!e)return e;for(var r=[],i=0;i<e.length;i++){for(var l=[],m=0;m<e[i].length;m++)l.push(e[i][m]);r.push(l)}return r});var Xe=function(e){var r=Xe.ps=Xe.ps||{};return r[e]?r[e].sleep=100:r[e]={sleep:100},setTimeout(function(){for(var i in r)r[T](i)&&i!=e&&(r[i].sleep--,!r[i].sleep&&delete r[i])}),r[e]};function dt(e,r,i,l,m){return e*(e*(-3*r+9*i-9*l+3*m)+6*r-12*i+6*l)-3*r+3*i}function We(e,r,i,l,m,S,E,A,L){L==null&&(L=1);for(var H=(L=L>1?1:L<0?0:L)/2,Q=[-.1252,.1252,-.3678,.3678,-.5873,.5873,-.7699,.7699,-.9041,.9041,-.9816,.9816],ie=[.2491,.2491,.2335,.2335,.2032,.2032,.1601,.1601,.1069,.1069,.0472,.0472],ee=0,J=0;J<12;J++){var re=H*Q[J]+H,oe=dt(re,e,i,m,E),se=dt(re,r,l,S,A),Z=oe*oe+se*se;ee+=ie[J]*ne.sqrt(Z)}return H*ee}function _t(e,r,i,l,m,S,E,A){if(!(xe(e,i)<me(m,E)||me(e,i)>xe(m,E)||xe(r,l)<me(S,A)||me(r,l)>xe(S,A))){var L=(e-i)*(S-A)-(r-l)*(m-E);if(L){var H=((e*l-r*i)*(m-E)-(e-i)*(m*A-S*E))/L,Q=((e*l-r*i)*(S-A)-(r-l)*(m*A-S*E))/L,ie=+H.toFixed(2),ee=+Q.toFixed(2);if(!(ie<+me(e,i).toFixed(2)||ie>+xe(e,i).toFixed(2)||ie<+me(m,E).toFixed(2)||ie>+xe(m,E).toFixed(2)||ee<+me(r,l).toFixed(2)||ee>+xe(r,l).toFixed(2)||ee<+me(S,A).toFixed(2)||ee>+xe(S,A).toFixed(2)))return{x:H,y:Q}}}}function ft(e,r,i){var l=o.bezierBBox(e),m=o.bezierBBox(r);if(!o.isBBoxIntersect(l,m))return i?0:[];for(var S=We.apply(0,e),E=We.apply(0,r),A=xe(~~(S/5),1),L=xe(~~(E/5),1),H=[],Q=[],ie={},ee=i?0:[],J=0;J<A+1;J++){var re=o.findDotsAtSegment.apply(o,e.concat(J/A));H.push({x:re.x,y:re.y,t:J/A})}for(J=0;J<L+1;J++)re=o.findDotsAtSegment.apply(o,r.concat(J/L)),Q.push({x:re.x,y:re.y,t:J/L});for(J=0;J<A;J++)for(var oe=0;oe<L;oe++){var se=H[J],Z=H[J+1],ke=Q[oe],le=Q[oe+1],pe=Y(Z.x-se.x)<.001?"y":"x",ue=Y(le.x-ke.x)<.001?"y":"x",Ee=_t(se.x,se.y,Z.x,Z.y,ke.x,ke.y,le.x,le.y);if(Ee){if(ie[Ee.x.toFixed(4)]==Ee.y.toFixed(4))continue;ie[Ee.x.toFixed(4)]=Ee.y.toFixed(4);var Ae=se.t+Y((Ee[pe]-se[pe])/(Z[pe]-se[pe]))*(Z.t-se.t),Pe=ke.t+Y((Ee[ue]-ke[ue])/(le[ue]-ke[ue]))*(le.t-ke.t);Ae>=0&&Ae<=1.001&&Pe>=0&&Pe<=1.001&&(i?ee++:ee.push({x:Ee.x,y:Ee.y,t1:me(Ae,1),t2:me(Pe,1)}))}}return ee}function St(e,r,i){e=o._path2curve(e),r=o._path2curve(r);for(var l,m,S,E,A,L,H,Q,ie,ee,J=i?0:[],re=0,oe=e.length;re<oe;re++){var se=e[re];if(se[0]=="M")l=A=se[1],m=L=se[2];else{se[0]=="C"?(ie=[l,m].concat(se.slice(1)),l=ie[6],m=ie[7]):(ie=[l,m,l,m,A,L,A,L],l=A,m=L);for(var Z=0,ke=r.length;Z<ke;Z++){var le=r[Z];if(le[0]=="M")S=H=le[1],E=Q=le[2];else{le[0]=="C"?(ee=[S,E].concat(le.slice(1)),S=ee[6],E=ee[7]):(ee=[S,E,S,E,H,Q,H,Q],S=H,E=Q);var pe=ft(ie,ee,i);if(i)J+=pe;else{for(var ue=0,Ee=pe.length;ue<Ee;ue++)pe[ue].segment1=re,pe[ue].segment2=Z,pe[ue].bez1=ie,pe[ue].bez2=ee;J=J.concat(pe)}}}}}return J}o.findDotsAtSegment=function(e,r,i,l,m,S,E,A,L){var H=1-L,Q=he(H,3),ie=he(H,2),ee=L*L,J=ee*L,re=Q*e+3*ie*L*i+3*H*L*L*m+J*E,oe=Q*r+3*ie*L*l+3*H*L*L*S+J*A,se=e+2*L*(i-e)+ee*(m-2*i+e),Z=r+2*L*(l-r)+ee*(S-2*l+r),ke=i+2*L*(m-i)+ee*(E-2*m+i),le=l+2*L*(S-l)+ee*(A-2*S+l),pe=H*e+L*i,ue=H*r+L*l,Ee=H*m+L*E,Ae=H*S+L*A,Pe=90-180*ne.atan2(se-ke,Z-le)/fe;return(se>ke||Z<le)&&(Pe+=180),{x:re,y:oe,m:{x:se,y:Z},n:{x:ke,y:le},start:{x:pe,y:ue},end:{x:Ee,y:Ae},alpha:Pe}},o.bezierBBox=function(e,r,i,l,m,S,E,A){o.is(e,"array")||(e=[e,r,i,l,m,S,E,A]);var L=Mt.apply(null,e);return{x:L.min.x,y:L.min.y,x2:L.max.x,y2:L.max.y,width:L.max.x-L.min.x,height:L.max.y-L.min.y}},o.isPointInsideBBox=function(e,r,i){return r>=e.x&&r<=e.x2&&i>=e.y&&i<=e.y2},o.isBBoxIntersect=function(e,r){var i=o.isPointInsideBBox;return i(r,e.x,e.y)||i(r,e.x2,e.y)||i(r,e.x,e.y2)||i(r,e.x2,e.y2)||i(e,r.x,r.y)||i(e,r.x2,r.y)||i(e,r.x,r.y2)||i(e,r.x2,r.y2)||(e.x<r.x2&&e.x>r.x||r.x<e.x2&&r.x>e.x)&&(e.y<r.y2&&e.y>r.y||r.y<e.y2&&r.y>e.y)},o.pathIntersection=function(e,r){return St(e,r)},o.pathIntersectionNumber=function(e,r){return St(e,r,1)},o.isPointInsidePath=function(e,r,i){var l=o.pathBBox(e);return o.isPointInsideBBox(l,r,i)&&St(e,[["M",r,i],["H",l.x2+10]],1)%2==1},o._removedFactory=function(e){return function(){a("raphael.log",null,"Raphaël: you are calling to method “"+e+"” of removed object",e)}};var Ze=o.pathBBox=function(e){var r=Xe(e);if(r.bbox)return De(r.bbox);if(!e)return{x:0,y:0,width:0,height:0,x2:0,y2:0};for(var i,l=0,m=0,S=[],E=[],A=0,L=(e=At(e)).length;A<L;A++)if((i=e[A])[0]=="M")l=i[1],m=i[2],S.push(l),E.push(m);else{var H=Mt(l,m,i[1],i[2],i[3],i[4],i[5],i[6]);S=S[V](H.min.x,H.max.x),E=E[V](H.min.y,H.max.y),l=i[5],m=i[6]}var Q=me[U](0,S),ie=me[U](0,E),ee=xe[U](0,S),J=xe[U](0,E),re=ee-Q,oe=J-ie,se={x:Q,y:ie,x2:ee,y2:J,width:re,height:oe,cx:Q+re/2,cy:ie+oe/2};return r.bbox=De(se),se},Ve=function(e){var r=De(e);return r.toString=o._path2string,r},Kt=o._pathToRelative=function(e){var r=Xe(e);if(r.rel)return Ve(r.rel);o.is(e,c)&&o.is(e&&e[0],c)||(e=o.parsePathString(e));var i=[],l=0,m=0,S=0,E=0,A=0;e[0][0]=="M"&&(S=l=e[0][1],E=m=e[0][2],A++,i.push(["M",l,m]));for(var L=A,H=e.length;L<H;L++){var Q=i[L]=[],ie=e[L];if(ie[0]!=ce.call(ie[0]))switch(Q[0]=ce.call(ie[0]),Q[0]){case"a":Q[1]=ie[1],Q[2]=ie[2],Q[3]=ie[3],Q[4]=ie[4],Q[5]=ie[5],Q[6]=+(ie[6]-l).toFixed(3),Q[7]=+(ie[7]-m).toFixed(3);break;case"v":Q[1]=+(ie[1]-m).toFixed(3);break;case"m":S=ie[1],E=ie[2];default:for(var ee=1,J=ie.length;ee<J;ee++)Q[ee]=+(ie[ee]-(ee%2?l:m)).toFixed(3)}else{Q=i[L]=[],ie[0]=="m"&&(S=ie[1]+l,E=ie[2]+m);for(var re=0,oe=ie.length;re<oe;re++)i[L][re]=ie[re]}var se=i[L].length;switch(i[L][0]){case"z":l=S,m=E;break;case"h":l+=+i[L][se-1];break;case"v":m+=+i[L][se-1];break;default:l+=+i[L][se-2],m+=+i[L][se-1]}}return i.toString=o._path2string,r.rel=Ve(i),i},pt=o._pathToAbsolute=function(e){var r=Xe(e);if(r.abs)return Ve(r.abs);if(o.is(e,c)&&o.is(e&&e[0],c)||(e=o.parsePathString(e)),!e||!e.length)return[["M",0,0]];var i=[],l=0,m=0,S=0,E=0,A=0;e[0][0]=="M"&&(S=l=+e[0][1],E=m=+e[0][2],A++,i[0]=["M",l,m]);for(var L,H,Q=e.length==3&&e[0][0]=="M"&&e[1][0].toUpperCase()=="R"&&e[2][0].toUpperCase()=="Z",ie=A,ee=e.length;ie<ee;ie++){if(i.push(L=[]),(H=e[ie])[0]!=b.call(H[0]))switch(L[0]=b.call(H[0]),L[0]){case"A":L[1]=H[1],L[2]=H[2],L[3]=H[3],L[4]=H[4],L[5]=H[5],L[6]=+(H[6]+l),L[7]=+(H[7]+m);break;case"V":L[1]=+H[1]+m;break;case"H":L[1]=+H[1]+l;break;case"R":for(var J=[l,m][V](H.slice(1)),re=2,oe=J.length;re<oe;re++)J[re]=+J[re]+l,J[++re]=+J[re]+m;i.pop(),i=i[V](ht(J,Q));break;case"M":S=+H[1]+l,E=+H[2]+m;default:for(re=1,oe=H.length;re<oe;re++)L[re]=+H[re]+(re%2?l:m)}else if(H[0]=="R")J=[l,m][V](H.slice(1)),i.pop(),i=i[V](ht(J,Q)),L=["R"][V](H.slice(-2));else for(var se=0,Z=H.length;se<Z;se++)L[se]=H[se];switch(L[0]){case"Z":l=S,m=E;break;case"H":l=L[1];break;case"V":m=L[1];break;case"M":S=L[L.length-2],E=L[L.length-1];default:l=L[L.length-2],m=L[L.length-1]}}return i.toString=o._path2string,r.abs=Ve(i),i},mt=function(e,r,i,l){return[e,r,i,l,i,l]},et=function(e,r,i,l,m,S){return[1/3*e+2/3*i,1/3*r+2/3*l,1/3*m+2/3*i,1/3*S+2/3*l,m,S]},Nt=function(e,r,i,l,m,S,E,A,L,H){var Q,ie=120*fe/180,ee=fe/180*(+m||0),J=[],re=Oe(function(mn,gn,Ft){return{x:mn*ne.cos(Ft)-gn*ne.sin(Ft),y:mn*ne.sin(Ft)+gn*ne.cos(Ft)}});if(H)Ae=H[0],Pe=H[1],ue=H[2],Ee=H[3];else{e=(Q=re(e,r,-ee)).x,r=Q.y,A=(Q=re(A,L,-ee)).x,L=Q.y;var oe=(e-A)/2,se=(r-L)/2,Z=oe*oe/(i*i)+se*se/(l*l);Z>1&&(i*=Z=ne.sqrt(Z),l*=Z);var ke=i*i,le=l*l,pe=(S==E?-1:1)*ne.sqrt(Y((ke*le-ke*se*se-le*oe*oe)/(ke*se*se+le*oe*oe))),ue=pe*i*se/l+(e+A)/2,Ee=pe*-l*oe/i+(r+L)/2,Ae=ne.asin(((r-Ee)/l).toFixed(9)),Pe=ne.asin(((L-Ee)/l).toFixed(9));(Ae=e<ue?fe-Ae:Ae)<0&&(Ae=2*fe+Ae),(Pe=A<ue?fe-Pe:Pe)<0&&(Pe=2*fe+Pe),E&&Ae>Pe&&(Ae-=2*fe),!E&&Pe>Ae&&(Pe-=2*fe)}var xt=Pe-Ae;if(Y(xt)>ie){var Lt=Pe,Ge=A,Ye=L;Pe=Ae+ie*(E&&Pe>Ae?1:-1),A=ue+i*ne.cos(Pe),L=Ee+l*ne.sin(Pe),J=Nt(A,L,i,l,m,0,E,Ge,Ye,[Pe,Lt,ue,Ee])}xt=Pe-Ae;var vt=ne.cos(Ae),yt=ne.sin(Ae),It=ne.cos(Pe),Je=ne.sin(Pe),ot=ne.tan(xt/4),qt=4/3*i*ot,un=4/3*l*ot,hn=[e,r],bt=[e+qt*yt,r-un*vt],dn=[A+qt*Je,L-un*It],fn=[A,L];if(bt[0]=2*hn[0]-bt[0],bt[1]=2*hn[1]-bt[1],H)return[bt,dn,fn][V](J);for(var pn=[],nt=0,Tn=(J=[bt,dn,fn][V](J).join()[K](",")).length;nt<Tn;nt++)pn[nt]=nt%2?re(J[nt-1],J[nt],ee).y:re(J[nt],J[nt+1],ee).x;return pn},st=function(e,r,i,l,m,S,E,A,L){var H=1-L;return{x:he(H,3)*e+3*he(H,2)*L*i+3*H*L*L*m+he(L,3)*E,y:he(H,3)*r+3*he(H,2)*L*l+3*H*L*L*S+he(L,3)*A}},Mt=Oe(function(e,r,i,l,m,S,E,A){var L,H=m-2*i+e-(E-2*m+i),Q=2*(i-e)-2*(m-i),ie=e-i,ee=(-Q+ne.sqrt(Q*Q-4*H*ie))/2/H,J=(-Q-ne.sqrt(Q*Q-4*H*ie))/2/H,re=[r,A],oe=[e,E];return Y(ee)>"1e12"&&(ee=.5),Y(J)>"1e12"&&(J=.5),ee>0&&ee<1&&(L=st(e,r,i,l,m,S,E,A,ee),oe.push(L.x),re.push(L.y)),J>0&&J<1&&(L=st(e,r,i,l,m,S,E,A,J),oe.push(L.x),re.push(L.y)),H=S-2*l+r-(A-2*S+l),ie=r-l,ee=(-(Q=2*(l-r)-2*(S-l))+ne.sqrt(Q*Q-4*H*ie))/2/H,J=(-Q-ne.sqrt(Q*Q-4*H*ie))/2/H,Y(ee)>"1e12"&&(ee=.5),Y(J)>"1e12"&&(J=.5),ee>0&&ee<1&&(L=st(e,r,i,l,m,S,E,A,ee),oe.push(L.x),re.push(L.y)),J>0&&J<1&&(L=st(e,r,i,l,m,S,E,A,J),oe.push(L.x),re.push(L.y)),{min:{x:me[U](0,oe),y:me[U](0,re)},max:{x:xe[U](0,oe),y:xe[U](0,re)}}}),At=o._path2curve=Oe(function(e,r){var i=!r&&Xe(e);if(!r&&i.curve)return Ve(i.curve);for(var l=pt(e),m=r&&pt(r),S={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},E={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},A=function(pe,ue,Ee){var Ae,Pe;if(!pe)return["C",ue.x,ue.y,ue.x,ue.y,ue.x,ue.y];switch(!(pe[0]in{T:1,Q:1})&&(ue.qx=ue.qy=null),pe[0]){case"M":ue.X=pe[1],ue.Y=pe[2];break;case"A":pe=["C"][V](Nt[U](0,[ue.x,ue.y][V](pe.slice(1))));break;case"S":Ee=="C"||Ee=="S"?(Ae=2*ue.x-ue.bx,Pe=2*ue.y-ue.by):(Ae=ue.x,Pe=ue.y),pe=["C",Ae,Pe][V](pe.slice(1));break;case"T":Ee=="Q"||Ee=="T"?(ue.qx=2*ue.x-ue.qx,ue.qy=2*ue.y-ue.qy):(ue.qx=ue.x,ue.qy=ue.y),pe=["C"][V](et(ue.x,ue.y,ue.qx,ue.qy,pe[1],pe[2]));break;case"Q":ue.qx=pe[1],ue.qy=pe[2],pe=["C"][V](et(ue.x,ue.y,pe[1],pe[2],pe[3],pe[4]));break;case"L":pe=["C"][V](mt(ue.x,ue.y,pe[1],pe[2]));break;case"H":pe=["C"][V](mt(ue.x,ue.y,pe[1],ue.y));break;case"V":pe=["C"][V](mt(ue.x,ue.y,ue.x,pe[1]));break;case"Z":pe=["C"][V](mt(ue.x,ue.y,ue.X,ue.Y))}return pe},L=function(pe,ue){if(pe[ue].length>7){pe[ue].shift();for(var Ee=pe[ue];Ee.length;)Q[ue]="A",m&&(ie[ue]="A"),pe.splice(ue++,0,["C"][V](Ee.splice(0,6)));pe.splice(ue,1),oe=xe(l.length,m&&m.length||0)}},H=function(pe,ue,Ee,Ae,Pe){pe&&ue&&pe[Pe][0]=="M"&&ue[Pe][0]!="M"&&(ue.splice(Pe,0,["M",Ae.x,Ae.y]),Ee.bx=0,Ee.by=0,Ee.x=pe[Pe][1],Ee.y=pe[Pe][2],oe=xe(l.length,m&&m.length||0))},Q=[],ie=[],ee="",J="",re=0,oe=xe(l.length,m&&m.length||0);re<oe;re++){l[re]&&(ee=l[re][0]),ee!="C"&&(Q[re]=ee,re&&(J=Q[re-1])),l[re]=A(l[re],S,J),Q[re]!="A"&&ee=="C"&&(Q[re]="C"),L(l,re),m&&(m[re]&&(ee=m[re][0]),ee!="C"&&(ie[re]=ee,re&&(J=ie[re-1])),m[re]=A(m[re],E,J),ie[re]!="A"&&ee=="C"&&(ie[re]="C"),L(m,re)),H(l,m,S,E,re),H(m,l,E,S,re);var se=l[re],Z=m&&m[re],ke=se.length,le=m&&Z.length;S.x=se[ke-2],S.y=se[ke-1],S.bx=f(se[ke-4])||S.x,S.by=f(se[ke-3])||S.y,E.bx=m&&(f(Z[le-4])||E.x),E.by=m&&(f(Z[le-3])||E.y),E.x=m&&Z[le-2],E.y=m&&Z[le-1]}return m||(i.curve=Ve(l)),m?[l,m]:l},null,Ve),Dt=(o._parseDots=Oe(function(e){for(var r=[],i=0,l=e.length;i<l;i++){var m={},S=e[i].match(/^([^:]*):?([\d\.]*)/);if(m.color=o.getRGB(S[1]),m.color.error)return null;m.opacity=m.color.opacity,m.color=m.color.hex,S[2]&&(m.offset=S[2]+"%"),r.push(m)}for(i=1,l=r.length-1;i<l;i++)if(!r[i].offset){for(var E=f(r[i-1].offset||0),A=0,L=i+1;L<l;L++)if(r[L].offset){A=r[L].offset;break}A||(A=100,L=l);for(var H=((A=f(A))-E)/(L-i+1);i<L;i++)E+=H,r[i].offset=E+"%"}return r}),o._tear=function(e,r){e==r.top&&(r.top=e.prev),e==r.bottom&&(r.bottom=e.next),e.next&&(e.next.prev=e.prev),e.prev&&(e.prev.next=e.next)}),_n=(o._tofront=function(e,r){r.top!==e&&(Dt(e,r),e.next=null,e.prev=r.top,r.top.next=e,r.top=e)},o._toback=function(e,r){r.bottom!==e&&(Dt(e,r),e.next=r.bottom,e.prev=null,r.bottom.prev=e,r.bottom=e)},o._insertafter=function(e,r,i){Dt(e,i),r==i.top&&(i.top=e),r.next&&(r.next.prev=e),e.next=r.next,e.prev=r,r.next=e},o._insertbefore=function(e,r,i){Dt(e,i),r==i.bottom&&(i.bottom=e),r.prev&&(r.prev.next=e),e.prev=r.prev,r.prev=e,e.next=r},o.toMatrix=function(e,r){var i=Ze(e),l={_:{transform:de},getBBox:function(){return i}};return Jt(l,r),l.matrix}),Jt=(o.transformPath=function(e,r){return qe(e,_n(e,r))},o._extractTransform=function(e,r){if(r==null)return e._.transform;r=z(r).replace(/\.{3}|\u2026/g,e._.transform||de);var i,l,m=o.parseTransformString(r),S=0,E=1,A=1,L=e._,H=new at;if(L.transform=m||[],m)for(var Q=0,ie=m.length;Q<ie;Q++){var ee,J,re,oe,se,Z=m[Q],ke=Z.length,le=z(Z[0]).toLowerCase(),pe=Z[0]!=le,ue=pe?H.invert():0;le=="t"&&ke==3?pe?(ee=ue.x(0,0),J=ue.y(0,0),re=ue.x(Z[1],Z[2]),oe=ue.y(Z[1],Z[2]),H.translate(re-ee,oe-J)):H.translate(Z[1],Z[2]):le=="r"?ke==2?(se=se||e.getBBox(1),H.rotate(Z[1],se.x+se.width/2,se.y+se.height/2),S+=Z[1]):ke==4&&(pe?(re=ue.x(Z[2],Z[3]),oe=ue.y(Z[2],Z[3]),H.rotate(Z[1],re,oe)):H.rotate(Z[1],Z[2],Z[3]),S+=Z[1]):le=="s"?ke==2||ke==3?(se=se||e.getBBox(1),H.scale(Z[1],Z[ke-1],se.x+se.width/2,se.y+se.height/2),E*=Z[1],A*=Z[ke-1]):ke==5&&(pe?(re=ue.x(Z[3],Z[4]),oe=ue.y(Z[3],Z[4]),H.scale(Z[1],Z[2],re,oe)):H.scale(Z[1],Z[2],Z[3],Z[4]),E*=Z[1],A*=Z[2]):le=="m"&&ke==7&&H.add(Z[1],Z[2],Z[3],Z[4],Z[5],Z[6]),L.dirtyT=1,e.matrix=H}e.matrix=H,L.sx=E,L.sy=A,L.deg=S,L.dx=i=H.e,L.dy=l=H.f,E==1&&A==1&&!S&&L.bbox?(L.bbox.x+=+i,L.bbox.y+=+l):L.dirtyT=1}),Qt=function(e){var r=e[0];switch(r.toLowerCase()){case"t":return[r,0,0];case"m":return[r,1,0,0,1,0,0];case"r":return e.length==4?[r,0,e[2],e[3]]:[r,0];case"s":return e.length==5?[r,1,1,e[3],e[4]]:e.length==3?[r,1,1]:[r,1]}},Sn=o._equaliseTransform=function(e,r){r=z(r).replace(/\.{3}|\u2026/g,e),e=o.parseTransformString(e)||[],r=o.parseTransformString(r)||[];for(var i,l,m,S,E=xe(e.length,r.length),A=[],L=[],H=0;H<E;H++){if(m=e[H]||Qt(r[H]),S=r[H]||Qt(m),m[0]!=S[0]||m[0].toLowerCase()=="r"&&(m[2]!=S[2]||m[3]!=S[3])||m[0].toLowerCase()=="s"&&(m[3]!=S[3]||m[4]!=S[4]))return;for(A[H]=[],L[H]=[],i=0,l=xe(m.length,S.length);i<l;i++)i in m&&(A[H][i]=m[i]),i in S&&(L[H][i]=S[i])}return{from:A,to:L}};function at(e,r,i,l,m,S){e!=null?(this.a=+e,this.b=+r,this.c=+i,this.d=+l,this.e=+m,this.f=+S):(this.a=1,this.b=0,this.c=0,this.d=1,this.e=0,this.f=0)}o._getContainer=function(e,r,i,l){var m;if((m=l!=null||o.is(e,"object")?e:M.doc.getElementById(e))!=null)return m.tagName?r==null?{container:m,width:m.style.pixelWidth||m.offsetWidth,height:m.style.pixelHeight||m.offsetHeight}:{container:m,width:r,height:i}:{container:1,x:e,y:r,width:i,height:l}},o.pathToRelative=Kt,o._engine={},o.path2curve=At,o.matrix=function(e,r,i,l,m,S){return new at(e,r,i,l,m,S)},function(e){function r(l){return l[0]*l[0]+l[1]*l[1]}function i(l){var m=ne.sqrt(r(l));l[0]&&(l[0]/=m),l[1]&&(l[1]/=m)}e.add=function(l,m,S,E,A,L){var H,Q,ie,ee,J=[[],[],[]],re=[[this.a,this.c,this.e],[this.b,this.d,this.f],[0,0,1]],oe=[[l,S,A],[m,E,L],[0,0,1]];for(l&&l instanceof at&&(oe=[[l.a,l.c,l.e],[l.b,l.d,l.f],[0,0,1]]),H=0;H<3;H++)for(Q=0;Q<3;Q++){for(ee=0,ie=0;ie<3;ie++)ee+=re[H][ie]*oe[ie][Q];J[H][Q]=ee}this.a=J[0][0],this.b=J[1][0],this.c=J[0][1],this.d=J[1][1],this.e=J[0][2],this.f=J[1][2]},e.invert=function(){var l=this,m=l.a*l.d-l.b*l.c;return new at(l.d/m,-l.b/m,-l.c/m,l.a/m,(l.c*l.f-l.d*l.e)/m,(l.b*l.e-l.a*l.f)/m)},e.clone=function(){return new at(this.a,this.b,this.c,this.d,this.e,this.f)},e.translate=function(l,m){this.add(1,0,0,1,l,m)},e.scale=function(l,m,S,E){m==null&&(m=l),(S||E)&&this.add(1,0,0,1,S,E),this.add(l,0,0,m,0,0),(S||E)&&this.add(1,0,0,1,-S,-E)},e.rotate=function(l,m,S){l=o.rad(l),m=m||0,S=S||0;var E=+ne.cos(l).toFixed(9),A=+ne.sin(l).toFixed(9);this.add(E,A,-A,E,m,S),this.add(1,0,0,1,-m,-S)},e.x=function(l,m){return l*this.a+m*this.c+this.e},e.y=function(l,m){return l*this.b+m*this.d+this.f},e.get=function(l){return+this[z.fromCharCode(97+l)].toFixed(4)},e.toString=function(){return o.svg?"matrix("+[this.get(0),this.get(1),this.get(2),this.get(3),this.get(4),this.get(5)].join()+")":[this.get(0),this.get(2),this.get(1),this.get(3),0,0].join()},e.toFilter=function(){return"progid:DXImageTransform.Microsoft.Matrix(M11="+this.get(0)+", M12="+this.get(2)+", M21="+this.get(1)+", M22="+this.get(3)+", Dx="+this.get(4)+", Dy="+this.get(5)+", sizingmethod='auto expand')"},e.offset=function(){return[this.e.toFixed(4),this.f.toFixed(4)]},e.split=function(){var l={};l.dx=this.e,l.dy=this.f;var m=[[this.a,this.c],[this.b,this.d]];l.scalex=ne.sqrt(r(m[0])),i(m[0]),l.shear=m[0][0]*m[1][0]+m[0][1]*m[1][1],m[1]=[m[1][0]-m[0][0]*l.shear,m[1][1]-m[0][1]*l.shear],l.scaley=ne.sqrt(r(m[1])),i(m[1]),l.shear/=l.scaley;var S=-m[0][1],E=m[1][1];return E<0?(l.rotate=o.deg(ne.acos(E)),S<0&&(l.rotate=360-l.rotate)):l.rotate=o.deg(ne.asin(S)),l.isSimple=!(+l.shear.toFixed(9)||l.scalex.toFixed(9)!=l.scaley.toFixed(9)&&l.rotate),l.isSuperSimple=!+l.shear.toFixed(9)&&l.scalex.toFixed(9)==l.scaley.toFixed(9)&&!l.rotate,l.noRotation=!+l.shear.toFixed(9)&&!l.rotate,l},e.toTransformString=function(l){var m=l||this[K]();return m.isSimple?(m.scalex=+m.scalex.toFixed(4),m.scaley=+m.scaley.toFixed(4),m.rotate=+m.rotate.toFixed(4),(m.dx||m.dy?"t"+[m.dx,m.dy]:de)+(m.scalex!=1||m.scaley!=1?"s"+[m.scalex,m.scaley,0,0]:de)+(m.rotate?"r"+[m.rotate,0,0]:de)):"m"+[this.get(0),this.get(1),this.get(2),this.get(3),this.get(4),this.get(5)]}}(at.prototype);for(var An=function(){this.returnValue=!1},En=function(){return this.originalEvent.preventDefault()},Pn=function(){this.cancelBubble=!0},Ln=function(){return this.originalEvent.stopPropagation()},Zt=function(e){var r=M.doc.documentElement.scrollTop||M.doc.body.scrollTop,i=M.doc.documentElement.scrollLeft||M.doc.body.scrollLeft;return{x:e.clientX+i,y:e.clientY+r}},Rn=M.doc.addEventListener?function(e,r,i,l){var m=function(E){var A=Zt(E);return i.call(l,E,A.x,A.y)};if(e.addEventListener(r,m,!1),ae&&D[r]){var S=function(E){for(var A=Zt(E),L=E,H=0,Q=E.targetTouches&&E.targetTouches.length;H<Q;H++)if(E.targetTouches[H].target==e){(E=E.targetTouches[H]).originalEvent=L,E.preventDefault=En,E.stopPropagation=Ln;break}return i.call(l,E,A.x,A.y)};e.addEventListener(D[r],S,!1)}return function(){return e.removeEventListener(r,m,!1),ae&&D[r]&&e.removeEventListener(D[r],S,!1),!0}}:M.doc.attachEvent?function(e,r,i,l){var m=function(S){S=S||M.win.event;var E=M.doc.documentElement.scrollTop||M.doc.body.scrollTop,A=M.doc.documentElement.scrollLeft||M.doc.body.scrollLeft,L=S.clientX+A,H=S.clientY+E;return S.preventDefault=S.preventDefault||An,S.stopPropagation=S.stopPropagation||Pn,i.call(l,S,L,H)};return e.attachEvent("on"+r,m),function(){return e.detachEvent("on"+r,m),!0}}:void 0,tt=[],Ot=function(e){for(var r,i=e.clientX,l=e.clientY,m=M.doc.documentElement.scrollTop||M.doc.body.scrollTop,S=M.doc.documentElement.scrollLeft||M.doc.body.scrollLeft,E=tt.length;E--;){if(r=tt[E],ae&&e.touches){for(var A,L=e.touches.length;L--;)if((A=e.touches[L]).identifier==r.el._drag.id){i=A.clientX,l=A.clientY,(e.originalEvent?e.originalEvent:e).preventDefault();break}}else e.preventDefault();var H,Q=r.el.node,ie=Q.nextSibling,ee=Q.parentNode,J=Q.style.display;M.win.opera&&ee.removeChild(Q),Q.style.display="none",H=r.el.paper.getElementByPoint(i,l),Q.style.display=J,M.win.opera&&(ie?ee.insertBefore(Q,ie):ee.appendChild(Q)),H&&a("raphael.drag.over."+r.el.id,r.el,H),i+=S,l+=m,a("raphael.drag.move."+r.el.id,r.move_scope||r.el,i-r.el._drag.x,l-r.el._drag.y,i,l,e)}},$t=function(e){o.unmousemove(Ot).unmouseup($t);for(var r,i=tt.length;i--;)(r=tt[i]).el._drag={},a("raphael.drag.end."+r.el.id,r.end_scope||r.start_scope||r.move_scope||r.el,e);tt=[]},Ie=o.el={},en=j.length;en--;)(function(e){o[e]=Ie[e]=function(r,i){return o.is(r,"function")&&(this.events=this.events||[],this.events.push({name:e,f:r,unbind:Rn(this.shape||this.node||M.doc,e,r,i||this)})),this},o["un"+e]=Ie["un"+e]=function(r){for(var i=this.events||[],l=i.length;l--;)i[l].name!=e||!o.is(r,"undefined")&&i[l].f!=r||(i[l].unbind(),i.splice(l,1),!i.length&&delete this.events);return this}})(j[en]);Ie.data=function(e,r){var i=we[this.id]=we[this.id]||{};if(arguments.length==0)return i;if(arguments.length==1){if(o.is(e,"object")){for(var l in e)e[T](l)&&this.data(l,e[l]);return this}return a("raphael.data.get."+this.id,this,i[e],e),i[e]}return i[e]=r,a("raphael.data.set."+this.id,this,r,e),this},Ie.removeData=function(e){return e==null?delete we[this.id]:we[this.id]&&delete we[this.id][e],this},Ie.getData=function(){return De(we[this.id]||{})},Ie.hover=function(e,r,i,l){return this.mouseover(e,i).mouseout(r,l||i)},Ie.unhover=function(e,r){return this.unmouseover(e).unmouseout(r)};var gt=[];Ie.drag=function(e,r,i,l,m,S){function E(A){(A.originalEvent||A).preventDefault();var L=A.clientX,H=A.clientY,Q=M.doc.documentElement.scrollTop||M.doc.body.scrollTop,ie=M.doc.documentElement.scrollLeft||M.doc.body.scrollLeft;if(this._drag.id=A.identifier,ae&&A.touches){for(var ee,J=A.touches.length;J--;)if(ee=A.touches[J],this._drag.id=ee.identifier,ee.identifier==this._drag.id){L=ee.clientX,H=ee.clientY;break}}this._drag.x=L+ie,this._drag.y=H+Q,!tt.length&&o.mousemove(Ot).mouseup($t),tt.push({el:this,move_scope:l,start_scope:m,end_scope:S}),r&&a.on("raphael.drag.start."+this.id,r),e&&a.on("raphael.drag.move."+this.id,e),i&&a.on("raphael.drag.end."+this.id,i),a("raphael.drag.start."+this.id,m||l||this,this._drag.x,this._drag.y,A)}return this._drag={},gt.push({el:this,start:E}),this.mousedown(E),this},Ie.onDragOver=function(e){e?a.on("raphael.drag.over."+this.id,e):a.unbind("raphael.drag.over."+this.id)},Ie.undrag=function(){for(var e=gt.length;e--;)gt[e].el==this&&(this.unmousedown(gt[e].start),gt.splice(e,1),a.unbind("raphael.drag.*."+this.id));!gt.length&&o.unmousemove(Ot).unmouseup($t),tt=[]},v.circle=function(e,r,i){var l=o._engine.circle(this,e||0,r||0,i||0);return this.__set__&&this.__set__.push(l),l},v.rect=function(e,r,i,l,m){var S=o._engine.rect(this,e||0,r||0,i||0,l||0,m||0);return this.__set__&&this.__set__.push(S),S},v.ellipse=function(e,r,i,l){var m=o._engine.ellipse(this,e||0,r||0,i||0,l||0);return this.__set__&&this.__set__.push(m),m},v.path=function(e){e&&!o.is(e,"string")&&!o.is(e[0],c)&&(e+=de);var r=o._engine.path(o.format[U](o,arguments),this);return this.__set__&&this.__set__.push(r),r},v.image=function(e,r,i,l,m){var S=o._engine.image(this,e||"about:blank",r||0,i||0,l||0,m||0);return this.__set__&&this.__set__.push(S),S},v.text=function(e,r,i){var l=o._engine.text(this,e||0,r||0,z(i));return this.__set__&&this.__set__.push(l),l},v.set=function(e){!o.is(e,"array")&&(e=Array.prototype.splice.call(arguments,0,arguments.length));var r=new Pt(e);return this.__set__&&this.__set__.push(r),r.paper=this,r.type="set",r},v.setStart=function(e){this.__set__=e||this.set()},v.setFinish=function(e){var r=this.__set__;return delete this.__set__,r},v.getSize=function(){var e=this.canvas.parentNode;return{width:e.offsetWidth,height:e.offsetHeight}},v.setSize=function(e,r){return o._engine.setSize.call(this,e,r)},v.setViewBox=function(e,r,i,l,m){return o._engine.setViewBox.call(this,e,r,i,l,m)},v.top=v.bottom=null,v.raphael=o;function tn(){return this.x+be+this.y+be+this.width+" × "+this.height}v.getElementByPoint=function(e,r){var i,l,m,S,E,A,L,H=this.canvas,Q=M.doc.elementFromPoint(e,r);if(M.win.opera&&Q.tagName=="svg"){var ie=(l=(i=H).getBoundingClientRect(),m=i.ownerDocument,S=m.body,E=m.documentElement,A=E.clientTop||S.clientTop||0,L=E.clientLeft||S.clientLeft||0,{y:l.top+(M.win.pageYOffset||E.scrollTop||S.scrollTop)-A,x:l.left+(M.win.pageXOffset||E.scrollLeft||S.scrollLeft)-L}),ee=H.createSVGRect();ee.x=e-ie.x,ee.y=r-ie.y,ee.width=ee.height=1;var J=H.getIntersectionList(ee,null);J.length&&(Q=J[J.length-1])}if(!Q)return null;for(;Q.parentNode&&Q!=H.parentNode&&!Q.raphael;)Q=Q.parentNode;return Q==this.canvas.parentNode&&(Q=H),Q=Q&&Q.raphael?this.getById(Q.raphaelid):null},v.getElementsByBBox=function(e){var r=this.set();return this.forEach(function(i){o.isBBoxIntersect(i.getBBox(),e)&&r.push(i)}),r},v.getById=function(e){for(var r=this.bottom;r;){if(r.id==e)return r;r=r.next}return null},v.forEach=function(e,r){for(var i=this.bottom;i;){if(e.call(r,i)===!1)return this;i=i.next}return this},v.getElementsByPoint=function(e,r){var i=this.set();return this.forEach(function(l){l.isPointInside(e,r)&&i.push(l)}),i},Ie.isPointInside=function(e,r){var i=this.realPath=Be[this.type](this);return this.attr("transform")&&this.attr("transform").length&&(i=o.transformPath(i,this.attr("transform"))),o.isPointInsidePath(i,e,r)},Ie.getBBox=function(e){if(this.removed)return{};var r=this._;return e?(!r.dirty&&r.bboxwt||(this.realPath=Be[this.type](this),r.bboxwt=Ze(this.realPath),r.bboxwt.toString=tn,r.dirty=0),r.bboxwt):((r.dirty||r.dirtyT||!r.bbox)&&(!r.dirty&&this.realPath||(r.bboxwt=0,this.realPath=Be[this.type](this)),r.bbox=Ze(qe(this.realPath,this.matrix)),r.bbox.toString=tn,r.dirty=r.dirtyT=0),r.bbox)},Ie.clone=function(){if(this.removed)return null;var e=this.paper[this.type]().attr(this.attr());return this.__set__&&this.__set__.push(e),e},Ie.glow=function(e){if(this.type=="text")return null;var r={width:((e=e||{}).width||10)+(+this.attr("stroke-width")||1),fill:e.fill||!1,opacity:e.opacity==null?.5:e.opacity,offsetx:e.offsetx||0,offsety:e.offsety||0,color:e.color||"#000"},i=r.width/2,l=this.paper,m=l.set(),S=this.realPath||Be[this.type](this);S=this.matrix?qe(S,this.matrix):S;for(var E=1;E<i+1;E++)m.push(l.path(S).attr({stroke:r.color,fill:r.fill?r.color:"none","stroke-linejoin":"round","stroke-linecap":"round","stroke-width":+(r.width/i*E).toFixed(3),opacity:+(r.opacity/i).toFixed(3)}));return m.insertBefore(this).translate(r.offsetx,r.offsety)};var Ht=function(e,r,i,l,m,S,E,A,L){return L==null?We(e,r,i,l,m,S,E,A):o.findDotsAtSegment(e,r,i,l,m,S,E,A,function(H,Q,ie,ee,J,re,oe,se,Z){if(!(Z<0||We(H,Q,ie,ee,J,re,oe,se)<Z)){var ke,le=.5,pe=1-le;for(ke=We(H,Q,ie,ee,J,re,oe,se,pe);Y(ke-Z)>.01;)ke=We(H,Q,ie,ee,J,re,oe,se,pe+=(ke<Z?1:-1)*(le/=2));return pe}}(e,r,i,l,m,S,E,A,L))},Vt=function(e,r){return function(i,l,m){for(var S,E,A,L,H,Q="",ie={},ee=0,J=0,re=(i=At(i)).length;J<re;J++){if((A=i[J])[0]=="M")S=+A[1],E=+A[2];else{if(ee+(L=Ht(S,E,A[1],A[2],A[3],A[4],A[5],A[6]))>l){if(r&&!ie.start){if(Q+=["C"+(H=Ht(S,E,A[1],A[2],A[3],A[4],A[5],A[6],l-ee)).start.x,H.start.y,H.m.x,H.m.y,H.x,H.y],m)return Q;ie.start=Q,Q=["M"+H.x,H.y+"C"+H.n.x,H.n.y,H.end.x,H.end.y,A[5],A[6]].join(),ee+=L,S=+A[5],E=+A[6];continue}if(!e&&!r)return{x:(H=Ht(S,E,A[1],A[2],A[3],A[4],A[5],A[6],l-ee)).x,y:H.y,alpha:H.alpha}}ee+=L,S=+A[5],E=+A[6]}Q+=A.shift()+A}return ie.end=Q,(H=e?ee:r?ie:o.findDotsAtSegment(S,E,A[0],A[1],A[2],A[3],A[4],A[5],1)).alpha&&(H={x:H.x,y:H.y,alpha:H.alpha}),H}},nn=Vt(1),rn=Vt(),Gt=Vt(0,1);o.getTotalLength=nn,o.getPointAtLength=rn,o.getSubpath=function(e,r,i){if(this.getTotalLength(e)-i<1e-6)return Gt(e,r).end;var l=Gt(e,i,1);return r?Gt(l,r).end:l},Ie.getTotalLength=function(){var e=this.getPath();if(e)return this.node.getTotalLength?this.node.getTotalLength():nn(e)},Ie.getPointAtLength=function(e){var r=this.getPath();if(r)return rn(r,e)},Ie.getPath=function(){var e,r=o._getPath[this.type];if(this.type!="text"&&this.type!="set")return r&&(e=r(this)),e},Ie.getSubpath=function(e,r){var i=this.getPath();if(i)return o.getSubpath(i,e,r)};var Ue=o.easing_formulas={linear:function(e){return e},"<":function(e){return he(e,1.7)},">":function(e){return he(e,.48)},"<>":function(e){var r=.48-e/1.04,i=ne.sqrt(.1734+r*r),l=i-r,m=-i-r,S=he(Y(l),1/3)*(l<0?-1:1)+he(Y(m),1/3)*(m<0?-1:1)+.5;return 3*(1-S)*S*S+S*S*S},backIn:function(e){var r=1.70158;return e*e*((r+1)*e-r)},backOut:function(e){var r=1.70158;return(e-=1)*e*((r+1)*e+r)+1},elastic:function(e){return e==!!e?e:he(2,-10*e)*ne.sin(2*fe*(e-.075)/.3)+1},bounce:function(e){var r=7.5625,i=2.75;return e<1/i?r*e*e:e<2/i?r*(e-=1.5/i)*e+.75:e<2.5/i?r*(e-=2.25/i)*e+.9375:r*(e-=2.625/i)*e+.984375}};Ue.easeIn=Ue["ease-in"]=Ue["<"],Ue.easeOut=Ue["ease-out"]=Ue[">"],Ue.easeInOut=Ue["ease-in-out"]=Ue["<>"],Ue["back-in"]=Ue.backIn,Ue["back-out"]=Ue.backOut;var Ne=[],sn=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){setTimeout(e,16)},Ut=function(){for(var e=+new Date,r=0;r<Ne.length;r++){var i=Ne[r];if(!i.el.removed&&!i.paused){var l,m,S=e-i.start,E=i.ms,A=i.easing,L=i.from,H=i.diff,Q=i.to,ie=(i.t,i.el),ee={},J={};if(i.initstatus?(S=(i.initstatus*i.anim.top-i.prev)/(i.percent-i.prev)*E,i.status=i.initstatus,delete i.initstatus,i.stop&&Ne.splice(r--,1)):i.status=(i.prev+(i.percent-i.prev)*(S/E))/i.anim.top,!(S<0))if(S<E){var re=A(S/E);for(var oe in L)if(L[T](oe)){switch(P[oe]){case ve:l=+L[oe]+re*E*H[oe];break;case"colour":l="rgb("+[Xt(u(L[oe].r+re*E*H[oe].r)),Xt(u(L[oe].g+re*E*H[oe].g)),Xt(u(L[oe].b+re*E*H[oe].b))].join(",")+")";break;case"path":l=[];for(var se=0,Z=L[oe].length;se<Z;se++){l[se]=[L[oe][se][0]];for(var ke=1,le=L[oe][se].length;ke<le;ke++)l[se][ke]=+L[oe][se][ke]+re*E*H[oe][se][ke];l[se]=l[se].join(be)}l=l.join(be);break;case"transform":if(H[oe].real)for(l=[],se=0,Z=L[oe].length;se<Z;se++)for(l[se]=[L[oe][se][0]],ke=1,le=L[oe][se].length;ke<le;ke++)l[se][ke]=L[oe][se][ke]+re*E*H[oe][se][ke];else{var pe=function(Ee){return+L[oe][Ee]+re*E*H[oe][Ee]};l=[["m",pe(0),pe(1),pe(2),pe(3),pe(4),pe(5)]]}break;case"csv":if(oe=="clip-rect")for(l=[],se=4;se--;)l[se]=+L[oe][se]+re*E*H[oe][se];break;default:var ue=[][V](L[oe]);for(l=[],se=ie.paper.customAttributes[oe].length;se--;)l[se]=+ue[se]+re*E*H[oe][se]}ee[oe]=l}ie.attr(ee),function(Ee,Ae,Pe){setTimeout(function(){a("raphael.anim.frame."+Ee,Ae,Pe)})}(ie.id,ie,i.anim)}else{if(function(Ee,Ae,Pe){setTimeout(function(){a("raphael.anim.frame."+Ae.id,Ae,Pe),a("raphael.anim.finish."+Ae.id,Ae,Pe),o.is(Ee,"function")&&Ee.call(Ae)})}(i.callback,ie,i.anim),ie.attr(Q),Ne.splice(r--,1),i.repeat>1&&!i.next){for(m in Q)Q[T](m)&&(J[m]=i.totalOrigin[m]);i.el.attr(J),Et(i.anim,i.el,i.anim.percents[0],null,i.totalOrigin,i.repeat-1)}i.next&&!i.stop&&Et(i.anim,i.el,i.next,null,i.totalOrigin,i.repeat)}}}Ne.length&&sn(Ut)},Xt=function(e){return e>255?255:e<0?0:e};function Bn(e,r,i,l,m,S){var E=3*r,A=3*(l-r)-E,L=1-E-A,H=3*i,Q=3*(m-i)-H,ie=1-H-Q;function ee(J){return((L*J+A)*J+E)*J}return function(J,re){var oe=function(se,Z){var ke,le,pe,ue,Ee,Ae;for(pe=se,Ae=0;Ae<8;Ae++){if(ue=ee(pe)-se,Y(ue)<Z)return pe;if(Y(Ee=(3*L*pe+2*A)*pe+E)<1e-6)break;pe-=ue/Ee}if(le=1,(pe=se)<(ke=0))return ke;if(pe>le)return le;for(;ke<le;){if(ue=ee(pe),Y(ue-se)<Z)return pe;se>ue?ke=pe:le=pe,pe=(le-ke)/2+ke}return pe}(J,re);return((ie*oe+Q)*oe+H)*oe}(e,1/(200*S))}function Ke(e,r){var i=[],l={};if(this.ms=r,this.times=1,e){for(var m in e)e[T](m)&&(l[f(m)]=e[m],i.push(f(m)));i.sort(Se)}this.anim=l,this.top=i[i.length-1],this.percents=i}function Et(e,r,i,l,m,S){i=f(i);var E,A,L,H,Q,ie,ee=e.ms,J={},re={},oe={};if(l)for(Z=0,ke=Ne.length;Z<ke;Z++){var se=Ne[Z];if(se.el.id==r.id&&se.anim==e){se.percent!=i?(Ne.splice(Z,1),L=1):A=se,r.attr(se.totalOrigin);break}}else l=+re;for(var Z=0,ke=e.percents.length;Z<ke;Z++){if(e.percents[Z]==i||e.percents[Z]>l*e.top){i=e.percents[Z],Q=e.percents[Z-1]||0,ee=ee/e.top*(i-Q),H=e.percents[Z+1],E=e.anim[i];break}l&&r.attr(e.anim[e.percents[Z]])}if(E){if(A)A.initstatus=l,A.start=new Date-A.ms*l;else{for(var le in E)if(E[T](le)&&(P[T](le)||r.paper.customAttributes[T](le)))switch(J[le]=r.attr(le),J[le]==null&&(J[le]=B[le]),re[le]=E[le],P[le]){case ve:oe[le]=(re[le]-J[le])/ee;break;case"colour":J[le]=o.getRGB(J[le]);var pe=o.getRGB(re[le]);oe[le]={r:(pe.r-J[le].r)/ee,g:(pe.g-J[le].g)/ee,b:(pe.b-J[le].b)/ee};break;case"path":var ue=At(J[le],re[le]),Ee=ue[1];for(J[le]=ue[0],oe[le]=[],Z=0,ke=J[le].length;Z<ke;Z++){oe[le][Z]=[0];for(var Ae=1,Pe=J[le][Z].length;Ae<Pe;Ae++)oe[le][Z][Ae]=(Ee[Z][Ae]-J[le][Z][Ae])/ee}break;case"transform":var xt=r._,Lt=Sn(xt[le],re[le]);if(Lt)for(J[le]=Lt.from,re[le]=Lt.to,oe[le]=[],oe[le].real=!0,Z=0,ke=J[le].length;Z<ke;Z++)for(oe[le][Z]=[J[le][Z][0]],Ae=1,Pe=J[le][Z].length;Ae<Pe;Ae++)oe[le][Z][Ae]=(re[le][Z][Ae]-J[le][Z][Ae])/ee;else{var Ge=r.matrix||new at,Ye={_:{transform:xt.transform},getBBox:function(){return r.getBBox(1)}};J[le]=[Ge.a,Ge.b,Ge.c,Ge.d,Ge.e,Ge.f],Jt(Ye,re[le]),re[le]=Ye._.transform,oe[le]=[(Ye.matrix.a-Ge.a)/ee,(Ye.matrix.b-Ge.b)/ee,(Ye.matrix.c-Ge.c)/ee,(Ye.matrix.d-Ge.d)/ee,(Ye.matrix.e-Ge.e)/ee,(Ye.matrix.f-Ge.f)/ee]}break;case"csv":var vt=z(E[le])[K](R),yt=z(J[le])[K](R);if(le=="clip-rect")for(J[le]=yt,oe[le]=[],Z=yt.length;Z--;)oe[le][Z]=(vt[Z]-J[le][Z])/ee;re[le]=vt;break;default:for(vt=[][V](E[le]),yt=[][V](J[le]),oe[le]=[],Z=r.paper.customAttributes[le].length;Z--;)oe[le][Z]=((vt[Z]||0)-(yt[Z]||0))/ee}var It=E.easing,Je=o.easing_formulas[It];if(!Je)if((Je=z(It).match(s))&&Je.length==5){var ot=Je;Je=function(qt){return Bn(qt,+ot[1],+ot[2],+ot[3],+ot[4],ee)}}else Je=Le;if(se={anim:e,percent:i,timestamp:ie=E.start||e.start||+new Date,start:ie+(e.del||0),status:0,initstatus:l||0,stop:!1,ms:ee,easing:Je,from:J,diff:oe,to:re,el:r,callback:E.callback,prev:Q,next:H,repeat:S||e.times,origin:r.attr(),totalOrigin:m},Ne.push(se),l&&!A&&!L&&(se.stop=!0,se.start=new Date-ee*l,Ne.length==1))return Ut();L&&(se.start=new Date-se.ms*l),Ne.length==1&&sn(Ut)}a("raphael.anim.start."+r.id,r,e)}}function an(e){for(var r=0;r<Ne.length;r++)Ne[r].el.paper==e&&Ne.splice(r--,1)}Ie.animateWith=function(e,r,i,l,m,S){if(this.removed)return S&&S.call(this),this;var E=i instanceof Ke?i:o.animation(i,l,m,S);Et(E,this,E.percents[0],null,this.attr());for(var A=0,L=Ne.length;A<L;A++)if(Ne[A].anim==r&&Ne[A].el==e){Ne[L-1].start=Ne[A].start;break}return this},Ie.onAnimation=function(e){return e?a.on("raphael.anim.frame."+this.id,e):a.unbind("raphael.anim.frame."+this.id),this},Ke.prototype.delay=function(e){var r=new Ke(this.anim,this.ms);return r.times=this.times,r.del=+e||0,r},Ke.prototype.repeat=function(e){var r=new Ke(this.anim,this.ms);return r.del=this.del,r.times=ne.floor(xe(e,0))||1,r},o.animation=function(e,r,i,l){if(e instanceof Ke)return e;!o.is(i,"function")&&i||(l=l||i||null,i=null),e=Object(e),r=+r||0;var m,S,E={};for(S in e)e[T](S)&&f(S)!=S&&f(S)+"%"!=S&&(m=!0,E[S]=e[S]);if(m)return i&&(E.easing=i),l&&(E.callback=l),new Ke({100:E},r);if(l){var A=0;for(var L in e){var H=x(L);e[T](L)&&H>A&&(A=H)}!e[A+="%"].callback&&(e[A].callback=l)}return new Ke(e,r)},Ie.animate=function(e,r,i,l){if(this.removed)return l&&l.call(this),this;var m=e instanceof Ke?e:o.animation(e,r,i,l);return Et(m,this,m.percents[0],null,this.attr()),this},Ie.setTime=function(e,r){return e&&r!=null&&this.status(e,me(r,e.ms)/e.ms),this},Ie.status=function(e,r){var i,l,m=[],S=0;if(r!=null)return Et(e,this,-1,me(r,1)),this;for(i=Ne.length;S<i;S++)if((l=Ne[S]).el.id==this.id&&(!e||l.anim==e)){if(e)return l.status;m.push({anim:l.anim,status:l.status})}return e?0:m},Ie.pause=function(e){for(var r=0;r<Ne.length;r++)Ne[r].el.id!=this.id||e&&Ne[r].anim!=e||a("raphael.anim.pause."+this.id,this,Ne[r].anim)!==!1&&(Ne[r].paused=!0);return this},Ie.resume=function(e){for(var r=0;r<Ne.length;r++)if(Ne[r].el.id==this.id&&(!e||Ne[r].anim==e)){var i=Ne[r];a("raphael.anim.resume."+this.id,this,i.anim)!==!1&&(delete i.paused,this.status(i.anim,i.status))}return this},Ie.stop=function(e){for(var r=0;r<Ne.length;r++)Ne[r].el.id!=this.id||e&&Ne[r].anim!=e||a("raphael.anim.stop."+this.id,this,Ne[r].anim)!==!1&&Ne.splice(r--,1);return this},a.on("raphael.remove",an),a.on("raphael.clear",an),Ie.toString=function(){return"Raphaël’s object"};var on,ln,it,cn,Pt=function(e){if(this.items=[],this.length=0,this.type="set",e)for(var r=0,i=e.length;r<i;r++)!e[r]||e[r].constructor!=Ie.constructor&&e[r].constructor!=Pt||(this[this.items.length]=this.items[this.items.length]=e[r],this.length++)},$e=Pt.prototype;for(var Wt in $e.push=function(){for(var e,r,i=0,l=arguments.length;i<l;i++)!(e=arguments[i])||e.constructor!=Ie.constructor&&e.constructor!=Pt||(this[r=this.items.length]=this.items[r]=e,this.length++);return this},$e.pop=function(){return this.length&&delete this[this.length--],this.items.pop()},$e.forEach=function(e,r){for(var i=0,l=this.items.length;i<l;i++)if(e.call(r,this.items[i],i)===!1)return this;return this},Ie)Ie[T](Wt)&&($e[Wt]=function(e){return function(){var r=arguments;return this.forEach(function(i){i[e][U](i,r)})}}(Wt));return $e.attr=function(e,r){if(e&&o.is(e,c)&&o.is(e[0],"object"))for(var i=0,l=e.length;i<l;i++)this.items[i].attr(e[i]);else for(var m=0,S=this.items.length;m<S;m++)this.items[m].attr(e,r);return this},$e.clear=function(){for(;this.length;)this.pop()},$e.splice=function(e,r,i){e=e<0?xe(this.length+e,0):e,r=xe(0,me(this.length-e,r));var l,m=[],S=[],E=[];for(l=2;l<arguments.length;l++)E.push(arguments[l]);for(l=0;l<r;l++)S.push(this[e+l]);for(;l<this.length-e;l++)m.push(this[e+l]);var A=E.length;for(l=0;l<A+m.length;l++)this.items[e+l]=this[e+l]=l<A?E[l]:m[l-A];for(l=this.items.length=this.length-=r-A;this[l];)delete this[l++];return new Pt(S)},$e.exclude=function(e){for(var r=0,i=this.length;r<i;r++)if(this[r]==e)return this.splice(r,1),!0},$e.animate=function(e,r,i,l){(o.is(i,"function")||!i)&&(l=i||null);var m,S,E=this.items.length,A=E,L=this;if(!E)return this;l&&(S=function(){!--E&&l.call(L)}),i=o.is(i,"string")?i:S;var H=o.animation(e,r,i,S);for(m=this.items[--A].animate(H);A--;)this.items[A]&&!this.items[A].removed&&this.items[A].animateWith(m,H,H),this.items[A]&&!this.items[A].removed||E--;return this},$e.insertAfter=function(e){for(var r=this.items.length;r--;)this.items[r].insertAfter(e);return this},$e.getBBox=function(){for(var e=[],r=[],i=[],l=[],m=this.items.length;m--;)if(!this.items[m].removed){var S=this.items[m].getBBox();e.push(S.x),r.push(S.y),i.push(S.x+S.width),l.push(S.y+S.height)}return{x:e=me[U](0,e),y:r=me[U](0,r),x2:i=xe[U](0,i),y2:l=xe[U](0,l),width:i-e,height:l-r}},$e.clone=function(e){e=this.paper.set();for(var r=0,i=this.items.length;r<i;r++)e.push(this.items[r].clone());return e},$e.toString=function(){return"Raphaël‘s set"},$e.glow=function(e){var r=this.paper.set();return this.forEach(function(i,l){var m=i.glow(e);m!=null&&m.forEach(function(S,E){r.push(S)})}),r},$e.isPointInside=function(e,r){var i=!1;return this.forEach(function(l){if(l.isPointInside(e,r))return i=!0,!1}),i},o.registerFont=function(e){if(!e.face)return e;this.fonts=this.fonts||{};var r={w:e.w,face:{},glyphs:{}},i=e.face["font-family"];for(var l in e.face)e.face[T](l)&&(r.face[l]=e.face[l]);if(this.fonts[i]?this.fonts[i].push(r):this.fonts[i]=[r],!e.svg){for(var m in r.face["units-per-em"]=x(e.face["units-per-em"],10),e.glyphs)if(e.glyphs[T](m)){var S=e.glyphs[m];if(r.glyphs[m]={w:S.w,k:{},d:S.d&&"M"+S.d.replace(/[mlcxtrv]/g,function(A){return{l:"L",c:"C",x:"z",t:"m",r:"l",v:"c"}[A]||"M"})+"z"},S.k)for(var E in S.k)S[T](E)&&(r.glyphs[m].k[E]=S.k[E])}}return e},v.getFont=function(e,r,i,l){if(l=l||"normal",i=i||"normal",r=+r||{normal:400,bold:700,lighter:300,bolder:800}[r]||400,o.fonts){var m,S=o.fonts[e];if(!S){var E=new RegExp("(^|\\s)"+e.replace(/[^\w\d\s+!~.:_-]/g,de)+"(\\s|$)","i");for(var A in o.fonts)if(o.fonts[T](A)&&E.test(A)){S=o.fonts[A];break}}if(S)for(var L=0,H=S.length;L<H&&((m=S[L]).face["font-weight"]!=r||m.face["font-style"]!=i&&m.face["font-style"]||m.face["font-stretch"]!=l);L++);return m}},v.print=function(e,r,i,l,m,S,E,A){S=S||"middle",E=xe(me(E||0,1),-1),A=xe(me(A||1,3),1);var L,H=z(i)[K](de),Q=0,ie=0,ee=de;if(o.is(l,"string")&&(l=this.getFont(l)),l){L=(m||16)/l.face["units-per-em"];for(var J=l.face.bbox[K](R),re=+J[0],oe=J[3]-J[1],se=0,Z=+J[1]+(S=="baseline"?oe+ +l.face.descent:oe/2),ke=0,le=H.length;ke<le;ke++){if(H[ke]==`
`)Q=0,ue=0,ie=0,se+=oe*A;else{var pe=ie&&l.glyphs[H[ke-1]]||{},ue=l.glyphs[H[ke]];Q+=ie?(pe.w||l.w)+(pe.k&&pe.k[H[ke]]||0)+l.w*E:0,ie=1}ue&&ue.d&&(ee+=o.transformPath(ue.d,["t",Q*L,se*L,"s",L,L,re,Z,"t",(e-re)/L,(r-Z)/L]))}}return this.path(ee).attr({fill:"#000",stroke:"none"})},v.add=function(e){if(o.is(e,"array"))for(var r,i=this.set(),l=0,m=e.length;l<m;l++)r=e[l]||{},O[T](r.type)&&i.push(this[r.type]().attr(r));return i},o.format=function(e,r){var i=o.is(r,c)?[0][V](r):arguments;return e&&o.is(e,"string")&&i.length-1&&(e=e.replace(I,function(l,m){return i[++m]==null?de:i[m]})),e||de},o.fullfill=(on=/\{([^\}]+)\}/g,ln=/(?:(?:^|\.)(.+?)(?=\[|\.|$|\()|\[('|")(.+?)\2\])(\(\))?/g,function(e,r){return String(e).replace(on,function(i,l){return function(m,S,E){var A=E;return S.replace(ln,function(L,H,Q,ie,ee){H=H||ie,A&&(H in A&&(A=A[H]),typeof A=="function"&&ee&&(A=A()))}),A=(A==null||A==E?m:A)+""}(i,l,r)})}),o.ninja=function(){if(G.was)M.win.Raphael=G.is;else{window.Raphael=void 0;try{delete window.Raphael}catch{}}return o},o.st=$e,a.on("raphael.DOMload",function(){g=!0}),(it=document).readyState==null&&it.addEventListener&&(it.addEventListener("DOMContentLoaded",cn=function(){it.removeEventListener("DOMContentLoaded",cn,!1),it.readyState="complete"},!1),it.readyState="loading"),function e(){/in/.test(it.readyState)?setTimeout(e,9):o.eve("raphael.DOMload")}(),o}).apply(F,k))===void 0||(N.exports=p)},function(N,F,C){var k,p;k=[C(0),C(3),C(4)],(p=(function(a){return a}).apply(F,k))===void 0||(N.exports=p)},function(N,F,C){var k,p,a,o,g,v,R,O,I,T,M,G,W,U;o="hasOwnProperty",g=/[\.\/]/,v=/\s*,\s*/,R=function(V,ae){return V-ae},O={n:{}},I=function(){for(var V=0,ae=this.length;V<ae;V++)if(this[V]!==void 0)return this[V]},T=function(){for(var V=this.length;--V;)if(this[V]!==void 0)return this[V]},M=Object.prototype.toString,G=String,W=Array.isArray||function(V){return V instanceof Array||M.call(V)=="[object Array]"},(U=function(V,ae){var de,be=a,z=Array.prototype.slice.call(arguments,2),K=U.listeners(V),j=0,D=[],ce={},ne=[],xe=p;ne.firstDefined=I,ne.lastDefined=T,p=V,a=0;for(var me=0,Y=K.length;me<Y;me++)"zIndex"in K[me]&&(D.push(K[me].zIndex),K[me].zIndex<0&&(ce[K[me].zIndex]=K[me]));for(D.sort(R);D[j]<0;)if(de=ce[D[j++]],ne.push(de.apply(ae,z)),a)return a=be,ne;for(me=0;me<Y;me++)if("zIndex"in(de=K[me]))if(de.zIndex==D[j]){if(ne.push(de.apply(ae,z)),a)break;do if((de=ce[D[++j]])&&ne.push(de.apply(ae,z)),a)break;while(de)}else ce[de.zIndex]=de;else if(ne.push(de.apply(ae,z)),a)break;return a=be,p=xe,ne})._events=O,U.listeners=function(V){var ae,de,be,z,K,j,D,ce,ne=W(V)?V:V.split(g),xe=O,me=[xe],Y=[];for(z=0,K=ne.length;z<K;z++){for(ce=[],j=0,D=me.length;j<D;j++)for(de=[(xe=me[j].n)[ne[z]],xe["*"]],be=2;be--;)(ae=de[be])&&(ce.push(ae),Y=Y.concat(ae.f||[]));me=ce}return Y},U.separator=function(V){V?(V="["+(V=G(V).replace(/(?=[\.\^\]\[\-])/g,"\\"))+"]",g=new RegExp(V)):g=/[\.\/]/},U.on=function(V,ae){if(typeof ae!="function")return function(){};for(var de=W(V)?W(V[0])?V:[V]:G(V).split(v),be=0,z=de.length;be<z;be++)(function(K){for(var j,D=W(K)?K:G(K).split(g),ce=O,ne=0,xe=D.length;ne<xe;ne++)ce=(ce=ce.n).hasOwnProperty(D[ne])&&ce[D[ne]]||(ce[D[ne]]={n:{}});for(ce.f=ce.f||[],ne=0,xe=ce.f.length;ne<xe;ne++)if(ce.f[ne]==ae){j=!0;break}!j&&ce.f.push(ae)})(de[be]);return function(K){+K==+K&&(ae.zIndex=+K)}},U.f=function(V){var ae=[].slice.call(arguments,1);return function(){U.apply(null,[V,null].concat(ae).concat([].slice.call(arguments,0)))}},U.stop=function(){a=1},U.nt=function(V){var ae=W(p)?p.join("."):p;return V?new RegExp("(?:\\.|\\/|^)"+V+"(?:\\.|\\/|$)").test(ae):ae},U.nts=function(){return W(p)?p:p.split(g)},U.off=U.unbind=function(V,ae){if(V){var de=W(V)?W(V[0])?V:[V]:G(V).split(v);if(de.length>1)for(var be=0,z=de.length;be<z;be++)U.off(de[be],ae);else{de=W(V)?V:G(V).split(g);var K,j,D,ce,ne,xe=[O];for(be=0,z=de.length;be<z;be++)for(ce=0;ce<xe.length;ce+=D.length-2){if(D=[ce,1],K=xe[ce].n,de[be]!="*")K[de[be]]&&D.push(K[de[be]]);else for(j in K)K[o](j)&&D.push(K[j]);xe.splice.apply(xe,D)}for(be=0,z=xe.length;be<z;be++)for(K=xe[be];K.n;){if(ae){if(K.f){for(ce=0,ne=K.f.length;ce<ne;ce++)if(K.f[ce]==ae){K.f.splice(ce,1);break}!K.f.length&&delete K.f}for(j in K.n)if(K.n[o](j)&&K.n[j].f){var me=K.n[j].f;for(ce=0,ne=me.length;ce<ne;ce++)if(me[ce]==ae){me.splice(ce,1);break}!me.length&&delete K.n[j].f}}else for(j in delete K.f,K.n)K.n[o](j)&&K.n[j].f&&delete K.n[j].f;K=K.n}}}else U._events=O={n:{}}},U.once=function(V,ae){var de=function(){return U.off(V,de),ae.apply(this,arguments)};return U.on(V,de)},U.version="0.5.0",U.toString=function(){return"You are running Eve 0.5.0"},N.exports?N.exports=U:(k=(function(){return U}).apply(F,[]))===void 0||(N.exports=k)},function(N,F,C){var k,p;k=[C(0)],(p=(function(a){if(!a||a.svg){var o="hasOwnProperty",g=String,v=parseFloat,R=parseInt,O=Math,I=O.max,T=O.abs,M=O.pow,G=/[, ]+/,W=a.eve,U="",V=" ",ae="http://www.w3.org/1999/xlink",de={block:"M5,0 0,2.5 5,5z",classic:"M5,0 0,2.5 5,5 3.5,3 3.5,2z",diamond:"M2.5,0 5,2.5 2.5,5 0,2.5z",open:"M6,1 1,3.5 6,6",oval:"M2.5,0A2.5,2.5,0,0,1,2.5,5 2.5,2.5,0,0,1,2.5,0z"},be={};a.toString=function(){return`Your browser supports SVG.
You are running Raphaël `+this.version};var z=function(t,n){if(n)for(var s in typeof t=="string"&&(t=z(t)),n)n[o](s)&&(s.substring(0,6)=="xlink:"?t.setAttributeNS(ae,s.substring(6),g(n[s])):t.setAttribute(s,g(n[s])));else(t=a._g.doc.createElementNS("http://www.w3.org/2000/svg",t)).style&&(t.style.webkitTapHighlightColor="rgba(0,0,0,0)");return t},K=function(t,n){var s="linear",u=t.id+n,f=.5,x=.5,b=t.node,B=t.paper,P=b.style,$=a._g.doc.getElementById(u);if(!$){if(n=(n=g(n).replace(a._radial_gradient,function(Se,Le,ye){if(s="radial",Le&&ye){f=v(Le);var Re=2*((x=v(ye))>.5)-1;M(f-.5,2)+M(x-.5,2)>.25&&(x=O.sqrt(.25-M(f-.5,2))*Re+.5)&&x!=.5&&(x=x.toFixed(5)-1e-5*Re)}return U})).split(/\s*\-\s*/),s=="linear"){var X=n.shift();if(X=-v(X),isNaN(X))return null;var te=[0,0,O.cos(a.rad(X)),O.sin(a.rad(X))],ge=1/(I(T(te[2]),T(te[3]))||1);te[2]*=ge,te[3]*=ge,te[2]<0&&(te[0]=-te[2],te[2]=0),te[3]<0&&(te[1]=-te[3],te[3]=0)}var _e=a._parseDots(n);if(!_e)return null;if(u=u.replace(/[\(\)\s,\xb0#]/g,"_"),t.gradient&&u!=t.gradient.id&&(B.defs.removeChild(t.gradient),delete t.gradient),!t.gradient){$=z(s+"Gradient",{id:u}),t.gradient=$,z($,s=="radial"?{fx:f,fy:x}:{x1:te[0],y1:te[1],x2:te[2],y2:te[3],gradientTransform:t.matrix.invert()}),B.defs.appendChild($);for(var Ce=0,we=_e.length;Ce<we;Ce++)$.appendChild(z("stop",{offset:_e[Ce].offset?_e[Ce].offset:Ce?"100%":"0%","stop-color":_e[Ce].color||"#fff","stop-opacity":isFinite(_e[Ce].opacity)?_e[Ce].opacity:1}))}}return z(b,{fill:j(u),opacity:1,"fill-opacity":1}),P.fill=U,P.opacity=1,P.fillOpacity=1,1},j=function(t){if((n=document.documentMode)&&(n===9||n===10))return"url('#"+t+"')";var n,s=document.location;return"url('"+(s.protocol+"//"+s.host+s.pathname+s.search)+"#"+t+"')"},D=function(t){var n=t.getBBox(1);z(t.pattern,{patternTransform:t.matrix.invert()+" translate("+n.x+","+n.y+")"})},ce=function(t,n,s){if(t.type=="path"){for(var u,f,x,b,B,P=g(n).toLowerCase().split("-"),$=t.paper,X=s?"end":"start",te=t.node,ge=t.attrs,_e=ge["stroke-width"],Ce=P.length,we="classic",Se=3,Le=3,ye=5;Ce--;)switch(P[Ce]){case"block":case"classic":case"oval":case"diamond":case"open":case"none":we=P[Ce];break;case"wide":Le=5;break;case"narrow":Le=2;break;case"long":Se=5;break;case"short":Se=2}if(we=="open"?(Se+=2,Le+=2,ye+=2,x=1,b=s?4:1,B={fill:"none",stroke:ge.stroke}):(b=x=Se/2,B={fill:ge.stroke,stroke:"none"}),t._.arrows?s?(t._.arrows.endPath&&be[t._.arrows.endPath]--,t._.arrows.endMarker&&be[t._.arrows.endMarker]--):(t._.arrows.startPath&&be[t._.arrows.startPath]--,t._.arrows.startMarker&&be[t._.arrows.startMarker]--):t._.arrows={},we!="none"){var Re="raphael-marker-"+we,Be="raphael-marker-"+X+we+Se+Le+"-obj"+t.id;a._g.doc.getElementById(Re)?be[Re]++:($.defs.appendChild(z(z("path"),{"stroke-linecap":"round",d:de[we],id:Re})),be[Re]=1);var qe,Te=a._g.doc.getElementById(Be);Te?(be[Be]++,qe=Te.getElementsByTagName("use")[0]):(Te=z(z("marker"),{id:Be,markerHeight:Le,markerWidth:Se,orient:"auto",refX:b,refY:Le/2}),qe=z(z("use"),{"xlink:href":"#"+Re,transform:(s?"rotate(180 "+Se/2+" "+Le/2+") ":U)+"scale("+Se/ye+","+Le/ye+")","stroke-width":(1/((Se/ye+Le/ye)/2)).toFixed(4)}),Te.appendChild(qe),$.defs.appendChild(Te),be[Be]=1),z(qe,B);var Me=x*(we!="diamond"&&we!="oval");s?(u=t._.arrows.startdx*_e||0,f=a.getTotalLength(ge.path)-Me*_e):(u=Me*_e,f=a.getTotalLength(ge.path)-(t._.arrows.enddx*_e||0)),(B={})["marker-"+X]="url(#"+Be+")",(f||u)&&(B.d=a.getSubpath(ge.path,u,f)),z(te,B),t._.arrows[X+"Path"]=Re,t._.arrows[X+"Marker"]=Be,t._.arrows[X+"dx"]=Me,t._.arrows[X+"Type"]=we,t._.arrows[X+"String"]=n}else s?(u=t._.arrows.startdx*_e||0,f=a.getTotalLength(ge.path)-u):(u=0,f=a.getTotalLength(ge.path)-(t._.arrows.enddx*_e||0)),t._.arrows[X+"Path"]&&z(te,{d:a.getSubpath(ge.path,u,f)}),delete t._.arrows[X+"Path"],delete t._.arrows[X+"Marker"],delete t._.arrows[X+"dx"],delete t._.arrows[X+"Type"],delete t._.arrows[X+"String"];for(B in be)if(be[o](B)&&!be[B]){var De=a._g.doc.getElementById(B);De&&De.parentNode.removeChild(De)}}},ne={"-":[3,1],".":[1,1],"-.":[3,1,1,1],"-..":[3,1,1,1,1,1],". ":[1,3],"- ":[4,3],"--":[8,3],"- .":[4,3,1,3],"--.":[8,3,1,3],"--..":[8,3,1,3,1,3]},xe=function(t,n,s){if(n=ne[g(n).toLowerCase()]){for(var u=t.attrs["stroke-width"]||"1",f={round:u,square:u,butt:0}[t.attrs["stroke-linecap"]||s["stroke-linecap"]]||0,x=[],b=n.length;b--;)x[b]=n[b]*u+(b%2?1:-1)*f;z(t.node,{"stroke-dasharray":x.join(",")})}else z(t.node,{"stroke-dasharray":"none"})},me=function(t,n){var s=t.node,u=t.attrs,f=s.style.visibility;for(var x in s.style.visibility="hidden",n)if(n[o](x)){if(!a._availableAttrs[o](x))continue;var b=n[x];switch(u[x]=b,x){case"blur":t.blur(b);break;case"title":var B=s.getElementsByTagName("title");if(B.length&&(B=B[0]))B.firstChild.nodeValue=b;else{B=z("title");var P=a._g.doc.createTextNode(b);B.appendChild(P),s.appendChild(B)}break;case"href":case"target":var $=s.parentNode;if($.tagName.toLowerCase()!="a"){var X=z("a");$.insertBefore(X,s),X.appendChild(s),$=X}x=="target"?$.setAttributeNS(ae,"show",b=="blank"?"new":b):$.setAttributeNS(ae,x,b);break;case"cursor":s.style.cursor=b;break;case"transform":t.transform(b);break;case"arrow-start":ce(t,b);break;case"arrow-end":ce(t,b,1);break;case"clip-rect":var te=g(b).split(G);if(te.length==4){t.clip&&t.clip.parentNode.parentNode.removeChild(t.clip.parentNode);var ge=z("clipPath"),_e=z("rect");ge.id=a.createUUID(),z(_e,{x:te[0],y:te[1],width:te[2],height:te[3]}),ge.appendChild(_e),t.paper.defs.appendChild(ge),z(s,{"clip-path":"url(#"+ge.id+")"}),t.clip=_e}if(!b){var Ce=s.getAttribute("clip-path");if(Ce){var we=a._g.doc.getElementById(Ce.replace(/(^url\(#|\)$)/g,U));we&&we.parentNode.removeChild(we),z(s,{"clip-path":U}),delete t.clip}}break;case"path":t.type=="path"&&(z(s,{d:b?u.path=a._pathToAbsolute(b):"M0,0"}),t._.dirty=1,t._.arrows&&("startString"in t._.arrows&&ce(t,t._.arrows.startString),"endString"in t._.arrows&&ce(t,t._.arrows.endString,1)));break;case"width":if(s.setAttribute(x,b),t._.dirty=1,!u.fx)break;x="x",b=u.x;case"x":u.fx&&(b=-u.x-(u.width||0));case"rx":if(x=="rx"&&t.type=="rect")break;case"cx":s.setAttribute(x,b),t.pattern&&D(t),t._.dirty=1;break;case"height":if(s.setAttribute(x,b),t._.dirty=1,!u.fy)break;x="y",b=u.y;case"y":u.fy&&(b=-u.y-(u.height||0));case"ry":if(x=="ry"&&t.type=="rect")break;case"cy":s.setAttribute(x,b),t.pattern&&D(t),t._.dirty=1;break;case"r":t.type=="rect"?z(s,{rx:b,ry:b}):s.setAttribute(x,b),t._.dirty=1;break;case"src":t.type=="image"&&s.setAttributeNS(ae,"href",b);break;case"stroke-width":t._.sx==1&&t._.sy==1||(b/=I(T(t._.sx),T(t._.sy))||1),s.setAttribute(x,b),u["stroke-dasharray"]&&xe(t,u["stroke-dasharray"],n),t._.arrows&&("startString"in t._.arrows&&ce(t,t._.arrows.startString),"endString"in t._.arrows&&ce(t,t._.arrows.endString,1));break;case"stroke-dasharray":xe(t,b,n);break;case"fill":var Se=g(b).match(a._ISURL);if(Se){ge=z("pattern");var Le=z("image");ge.id=a.createUUID(),z(ge,{x:0,y:0,patternUnits:"userSpaceOnUse",height:1,width:1}),z(Le,{x:0,y:0,"xlink:href":Se[1]}),ge.appendChild(Le),function(Te){a._preload(Se[1],function(){var Me=this.offsetWidth,De=this.offsetHeight;z(Te,{width:Me,height:De}),z(Le,{width:Me,height:De})})}(ge),t.paper.defs.appendChild(ge),z(s,{fill:"url(#"+ge.id+")"}),t.pattern=ge,t.pattern&&D(t);break}var ye=a.getRGB(b);if(ye.error){if((t.type=="circle"||t.type=="ellipse"||g(b).charAt()!="r")&&K(t,b)){if("opacity"in u||"fill-opacity"in u){var Re=a._g.doc.getElementById(s.getAttribute("fill").replace(/^url\(#|\)$/g,U));if(Re){var Be=Re.getElementsByTagName("stop");z(Be[Be.length-1],{"stop-opacity":("opacity"in u?u.opacity:1)*("fill-opacity"in u?u["fill-opacity"]:1)})}}u.gradient=b,u.fill="none";break}}else delete n.gradient,delete u.gradient,!a.is(u.opacity,"undefined")&&a.is(n.opacity,"undefined")&&z(s,{opacity:u.opacity}),!a.is(u["fill-opacity"],"undefined")&&a.is(n["fill-opacity"],"undefined")&&z(s,{"fill-opacity":u["fill-opacity"]});ye[o]("opacity")&&z(s,{"fill-opacity":ye.opacity>1?ye.opacity/100:ye.opacity});case"stroke":ye=a.getRGB(b),s.setAttribute(x,ye.hex),x=="stroke"&&ye[o]("opacity")&&z(s,{"stroke-opacity":ye.opacity>1?ye.opacity/100:ye.opacity}),x=="stroke"&&t._.arrows&&("startString"in t._.arrows&&ce(t,t._.arrows.startString),"endString"in t._.arrows&&ce(t,t._.arrows.endString,1));break;case"gradient":(t.type=="circle"||t.type=="ellipse"||g(b).charAt()!="r")&&K(t,b);break;case"opacity":u.gradient&&!u[o]("stroke-opacity")&&z(s,{"stroke-opacity":b>1?b/100:b});case"fill-opacity":if(u.gradient){(Re=a._g.doc.getElementById(s.getAttribute("fill").replace(/^url\(#|\)$/g,U)))&&(Be=Re.getElementsByTagName("stop"),z(Be[Be.length-1],{"stop-opacity":b}));break}default:x=="font-size"&&(b=R(b,10)+"px");var qe=x.replace(/(\-.)/g,function(Te){return Te.substring(1).toUpperCase()});s.style[qe]=b,t._.dirty=1,s.setAttribute(x,b)}}Y(t,n),s.style.visibility=f},Y=function(t,n){if(t.type=="text"&&(n[o]("text")||n[o]("font")||n[o]("font-size")||n[o]("x")||n[o]("y"))){var s=t.attrs,u=t.node,f=u.firstChild?R(a._g.doc.defaultView.getComputedStyle(u.firstChild,U).getPropertyValue("font-size"),10):10;if(n[o]("text")){for(s.text=n.text;u.firstChild;)u.removeChild(u.firstChild);for(var x,b=g(n.text).split(`
`),B=[],P=0,$=b.length;P<$;P++)x=z("tspan"),P&&z(x,{dy:1.2*f,x:s.x}),x.appendChild(a._g.doc.createTextNode(b[P])),u.appendChild(x),B[P]=x}else for(P=0,$=(B=u.getElementsByTagName("tspan")).length;P<$;P++)P?z(B[P],{dy:1.2*f,x:s.x}):z(B[0],{dy:0});z(u,{x:s.x,y:s.y}),t._.dirty=1;var X=t._getBBox(),te=s.y-(X.y+X.height/2);te&&a.is(te,"finite")&&z(B[0],{dy:te})}},he=function(t){return t.parentNode&&t.parentNode.tagName.toLowerCase()==="a"?t.parentNode:t},fe=function(t,n){this[0]=this.node=t,t.raphael=!0,this.id=("0000"+(Math.random()*Math.pow(36,5)<<0).toString(36)).slice(-5),t.raphaelid=this.id,this.matrix=a.matrix(),this.realPath=null,this.paper=n,this.attrs=this.attrs||{},this._={transform:[],sx:1,sy:1,deg:0,dx:0,dy:0,dirty:1},!n.bottom&&(n.bottom=this),this.prev=n.top,n.top&&(n.top.next=this),n.top=this,this.next=null},ve=a.el;fe.prototype=ve,ve.constructor=fe,a._engine.path=function(t,n){var s=z("path");n.canvas&&n.canvas.appendChild(s);var u=new fe(s,n);return u.type="path",me(u,{fill:"none",stroke:"#000",path:t}),u},ve.rotate=function(t,n,s){if(this.removed)return this;if((t=g(t).split(G)).length-1&&(n=v(t[1]),s=v(t[2])),t=v(t[0]),s==null&&(n=s),n==null||s==null){var u=this.getBBox(1);n=u.x+u.width/2,s=u.y+u.height/2}return this.transform(this._.transform.concat([["r",t,n,s]])),this},ve.scale=function(t,n,s,u){if(this.removed)return this;if((t=g(t).split(G)).length-1&&(n=v(t[1]),s=v(t[2]),u=v(t[3])),t=v(t[0]),n==null&&(n=t),u==null&&(s=u),s==null||u==null)var f=this.getBBox(1);return s=s??f.x+f.width/2,u=u??f.y+f.height/2,this.transform(this._.transform.concat([["s",t,n,s,u]])),this},ve.translate=function(t,n){return this.removed?this:((t=g(t).split(G)).length-1&&(n=v(t[1])),t=v(t[0])||0,n=+n||0,this.transform(this._.transform.concat([["t",t,n]])),this)},ve.transform=function(t){var n=this._;if(t==null)return n.transform;if(a._extractTransform(this,t),this.clip&&z(this.clip,{transform:this.matrix.invert()}),this.pattern&&D(this),this.node&&z(this.node,{transform:this.matrix}),n.sx!=1||n.sy!=1){var s=this.attrs[o]("stroke-width")?this.attrs["stroke-width"]:1;this.attr({"stroke-width":s})}return this},ve.hide=function(){return this.removed||(this.node.style.display="none"),this},ve.show=function(){return this.removed||(this.node.style.display=""),this},ve.remove=function(){var t=he(this.node);if(!this.removed&&t.parentNode){var n=this.paper;for(var s in n.__set__&&n.__set__.exclude(this),W.unbind("raphael.*.*."+this.id),this.gradient&&n.defs.removeChild(this.gradient),a._tear(this,n),t.parentNode.removeChild(t),this.removeData(),this)this[s]=typeof this[s]=="function"?a._removedFactory(s):null;this.removed=!0}},ve._getBBox=function(){if(this.node.style.display=="none"){this.show();var t=!0}var n,s=!1;this.paper.canvas.parentElement?n=this.paper.canvas.parentElement.style:this.paper.canvas.parentNode&&(n=this.paper.canvas.parentNode.style),n&&n.display=="none"&&(s=!0,n.display="");var u={};try{u=this.node.getBBox()}catch{u={x:this.node.clientLeft,y:this.node.clientTop,width:this.node.clientWidth,height:this.node.clientHeight}}finally{u=u||{},s&&(n.display="none")}return t&&this.hide(),u},ve.attr=function(t,n){if(this.removed)return this;if(t==null){var s={};for(var u in this.attrs)this.attrs[o](u)&&(s[u]=this.attrs[u]);return s.gradient&&s.fill=="none"&&(s.fill=s.gradient)&&delete s.gradient,s.transform=this._.transform,s}if(n==null&&a.is(t,"string")){if(t=="fill"&&this.attrs.fill=="none"&&this.attrs.gradient)return this.attrs.gradient;if(t=="transform")return this._.transform;for(var f=t.split(G),x={},b=0,B=f.length;b<B;b++)(t=f[b])in this.attrs?x[t]=this.attrs[t]:a.is(this.paper.customAttributes[t],"function")?x[t]=this.paper.customAttributes[t].def:x[t]=a._availableAttrs[t];return B-1?x:x[f[0]]}if(n==null&&a.is(t,"array")){for(x={},b=0,B=t.length;b<B;b++)x[t[b]]=this.attr(t[b]);return x}if(n!=null){var P={};P[t]=n}else t!=null&&a.is(t,"object")&&(P=t);for(var $ in P)W("raphael.attr."+$+"."+this.id,this,P[$]);for($ in this.paper.customAttributes)if(this.paper.customAttributes[o]($)&&P[o]($)&&a.is(this.paper.customAttributes[$],"function")){var X=this.paper.customAttributes[$].apply(this,[].concat(P[$]));for(var te in this.attrs[$]=P[$],X)X[o](te)&&(P[te]=X[te])}return me(this,P),this},ve.toFront=function(){if(this.removed)return this;var t=he(this.node);t.parentNode.appendChild(t);var n=this.paper;return n.top!=this&&a._tofront(this,n),this},ve.toBack=function(){if(this.removed)return this;var t=he(this.node),n=t.parentNode;return n.insertBefore(t,n.firstChild),a._toback(this,this.paper),this.paper,this},ve.insertAfter=function(t){if(this.removed||!t)return this;var n=he(this.node),s=he(t.node||t[t.length-1].node);return s.nextSibling?s.parentNode.insertBefore(n,s.nextSibling):s.parentNode.appendChild(n),a._insertafter(this,t,this.paper),this},ve.insertBefore=function(t){if(this.removed||!t)return this;var n=he(this.node),s=he(t.node||t[0].node);return s.parentNode.insertBefore(n,s),a._insertbefore(this,t,this.paper),this},ve.blur=function(t){var n=this;if(+t!=0){var s=z("filter"),u=z("feGaussianBlur");n.attrs.blur=t,s.id=a.createUUID(),z(u,{stdDeviation:+t||1.5}),s.appendChild(u),n.paper.defs.appendChild(s),n._blur=s,z(n.node,{filter:"url(#"+s.id+")"})}else n._blur&&(n._blur.parentNode.removeChild(n._blur),delete n._blur,delete n.attrs.blur),n.node.removeAttribute("filter");return n},a._engine.circle=function(t,n,s,u){var f=z("circle");t.canvas&&t.canvas.appendChild(f);var x=new fe(f,t);return x.attrs={cx:n,cy:s,r:u,fill:"none",stroke:"#000"},x.type="circle",z(f,x.attrs),x},a._engine.rect=function(t,n,s,u,f,x){var b=z("rect");t.canvas&&t.canvas.appendChild(b);var B=new fe(b,t);return B.attrs={x:n,y:s,width:u,height:f,rx:x||0,ry:x||0,fill:"none",stroke:"#000"},B.type="rect",z(b,B.attrs),B},a._engine.ellipse=function(t,n,s,u,f){var x=z("ellipse");t.canvas&&t.canvas.appendChild(x);var b=new fe(x,t);return b.attrs={cx:n,cy:s,rx:u,ry:f,fill:"none",stroke:"#000"},b.type="ellipse",z(x,b.attrs),b},a._engine.image=function(t,n,s,u,f,x){var b=z("image");z(b,{x:s,y:u,width:f,height:x,preserveAspectRatio:"none"}),b.setAttributeNS(ae,"href",n),t.canvas&&t.canvas.appendChild(b);var B=new fe(b,t);return B.attrs={x:s,y:u,width:f,height:x,src:n},B.type="image",B},a._engine.text=function(t,n,s,u){var f=z("text");t.canvas&&t.canvas.appendChild(f);var x=new fe(f,t);return x.attrs={x:n,y:s,"text-anchor":"middle",text:u,"font-family":a._availableAttrs["font-family"],"font-size":a._availableAttrs["font-size"],stroke:"none",fill:"#000"},x.type="text",me(x,x.attrs),x},a._engine.setSize=function(t,n){return this.width=t||this.width,this.height=n||this.height,this.canvas.setAttribute("width",this.width),this.canvas.setAttribute("height",this.height),this._viewBox&&this.setViewBox.apply(this,this._viewBox),this},a._engine.create=function(){var t=a._getContainer.apply(0,arguments),n=t&&t.container;if(!n)throw new Error("SVG container not found.");var s,u=t.x,f=t.y,x=t.width,b=t.height,B=z("svg"),P="overflow:hidden;";return u=u||0,f=f||0,z(B,{height:b=b||342,version:1.1,width:x=x||512,xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink"}),n==1?(B.style.cssText=P+"position:absolute;left:"+u+"px;top:"+f+"px",a._g.doc.body.appendChild(B),s=1):(B.style.cssText=P+"position:relative",n.firstChild?n.insertBefore(B,n.firstChild):n.appendChild(B)),(n=new a._Paper).width=x,n.height=b,n.canvas=B,n.clear(),n._left=n._top=0,s&&(n.renderfix=function(){}),n.renderfix(),n},a._engine.setViewBox=function(t,n,s,u,f){W("raphael.setViewBox",this,this._viewBox,[t,n,s,u,f]);var x,b,B=this.getSize(),P=I(s/B.width,u/B.height),$=this.top,X=f?"xMidYMid meet":"xMinYMin";for(t==null?(this._vbSize&&(P=1),delete this._vbSize,x="0 0 "+this.width+V+this.height):(this._vbSize=P,x=t+V+n+V+s+V+u),z(this.canvas,{viewBox:x,preserveAspectRatio:X});P&&$;)b="stroke-width"in $.attrs?$.attrs["stroke-width"]:1,$.attr({"stroke-width":b}),$._.dirty=1,$._.dirtyT=1,$=$.prev;return this._viewBox=[t,n,s,u,!!f],this},a.prototype.renderfix=function(){var t,n=this.canvas,s=n.style;try{t=n.getScreenCTM()||n.createSVGMatrix()}catch{t=n.createSVGMatrix()}var u=-t.e%1,f=-t.f%1;(u||f)&&(u&&(this._left=(this._left+u)%1,s.left=this._left+"px"),f&&(this._top=(this._top+f)%1,s.top=this._top+"px"))},a.prototype.clear=function(){a.eve("raphael.clear",this);for(var t=this.canvas;t.firstChild;)t.removeChild(t.firstChild);this.bottom=this.top=null,(this.desc=z("desc")).appendChild(a._g.doc.createTextNode("Created with Raphaël "+a.version)),t.appendChild(this.desc),t.appendChild(this.defs=z("defs"))},a.prototype.remove=function(){for(var t in W("raphael.remove",this),this.canvas.parentNode&&this.canvas.parentNode.removeChild(this.canvas),this)this[t]=typeof this[t]=="function"?a._removedFactory(t):null};var c=a.st;for(var d in ve)ve[o](d)&&!c[o](d)&&(c[d]=function(t){return function(){var n=arguments;return this.forEach(function(s){s[t].apply(s,n)})}}(d))}}).apply(F,k))===void 0||(N.exports=p)},function(N,F,C){var k,p;k=[C(0)],(p=(function(a){if(!a||a.vml){var o="hasOwnProperty",g=String,v=parseFloat,R=Math,O=R.round,I=R.max,T=R.min,M=R.abs,G=/[, ]+/,W=a.eve,U=" ",V="",ae={M:"m",L:"l",C:"c",Z:"x",m:"t",l:"r",c:"v",z:"x"},de=/([clmz]),?([^clmz]*)/gi,be=/ progid:\S+Blur\([^\)]+\)/g,z=/-?[^,\s-]+/g,K="position:absolute;left:0;top:0;width:1px;height:1px;behavior:url(#default#VML)",j=21600,D={path:1,rect:1,image:1},ce={circle:1,ellipse:1},ne=function(n,s,u){var f=a.matrix();return f.rotate(-n,.5,.5),{dx:f.x(s,u),dy:f.y(s,u)}},xe=function(n,s,u,f,x,b){var B=n._,P=n.matrix,$=B.fillpos,X=n.node,te=X.style,ge=1,_e="",Ce=j/s,we=j/u;if(te.visibility="hidden",s&&u){if(X.coordsize=M(Ce)+U+M(we),te.rotation=b*(s*u<0?-1:1),b){var Se=ne(b,f,x);f=Se.dx,x=Se.dy}if(s<0&&(_e+="x"),u<0&&(_e+=" y")&&(ge=-1),te.flip=_e,X.coordorigin=f*-Ce+U+x*-we,$||B.fillsize){var Le=X.getElementsByTagName("fill");Le=Le&&Le[0],X.removeChild(Le),$&&(Se=ne(b,P.x($[0],$[1]),P.y($[0],$[1])),Le.position=Se.dx*ge+U+Se.dy*ge),B.fillsize&&(Le.size=B.fillsize[0]*M(s)+U+B.fillsize[1]*M(u)),X.appendChild(Le)}te.visibility="visible"}};a.toString=function(){return`Your browser doesn’t support SVG. Falling down to VML.
You are running Raphaël `+this.version};var me,Y=function(n,s,u){for(var f=g(s).toLowerCase().split("-"),x=u?"end":"start",b=f.length,B="classic",P="medium",$="medium";b--;)switch(f[b]){case"block":case"classic":case"oval":case"diamond":case"open":case"none":B=f[b];break;case"wide":case"narrow":$=f[b];break;case"long":case"short":P=f[b]}var X=n.node.getElementsByTagName("stroke")[0];X[x+"arrow"]=B,X[x+"arrowlength"]=P,X[x+"arrowwidth"]=$},he=function(n,s){n.attrs=n.attrs||{};var u=n.node,f=n.attrs,x=u.style,b=D[n.type]&&(s.x!=f.x||s.y!=f.y||s.width!=f.width||s.height!=f.height||s.cx!=f.cx||s.cy!=f.cy||s.rx!=f.rx||s.ry!=f.ry||s.r!=f.r),B=ce[n.type]&&(f.cx!=s.cx||f.cy!=s.cy||f.r!=s.r||f.rx!=s.rx||f.ry!=s.ry),P=n;for(var $ in s)s[o]($)&&(f[$]=s[$]);if(b&&(f.path=a._getPath[n.type](n),n._.dirty=1),s.href&&(u.href=s.href),s.title&&(u.title=s.title),s.target&&(u.target=s.target),s.cursor&&(x.cursor=s.cursor),"blur"in s&&n.blur(s.blur),(s.path&&n.type=="path"||b)&&(u.path=function(Oe){var Qe=/[ahqstv]/gi,ht=a._pathToAbsolute;if(g(Oe).match(Qe)&&(ht=a._path2curve),Qe=/[clmz]/g,ht==a._pathToAbsolute&&!g(Oe).match(Qe)){var Xe=g(Oe).replace(de,function(Kt,pt,mt){var et=[],Nt=pt.toLowerCase()=="m",st=ae[pt];return mt.replace(z,function(Mt){Nt&&et.length==2&&(st+=et+ae[pt=="m"?"l":"L"],et=[]),et.push(O(Mt*j))}),st+et});return Xe}var dt,We,_t=ht(Oe);Xe=[];for(var ft=0,St=_t.length;ft<St;ft++){dt=_t[ft],(We=_t[ft][0].toLowerCase())=="z"&&(We="x");for(var Ze=1,Ve=dt.length;Ze<Ve;Ze++)We+=O(dt[Ze]*j)+(Ze!=Ve-1?",":V);Xe.push(We)}return Xe.join(U)}(~g(f.path).toLowerCase().indexOf("r")?a._pathToAbsolute(f.path):f.path),n._.dirty=1,n.type=="image"&&(n._.fillpos=[f.x,f.y],n._.fillsize=[f.width,f.height],xe(n,1,1,0,0,0))),"transform"in s&&n.transform(s.transform),B){var X=+f.cx,te=+f.cy,ge=+f.rx||+f.r||0,_e=+f.ry||+f.r||0;u.path=a.format("ar{0},{1},{2},{3},{4},{1},{4},{1}x",O((X-ge)*j),O((te-_e)*j),O((X+ge)*j),O((te+_e)*j),O(X*j)),n._.dirty=1}if("clip-rect"in s){var Ce=g(s["clip-rect"]).split(G);if(Ce.length==4){Ce[2]=+Ce[2]+ +Ce[0],Ce[3]=+Ce[3]+ +Ce[1];var we=u.clipRect||a._g.doc.createElement("div"),Se=we.style;Se.clip=a.format("rect({1}px {2}px {3}px {0}px)",Ce),u.clipRect||(Se.position="absolute",Se.top=0,Se.left=0,Se.width=n.paper.width+"px",Se.height=n.paper.height+"px",u.parentNode.insertBefore(we,u),we.appendChild(u),u.clipRect=we)}s["clip-rect"]||u.clipRect&&(u.clipRect.style.clip="auto")}if(n.textpath){var Le=n.textpath.style;s.font&&(Le.font=s.font),s["font-family"]&&(Le.fontFamily='"'+s["font-family"].split(",")[0].replace(/^['"]+|['"]+$/g,V)+'"'),s["font-size"]&&(Le.fontSize=s["font-size"]),s["font-weight"]&&(Le.fontWeight=s["font-weight"]),s["font-style"]&&(Le.fontStyle=s["font-style"])}if("arrow-start"in s&&Y(P,s["arrow-start"]),"arrow-end"in s&&Y(P,s["arrow-end"],1),s.opacity!=null||s.fill!=null||s.src!=null||s.stroke!=null||s["stroke-width"]!=null||s["stroke-opacity"]!=null||s["fill-opacity"]!=null||s["stroke-dasharray"]!=null||s["stroke-miterlimit"]!=null||s["stroke-linejoin"]!=null||s["stroke-linecap"]!=null){var ye=u.getElementsByTagName("fill");if(!(ye=ye&&ye[0])&&(ye=me("fill")),n.type=="image"&&s.src&&(ye.src=s.src),s.fill&&(ye.on=!0),ye.on!=null&&s.fill!="none"&&s.fill!==null||(ye.on=!1),ye.on&&s.fill){var Re=g(s.fill).match(a._ISURL);if(Re){ye.parentNode==u&&u.removeChild(ye),ye.rotate=!0,ye.src=Re[1],ye.type="tile";var Be=n.getBBox(1);ye.position=Be.x+U+Be.y,n._.fillpos=[Be.x,Be.y],a._preload(Re[1],function(){n._.fillsize=[this.offsetWidth,this.offsetHeight]})}else ye.color=a.getRGB(s.fill).hex,ye.src=V,ye.type="solid",a.getRGB(s.fill).error&&(P.type in{circle:1,ellipse:1}||g(s.fill).charAt()!="r")&&fe(P,s.fill,ye)&&(f.fill="none",f.gradient=s.fill,ye.rotate=!1)}if("fill-opacity"in s||"opacity"in s){var qe=((+f["fill-opacity"]+1||2)-1)*((+f.opacity+1||2)-1)*((+a.getRGB(s.fill).o+1||2)-1);qe=T(I(qe,0),1),ye.opacity=qe,ye.src&&(ye.color="none")}u.appendChild(ye);var Te=u.getElementsByTagName("stroke")&&u.getElementsByTagName("stroke")[0],Me=!1;!Te&&(Me=Te=me("stroke")),(s.stroke&&s.stroke!="none"||s["stroke-width"]||s["stroke-opacity"]!=null||s["stroke-dasharray"]||s["stroke-miterlimit"]||s["stroke-linejoin"]||s["stroke-linecap"])&&(Te.on=!0),(s.stroke=="none"||s.stroke===null||Te.on==null||s.stroke==0||s["stroke-width"]==0)&&(Te.on=!1);var De=a.getRGB(s.stroke);Te.on&&s.stroke&&(Te.color=De.hex),qe=((+f["stroke-opacity"]+1||2)-1)*((+f.opacity+1||2)-1)*((+De.o+1||2)-1);var ze=.75*(v(s["stroke-width"])||1);if(qe=T(I(qe,0),1),s["stroke-width"]==null&&(ze=f["stroke-width"]),s["stroke-width"]&&(Te.weight=ze),ze&&ze<1&&(qe*=ze)&&(Te.weight=1),Te.opacity=qe,s["stroke-linejoin"]&&(Te.joinstyle=s["stroke-linejoin"]||"miter"),Te.miterlimit=s["stroke-miterlimit"]||8,s["stroke-linecap"]&&(Te.endcap=s["stroke-linecap"]=="butt"?"flat":s["stroke-linecap"]=="square"?"square":"round"),"stroke-dasharray"in s){var rt={"-":"shortdash",".":"shortdot","-.":"shortdashdot","-..":"shortdashdotdot",". ":"dot","- ":"dash","--":"longdash","- .":"dashdot","--.":"longdashdot","--..":"longdashdotdot"};Te.dashstyle=rt[o](s["stroke-dasharray"])?rt[s["stroke-dasharray"]]:V}Me&&u.appendChild(Te)}if(P.type=="text"){P.paper.canvas.style.display=V;var He=P.paper.span,je=f.font&&f.font.match(/\d+(?:\.\d*)?(?=px)/);x=He.style,f.font&&(x.font=f.font),f["font-family"]&&(x.fontFamily=f["font-family"]),f["font-weight"]&&(x.fontWeight=f["font-weight"]),f["font-style"]&&(x.fontStyle=f["font-style"]),je=v(f["font-size"]||je&&je[0])||10,x.fontSize=100*je+"px",P.textpath.string&&(He.innerHTML=g(P.textpath.string).replace(/</g,"&#60;").replace(/&/g,"&#38;").replace(/\n/g,"<br>"));var ct=He.getBoundingClientRect();P.W=f.w=(ct.right-ct.left)/100,P.H=f.h=(ct.bottom-ct.top)/100,P.X=f.x,P.Y=f.y+P.H/2,("x"in s||"y"in s)&&(P.path.v=a.format("m{0},{1}l{2},{1}",O(f.x*j),O(f.y*j),O(f.x*j)+1));for(var kt=["x","y","text","font","font-family","font-weight","font-style","font-size"],ut=0,Tt=kt.length;ut<Tt;ut++)if(kt[ut]in s){P._.dirty=1;break}switch(f["text-anchor"]){case"start":P.textpath.style["v-text-align"]="left",P.bbx=P.W/2;break;case"end":P.textpath.style["v-text-align"]="right",P.bbx=-P.W/2;break;default:P.textpath.style["v-text-align"]="center",P.bbx=0}P.textpath.style["v-text-kern"]=!0}},fe=function(n,s,u){n.attrs=n.attrs||{},n.attrs;var f=Math.pow,x="linear",b=".5 .5";if(n.attrs.gradient=s,s=(s=g(s).replace(a._radial_gradient,function(ge,_e,Ce){return x="radial",_e&&Ce&&(_e=v(_e),Ce=v(Ce),f(_e-.5,2)+f(Ce-.5,2)>.25&&(Ce=R.sqrt(.25-f(_e-.5,2))*(2*(Ce>.5)-1)+.5),b=_e+U+Ce),V})).split(/\s*\-\s*/),x=="linear"){var B=s.shift();if(B=-v(B),isNaN(B))return null}var P=a._parseDots(s);if(!P)return null;if(n=n.shape||n.node,P.length){n.removeChild(u),u.on=!0,u.method="none",u.color=P[0].color,u.color2=P[P.length-1].color;for(var $=[],X=0,te=P.length;X<te;X++)P[X].offset&&$.push(P[X].offset+U+P[X].color);u.colors=$.length?$.join():"0% "+u.color,x=="radial"?(u.type="gradientTitle",u.focus="100%",u.focussize="0 0",u.focusposition=b,u.angle=0):(u.type="gradient",u.angle=(270-B)%360),n.appendChild(u)}return 1},ve=function(n,s){this[0]=this.node=n,n.raphael=!0,this.id=a._oid++,n.raphaelid=this.id,this.X=0,this.Y=0,this.attrs={},this.paper=s,this.matrix=a.matrix(),this._={transform:[],sx:1,sy:1,dx:0,dy:0,deg:0,dirty:1,dirtyT:1},!s.bottom&&(s.bottom=this),this.prev=s.top,s.top&&(s.top.next=this),s.top=this,this.next=null},c=a.el;ve.prototype=c,c.constructor=ve,c.transform=function(n){if(n==null)return this._.transform;var s,u=this.paper._viewBoxShift,f=u?"s"+[u.scale,u.scale]+"-1-1t"+[u.dx,u.dy]:V;u&&(s=n=g(n).replace(/\.{3}|\u2026/g,this._.transform||V)),a._extractTransform(this,f+n);var x,b=this.matrix.clone(),B=this.skew,P=this.node,$=~g(this.attrs.fill).indexOf("-"),X=!g(this.attrs.fill).indexOf("url(");if(b.translate(1,1),X||$||this.type=="image")if(B.matrix="1 0 0 1",B.offset="0 0",x=b.split(),$&&x.noRotation||!x.isSimple){P.style.filter=b.toFilter();var te=this.getBBox(),ge=this.getBBox(1),_e=te.x-ge.x,Ce=te.y-ge.y;P.coordorigin=_e*-j+U+Ce*-j,xe(this,1,1,_e,Ce,0)}else P.style.filter=V,xe(this,x.scalex,x.scaley,x.dx,x.dy,x.rotate);else P.style.filter=V,B.matrix=g(b),B.offset=b.offset();return s!==null&&(this._.transform=s,a._extractTransform(this,s)),this},c.rotate=function(n,s,u){if(this.removed)return this;if(n!=null){if((n=g(n).split(G)).length-1&&(s=v(n[1]),u=v(n[2])),n=v(n[0]),u==null&&(s=u),s==null||u==null){var f=this.getBBox(1);s=f.x+f.width/2,u=f.y+f.height/2}return this._.dirtyT=1,this.transform(this._.transform.concat([["r",n,s,u]])),this}},c.translate=function(n,s){return this.removed?this:((n=g(n).split(G)).length-1&&(s=v(n[1])),n=v(n[0])||0,s=+s||0,this._.bbox&&(this._.bbox.x+=n,this._.bbox.y+=s),this.transform(this._.transform.concat([["t",n,s]])),this)},c.scale=function(n,s,u,f){if(this.removed)return this;if((n=g(n).split(G)).length-1&&(s=v(n[1]),u=v(n[2]),f=v(n[3]),isNaN(u)&&(u=null),isNaN(f)&&(f=null)),n=v(n[0]),s==null&&(s=n),f==null&&(u=f),u==null||f==null)var x=this.getBBox(1);return u=u??x.x+x.width/2,f=f??x.y+x.height/2,this.transform(this._.transform.concat([["s",n,s,u,f]])),this._.dirtyT=1,this},c.hide=function(){return!this.removed&&(this.node.style.display="none"),this},c.show=function(){return!this.removed&&(this.node.style.display=V),this},c.auxGetBBox=a.el.getBBox,c.getBBox=function(){var n=this.auxGetBBox();if(this.paper&&this.paper._viewBoxShift){var s={},u=1/this.paper._viewBoxShift.scale;return s.x=n.x-this.paper._viewBoxShift.dx,s.x*=u,s.y=n.y-this.paper._viewBoxShift.dy,s.y*=u,s.width=n.width*u,s.height=n.height*u,s.x2=s.x+s.width,s.y2=s.y+s.height,s}return n},c._getBBox=function(){return this.removed?{}:{x:this.X+(this.bbx||0)-this.W/2,y:this.Y-this.H,width:this.W,height:this.H}},c.remove=function(){if(!this.removed&&this.node.parentNode){for(var n in this.paper.__set__&&this.paper.__set__.exclude(this),a.eve.unbind("raphael.*.*."+this.id),a._tear(this,this.paper),this.node.parentNode.removeChild(this.node),this.shape&&this.shape.parentNode.removeChild(this.shape),this)this[n]=typeof this[n]=="function"?a._removedFactory(n):null;this.removed=!0}},c.attr=function(n,s){if(this.removed)return this;if(n==null){var u={};for(var f in this.attrs)this.attrs[o](f)&&(u[f]=this.attrs[f]);return u.gradient&&u.fill=="none"&&(u.fill=u.gradient)&&delete u.gradient,u.transform=this._.transform,u}if(s==null&&a.is(n,"string")){if(n=="fill"&&this.attrs.fill=="none"&&this.attrs.gradient)return this.attrs.gradient;for(var x=n.split(G),b={},B=0,P=x.length;B<P;B++)(n=x[B])in this.attrs?b[n]=this.attrs[n]:a.is(this.paper.customAttributes[n],"function")?b[n]=this.paper.customAttributes[n].def:b[n]=a._availableAttrs[n];return P-1?b:b[x[0]]}if(this.attrs&&s==null&&a.is(n,"array")){for(b={},B=0,P=n.length;B<P;B++)b[n[B]]=this.attr(n[B]);return b}var $;for(var X in s!=null&&(($={})[n]=s),s==null&&a.is(n,"object")&&($=n),$)W("raphael.attr."+X+"."+this.id,this,$[X]);if($){for(X in this.paper.customAttributes)if(this.paper.customAttributes[o](X)&&$[o](X)&&a.is(this.paper.customAttributes[X],"function")){var te=this.paper.customAttributes[X].apply(this,[].concat($[X]));for(var ge in this.attrs[X]=$[X],te)te[o](ge)&&($[ge]=te[ge])}$.text&&this.type=="text"&&(this.textpath.string=$.text),he(this,$)}return this},c.toFront=function(){return!this.removed&&this.node.parentNode.appendChild(this.node),this.paper&&this.paper.top!=this&&a._tofront(this,this.paper),this},c.toBack=function(){return this.removed?this:(this.node.parentNode.firstChild!=this.node&&(this.node.parentNode.insertBefore(this.node,this.node.parentNode.firstChild),a._toback(this,this.paper)),this)},c.insertAfter=function(n){return this.removed?this:(n.constructor==a.st.constructor&&(n=n[n.length-1]),n.node.nextSibling?n.node.parentNode.insertBefore(this.node,n.node.nextSibling):n.node.parentNode.appendChild(this.node),a._insertafter(this,n,this.paper),this)},c.insertBefore=function(n){return this.removed?this:(n.constructor==a.st.constructor&&(n=n[0]),n.node.parentNode.insertBefore(this.node,n.node),a._insertbefore(this,n,this.paper),this)},c.blur=function(n){var s=this.node.runtimeStyle,u=s.filter;return u=u.replace(be,V),+n!=0?(this.attrs.blur=n,s.filter=u+U+" progid:DXImageTransform.Microsoft.Blur(pixelradius="+(+n||1.5)+")",s.margin=a.format("-{0}px 0 0 -{0}px",O(+n||1.5))):(s.filter=u,s.margin=0,delete this.attrs.blur),this},a._engine.path=function(n,s){var u=me("shape");u.style.cssText=K,u.coordsize=j+U+j,u.coordorigin=s.coordorigin;var f=new ve(u,s),x={fill:"none",stroke:"#000"};n&&(x.path=n),f.type="path",f.path=[],f.Path=V,he(f,x),s.canvas&&s.canvas.appendChild(u);var b=me("skew");return b.on=!0,u.appendChild(b),f.skew=b,f.transform(V),f},a._engine.rect=function(n,s,u,f,x,b){var B=a._rectPath(s,u,f,x,b),P=n.path(B),$=P.attrs;return P.X=$.x=s,P.Y=$.y=u,P.W=$.width=f,P.H=$.height=x,$.r=b,$.path=B,P.type="rect",P},a._engine.ellipse=function(n,s,u,f,x){var b=n.path();return b.attrs,b.X=s-f,b.Y=u-x,b.W=2*f,b.H=2*x,b.type="ellipse",he(b,{cx:s,cy:u,rx:f,ry:x}),b},a._engine.circle=function(n,s,u,f){var x=n.path();return x.attrs,x.X=s-f,x.Y=u-f,x.W=x.H=2*f,x.type="circle",he(x,{cx:s,cy:u,r:f}),x},a._engine.image=function(n,s,u,f,x,b){var B=a._rectPath(u,f,x,b),P=n.path(B).attr({stroke:"none"}),$=P.attrs,X=P.node,te=X.getElementsByTagName("fill")[0];return $.src=s,P.X=$.x=u,P.Y=$.y=f,P.W=$.width=x,P.H=$.height=b,$.path=B,P.type="image",te.parentNode==X&&X.removeChild(te),te.rotate=!0,te.src=s,te.type="tile",P._.fillpos=[u,f],P._.fillsize=[x,b],X.appendChild(te),xe(P,1,1,0,0,0),P},a._engine.text=function(n,s,u,f){var x=me("shape"),b=me("path"),B=me("textpath");s=s||0,u=u||0,f=f||"",b.v=a.format("m{0},{1}l{2},{1}",O(s*j),O(u*j),O(s*j)+1),b.textpathok=!0,B.string=g(f),B.on=!0,x.style.cssText=K,x.coordsize=j+U+j,x.coordorigin="0 0";var P=new ve(x,n),$={fill:"#000",stroke:"none",font:a._availableAttrs.font,text:f};P.shape=x,P.path=b,P.textpath=B,P.type="text",P.attrs.text=g(f),P.attrs.x=s,P.attrs.y=u,P.attrs.w=1,P.attrs.h=1,he(P,$),x.appendChild(B),x.appendChild(b),n.canvas.appendChild(x);var X=me("skew");return X.on=!0,x.appendChild(X),P.skew=X,P.transform(V),P},a._engine.setSize=function(n,s){var u=this.canvas.style;return this.width=n,this.height=s,n==+n&&(n+="px"),s==+s&&(s+="px"),u.width=n,u.height=s,u.clip="rect(0 "+n+" "+s+" 0)",this._viewBox&&a._engine.setViewBox.apply(this,this._viewBox),this},a._engine.setViewBox=function(n,s,u,f,x){a.eve("raphael.setViewBox",this,this._viewBox,[n,s,u,f,x]);var b,B,P=this.getSize(),$=P.width,X=P.height;return x&&(u*(b=X/f)<$&&(n-=($-u*b)/2/b),f*(B=$/u)<X&&(s-=(X-f*B)/2/B)),this._viewBox=[n,s,u,f,!!x],this._viewBoxShift={dx:-n,dy:-s,scale:P},this.forEach(function(te){te.transform("...")}),this},a._engine.initWin=function(n){var s=n.document;s.styleSheets.length<31?s.createStyleSheet().addRule(".rvml","behavior:url(#default#VML)"):s.styleSheets[0].addRule(".rvml","behavior:url(#default#VML)");try{!s.namespaces.rvml&&s.namespaces.add("rvml","urn:schemas-microsoft-com:vml"),me=function(u){return s.createElement("<rvml:"+u+' class="rvml">')}}catch{me=function(f){return s.createElement("<"+f+' xmlns="urn:schemas-microsoft.com:vml" class="rvml">')}}},a._engine.initWin(a._g.win),a._engine.create=function(){var n=a._getContainer.apply(0,arguments),s=n.container,u=n.height,f=n.width,x=n.x,b=n.y;if(!s)throw new Error("VML container not found.");var B=new a._Paper,P=B.canvas=a._g.doc.createElement("div"),$=P.style;return x=x||0,b=b||0,f=f||512,u=u||342,B.width=f,B.height=u,f==+f&&(f+="px"),u==+u&&(u+="px"),B.coordsize=216e5+U+216e5,B.coordorigin="0 0",B.span=a._g.doc.createElement("span"),B.span.style.cssText="position:absolute;left:-9999em;top:-9999em;padding:0;margin:0;line-height:1;",P.appendChild(B.span),$.cssText=a.format("top:0;left:0;width:{0};height:{1};display:inline-block;position:relative;clip:rect(0 {0} {1} 0);overflow:hidden",f,u),s==1?(a._g.doc.body.appendChild(P),$.left=x+"px",$.top=b+"px",$.position="absolute"):s.firstChild?s.insertBefore(P,s.firstChild):s.appendChild(P),B.renderfix=function(){},B},a.prototype.clear=function(){a.eve("raphael.clear",this),this.canvas.innerHTML=V,this.span=a._g.doc.createElement("span"),this.span.style.cssText="position:absolute;left:-9999em;top:-9999em;padding:0;margin:0;line-height:1;display:inline;",this.canvas.appendChild(this.span),this.bottom=this.top=null},a.prototype.remove=function(){for(var n in a.eve("raphael.remove",this),this.canvas.parentNode.removeChild(this.canvas),this)this[n]=typeof this[n]=="function"?a._removedFactory(n):null;return!0};var d=a.st;for(var t in c)c[o](t)&&!d[o](t)&&(d[t]=function(n){return function(){var s=arguments;return this.forEach(function(u){u[n].apply(u,s)})}}(t))}}).apply(F,k))===void 0||(N.exports=p)}])})})(Cn);var Nn=Cn.exports;const zt=wn(Nn);var q={};q.Common={nodeIdIncrement:0,activeNode:0,roundFloat:function(h,w){for(var N=0,F=1;N<w;)F*=10,N++;return Math.round(h*F)/F},apply:function(h,w){if(h&&typeof w=="object")for(var N in w)h[N]=w[N];return h},addRaphEventHandler:function(h,w,N,F){try{h[w](function(C,k){return function(p,a){var o=k;o.e=p,C(o)}}(N,F))}catch{}},isInteger:function(h){return!isNaN(parseInt(h))},isXMLSerializerAvailable:function(){return typeof XMLSerializer=="function"},createSvgEl:function(h,w){if(h=document.createElementNS("http://www.w3.org/2000/svg",h),w)for(var N in w)w.hasOwnProperty(N)&&h.setAttribute(N,String(w[N]));return h},createGradientEl:function(h,w,N){if(w.type!="radialGradient")return!1;var F=q.Common.createSvgEl("radialGradient",{id:h,gradientUnits:"userSpaceOnUse",cx:N[0],cy:N[1],r:N[2],fx:N[0],fy:N[1]});if(w.stop)for(var C=w.stop,k=0;k<C.length;k++){var p=C[k];p["@attributes"]?F.appendChild(q.Common.createSvgEl("stop",p["@attributes"])):(p._attributes&&delete p._attributes,p._children&&delete p._children,p.__proto__&&delete p.__proto__,F.appendChild(q.Common.createSvgEl("stop",p)))}return F},setCssStyle:function(h,w){var N=document.styleSheets[0];N.addRule?N.addRule(h,w):N.insertRule&&N.insertRule(h+" { "+w+" }",N.cssRules.length)}};q.PhyloCanvas=function(){var h,w,N,F,C;return function(k,p,a,o,g){if(this.getNewickObject=function(){return N},this.clear=function(){},this.scale=function(R){F.svg.scale(R)},this.getSvg=function(){return F},this.getPhylogram=function(){return h},this.getSvgSource=function(){if(zt.svg&&q.Common.isXMLSerializerAvailable()){var R=new XMLSerializer;return R.serializeToString(F.svg.canvas)}else return!1},typeof k=="object")if(k.xml){if(k.fileSource)var v=k.xml;else var v=wt.textToXML(k.xml);v=wt.xmlToJSON(v),C=new q.PhyloCanvas.PhyloxmlParse(v)}else if(k.phyloxml){if(k.fileSource)var v=k.phyloxml;else var v=wt.textToXML(k.phyloxml);v=wt.xmlToJSON(v),C=new q.PhyloCanvas.PhyloxmlParse(v)}else if(k.nexml){if(k.fileSource)var v=k.nexml;else var v=wt.textToXML(k.nexml);v=wt.xmlToJSON(v),C=new q.PhyloCanvas.NexmlParse(v,k)}else k.json?C=new q.PhyloCanvas.PhyloxmlParse(k.json):k.newick?C=new q.PhyloCanvas.NewickParse(k.newick):k.nexmlJson?C=new q.PhyloCanvas.NexmlJsonParse(k):alert("Please set the format of input data");else C=new q.PhyloCanvas.NewickParse(k);w=p,F=new q.PhyloCanvas.Render.SVG(w,a,o),g=="circular"?h=new q.PhyloCanvas.Render.CircularPhylogram(F,C):h=new q.PhyloCanvas.Render.Phylogram(F,C)}}();q.PhyloCanvas.prototype={};q.PhyloCanvas.Node=function(){return function(h,w){this.id=q.Common.nodeIdIncrement+=1,this.level=0,this.len=0,this.newickLen=0,this.name="",this.type="",this.chart={},this.img=[],h&&q.Common.apply(this,h),this._countAllChildren=!1,this._countImmediateChildren=!1,this._midBranchPosition=!1,this.children=new Array,w&&w.children.push(this)}}();q.PhyloCanvas.Node.prototype={getCountAllChildren:function(){if(this._countAllChildren!==!1)return this._countAllChildren;var h=0;for(var w in this.children)if(q.Common.isInteger(w)){var N=this.children[w];N.children&&N.children.length>0?h+=N.getCountAllChildren():h++}return this._countAllChildren=h,h},getCountImmediateChildren:function(){if(this._countImmediateChildren!==!1)return this._countImmediateChildren;var h=0;for(var w in this.children){var N=this.children[w];h+=N.length}return this._countImmediateChildren=h,h},getMidbranchPosition:function(h){if(this._midBranchPosition!==!1)return this._midBranchPosition;for(var w=[0,0],N=0;N<this.children.length;N++){var F=this.children[N];F.children&&F.children.length>0?N==0&&h?(w[0]=F.getMidbranchPosition(!0),w[1]+=F.getCountAllChildren()-1):N==0?(w[0]=F.getMidbranchPosition(),w[1]+=F.getCountAllChildren()):N==this.children.length-1?w[1]+=F.getMidbranchPosition():w[1]+=F.getCountAllChildren():N==0&&h?w[0]=0:N==0?(w[0]=1,w[1]+=1):(N==this.children.length-1,w[1]+=1)}return this._midBranchPosition=w[1]>=w[0]?(w[1]+w[0])/2:w[0],this._midBranchPosition}};q.PhyloCanvas.NewickParse=function(){var h,w,N,F=0,C=0,k,p,a=function(I){for(var T=new q.PhyloCanvas.Node;w!==")"&&w!==",";)w===":"?(R(),T.len=q.Common.roundFloat(g(),4),T.len==0&&(T.len=1e-4)):w==="'"||w==='"'?(T.type="label",T.name=v(w)):(T.type="label",T.name=g());return T.level=I.level+1,T},o=function(I){var T=new q.PhyloCanvas.Node;for(I&&(T.level=I.level+1);w!==")";)R(),w==="("?T.children.push(o(T)):T.children.push(a(T));return R(),w!==":"&&w!==")"&&w!==","&&w!==";"&&(T.type="label",T.name=g()),w===":"&&(R(),T.len=q.Common.roundFloat(g(),4),T.len==0&&(T.len=1e-4),T.type="stem"),T},g=function(){for(var I="";w!==":"&&w!==")"&&w!==","&&w!==";";)I+=w,R();return I},v=function(I){for(var T="";w!==I;)T+=w,R();return T},R=function(){return w=h.charAt(N),N+=1,w},O=function(I,T){if(I.children&&I.children.length)for(var M=0;M<I.children.length;M++){var G=I.children[M];G.len===0&&(G.len=1),G.newickLen=q.Common.roundFloat(G.len+I.newickLen,4),G.level>F&&(F=G.level),G.newickLen>C&&(C=G.newickLen),G.children.length>0&&O(G)}return I};return function(I){this.getRoot=function(){return k},this.getLevels=function(){return F},this.getNewickLen=function(){return C},this.getValidate=function(){return p},F=0,C=0,h=I,N=0,R(),k=o(),k=O(k)}}();q.PhyloCanvas.NewickParse.prototype={};q.PhyloCanvas.PhyloxmlParse=function(){var h=0,w=0,N,F,C=function(a,o){var g=new q.PhyloCanvas.Node;if(o&&(g.level=o.level+1),a.clade&&a.clade.length)for(var v=0;v<a.clade.length;v++){var R=a.clade[v];g.children.push(C(R,g))}if(a.branch_length&&(typeof a.branch_length=="object"&&(a.branch_length=a.branch_length[0].Text),g.len=q.Common.roundFloat(a.branch_length,4),g.len==0&&(g.len=1e-4)),a.color?(g.red=a.color[0].red[0].Text,g.green=a.color[0].green[0].Text,g.blue=a.color[0].blue[0].Text):(g.red=0,g.green=0,g.blue=0),a.property&&a.property[0].applies_to=="node"&&a.property[0].ref=="style:font_color"&&(g.font_color_hex=a.property[0].Text),a.name?(g.type="label",g.name=a.name[0].Text,a.name[0]&&a.name[0].style&&(g.style=a.name[0].style),a.name[0]&&a.name[0].bgStyle&&(g.bgStyle=a.name[0].bgStyle)):a.confidence&&(g.name=a.confidence[0].Text),a.sequence&&a.sequence[0]&&a.sequence[0].name&&a.sequence[0].name[0]&&a.sequence[0].name[0].Text&&(g.sequenceName=a.sequence[0].name[0].Text),a.taxonomy&&a.taxonomy[0]&&(a.taxonomy[0].scientific_name&&a.taxonomy[0].scientific_name[0]&&a.taxonomy[0].scientific_name[0].Text&&(g.taxonomyScientificName=a.taxonomy[0].scientific_name[0].Text),a.taxonomy[0].common_name&&a.taxonomy[0].common_name[0]&&a.taxonomy[0].common_name[0].Text&&(g.taxonomyCommonName=a.taxonomy[0].common_name[0].Text)),a.sequence&&a.sequence[0]&&a.sequence[0].accession&&a.sequence[0].accession[0]&&a.sequence[0].accession[0].Text&&(g.sequenceAccession=a.sequence[0].accession[0].Text),a.point&&(g.LatLong=[a.point[0].lat[0].Text,a.point[0].long[0].Text]),g.name||(g.sequenceName?g.name=g.sequenceName:g.taxonomyScientificName?g.name=g.taxonomyScientificName:g.taxonomyCommonName?g.name=g.taxonomyCommonName:g.sequenceAccession&&(g.name=g.sequenceAccession),g.name&&(g.type="label")),a.annotation&&(a.annotation[0]&&a.annotation[0].desc&&a.annotation[0].desc[0]&&a.annotation[0].desc[0].Text&&(g.description=a.annotation[0].desc[0].Text),a.annotation[0]&&a.annotation[0].uri&&a.annotation[0].uri[0]&&a.annotation[0].uri[0].Text&&(g.uri=a.annotation[0].uri[0].Text),a.annotation[0]&&a.annotation[0].img))for(var v in a.annotation[0].img)q.Common.isInteger(v)&&(g.img[v]=a.annotation[0].img[v].Text);if(a.chart&&a.chart[0])for(var v in a.chart[0])v!="Text"&&v!="_children"&&(g.chart[v]=a.chart[0][v][0].Text);return g&&g.level>1&&(g.len||(F="Error. Please include Branch Lengths - we only draw rooted phylogenetic trees.")),g},k=function(a,o){if(a.children&&a.children.length)for(var g=0;g<a.children.length;g++){var v=a.children[g];v.newickLen=Math.round((v.len+a.newickLen)*1e4)/1e4,v.level>h&&(h=v.level),v.newickLen>w&&(w=v.newickLen),v.children.length>0&&k(v)}return a},p=function(a,o){for(var g in a)g!="_children"&&g!="Text"&&(g=="rectangular"||g=="circular"?p(a[g][0],g):(q.PhyloCanvas.Render.Parameters[g]||(q.PhyloCanvas.Render.Parameters[g]={}),q.PhyloCanvas.Render.Parameters.set(g,a[g][0].Text,o)))};return function(a){if(this.getRoot=function(){return N},this.getLevels=function(){return h},this.getNewickLen=function(){return w},this.getValidate=function(){return F},a.phylogeny&&a.phylogeny[0]&&a.phylogeny[0].clade&&(N=C(a.phylogeny[0].clade[0])),a.phylogeny&&a.phylogeny[0]&&a.phylogeny[0].render&&a.phylogeny[0].render[0]){var o=a.phylogeny[0].render[0];if(o&&o.styles){var g=o.styles[0];for(var v in g)if(v!="_children"&&v!="Text")if(g[v][0].type&&g[v][0].type=="radialGradient"&&zt.svg)g[v][0].name=v,q.PhyloCanvas.Render.Style[v]=g[v][0],q.PhyloCanvas.Render.Style.jsphylosvgGradientList||(q.PhyloCanvas.Render.Style.jsphylosvgGradientList=[]),q.PhyloCanvas.Render.Style.jsphylosvgGradientList.push(v);else{q.PhyloCanvas.Render.Style[v]||(q.PhyloCanvas.Render.Style[v]={});for(var R in g[v][0])R!="_attributes"&&R!="_children"&&R!="type"&&(q.PhyloCanvas.Render.Style[v][R.replace("_","-")]=g[v][0][R])}}if(o&&o.parameters&&p(o.parameters[0]),o&&o.charts){var O=o.charts[0];for(var v in O)if(v!="_children"&&v!="Text")for(var R in O[v])O[v][R].type=="binary"?(O[v][R].chart=v,q.PhyloCanvas.Render.Parameters.binaryCharts.push(O[v][R])):O[v][R].type=="integratedBinary"?(O[v][R].chart=v,q.PhyloCanvas.Render.Parameters.integratedBinaryCharts.push(O[v][R])):O[v][R].type=="bar"&&(O[v][R].chart=v,q.PhyloCanvas.Render.Parameters.barCharts.length==1&&q.PhyloCanvas.Render.Parameters.barCharts.shift(),q.PhyloCanvas.Render.Parameters.barCharts.push(O[v][R]))}}N=k(N)}}();q.PhyloCanvas.PhyloxmlParse.prototype={};q.PhyloCanvas.NexmlParse=function(){var h=0,w=0,N,F,C,k,p=function(o,g,v){var R=new q.PhyloCanvas.Node;v&&(R.level=v.level+1);for(var O=0;O<C.length;O++)if(C[O].source==o.id)for(var I=0;I<k.length;I++)C[O].target==k[I].id&&R.children.push(p(k[I],C[O].length,R));if(R&&R.level>0&&!R.len&&(R.len=1),g&&(R.len=q.Common.roundFloat(g,4),R.len==0&&(R.len=1e-4)),o.label&&(R.type="label",R.name=o.label,o.style&&(R.style=o.style)),o.color){const T=o.color.replace(/[a-z%\s\(\)]/g,"").split(",");R.red=T[0],R.green=T[1],R.blue=T[2]}else{const T=q.PhyloCanvas.Render.Style.line.stroke.replace(/[a-z%\s\(\)]/g,"").split(",");R.red=T[0],R.green=T[1],R.blue=T[2]}return R},a=function(o,g){if(o.children&&o.children.length)for(var v=0;v<o.children.length;v++){var R=o.children[v];R.newickLen=Math.round((R.len+o.newickLen)*1e4)/1e4,R.level>h&&(h=R.level),R.newickLen>w&&(w=R.newickLen),R.children.length>0&&a(R)}return o};return function(o,g){this.getRoot=function(){return N},this.getLevels=function(){return h},this.getNewickLen=function(){return w},this.getValidate=function(){return F},g.tree&&o.trees[0]&&o.trees[0].tree[g.tree-1]?(C=o.trees[0].tree[g.tree-1].edge,k=o.trees[0].tree[g.tree-1].node):(C=o.trees[0].tree[0].edge,k=o.trees[0].tree[0].node);for(var v=0;v<k.length;v++){var R=0;if(k[v].root&&k[v].root=="true"){N=k[v];break}for(var O=0;O<C.length;O++)C[O].target==k[v].id&&R++;if(R==0){N=k[v];break}}N?(N=p(N),N=a(N)):F="Error. Currently, only rooted NeXML trees are supported."}}();q.PhyloCanvas.NexmlParse.prototype={};q.PhyloCanvas.NexmlJsonParse=function(){var h=0,w=0,N,F,C=[],k=[],p=function(g,v,R){var O=new q.PhyloCanvas.Node;R&&(O.level=R.level+1);for(var I=0;I<C.length;I++)if(C[I].source==g.id)for(var T=0;T<k.length;T++)C[I].target==k[T].id&&O.children.push(p(k[T],C[I].length,O));return v&&(O.len=q.Common.roundFloat(v,4),O.len==0&&(O.len=1e-4)),g.label&&(O.type="label",O.name=g.label,g.accession&&(O.accession=g.accession),g.style&&(O.style=g.style),g.bgStyle&&(O.bgStyle=g.bgStyle)),g.chart&&(O.chart=g.chart),O&&O.level>1&&(O.len||(F="Error. Please include Branch Lengths - we only draw rooted phylogenetic trees.")),O},a=function(g,v){if(g.children&&g.children.length)for(var R=0;R<g.children.length;R++){var O=g.children[R];O.newickLen=Math.round((O.len+g.newickLen)*1e4)/1e4,O.level>h&&(h=O.level),O.newickLen>w&&(w=O.newickLen),O.children.length>0&&a(O)}return g},o=function(g,v){for(var R in g)R!="_children"&&R!="Text"&&(R=="rectangular"||R=="circular"?o(g[R],R):(q.PhyloCanvas.Render.Parameters[R]||(q.PhyloCanvas.Render.Parameters[R]={}),q.PhyloCanvas.Render.Parameters.set(R,g[R],v)))};return function(g){this.getRoot=function(){return N},this.getLevels=function(){return h},this.getNewickLen=function(){return w},this.getValidate=function(){return F};var v=g.nexmlJson.nexml,R=v.render;if(R&&R.styles){var O=R.styles;for(var I in O)if(I!="_children"&&I!="Text")if(O[I]["@attributes"].type&&O[I]["@attributes"].type=="radialGradient"&&zt.svg)O[I].name=I,O[I].type=O[I]["@attributes"].type,q.PhyloCanvas.Render.Style[I]=O[I],q.PhyloCanvas.Render.Style.jsphylosvgGradientList||(q.PhyloCanvas.Render.Style.jsphylosvgGradientList=[]),q.PhyloCanvas.Render.Style.jsphylosvgGradientList.push(I);else{q.PhyloCanvas.Render.Style[I]||(q.PhyloCanvas.Render.Style[I]={});for(var T in O[I]["@attributes"])T!="_attributes"&&T!="_children"&&T!="type"&&(q.PhyloCanvas.Render.Style[I][T.replace("_","-")]=O[I]["@attributes"][T])}}if(R&&R.parameters&&o(R.parameters),R&&R.charts){var M=R.charts;for(var I in M)M[I]["@attributes"].chart=I,M[I]["@attributes"].type=="binary"?q.PhyloCanvas.Render.Parameters.binaryCharts.push(M[I]["@attributes"]):M[I]["@attributes"].type=="integratedBinary"?q.PhyloCanvas.Render.Parameters.integratedBinaryCharts.push(M[I]["@attributes"]):M[I]["@attributes"].type=="bar"&&q.PhyloCanvas.Render.Parameters.barCharts.push(M[I]["@attributes"])}if(g.tree&&v.trees[0]&&v.trees[0].tree[g.tree-1])C=v.trees[0].tree[g.tree-1].edge,k=v.trees[0].tree[g.tree-1].node;else{for(var I=0;I<v.trees.tree.edge.length;I++)C.push(v.trees.tree.edge[I]["@attributes"]);for(var I=0;I<v.trees.tree.node.length;I++){var G=v.trees.tree.node[I]["@attributes"];G.label&&(G.chart=v.trees.tree.node[I].chart),k.push(G)}}for(var I=0;I<k.length;I++)k[I].root&&k[I].root=="true"&&(N=k[I]);N?(N=p(N),N=a(N)):F="Error. Currently, only rooted NeXML trees are supported."}}();q.PhyloCanvas.NexmlParse.prototype={};q.PhyloCanvas.Render={};q.PhyloCanvas.Render.Style={line:{stroke:"rgb(0,0,0)","stroke-width":1},text:{"font-family":"Verdana","font-size":12,"text-anchor":"start"},path:{stroke:"rgb(0,0,0)","stroke-width":1},connectedDash:{stroke:"rgb(200,200,200)","stroke-dasharray":". "},textSecantBg:{fill:"#EEE",stroke:"#DDD"},highlightedEdgeCircle:{fill:"black",stroke:"black"},barChart:{fill:"#003300",stroke:"#DDD"},getStyle:function(h,w){return this[h]?this[h]:this[w]}};q.PhyloCanvas.Render.Parameters={jsOverride:0,Rectangular:{bufferX:200,paddingX:10,paddingY:20,bufferInnerLabels:10,bufferOuterLabels:5,minHeightBetweenLeaves:10,alignPadding:0,alignRight:!1,showScaleBar:!1},Circular:{bufferRadius:.33,bufferAngle:20,initStartAngle:160,innerCircleRadius:0,minHeightBetweenLeaves:5,bufferInnerLabels:2,bufferOuterLabels:5},binaryCharts:[],integratedBinaryCharts:[],barCharts:[],binaryChartBufferInner:5,binaryChartBufferSiblings:.01,binaryChartThickness:15,binaryChartDisjointed:!1,barChartBufferInner:3,barChartHeight:50,barChartWidth:.5,set:function(h,w,N){this.jsOverride||(N?N=="circular"?this.Circular[h]=parseFloat(w):N=="rectangular"&&(this.Rectangular[h]=parseFloat(w)):this[h]=parseFloat(w))}};q.PhyloCanvas.Render.Line=function(){return function(h,w,N,F,C,k,p,a){this.type="line",this.attr=q.PhyloCanvas.Render.Style.line,this.attr.stroke=["rgb(",C,",",k,",",p,")"].join(""),this.x1=h,this.x2=w,this.y1=N,this.y2=F,a&&(q.Common.apply(this,a),a.attr&&(this.attr=a.attr))}}();q.PhyloCanvas.Render.Text=function(){return function(h,w,N,F){this.type="text",this.attr=q.PhyloCanvas.Render.Style.text,this.x=h,this.y=w,this.text=N,F&&(q.Common.apply(this,F),F.attr&&(this.attr=F.attr))}}();q.PhyloCanvas.Render.Path=function(){return q.PhyloCanvas.Render.Style.path,function(h,w){this.type="path",this.attr=q.PhyloCanvas.Render.Style.path,this.path=h,w&&(q.Common.apply(this,w),w.attr&&(this.attr=w.attr))}}();q.PhyloCanvas.Render.Circle=function(){return function(h,w,N,F){this.type="circle",this.x=h,this.y=w,this.radius=N,F&&(q.Common.apply(this,F),F.attr&&(this.attr=F.attr))}}();q.PhyloCanvas.Render.SVG=function(){return function(h,w,N){this.canvasSize=[w,N],this.svg=zt(h,this.canvasSize[0],this.canvasSize[1])}}();q.PhyloCanvas.Render.SVG.prototype={render:function(){for(var h=this.phylogramObject.getDrawInstructs(),w=0;w<h.length;w++)if(h[w].type=="line")this.svg.path(["M",h[w].x1,h[w].y1,"L",h[w].x2,h[w].y2]).attr(q.PhyloCanvas.Render.Style.line);else if(h[w].type=="path")this.svg.path(h[w].path).attr(h[w].attr);else if(h[w].type=="circle")this.svg.circle(h[w].x,h[w].y,h[w].radius).attr({stroke:"black",fill:"black"});else{var N=this.svg.text(h[w].x,h[w].y,h[w].text).attr(q.PhyloCanvas.Render.Style.text);h[w].attr&&N.attr(h[w].attr),h[w].rotate&&N.rotate(h[w].rotate);var F=N.getBBox();Math.sqrt(F.height*F.height+F.width*F.width)}},draw:function(h){var w,N;if(h.type=="line")w=this.svg.path(["M",h.x1,h.y1,"L",h.x2,h.y2]).attr(q.PhyloCanvas.Render.Style.line);else if(h.type=="path")w=this.svg.path(h.path).attr(h.attr);else if(h.type=="circle")w=this.svg.circle(h.x,h.y,h.radius).attr({stroke:"black",fill:"black"});else if(h.type=="text"){w=this.svg.text(h.x,h.y,h.text).attr(q.PhyloCanvas.Render.Style.text),h.attr&&w.attr(h.attr),h.rotate&&w.rotate(h.rotate);var F=w.getBBox();N=Math.sqrt(F.height*F.height+F.width*F.width)}return[w,N]}};q.PhyloCanvas.Render.Phylogram=function(){var h,w=q.PhyloCanvas.Render.Parameters.Rectangular,N,F,C,k,p,a,o=!0,g=0,v=0,R,O,I,T,M,G,W=[],U=function(z,K,j,D){return["M",z,K,"L",j,K,"L",j,D,"L",z,D,"Z"]},V=function(z,K){if(z.len&&o==!1&&z.children.length==0&&(g=q.Common.roundFloat(g+k,4)),z.children.length>0){var j=[],D,ce,ne,xe,me,Y,he;if(z.len&&(D=K,ce=K=q.Common.roundFloat(K+C*z.len,4),ne=g+z.getMidbranchPosition(o)*k,xe=ne,me=z.red,Y=z.green,he=z.blue,h.draw(new q.PhyloCanvas.Render.Line(D,ce,ne,xe,me,Y,he))),z.name){var fe={};if(fe=q.PhyloCanvas.Render.Style.getStyle("bootstrap","text"),z.font_color_hex?fe.fill=z.font_color_hex:fe.fill="#000000",z.uri&&(fe.href=z.uri),z.description&&(fe.title=z.description),z.level==0)var ve=g+z.getMidbranchPosition(o)*k;else var ve=xe;h.draw(new q.PhyloCanvas.Render.Text((ce||K)+5,ve,z.name,{attr:fe}))}if(z.children&&z.children.length)for(var c=0;c<z.children.length;c++){var d=z.children[c];j.push(V(d,K))}for(var t=[],c=0;c<j.length;c++)j[c][0]&&t.push(j[c][0]),j[c][1]&&t.push(j[c][1]);for(var n=Math.min.apply(null,t),s=Math.max.apply(null,t),u=(n+s)/2,f="",x="",b="",B=0,c=0;c<z.children.length;++c){var P=z.children[c];if(c==0)f=P.red,x=P.green,b=P.blue;else if(f==P.red&&x==P.green&&b==P.blue)B=1;else{B=0;break}}B==0?q.PhyloCanvas.Render.Style.line.stroke="black":(me=z.children[0].red,Y=z.children[0].green,he=z.children[0].blue,q.PhyloCanvas.Render.Style.line.stroke=["rgb(",me,",",Y,",",he,")"].join("")),z.children.length==2?(me=z.children[0].red,Y=z.children[0].green,he=z.children[0].blue,q.PhyloCanvas.Render.Style.line.stroke=["rgb(",me,",",Y,",",he,")"].join(""),h.draw(new q.PhyloCanvas.Render.Path(["M",K+1e-4,n,"L",K,n,"L",K,u],{attr:q.PhyloCanvas.Render.Style.line})),me=z.children[1].red,Y=z.children[1].green,he=z.children[1].blue,q.PhyloCanvas.Render.Style.line.stroke=["rgb(",me,",",Y,",",he,")"].join(""),h.draw(new q.PhyloCanvas.Render.Path(["M",K,u,"L",K,s,"L",K+1e-4,s],{attr:q.PhyloCanvas.Render.Style.line}))):h.draw(new q.PhyloCanvas.Render.Path(["M",K+1e-4,n,"L",K,n,"L",K,s,"L",K+1e-4,s],{attr:q.PhyloCanvas.Render.Style.line}))}else{if(D=K,ce=q.Common.roundFloat(K+C*z.len,2),ne=g,xe=g,me=z.red,Y=z.green,he=z.blue,z.y=g,W.push(z),h.draw(new q.PhyloCanvas.Render.Line(D,ce,ne,xe,me,Y,he)),w.alignRight&&h.draw(new q.PhyloCanvas.Render.Path(["M",ce,ne,"L",w.alignPadding+p,xe],{attr:q.PhyloCanvas.Render.Style.connectedDash})),z.name){var fe={};z.style&&(fe=q.PhyloCanvas.Render.Style.getStyle(z.style,"text")),z.font_color_hex?fe.fill=z.font_color_hex:fe.fill="#000000",fe["text-anchor"]="start",z.uri&&(fe.href=z.uri),z.description&&(fe.title=z.description);var $=h.draw(new q.PhyloCanvas.Render.Text(w.alignRight?p+w.bufferInnerLabels+w.alignPadding:ce+w.bufferInnerLabels,xe,z.name,{attr:fe}));v=Math.max($[1],v),q.PhyloCanvas.Render.Parameters.mouseRollOver&&q.Common.addRaphEventHandler($[0],"mouseover",q.PhyloCanvas.Render.Parameters.mouseRollOver,{svg:h,node:z,x:ce,y:xe,textEl:$[0]}),q.PhyloCanvas.Render.Parameters.mouseRollOut&&q.Common.addRaphEventHandler($[0],"mouseout",q.PhyloCanvas.Render.Parameters.mouseRollOut,{svg:h,node:z,x:ce,y:xe,textEl:$[0]}),q.PhyloCanvas.Render.Parameters.onClickAction&&q.Common.addRaphEventHandler($[0],"click",q.PhyloCanvas.Render.Parameters.onClickAction,{svg:h,node:z,x:ce,y:xe,textEl:$[0]})}o&&(o=!1)}return[ne,xe]},ae=function(){y=g+k,O=0,I=w.showScaleBar*C,h.draw(new q.PhyloCanvas.Render.Line(O,I,y,y)),h.draw(new q.PhyloCanvas.Render.Text((O+I)/2,y-8,w.showScaleBar))},de=function(z,K,j){for(var D=(j&&j.bufferInner?j.bufferInner:0)|q.PhyloCanvas.Render.Parameters.binaryChartBufferInner,ce=(j&&j.bufferSiblings?j.bufferSiblings*k:0)|(q.PhyloCanvas.Render.Parameters.binaryChartBufferSiblings<1?k*q.PhyloCanvas.Render.Parameters.binaryChartBufferSiblings:q.PhyloCanvas.Render.Parameters.binaryChartBufferSiblings),ne=(j&&j.thickness?j.thickness:0)|q.PhyloCanvas.Render.Parameters.binaryChartThickness,xe=0;xe<W.length;xe++){var me=W[xe];h.draw(new q.PhyloCanvas.Render.Path(U(z+D,me.y-k/2+ce/2,z+D+ne,me.y+k/2-ce/2),{attr:q.PhyloCanvas.Render.Style.getStyle(me.chart[K],"textSecantBg")}))}return z+D+ne},be=function(z,K,j){for(var D=[],ce,ne=j&&j.bufferInner?j.bufferInner:0|q.PhyloCanvas.Render.Parameters.barChartBufferInner,xe=j&&j.height?j.height:0|q.PhyloCanvas.Render.Parameters.barChartHeight,me=j&&j.width?j.width<1?k*j.width:j.width:0|(q.PhyloCanvas.Render.Parameters.barChartWidth<1?k*q.PhyloCanvas.Render.Parameters.barChartWidth:q.PhyloCanvas.Render.Parameters.barChartWidth),Y=0,he=0;he<W.length;he++)D.push(W[he].chart[K]);ce=Math.max.apply(null,D),Y=q.Common.roundFloat(xe/ce,4);for(var he=0;he<W.length;he++){var fe=W[he];h.draw(new q.PhyloCanvas.Render.Path(U(z+ne,fe.y-me/2,z+ne+Y*fe.chart[K],fe.y+me/2),{attr:q.PhyloCanvas.Render.Style.getStyle(fe.chart[K],"barChart")}))}return z+ne+xe};return function(z,K){this.getCanvasSize=function(){return[N,F]},this.getRoot=function(){return K.getRoot()},K.getValidate()&&h.draw(0,0,K.getValidate()),o=!0,h=z;var j=K.getRoot(),D=K.getNewickLen();if(N=h.canvasSize[0],F=h.canvasSize[1],T=w.bufferX,M=w.paddingX,G=w.paddingY,a=w.minHeightBetweenLeaves,g=G,C=Math.round((N-T-M*2)/D),k=Math.round((F-G*2)/(w.showScaleBar?j.getCountAllChildren():j.getCountAllChildren()-1)),k<a&&(k=a),p=Math.round(N-T-M*2),(q.PhyloCanvas.Render.Parameters.binaryCharts.length||q.PhyloCanvas.Render.Parameters.barCharts.length)&&(w.alignRight=!0),V(j,M),w.showScaleBar&&ae(),R=p+v+w.bufferInnerLabels,q.PhyloCanvas.Render.Parameters.binaryCharts.length){var ce=q.PhyloCanvas.Render.Parameters.binaryCharts;for(var ne in ce)R=de(R,ce[ne].chart,ce[ne])}if(q.PhyloCanvas.Render.Parameters.barCharts.length){var xe=q.PhyloCanvas.Render.Parameters.barCharts;for(var ne in xe)be(R,xe[ne].chart,xe[ne])}W=[],typeof bgLabelsHold<"u"&&(bgLabelsHold=[])}}();q.PhyloCanvas.Render.Phylogram.prototype={};q.PhyloCanvas.Render.CircularPhylogram=function(){var h,w=q.PhyloCanvas.Render.Parameters.Circular,N,F,C,k,p,a,o=!0,g=0,v,R,O,I=[],T=[],M,G,W=0,U,V=Math.PI/180;function ae(Y,he){return he+=U,[q.Common.roundFloat(v+Y*Math.sin(he*V),4),q.Common.roundFloat(R+Y*Math.cos(he*V),4)]}function de(Y){var he=K(90-Y-U);if(he>90&&he<270){he+=180;var fe="end"}else var fe="start";return[he,fe]}function be(Y,he,fe,ve){var c=ae(Y,he),d=ae(Y,fe),t=[],n,s=0;return Math.abs(K(fe-he))>180?n=1:n=-1,ve&&ve.invertSecant&&(n*=-1,s=1),ve&&ve.noMove||t.push("M"),t.push(c[0],c[1],"A",Y,Y,0,n<1?0:1,s,d[0],d[1]),t}function z(Y,he,fe,ve){var c=[],d=ae(he,Y),t=ae(fe,Y);return ve&&ve.noMove||c.push("M"),c.push(d[0],d[1],"L",t[0],t[1]),c}function K(Y){for(;Y>360||Y<0;)Y>360?Y-=360:Y<0&&(Y+=360);return Y}function j(Y,he,fe,ve){if(!he&&Y.length>1)var ve=Y[3],fe=Y[2],he=Y[1],Y=Y[0];var c=ce("M",be(Y,fe,ve,{noMove:1,invertSecant:0}),"L",be(he,ve,fe,{noMove:1,invertSecant:1}),"Z");return c}function D(Y,he){if(he=he,Y.len&&(o?g=M||1:Y.children.length==0&&(g=q.Common.roundFloat(g+p,4))),Y.children.length>0){var fe=[],ve,c,d;if(ve=he,c=he+=q.Common.roundFloat(k*Y.len,4),Y.name,Y.children&&Y.children.length)for(var t=0;t<Y.children.length;t++){var n=Y.children[t],s=D(n,he);s>0&&fe.push(s)}var u=q.Common.roundFloat(Math.min.apply(null,fe),4),f=q.Common.roundFloat(Math.max.apply(null,fe),4);Y.level!=0&&h.draw(new q.PhyloCanvas.Render.Path(ce("M",ae(he+.01,u),"L",be(he,u,f,{noMove:!0}),"L",ae(he+.01,f)))),Y.len&&(d=q.Common.roundFloat(u+(f-u)/2,4),h.draw(new q.PhyloCanvas.Render.Path(z(d,ve,c))))}else if(Y.y=g,I.push(Y),ve=he,c=he=q.Common.roundFloat(he+k*Y.len),d=g,h.draw(new q.PhyloCanvas.Render.Path(z(d,ve,c))),h.draw(new q.PhyloCanvas.Render.Path(z(d,c,O),{attr:q.PhyloCanvas.Render.Style.connectedDash})),Y.name){var X=ae(O+w.bufferInnerLabels,d),x=de(d),b=x[0],B=x[1],P={};Y.style&&q.Common.apply(P,q.PhyloCanvas.Render.Style.getStyle(Y.style,"text")),Y.font_color_hex?P.fill=Y.font_color_hex:P.fill="#000000",P["text-anchor"]=B,Y.uri&&(P.href=Y.uri),Y.description&&(P.title=Y.description);var $=h.draw(new q.PhyloCanvas.Render.Text(X[0],X[1],Y.name,{attr:P,rotate:[b,X[0],X[1]]}));Y.bgStyle&&T.push([Y.bgStyle,d]);var X=ae(c,d);q.PhyloCanvas.Render.Parameters.mouseRollOver&&q.Common.addRaphEventHandler($[0],"mouseover",q.PhyloCanvas.Render.Parameters.mouseRollOver,{svg:h,node:Y,x:X[0],y:X[1],textEl:$[0]}),q.PhyloCanvas.Render.Parameters.mouseRollOut&&q.Common.addRaphEventHandler($[0],"mouseout",q.PhyloCanvas.Render.Parameters.mouseRollOut,{svg:h,node:Y,x:X[0],y:X[1],textEl:$[0]}),q.PhyloCanvas.Render.Parameters.onClickAction&&q.Common.addRaphEventHandler($[0],"click",q.PhyloCanvas.Render.Parameters.onClickAction,{svg:h,node:Y,x:X[0],y:X[1],textEl:$[0]}),W=Math.max($[1],W)}return o&&(o=!1),d}function ce(Y){for(var he=Y,fe=1;fe<arguments.length;fe++)he=he.concat(arguments[fe]);return he}function ne(){var c=[];if(T.length>0){if(q.PhyloCanvas.Render.Style.jsphylosvgGradientList)for(var Y=0;Y<q.PhyloCanvas.Render.Style.jsphylosvgGradientList.length;Y++){var he=q.PhyloCanvas.Render.Style.jsphylosvgGradientList[Y],fe=q.Common.createGradientEl(he,q.PhyloCanvas.Render.Style[he],[v,R,O+W+w.bufferOuterLabels]);h.svg.defs.appendChild(fe)}for(var Y=0;Y<T.length;Y++){if(Y!=T.length-1&&T[Y][0]==T[Y+1][0]){T[Y+1][2]=T[Y][2]?T[Y][2]:T[Y][1];continue}var c=j(O,O+W+w.bufferOuterLabels,T[Y][2]?T[Y][2]-p/2:T[Y][1]-p/2,T[Y][1]+p/2),ve=q.PhyloCanvas.Render.Style.getStyle(T[Y][0],"textSecantBg"),d=h.draw(new q.PhyloCanvas.Render.Path(c,{attr:ve.type?{}:ve}));ve.type&&ve.type=="radialGradient"&&d[0].node.setAttribute("fill","url(#"+ve.name+")"),ve.type&&ve.type=="radialGradient"&&d[0].node.setAttribute("stroke","none"),d[0].toBack()}}var c=j(O,O+W+w.bufferOuterLabels,(M||1)-p/2,360-p/2),d=h.draw(new q.PhyloCanvas.Render.Path(c,{attr:q.PhyloCanvas.Render.Style.textSecantBg}));return d[0].toBack(),O+W+w.bufferOuterLabels}function xe(Y,he,fe){for(var ve=fe&&fe.bufferInner?parseFloat(fe.bufferInner):q.PhyloCanvas.Render.Parameters.binaryChartBufferInner,c=(fe&&fe.bufferSiblings?fe.bufferSiblings*p:0)|(q.PhyloCanvas.Render.Parameters.binaryChartBufferSiblings<1?p*q.PhyloCanvas.Render.Parameters.binaryChartBufferSiblings:q.PhyloCanvas.Render.Parameters.binaryChartBufferSiblings),d=fe&&fe.thickness?parseFloat(fe.thickness):q.PhyloCanvas.Render.Parameters.binaryChartThickness,t=(fe&&fe.disjointed?fe.disjointed:!1)|q.PhyloCanvas.Render.Parameters.binaryChartDisjointed,n=fe&&fe.isInternal?fe.isInternal:!1,s=!0,u,f=0;f<I.length;f++){var x=I[f];if((!I[f+1]||x.chart[he]!==I[f+1].chart[he]||t)&&x.chart[he]!="none"){var b=q.PhyloCanvas.Render.Style.getStyle(x.chart[he],"textSecantBg");if(n)var B=[O-ve-d,O-ve,(u||x.y)-p/2+(s&&!t?0:c/2),x.y+p/2-(f==I.length-1&&!t?0:c/2)];else var B=[Y+ve,Y+ve+d,(u||x.y)-p/2+(s&&!t?0:c/2),x.y+p/2-(f==I.length-1&&!t?0:c/2)];if(b.label){var P=q.PhyloCanvas.Render.Style.getStyle(b.labelStyle,"text"),$=ae((B[0]+B[1])/2,(B[2]+B[3])/2),X=de((B[2]+B[3])/2),te=K(X[0]+(P.rotate?parseFloat(P.rotate):0)),ge=K(90-(B[2]+B[3])/2-U);ge>90&&ge<270&&(te+=180),P["text-anchor"]||(P["text-anchor"]="middle"),x.font_color_hex?b.fill=x.font_color_hex:b.fill="#000000";var _e=h.draw(new q.PhyloCanvas.Render.Text($[0],$[1],b.label,{attr:P,rotate:te}));_e[0].toBack()}if(b.borderStyle){var Ce=q.PhyloCanvas.Render.Style.getStyle(b.borderStyle,"textSecantBg"),we=[O,Ce.fullsize?B[1]:B[0],B[2],B[3]],Se=h.draw(new q.PhyloCanvas.Render.Path(j(we),{attr:Ce}));Se[0].toBack()}var Le=h.draw(new q.PhyloCanvas.Render.Path(j(B),{attr:b}));Le[0].toBack(),u=0,s=!1}else u||(u=x.y),x.chart[he]=="none"&&(u=0);s=!1}return n?Y:Y+ve+d}function me(Y,he,fe){for(var ve=[],c,d=fe&&fe.bufferInner?parseFloat(fe.bufferInner):q.PhyloCanvas.Render.Parameters.barChartBufferInner,t=fe&&fe.height?parseFloat(fe.height):q.PhyloCanvas.Render.Parameters.barChartHeight?q.PhyloCanvas.Render.Parameters.barChartHeight:0,n=fe&&fe.width?parseFloat(fe.width)<1?p*parseFloat(fe.width):parseFloat(fe.width):0|(q.PhyloCanvas.Render.Parameters.barChartWidth<1?p*q.PhyloCanvas.Render.Parameters.barChartWidth:q.PhyloCanvas.Render.Parameters.barChartWidth),s=0,u=0;u<I.length;u++)ve.push(I[u].chart[he]);c=Math.max.apply(null,ve),s=q.Common.roundFloat(t/c,4);for(var u=0;u<I.length;u++){var f=I[u];f.chart[he]>0&&h.draw(new q.PhyloCanvas.Render.Path(j(Y+d,Y+d+s*f.chart[he],f.y-n/2,f.y+n/2),{attr:q.PhyloCanvas.Render.Style.getStyle(f.chart[he],"barChart")}))}return Y+d+t}return function(Y,he,fe){if(this.getCanvasSize=function(){return[N,F]},this.getRoot=function(){return he.getRoot()},he.getValidate()){Y.draw({type:"text",x:0,y:Y.canvasSize[1]/3,text:he.getValidate()});return}h=Y;var ve=he.getRoot(),c=he.getNewickLen();if(N=h.canvasSize[0],F=h.canvasSize[1],v=N/2,R=F/2,C=Math.min.apply(null,[N,F]),fe=w.bufferRadius>1?w.bufferRadius:q.Common.roundFloat(C*w.bufferRadius,4),M=w.bufferAngle,a=w.innerCircleRadius,w.minHeightBetweenLeaves,U=w.initStartAngle,O=Math.round((C-fe-a)/2),k=(O-a)/c,p=q.Common.roundFloat((360-M)/ve.getCountAllChildren(),4),D(ve,a),G=O+W+w.bufferOuterLabels,q.PhyloCanvas.Render.Parameters.integratedBinaryCharts.length){var d=q.PhyloCanvas.Render.Parameters.integratedBinaryCharts;for(var t in d){var n=d[t].bufferInner?d[t].bufferInner:q.PhyloCanvas.Render.Parameters.binaryChartBufferInner,s=d[t].thickness?d[t].thickness:q.PhyloCanvas.Render.Parameters.binaryChartThickness;G=xe(G-s-n,d[t].chart,d[t])}}if(G=ne(),q.PhyloCanvas.Render.Parameters.binaryCharts.length){var u=q.PhyloCanvas.Render.Parameters.binaryCharts;for(var t in u)G=xe(G,u[t].chart,u[t])}if(q.PhyloCanvas.Render.Parameters.barCharts.length){var f=q.PhyloCanvas.Render.Parameters.barCharts;for(var t in f)G=me(G,f[t].chart,f[t])}I=[],T=[]}}();q.PhyloCanvas.Render.CircularPhylogram.prototype={};var wt=function(){var h=function(F){if(F&&typeof F=="object"){let C=function(){};return C.prototype=F,new C}},w=function(F){var C="";F&&typeof F=="string"&&(C=F);var k=/^((-)?([0-9]*)((\.{0,1})([0-9]+))?$)/;return k.test(C)},N={xmlToJSON:function(F){try{let o=function(I){return I.replace(/^\s+|\s+$/gm,"")},g=function(I){var T=/-/g,M=String(I).replace(T,"_");return M},v=function(I,T){if(T.attributes.length>0){var M=T.attributes.length-1,G;I._attributes=[];do G=String(g(T.attributes[M].name)),I._attributes.push(G),I[G]=o(T.attributes[M].value);while(M--)}},R=function(I){I.getNodeByAttribute=function(T,M){if(this.length>0){var G,W=this.length-1;try{do if(G=this[W],G[T]==M)return G;while(W--)}catch{return!1}return!1}},I.contains=function(T,M){if(this.length>0){var G=this.length-1;try{do if(this[G][T]==M)return!0;while(G--)}catch{return!1}return!1}},I.indexOf=function(T,M){var G=-1;if(this.length>0){var W=this.length-1;try{do this[W][T]==M&&(G=W);while(W--)}catch{return-1}return G}},I.SortByAttribute=function(T,M){if(this.length){let G=function(U,V){var ae=U[V];return ae=w(ae)?parseFloat(ae):ae,ae},W=function(U,V){var ae=0,de,be;return de=G(U,T),be=G(V,T),de<be?ae=-1:be<de&&(ae=1),M&&(ae=M.toUpperCase()=="DESC"?0-ae:ae),ae};this.sort(W)}},I.SortByValue=function(T){if(this.length){let M=function(W){var U=W.Text;return U=w(U)?parseFloat(U):U,U},G=function(W,U){var V=0,ae,de;return ae=M(W),de=M(U),ae<de?V=-1:de<ae&&(V=1),T&&(V=T.toUpperCase()=="DESC"?0-V:V),V};this.sort(G)}},I.SortByNode=function(T,M){if(this.length){let G=function(U,V){var ae=U[V][0].Text;return ae=w(ae)?parseFloat(ae):ae,ae},W=function(U,V){var ae=0,de,be;return de=G(U,T),be=G(V,T),de<be?ae=-1:be<de&&(ae=1),M&&(ae=M.toUpperCase()=="DESC"?0-ae:ae),ae};this.sort(W)}}},O=function(I,T){var M,G,W,U="";if(!T)return null;if(T.attributes.length>0&&v(I,T),I.Text="",T.hasChildNodes()){var V=T.childNodes.length-1,ae=0;do switch(G=T.childNodes[ae],G.nodeType){case 1:I._children=[],M=G.localName?G.localName:G.baseName,M=g(M),U!=M&&I._children.push(M),I[M]||(I[M]=[]),W={},I[M].push(W),G.attributes.length>0&&v(W,G),I[M].contains||R(I[M]),U=M,G.hasChildNodes()&&O(W,G);break;case 3:I.Text+=o(G.nodeValue);break;case 4:I.Text+=G.text?o(G.text):o(G.nodeValue);break}while(ae++<V)}};if(!F)return null;var C={};C.typeOf="JSXBObject";var k=F.nodeType==9?F.documentElement:F;if(C.RootName=k.nodeName||"",F.nodeType==3||F.nodeType==4)return F.nodeValue;var p=function(){var I={activate:function(){var T=[];return T&&(T.getNodesByAttribute=function(M,G){if(T&&T.length>0){var W=[],U,V=T.length-1;try{do U=T[V],U[M]===G&&W.push(U);while(V--);return W.reverse(),W}catch{return null}return null}},T.getNodeByAttribute=function(M,G){if(T&&T.length>0){var W,U=T.length-1;try{do if(W=T[U],W[M]===G)return W;while(U--)}catch{return null}return null}},T.getNodesByValue=function(M){if(T&&T.length>0){var G=[],W,U=T.length-1;try{do W=T[U],W.Text&&W.Text===M&&G.push(W);while(U--);return G}catch{return null}return null}},T.contains=function(M,G){if(T&&T.length>0){var W=T.length-1;try{do if(T[W][M]===G)return!0;while(W--)}catch{return!1}return!1}},T.indexOf=function(M,G){var W=-1;if(T&&T.length>0){var U=T.length-1;try{do T[U][M]===G&&(W=U);while(U--)}catch{return-1}return W}},T.SortByAttribute=function(M,G){if(T&&T.length>0){let W=function(V,ae){var de=V[ae];return de=bam.validation.isNumeric(de)?parseFloat(de):de,de},U=function(V,ae){var de,be;de=W(V,M),be=W(ae,M);var z=de<be?-1:be<de?1:0;return G&&(z=G.toUpperCase()==="DESC"?0-z:z),z};T.sort(U)}},T.SortByValue=function(M){if(T&&T.length>0){let G=function(U){var V=U.Text;return V=bam.validation.isNumeric(V)?parseFloat(V):V,V},W=function(U,V){var ae,de;ae=G(U),de=G(V);var be=ae<de?-1:de<ae?1:0;return M&&(be=M.toUpperCase()==="DESC"?0-be:be),be};T.sort(W)}},T.SortByNode=function(M,G){if(T&&T.length>0){let W=function(V,ae){var de=V[ae][0].Text;return de=bam.validation.isNumeric(de)?parseFloat(de):de,de},U=function(V,ae){var de,be;de=W(V,M),be=W(ae,M);var z=de<be?-1:be<de?1:0;return G&&(z=G.toUpperCase()==="DESC"?0-z:z),z};T.sort(U)}}),T}};return I}(),a=function(){var I=h(p);return I.activate()};return O(C,k),F=null,k=null,C}catch{return null}},textToXML:function(F){var C=null;try{C=document.all?new ActiveXObject("Microsoft.XMLDOM"):new DOMParser,C.async=!1}catch{throw new Error("XML Parser could not be instantiated")}var k;try{document.all?k=C.loadXML(F)?C:!1:k=C.parseFromString(F,"text/xml")}catch{throw new Error("Error parsing XML string")}return k}};return N}();const Fe={};Fe.defaults={skip_sgml:!1,syncope:!1};var Mn=Fe.schemes={tamil:{vowels:["அ","ஆ","இ","ஈ","உ","ஊ","𑌋","𑍠","𑌌","𑍡","எ","ஏ","ஐ","ஒ","ஓ","ஔ"],vowel_marks:["ா","ி","ீ","ு","ூ","𑍃","𑍄","𑍢","𑍣","ெ","ே","ை","ொ","ோ","ௌ"],other_marks:["𑌂","𑌃","𑌁","","","ஃ"],virama:["்"],consonants:["க","𑌖","𑌗","𑌘","ங","ச","𑌛","ஜ","𑌝","ஞ","ட","𑌠","𑌡","𑌢","ண","த","𑌥","𑌦","𑌧","ந","ப","𑌫","𑌬","𑌭","ம","ய","ர","ல","வ","ஶ","ஷ","ஸ","ஹ","ள","ழ","ற","ன"],symbols:["௦","௧","௨","௩","௪","௫","௬","௭","௮","௯","ௐ","","𑌽","।","॥","௰","௱","௲"]},grantha:{vowels:["𑌅","𑌆","𑌇","𑌈","𑌉","𑌊","𑌋","𑍠","𑌌","𑍡","எ","𑌏","𑌐","ஒ","𑌓","𑌔"],vowel_marks:["𑌾","𑌿","𑍀","𑍁","𑍂","𑍃","𑍄","𑍢","𑍣","ெ","𑍇","𑍈","ொ","𑍋","𑍌"],other_marks:["𑌂","𑌃","𑌁","𑍞","𑍟","ஃ"],virama:["𑍍"],consonants:["𑌕","𑌖","𑌗","𑌘","𑌙","𑌚","𑌛","𑌜","𑌝","𑌞","𑌟","𑌠","𑌡","𑌢","𑌣","𑌤","𑌥","𑌦","𑌧","𑌨","𑌪","𑌫","𑌬","𑌭","𑌮","𑌯","𑌰","𑌲","𑌵","𑌶","𑌷","𑌸","𑌹","𑌳","ழ","ற","ன"],symbols:["௦","௧","௨","௩","௪","௫","௬","௭","௮","௯","𑍐","","𑌽","।","॥","௰","௱","௲"]},malayalam:{vowels:["അ","ആ","ഇ","ഈ","ഉ","ഊ","ഋ","ൠ","ഌ","ൡ","എ","ഏ","ഐ","ഒ","ഓ","ഔ"],vowel_marks:["ാ","ി","ീ","ു","ൂ","ൃ","ൄ","ൢ","ൣ","െ","േ","ൈ","ൊ","ോ","ൌ"],other_marks:["ം","ഃ","ഁ","","",""],virama:["്"],consonants:["ക","ഖ","ഗ","ഘ","ങ","ച","ഛ","ജ","ഝ","ഞ","ട","ഠ","ഡ","ഢ","ണ","ത","ഥ","ദ","ധ","ന","പ","ഫ","ബ","ഭ","മ","യ","ര","ല","വ","ശ","ഷ","സ","ഹ","ള","ഴ","റ","ഩ"],symbols:["൦","൧","൨","൩","൪","൫","൬","൭","൮","൯","ഒം","","ഽ","।","॥","൰","൱","൲"]},newa:{vowels:["𑐀","𑐁","𑐂","𑐃","𑐄","𑐅","𑐆","𑐇","𑐈","𑐉","","𑐊","𑐋","","𑐌","𑐍"],vowel_marks:["𑐵","𑐶","𑐷","𑐸","𑐹","𑐺","𑐻","𑐼","𑐽","","𑐾","𑐿","","𑑀","𑑁"],other_marks:["𑑄","𑑅","𑑃","𑑠","𑑡",""],virama:["𑑂"],consonants:["𑐎","𑐏","𑐐","𑐑","𑐒","𑐔","𑐕","𑐖","𑐗","𑐘","𑐚","𑐛","𑐜","𑐝","𑐞","𑐟","𑐠","𑐡","𑐢","𑐣","𑐥","𑐦","𑐧","𑐨","𑐩","𑐫","𑐬","𑐮","𑐰","𑐱","𑐲","𑐳","𑐴"],symbols:["𑑐","𑑑","𑑒","𑑓","𑑔","𑑕","𑑖","𑑗","𑑘","𑑙","𑑉","","𑑇","𑑋","𑑌"]},sarada:{vowels:["𑆃","𑆄","𑆅","𑆆","𑆇","𑆈","𑆉","𑆊","𑆋","𑆌","","𑆍","𑆎","","𑆏","𑆐"],vowel_marks:["𑆳","𑆴","𑆵","𑆶","𑆷","𑆸","𑆹","𑆺","𑆻","","𑆼","𑆽","","𑆾","𑆿"],other_marks:["𑆁","𑆂","𑆀","𑇁","𑇂",""],virama:["𑇀"],consonants:["𑆑","𑆒","𑆓","𑆔","𑆕","𑆖","𑆗","𑆘","𑆙","𑆚","𑆛","𑆜","𑆝","𑆞","𑆟","𑆠","𑆡","𑆢","𑆣","𑆤","𑆥","𑆦","𑆧","𑆨","𑆩","𑆪","𑆫","𑆬","𑆮","𑆯","𑆰","𑆱","𑆲","𑆭"],symbols:["𑇐","𑇑","𑇒","𑇓","𑇔","𑇕","𑇖","𑇗","𑇘","𑇙","𑇄","","𑇁","𑇅","𑇆"]},nandinagari:{vowels:["𑦠","𑦡","𑦢","𑦣","ᆔ","𑦥","𑦦","𑦧","𑧉𑧖","𑧉𑧗","","𑦪","𑦫","","𑦬","𑦭"],vowel_marks:["𑧑","𑧒","𑧓","𑧔","𑧕","𑧖","𑧗","𑧉𑧖","𑧉𑧗","","𑧚","𑧛","","𑧜","𑧝"],other_marks:["𑧞","𑧟","","",""],virama:["𑧠"],consonants:["𑦮","𑦯","𑦰","𑦱","ᆲ","𑦳","𑦴","𑦵","𑦶","𑦷","𑦸","𑦹","𑦺","𑦻","𑦼","𑦽","𑦾","𑦿","𑧀","𑧁","𑧂","𑧃","𑧄","𑧅","𑧆","𑧇","𑧈","𑧉","𑧊","𑧋","𑧌","𑧍","𑧎","𑧏","","𑧐"],symbols:["೦","೧","೨","೩","೪","೫","೬","೭","೮","೯","𑦬𑧞","","𑧡","।","॥"]},bengali:{vowels:["অ","আ","ই","ঈ","উ","ঊ","ঋ","ৠ","ঌ","ৡ","","এ","ঐ","","ও","ঔ"],vowel_marks:["া","ি","ী","ু","ূ","ৃ","ৄ","ৢ","ৣ","","ে","ৈ","ো","ৌ"],other_marks:["ং","ঃ","ঁ","","",""],virama:["্"],consonants:["ক","খ","গ","ঘ","ঙ","চ","ছ","জ","ঝ","ঞ","ট","ঠ","ড","ঢ","ণ","ত","থ","দ","ধ","ন","প","ফ","ব","ভ","ম","য","র","ল","ব","শ","ষ","স","হ","ळ","","","","য়","","","","","","","ড়","ঢ়"],symbols:["০","১","২","৩","৪","৫","৬","৭","৮","৯","ওঁ","","ঽ","।","॥"]},devanagari:{vowels:["अ","आ","इ","ई","उ","ऊ","ऋ","ॠ","ऌ","ॡ","ऎ","ए","ऐ","ऒ","ओ","औ"],vowel_marks:["ा","ि","ी","ु","ू","ृ","ॄ","ॢ","ॣ","ॆ","े","ै","ॊ","ो","ौ","ॎ","ॎे","ॎा","ॎो"],other_marks:["ं","ः","ँ","ᳵ","ᳶ",""],virama:["्"],consonants:["क","ख","ग","घ","ङ","च","छ","ज","झ","ञ","ट","ठ","ड","ढ","ण","त","थ","द","ध","न","प","फ","ब","भ","म","य","र","ल","व","श","ष","स","ह","ळ","ऴ","ऱ","ऩ","य़","क़","ख़","ग़","ज़","झ़","फ़","ड़","ढ़","थ़","ध़","व़"],symbols:["०","१","२","३","४","५","६","७","८","९","ॐ","ꣽ","ऽ","।","॥"],zwj:["‍"],skip:[""],accent:["॑","॒"],combo_accent:"ः॑ ः॒ ं॑ ं॒".split(" ")},telugu:{vowels:["అ","ఆ","ఇ","ఈ","ఉ","ఊ","ఋ","ౠ","ఌ","ౡ","ఎ","ఏ","ఐ","ఒ","ఓ","ఔ"],vowel_marks:["ా","ి","ీ","ు","ూ","ృ","ౄ","ౢ","ౣ","ె","ే","ై","ొ","ో","ౌ"],other_marks:["ం","ః","ఀ","","",""],virama:["్"],consonants:["క","ఖ","గ","ఘ","ఙ","చ","ఛ","జ","ఝ","ఞ","ట","ఠ","డ","ఢ","ణ","త","థ","ద","ధ","న","ప","ఫ","బ","భ","మ","య","ర","ల","వ","శ","ష","స","హ","ళ","ఴ","ఱ"],symbols:["౦","౧","౨","౩","౪","౫","౬","౭","౮","౯","ఓం","","ఽ","।","॥"]},iast:{vowels:["a","ā","i","ī","u","ū","ṛ","ṝ","l̥","l̥̄","e","ē","ai","o","ō","au","ê","aî","ô","aû"],other_marks:["ṃ","ḥ","m̐","ẖ","ḫ","ḵ"],virama:[""],consonants:["k","kh","g","gh","ṅ","c","ch","j","jh","ñ","ṭ","ṭh","ḍ","ḍh","ṇ","t","th","d","dh","n","p","ph","b","bh","m","y","r","l","v","ś","ṣ","s","h","ḷ","ḻ","ṟ","ṉ","ẏ","q","qh","ġ","z","zh","f","ṙ","ṙh","ṫh","ḋh","w"],symbols:["0","1","2","3","4","5","6","7","8","9","oṁ","oḿ","'","|","||","⁰","⁰⁰","⁰⁰⁰"]},slpish:{vowels:["a","ā","i","ī","u","ū","ṛ","ṝ","l̥","l̥̄","e","ē","E","o","ō","O","ê","Ê","ô","Ô"],other_marks:["ṃ","ḥ","m̐","ẖ","ḫ","ḵ"],virama:[""],consonants:["k","K","g","G","ṅ","c","C","j","J","ñ","ṭ","Ṭ","ḍ","Ḍ","ṇ","t","T","d","D","n","p","P","b","B","m","y","r","l","v","ś","ṣ","s","h","ḷ","ḻ","ṟ","ṉ","ẏ","q","Q","ġ","z","Z","f","ṙ","Ṙ","Ṫ","Ḋ","w"],symbols:["0","1","2","3","4","5","6","7","8","9","õ","ó","'","|","||","⁰","⁰⁰","⁰⁰⁰"]},hk:{vowels:["a","A","i","I","u","U","R","RR","lR","lRR","e","E","ai","o","O","au","e","ai","o","au"],other_marks:["M","H","M","H","H","H"],virama:[""],consonants:["k","kh","g","gh","G","c","ch","j","jh","J","T","Th","D","Dh","N","t","th","d","dh","n","p","ph","b","bh","m","y","r","l","v","z","S","s","h","L","zh","_r","_n"],symbols:["0","1","2","3","4","5","6","7","8","9","om","om","'","|","||","⁰","⁰⁰","⁰⁰⁰"]}},kn={},Dn={},Rt={};Fe.isRomanScheme=function(h){return kn.hasOwnProperty(h)};Fe.addBrahmicScheme=function(h,w){Fe.schemes[h]=w};Fe.addRomanScheme=function(h,w){"vowel_marks"in w||(w.vowel_marks=w.vowels.slice(1)),Fe.schemes[h]=w,kn[h]=!0};(function(){for(var h=["iast","slpish","hk"],w=0,N;N=h[w];w++)Fe.addRomanScheme(N,Mn[N])})();var In=function(h,w){var N=Dn[h]||{},F={},C=Fe.schemes[h],k={},p=[],a={},o=Fe.schemes[w];for(var g in C)if(C.hasOwnProperty(g)){var v=C[g],R=o[g];if(R!==void 0)for(var O=0;O<v.length;O++){var I=v[O],T=R[O],M=N[I]||[],G=M.length,W=0;for(p.push(I.length),W=0;W<G;W++)p.push(M[W].length);if(g==="vowel_marks"||g==="virama")for(a[I]=T,W=0;W<G;W++)a[M[W]]=T;else{for(k[I]=T,W=0;W<G;W++)k[M[W]]=T;if(g==="consonants"||g==="other")for(F[I]=T,W=0;W<G;W++)F[M[W]]=T}}}return{consonants:F,fromRoman:Fe.isRomanScheme(h),letters:k,marks:a,maxTokenLength:Math.max.apply(Math,p),toRoman:Fe.isRomanScheme(w),virama:o.virama}},qn=function(h,w,N){for(var F=[],C=w.consonants,k=h.length,p=!1,a=w.letters,o=w.marks,g=w.maxTokenLength,v=N.skip_sgml,R=N.syncope,O,I,T="",M=w.toRoman,G=w.virama,W=!1,U=!1,V=!1,ae=0,de;(de=h.charAt(ae))||T;ae++){var be=g-T.length;if(!(be>0&&ae<k&&(T+=de,be>1)))for(var z=0;z<g;z++){var K=T.substr(0,g-z);if(W===!0)W=K!==">";else if(K==="<")W=v;else if(K==="##"){V=!V,T=T.substr(2);break}if(U=W||V,(O=a[K])!==void 0&&!U){M?F.push(O):(p?(I=o[K])?F.push(I):K!=="a"&&(F.push(G),F.push(O)):F.push(O),p=K in C),T=T.substr(g-z);break}else z===g-1&&(p&&(p=!1,R||F.push(G)),F.push(K),T=T.substr(1))}}return p&&!R&&F.push(G),F.join("")},Fn=function(h,w){for(var N=[],F=w.consonants,C=!1,k=w.letters,p=w.marks,a=h.length,o=w.maxTokenLength,g,v="",R=w.toRoman,O=!1,I=0,T;(T=h.charAt(I))||v;I++){var M=o-v.length;if(!(M>0&&I<a&&(v+=T,M>1)))for(var G=0;G<o;G++){var W=v.substr(0,o-G);if((g=p[W])!==void 0&&!O){N.push(g),C=!1,v=v.substr(o-G);break}else if(g=k[W]){C&&(N.push("a"),C=!1),N.push(g),C=R&&W in F,v=v.substr(o-G);break}else G===o-1&&(C&&(N.push("a"),C=!1),N.push(W),v=v.substr(1))}}return C&&N.push("a"),N.join("")};Fe.t=function(h,w,N,F){F=F||{};var C=Rt.options||{},k=Fe.defaults,p=Rt.from===w&&Rt.to===N,a;for(var o in k)if(k.hasOwnProperty(o)){var g=k[o];o in F&&(g=F[o]),F[o]=g,g!==C[o]&&(p=!1)}return p?a=Rt.map:(a=In(w,N),Rt={from:w,map:a,options:F,to:N}),a.fromRoman?qn(h,a,F):Fn(h,a)};const zn=new Map([["c","ñ"],["t","n"],["k","ṅ"]]),On=[{name:"additional punctuation",group:"all",search:"[()\\[\\],;?!|¦_‘’“”·\\-–—―=+\\d.\\/]+",replace:()=>""},{name:"ignore long/short e",group:"tamil",search:"ē",replace:()=>"e"},{name:"ignore long/short o",group:"tamil",search:"ō",replace:()=>"o"},{name:"insert glide after back vowels",group:"tamil",search:"([aāuūoōO])\\s+([aāiīuūeēoōO])",replace:h=>`${h[1]} v${h[2]}`},{name:"insert glide after front vowels",group:"tamil",search:"([iīeēE])\\s+([aāiīuūeēEoōO])",replace:h=>`${h[1]} y${h[2]}`},{name:"final -m sandhi variants",group:"tamil",search:"m(\\s*)([ckt])",replace:h=>`${zn.get(h[2])}${h[1]}${h[2]}`},{name:"ignore puḷḷi",group:"tamil",search:"[kṅcñṭtnpmyrlvḻḷṟṉ](?!\\s*[aāiīuūeēEoōOḵh])|[kṅcñṭtnpmyrlvḻḷṟṉ]$",replace:h=>`${h[0]}a`},{name:"valapalagilaka",search:"ṙ",replace:()=>"r"},{name:"pṛṣṭhamātrā e",search:"ê",replace:()=>"e"},{name:"pṛṣṭhamātrā o",search:"ô",replace:()=>"o"},{name:"pṛṣṭhamātrā ai",search:"Ê",replace:()=>"E"},{name:"pṛṣṭhamātrā au",search:"Ô",replace:()=>"O"},{name:"candrabindu as anusvāra",search:"m̐",replace:()=>"ṃ"},{name:"geminated aspirated consonants",search:"(?:kK|gG|cC|jJ|ṭṬ|ḍḌ|tT|dD|pP|bB)",replace:h=>h[0].slice(-1)},{name:"geminated m after h",search:"(?:ṃhm|hmm)",replace:()=>"hm"},{name:"geminated t",search:"([rṛi]|p[aā])tt|tt(?=[rvy]\\S)",replace:h=>h[1]?`${h[1]}t`:"t"},{name:"geminated consonants after r",search:"([rṛ]\\s*)([kgcjṭḍdpbṛnmyvl])\\2{1,2}",replace:h=>`${h[1]}${h[2]}`},{name:"final nasal variants",search:"(?:[ṃṅ][lśs]|nn)(?!\\S)",replace:()=>"n"},{name:"internal nasal variants",search:"[mnṅñṇ](?=[pPbBmdDtTnṭṬḍḌcCjJkKgG])",replace:()=>"ṃ"},{name:"final anusvāra variants",search:"ṃ?[mṅ](?!\\S)|n(?=\\s+[tdn])|Y(?=\\s+[jc])",replace:()=>"ṃ"},{name:"visarga aḥ before voiced consonants",search:"(?<!\\sB)(?:a[ḥr]|[o])(?=\\s+['gGjJḍḌdDnbBmrylvh])",replace:()=>"aḥ"},{name:"visarga aḥ before vowels",search:"aḥ(?=\\s+[āiīeuūoṛ])",replace:()=>"a"},{name:"visarga aḥ before unvoiced consonants and space + anusvāra",search:"o\\s+(?=[kKcCṭṬtTpPśṣsṃ])",replace:()=>"aḥ a"},{name:"visarga āḥ variants",search:"āḥ(?=\\s+[aāiīeEuUogGjḍḌdDbBnmyrlvh])",replace:()=>"ā"},{name:"other visarga variants",search:"ḥ?[rśṣs](?!\\S)",replace:()=>"ḥ"},{name:"superfluous avagrahas",search:"(\\S)'+",replace:h=>h[1]},{name:"double avagrahas",search:"''",replace:()=>"ā"},{name:"avagrahas",search:"'",replace:()=>"a"},{name:"internal visarga variants",search:"ṣ(?=[kK])|s(?=s)",replace:()=>"ḥ"},{name:"final au/āv",search:"āv(?!\\S)",replace:()=>"O"},{name:"final su",search:"(?<=[ṣs])v(?=\\s+[aāiīuūoOeE])",replace:()=>"u"},{name:"final i",search:"i(?=\\s+[aāuūoOeE])",replace:()=>"y"},{name:"kcch/kś",search:"k(\\s*)(?:ś|c?C)",replace:h=>`k${h[1]}ś`},{name:"cś/tś",search:"[tc](\\s*)S",replace:h=>`c${h[1]}C`},{name:"cch/ch",search:"([aāiīuūeEoO])C",replace:h=>`${h[1]}cC`},{name:"final t + hi",search:"d(\\s+)D(?=[iy](?:\\s|$))",replace:h=>`t${h[1]}h`},{name:"final t + voiced syllable",search:"d(?=(?:\\s+[aāiīeEuūoOgGdDbByrv]|\\s*$))",replace:()=>"t"},{name:"final t + n/m",search:"([ai])n(?=\\s+[nm])",replace:h=>`${h[1]}t`},{name:"final t + c/j",search:"j(?=\\s+j)|c(?=\\s+c)",replace:()=>"t"},{name:"i/y + vowel",search:"y(?=\\s+[aāuūeEoO])",replace:()=>"i"},{name:"bhd for bdh",search:"Bd",replace:()=>"bD"}],$n={none:{name:"remove spaces",group:"all",search:"\\s",replace:()=>""},collapse:{name:"collapse spaces",group:"all",search:"\\s+",replace:()=>" "}},Hn=function(h,w){const N=["a","ā","i","ī","u","ū","o","ō","O","e","ē","E","ṛ","ṝ","l̥","l̥̄"],F=w.join(""),C=[],k=[...F.matchAll(h.search)];let p=0,a=null;for(const o of w){const g=p+o.length;let v=o,R=0;if(a)if(a.length<=o.length)v=xn(o,0,a.length,a.text),R=a.text.length-a.length,a=null;else{v=a.text.slice(0,o.length);const I=a.text.slice(o.length);a={length:a.length-o.length,text:I};continue}for(;k.length>0&&k[0].index<g;){const O=k.shift(),I=O.index-p+R,T=h.replace(O);if(O.index+O[0].length<g)v=xn(v,I,O[0].length,T),R=R+T.length-O[0].length;else{const M=o.length-I+R,G=T.slice(0,M);v=v.slice(0,I)+G;const W=T.slice(M);N.includes(W)?v=v+W:a={length:O[0].length-M,text:W}}}C.push(v),p=g}return C},xn=function(h,w,N,F){return h.slice(0,w)+F+h.slice(w+N)},Vn=function(h,w=!1){let N=h.map(F=>Fe.t(F,"iast","slpish"));for(const F of[...On,$n.none]){if(w){if(F.group!=="tamil"&&F.group!=="all")continue}else if(F.group==="tamil")continue;N=Hn(F,N)}return N.map(F=>Fe.t(F,"slpish","iast"))},lt={smush:function(h,w){return h.toLowerCase().replace(/([ḍdrmvynhs]) ([aāiīuūṛeoéó])/g,"$1$2"+w).replace(/([kgcjṭḍtdpb]) h/g,"$1‌"+w+"h").replace(/([kgcjñḍtdnpbmrlyvśṣsṙ]) ([kgcjṭḍtdnpbmyrlvśṣshḻ])/g,"$1"+w+"$2").replace(/([oóeéā]) ([ṃ'])/g,"$1"+w+"$2").replace(/^ṃ/,"'‍ṃ").replace(/^ḥ/,"'‍ḥ").replace(/^_y/,"'‍y").replace(/ü/g,"‌u").replace(/ï/g,"‌i").replace(/_{1,2}(?=\s*)/g,function(N){if(N==="__")return"‍";if(N==="_")return"‌"})},iast:function(h,w){const N=w||"devanagari";return Fe.t(h,N,"iast",{skip_sgml:!0})},devanagari:function(h,w){const N=w||"",F={skip_sgml:!0},C=h.replace(/ṙ/g,"r").replace(/^_ā/,"ऽ‍ा"),k=lt.smush(C,N);return Fe.t(k,"iast","devanagari",F).replace(/¯/g,"ꣻ")},malayalam:function(h,w){const N=w||"",F={skip_sgml:!0},C={ക:"ൿ",ത:"ൽ",ന:"ൻ",മ:"ൔ",ര:"ർ"},k=h.replace(/^_ā/,"ഽ‍ാ"),p=lt.smush(k,N).replace(/e/g,"ẽ").replace(/o/g,"õ").replace(/ṙ/g,"r").replace(/ṁ/g,"ṃ").replace(/ḿ/g,"ṃ").replace(/í/g,"i").replace(/ú/g,"u").replace(/é/g,"e");return Fe.t(p,"iast","malayalam",F).replace(/(^|[^്])ര്(?=\S)/g,"$1ൎ").replace(/([കതനമര])്(?![^\s\u200C,—’―])/g,function(o,g){return C[g]})},grantha:function(h,w){const N=w||"",F={skip_sgml:!0},C=new Map([["സ",""],["ര","ർ"],["യ",""],["ച",""],["ദ",""],["ശ",""]]),k=new RegExp("(["+[...C.keys()].join("")+"])്(?![^‌ ,—’―])","g"),p=h.replace(/^_ā/,"ഽ‍ാ"),a=lt.smush(p,N).replace(/e/g,"ẽ").replace(/o/g,"õ").replace(/ṙ/g,"r").replace(/ṁ/g,"ṃ").replace(/ḿ/g,"ṃ").replace(/í/g,"i").replace(/ú/g,"u").replace(/é/g,"e");return Fe.t(a,"iast","malayalam",F).replace(/(^|[^്])ര്(?=\S)/g,"$1ൎ").replace(k,(g,v)=>C.get(v)).replace(/ക്ഷി/g,"க்ஷி")},tamil:function(h){lt.smush(h);const w=new Map([["ஂ","𑌀"],["ா","𑌾"],["ி","𑌿"],["ீ","𑍀"],["ு","𑍁"],["ூ","𑍂"],["ெ","𑍇"],["ே","𑍇"],["ை","𑍈"],["ொ","𑍋"],["ோ","𑍋"],["ௌ","𑍌"],["்","𑍍"],["ௗ","𑍗"]]),N=["𑌖","𑌗","𑌘","𑌛","𑌝","𑌠","𑌡","𑌢","𑌥","𑌦","𑌧","𑌫","𑌬","𑌭"],F=h.replace(/([kṅcñṭṇtnpmyrlvḻḷṟṉ])\s+([aāiīuūeēoō])/g,"$1$2").replace(/(^|\s)_ā/g,"$1அ‍ா").replace(/(\S)([AĀIĪUŪEĒOŌ])/g,"$1‌$2").replace(/(\S)·/g,"$1‌").toLowerCase(),C=new RegExp(`([${N.join("")}])([${[...w.keys()].join("")}])`,"g");return Fe.t(F,"iast","tamil").replace(C,function(p,a,o){return a+w.get(o)})},telugu:function(h,w){var N=w||"";const F={skip_sgml:!0},C=h.replace(/^_ā/,"ఽ‍ా"),k=lt.smush(C,N).replace(/e/g,"ẽ").replace(/o/g,"õ").replace(/ṙ/g,"r‍").replace(/ṁ/g,"ṃ").replace(/ḿ/g,"ṃ").replace(/í/g,"i").replace(/ú/g,"u").replace(/é/g,"e");return Fe.t(k,"iast","telugu",F)}},Yt=function(h,w,N=!1,F="sa"){const C=lt[w],k=h.cloneNode(!0),p=function(a,o){let g=a.childNodes;for(let v of g)if(v.nodeType!==8){if(v.nodeType===3){if(o!=="sa")continue;v.data=C(v.data,N)}else if(v.hasChildNodes()){let R=v.getAttribute("lang")||o;R==="sa"&&v.classList.contains("subst")&&Gn(v,w),p(v,R)}}};return p(k,F),k},vn=function(h,w=!1){if(h.nodeType===3)return h;const N=document.createTreeWalker(h,NodeFilter.SHOW_TEXT,null,!1);if(w){let F;for(;N.nextNode();)F=N.currentNode;return F}else return N.nextNode},Gn=function(h,w){if(h.firstChild.nodeType!==3&&h.lastChild.nodeType!==3)return;const N=h.childNodes,F=/^[aāiīuūeoṛṝḷṃḥ]/,C=/[kgṅcjñṭḍṇtdnpbmyrlvṣśsh]$/,k=["ā","i","ī","e","o","_","ai","au"],p=["h","k","ś","y","g","gh","c","ch","jh","ṭh","ḍ","ḍh","t","th","d","dh","n","p","ph","bh","m","r","ḻ","v","ṣ","s"];var a=!1,o=[],g=[];const v=N[0].nodeType===3;for(let R of N){if(R.nodeType>3)continue;const O=R.textContent.trim();if(O!==""){if(O==="a"){R.textContent="";continue}if(O.match(C)){const I=vn(R,!0);I.textContent=I.textContent.replace(/\s+$/,"")+"a",w==="telugu"&&p.indexOf(O)>=0&&o.push(R)}if(R===h.lastChild&&R.nodeType===3){const I=document.createElement("span");I.appendChild(R.cloneNode(!1)),h.replaceChild(I,R),R=I,R.classList.add("aalt")}else v&&O.match(F)&&R.classList.add("aalt");switch(w){case"devanagari":(O==="i"||O==="é")&&g.unshift(R);break;case"grantha":case"malayalam":if(O==="e"||O==="ai")g.unshift(R);else if(O==="o"){const I=R.cloneNode(!0);yn("o","e",I),g.unshift(I),yn("o","ā",R)}break;case"telugu":!a&&k.indexOf(O)>=0&&(a=!0);break}}}for(const R of g)h.insertBefore(R,h.firstChild);if(a)for(const R of o){const O=vn(R,!0);O.textContent=O.textContent+"‍్"}},yn=function(h,w,N){const F=document.createTreeWalker(N,NodeFilter.SHOW_TEXT,null,!1);for(;F.nextNode();)F.currentNode.textContent.match(h)&&(F.currentNode.textContent=w)},Un=`<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
        xmlns:x="http://www.tei-c.org/ns/1.0"
        exclude-result-prefixes="x">
<xsl:output method="text" omit-xml-declaration="yes"/>
    <xsl:strip-space elements="*"/>
    <xsl:template match="/">
        <xsl:apply-templates/>
    </xsl:template>
    <xsl:template match="para[content-style][not(text())]">
        <xsl:value-of select="normalize-space(.)"/>
    </xsl:template>

    <xsl:template match="x:teiHeader"/>

    <xsl:template match="x:teiCorpus">
        <xsl:apply-templates/>
    </xsl:template>
    <xsl:template match="x:TEI">
        <xsl:value-of select="@n"/><xsl:text>,</xsl:text>
        <xsl:apply-templates/>
        <xsl:text>&#xa;</xsl:text>
    </xsl:template>
    <xsl:template match="x:text">
        <xsl:apply-templates/>
    </xsl:template>
    <xsl:template match="x:w">
        <xsl:text>"</xsl:text><xsl:apply-templates/><xsl:text>"</xsl:text>
        <!--xsl:if test="not(position() = last())"-->
            <xsl:text>,</xsl:text>
        <!--/xsl:if-->
    </xsl:template>
    <!--xsl:template match="node()|@*">
        <xsl:copy>
            <xsl:apply-templates select="node()|@*"/>
        </xsl:copy>
    </xsl:template-->
</xsl:stylesheet>
`,Xn=`<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
        xmlns:x="http://www.tei-c.org/ns/1.0"
        exclude-result-prefixes="x">
    <xsl:output indent="yes"/>
    <xsl:template match="x:span">
        <xsl:apply-templates/>
    </xsl:template>
    <xsl:template match="para[content-style][not(text())]">
        <xsl:value-of select="normalize-space(.)"/>
    </xsl:template>
    <xsl:template match="x:teiHeader">
        <xsl:text>&#10;&#32;&#32;&#32;&#32;</xsl:text>
            <xsl:copy><xsl:apply-templates select="node()|@*"/></xsl:copy>
    </xsl:template>
    <xsl:template match="x:xenoData">
        <xsl:text>&#10;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;</xsl:text>
            <xsl:copy><xsl:apply-templates select="node()|@*"/></xsl:copy>
        <xsl:text>&#10;&#32;&#32;&#32;&#32;</xsl:text>
    </xsl:template>
    <xsl:template match="x:TEI">
        <xsl:text>&#10;&#32;&#32;&#32;&#32;</xsl:text>
            <xsl:copy><xsl:apply-templates select="node()|@*"/></xsl:copy>
    </xsl:template>
    <xsl:template match="x:text">
        <xsl:text>&#10;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;</xsl:text>
            <xsl:copy><xsl:apply-templates select="node()|@*"/></xsl:copy>
        <xsl:text>&#10;&#32;&#32;&#32;&#32;</xsl:text>
    </xsl:template>
    <xsl:template match="x:w">
        <xsl:copy><xsl:apply-templates select="node()|@*"/></xsl:copy>
        <!--xsl:if test="not(position() = last())">
            <xsl:text>&#32;</xsl:text>
        </xsl:if-->
    </xsl:template>
    <xsl:template match="node()|@*">
        <xsl:copy>
            <xsl:apply-templates select="node()|@*"/>
        </xsl:copy>
    </xsl:template>
</xsl:stylesheet>
`,Wn=`<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform" 
                xmlns:x="http://www.tei-c.org/ns/1.0"
                exclude-result-prefixes="x">
<xsl:output method="html"/>

<xsl:preserve-space elements="x:w"/>
<xsl:strip-space elements="x:cl"/>

<xsl:template match="x:teiHeader"/>

<xsl:template match="x:teiCorpus">
    <xsl:element name="table">
        <xsl:apply-templates/>
    </xsl:element>
</xsl:template>
<xsl:template match="x:TEI">
    <xsl:apply-templates/>
</xsl:template>
<xsl:template match="x:text">
    <xsl:element name="tr">
        <xsl:attribute name="data-n"><xsl:value-of select="../@n"/></xsl:attribute>
        <xsl:if test="../@corresp">
            <xsl:attribute name="data-treename"><xsl:value-of select="../@corresp"/></xsl:attribute>
            <xsl:attribute name="data-nodename"><xsl:value-of select="../@select"/></xsl:attribute>
        </xsl:if>
        <xsl:element name="th">
            <xsl:attribute name="scope">row</xsl:attribute>
            <xsl:attribute name="draggable">true</xsl:attribute>
            <xsl:value-of select="../@n"/>
        </xsl:element>
        <xsl:apply-templates/>
    </xsl:element>
</xsl:template>
<xsl:template match="x:w">
    <xsl:element name="td">
        <xsl:choose>
            <xsl:when test="parent::x:cl">
                <xsl:choose>
                    <xsl:when test="position() = '1'">
                        <xsl:attribute name="class">lemma group-start</xsl:attribute>
                    </xsl:when>
                    <xsl:when test="position() = last()">
                        <xsl:attribute name="class">lemma group-end</xsl:attribute>
                    </xsl:when>
                    <xsl:otherwise>
                        <xsl:attribute name="class">lemma group-internal</xsl:attribute>
                    </xsl:otherwise>
                </xsl:choose>
            </xsl:when>
            <xsl:otherwise>
                <xsl:attribute name="class">lemma</xsl:attribute>
            </xsl:otherwise>
        </xsl:choose>
        <xsl:if test="@lemma">
            <xsl:attribute name="data-normal"><xsl:value-of select="@lemma"/></xsl:attribute>
        </xsl:if>
        <xsl:if test="@emended">
            <xsl:attribute name="data-emended">true</xsl:attribute>
        </xsl:if>
        <xsl:attribute name="data-n">
            <xsl:value-of select="@n"/>
        </xsl:attribute>
        <xsl:if test="@insignificant='true'">
            <xsl:attribute name="data-insignificant">true</xsl:attribute>
        </xsl:if>
        <xsl:if test="@binary='true'">
            <xsl:attribute name="data-binary">true</xsl:attribute>
        </xsl:if>
        <xsl:apply-templates/>
    </xsl:element>
</xsl:template>
</xsl:stylesheet>
`,jn=`<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform" 
                xmlns:x="http://www.w3.org/1999/xhtml"
                exclude-result-prefixes="x">
<xsl:output method="html" omit-xml-declaration="yes"/>

<xsl:template match="x:pb">
    <xsl:element name="hr">
        <xsl:attribute name="data-n"><xsl:value-of select="@n"/></xsl:attribute>
    </xsl:element>
    <xsl:element name="img">
        <xsl:attribute name="class">editbutton</xsl:attribute>
        <xsl:attribute name="data-n"><xsl:value-of select="@n"/></xsl:attribute>
        <xsl:attribute name="src">edit_icon.svg</xsl:attribute>
    </xsl:element>
    <h3 class="pb" lang="en"><xsl:value-of select="@n"/></h3>
</xsl:template>

<xsl:template match="x:lb">
<br />
<span class="lb" lang="en"><xsl:value-of select="@n"/></span>
</xsl:template>

<xsl:template match="x:fw">
<div class="fw">(<i lang="en"><xsl:value-of select="@type"/>, <xsl:value-of select="@place"/></i>): <xsl:apply-templates/></div>
</xsl:template>

<xsl:template match="x:div[@type='story']">
    <span class="story" lang="en">(story no. <xsl:value-of select="@num"/>, <xsl:value-of select="@city"/>, <xsl:value-of select="@king"/>)</span>
    <xsl:apply-templates/>
</xsl:template>

<xsl:template match="x:div[@type='verse']">
    <span class="verse"><xsl:apply-templates /></span>
</xsl:template>

<xsl:template match="x:del">
    <xsl:variable name="rend" select="@rend"/>
    <xsl:element name="del">
        <xsl:attribute name="data-title">
            <xsl:text>deleted</xsl:text>
            <xsl:if test="string($rend)">
                <xsl:text> (</xsl:text>
                <xsl:value-of select="$rend"/>
                <xsl:text>)</xsl:text>
           </xsl:if>
        </xsl:attribute>
        <xsl:apply-templates/>
    </xsl:element>
</xsl:template>

<xsl:template match="x:add">
    <xsl:variable name="place" select="@place"/>
    <xsl:variable name="rend" select="@rend"/>
    <xsl:element name="ins">
        <xsl:attribute name="data-title">
            <xsl:text>added</xsl:text>
            <xsl:if test="string($rend) or string($place)">
                <xsl:text> (</xsl:text>
                <xsl:value-of select="$rend"/>
                <xsl:if test="string($rend) and string($place)">
                    <xsl:text>, </xsl:text>
                </xsl:if>
                <xsl:value-of select="$place"/>
                <xsl:text>)</xsl:text>
            </xsl:if>
        </xsl:attribute>
        <xsl:apply-templates/>
    </xsl:element>
</xsl:template>

<xsl:template match="x:subst">
    <span class="subst"><xsl:apply-templates /></span>
</xsl:template>

<xsl:template match="x:g">
    <xsl:element name="span">
        <xsl:attribute name="data-title"><xsl:value-of select="@rend"/></xsl:attribute>
        <xsl:attribute name="class">gaiji</xsl:attribute>
        <xsl:apply-templates/>
    </xsl:element>
</xsl:template>

<xsl:template match="x:lg">
  <xsl:element name="span">
    <xsl:attribute name="class">tree-verse</xsl:attribute>
    <xsl:attribute name="lang">en</xsl:attribute>
    <xsl:text>[verse </xsl:text>
    <xsl:value-of select="@n"/>
    <xsl:text>]</xsl:text>
  </xsl:element>
</xsl:template>

<xsl:template match="x:l">
  <xsl:element name="span">
    <xsl:attribute name="class">l</xsl:attribute>
    <xsl:apply-templates/>
  </xsl:element>
</xsl:template>
</xsl:stylesheet>
`,Yn=`<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform" 
                xmlns:x="http://www.tei-c.org/ns/1.0"
                exclude-result-prefixes="x">
<xsl:output method="html"/>
<xsl:template match="x:w">
    <xsl:element name="span">
        <xsl:attribute name="data-n"><xsl:value-of select="@n"/></xsl:attribute>
        <xsl:if test="@lemma">
            <xsl:attribute name="data-normal"><xsl:value-of select="@lemma"/></xsl:attribute>
        </xsl:if>
        <xsl:if test="@emended">
            <xsl:attribute name="data-emended"><xsl:value-of select="@emended"/></xsl:attribute>
        </xsl:if>
       <xsl:choose>
           <xsl:when test="not(normalize-space(.))">
                <xsl:attribute name="class">lemma invisible</xsl:attribute>
                <xsl:text>&#x00A0;</xsl:text>
            </xsl:when>
            <xsl:otherwise>
                <xsl:attribute name="class">lemma</xsl:attribute>
            </xsl:otherwise>
        </xsl:choose>
        <xsl:apply-templates/>
    </xsl:element>
    <xsl:text>&#173;</xsl:text>
</xsl:template>
<xsl:template match="x:cl">
    <xsl:element name="span">
        <xsl:attribute name="class">group</xsl:attribute>
        <xsl:apply-templates/>
    </xsl:element>
</xsl:template>
<xsl:template match="x:pb">
    <xsl:element name="hr">
        <xsl:attribute name="data-n"><xsl:value-of select="@n"/></xsl:attribute>
    </xsl:element>
    <xsl:element name="img">
        <xsl:attribute name="class">editbutton</xsl:attribute>
        <xsl:attribute name="data-n"><xsl:value-of select="@n"/></xsl:attribute>
        <xsl:attribute name="src">edit_icon.svg</xsl:attribute>
    </xsl:element>
    <h3 class="pb" lang="en"><xsl:value-of select="@n"/></h3>
</xsl:template>

<xsl:template match="x:lb">
<br />
<span class="lb" lang="en"><xsl:value-of select="@n"/></span>
</xsl:template>

<xsl:template match="x:fw">
<div class="fw">(<i lang="en"><xsl:value-of select="@type"/>, <xsl:value-of select="@place"/></i>): <xsl:apply-templates/></div>
</xsl:template>

<xsl:template match="x:div[@type='story']">
    <span class="story" lang="en">(story no. <xsl:value-of select="@num"/>, <xsl:value-of select="@city"/>, <xsl:value-of select="@king"/>)</span>
    <xsl:apply-templates/>
</xsl:template>

<xsl:template match="x:div[@type='verse']">
    <span class="verse"><xsl:apply-templates /></span>
</xsl:template>

<xsl:template match="x:del">
    <xsl:variable name="rend" select="@rend"/>
    <xsl:element name="del">
        <xsl:attribute name="data-title">
            <xsl:text>deleted</xsl:text>
            <xsl:if test="string($rend)">
                <xsl:text> (</xsl:text>
                <xsl:value-of select="$rend"/>
                <xsl:text>)</xsl:text>
           </xsl:if>
        </xsl:attribute>
        <xsl:apply-templates/>
    </xsl:element>
</xsl:template>

<xsl:template match="x:add">
    <xsl:variable name="place" select="@place"/>
    <xsl:variable name="rend" select="@rend"/>
    <xsl:element name="ins">
        <xsl:attribute name="data-title">
            <xsl:text>added</xsl:text>
            <xsl:if test="string($rend) or string($place)">
                <xsl:text> (</xsl:text>
                <xsl:value-of select="$rend"/>
                <xsl:if test="string($rend) and string($place)">
                    <xsl:text>, </xsl:text>
                </xsl:if>
                <xsl:value-of select="$place"/>
                <xsl:text>)</xsl:text>
            </xsl:if>
        </xsl:attribute>
        <xsl:apply-templates/>
    </xsl:element>
</xsl:template>

<xsl:template match="x:subst">
    <span class="subst"><xsl:apply-templates /></span>
</xsl:template>

<xsl:template match="x:g">
    <xsl:element name="span">
        <xsl:attribute name="data-title"><xsl:value-of select="@rend"/></xsl:attribute>
        <xsl:attribute name="class">gaiji</xsl:attribute>
        <xsl:apply-templates/>
    </xsl:element>
</xsl:template>

<xsl:template match="x:lg">
  <xsl:element name="span">
    <xsl:attribute name="class">lg</xsl:attribute>
    <xsl:apply-templates/>
  </xsl:element>
</xsl:template>

<xsl:template match="x:l">
  <xsl:element name="span">
    <xsl:attribute name="class">l</xsl:attribute>
    <xsl:apply-templates/>
  </xsl:element>
</xsl:template>
</xsl:stylesheet>
`,Kn=`<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform" 
                xmlns:x="http://www.w3.org/1999/xhtml"
                exclude-result-prefixes="x">
<xsl:output method="text" omit-xml-declaration="yes"/>
<xsl:template match="x:lg">
<xsl:value-of select="@n"/>
</xsl:template>
</xsl:stylesheet>
`,Ct=function(h){const N=new DOMParser().parseFromString(h,"text/xml"),F=new XSLTProcessor;return F.importStylesheet(N),F},Jn=function(h){this.transformString=function(w,N){const F=h.xml.createElementNS(h.teins,"ab");return F.innerHTML=w,N.transformToFragment(F,document)},this.sheets={csv:Ct(Un),xml:Ct(Xn),matrix:Ct(Wn),lemma:Ct(Yn),lg:Ct(Kn),tree:Ct(jn)}},Qn=function(h){const w={curxml(){return h.xml},teins(){return h.teins},basename(){return h.filename.split(/\.[^.]+$/)[0]},range(C,k){return Array.from(Array(parseInt(k)-parseInt(C)+1).keys(),p=>p+C)},maxlemma(){return[...w.firsttext().querySelectorAll("w[n]")].length-1},lemmata(C,k){const p=k||document.querySelector("#views");return C===!1?p.querySelectorAll(".lemma"):p.querySelectorAll(`.lemma[data-n="${C}"]`)},tds(C,k){const p=k||h.matrix.boxdiv;return C===!1?p.querySelectorAll("td[data-n]"):p.querySelectorAll(`td[data-n="${C}"]`)},firsttd(C,k){return(k||h.matrix.boxdiv).querySelector(`td[data-n="${C}"]`)},tr(C){return h.matrix.boxdiv.querySelector(`tr[data-n="${C}"]`)},trs(C){return(C||h.matrix.boxdiv).querySelectorAll("tr[data-n]")},firsttr(C){return(C||h.matrix.boxdiv).querySelector("tr[data-n]")},lasttr(C){return(C||h.matrix.boxdiv).querySelector("tr[data-n]:last-of-type")},trWalker(C){return document.createNodeIterator(C,NodeFilter.SHOW_ELEMENT,{acceptNode:function(k){if(k.tagName==="TD")return NodeFilter.FILTER_ACCEPT}},!1)},textWalker(C){return document.createNodeIterator(C,NodeFilter.SHOW_ELEMENT,{acceptNode:function(k){if(k.tagName.toLowerCase()==="w")return NodeFilter.FILTER_ACCEPT}},!1)},tei(C,k=h.xml){return k.querySelector(`TEI[n="${C}"]`)},teis(C=h.xml){return C.querySelectorAll("TEI")},texts(C){return(C||h.xml).querySelectorAll("text")},serializedtexts(C,k){const p=[...C.querySelectorAll("otu[label]")].map(o=>o.getAttribute("label"));return[...w.teis()].filter(o=>p.indexOf(o.getAttribute("n"))!==-1).map(o=>[C.querySelector(`node[label="${o.getAttribute("n")}"]`).getAttribute("id"),[...o.querySelectorAll("w")].map(g=>k&&g.hasAttribute("lemma")?g.getAttribute("lemma"):g.textContent)])},serializedlevels(C){return C.map(k=>{if(k instanceof Map){const p=new Map;for(const[a,o]of k)p.set(a.getAttribute("id"),o.map(g=>g.getAttribute("id")));return p}else return k.map(p=>p.getAttribute("id"))})},firsttext(C){return C?h.xml.querySelector(`[n="${C}"] text`):h.xml.querySelector("text")},words(C,k){const p=k||h.xml;return C===!1?p.querySelectorAll("w[n]"):p.querySelectorAll(`w[n="${C}"]`)},firstword(C,k){return(k||h.xml).querySelector(`w[n="${C}"]`)},normal(C){return(C||document.getElementById("views")).querySelectorAll(".lemma[data-normal], .tree-lemma[data-normal]")},htmlreading(C,k){return k&&C.dataset.normal?C.dataset.normal:C.IAST.textContent},ths(){return h.matrix.boxdiv.querySelectorAll("th[data-ref]")},firstth(C){return h.matrix.boxdiv.querySelector(`th[data-ref="${C}"]`)},checkbox(C,k){return h.matrix.boxdiv.querySelector(`th[data-ref="${C}"] input.${k}`)},highlit(){const k=w.firsttr().querySelectorAll(".highlit"),p=new Set;for(const a of k)p.add(a.dataset.n);return p},highlitcell(){return h.matrix.boxdiv.querySelector("td.highlitcell")},highlitrow(){const C=w.highlitcell();return C?C.closest("tr"):!1},lowhigh(C){const k=[...C].sort((o,g)=>parseInt(o)-parseInt(g)),p=parseInt(k[0]),a=k.length>1?parseInt(k[k.length-1]):void 0;return[p,a]},readings(C,k){const p=k||h.matrix.boxdiv,a=w.tds(C,p);var o=0;const g=new Set;for(const v of a){const R=v.textContent;R!==""&&(o++,g.add(R))}return[o,g.size]},attr(C,k){const p=w.firsttr();var a=[];for(const o of k)w.firsttd(o,p).dataset[C]==="true"?a.push([o,!0]):a.push([o,!1]);return new Map(a)},whichattr(C){return C.hasAttribute("n")?"n":C.hasAttribute("data-n")?"data-n":C.hasAttribute("data-ref")?"data-ref":!1},clauses(C,k=!1){const p=w.firsttext();var a=!1;const o=new Set;for(const v of C){const O=w.firstword(v,p).closest("cl");O?o.add(O):k&&(a=!0)}if(o.size===0)return!1;const g=[...o].map(v=>{const R=v.querySelectorAll("w");return new Set([...R].map(O=>O.getAttribute("n")))});return a?[null].concat(g):g},clausesToRemove(C,k,p=0){const a=new Set;for(const o of C){const g=new Set(o);for(const v of k)g.delete(v);g.size<=p&&a.add(o)}return[...a]},empty(){const C=new Set,k=[...w.trs()],p=k.map(g=>w.trWalker(g)),a=k[0].querySelector("td:last-of-type").dataset.n;for(let g=0;g<=a;g++){var o=!0;for(const v of p){const R=v.nextNode();o&&R.textContent!==""&&(o=!1)}o&&C.add(g)}return C},emptyRows(C=!1){const k=w.trs(),p=new Set;for(let a=0;a<k.length;a++){const o=w.tds(!1,k[a]);(()=>{for(const v of o)if(v.textContent!=="")return!1;return!0})()&&(C?p.add(k[a].dataset.n):p.add(a))}return p},prevNonempty(C,k){for(let p=C;p>=0;p--)if(k[p].textContent!=="")return p;return!1},nextNonempty(C,k){for(let p=C;p<k.length;p++)if(k[p].textContent!=="")return p;return!1},cursorPos(C){const k=window.getSelection().getRangeAt(0),p=k.cloneRange();p.selectNodeContents(C);const a=p.toString().length;return p.setEnd(k.endContainer,k.endOffset),[p.toString().length,a]},selection(){const C=window.getSelection();if(C.isCollapsed)return!1;const k=C.rangeCount>1?C.getRangeAt(1).cloneContents():C.getRangeAt(0).cloneContents();if(!k)return!1;const p=new Set,a=k.querySelectorAll(".lemma");for(const o of a)p.add(o.dataset.n);return p}},N={undo(){return h.undo.length>0},redo(){return h.redo.length>0},checkbox(C,k=null){if(!N.anyhighlit())return!1;const p=k===null?w.highlit():k,a=w.attr(C,p);for(const o of a.values())if(o===!1)return!1;return!0},grouped(){const C=w.highlit();if(!C)return!1;const k=w.firsttr();for(const p of C){const a=w.firsttd(p,k);if(a.classList.contains("group-start")||a.classList.contains("group-internal")||a.classList.contains("group-end"))return!0}return!1},oneGrouped(){const C=w.highlit();if(C.size===0)return!1;if(C.size===1){const k=w.firsttr(),p=w.firsttd([...C][0],k);return!!(p.classList.contains("group-start")||p.classList.contains("group-end")||p.classList.contains("group-internal"))}return!0},anyhighlit(){return!!h.matrix.boxdiv.querySelector("td.highlit")},manyhighlit(){return w.highlit().size>1},highlitcell(){return!!h.matrix.boxdiv.querySelector("td.highlitcell")},normalizedView(){return document.getElementById("views").classList.contains("normalized")},anyNormalized(){return h.matrix.boxdiv.querySelector(".lemma[data-normal]")},headerView(){return h.matrix.boxdiv.querySelector("tr.header").style.display!=="none"}},F={tei:function(C){const k=h.xml.createElementNS(h.teins,"TEI");k.setAttribute("n",C);const p=w.firsttext().cloneNode(!0);k.appendChild(p);for(const a of w.words(!1,p))for(a.removeAttribute("lemma");a.firstChild;)a.firstChild.remove();return k},xmlel:function(C,k=h.xml){return k.createElementNS(h.teins,C)},emptycell:function(C){const k=document.createElement("td");return k.className="lemma",k.dataset.n=C,k},emptyword:function(C,k=h.xml){const p=k.createElementNS(h.teins,"w");return p.setAttribute("n",C),p},emptywords:function(C,k,p){const a=k||h.maxlemma,o=p||0;for(let g=o;g<=a;g++){const v=F.emptyword(g);C.appendChild(v)}},row:function(C,k){const p=document.createElement("tr"),a=document.createElement("th");a.scope="row",a.draggable=!0,a.appendChild(document.createTextNode(C)),p.dataset.n=C,p.appendChild(a);const o=w.firsttr();for(const g of o.querySelectorAll("td")){const v=document.createElement("td");v.dataset.n=g.dataset.n,v.className=g.className,k&&v.classList.add(k),p.appendChild(v)}return p},blackout(C,k){const p=document.createElement("div");p.id="blackout",p.appendChild(C),document.body.appendChild(p);const a=function(v){k(v),p.parentNode.removeChild(p)},o=function(v){if(!v.target.closest(".popup")){const O=document.querySelector("#blackout");O.parentNode.removeChild(O)}};p.querySelector("button").addEventListener("click",a),p.addEventListener("click",o)}};return{find:w,check:N,make:F}},Zn=function(h,w){const N={Intersection:function(...a){const o=a[0];return new Set([...o].filter(g=>{for(let v=1;v<a.length;v++)if(!a[v].has(g))return!1;return!0}))},Union:function(...a){return new Set(a.reduce((o,g)=>(o=[...o,...g],o),[]))}},F=function(a){const o=new Map;for(const g of w[0]){const v=h.get(g),R=v!==void 0?[v]:[];o.set(g,new Set(R))}for(let g=1;g<w.length;g++)for(const[v,R]of w[g]){const O=R.map(M=>o.get(M)),I=N.Intersection(...O);if(a&&v===a&&I.size===1)return[...I][0];const T=I.size>0?I:N.Union(...O);o.set(v,T)}return o},C=function(a,o){const g=w[0],v=new Map;for(const R of w[w.length-1])v.set(R[0],a.get(R[0]));for(let R=w.length-1;R>1;R--)for(const[O,I]of w[R]){const T=v.get(O);for(const M of I){if(g.indexOf(M)!==-1)continue;const G=a.get(M),W=(()=>{if(G.size===1)return G;const U=N.Intersection(T,G);return U.size>0?U:G})();if(o&&M===o)return W;v.set(M,W)}}return o?v.get(o):v},k=function(a=null){const o=F(a);if(typeof o=="string")return o;const g=C(o,a);return a?p(g):new Map(Array.from(g,([v,R])=>[v,p(R,!0)]))},p=function(a,o=!1){if(!o&&a.size===1)return[...a][0].trim();const g=[...a].map(v=>v.trim()===""?"_":v);return g.length===1?g[0]:"{"+g.join(", ")+"}"};return{run:k}},er=function(h,w){const N=h.find,F=h.make,C=N.teins(),k={write:async function(p,a){const o=await a.createWritable();o.write(p),o.close()},xml:async function(p){const a=new XMLSerializer().serializeToString(w.sheets.xml.transformToDocument(p)),o=new Blob([a],{type:"text/xml;charset=utf-8"}),g=N.basename()+".xml",v=await jt({_preferPolyfill:!1,suggestedName:g,types:[{description:"TEI XML",accept:{"text/xml":[".xml"]}}]});k.write(o,v)},csv:async function(p){const a=w.sheets.csv.transformToDocument(p).documentElement.textContent,o=new Blob([a],{type:"text/csv;charset=utf-8"}),g=N.basename()+".csv",v=await jt({_preferPolyfill:!1,suggestedName:g,types:[{description:"CSV file",accept:{"text/csv":[".csv"]}}]});k.write(o,v)},nexus:async function(p){const a=[...N.texts(p)],o=a.length,g="0 1 2 3 4 5 6 7 8 9 A B C D E F G H K L M N P Q R S T U V W X Y Z a b c d e f g h k l m n p q r s t u v w x y z",[v,...R]=g.split(" "),O="-",I=a.map(K=>"'"+K.parentElement.getAttribute("n")+"'"),T=a.map(K=>N.textWalker(K)),M=a[0].querySelectorAll("w").length,G=[],W=I.map(K=>[K+" "]);for(let K=0;K<M;K++){const j=new Set,D=[];for(let ne=0;ne<T.length;ne++){const me=T[ne].nextNode(),Y=Fe.t(me.textContent.trim().toLowerCase(),"iast","hk").replace(/'/g,"()");D.push(Y),Y!==""&&Y!=="[]"&&j.add(Y)}G.push(["[]",...j]);const ce=new Map([...j].map((ne,xe)=>[ne,R[xe]]));for(let ne=0;ne<D.length;ne++){const xe=(me=>{switch(D[me]){case"":return O;case"[]":return v;default:return ce.get(D[me])}})(ne);W[ne].push(xe)}}const U=G.map((K,j)=>j+1+" / "+[...K].map(D=>`'${D}'`).join(" ")).join(`,
`),V=W.map(K=>K.join("")).map(K=>K.replace(/0{8,}/g,j=>j.replace(/0/g,"-"))).reduce((K,j)=>K+`
`+j),ae=`#NEXUS

BEGIN TAXA;
  DIMENSIONS NTAX=${o};
  TAXLABELS ${I.join(" ")};
END;

BEGIN CHARACTERS;
  DIMENSIONS
    NCHAR=${M};
  FORMAT 
    DATATYPE=STANDARD 
    RESPECTCASE 
    GAP=${O} 
    MISSING=? 
    SYMBOLS="${g}";
  CHARSTATELABELS
${U}
;
MATRIX
${V}
;
END;
`,de=new Blob([ae],{type:"text/nexus;charset=iso8859-1"}),be=N.basename()+".nex",z=await jt({_preferPolyfill:!1,suggestedName:be,types:[{description:"NEXUS file",accept:{"text/nexus":[".nex"]}}]});k.write(de,z)},processOptions:function(p){const a=N.curxml().cloneNode(!0);if(p.get("option_normalize")){const o=a.querySelectorAll("w[lemma]");for(const g of o)g.textContent=g.getAttribute("lemma")}if(p.get("option_mergegroups")){const o=a.querySelectorAll("cl");for(const g of o){const v=g.removeChild(g.firstChild);for(;g.firstChild;){const R=v.getAttribute("lemma")||v.textContent,O=g.firstChild.getAttribute("lemma")||g.firstChild.textContent;for(v.setAttribute("lemma",R+O);g.firstChild.firstChild;)v.appendChild(g.firstChild.firstChild);g.firstChild.remove()}v.getAttribute("lemma")===v.textContent&&v.removeAttribute("lemma"),g.parentNode.insertBefore(v,g),g.parentNode.removeChild(g)}}if(p.get("option_insignificant")){const o=a.querySelectorAll('w[insignificant="true"]');for(const g of o)g.parentNode.removeChild(g)}if(p.get("option_binary")){const g=[...N.firsttext().querySelectorAll('w[binary="true"]')].map(v=>v.getAttribute("n"));for(const v of g){const R=a.querySelectorAll(`w[n="${v}"]:not(:empty)`);if(R.length===0)continue;const O=`[${R[0].textContent}]`;for(const I of R)I.textContent=O}}if(p.get("option_noempty")){const o=a.querySelectorAll("w:empty");for(const g of o)g.textContent="[]"}return p.get("option_basetext")?k.makeApp(p,a):a},makeHeader(p,a){const o=p.createElementNS(C,"teiHeader"),g=p.createElementNS(C,"fileDesc"),v=p.createElementNS(C,"sourceDesc"),R=p.createElementNS(C,"msDesc"),O=p.createElementNS(C,"msIdentifier"),I=p.createElementNS(C,"abbr");I.setAttribute("type","siglum"),I.append(p.documentElement.getAttribute("n")),O.appendChild(I),R.appendChild(O),v.appendChild(R);const T=a.querySelector("listWit");if(T)v.appendChild(T);else{const M=p.createElementNS(C,"listWit");for(const G of N.teis(a)){const W=G.getAttribute("n"),U=p.createElementNS(C,"witness");U.setAttribute("xml:id",W);const V=p.createElementNS(C,"abbr");V.setAttribute("type","siglum"),V.append(W),U.appendChild(V),M.appendChild(U)}v.appendChild(M)}return g.appendChild(v),o.appendChild(g),o},makeApp(p,a){const o=p.get("option_basetext"),g=N.tei(o,a),v=p.get("option_app_normalize"),R=document.implementation.createDocument(C,"",null);R.appendChild(g);const O=R.createElementNS(C,"body"),I=R.createElementNS(C,"p"),T=g.querySelector("text");for(;T.firstChild;)I.appendChild(T.firstChild);O.appendChild(I),T.appendChild(O);const M=k.makeHeader(R,a);g.insertBefore(M,g.firstChild),R.documentElement.getAttribute("n");const G=N.words(!1,g);for(const W of G){const U=W.getAttribute("n"),V=v&&W.getAttribute("lemma")||W.textContent,ae=new Set,de=new Map,be=N.words(U,a);for(const z of be){const K=z.closest("TEI").getAttribute("n");if(v&&z.getAttribute("lemma")===V)ae.add(K);else if(z.textContent===V)ae.add(K);else{const j=z.textContent===""?"[om.]":z.textContent,D=de.get(j)||[];D.push(K),de.set(j,D)}}if(de.size===0)for(;W.firstChild;)W.parentElement.insertBefore(W.firstChild,W);else{const z=R.createElementNS(C,"app"),K=R.createElementNS(C,"lem"),j=[...ae].map(D=>`#${D}`).join(" ");for(j!==""&&K.setAttribute("wit",j);W.firstChild;)K.appendChild(W.firstChild);z.appendChild(K);for(const[D,ce]of de){const ne=R.createElementNS(C,"rdg"),xe=ce.map(me=>`#${me}`).join(" ");ne.setAttribute("wit",xe),ne.append(D),z.appendChild(ne)}W.parentElement.insertBefore(z,W),K.textContent.match(/\s$/)&&(W.parentElement.insertBefore(R.createTextNode(" "),W),K.textContent=K.textContent.trimEnd())}W.remove()}return R},options(){return document.createRange().createContextualFragment(`<div id="exportoptions" class="popup">
    <form id="exportform">
      <div style="font-weight: bold">Export</div>
      <div>
        <input type="checkbox" id="option_insignificant" name="option_insignificant"><label for="option_insignificant">Remove insignifiant lemmata</label>
      </div>
      <div>
        <input type="checkbox" id="option_binary" name="option_binary"><label for="option_binary">Binarize marked lemmata</label>
      </div>
      <div>
        <input type="checkbox" id="option_noempty" name="option_noempty"><label for="option_noempty">Gaps are significant</label>
      </div>
      <div>
        <input type="checkbox" id="option_mergegroups" name="option_mergegroups"><label for="option_mergegroups">Merge groups</label>
      </div>
      <div>
        <input type="checkbox" id="option_normalize" name="option_normalize"><label for="option_normalize">Normalize spellings</label>
      </div>
      <div>
        <button type="submit">Export</button>
      </div>
    </form>
</div>`)},appOptions(){const p=document.createRange().createContextualFragment(`<div id="exportoptions" class="popup">
    <form id="exportform">
      <div style="font-weight: bold">Export</div>
      <div>
        <label for="option__basetext">Base text</label>
        <select id="option__basetext" name="option_basetext"></select>
      </div>
      <div>
        <input type="checkbox" id="option__app_insignificant" name="option_app_insignificant"><label for="option_app_insignificant">Ignore insignifiant lemmata</label>
      </div>
      <div>
        <input type="checkbox" id="option_mergegroups" name="option_mergegroups" checked><label for="option_mergegroups">Merge groups</label>
      </div>
      <div>
        <input type="checkbox" id="option_app_normalize" name="option_app_normalize" checked><label for="option_app_normalize">Normalized spellings in positive apparatus</label>
      </div>
      <div>
        <input type="checkbox" id="option_normalize" name="option_normalize"><label for="option_normalize">Normalize spellings in negative apparatus</label>
      </div>
      <div>
        <button type="submit">Export</button>
      </div>
    </form>
</div>`),a=p.getElementById("option__basetext"),o=[...N.trs()].map(g=>g.dataset.n);for(const g of o){const v=document.createElement("option");v.value=g,v.append(g),a.appendChild(v)}return p},showOptions:function(p,a){const o=a(),g=function(v){v.preventDefault();var R=[];const O=document.getElementById("exportform").elements;for(const T of O)T.type==="checkbox"?R.push([T.name,T.checked]):R.push([T.name,T.value]);const I=k.processOptions(new Map(R));p(I)};F.blackout(o,g)},saveAs:function(){const p=N.curxml().cloneNode(!0);k.xml(p)}};return k},tr=function(h){const{find:w,check:N,make:F}=h;return{group:function(p){const a=[...p],o=a.shift(),g=w.texts();for(const R of g){const O=F.xmlel("cl"),I=w.firstword(o,R);I.parentNode.insertBefore(O,I),O.appendChild(I);for(const T of p)O.appendChild(w.firstword(T,R))}const v=a.pop();for(const R of w.tds(o))R.classList.add("group-start");for(const R of w.tds(v))R.classList.add("group-end");for(const R of a)for(const O of w.tds(R))O.classList.add("group-internal")},ungroup:function(p){const a=w.texts();for(const g of a){let v;for(const R of p){const O=w.firstword(R,g);v||(v=O.closest("cl")),v.parentNode.insertBefore(O,v)}v.parentNode.removeChild(v)}const o=[...p].flatMap(g=>[...w.tds(g)]);for(const g of o)g.classList.remove("group-start","group-internal","group-end")}}};function Bt(h){var w=[],N=0;if(this.trie=this.createTrie(h.patterns),this.leftMin=h.leftmin,this.rightMin=h.rightmin,this.exceptions={},h.exceptions)for(w=h.exceptions.split(/,\s?/g);N<w.length;N+=1)this.exceptions[w[N].replace(/\u2027/g,"").toLowerCase()]=new RegExp("("+w[N].split("‧").join(")(")+")","i")}Bt.TrieNode;Bt.prototype.createTrie=function(h){var w=0,N=0,F=0,C=0,k=null,p=null,a=null,o=null,g={_points:[]},v;for(w in h)if(h.hasOwnProperty(w))for(v=h[w].match(new RegExp(".{1,"+ +w+"}","g")),N=0;N<v.length;N+=1){for(k=v[N].replace(/[0-9]/g,"").split(""),p=v[N].split(/\D/),o=g,F=0;F<k.length;F+=1)a=k[F].charCodeAt(0),o[a]||(o[a]={}),o=o[a];for(o._points=[],C=0;C<p.length;C+=1)o._points[C]=p[C]||0}return g};Bt.prototype.hyphenateText=function(h,w){w=w||4;for(var N=h.split(/([a-zA-Z0-9_\u0027\u00AD\u00DF-\u00EA\u00EB\u00EC-\u00EF\u00F1-\u00F6\u00F8-\u00FD\u0101\u0103\u0105\u0107\u0109\u010D\u010F\u0111\u0113\u0117\u0119\u011B\u011D\u011F\u0123\u0125\u012B\u012F\u0131\u0135\u0137\u013C\u013E\u0142\u0144\u0146\u0148\u0151\u0153\u0155\u0159\u015B\u015D\u015F\u0161\u0165\u016B\u016D\u016F\u0171\u0173\u017A\u017C\u017E\u017F\u0219\u021B\u02BC\u0390\u03AC-\u03CE\u03F2\u0401\u0410-\u044F\u0451\u0454\u0456\u0457\u045E\u0491\u0531-\u0556\u0561-\u0587\u0902\u0903\u0905-\u090B\u090E-\u0910\u0912\u0914-\u0928\u092A-\u0939\u093E-\u0943\u0946-\u0948\u094A-\u094D\u0982\u0983\u0985-\u098B\u098F\u0990\u0994-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BE-\u09C3\u09C7\u09C8\u09CB-\u09CD\u09D7\u0A02\u0A03\u0A05-\u0A0A\u0A0F\u0A10\u0A14-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A82\u0A83\u0A85-\u0A8B\u0A8F\u0A90\u0A94-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABE-\u0AC3\u0AC7\u0AC8\u0ACB-\u0ACD\u0B02\u0B03\u0B05-\u0B0B\u0B0F\u0B10\u0B14-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3E-\u0B43\u0B47\u0B48\u0B4B-\u0B4D\u0B57\u0B82\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB5\u0BB7-\u0BB9\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD7\u0C02\u0C03\u0C05-\u0C0B\u0C0E-\u0C10\u0C12\u0C14-\u0C28\u0C2A-\u0C33\u0C35-\u0C39\u0C3E-\u0C43\u0C46-\u0C48\u0C4A-\u0C4D\u0C82\u0C83\u0C85-\u0C8B\u0C8E-\u0C90\u0C92\u0C94-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBE-\u0CC3\u0CC6-\u0CC8\u0CCA-\u0CCD\u0D02\u0D03\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D28\u0D2A-\u0D39\u0D3E-\u0D43\u0D46-\u0D48\u0D4A-\u0D4D\u0D57\u0D60\u0D61\u0D7A-\u0D7F\u1F00-\u1F07\u1F10-\u1F15\u1F20-\u1F27\u1F30-\u1F37\u1F40-\u1F45\u1F50-\u1F57\u1F60-\u1F67\u1F70-\u1F7D\u1F80-\u1F87\u1F90-\u1F97\u1FA0-\u1FA7\u1FB2-\u1FB4\u1FB6\u1FB7\u1FBD\u1FBF\u1FC2-\u1FC4\u1FC6\u1FC7\u1FD2\u1FD3\u1FD6\u1FD7\u1FE2-\u1FE7\u1FF2-\u1FF4\u1FF6\u1FF7\u200D\u2019]+)/gi),F=0;F<N.length;F+=1)N[F].indexOf("/")!==-1?F!==0&&F!==N.length-1&&!/\s+\/|\/\s+/.test(N[F])&&(N[F]+="​"):N[F].length>w&&(N[F]=this.hyphenate(N[F]).join("­"));return N.join("")};Bt.prototype.hyphenate=function(h){var w,N=[],F,C,k,p,a,o=[],g,v=h.toLowerCase(),R,O,I=Math.max,T=this.trie,M=[""];if(this.exceptions.hasOwnProperty(v))return h.match(this.exceptions[v]).slice(1);if(h.indexOf("­")!==-1)return[h];for(h="_"+h+"_",w=h.toLowerCase().split(""),F=h.split(""),g=w.length,C=0;C<g;C+=1)o[C]=0,N[C]=w[C].charCodeAt(0);for(C=0;C<g;C+=1)for(a=T,k=C;k<g&&(a=a[N[k]],a);k+=1)if(R=a._points,R)for(p=0,O=R.length;p<O;p+=1)o[C+p]=I(o[C+p],R[p]);for(C=1;C<g-1;C+=1)C>this.leftMin&&C<g-this.rightMin&&o[C]%2?M.push(F[C]):M[M.length-1]+=F[C];return M};var nr=Bt;const rr=wn(nr),sr={id:"sa",leftmin:2,rightmin:2,patterns:{2:"a1e1i1o1u1é1í1ï1ó1ú1ü1ā1ī1ū1ḷ1ḹ1ṛ1ṝ1",3:"2b_2c_2d_2g_2h_2j_2k_2l_2m_2n_2p_2r_2s_2t_2v_2y_2ñ_2ś_2ḍ_2ḥ12ḫ12ḷ_2ṁ12ṃ12ṅ_2ṇ_2ṭ_2ẖ1l̥1r̥1",4:"2bh_2ch_2dh_2gh_2jh_2kh_2m̐12ph_2rb_2rd_2rg_2rk_2rp_2rt_2rḍ_2rṭ_2th_2ḍh_2ṭh_a2i1a2u1a3ï1a3ü1l̥̄1r̥̄1"}};window.comboView=function(){const h={teins:"http://www.tei-c.org/ns/1.0",scripts:["iast","devanagari","telugu","grantha","malayalam"],filename:null,xml:null,treelist:new Map,trees:[],textboxes:[],matrix:null,viewdiv:null,descs:null,maxlemma:null,windows:[window],dragged:null,draganchor:null,undo:[],redo:[],editing:!1},w=new rr(sr),N=new Jn(h),F=new Qn(h),C=new tr(F),k=new er(F,N),{find:p,check:a,make:o}=F,g=function(){const c=document.getElementById("tooltip");c&&c.remove()},v={matrix:function(){return h.matrix=new ve,h.matrix.init(),h.matrix.show(),document.getElementById("matrixmenu").style.display="none",R(),M.rehighlight(),h.matrix},text:function(c){const d=new fe(c);return h.textboxes.push(d),d.init(),d.show(),R(),M.rehighlight(),document.querySelector(".highlit")||j.textClick({target:d.boxdiv.querySelector(".lemma:not(.invisible)")}),d},tree:function(c,d){const t=new he(c,d);return h.trees.push(t),t.init(),t.show(),R(),M.rehighlight(),t}},R=function(){for(const c of h.trees)c.draw()},O=function(){const c=window.getSelection?window.getSelection():document.selection;c&&(c.removeAllRanges?c.removeAllRanges():c.empty&&c.empty())},I=function(c){const d=document.createTreeWalker(c,NodeFilter.SHOW_TEXT);for(;d.nextNode();){const t=T(d.currentNode.nodeValue);d.currentNode.nodeValue=t}},T=function(c){return w.hyphenateText(c.replace(/ \|/g," |").replace(/\| (?=\d)/g,"| ").replace(/\|\|/g,"॥").replace(/\|/g,"।"))},M={getAllWindows:function(){return window.mainWindow?window.mainWindow.comboView.getWindows():h.windows},forEachWindow:function(c){const d=M.getAllWindows();for(const t of d)if(!t.closed&&c(t)===!1)break},highlightLemma:function(c,d){var t=!!d;M.forEachWindow(n=>{const s=n.comboView.getViewdiv().querySelectorAll('[data-n="'+c+'"]');for(const f of s)(!t||!f.classList.contains("invisible"))&&f.classList.add("highlit");const u=n.comboView.getViewdiv().querySelectorAll('[data-n-trans="'+c+'"]');for(const f of u)f.classList.add("translit")})},highlightRange:function(c){if(!c||c.size===0)return;M.unHighlightAll();const[d,t]=p.lowhigh(c);if(t!==void 0)for(let n=d;n<=t;n++)M.highlightLemma(n,!0);else M.highlightLemma(d);M.repopulateTrees(d,t);for(const n of h.viewdiv.querySelectorAll(".text-box"))n.querySelector(".highlit")||n.querySelector('[data-n="'+d+'"]').classList.add("highlit");ce.xScroll(d)},highlightAll:function(){a.anyhighlit()?M.unHighlightAll():M.highlightRange(new Set([0,p.maxlemma()]))},unHighlightAll:function(){M.forEachWindow(c=>{const d=c.comboView.getViewdiv().querySelectorAll(".highlit");for(const n of d)n.classList.remove("highlit");const t=c.comboView.getViewdiv().querySelectorAll(".translit");for(const n of t)n.classList.remove("translit");M.unCelllightAll()})},unCelllightAll:function(){M.forEachWindow(c=>{const d=c.comboView.getViewdiv().querySelectorAll(".highlitcell");for(const t of d)t.classList.remove("highlitcell")})},rehighlight:function(){var c;if(M.forEachWindow(t=>{if(c=t.document.querySelectorAll(".highlit"),c.length>0)return!1}),c.length>0){var d=new Set;for(const t of c)d.add(t.dataset.n);M.highlightRange(d)}},clearTrees:function(){M.forEachWindow(c=>{const d=c.comboView.getTrees();for(const t of d)t.clearlemmata()})},repopulateTrees:function(c,d){M.forEachWindow(t=>{const n=t.comboView.getTrees();for(const s of n)s.populate(c,d),s.colourizeVariants(c,d),s.updatescript()})},highlightTreeLemma:function(c){M.forEachWindow(d=>{const t=d.comboView.getTrees();for(const n of t){const s=n.boxdiv.querySelector('.tree-lemma[data-id="'+c+'"]'),u=n.boxdiv.querySelectorAll(".tree-lemma");for(const f of u)(s.dataset.nodes&&f.dataset.nodes===s.dataset.nodes||!s.dataset.nodes&&f.dataset.id===s.dataset.id)&&f.classList.add("highlit");n.clearLabels()}})},unhighlightTrees:function(){M.forEachWindow(c=>{const d=c.comboView.getViewdiv().querySelectorAll(".tree-lemma.highlit");for(const n of d)n.classList.remove("highlit");const t=c.comboView.getTrees();for(const n of t)n.clearLabels()})}},G=function(c,d){const t=d.target.files[0],n=[...d.target.files].slice(1),s=new FileReader;s.onload=c.bind(null,t,n),s.readAsText(t)},W=function(c,d,t){h.filename=c.name,document.title=document.title+`: ${h.filename}`,h.filename.split(".").pop()==="csv"?ae(c,d,t):de(c,d,t)},U=function(c,d,t){const n=t.target.result,u=new DOMParser().parseFromString(n,"text/xml"),f=h.xml.querySelector("teiHeader > xenoData")||function(){const b=h.xml.querySelector("teiHeader")||function(){const P=o.xmlel("teiHeader");return h.xml.documentElement.appendChild(P),P}(),B=o.xmlel("xenoData");return b.appendChild(B),B}(),x=o.xmlel("stemma");x.setAttribute("format","nexml"),x.id="stemma"+[...f.querySelectorAll("stemma")].length,x.appendChild(u.firstChild.cloneNode(!0)),f.appendChild(x),V(u,x.id)},V=function(c,d,t=!0){const n=c.querySelectorAll("tree"),s=document.querySelector("#treemenu ul");for(const u of n){const f=u.id,x=c.cloneNode(!0);for(const P of x.querySelectorAll("tree"))P.id!==f&&P.parentNode.removeChild(P);const b=u.getAttribute("label")||"New Tree "+h.treelist.size;h.treelist.set(`#${d} #${f}`,x);const B=document.createElement("li");B.dataset.name=b,B.dataset.treeid=f,B.dataset.stemmaid=d,B.appendChild(document.createTextNode(b)),s.insertBefore(B,s.lastElementChild),t&&v.tree(d,f)}},ae=function(c,d,t){const n=bn.parse(t.target.result,{delimiter:","});h.xml=document.implementation.createDocument(h.teins,"",null);const s=o.xmlel("teiCorpus"),u=o.xmlel("teiHeader");s.appendChild(u),h.xml.appendChild(s);for(const f of n){const x=f[0],b=f.slice(1),B=o.xmlel("TEI");B.setAttribute("n",x);const P=o.xmlel("text");for(let $=0;$<b.length;$++){const X=b[$],te=o.xmlel("w");X&&te.appendChild(document.createTextNode(X)),te.setAttribute("n",$),P.appendChild(te)}B.appendChild(P),s.appendChild(B)}h.xml.normalize(),h.maxlemma=p.maxlemma(),K()},de=function(c,d,t){const n=new DOMParser;h.xml=n.parseFromString(t.target.result,"text/xml"),h.xml.documentElement.getAttribute("xml:lang")==="ta"&&(h.scripts=["iast","tamil"]);const s=h.xml.querySelectorAll("teiHeader xenoData stemma nexml");for(const u of s){const f=document.implementation.createDocument("http://www.nexml.org/2009","",null);f.appendChild(u.cloneNode(!0)),V(f,u.closest("stemma").id,!1)}h.maxlemma=p.maxlemma(),d.length>0?be(d):K()},be=function(c){const d=c[0],t=c.slice(1),n=function(f,x){const b=new Set(f);for(const B of x)b.delete(B);return b},s=function(f,x){var Le;const B=new DOMParser().parseFromString(x.target.result,"text/xml"),P=new Map;for(const ye of p.teis()){const Re=ye.getAttribute("n");P.set(Re,ye)}const $=new Map;for(const ye of B.querySelectorAll("TEI")){const Re=ye.getAttribute("n");if(P.has(Re)){$.set(Re,ye);continue}const Be=B.querySelector(`witness[*|id="${Re}"]`),qe=h.xml.querySelector(`witness[*|id="${Re}"] [n="ac"]`);if(qe&&P.has(qe.getAttribute("xml:id"))){$.set(Re+"ac",ye);const De=ye.cloneNode(!0);De.setAttribute("n",Re+"pc"),ye.after(De),$.set(Re+"pc",De);continue}const Te=Be.getAttribute("n"),Me=(Le=Be.parentNode.closest("witness"))==null?void 0:Le.getAttribute("xml:id");if(Te!==null&&P.has(Me)){const De=P.get(Me);De.setAttribute("n",Me+"ac");const ze=De.cloneNode(!0);ze.setAttribute("n",Me+"pc"),De.after(ze),P.set(Me+"ac",De),P.set(Me+"pc",ze),P.delete(Me)}$.set(Re,ye)}const X=new Set(P.keys()),te=new Set($.keys()),ge=n(X,te),_e=n(te,X);for(const ye of _e)o.tei(ye);const Ce=[...B.querySelector("text").querySelectorAll("w[n]")].length;h.maxlemma+Ce;const we=new Set;for(const[ye,Re]of $)if(!P.has(ye))we.add(ye);else{const Be=P.get(ye).querySelector("text"),qe=Re.querySelector("text"),Te=qe.querySelectorAll("w[n]");var Se=h.maxlemma+1;for(const De of Te)De.setAttribute("n",Se),Se=Se+1;const Me=qe.cloneNode(!0);for(;Me.firstChild;)Be.appendChild(Me.firstChild)}if(we.size>0){const ye=h.xml.querySelector("TEI").cloneNode(!0);for(const Re of ye.querySelectorAll("w"))Re.innerHTML="",Re.hasAttribute("lemma")&&Re.removeAttribute("lemma");for(const Re of we){const Be=ye.cloneNode(!0);Be.setAttribute("n",Re),h.xml.documentElement.appendChild(Be)}}if(ge.size>0){const ye=B.querySelector("text").cloneNode(!0);var Se=h.maxlemma+1;for(const Be of ye.querySelectorAll("w"))Be.innerHTML="",Be.hasAttribute("lemma")&&Be.removeAttribute("lemma"),Be.setAttribute("n",Se),Se=Se+1;for(const Be of ge){const qe=P.get(Be).querySelector("text"),Te=ye.cloneNode(!0);for(;Te.firstChild;)qe.appendChild(Te.firstChild)}}h.maxlemma=p.maxlemma(),f.length>0?be(f):K()},u=new FileReader;u.onload=s.bind(null,t),u.readAsText(d)},z=function(){var c="";const d=[...p.teis()].map(t=>t.getAttribute("n"));for(const t of d)c+=`<li data-name="${t}">${t}</li>`;document.getElementById("menu").querySelector(".ms").innerHTML=c},K=function(){z();const c=new xe("Save As...");c.setFunction(k.saveAs),c.setStyle({fontWeight:"bold"});const d=new me("Export");d.populate([{text:"TEI corpus",func:k.showOptions.bind(null,k.xml,k.options)},{text:"TEI apparatus",func:k.showOptions.bind(null,k.xml,k.appOptions)},{text:"CSV",func:k.showOptions.bind(null,k.csv,k.options)},{text:"NEXUS",func:k.showOptions.bind(null,k.nexus,k.options)}]);const t=new me("Edit");t.populate([{text:"Undo",greyout:a.undo,func:D.undo},{text:"Redo",greyout:a.redo,func:D.redo},{text:"Select all",alt:"Deselect all",toggle:a.anyhighlit,func:M.highlightAll},{text:"Group by whitespace",func:D.doGroupWords},{text:"Delete empty columns",func:D.startRemoveEmpty},{text:"Delete empty rows",func:D.startRemoveEmptyRows}]);const n=new me("Column");n.populate([{text:"(Re)normalize column",alt:"(Re)normalize columns",greyout:a.anyhighlit,toggle:a.manyhighlit,func:D.startRenormalize.bind(null,!1)},{text:"Delete column",alt:"Delete columns",greyout:a.anyhighlit,toggle:a.manyhighlit,func:D.removeCol.start.bind(null,!1)},{text:"Merge columns",greyout:a.manyhighlit,func:D.startMerge.bind(null,!1)},{text:"Group columns",alt:"Ungroup columns",greyout:a.oneGrouped,toggle:a.grouped,func:D.group.start.bind(null,!1)},{text:"Insert column",greyout:a.anyhighlit,func:D.insertCol.start},{text:"Mark insignificant",checkbox:a.checkbox.bind(null,"insignificant"),greyout:a.anyhighlit,func:D.startMarkAs.bind(null,"insignificant",!1)},{text:"Mark binary",checkbox:a.checkbox.bind(null,"binary"),greyout:a.anyhighlit,func:D.startMarkAs.bind(null,"binary",!1)}]);const s=new me("Row");s.populate([{text:"Insert row",func:D.startNewRow}]);const u=new me("Cell");u.populate([{text:"Edit cell",greyout:a.highlitcell,func:D.startEditCell.bind(null,!1)}]);const f=new me("View");f.populate([{text:"Header",checkbox:a.headerView,func:ce.toggleHeader},{text:"Normalized",checkbox:a.normalizedView,greyout:a.anyNormalized,func:ce.toggleNormalize}]);const x=document.getElementById("left_menu");x.appendChild(f.box),x.appendChild(t.box),x.appendChild(n.box),x.appendChild(s.box),x.appendChild(u.box),x.appendChild(d.box),x.appendChild(c.box);const b=document.getElementById("views");b.style.justifyContent="flex-start",b.removeChild(b.querySelector("#splash")),v.matrix();const B=document.getElementById("matrixmenu");B.addEventListener("click",v.matrix),B.removeChild(B.querySelector("ul")),document.getElementById("mssmenu").style.display="block",document.getElementById("treemenu").style.display="block"},j={selectAll(c){const d=document.createRange();d.selectNodeContents(c);const t=window.getSelection();t.removeAllRanges(),t.addRange(d)},deselect(){const c=window.getSelection();c.removeAllRanges?c.removeAllRanges():c.empty&&c.empty()},treeMouseover(c){const d=c.target.classList.contains("tree-lemma")?c.target:c.target.closest(".tree-lemma");d&&(M.highlightTreeLemma(d.dataset.id),d.addEventListener("mouseout",M.unhighlightTrees));const t=c.target.dataset.reconstructed;if(!t)return;const n=document.createElement("div");n.id="tooltip",n.style.top=c.pageY+"px",n.style.left=c.pageX+"px",n.style.opacity=0,n.style.transition="opacity 0.2s ease-in",h.viewdiv.parentElement.appendChild(n);const s=document.createElement("div");if(s.appendChild(document.createTextNode(t)),this.script!==0?n.appendChild(Yt(s,h.scripts[this.script])):n.appendChild(s),c.target.classList.contains("reconstructed")){const u=c.target.parentNode.querySelector("span.tree-lemma");if(u&&u.dataset.hasOwnProperty("emended")){const f=document.createElement("div");f.classList.add("emphasis"),f.appendChild(document.createTextNode(u.textContent)),this.script!==0?n.prepend(Yt(f,h.scripts[this.script])):n.prepend(f)}}window.getComputedStyle(n).opacity,n.style.opacity=1,c.target.addEventListener("mouseout",g)},treeClick(c){c.target.classList.contains("witness")?v.text(c.target.dataset.key):c.target.classList.contains("reconstructed")?v.text(c.target.dataset.label):c.target.classList.contains("internal")&&D.startReconstruction(c),g()},keyDown(c){if(!h.editing&&c.key.substring(0,5)==="Arrow")j.cycleVariant(c);else if(c.ctrlKey||c.metaKey)c.key==="Z"?D.redo():c.key==="z"&&D.undo();else if(!h.editing&&h.matrix&&!h.matrix.closed&c.key==="Enter"){const d=p.highlitcell();d&&(c.preventDefault(),D.startEditCell(d))}},cycleVariant(c){const d=p.highlitcell()||h.viewdiv.querySelector("td.highlit")||h.viewdiv.querySelector('td[data-n="0"]');switch(c.key){case"ArrowRight":{if(!h.matrix.closed&&d){const t=d.nextElementSibling;t&&j.textClick({target:t})}else{const t=h.viewdiv.querySelector(".highlit"),n=t?t.dataset.n:0;let s=parseInt(n)+1;for(;s<=h.maxlemma;){const u=h.viewdiv.querySelectorAll('[data-n="'+s+'"]');for(const f of u)if(f&&!f.classList.contains("invisible")){j.textClick({target:f});return}s++}}break}case"ArrowLeft":{if(!h.matrix.closed&&d){const t=d.previousElementSibling;t&&j.textClick({target:t})}else{const t=h.viewdiv.querySelector(".highlit"),n=t?t.dataset.n:0;let s=parseInt(n)-1;for(;s>=0;){const u=h.viewdiv.querySelectorAll('[data-n="'+s+'"]');for(const f of u)if(f&&!f.classList.contains("invisible")){j.textClick({target:f});return}if(s--,d){j.textClick({target:d.previousElementSibling});return}}}break}case"ArrowUp":{if(h.matrix.closed||!d)return;const n=d.closest("tr").previousElementSibling;if(!n||!n.dataset.n)return;const s=n.querySelector(`td[data-n="${d.dataset.n}"]`);j.textClick({target:s});break}case"ArrowDown":{if(h.matrix.closed||!d)return;const n=d.closest("tr").nextElementSibling;if(!n||n.tagName!=="TR")return;const s=n.querySelector(`td[data-n="${d.dataset.n}"]`);j.textClick({target:s})}}},textClick(c,d=!1){if(c.target.closest("tr.header")){j.matrixHeaderClick(c);return}const t=c.target.classList.contains("lemma")?c.target:c.target.closest(".lemma");if(t){if(!d&&c.ctrlKey){j.rightClick(c);return}const n=t.dataset.n,s=p.highlitrow();if(M.unHighlightAll(),M.highlightLemma(n),M.repopulateTrees(n),ce.xScroll(n,s),t.tagName==="TD")t.classList.add("highlitcell");else{const u=t.closest(".text-box");if(u){const f=u.dataset.id;p.tr(f).querySelector(`td[data-n="${n}"]`).classList.add("highlitcell")}}}},textMouseup(){const c=p.selection();c&&(M.highlightRange(c),O())},menuMouseover(c){const d=c.target.classList.contains("menubox")?c.target:c.target.closest(".menubox");if(d){const t=d.querySelector("ul");t&&(t.style.display="block"),d.classList.add("open")}},menuMouseout(c){const d=c.target.classList.contains("menubox")?c.target:c.target.closest(".menubox");if(d){const t=d.querySelector("ul");t&&(t.style.display="none"),d.classList.remove("open")}},menuClick(c){c.target.parentElement&&(c.target.parentElement.className==="ms"&&(j.menuMouseout(c),v.text(c.target.dataset.name)),c.target.parentElement.className==="tree"&&(j.menuMouseout(c),c.target.closest("li[data-name]")&&v.tree(c.target.dataset.stemmaid,c.target.dataset.treeid)))},thDragStart(c){c.target.closest('th[scope="row"]')&&(c.dataTransfer.setData("text/plain",c.target.textContent),D.startMoveRow(c.target.parentNode,c))},trDragEnter(c){const d=c.target.nodeType===1?c.target.closest("tr"):c.target.parentElement.closest("tr");d&&d.classList.add("dragenter")},trDragLeave(c){const d=c.target.nodeType===1?c.target.closest("tr"):c.target.parentElement.closest("tr");d&&d.classList.remove("dragenter")},trDragDrop(c){c.preventDefault(),D.finishMoveRow(c)},matrixMousedown(c){if(c.button!==0)return;if(c.ctrlKey){j.rightClick(c);return}const d=c.target.nodeType===1?c.target.closest(".lemma"):c.target.parentElement.closest(".lemma");if(d){if(d.isContentEditable)return;M.unHighlightAll(),M.highlightLemma(d.dataset.n),h.draganchor=parseInt(d.dataset.n),h.matrix.boxdiv.querySelector("table").addEventListener("mouseover",j.matrixMouseover),window.addEventListener("mouseup",j.matrixMouseup)}},matrixMouseup(c){const d=p.highlit();d.size===1?j.textClick(c):(M.clearTrees(),M.highlightRange(d)),h.draganchor=null,h.matrix.boxdiv.querySelector("table").removeEventListener("mouseover",j.matrixMouseover),window.removeEventListener("mouseup",j.matrixMouseup)},matrixMouseover(c){const d=c.target.nodeType===1?c.target.closest(".lemma"):c.target.parentElement.closest(".lemma");if(d){M.unHighlightAll();const s=h.draganchor,u=parseInt(d.dataset.n);if(s===u)M.highlightLemma(s);else{var t,n;s>u?(t=s,n=u):(t=u,n=s);for(let f=n;f<=t;f++)M.highlightLemma(f,!0)}}},matrixHeaderClick(c){if(c.target.tagName!=="INPUT")return;const d=c.target.className;if(d!=="insignificant"&&d!=="binary")return;const t=c.target.closest("th").dataset.ref,n=p.firsttd(t).dataset[d]!=="true",s=new Map([[t,n]]);D.doMarkAs(d,s)},rightClick(c){const d=c.target.nodeType===1?c.target.closest("tr[data-n] th"):c.target.parentElement.closest("tr[data-n] th");if(d){c.preventDefault(),ne.remove();const n=ne.create(c),s=[{text:"move row",func:D.startMoveRow.bind(null,d.parentNode)},{text:"delete row",func:D.doDeleteRow.bind(null,d.parentNode.dataset.n)}];ne.populate(n,s),ne.show(n);return}const t=c.target.nodeType===1?c.target.closest("td.lemma"):c.target.parentElement.closest("td.lemma");if(t){c.preventDefault();const n=t.classList.contains("highlit")?function(){const f=p.highlit();return f.size===1&&!t.classList.contains("highlitcell")&&(M.unCelllightAll(),t.classList.add("highlitcell")),f}():(j.textClick(c,!0),new Set([t.dataset.n])),s=n.size>1?[{text:"merge columns",func:D.startMerge.bind(null,n)},{text:"ungroup columns",alt:"group columns",toggle:a.grouped,func:D.group.start.bind(null,!1)},{text:"delete columns",func:D.removeCol.start.bind(null,n)}]:[{text:"edit cell",func:D.startEditCell.bind(null,t)},{text:"delete column",func:D.removeCol.start.bind(null,n)},{text:"insert column",func:D.insertCol.start}];ne.remove();const u=ne.create(c);ne.populate(u,s),ne.show(u)}}},D={undo:function(){const c=h.undo.pop();c&&c[0](...c[1])},redo:function(){const c=h.redo.pop();c&&c[0](...c[1])},doStack:function(c,d="do"){d==="undo"?(c[1].push("redo"),h.redo.push(c)):d==="redo"?(c[1].push("undo"),h.undo.push(c)):(c[1].push("undo"),h.undo.push(c),h.redo=[])},doMulti:function(c,d){const t=[];for(const n of c){const s=n[0](...n[1],"multido");t.unshift(s)}D.doStack([D.doMulti,[t]],d)},startMoveRow:function(c,d){if(h.dragged=c,h.dragged.classList.add("dragging"),d.type!=="dragstart"){for(const t of p.trs())t.classList.add("moveinprogress");h.matrix.boxdiv.querySelector("table").addEventListener("mousedown",D.finishMoveRow)}},startMerge:function(c){const d=c===!1?p.highlit():c,t=p.clauses(d,!0);if(!t)D.doMerge(d,"do");else if(t[0]===null){const n=t.filter(s=>s!==null).map(s=>[D.ungroup.go,[s]]).concat([[D.doMerge,[d]]]);D.doMulti(n,"do")}else{const n=t.map(s=>[D.ungroup.go,[s]]).concat([[D.doMerge,[d]]]);D.doMulti(n,"do")}},group:{start:function(c){const d=c===!1?p.highlit():c;a.grouped()?D.ungroup.start(d):D.group.go(d,"do")},go:function(c,d="do"){C.group(c);for(const t of h.textboxes)t.refresh();if(d==="multido")return[D.ungroup.go,[c]];D.doStack([D.ungroup.go,[c]],d)}},ungroup:{start:function(c){const t=[...p.clauses(c)].map(n=>[D.ungroup.go,[n]]);D.doMulti(t,"do")},go:function(c,d="do"){C.ungroup(c);for(const t of h.textboxes)t.refresh();if(d==="multido")return[D.group.go,[c]];D.doStack([D.group.go,[c]],d)}},insertCol:{start:function(){const c=Math.max([...p.highlit()])||h.maxlemma;D.insertCol.go({mode:"append",start:c})},go:function(c,d="do"){const t=function(u,f,x,b){const B=u();for(var P=0;P<B.length;P++){const $=f(c.start,B[P]);if(c.mode==="append")if(x)for(const X of x[P].reverse())$.insertAdjacentElement("afterend",X);else{const X=b(c.start+1);$.insertAdjacentElement("afterend",X)}else if(x)for(const X of x[P])$.insertAdjacentElement("beforebegin",X);else{const X=b(c.start);$.insertAdjacentElement("beforebegin",X)}}return x?x[0].length:1};M.unHighlightAll();var n;c.hasOwnProperty("xml")?(t(...c.xml),n=t(...c.html)):(t(p.trs,p.firsttd,null,o.emptycell),t(p.texts,p.firstword,null,o.emptyword),n=1);const s=c.mode==="append"?[...Array(n).keys()].map(u=>c.start+u+1):[...Array(n).keys()].map(u=>c.start+u);if(D.renumber(c.start),M.highlightRange(new Set(s)),D.refresh(),D.reIAST(s),D.restyleGroups(s,!0),ce.updateAllHeaders(),d==="multido")return[D.removeCol.go,[s]];D.doStack([D.removeCol.go,[s]],d)}},removeCol:{start:function(c){const d=c===!1?p.highlit():c,t=p.clauses(d);if(!t)D.removeCol.go(d,"do");else{const n=t.map(s=>[D.ungroup.go,[s]]).concat([[D.removeCol.go,[d]]]);D.doMulti(n,"do")}},go:function(c,d="do"){const t=function(B,P){const $=ge=>{const _e=P(ge,row);return D.unnormalize(_e),_e},X=B(),te=[];for(const ge of X){const _e=[...c].map($),Ce=_e.map(we=>we.cloneNode(!0));te.push(Ce);for(const we of _e)we.parentNode.removeChild(we)}return[B,P,te]},n={mode:"insert"};[...c].map(B=>parseInt(B));const s=Math.min(...c),u=Math.max(...c);p.firstword(u).nextElementSibling||(n.mode="append");const x=t(p.trs,p.firsttd),b=t(p.texts,p.firstword);if(D.renumber(s-1),D.refresh(),D.restyleGroups(c,!0),ce.updateAllHeaders(),n.html=x,n.xml=b,n.mode==="append"?n.start=s-1:n.start=s,d==="multido")return[D.insertCol.go,[n]];D.doStack([D.insertCol.go,[n]],d)}},startRemoveEmpty:function(){const c=p.empty(),d=p.clauses(c);if(!d)D.removeCol.go(c,"do");else{const t=p.clausesToRemove(d,c,1);if(!t)D.removeCol.go(c,"do");else{const n=t.map(s=>[D.ungroup.go,[s]]).concat([[D.removeCol.go,[c]]]);D.doMulti(n,"do")}}},startRemoveEmptyRows:function(){const d=[...p.emptyRows(!0)].map(t=>[D.doDeleteRow,[t]]);D.doMulti(d,"do")},startEditCell:function(c){const d=c||p.highlitcell();d&&(D.unnormalize(d),d.dataset.oldContent=d.textContent,d.contentEditable="true",d.focus(),h.editing=!0,j.selectAll(d),d.addEventListener("blur",D.finishEditCell),d.addEventListener("keydown",D.cellKeyDown))},cellKeyDown:function(c){switch(c.key){case"Enter":D.finishEditCell(c);break;case"Escape":D.finishEditCell(c,!0);break;case"ArrowRight":{const d=p.cursorPos(c.target);d[0]===d[1]&&window.getSelection().type==="Caret"&&(c.preventDefault(),D.finishEditCell(c),j.cycleVariant({key:"ArrowRight"}),D.startEditCell(p.highlitcell()));break}case"ArrowLeft":{p.cursorPos(c.target)[0]===0&&(c.preventDefault(),D.finishEditCell(c),j.cycleVariant({key:"ArrowLeft"}),D.startEditCell(p.highlitcell()));break}}},startMarkAs:function(c,d,t){const n=t.target.tagName==="INPUT"?t.target:t.target.querySelector("input"),s=d===!1?p.highlit():d,u=new Map([...s].map(f=>[f,!n.checked]));D.doMarkAs(c,u)},startNewRow:function(){const c=o.row("new row"),d=c.querySelector("th");d.contentEditable=!0,d.addEventListener("blur",D.finishNewRow),d.addEventListener("keydown",D.thKeyDown),h.matrix.boxdiv.querySelector("tbody").appendChild(c),d.scrollIntoView(),d.focus(),document.execCommand("selectAll",!1,null),h.editing=!0},startRenameRow:function(){},startReconstruction:function(c){const d=c.target.dataset.key,t=c.target.closest(".tree-box").myTree,n=t.desc,s=document.createRange().createContextualFragment(`<div id="reconstructionoptions" class="popup">
    <form id="reconstructionform">
      <div>
        <label for="reconstructed_node_name">Label for node:</label>
        <input type="text" id="reconstructed_node_name" name="reconstructed_node_name" placeholder="${n}-${d}" size="15">
      </div>
      <div style="width: 100%; display: flex; justify-content: center;padding-top: 1em;">
        <button type="submit">Add to matrix</button>
      </div>
    </form>
</div>`),u=function(f){f.preventDefault();const x=blackout.querySelector("input"),b=x.value?x.value:x.placeholder;D.doReconstruction(t,d,b)};o.blackout(s,u),document.getElementById("reconstructed_node_name").focus()},thKeyDown:function(c){c.key==="Enter"&&D.finishNewRow(c)},finishNewRow:function(c){const d=c.target,t=d.textContent;d.closest("tr").dataset.n=t;const n=o.tei(t);h.xml.documentElement.appendChild(n),h.editing=!1,d.contentEditable=!1,d.removeEventListener("blur",D.finishNewRow),d.removeEventListener("keydown",D.thKeyDown),D.doStack([D.doDeleteRow,[t]],"do")},finishEditCell:function(c,d=!1){const t=c.target;h.editing=!1,t.contentEditable="false",t.removeEventListener("blur",D.finishEditCell),t.removeEventListener("keydown",D.cellKeyDown),t.blur(),j.deselect();const n=t.textContent;if(n===""){const x=t.querySelector("br");x&&x.remove()}if(d)return;if(n===t.dataset.oldContent){delete t.dataset.oldContent;return}t.hasOwnProperty("IAST")||(t.IAST=t.cloneNode(!0)),t.IAST.textContent=n;const s=parseInt(t.dataset.n),u=t.closest("tr"),f=u.dataset.n;if(D.xmlChangeCell(s,f,n),u.dataset.hasOwnProperty("treename")&&!t.dataset.hasOwnProperty("emended")){const x=D.doEmend(s,f,"multido"),b=[];b.push([D.doChangeCell,[s,f,t.dataset.oldContent]]),b.push(x),D.doStack([D.doMulti,[b]],"do")}else D.doStack([D.doChangeCell,[s,f,t.dataset.oldContent]],"do");delete t.dataset.oldContent,D.refresh(),ce.updateAllHeaders(!0),t.classList.add("highlitcell")},finishMoveRow:function(c){const d=c.target.nodeType===1?c.target.closest("tr"):c.target.parentElement.closest("tr");if(d&&D.doMoveRow(h.dragged,d,"do"),c.type!=="drop"){for(const t of p.trs())t.classList.remove("moveinprogress");h.matrix.boxdiv.querySelector("table").removeEventListener("mousedown",D.finishMoveRow)}else for(const t of p.trs())t.classList.remove("dragenter");h.dragged.classList.remove("dragging"),h.dragged=null},doReconstruction:function(c,d,t){const n=o.row(t,"pending");n.dataset.treename=c.name,n.dataset.nodename=d;const s=n.querySelector("th"),u=document.createElement("div");u.id="spinner",s.prepend(u);const f=o.tei(t);f.setAttribute("type","reconstructed"),f.setAttribute("corresp",c.name),f.setAttribute("select",`#${d}`);const x=[...p.tds(!1,n)],b=[...p.words(!1,f)];h.matrix.boxdiv.querySelector("tbody").appendChild(n),s.scrollIntoView();const B=new Worker(new URL(""+new URL("worker-uuz1IgR3.js",import.meta.url).href,import.meta.url)),P=a.normalizedView(),$=p.serializedtexts(c.nexml,P),X=new Map($.map(te=>[te[0],te[1][0]]));B.postMessage({readings:X,levels:c.levels,num:0,id:d}),B.onmessage=function(te){const ge=te.data.n,_e=te.data.result;if(x[ge].textContent=_e,x[ge].IAST=x[ge].cloneNode(!0),x[ge].classList.remove("pending"),b[ge].textContent=_e,ge<h.maxlemma){const Ce=new Map($.map(we=>[we[0],we[1][ge+1]]));B.postMessage({readings:Ce,levels:c.levels,num:ge+1,id:d})}else{s.removeChild(u),h.xml.documentElement.appendChild(f),ce.updateAllHeaders(),c.draw();const Ce=p.highlit();Ce.size>0&&M.repopulateTrees(...p.lowhigh(Ce));const we=document.getElementById("menu").querySelector(".ms"),Se=document.createElement("li");Se.setAttribute("data-name",t),Se.appendChild(document.createTextNode(t)),we.appendChild(Se),D.doStack([D.doDeleteRow,[t]],"do")}}},doDeleteRow:function(c,d="do"){const t=p.tr(c),n=p.tei(c),u=[...p.teis()].indexOf(n);if(t.parentNode.removeChild(t),n.parentNode.removeChild(n),ce.updateAllHeaders(),z(),R(),d==="multido")return[D.doUndeleteRow,[t,n,u]];D.doStack([D.doUndeleteRow,[t,n,u]],d)},doUndeleteRow:function(c,d,t,n="do"){const s=d.getAttribute("n"),u=[...p.teis()];if(t===u.length)h.xml.documentElement.appendChild(d),h.matrix.boxdiv.querySelector("tbody").appendChild(c);else{const f=[...p.trs()];h.xml.documentElement.insertBefore(d,u[t]),f[t].parentNode.insertBefore(c,f[t])}if(ce.updateAllHeaders(),z(),R(),n==="multido")return[D.doDeleteRow,[s]];D.doStack([D.doDeleteRow,[s]],n)},doMoveRow:function(c,d,t="do"){const n=c.parentNode,s=[...p.trs()],u=c.previousElementSibling,f=s.indexOf(c),x=d!==null?s.indexOf(d):null,b=function(){d===-1?n.insertBefore(c,n.firstChild):d.nextElementSibling?n.insertBefore(c,d.nextElementSibling):n.appendChild(c)},B=function(){const P=h.xml.documentElement,$=[...p.teis()],X=$[f];if(x===-1)P.insertBefore(X,$[0]);else{const te=$[x];te.nextElementSibling?P.insertBefore(X,te.nextElementSibling):P.appendChild(X)}};if(b(),B(),t==="multido")return[D.doMoveRow,[c,u]];D.doStack([D.doMoveRow,[c,u]],t)},doMerge:function(c,d="do"){const t=function(f,x,b){const B=f();var P=[];const $=X=>x(X,row);for(const X of B){const te=[...b].map($),ge=te.map(Ce=>Ce.cloneNode(!0));P.push(ge);for(const Ce of te)D.unnormalize(Ce);const _e=te.reduce(function(Ce,we){if(we.hasChildNodes())for(;we.firstChild;)Ce.appendChild(we.firstChild);return we.parentNode.removeChild(we),Ce});_e.normalize(),_e.dataset?(delete _e.dataset.normal,_e.IAST=_e.cloneNode(!0)):_e.removeAttribute("lemma")}return[f,x,P]},n=t(p.trs,p.firsttd,c),s=t(p.texts,p.firstword,c),u=parseInt([...c][0]);if(D.renumber(u),D.restyleGroups(c),D.refresh(),ce.updateAllHeaders(),d==="multido")return[D.doUnmerge,[n,s]];D.doStack([D.doUnmerge,[n,s]],d)},doUnmerge:function(c,d,t="undo"){const n=function(x,b,B){const P=p.whichattr(B[0][0]),$=B[0].map(_e=>_e.getAttribute(P)),X=$[0],te=x();for(var ge=0;ge<te.length;ge++){const _e=B[ge].pop(),Ce=b(X,te[ge]);Ce.parentNode.replaceChild(_e,Ce);for(const we of B[ge])_e.parentNode.insertBefore(we,_e)}return $};n(...c);const s=n(...d),f=[...s].sort((x,b)=>parseInt(x)-parseInt(b))[0];if(D.renumber(f),D.reIAST(s),D.refresh(),D.restyleGroups(s),ce.updateAllHeaders(),t==="multido")return[D.doMerge,[s]];D.doStack([D.doMerge,[s]],t)},doGroupWords:function(){let c=0;const d=[],t=p.emptyRows();for(let n=0;n<=h.maxlemma;n++){const s=p.tds(n),u=s[0].classList;if(u.contains("group-start")||u.contains("group-internal")||u.contains("group-end")){c=n+1;continue}let f=s.length-t.size,x=0;if(n===h.maxlemma)x=f;else for(let b=0;b<s.length;b++){if(t.has(b))continue;const B=s[b];(B.IAST?B.IAST.textContent:B.textContent).slice(-1)===" "&&x++}if(x/f>=.5)if(c===n){c++;continue}else{const b=p.range(c,n);d.push([D.group.go,[b]]),c=n+1}}D.doMulti(d)},doEmend:function(c,d,t="do"){const n=[...p.trs()][d],s=p.firsttd(c,n);s.dataset.emended=!0;const u=p.tei(d).querySelector("text");if(p.firstword(c,u).setAttribute("emended","true"),t==="multido")return[D.doUnemend,[c,d]];D.doStack([D.doUnemend,[c,d]],t)},doUnemend:function(c,d,t="do"){const n=[...p.trs()][d],s=p.firsttd(c,n);delete s.dataset.emended;const u=p.tei(d).querySelector("text");if(p.firstword(c,u).removeAttribute("emended"),t==="multido")return[D.doEmend,[c,d]];D.doStack([D.doEmend,[c,d]],t)},doChangeCell:function(c,d,t,n="do"){const s=D.xmlChangeCell(c,d,t),u=D.htmlChangeCell(c,d,t);if(D.refresh(),ce.updateAllHeaders(!0),j.textClick({target:u}),n==="multido")return[D.doChangeCell,[c,d,s]];D.doStack([D.doChangeCell,[c,d,s]],n)},htmlChangeCell:function(c,d,t){const n=p.tr(d),s=p.firsttd(c,n);return D.unnormalize(s),s.textContent=t,s.IAST&&(s.IAST=s.cloneNode(!0)),s},xmlChangeCell:function(c,d,t){const n=p.tei(d).querySelector("text"),s=p.firstword(c,n);D.unnormalize(s);const u=s.textContent;return s.childNodes.length===0?s.appendChild(document.createTextNode(t)):s.textContent=t,u},doMarkAs:function(c,d,t="do"){const n=[...d.keys()],s=p.attr(c,n);for(const u of n){const f=p.tds(u),x=p.words(u);if(d.get(u)===!0){for(const B of f)B.dataset[c]="true";for(const B of x)B.setAttribute(c,"true")}else{for(const B of f)delete B.dataset[c];for(const B of x)B.removeAttribute(c)}const b=p.checkbox(u,c);b.checked=d.get(u)}if(t==="multido")return[D.doMarkAs,[c,s]];D.doStack([D.doMarkAs,[c,s]],t)},refresh:function(){for(const c of h.textboxes)c.refresh();M.rehighlight(),a.anyhighlit()?M.repopulateTrees(...p.lowhigh(p.highlit())):M.clearTrees()},renumber:function(c=0){const d=function(t,n,s){const u=t();for(const x of u){const b=[...n(!1,x)],B=p.whichattr(b[0]);for(var f=parseInt(s)+1;f<b.length;f++)b[f].setAttribute(B,f)}};d(p.trs,p.tds,c),d(()=>[!0],p.ths,c),d(p.texts,p.words,c),h.maxlemma=p.maxlemma()},reIAST:function(c){const d=[...c].map(t=>[...p.lemmata(t)]).flat();for(const t of d)t.IAST=t.cloneNode(!0)},restyleGroups:function(c,d=!1){const n=d?function(u){var f=[...u];const x=parseInt(c[0])-1,b=parseInt(c[c.length-1])+1;return f.unshift(x),f.push(b),f}(c):c,s=function(u,f=!1){const x=new Set(["group-start","group-internal","group-end"]);f&&x.delete(f);for(const b of u){for(const B of x)b.classList.remove(B);f&&b.classList.add(f)}};for(const u of n){const f=p.firstword(u),x=p.tds(u);if(x.length===0)continue;const b=f.closest("cl");b?f===b.firstElementChild?s(x,"group-start"):f===b.lastElementChild?s(x,"group-end"):s(x,"group-internal"):s(x)}},startRenormalize:function(c){const d=c===!1?p.highlit():c;D.doRenormalize(Math.min(...d),Math.max(...d))},doRenormalize:function(c,d,t=!1,n="do"){const s=new Map,u=[...p.trs()],f=[...p.texts()],x=t?[t]:[...u.keys()],b=h.xml.documentElement.getAttribute("xml:lang")==="ta";for(const B of x){const P=new Map,$=f[B],X=$.parentNode.getAttribute("n"),te=document.querySelector(`.text-box[data-id="${X}"]`),ge=[...p.words(!1,$)],_e=p.firstword(c,$),Ce=p.firstword(d,$),we=ge.indexOf(_e),Se=ge.indexOf(Ce),Le=ge.slice(we,Se+1),ye=u[B],Be=[...p.tds(!1,ye)].slice(we,Se+1),qe=Le.map(Me=>Me.textContent),Te=Vn(qe,b);for(let Me=0;Me<Te.length;Me++){const De=Le[Me],ze=Te[Me],rt=qe[Me],He=Be[Me],je=De.hasAttribute("lemma")?De.getAttribute("lemma"):!1;if(je!==!1){if(je===ze)continue;P.set(He.dataset.n,je),D.unnormalize(De),D.unnormalize(He)}else P.set(He.dataset.n,null);ze!==rt&&(De.setAttribute("lemma",ze),He.dataset.normal=ze,te&&(te.querySelector(`.lemma[data-n="${He.dataset.n}"]`).dataset.normal=ze))}s.set(B,P)}ce.showNormalized(),ce.updateAllHeaders(!0),ce.xScrollToHighlit(),D.doStack([D.doUnrenormalize,[s]],n)},doUnrenormalize:function(c,d="undo"){a.normalizedView()||ce.showNormalized();const t=new Map,n=[...p.trs()],s=[...p.texts()];for(const[u,f]of c.entries()){const x=n[u],b=s[u],B=new Map;for(const[P,$]of f.entries()){const X=p.firsttd(P,x),te=p.firstword(P,b),ge=te.hasAttribute("lemma")?te.getAttribute("lemma"):null;B.set(P,ge),$===null?(D.unnormalize(X),D.unnormalize(te)):(X.dataset.normal=$,te.setAttribute("lemma",$),X.textContent=$)}t.set(u,B)}D.doStack([D.doUnrenormalize,[t]],d)},unnormalize:function(c){c.hasOwnProperty("IAST")&&(c.textContent=c.IAST.textContent),c.dataset&&c.dataset.hasOwnProperty("normal")&&delete c.dataset.normal,c.getAttribute("lemma")&&c.removeAttribute("lemma")}},ce={toggleNormalize:function(){a.normalizedView()?ce.showUnnormalized():ce.showNormalized()},showNormalized:function(c){if(c)c.updatescript();else{document.getElementById("views").classList.add("normalized");for(const t of h.textboxes)t.updatescript();h.matrix.updatescript(),a.anyhighlit()?M.repopulateTrees(...p.lowhigh(p.highlit())):M.clearTrees()}ce.updateAllHeaders(!0),ce.xScrollToHighlit()},showUnnormalized:function(){document.getElementById("views").classList.remove("normalized"),h.matrix.updatescript();for(const c of h.textboxes)c.updatescript();a.anyhighlit()?M.repopulateTrees(...p.lowhigh(p.highlit())):M.clearTrees(),ce.updateAllHeaders(!0),ce.xScrollToHighlit()},toggleHeader:function(){const c=h.matrix.boxdiv.querySelector("tr.header");c.style.display==="none"?c.style.display="table-row":c.style.display="none"},updateHeaders(c){for(const d of c){const t=p.firstth(d),[n,s]=p.readings(d),u=t.querySelector("span.readings"),f=n<2?n:`${n}(${s.size})`;u.textContent=f}},updateAllHeaders(c=!1){const d=[...p.trs()],t=d.map(x=>p.trWalker(x)),n=[...p.tds(!1,d[0])],s=[...p.ths()],u=h.matrix.boxdiv.querySelector("tr.header"),f=function(){const x=document.createElement("th"),b=document.createElement("span");b.classList.add("readings"),x.appendChild(b);const B=document.createElement("form");return B.innerHTML='<div><input class="insignificant" type="checkbox">Insignificant</div><div><input class="binary" type="checkbox">Binary</div>',x.appendChild(B),u.appendChild(x),x};for(let x=0;x<n.length;x++){const b=x>=s.length?f():s[x],B=n[x];b.dataset.ref=B.dataset.n;let P=0;const $=new Set;for(const te of t){const ge=te.nextNode().textContent;ge!==""&&(P++,$.add(ge))}const X=P<2?P:`${P}(${$.size})`;b.querySelector("span.readings").textContent=X,c||(b.querySelector("input.insignificant").checked=!!B.dataset.insignificant,b.querySelector("input.binary").checked=!!B.dataset.binary)}if(s.length>n.length)for(let x=n.length;x<s.length;x++)u.removeChild(s[x])},xScrollToHighlit:function(){const c=p.highlit();c.size>0&&ce.xScroll([...c][0])},xScroll:function(c,d){if(!c)return;const t=d||p.firsttr(),n=p.firsttd(c,t),s=n.getBoundingClientRect(),u=h.matrix.boxdiv,x=u.getBoundingClientRect().right,b=t.querySelector("th").getBoundingClientRect(),B=b.right,P=s.right>x,$=s.left+.1<B;P&&n.scrollIntoView({inline:"end",block:"nearest"}),$&&(n.scrollIntoView({inline:"start",block:"nearest"}),u.scroll({left:u.scrollLeft-b.width}))}},ne={create:function(c){const d=document.createElement("div");return d.classList.add("contextmenu"),d.style.left=c.clientX-12+"px",d.style.top=c.clientY-22+"px",d},remove:function(){for(const c of document.querySelectorAll(".contextmenu"))c.parentNode.removeChild(c)},show:function(c){document.body.appendChild(c)},populate:function(c,d){const t=document.createElement("ul");for(const n of d){const s=document.createElement("li");if(n.hasOwnProperty("cond")){const u=document.createRange().createContextualFragment('<form><input type="checkbox"'+(n.cond()?" checked":"")+"></form>");s.appendChild(u)}if(n.hasOwnProperty("toggle")){const u=n.toggle()?n.text:n.alt;s.appendChild(document.createTextNode(u))}else s.appendChild(document.createTextNode(n.text));s.addEventListener("mouseup",n.func),t.appendChild(s)}c.appendChild(t)}};class xe{constructor(d){this.name=d,this.box=document.createElement("div"),this.box.classList.add("menubox");const t=document.createElement("div");t.classList.add("heading"),t.appendChild(document.createTextNode(d)),this.box.appendChild(t),this.box.addEventListener("mouseup",this.click.bind(this))}setFunction(d){this.func=d}setStyle(d){for(const[t,n]of Object.entries(d))this.box.style[t]=n}click(d){this.func(d)}}class me{constructor(d){this.name=d,this.box=document.createElement("div"),this.box.classList.add("menubox");const t=document.createElement("div");t.classList.add("heading"),t.appendChild(document.createTextNode(d)),this.box.appendChild(t),t.addEventListener("mouseover",this.checkConditions.bind(this)),this.box.addEventListener("mouseup",this.click.bind(this)),this.items=new Map,this.conditions=new Map}populate(d){const t=this.box.querySelector("ul")||function(n){const s=document.createElement("ul");return n.box.appendChild(s),s}(this);for(const n of d){const s=document.createElement("li");if(n.hasOwnProperty("checkbox")){const u=document.createElement("form"),f=document.createElement("input");f.type="checkbox",f.addEventListener("click",x=>x.preventDefault()),u.appendChild(f),s.appendChild(u),s.appendChild(document.createTextNode(n.text)),this.conditions.set(f,n.checkbox)}else if(n.hasOwnProperty("toggle")){const u=document.createElement("span");u.appendChild(document.createTextNode(n.text)),u.dataset.text=n.text,u.dataset.alt=n.alt,this.conditions.set(u,n.toggle),s.appendChild(u)}else s.appendChild(document.createTextNode(n.text));n.hasOwnProperty("greyout")&&this.conditions.set(s,n.greyout),this.items.set(s,n.func),t.appendChild(s)}}click(d){const t=d.target.tagName==="LI"?d.target:d.target.closest("li");if(t&&!t.classList.contains("greyedout")){const n=this.items.get(t);n&&(n(d),this.checkConditions())}}checkConditions(){const d=new Map;for(const[t,n]of this.conditions){const s=d.get(n)||function(){const u=n();return d.set(n,u),u}();t.tagName==="INPUT"?t.checked=s:t.tagName==="SPAN"?s?t.textContent=t.dataset.alt:t.textContent=t.dataset.text:t.tagName==="LI"&&(s?t.classList.remove("greyedout"):t.classList.add("greyedout"))}}}class Y{constructor(d){this.name=d,this.script=0}show(){h.descs.appendChild(this.descbox),a.normalizedView()&&ce.showNormalized(this),h.viewdiv.appendChild(this.boxdiv),this.closed=!1}clear(){for(;this.boxdiv.firstChild;)this.boxdiv.removeChild(this.boxdiv.firstChild);this.svgcontainer&&(this.clearsvg(),this.boxdiv.appendChild(this.svgcontainer))}destroy(){h.viewdiv.removeChild(this.boxdiv),h.descs.removeChild(this.descbox);const d=h.trees.indexOf(this);d>-1&&h.trees.splice(d,1);const t=h.textboxes.indexOf(this);t>-1&&h.textboxes.splice(t,1),this.closed=!0,this.name==="Matrix"&&(document.getElementById("matrixmenu").style.display="block"),R(),M.rehighlight()}pullout(){this.destroy();const d="menubar=no,location=no,status=no,height=620,width=620,scrollbars=yes,centerscreen=yes",t=window.mainWindow?window.mainWindow.comboView.getWindows().length:h.windows.length,n=window.open("branch.html","branch"+t,d);n.mainWindow=window.mainWindow?window.mainWindow:window,n.startbox=this.text?{text:{name:this.name}}:{tree:this.name},n.mainWindow.comboView.addWindow(n)}makeDescBox(){const d=document.createElement("div"),t=document.createElement("div");t.classList.add("closer"),t.innerHTML="x",t.title="close";const n=document.createElement("div");n.classList.add("scripter"),n.innerHTML="A",n.title="change script",d.appendChild(t),d.appendChild(n),d.appendChild(document.createTextNode(this.desc)),this.descbox=d,t.addEventListener("click",this.destroy.bind(this)),n.addEventListener("click",this.cyclescript.bind(this))}cyclescript(){const d=h.scripts[this.script];this.script=this.script+1,this.script===h.scripts.length&&(this.script=0);const t=this.descbox.querySelector(".scripter");this.script===0?t.innerHTML="A":t.innerHTML=lt[h.scripts[this.script]]("a"),t.classList.add(h.scripts[this.script]),t.classList.remove(d),this.updatescript(),this.boxdiv.classList.add(h.scripts[this.script]),this.boxdiv.classList.remove(d)}updatescript(d){const t=d?d.map(n=>this.boxdiv.querySelector(`.lemma[data-n=${n}]`)):this.boxdiv.querySelectorAll(".lemma,.tree-lemma");for(const n of t){const s=n.dataset.hasOwnProperty("normal");if(!s&&n.textContent.trim()==="")continue;const u=(x=>{if(a.normalizedView()&&s){const b=x.createElement("span");return b.appendChild(x.createTextNode(n.dataset.normal)),b}else return n.IAST.cloneNode(!0)})(document),f=this.script===0?u:Yt(u,h.scripts[this.script]);for(n.innerHTML="";f.firstChild;)n.appendChild(f.firstChild)}this.boxdiv.classList.contains("matrix")&&ce.xScrollToHighlit()}}class he extends Y{constructor(d,t){super(`#${d} #${t}`),this.stemmaid=d,this.id=t,this.nexml=h.treelist.get(this.name).cloneNode(!0),this.desc=this.nexml.querySelector("tree").getAttribute("label")}init(){this.makeDescBox();const d=document.createElement("div");d.classList.add("tree-box");var t,n=0;do t="tree"+n,n++;while(document.getElementById(t));d.id=t,this.boxdiv=d,this.boxdiv.addEventListener("mouseover",j.treeMouseover.bind(this)),this.boxdiv.addEventListener("click",j.treeClick),this.svgcontainer=document.createElement("div"),this.svgcontainer.id=this.boxdiv.id+"container",this.boxdiv.appendChild(this.svgcontainer),this.boxdiv.myTree=this,this.calcPaths(),this.jiggleroot(),this.findLevels(),this.labelInternal()}show(){h.descs.appendChild(this.descbox),h.viewdiv.appendChild(this.boxdiv)}jiggleroot(){const d=this.nexml.evaluate('//nex:node[@root="true"]',this.nexml,this.nsResolver,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue,t=this.nexml.evaluate('//nex:edge[@source="'+d.id+'"]|//nex:edge[@target="'+d.id+'"]',this.nexml,this.nsResolver,XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE,null);if(t.snapshotLength===3){var n,s;for(let u=0;u<t.snapshotLength;u++){const f=t.snapshotItem(u),x=f.getAttribute("source"),b=f.getAttribute("target"),B=this.nexml.evaluate('//nex:node[@id="'+x+'"]',this.nexml,this.nsResolver,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue,P=this.nexml.evaluate('//nex:node[@id="'+b+'"]',this.nexml,this.nsResolver,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue;if(!B.hasAttribute("otu")&&!P.hasAttribute("otu")){n=f,s=b===d.id?"target":"source";break}}if(n){const u=this.nexml.createElementNS(d.namespaceURI,"node");u.id="fakeroot",u.setAttribute("root","true"),d.removeAttribute("root"),d.parentElement.insertBefore(u,d);const f=this.nexml.createElementNS(d.namespaceURI,"edge");f.id="newrootedge",f.setAttribute("length","0"),f.setAttribute("source","fakeroot"),f.setAttribute("target",d.id),d.parentElement.insertBefore(f,n),n.setAttribute(s,u.id)}}}findLevels(){const d=this.nexml.querySelectorAll("edge"),t=[...this.nexml.querySelectorAll("node[otu]")],n=this.nexml,s=[t],u=function(b,B){const P=b.map(we=>we.id),$=new Map,X=new Map,te=[];for(const we of B){const Se=we.getAttribute("target"),Le=we.getAttribute("source"),ye=P.indexOf(Se)!==-1?{ancestor:n.getElementById(Le),child:n.getElementById(Se)}:P.indexOf(Le)!==-1?{ancestor:n.getElementById(Se),child:n.getElementById(Le)}:null;if(ye!==null)if(X.has(ye.ancestor)){const Re=X.get(ye.ancestor);$.set(ye.ancestor,[Re.child,ye.child]),te.push(we),te.push(Re.edge)}else X.set(ye.ancestor,{child:ye.child,edge:we})}const ge=[...$.keys()],_e=[...X.keys()].reduce((we,Se)=>(ge.indexOf(Se)===-1&&we.push(X.get(Se).child),we),[]),Ce=[...B].reduce((we,Se)=>(te.indexOf(Se)===-1&&we.push(Se),we),[]);return{match:$,remainder:[...new Set(_e)],edges:Ce}};var f=t,x=d;do{const b=u(f,x);s.push(b.match),f=[...b.match.keys(),...b.remainder],x=b.edges}while(x.length>0);this.levels=p.serializedlevels(s)}labelInternal(){for(const d of this.nexml.querySelectorAll("node:not([label])"))d.setAttribute("label",d.id)}fitch(){const d=new Map(this.levels[0].map(n=>{const s=a.normalizedView(),u=this.nexml.querySelector(`node[id="${n}"]`).getAttribute("label"),f=this.boxdiv.querySelector(`span.tree-lemma[data-id="${u}"]`),x=f?p.htmlreading(f,s):void 0;return[n,x]})),t=new Zn(d,this.levels).run();for(const[n,s]of t){const u=this.boxdiv.querySelector(`span.internal[data-key="${n}"]`);u.dataset.reconstructed=s}}clearsvg(){for(;this.svgcontainer.firstChild;)this.svgcontainer.removeChild(this.svgcontainer.firstChild)}removecolors(){const d=this.nexml.querySelectorAll("node[color]");for(let t=0;t<d.snapshotLength;t++)d.snapshotItem(t).removeAttribute("color")}drawlines(d,t){if(this.removecolors(),d){const x=this.getPath(...d.split(";")).path,b=new Set;for(const B of x)b.add(B.getAttribute("target")),b.add(B.getAttribute("source"));for(const B of b){const P=this.nexml.evaluate('//nex:node[@id="'+B+'"]',this.nexml,this.nsResolver,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue;P.getAttribute("root")||P.setAttribute("color",t)}}const n=parseInt(window.getComputedStyle(this.svgcontainer,null).width)-15,s=parseInt(window.getComputedStyle(this.boxdiv,null).height)-10,u=function(){return s<600?600:s}();q.PhyloCanvas.Render.Style.line.stroke="rgb(162,164,170)",this.phylocanvas=new q.PhyloCanvas({nexml:this.nexml,fileSource:!0},this.svgcontainer.id,n,u);const f=this.svgcontainer.querySelectorAll('path:not([stroke="#a2a4aa"])');for(const x of f)x.style.strokeWidth="2"}draw(){this.clear(),this.drawlines(),this.makeLabels()}clearLabels(){for(const d of this.boxdiv.firstChild.querySelectorAll("text"))d.parentElement.removeChild(d)}makeLabels(){const d=[...p.texts()],t=new Set(d.map(s=>s.parentNode.getAttribute("n"))),n=new Map(d.filter(s=>s.parentNode.hasAttribute("corresp")&&s.parentNode.getAttribute("corresp")===this.name).map(s=>[s.parentNode.getAttribute("select").replace(/^#/,""),s.parentNode.getAttribute("n")]));for(const s of this.boxdiv.firstChild.querySelectorAll("text")){const u=document.createElement("div");u.setAttribute("class","tree-div");const f=parseInt(s.getAttribute("x")-5),x=parseInt(s.getAttribute("y"))-15;u.style.left=f+"px",u.style.top=x+"px";const b=s.textContent.trim();t.has(b)?u.innerHTML=`<span class="witness inactive" data-key="${b}">${b}</span><span class="tree-lemma ${b}" data-id="${b}"></span>`:b!=="fakeroot"?n.has(b)?u.innerHTML=`<span class="internal reconstructed" data-key="${b}" data-label="${n.get(b)}">${n.get(b)}</span><span class="tree-lemma invisible ${b}" data-id="${b}" data-label="${n.get(b)}"></span>`:u.innerHTML=`<span class="internal" data-key="${b}">0</span>`:u.innerHTML=`<span class="internal" data-key="${b}"></span>`,s.parentElement.removeChild(s),this.boxdiv.appendChild(u)}}clearlemmata(){for(const d of this.boxdiv.querySelectorAll("span.tree-lemma"))d.innerHTML="",d.dataset.hasOwnProperty("normal")&&delete d.dataset.normal,d.IAST=d.cloneNode(!0)}populate(d,t){const n=p.texts();for(const f of n){const x=f.parentNode.getAttribute("n"),b=this.boxdiv.querySelector(`span.tree-lemma[data-id="${x}"]`)||this.boxdiv.querySelector(`span.tree-lemma[data-label="${x}"]`);if(b){if(b.hasOwnProperty("IAST")||(b.IAST=b.cloneNode(!0)),b.IAST.innerHTML="",t){const B=[],P=[];var s=!1;for(let $=d;$<=t;$++){const X=p.firstword($,f);B.push(X.innerHTML),X.hasAttribute("lemma")&&(P[$-d]=X.getAttribute("lemma")),X.hasAttribute("emended")&&(s=!0)}if(b.IAST.appendChild(N.transformString(B.join(" ").replace(/\s+/g," ").trim(),N.sheets.tree)),P.length!==0){const $=B.slice(0).map((te,ge)=>P.hasOwnProperty(ge)?P[ge]:te),X=document.createElement("span");X.appendChild(N.transformString($.join(" ").replace(/\s+/g," ").trim(),N.sheets.tree)),b.dataset.normal=X.innerHTML}s?b.dataset.emended=!0:b.dataset.hasOwnProperty("emended")&&delete b.dataset.emended}else{const B=p.firstword(d,f);b.IAST.appendChild(N.transformString(B.innerHTML,N.sheets.tree)),B.hasAttribute("lemma")?b.dataset.normal=B.getAttribute("lemma"):delete b.dataset.normal,B.hasAttribute("emended")?b.dataset.emended=!0:b.dataset.hasOwnProperty("emended")&&delete b.dataset.emended}a.normalizedView()&&b.dataset.hasOwnProperty("normal")?b.innerHTML=b.dataset.normal:b.innerHTML=b.IAST.innerHTML}}const u=this.boxdiv.querySelectorAll(".inactive");for(const f of u)f.classList.remove("inactive");this.fitch()}calcPaths(){this.nodes=[],this.paths=[],this.longest={path:[]},this.nsResolver=this.nexml.createNSResolver(this.nexml.ownerDocument==null?this.nexml.documentElement:this.nexml.ownerDocument.documentElement);const d=this.nexml.evaluate("//nex:node[@label]",this.nexml,this.nsResolver,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE);for(let t=0;t<d.snapshotLength;t++)this.nodes.push(d.snapshotItem(t));for(let t=0;t<this.nodes.length;t++){const n=this.nodes[t],s=n.getAttribute("label"),u=n.id;for(let f=t+1;f<this.nodes.length;f++){const x=this.nodes[f],b=x.getAttribute("label"),B=x.id;this.paths.push({nodes:[s,b],path:this.pathFind(u,B)})}}for(const t of Object.keys(this.paths))this.paths[t].path.length>this.longest.path.length&&(this.longest=this.paths[t])}pathFind(d,t,n){n||(n=[]);const s=this.nexml.evaluate('//nex:edge[@source="'+d+'"]|//nex:edge[@target="'+d+'"]',this.nexml,this.nsResolver,XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE,null);var u;for(let f=0;f<s.snapshotLength;f++){const x=s.snapshotItem(f);if(u=[x],n.indexOf(x.id)!=-1)continue;n.push(x.id);const b=x.getAttribute("source")!==d?x.getAttribute("source"):x.getAttribute("target");if(b===t)return u;if(!this.nexml.evaluate('//nex:node[@id="'+b+'"]',this.nexml,this.nsResolver,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue.hasAttribute("otu")){const P=this.pathFind(b,t,n);if(P)return u.concat(P);continue}}return!1}analyzeVariants(d,t){const n=[],s=[],u=function(P){return P.startsWith("<lg")?N.transformString(P,N.sheets.lg).firstChild.data.slice(1):P},f=function(P){return P.map($=>u($)).join(" ").replace(/\s+/g," ").trim()},x=a.normalizedView()?function(P,$){const X=p.firstword(P,$);return X.hasAttribute("lemma")?X.getAttribute("lemma"):X.textContent}:function(P,$){return p.firstword(P,$).textContent};for(const P of p.texts()){const $=P.parentNode.getAttribute("n");if(!this.nexml.querySelector(`otu[label="${$}"]`))continue;const X=t?f(p.range(d,t).map(te=>x(te,P))):u(x(d,P));X===""?n.hasOwnProperty("")?n[""].push($):n[""]=[$]:n.hasOwnProperty(X)?n[X].push($):n[X]=[$]}const b={};for(const P of Object.keys(n)){var B={length:0,branch_length:0,paths:[]};if(n[P].length===1)B=!1;else for(let $=0;$<n[P].length;$++)for(let X=$+1;X<n[P].length;X++){const te=this.getPath(n[P][$],n[P][X]);if(te.hasOwnProperty("path")||alert(te),te.path.length===B.length){const ge=this.calcBranchLength(te.path);ge===B.branch_length?B.paths.push(te):ge>B.branch_length&&(B={length:te.path.length,branch_length:ge,paths:[te]})}else te.path.length>B.length&&(B={length:te.path.length,branch_length:this.calcBranchLength(te.path),paths:[te]})}b[P]=B}for(const P of Object.keys(s))b[P]=s[P];return b}getPath(d,t){for(const n of this.paths)if(n.nodes.indexOf(d)>-1&&n.nodes.indexOf(t)>-1)return n;return!1}calcBranchLength(d){return d.map(t=>t.getAttribute("length")).reduce((t,n)=>parseFloat(t)+parseFloat(n))}pickColour(d,t,n,s){var u=t,f=n,x=d;s&&(x=x*2,x>=1&&(x-=1,u=n,f=s));const b=f.red-u.red,B=f.green-u.green,P=f.blue-u.blue,$={red:parseInt(Math.floor(u.red+b*x),10),green:parseInt(Math.floor(u.green+B*x),10),blue:parseInt(Math.floor(u.blue+P*x),10)};return"rgb("+$.red+","+$.green+","+$.blue+")"}colourizeVariants(d,t){const n=this.analyzeVariants(d,t);for(const s of this.boxdiv.querySelectorAll("span.tree-lemma")){const u=n.hasOwnProperty(s.dataset.id)?n[n[s.dataset.id]]:n[s.textContent],f={red:252,green:70,blue:107},x={red:63,green:94,blue:251};u?(s.style.color=this.pickColour(u.length/this.longest.path.length,x,f),s.dataset.length=u.length,s.dataset.branch_length=u.branch_length,s.dataset.nodes=u.paths[0].nodes.join(";")):(s.style.color=this.pickColour(1/this.longest.path.length,x,f),s.dataset.length=0,s.dataset.branch_length=0,s.dataset.nodes=""),s.textContent.trim()===""?(s.innerHTML='<span lang="en">   </span>',s.style.backgroundColor=s.style.color):s.style.backgroundColor=""}}}class fe extends Y{constructor(d){super(d),this.desc=d,this.text=p.firsttext(d)}init(){this.makeTextBox(),this.makeDescBox(),this.descbox.style.maxWidth="595px",this.descbox.style.paddingLeft="5px",this.boxdiv.addEventListener("mouseup",j.textMouseup)}refresh(){this.boxdiv.innerHTML="",this.boxdiv.appendChild(N.sheets.lemma.transformToFragment(this.text,document)),I(this.boxdiv);for(const d of p.lemmata(!1,this.boxdiv))d.IAST=d.cloneNode(!0);this.updatescript()}makeTextBox(){const d=document.createElement("div");d.dataset.id=this.name,d.classList.add("text-box"),d.appendChild(N.sheets.lemma.transformToFragment(this.text,document)),I(d);for(const t of p.lemmata(!1,d))t.IAST=t.cloneNode(!0);this.boxdiv=d}}class ve extends Y{constructor(){super(name),this.desc="Matrix",this.name="Matrix",this.makeDescBox(),this.makeViewBox(),this.descbox.style.maxWidth="100vw",this.descbox.style.paddingLeft="5px"}init(){this.makeTable()}makeViewBox(){const d=document.createElement("div");d.classList.add("matrix"),d.dataset.id=this.name,this.boxdiv=d}makeTable(){const d=document.createElement("div");d.classList.add("scroller"),d.append(N.sheets.matrix.transformToFragment(h.xml,document)),d.addEventListener("dragstart",j.thDragStart),d.addEventListener("dragenter",j.trDragEnter),d.addEventListener("dragleave",j.trDragLeave),d.addEventListener("dragover",b=>b.preventDefault()),d.addEventListener("drop",j.trDragDrop),d.addEventListener("mousedown",j.matrixMousedown);const t=document.createElement("tr");t.classList.add("header");const n=document.createElement("td");n.classList.add("anchor"),t.appendChild(n);const s=[...p.trs(d)],u=s.map(b=>p.trWalker(b)),f=p.tds(!1,s[0]);for(const b of f){const B=document.createElement("th");B.dataset.ref=b.dataset.n;let P=0;const $=new Set;for(const _e of u){const Ce=_e.nextNode();Ce.IAST=Ce.cloneNode(!0);const we=Ce.textContent;we!==""&&(P++,$.add(we))}const X=P<2?P:`${P}(${$.size})`,te=document.createElement("span");te.classList.add("readings"),te.appendChild(document.createTextNode(X)),B.appendChild(te);const ge=document.createElement("form");ge.innerHTML='<div><input class="insignificant" title="insignificant" type="checkbox"'+(b.dataset.insignificant?"checked":"")+'></div><div><input class="binary" title="binary" type="checkbox"'+(b.dataset.binary?"checked":"")+"></div>",B.appendChild(ge),t.appendChild(B)}const x=d.querySelector("tbody");x.insertBefore(t,x.firstChild),this.boxdiv.append(d)}}return{branchinit:function(){comboView.init(),window.startbox!==void 0&&(window.startbox.tree?v.tree(window.startbox.tree.stemmaid,window.startbox.tree.id):window.startbox.text&&v.text(window.startbox.text.name,window.startbox.text.map))},maininit:function(){const c=document.getElementById("menu");c.addEventListener("mouseover",j.menuMouseover),c.addEventListener("mouseout",j.menuMouseout),c.addEventListener("click",j.menuClick),c.querySelector("#file").addEventListener("change",G.bind(null,W),!1),c.querySelector("#treefile").addEventListener("change",G.bind(null,U),!1),c.style.display="block",comboView.init()},init:function(){h.viewdiv=document.getElementById("views"),h.descs=document.getElementById("descs"),h.viewdiv.addEventListener("click",j.textClick),document.addEventListener("keydown",j.keyDown,{capture:!0}),document.addEventListener("contextmenu",j.rightClick),document.addEventListener("mouseup",ne.remove)},getWindows:function(){return h.windows},addWindow:function(c){h.windows.push(c)},getViewdiv:function(){return h.viewdiv},getTrees:function(){return h.trees}}}();window.addEventListener("load",window.comboView.maininit);
