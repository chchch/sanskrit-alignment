import{showSaveFilePicker as Yt}from"https://cdn.jsdelivr.net/npm/native-file-system-adapter/mod.js";(function(){const k=document.createElement("link").relList;if(k&&k.supports&&k.supports("modulepreload"))return;for(const C of document.querySelectorAll('link[rel="modulepreload"]'))O(C);new MutationObserver(C=>{for(const b of C)if(b.type==="childList")for(const f of b.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&O(f)}).observe(document,{childList:!0,subtree:!0});function N(C){const b={};return C.integrity&&(b.integrity=C.integrity),C.referrerpolicy&&(b.referrerPolicy=C.referrerpolicy),C.crossorigin==="use-credentials"?b.credentials="include":C.crossorigin==="anonymous"?b.credentials="omit":b.credentials="same-origin",b}function O(C){if(C.ep)return;C.ep=!0;const b=N(C);fetch(C.href,b)}})();var Cn={};(function(d){d.__type__="csv";var k=typeof jQuery<"u"&&jQuery.Deferred||typeof _<"u"&&_.Deferred||function(){var i,o,x=new Promise(function(w,R){i=w,o=R});return{resolve:i,reject:o,promise:function(){return x}}};d.fetch=function(i){var o=new k;if(i.file){var x=new FileReader,w=i.encoding||"UTF-8";x.onload=function(z){var B=d.extractFields(d.parse(z.target.result,i),i);B.useMemoryStore=!0,B.metadata={filename:i.file.name},o.resolve(B)},x.onerror=function(z){o.reject({error:{message:"Failed to load file. Code: "+z.target.error.code}})},x.readAsText(i.file,w)}else if(i.data){var R=d.extractFields(d.parse(i.data,i),i);R.useMemoryStore=!0,o.resolve(R)}else if(i.url){var q=window.fetch||function(z){var B=jQuery.get(z),D={then:function(j){return B.done(j),D},catch:function(j){return B.fail(j),D}};return D};q(i.url).then(function(z){return z.text?z.text():z}).then(function(z){var B=d.extractFields(d.parse(z,i),i);B.useMemoryStore=!0,o.resolve(B)}).catch(function(z,B){o.reject({error:{message:"Failed to load file. "+z.statusText+". Code: "+z.status,request:z}})})}return o.promise()},d.extractFields=function(i,o){return o.noHeaderRow!==!0&&i.length>0?{fields:i[0],records:i.slice(1)}:{records:i}},d.normalizeDialectOptions=function(i){var o={delimiter:",",doublequote:!0,lineterminator:`
`,quotechar:'"',skipinitialspace:!0,skipinitialrows:0};for(var x in i)x==="trim"?o.skipinitialspace=i.trim:o[x.toLowerCase()]=i[x];return o},d.parse=function(i,o){(!o||o&&!o.lineterminator)&&(i=d.normalizeLineTerminator(i,o));var x=d.normalizeDialectOptions(o);i=f(i,x.lineterminator);var w="",R=!1,q=!1,z="",B=[],D=[],j,Q;for(Q=function(U){return q!==!0&&(U===""?U=null:x.skipinitialspace===!0&&(U=b(U)),N.test(U)?U=parseInt(U,10):O.test(U)&&(U=parseFloat(U,10))),U},j=0;j<i.length;j+=1)w=i.charAt(j),R===!1&&(w===x.delimiter||w===x.lineterminator)?(z=Q(z),B.push(z),w===x.lineterminator&&(D.push(B),B=[]),z="",q=!1):w!==x.quotechar?z+=w:R?i.charAt(j+1)===x.quotechar?(z+=x.quotechar,j+=1):R=!1:(R=!0,q=!0);return z=Q(z),B.push(z),D.push(B),x.skipinitialrows&&(D=D.slice(x.skipinitialrows)),D},d.normalizeLineTerminator=function(i,o){return o=o||{},o.lineterminator?i:i.replace(/(\r\n|\n|\r)/gm,`
`)},d.objectToArray=function(i){for(var o=[],x=[],w=[],R=0;R<i.fields.length;R++){var q=i.fields[R].id;w.push(q);var z=i.fields[R].label?i.fields[R].label:q;x.push(z)}o.push(x);for(var R=0;R<i.records.length;R++){for(var B=[],D=i.records[R],j=0;j<w.length;j++)B.push(D[w[j]]);o.push(B)}return o},d.serialize=function(i,o){var x=null;i instanceof Array?x=i:x=d.objectToArray(i);var w=d.normalizeDialectOptions(o),R="",q="",z="",B="",D,j,Q;for(Q=function(U){return U===null?U="":typeof U=="string"&&C.test(U)?(w.doublequote&&(U=U.replace(/"/g,'""')),U=w.quotechar+U+w.quotechar):typeof U=="number"&&(U=U.toString(10)),U},D=0;D<x.length;D+=1)for(R=x[D],j=0;j<R.length;j+=1)q=Q(R[j]),j===R.length-1?(z+=q,B+=z+w.lineterminator,z=""):z+=q+w.delimiter,q="";return B};var N=/^\d+$/,O=/^\d*\.\d+$|^\d+\.\d*$/,C=/^\s|\s$|,|"|\n/,b=function(){return String.prototype.trim?function(i){return i.trim()}:function(i){return i.replace(/^\s*/,"").replace(/\s*$/,"")}}();function f(i,o){return i.charAt(i.length-o.length)!==o?i:i.substring(0,i.length-o.length)}})(Cn);function Mn(d){return d&&d.__esModule&&Object.prototype.hasOwnProperty.call(d,"default")?d.default:d}var kn={exports:{}};(function(d,k){(function(N,O){d.exports=O()})(window,function(){return function(N){var O={};function C(b){if(O[b])return O[b].exports;var f=O[b]={i:b,l:!1,exports:{}};return N[b].call(f.exports,f,f.exports,C),f.l=!0,f.exports}return C.m=N,C.c=O,C.d=function(b,f,i){C.o(b,f)||Object.defineProperty(b,f,{enumerable:!0,get:i})},C.r=function(b){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(b,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(b,"__esModule",{value:!0})},C.t=function(b,f){if(1&f&&(b=C(b)),8&f||4&f&&typeof b=="object"&&b&&b.__esModule)return b;var i=Object.create(null);if(C.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:b}),2&f&&typeof b!="string")for(var o in b)C.d(i,o,function(x){return b[x]}.bind(null,o));return i},C.n=function(b){var f=b&&b.__esModule?function(){return b.default}:function(){return b};return C.d(f,"a",f),f},C.o=function(b,f){return Object.prototype.hasOwnProperty.call(b,f)},C.p="",C(C.s=1)}([function(N,O,C){var b,f;b=[C(2)],(f=function(i){function o(e){if(o.is(e,"function"))return x?e():i.on("raphael.DOMload",e);if(o.is(e,u))return o._engine.create[U](o,e.splice(0,3+o.is(e[0],c))).add(e);var t=Array.prototype.slice.call(arguments,0);if(o.is(t[t.length-1],"function")){var a=t.pop();return x?a.call(o._engine.create[U](o,t)):i.on("raphael.DOMload",function(){a.call(o._engine.create[U](o,t))})}return o._engine.create[U](o,arguments)}o.version="2.3.0",o.eve=i;var x,w,R=/[, ]+/,q={circle:1,rect:1,path:1,ellipse:1,text:1,image:1},z=/\{(\d+)\}/g,B="hasOwnProperty",D={doc:document,win:window},j={was:Object.prototype[B].call(D.win,"Raphael"),is:D.win.Raphael},Q=function(){this.ca=this.customAttributes={}},U="apply",G="concat",ie="ontouchstart"in window||window.TouchEvent||window.DocumentTouch&&document instanceof DocumentTouch,de="",ve=" ",$=String,J="split",X="click dblclick mousedown mousemove mouseout mouseover mouseup touchstart touchmove touchend touchcancel"[J](ve),I={mousedown:"touchstart",mousemove:"touchmove",mouseup:"touchend"},ae=$.prototype.toLowerCase,re=Math,ge=re.max,xe=re.min,Y=re.abs,fe=re.pow,pe=re.PI,c="number",u="array",p=Object.prototype.toString,n=(o._ISURL=/^url\(['"]?(.+?)['"]?\)$/i,/^\s*((#[a-f\d]{6})|(#[a-f\d]{3})|rgba?\(\s*([\d\.]+%?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+%?(?:\s*,\s*[\d\.]+%?)?)\s*\)|hsba?\(\s*([\d\.]+(?:deg|\xb0|%)?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+(?:%?\s*,\s*[\d\.]+)?)%?\s*\)|hsla?\(\s*([\d\.]+(?:deg|\xb0|%)?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+(?:%?\s*,\s*[\d\.]+)?)%?\s*\))\s*$/i),r={NaN:1,Infinity:1,"-Infinity":1},s=/^(?:cubic-)?bezier\(([^,]+),([^,]+),([^,]+),([^\)]+)\)/,h=re.round,m=parseFloat,v=parseInt,A=$.prototype.toUpperCase,M=o._availableAttrs={"arrow-end":"none","arrow-start":"none",blur:0,"clip-rect":"0 0 1e9 1e9",cursor:"default",cx:0,cy:0,fill:"#fff","fill-opacity":1,font:'10px "Arial"',"font-family":'"Arial"',"font-size":"10","font-style":"normal","font-weight":400,gradient:0,height:0,href:"http://raphaeljs.com/","letter-spacing":0,opacity:1,path:"M0,0",r:0,rx:0,ry:0,src:"",stroke:"#000","stroke-dasharray":"","stroke-linecap":"butt","stroke-linejoin":"butt","stroke-miterlimit":0,"stroke-opacity":1,"stroke-width":1,target:"_blank","text-anchor":"middle",title:"Raphael",transform:"",width:0,x:0,y:0,class:""},T=o._availableAnimAttrs={blur:c,"clip-rect":"csv",cx:c,cy:c,fill:"colour","fill-opacity":c,"font-size":c,height:c,opacity:c,path:"path",r:c,rx:c,ry:c,stroke:"colour","stroke-opacity":c,"stroke-width":c,transform:"transform",width:c,x:c,y:c},V=/[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*/,W={hs:1,rg:1},oe=/,?([achlmqrstvxz]),?/gi,be=/([achlmrqstvz])[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029,]*((-?\d*\.?\d*(?:e[\-+]?\d+)?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*)+)/gi,we=/([rstm])[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029,]*((-?\d*\.?\d*(?:e[\-+]?\d+)?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*)+)/gi,ye=/(-?\d*\.?\d*(?:e[\-+]?\d+)?)[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*/gi,Ae=(o._radial_gradient=/^r(?:\(([^,]+?)[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*([^\)]+?)\))?/,{}),Ee=function(e,t){return m(e)-m(t)},_e=function(e){return e},ke=o._rectPath=function(e,t,a,l,g){return g?[["M",e+g,t],["l",a-2*g,0],["a",g,g,0,0,1,g,g],["l",0,l-2*g],["a",g,g,0,0,1,-g,g],["l",2*g-a,0],["a",g,g,0,0,1,-g,-g],["l",0,2*g-l],["a",g,g,0,0,1,g,-g],["z"]]:[["M",e,t],["l",a,0],["l",0,l],["l",-a,0],["z"]]},Be=function(e,t,a,l){return l==null&&(l=a),[["M",e,t],["m",0,-l],["a",a,l,0,1,1,0,2*l],["a",a,l,0,1,1,0,-2*l],["z"]]},Me=o._getPath={path:function(e){return e.attr("path")},circle:function(e){var t=e.attrs;return Be(t.cx,t.cy,t.r)},ellipse:function(e){var t=e.attrs;return Be(t.cx,t.cy,t.rx,t.ry)},rect:function(e){var t=e.attrs;return ke(t.x,t.y,t.width,t.height,t.r)},image:function(e){var t=e.attrs;return ke(t.x,t.y,t.width,t.height)},text:function(e){var t=e._getBBox();return ke(t.x,t.y,t.width,t.height)},set:function(e){var t=e._getBBox();return ke(t.x,t.y,t.width,t.height)}},De=o.mapPath=function(e,t){if(!t)return e;var a,l,g,S,P,E,L;for(g=0,P=(e=St(e)).length;g<P;g++)for(S=1,E=(L=e[g]).length;S<E;S+=2)a=t.x(L[S],L[S+1]),l=t.y(L[S],L[S+1]),L[S]=a,L[S+1]=l;return e};if(o._g=D,o.type=D.win.SVGAngle||D.doc.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1")?"SVG":"VML",o.type=="VML"){var Te,Fe=D.doc.createElement("div");if(Fe.innerHTML='<v:shape adj="1"/>',(Te=Fe.firstChild).style.behavior="url(#default#VML)",!Te||typeof Te.adj!="object")return o.type=de;Fe=null}function ze(e){if(typeof e=="function"||Object(e)!==e)return e;var t=new e.constructor;for(var a in e)e[B](a)&&(t[a]=ze(e[a]));return t}o.svg=!(o.vml=o.type=="VML"),o._Paper=Q,o.fn=w=Q.prototype=o.prototype,o._id=0,o.is=function(e,t){return(t=ae.call(t))=="finite"?!r[B](+e):t=="array"?e instanceof Array:t=="null"&&e===null||t==typeof e&&e!==null||t=="object"&&e===Object(e)||t=="array"&&Array.isArray&&Array.isArray(e)||p.call(e).slice(8,-1).toLowerCase()==t},o.angle=function(e,t,a,l,g,S){if(g==null){var P=e-a,E=t-l;return P||E?(180+180*re.atan2(-E,-P)/pe+360)%360:0}return o.angle(e,t,g,S)-o.angle(a,l,g,S)},o.rad=function(e){return e%360*pe/180},o.deg=function(e){return Math.round(180*e/pe%360*1e3)/1e3},o.snapTo=function(e,t,a){if(a=o.is(a,"finite")?a:10,o.is(e,u)){for(var l=e.length;l--;)if(Y(e[l]-t)<=a)return e[l]}else{var g=t%(e=+e);if(g<a)return t-g;if(g>e-a)return t-g+e}return t};var Ye,wt;o.createUUID=(Ye=/[xy]/g,wt=function(e){var t=16*re.random()|0;return(e=="x"?t:3&t|8).toString(16)},function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(Ye,wt).toUpperCase()}),o.setWindow=function(e){i("raphael.setWindow",o,D.win,e),D.win=e,D.doc=D.win.document,o._engine.initWin&&o._engine.initWin(D.win)};var Je=function(e){if(o.vml){var t,a=/^\s+|\s+$/g;try{var l=new ActiveXObject("htmlfile");l.write("<body>"),l.close(),t=l.body}catch{t=createPopup().document.body}var g=t.createTextRange();Je=qe(function(P){try{t.style.color=$(P).replace(a,de);var E=g.queryCommandValue("ForeColor");return"#"+("000000"+(E=(255&E)<<16|65280&E|(16711680&E)>>>16).toString(16)).slice(-6)}catch{return"none"}})}else{var S=D.doc.createElement("i");S.title="Rapha\xEBl Colour Picker",S.style.display="none",D.doc.body.appendChild(S),Je=qe(function(P){return S.style.color=P,D.doc.defaultView.getComputedStyle(S,de).getPropertyValue("color")})}return Je(e)},at=function(){return"hsb("+[this.h,this.s,this.b]+")"},ot=function(){return"hsl("+[this.h,this.s,this.l]+")"},Ct=function(){return this.hex},lt=function(e,t,a){if(t==null&&o.is(e,"object")&&"r"in e&&"g"in e&&"b"in e&&(a=e.b,t=e.g,e=e.r),t==null&&o.is(e,"string")){var l=o.getRGB(e);e=l.r,t=l.g,a=l.b}return(e>1||t>1||a>1)&&(e/=255,t/=255,a/=255),[e,t,a]},Bt=function(e,t,a,l){var g={r:e*=255,g:t*=255,b:a*=255,hex:o.rgb(e,t,a),toString:Ct};return o.is(l,"finite")&&(g.opacity=l),g};function qe(e,t,a){return function l(){var g=Array.prototype.slice.call(arguments,0),S=g.join("\u2400"),P=l.cache=l.cache||{},E=l.count=l.count||[];return P[B](S)?(function(L,H){for(var Z=0,le=L.length;Z<le;Z++)if(L[Z]===H)return L.push(L.splice(Z,1)[0])}(E,S),a?a(P[S]):P[S]):(E.length>=1e3&&delete P[E.shift()],E.push(S),P[S]=e[U](t,g),a?a(P[S]):P[S])}}o.color=function(e){var t;return o.is(e,"object")&&"h"in e&&"s"in e&&"b"in e?(t=o.hsb2rgb(e),e.r=t.r,e.g=t.g,e.b=t.b,e.hex=t.hex):o.is(e,"object")&&"h"in e&&"s"in e&&"l"in e?(t=o.hsl2rgb(e),e.r=t.r,e.g=t.g,e.b=t.b,e.hex=t.hex):(o.is(e,"string")&&(e=o.getRGB(e)),o.is(e,"object")&&"r"in e&&"g"in e&&"b"in e?(t=o.rgb2hsl(e),e.h=t.h,e.s=t.s,e.l=t.l,t=o.rgb2hsb(e),e.v=t.b):(e={hex:"none"}).r=e.g=e.b=e.h=e.s=e.v=e.l=-1),e.toString=Ct,e},o.hsb2rgb=function(e,t,a,l){var g,S,P,E,L;return this.is(e,"object")&&"h"in e&&"s"in e&&"b"in e&&(a=e.b,t=e.s,l=e.o,e=e.h),E=(L=a*t)*(1-Y((e=(e*=360)%360/60)%2-1)),g=S=P=a-L,Bt(g+=[L,E,0,0,E,L][e=~~e],S+=[E,L,L,E,0,0][e],P+=[0,0,E,L,L,E][e],l)},o.hsl2rgb=function(e,t,a,l){var g,S,P,E,L;return this.is(e,"object")&&"h"in e&&"s"in e&&"l"in e&&(a=e.l,t=e.s,e=e.h),(e>1||t>1||a>1)&&(e/=360,t/=100,a/=100),E=(L=2*t*(a<.5?a:1-a))*(1-Y((e=(e*=360)%360/60)%2-1)),g=S=P=a-L/2,Bt(g+=[L,E,0,0,E,L][e=~~e],S+=[E,L,L,E,0,0][e],P+=[0,0,E,L,L,E][e],l)},o.rgb2hsb=function(e,t,a){var l,g;return e=(a=lt(e,t,a))[0],t=a[1],a=a[2],{h:(((g=(l=ge(e,t,a))-xe(e,t,a))==0?null:l==e?(t-a)/g:l==t?(a-e)/g+2:(e-t)/g+4)+360)%6*60/360,s:g==0?0:g/l,b:l,toString:at}},o.rgb2hsl=function(e,t,a){var l,g,S,P;return e=(a=lt(e,t,a))[0],t=a[1],a=a[2],l=((g=ge(e,t,a))+(S=xe(e,t,a)))/2,{h:(((P=g-S)==0?null:g==e?(t-a)/P:g==t?(a-e)/P+2:(e-t)/P+4)+360)%6*60/360,s:P==0?0:l<.5?P/(2*l):P/(2-2*l),l,toString:ot}},o._path2string=function(){return this.join(",").replace(oe,"$1")},o._preload=function(e,t){var a=D.doc.createElement("img");a.style.cssText="position:absolute;left:-9999em;top:-9999em",a.onload=function(){t.call(this),this.onload=null,D.doc.body.removeChild(this)},a.onerror=function(){D.doc.body.removeChild(this)},D.doc.body.appendChild(a),a.src=e};function Ke(){return this.hex}function ct(e,t){for(var a=[],l=0,g=e.length;g-2*!t>l;l+=2){var S=[{x:+e[l-2],y:+e[l-1]},{x:+e[l],y:+e[l+1]},{x:+e[l+2],y:+e[l+3]},{x:+e[l+4],y:+e[l+5]}];t?l?g-4==l?S[3]={x:+e[0],y:+e[1]}:g-2==l&&(S[2]={x:+e[0],y:+e[1]},S[3]={x:+e[2],y:+e[3]}):S[0]={x:+e[g-2],y:+e[g-1]}:g-4==l?S[3]=S[2]:l||(S[0]={x:+e[l],y:+e[l+1]}),a.push(["C",(-S[0].x+6*S[1].x+S[2].x)/6,(-S[0].y+6*S[1].y+S[2].y)/6,(S[1].x+6*S[2].x-S[3].x)/6,(S[1].y+6*S[2].y-S[3].y)/6,S[2].x,S[2].y])}return a}o.getRGB=qe(function(e){if(!e||(e=$(e)).indexOf("-")+1)return{r:-1,g:-1,b:-1,hex:"none",error:1,toString:Ke};if(e=="none")return{r:-1,g:-1,b:-1,hex:"none",toString:Ke};!W[B](e.toLowerCase().substring(0,2))&&e.charAt()!="#"&&(e=Je(e));var t,a,l,g,S,P,E=e.match(n);return E?(E[2]&&(l=v(E[2].substring(5),16),a=v(E[2].substring(3,5),16),t=v(E[2].substring(1,3),16)),E[3]&&(l=v((S=E[3].charAt(3))+S,16),a=v((S=E[3].charAt(2))+S,16),t=v((S=E[3].charAt(1))+S,16)),E[4]&&(P=E[4][J](V),t=m(P[0]),P[0].slice(-1)=="%"&&(t*=2.55),a=m(P[1]),P[1].slice(-1)=="%"&&(a*=2.55),l=m(P[2]),P[2].slice(-1)=="%"&&(l*=2.55),E[1].toLowerCase().slice(0,4)=="rgba"&&(g=m(P[3])),P[3]&&P[3].slice(-1)=="%"&&(g/=100)),E[5]?(P=E[5][J](V),t=m(P[0]),P[0].slice(-1)=="%"&&(t*=2.55),a=m(P[1]),P[1].slice(-1)=="%"&&(a*=2.55),l=m(P[2]),P[2].slice(-1)=="%"&&(l*=2.55),(P[0].slice(-3)=="deg"||P[0].slice(-1)=="\xB0")&&(t/=360),E[1].toLowerCase().slice(0,4)=="hsba"&&(g=m(P[3])),P[3]&&P[3].slice(-1)=="%"&&(g/=100),o.hsb2rgb(t,a,l,g)):E[6]?(P=E[6][J](V),t=m(P[0]),P[0].slice(-1)=="%"&&(t*=2.55),a=m(P[1]),P[1].slice(-1)=="%"&&(a*=2.55),l=m(P[2]),P[2].slice(-1)=="%"&&(l*=2.55),(P[0].slice(-3)=="deg"||P[0].slice(-1)=="\xB0")&&(t/=360),E[1].toLowerCase().slice(0,4)=="hsla"&&(g=m(P[3])),P[3]&&P[3].slice(-1)=="%"&&(g/=100),o.hsl2rgb(t,a,l,g)):((E={r:t,g:a,b:l,toString:Ke}).hex="#"+(16777216|l|a<<8|t<<16).toString(16).slice(1),o.is(g,"finite")&&(E.opacity=g),E)):{r:-1,g:-1,b:-1,hex:"none",error:1,toString:Ke}},o),o.hsb=qe(function(e,t,a){return o.hsb2rgb(e,t,a).hex}),o.hsl=qe(function(e,t,a){return o.hsl2rgb(e,t,a).hex}),o.rgb=qe(function(e,t,a){function l(g){return g+.5|0}return"#"+(16777216|l(a)|l(t)<<8|l(e)<<16).toString(16).slice(1)}),o.getColor=function(e){var t=this.getColor.start=this.getColor.start||{h:0,s:1,b:e||.75},a=this.hsb2rgb(t.h,t.s,t.b);return t.h+=.075,t.h>1&&(t.h=0,t.s-=.2,t.s<=0&&(this.getColor.start={h:0,s:1,b:t.b})),a.hex},o.getColor.reset=function(){delete this.start},o.parsePathString=function(e){if(!e)return null;var t=Ue(e);if(t.arr)return He(t.arr);var a={a:7,c:6,h:1,l:2,m:2,r:4,q:4,s:4,t:2,v:1,z:0},l=[];return o.is(e,u)&&o.is(e[0],u)&&(l=He(e)),l.length||$(e).replace(be,function(g,S,P){var E=[],L=S.toLowerCase();if(P.replace(ye,function(H,Z){Z&&E.push(+Z)}),L=="m"&&E.length>2&&(l.push([S][G](E.splice(0,2))),L="l",S=S=="m"?"l":"L"),L=="r")l.push([S][G](E));else for(;E.length>=a[L]&&(l.push([S][G](E.splice(0,a[L]))),a[L]););}),l.toString=o._path2string,t.arr=He(l),l},o.parseTransformString=qe(function(e){if(!e)return null;var t=[];return o.is(e,u)&&o.is(e[0],u)&&(t=He(e)),t.length||$(e).replace(we,function(a,l,g){var S=[];ae.call(l),g.replace(ye,function(P,E){E&&S.push(+E)}),t.push([l][G](S))}),t.toString=o._path2string,t},this,function(e){if(!e)return e;for(var t=[],a=0;a<e.length;a++){for(var l=[],g=0;g<e[a].length;g++)l.push(e[a][g]);t.push(l)}return t});var Ue=function(e){var t=Ue.ps=Ue.ps||{};return t[e]?t[e].sleep=100:t[e]={sleep:100},setTimeout(function(){for(var a in t)t[B](a)&&a!=e&&(t[a].sleep--,!t[a].sleep&&delete t[a])}),t[e]};function ut(e,t,a,l,g){return e*(e*(-3*t+9*a-9*l+3*g)+6*t-12*a+6*l)-3*t+3*a}function Ge(e,t,a,l,g,S,P,E,L){L==null&&(L=1);for(var H=(L=L>1?1:L<0?0:L)/2,Z=[-.1252,.1252,-.3678,.3678,-.5873,.5873,-.7699,.7699,-.9041,.9041,-.9816,.9816],le=[.2491,.2491,.2335,.2335,.2032,.2032,.1601,.1601,.1069,.1069,.0472,.0472],te=0,K=0;K<12;K++){var ne=H*Z[K]+H,ce=ut(ne,e,a,g,P),se=ut(ne,t,l,S,E),ee=ce*ce+se*se;te+=le[K]*re.sqrt(ee)}return H*te}function kt(e,t,a,l,g,S,P,E){if(!(ge(e,a)<xe(g,P)||xe(e,a)>ge(g,P)||ge(t,l)<xe(S,E)||xe(t,l)>ge(S,E))){var L=(e-a)*(S-E)-(t-l)*(g-P);if(L){var H=((e*l-t*a)*(g-P)-(e-a)*(g*E-S*P))/L,Z=((e*l-t*a)*(S-E)-(t-l)*(g*E-S*P))/L,le=+H.toFixed(2),te=+Z.toFixed(2);if(!(le<+xe(e,a).toFixed(2)||le>+ge(e,a).toFixed(2)||le<+xe(g,P).toFixed(2)||le>+ge(g,P).toFixed(2)||te<+xe(t,l).toFixed(2)||te>+ge(t,l).toFixed(2)||te<+xe(S,E).toFixed(2)||te>+ge(S,E).toFixed(2)))return{x:H,y:Z}}}}function ht(e,t,a){var l=o.bezierBBox(e),g=o.bezierBBox(t);if(!o.isBBoxIntersect(l,g))return a?0:[];for(var S=Ge.apply(0,e),P=Ge.apply(0,t),E=ge(~~(S/5),1),L=ge(~~(P/5),1),H=[],Z=[],le={},te=a?0:[],K=0;K<E+1;K++){var ne=o.findDotsAtSegment.apply(o,e.concat(K/E));H.push({x:ne.x,y:ne.y,t:K/E})}for(K=0;K<L+1;K++)ne=o.findDotsAtSegment.apply(o,t.concat(K/L)),Z.push({x:ne.x,y:ne.y,t:K/L});for(K=0;K<E;K++)for(var ce=0;ce<L;ce++){var se=H[K],ee=H[K+1],Ce=Z[ce],ue=Z[ce+1],me=Y(ee.x-se.x)<.001?"y":"x",he=Y(ue.x-Ce.x)<.001?"y":"x",Pe=kt(se.x,se.y,ee.x,ee.y,Ce.x,Ce.y,ue.x,ue.y);if(Pe){if(le[Pe.x.toFixed(4)]==Pe.y.toFixed(4))continue;le[Pe.x.toFixed(4)]=Pe.y.toFixed(4);var Se=se.t+Y((Pe[me]-se[me])/(ee[me]-se[me]))*(ee.t-se.t),Re=Ce.t+Y((Pe[he]-Ce[he])/(ue[he]-Ce[he]))*(ue.t-Ce.t);Se>=0&&Se<=1.001&&Re>=0&&Re<=1.001&&(a?te++:te.push({x:Pe.x,y:Pe.y,t1:xe(Se,1),t2:xe(Re,1)}))}}return te}function _t(e,t,a){e=o._path2curve(e),t=o._path2curve(t);for(var l,g,S,P,E,L,H,Z,le,te,K=a?0:[],ne=0,ce=e.length;ne<ce;ne++){var se=e[ne];if(se[0]=="M")l=E=se[1],g=L=se[2];else{se[0]=="C"?(le=[l,g].concat(se.slice(1)),l=le[6],g=le[7]):(le=[l,g,l,g,E,L,E,L],l=E,g=L);for(var ee=0,Ce=t.length;ee<Ce;ee++){var ue=t[ee];if(ue[0]=="M")S=H=ue[1],P=Z=ue[2];else{ue[0]=="C"?(te=[S,P].concat(ue.slice(1)),S=te[6],P=te[7]):(te=[S,P,S,P,H,Z,H,Z],S=H,P=Z);var me=ht(le,te,a);if(a)K+=me;else{for(var he=0,Pe=me.length;he<Pe;he++)me[he].segment1=ne,me[he].segment2=ee,me[he].bez1=le,me[he].bez2=te;K=K.concat(me)}}}}}return K}o.findDotsAtSegment=function(e,t,a,l,g,S,P,E,L){var H=1-L,Z=fe(H,3),le=fe(H,2),te=L*L,K=te*L,ne=Z*e+3*le*L*a+3*H*L*L*g+K*P,ce=Z*t+3*le*L*l+3*H*L*L*S+K*E,se=e+2*L*(a-e)+te*(g-2*a+e),ee=t+2*L*(l-t)+te*(S-2*l+t),Ce=a+2*L*(g-a)+te*(P-2*g+a),ue=l+2*L*(S-l)+te*(E-2*S+l),me=H*e+L*a,he=H*t+L*l,Pe=H*g+L*P,Se=H*S+L*E,Re=90-180*re.atan2(se-Ce,ee-ue)/pe;return(se>Ce||ee<ue)&&(Re+=180),{x:ne,y:ce,m:{x:se,y:ee},n:{x:Ce,y:ue},start:{x:me,y:he},end:{x:Pe,y:Se},alpha:Re}},o.bezierBBox=function(e,t,a,l,g,S,P,E){o.is(e,"array")||(e=[e,t,a,l,g,S,P,E]);var L=Nt.apply(null,e);return{x:L.min.x,y:L.min.y,x2:L.max.x,y2:L.max.y,width:L.max.x-L.min.x,height:L.max.y-L.min.y}},o.isPointInsideBBox=function(e,t,a){return t>=e.x&&t<=e.x2&&a>=e.y&&a<=e.y2},o.isBBoxIntersect=function(e,t){var a=o.isPointInsideBBox;return a(t,e.x,e.y)||a(t,e.x2,e.y)||a(t,e.x,e.y2)||a(t,e.x2,e.y2)||a(e,t.x,t.y)||a(e,t.x2,t.y)||a(e,t.x,t.y2)||a(e,t.x2,t.y2)||(e.x<t.x2&&e.x>t.x||t.x<e.x2&&t.x>e.x)&&(e.y<t.y2&&e.y>t.y||t.y<e.y2&&t.y>e.y)},o.pathIntersection=function(e,t){return _t(e,t)},o.pathIntersectionNumber=function(e,t){return _t(e,t,1)},o.isPointInsidePath=function(e,t,a){var l=o.pathBBox(e);return o.isPointInsideBBox(l,t,a)&&_t(e,[["M",t,a],["H",l.x2+10]],1)%2==1},o._removedFactory=function(e){return function(){i("raphael.log",null,"Rapha\xEBl: you are calling to method \u201C"+e+"\u201D of removed object",e)}};var Qe=o.pathBBox=function(e){var t=Ue(e);if(t.bbox)return ze(t.bbox);if(!e)return{x:0,y:0,width:0,height:0,x2:0,y2:0};for(var a,l=0,g=0,S=[],P=[],E=0,L=(e=St(e)).length;E<L;E++)if((a=e[E])[0]=="M")l=a[1],g=a[2],S.push(l),P.push(g);else{var H=Nt(l,g,a[1],a[2],a[3],a[4],a[5],a[6]);S=S[G](H.min.x,H.max.x),P=P[G](H.min.y,H.max.y),l=a[5],g=a[6]}var Z=xe[U](0,S),le=xe[U](0,P),te=ge[U](0,S),K=ge[U](0,P),ne=te-Z,ce=K-le,se={x:Z,y:le,x2:te,y2:K,width:ne,height:ce,cx:Z+ne/2,cy:le+ce/2};return t.bbox=ze(se),se},He=function(e){var t=ze(e);return t.toString=o._path2string,t},Qt=o._pathToRelative=function(e){var t=Ue(e);if(t.rel)return He(t.rel);o.is(e,u)&&o.is(e&&e[0],u)||(e=o.parsePathString(e));var a=[],l=0,g=0,S=0,P=0,E=0;e[0][0]=="M"&&(S=l=e[0][1],P=g=e[0][2],E++,a.push(["M",l,g]));for(var L=E,H=e.length;L<H;L++){var Z=a[L]=[],le=e[L];if(le[0]!=ae.call(le[0]))switch(Z[0]=ae.call(le[0]),Z[0]){case"a":Z[1]=le[1],Z[2]=le[2],Z[3]=le[3],Z[4]=le[4],Z[5]=le[5],Z[6]=+(le[6]-l).toFixed(3),Z[7]=+(le[7]-g).toFixed(3);break;case"v":Z[1]=+(le[1]-g).toFixed(3);break;case"m":S=le[1],P=le[2];default:for(var te=1,K=le.length;te<K;te++)Z[te]=+(le[te]-(te%2?l:g)).toFixed(3)}else{Z=a[L]=[],le[0]=="m"&&(S=le[1]+l,P=le[2]+g);for(var ne=0,ce=le.length;ne<ce;ne++)a[L][ne]=le[ne]}var se=a[L].length;switch(a[L][0]){case"z":l=S,g=P;break;case"h":l+=+a[L][se-1];break;case"v":g+=+a[L][se-1];break;default:l+=+a[L][se-2],g+=+a[L][se-1]}}return a.toString=o._path2string,t.rel=He(a),a},dt=o._pathToAbsolute=function(e){var t=Ue(e);if(t.abs)return He(t.abs);if(o.is(e,u)&&o.is(e&&e[0],u)||(e=o.parsePathString(e)),!e||!e.length)return[["M",0,0]];var a=[],l=0,g=0,S=0,P=0,E=0;e[0][0]=="M"&&(S=l=+e[0][1],P=g=+e[0][2],E++,a[0]=["M",l,g]);for(var L,H,Z=e.length==3&&e[0][0]=="M"&&e[1][0].toUpperCase()=="R"&&e[2][0].toUpperCase()=="Z",le=E,te=e.length;le<te;le++){if(a.push(L=[]),(H=e[le])[0]!=A.call(H[0]))switch(L[0]=A.call(H[0]),L[0]){case"A":L[1]=H[1],L[2]=H[2],L[3]=H[3],L[4]=H[4],L[5]=H[5],L[6]=+(H[6]+l),L[7]=+(H[7]+g);break;case"V":L[1]=+H[1]+g;break;case"H":L[1]=+H[1]+l;break;case"R":for(var K=[l,g][G](H.slice(1)),ne=2,ce=K.length;ne<ce;ne++)K[ne]=+K[ne]+l,K[++ne]=+K[ne]+g;a.pop(),a=a[G](ct(K,Z));break;case"M":S=+H[1]+l,P=+H[2]+g;default:for(ne=1,ce=H.length;ne<ce;ne++)L[ne]=+H[ne]+(ne%2?l:g)}else if(H[0]=="R")K=[l,g][G](H.slice(1)),a.pop(),a=a[G](ct(K,Z)),L=["R"][G](H.slice(-2));else for(var se=0,ee=H.length;se<ee;se++)L[se]=H[se];switch(L[0]){case"Z":l=S,g=P;break;case"H":l=L[1];break;case"V":g=L[1];break;case"M":S=L[L.length-2],P=L[L.length-1];default:l=L[L.length-2],g=L[L.length-1]}}return a.toString=o._path2string,t.abs=He(a),a},ft=function(e,t,a,l){return[e,t,a,l,a,l]},Ze=function(e,t,a,l,g,S){return[1/3*e+2/3*a,1/3*t+2/3*l,1/3*g+2/3*a,1/3*S+2/3*l,g,S]},Tt=function(e,t,a,l,g,S,P,E,L,H){var Z,le=120*pe/180,te=pe/180*(+g||0),K=[],ne=qe(function(xn,vn,Ft){return{x:xn*re.cos(Ft)-vn*re.sin(Ft),y:xn*re.sin(Ft)+vn*re.cos(Ft)}});if(H)Se=H[0],Re=H[1],he=H[2],Pe=H[3];else{e=(Z=ne(e,t,-te)).x,t=Z.y,E=(Z=ne(E,L,-te)).x,L=Z.y;var ce=(e-E)/2,se=(t-L)/2,ee=ce*ce/(a*a)+se*se/(l*l);ee>1&&(a*=ee=re.sqrt(ee),l*=ee);var Ce=a*a,ue=l*l,me=(S==P?-1:1)*re.sqrt(Y((Ce*ue-Ce*se*se-ue*ce*ce)/(Ce*se*se+ue*ce*ce))),he=me*a*se/l+(e+E)/2,Pe=me*-l*ce/a+(t+L)/2,Se=re.asin(((t-Pe)/l).toFixed(9)),Re=re.asin(((L-Pe)/l).toFixed(9));(Se=e<he?pe-Se:Se)<0&&(Se=2*pe+Se),(Re=E<he?pe-Re:Re)<0&&(Re=2*pe+Re),P&&Se>Re&&(Se-=2*pe),!P&&Re>Se&&(Re-=2*pe)}var mt=Re-Se;if(Y(mt)>le){var Pt=Re,$e=E,je=L;Re=Se+le*(P&&Re>Se?1:-1),E=he+a*re.cos(Re),L=Pe+l*re.sin(Re),K=Tt(E,L,a,l,g,0,P,$e,je,[Re,Pt,he,Pe])}mt=Re-Se;var gt=re.cos(Se),xt=re.sin(Se),Dt=re.cos(Re),We=re.sin(Re),it=re.tan(mt/4),It=4/3*a*it,dn=4/3*l*it,fn=[e,t],vt=[e+It*xt,t-dn*gt],pn=[E+It*We,L-dn*Dt],mn=[E,L];if(vt[0]=2*fn[0]-vt[0],vt[1]=2*fn[1]-vt[1],H)return[vt,pn,mn][G](K);for(var gn=[],tt=0,Nn=(K=[vt,pn,mn][G](K).join()[J](",")).length;tt<Nn;tt++)gn[tt]=tt%2?ne(K[tt-1],K[tt],te).y:ne(K[tt],K[tt+1],te).x;return gn},nt=function(e,t,a,l,g,S,P,E,L){var H=1-L;return{x:fe(H,3)*e+3*fe(H,2)*L*a+3*H*L*L*g+fe(L,3)*P,y:fe(H,3)*t+3*fe(H,2)*L*l+3*H*L*L*S+fe(L,3)*E}},Nt=qe(function(e,t,a,l,g,S,P,E){var L,H=g-2*a+e-(P-2*g+a),Z=2*(a-e)-2*(g-a),le=e-a,te=(-Z+re.sqrt(Z*Z-4*H*le))/2/H,K=(-Z-re.sqrt(Z*Z-4*H*le))/2/H,ne=[t,E],ce=[e,P];return Y(te)>"1e12"&&(te=.5),Y(K)>"1e12"&&(K=.5),te>0&&te<1&&(L=nt(e,t,a,l,g,S,P,E,te),ce.push(L.x),ne.push(L.y)),K>0&&K<1&&(L=nt(e,t,a,l,g,S,P,E,K),ce.push(L.x),ne.push(L.y)),H=S-2*l+t-(E-2*S+l),le=t-l,te=(-(Z=2*(l-t)-2*(S-l))+re.sqrt(Z*Z-4*H*le))/2/H,K=(-Z-re.sqrt(Z*Z-4*H*le))/2/H,Y(te)>"1e12"&&(te=.5),Y(K)>"1e12"&&(K=.5),te>0&&te<1&&(L=nt(e,t,a,l,g,S,P,E,te),ce.push(L.x),ne.push(L.y)),K>0&&K<1&&(L=nt(e,t,a,l,g,S,P,E,K),ce.push(L.x),ne.push(L.y)),{min:{x:xe[U](0,ce),y:xe[U](0,ne)},max:{x:ge[U](0,ce),y:ge[U](0,ne)}}}),St=o._path2curve=qe(function(e,t){var a=!t&&Ue(e);if(!t&&a.curve)return He(a.curve);for(var l=dt(e),g=t&&dt(t),S={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},P={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},E=function(me,he,Pe){var Se,Re;if(!me)return["C",he.x,he.y,he.x,he.y,he.x,he.y];switch(!(me[0]in{T:1,Q:1})&&(he.qx=he.qy=null),me[0]){case"M":he.X=me[1],he.Y=me[2];break;case"A":me=["C"][G](Tt[U](0,[he.x,he.y][G](me.slice(1))));break;case"S":Pe=="C"||Pe=="S"?(Se=2*he.x-he.bx,Re=2*he.y-he.by):(Se=he.x,Re=he.y),me=["C",Se,Re][G](me.slice(1));break;case"T":Pe=="Q"||Pe=="T"?(he.qx=2*he.x-he.qx,he.qy=2*he.y-he.qy):(he.qx=he.x,he.qy=he.y),me=["C"][G](Ze(he.x,he.y,he.qx,he.qy,me[1],me[2]));break;case"Q":he.qx=me[1],he.qy=me[2],me=["C"][G](Ze(he.x,he.y,me[1],me[2],me[3],me[4]));break;case"L":me=["C"][G](ft(he.x,he.y,me[1],me[2]));break;case"H":me=["C"][G](ft(he.x,he.y,me[1],he.y));break;case"V":me=["C"][G](ft(he.x,he.y,he.x,me[1]));break;case"Z":me=["C"][G](ft(he.x,he.y,he.X,he.Y))}return me},L=function(me,he){if(me[he].length>7){me[he].shift();for(var Pe=me[he];Pe.length;)Z[he]="A",g&&(le[he]="A"),me.splice(he++,0,["C"][G](Pe.splice(0,6)));me.splice(he,1),ce=ge(l.length,g&&g.length||0)}},H=function(me,he,Pe,Se,Re){me&&he&&me[Re][0]=="M"&&he[Re][0]!="M"&&(he.splice(Re,0,["M",Se.x,Se.y]),Pe.bx=0,Pe.by=0,Pe.x=me[Re][1],Pe.y=me[Re][2],ce=ge(l.length,g&&g.length||0))},Z=[],le=[],te="",K="",ne=0,ce=ge(l.length,g&&g.length||0);ne<ce;ne++){l[ne]&&(te=l[ne][0]),te!="C"&&(Z[ne]=te,ne&&(K=Z[ne-1])),l[ne]=E(l[ne],S,K),Z[ne]!="A"&&te=="C"&&(Z[ne]="C"),L(l,ne),g&&(g[ne]&&(te=g[ne][0]),te!="C"&&(le[ne]=te,ne&&(K=le[ne-1])),g[ne]=E(g[ne],P,K),le[ne]!="A"&&te=="C"&&(le[ne]="C"),L(g,ne)),H(l,g,S,P,ne),H(g,l,P,S,ne);var se=l[ne],ee=g&&g[ne],Ce=se.length,ue=g&&ee.length;S.x=se[Ce-2],S.y=se[Ce-1],S.bx=m(se[Ce-4])||S.x,S.by=m(se[Ce-3])||S.y,P.bx=g&&(m(ee[ue-4])||P.x),P.by=g&&(m(ee[ue-3])||P.y),P.x=g&&ee[ue-2],P.y=g&&ee[ue-1]}return g||(a.curve=He(l)),g?[l,g]:l},null,He),Mt=(o._parseDots=qe(function(e){for(var t=[],a=0,l=e.length;a<l;a++){var g={},S=e[a].match(/^([^:]*):?([\d\.]*)/);if(g.color=o.getRGB(S[1]),g.color.error)return null;g.opacity=g.color.opacity,g.color=g.color.hex,S[2]&&(g.offset=S[2]+"%"),t.push(g)}for(a=1,l=t.length-1;a<l;a++)if(!t[a].offset){for(var P=m(t[a-1].offset||0),E=0,L=a+1;L<l;L++)if(t[L].offset){E=t[L].offset;break}E||(E=100,L=l);for(var H=((E=m(E))-P)/(L-a+1);a<L;a++)P+=H,t[a].offset=P+"%"}return t}),o._tear=function(e,t){e==t.top&&(t.top=e.prev),e==t.bottom&&(t.bottom=e.next),e.next&&(e.next.prev=e.prev),e.prev&&(e.prev.next=e.next)}),Sn=(o._tofront=function(e,t){t.top!==e&&(Mt(e,t),e.next=null,e.prev=t.top,t.top.next=e,t.top=e)},o._toback=function(e,t){t.bottom!==e&&(Mt(e,t),e.next=t.bottom,e.prev=null,t.bottom.prev=e,t.bottom=e)},o._insertafter=function(e,t,a){Mt(e,a),t==a.top&&(a.top=e),t.next&&(t.next.prev=e),e.next=t.next,e.prev=t,t.next=e},o._insertbefore=function(e,t,a){Mt(e,a),t==a.bottom&&(a.bottom=e),t.prev&&(t.prev.next=e),e.prev=t.prev,t.prev=e,e.next=t},o.toMatrix=function(e,t){var a=Qe(e),l={_:{transform:de},getBBox:function(){return a}};return Zt(l,t),l.matrix}),Zt=(o.transformPath=function(e,t){return De(e,Sn(e,t))},o._extractTransform=function(e,t){if(t==null)return e._.transform;t=$(t).replace(/\.{3}|\u2026/g,e._.transform||de);var a,l,g=o.parseTransformString(t),S=0,P=1,E=1,L=e._,H=new rt;if(L.transform=g||[],g)for(var Z=0,le=g.length;Z<le;Z++){var te,K,ne,ce,se,ee=g[Z],Ce=ee.length,ue=$(ee[0]).toLowerCase(),me=ee[0]!=ue,he=me?H.invert():0;ue=="t"&&Ce==3?me?(te=he.x(0,0),K=he.y(0,0),ne=he.x(ee[1],ee[2]),ce=he.y(ee[1],ee[2]),H.translate(ne-te,ce-K)):H.translate(ee[1],ee[2]):ue=="r"?Ce==2?(se=se||e.getBBox(1),H.rotate(ee[1],se.x+se.width/2,se.y+se.height/2),S+=ee[1]):Ce==4&&(me?(ne=he.x(ee[2],ee[3]),ce=he.y(ee[2],ee[3]),H.rotate(ee[1],ne,ce)):H.rotate(ee[1],ee[2],ee[3]),S+=ee[1]):ue=="s"?Ce==2||Ce==3?(se=se||e.getBBox(1),H.scale(ee[1],ee[Ce-1],se.x+se.width/2,se.y+se.height/2),P*=ee[1],E*=ee[Ce-1]):Ce==5&&(me?(ne=he.x(ee[3],ee[4]),ce=he.y(ee[3],ee[4]),H.scale(ee[1],ee[2],ne,ce)):H.scale(ee[1],ee[2],ee[3],ee[4]),P*=ee[1],E*=ee[2]):ue=="m"&&Ce==7&&H.add(ee[1],ee[2],ee[3],ee[4],ee[5],ee[6]),L.dirtyT=1,e.matrix=H}e.matrix=H,L.sx=P,L.sy=E,L.deg=S,L.dx=a=H.e,L.dy=l=H.f,P==1&&E==1&&!S&&L.bbox?(L.bbox.x+=+a,L.bbox.y+=+l):L.dirtyT=1}),en=function(e){var t=e[0];switch(t.toLowerCase()){case"t":return[t,0,0];case"m":return[t,1,0,0,1,0,0];case"r":return e.length==4?[t,0,e[2],e[3]]:[t,0];case"s":return e.length==5?[t,1,1,e[3],e[4]]:e.length==3?[t,1,1]:[t,1]}},An=o._equaliseTransform=function(e,t){t=$(t).replace(/\.{3}|\u2026/g,e),e=o.parseTransformString(e)||[],t=o.parseTransformString(t)||[];for(var a,l,g,S,P=ge(e.length,t.length),E=[],L=[],H=0;H<P;H++){if(g=e[H]||en(t[H]),S=t[H]||en(g),g[0]!=S[0]||g[0].toLowerCase()=="r"&&(g[2]!=S[2]||g[3]!=S[3])||g[0].toLowerCase()=="s"&&(g[3]!=S[3]||g[4]!=S[4]))return;for(E[H]=[],L[H]=[],a=0,l=ge(g.length,S.length);a<l;a++)a in g&&(E[H][a]=g[a]),a in S&&(L[H][a]=S[a])}return{from:E,to:L}};function rt(e,t,a,l,g,S){e!=null?(this.a=+e,this.b=+t,this.c=+a,this.d=+l,this.e=+g,this.f=+S):(this.a=1,this.b=0,this.c=0,this.d=1,this.e=0,this.f=0)}o._getContainer=function(e,t,a,l){var g;if((g=l!=null||o.is(e,"object")?e:D.doc.getElementById(e))!=null)return g.tagName?t==null?{container:g,width:g.style.pixelWidth||g.offsetWidth,height:g.style.pixelHeight||g.offsetHeight}:{container:g,width:t,height:a}:{container:1,x:e,y:t,width:a,height:l}},o.pathToRelative=Qt,o._engine={},o.path2curve=St,o.matrix=function(e,t,a,l,g,S){return new rt(e,t,a,l,g,S)},function(e){function t(l){return l[0]*l[0]+l[1]*l[1]}function a(l){var g=re.sqrt(t(l));l[0]&&(l[0]/=g),l[1]&&(l[1]/=g)}e.add=function(l,g,S,P,E,L){var H,Z,le,te,K=[[],[],[]],ne=[[this.a,this.c,this.e],[this.b,this.d,this.f],[0,0,1]],ce=[[l,S,E],[g,P,L],[0,0,1]];for(l&&l instanceof rt&&(ce=[[l.a,l.c,l.e],[l.b,l.d,l.f],[0,0,1]]),H=0;H<3;H++)for(Z=0;Z<3;Z++){for(te=0,le=0;le<3;le++)te+=ne[H][le]*ce[le][Z];K[H][Z]=te}this.a=K[0][0],this.b=K[1][0],this.c=K[0][1],this.d=K[1][1],this.e=K[0][2],this.f=K[1][2]},e.invert=function(){var l=this,g=l.a*l.d-l.b*l.c;return new rt(l.d/g,-l.b/g,-l.c/g,l.a/g,(l.c*l.f-l.d*l.e)/g,(l.b*l.e-l.a*l.f)/g)},e.clone=function(){return new rt(this.a,this.b,this.c,this.d,this.e,this.f)},e.translate=function(l,g){this.add(1,0,0,1,l,g)},e.scale=function(l,g,S,P){g==null&&(g=l),(S||P)&&this.add(1,0,0,1,S,P),this.add(l,0,0,g,0,0),(S||P)&&this.add(1,0,0,1,-S,-P)},e.rotate=function(l,g,S){l=o.rad(l),g=g||0,S=S||0;var P=+re.cos(l).toFixed(9),E=+re.sin(l).toFixed(9);this.add(P,E,-E,P,g,S),this.add(1,0,0,1,-g,-S)},e.x=function(l,g){return l*this.a+g*this.c+this.e},e.y=function(l,g){return l*this.b+g*this.d+this.f},e.get=function(l){return+this[$.fromCharCode(97+l)].toFixed(4)},e.toString=function(){return o.svg?"matrix("+[this.get(0),this.get(1),this.get(2),this.get(3),this.get(4),this.get(5)].join()+")":[this.get(0),this.get(2),this.get(1),this.get(3),0,0].join()},e.toFilter=function(){return"progid:DXImageTransform.Microsoft.Matrix(M11="+this.get(0)+", M12="+this.get(2)+", M21="+this.get(1)+", M22="+this.get(3)+", Dx="+this.get(4)+", Dy="+this.get(5)+", sizingmethod='auto expand')"},e.offset=function(){return[this.e.toFixed(4),this.f.toFixed(4)]},e.split=function(){var l={};l.dx=this.e,l.dy=this.f;var g=[[this.a,this.c],[this.b,this.d]];l.scalex=re.sqrt(t(g[0])),a(g[0]),l.shear=g[0][0]*g[1][0]+g[0][1]*g[1][1],g[1]=[g[1][0]-g[0][0]*l.shear,g[1][1]-g[0][1]*l.shear],l.scaley=re.sqrt(t(g[1])),a(g[1]),l.shear/=l.scaley;var S=-g[0][1],P=g[1][1];return P<0?(l.rotate=o.deg(re.acos(P)),S<0&&(l.rotate=360-l.rotate)):l.rotate=o.deg(re.asin(S)),l.isSimple=!(+l.shear.toFixed(9)||l.scalex.toFixed(9)!=l.scaley.toFixed(9)&&l.rotate),l.isSuperSimple=!+l.shear.toFixed(9)&&l.scalex.toFixed(9)==l.scaley.toFixed(9)&&!l.rotate,l.noRotation=!+l.shear.toFixed(9)&&!l.rotate,l},e.toTransformString=function(l){var g=l||this[J]();return g.isSimple?(g.scalex=+g.scalex.toFixed(4),g.scaley=+g.scaley.toFixed(4),g.rotate=+g.rotate.toFixed(4),(g.dx||g.dy?"t"+[g.dx,g.dy]:de)+(g.scalex!=1||g.scaley!=1?"s"+[g.scalex,g.scaley,0,0]:de)+(g.rotate?"r"+[g.rotate,0,0]:de)):"m"+[this.get(0),this.get(1),this.get(2),this.get(3),this.get(4),this.get(5)]}}(rt.prototype);for(var En=function(){this.returnValue=!1},Pn=function(){return this.originalEvent.preventDefault()},Rn=function(){this.cancelBubble=!0},Ln=function(){return this.originalEvent.stopPropagation()},tn=function(e){var t=D.doc.documentElement.scrollTop||D.doc.body.scrollTop,a=D.doc.documentElement.scrollLeft||D.doc.body.scrollLeft;return{x:e.clientX+a,y:e.clientY+t}},Bn=D.doc.addEventListener?function(e,t,a,l){var g=function(P){var E=tn(P);return a.call(l,P,E.x,E.y)};if(e.addEventListener(t,g,!1),ie&&I[t]){var S=function(P){for(var E=tn(P),L=P,H=0,Z=P.targetTouches&&P.targetTouches.length;H<Z;H++)if(P.targetTouches[H].target==e){(P=P.targetTouches[H]).originalEvent=L,P.preventDefault=Pn,P.stopPropagation=Ln;break}return a.call(l,P,E.x,E.y)};e.addEventListener(I[t],S,!1)}return function(){return e.removeEventListener(t,g,!1),ie&&I[t]&&e.removeEventListener(I[t],S,!1),!0}}:D.doc.attachEvent?function(e,t,a,l){var g=function(S){S=S||D.win.event;var P=D.doc.documentElement.scrollTop||D.doc.body.scrollTop,E=D.doc.documentElement.scrollLeft||D.doc.body.scrollLeft,L=S.clientX+E,H=S.clientY+P;return S.preventDefault=S.preventDefault||En,S.stopPropagation=S.stopPropagation||Rn,a.call(l,S,L,H)};return e.attachEvent("on"+t,g),function(){return e.detachEvent("on"+t,g),!0}}:void 0,et=[],Ht=function(e){for(var t,a=e.clientX,l=e.clientY,g=D.doc.documentElement.scrollTop||D.doc.body.scrollTop,S=D.doc.documentElement.scrollLeft||D.doc.body.scrollLeft,P=et.length;P--;){if(t=et[P],ie&&e.touches){for(var E,L=e.touches.length;L--;)if((E=e.touches[L]).identifier==t.el._drag.id){a=E.clientX,l=E.clientY,(e.originalEvent?e.originalEvent:e).preventDefault();break}}else e.preventDefault();var H,Z=t.el.node,le=Z.nextSibling,te=Z.parentNode,K=Z.style.display;D.win.opera&&te.removeChild(Z),Z.style.display="none",H=t.el.paper.getElementByPoint(a,l),Z.style.display=K,D.win.opera&&(le?te.insertBefore(Z,le):te.appendChild(Z)),H&&i("raphael.drag.over."+t.el.id,t.el,H),a+=S,l+=g,i("raphael.drag.move."+t.el.id,t.move_scope||t.el,a-t.el._drag.x,l-t.el._drag.y,a,l,e)}},$t=function(e){o.unmousemove(Ht).unmouseup($t);for(var t,a=et.length;a--;)(t=et[a]).el._drag={},i("raphael.drag.end."+t.el.id,t.end_scope||t.start_scope||t.move_scope||t.el,e);et=[]},Ne=o.el={},nn=X.length;nn--;)(function(e){o[e]=Ne[e]=function(t,a){return o.is(t,"function")&&(this.events=this.events||[],this.events.push({name:e,f:t,unbind:Bn(this.shape||this.node||D.doc,e,t,a||this)})),this},o["un"+e]=Ne["un"+e]=function(t){for(var a=this.events||[],l=a.length;l--;)a[l].name!=e||!o.is(t,"undefined")&&a[l].f!=t||(a[l].unbind(),a.splice(l,1),!a.length&&delete this.events);return this}})(X[nn]);Ne.data=function(e,t){var a=Ae[this.id]=Ae[this.id]||{};if(arguments.length==0)return a;if(arguments.length==1){if(o.is(e,"object")){for(var l in e)e[B](l)&&this.data(l,e[l]);return this}return i("raphael.data.get."+this.id,this,a[e],e),a[e]}return a[e]=t,i("raphael.data.set."+this.id,this,t,e),this},Ne.removeData=function(e){return e==null?delete Ae[this.id]:Ae[this.id]&&delete Ae[this.id][e],this},Ne.getData=function(){return ze(Ae[this.id]||{})},Ne.hover=function(e,t,a,l){return this.mouseover(e,a).mouseout(t,l||a)},Ne.unhover=function(e,t){return this.unmouseover(e).unmouseout(t)};var pt=[];Ne.drag=function(e,t,a,l,g,S){function P(E){(E.originalEvent||E).preventDefault();var L=E.clientX,H=E.clientY,Z=D.doc.documentElement.scrollTop||D.doc.body.scrollTop,le=D.doc.documentElement.scrollLeft||D.doc.body.scrollLeft;if(this._drag.id=E.identifier,ie&&E.touches){for(var te,K=E.touches.length;K--;)if(te=E.touches[K],this._drag.id=te.identifier,te.identifier==this._drag.id){L=te.clientX,H=te.clientY;break}}this._drag.x=L+le,this._drag.y=H+Z,!et.length&&o.mousemove(Ht).mouseup($t),et.push({el:this,move_scope:l,start_scope:g,end_scope:S}),t&&i.on("raphael.drag.start."+this.id,t),e&&i.on("raphael.drag.move."+this.id,e),a&&i.on("raphael.drag.end."+this.id,a),i("raphael.drag.start."+this.id,g||l||this,this._drag.x,this._drag.y,E)}return this._drag={},pt.push({el:this,start:P}),this.mousedown(P),this},Ne.onDragOver=function(e){e?i.on("raphael.drag.over."+this.id,e):i.unbind("raphael.drag.over."+this.id)},Ne.undrag=function(){for(var e=pt.length;e--;)pt[e].el==this&&(this.unmousedown(pt[e].start),pt.splice(e,1),i.unbind("raphael.drag.*."+this.id));!pt.length&&o.unmousemove(Ht).unmouseup($t),et=[]},w.circle=function(e,t,a){var l=o._engine.circle(this,e||0,t||0,a||0);return this.__set__&&this.__set__.push(l),l},w.rect=function(e,t,a,l,g){var S=o._engine.rect(this,e||0,t||0,a||0,l||0,g||0);return this.__set__&&this.__set__.push(S),S},w.ellipse=function(e,t,a,l){var g=o._engine.ellipse(this,e||0,t||0,a||0,l||0);return this.__set__&&this.__set__.push(g),g},w.path=function(e){e&&!o.is(e,"string")&&!o.is(e[0],u)&&(e+=de);var t=o._engine.path(o.format[U](o,arguments),this);return this.__set__&&this.__set__.push(t),t},w.image=function(e,t,a,l,g){var S=o._engine.image(this,e||"about:blank",t||0,a||0,l||0,g||0);return this.__set__&&this.__set__.push(S),S},w.text=function(e,t,a){var l=o._engine.text(this,e||0,t||0,$(a));return this.__set__&&this.__set__.push(l),l},w.set=function(e){!o.is(e,"array")&&(e=Array.prototype.splice.call(arguments,0,arguments.length));var t=new Et(e);return this.__set__&&this.__set__.push(t),t.paper=this,t.type="set",t},w.setStart=function(e){this.__set__=e||this.set()},w.setFinish=function(e){var t=this.__set__;return delete this.__set__,t},w.getSize=function(){var e=this.canvas.parentNode;return{width:e.offsetWidth,height:e.offsetHeight}},w.setSize=function(e,t){return o._engine.setSize.call(this,e,t)},w.setViewBox=function(e,t,a,l,g){return o._engine.setViewBox.call(this,e,t,a,l,g)},w.top=w.bottom=null,w.raphael=o;function rn(){return this.x+ve+this.y+ve+this.width+" \xD7 "+this.height}w.getElementByPoint=function(e,t){var a,l,g,S,P,E,L,H=this.canvas,Z=D.doc.elementFromPoint(e,t);if(D.win.opera&&Z.tagName=="svg"){var le=(l=(a=H).getBoundingClientRect(),g=a.ownerDocument,S=g.body,P=g.documentElement,E=P.clientTop||S.clientTop||0,L=P.clientLeft||S.clientLeft||0,{y:l.top+(D.win.pageYOffset||P.scrollTop||S.scrollTop)-E,x:l.left+(D.win.pageXOffset||P.scrollLeft||S.scrollLeft)-L}),te=H.createSVGRect();te.x=e-le.x,te.y=t-le.y,te.width=te.height=1;var K=H.getIntersectionList(te,null);K.length&&(Z=K[K.length-1])}if(!Z)return null;for(;Z.parentNode&&Z!=H.parentNode&&!Z.raphael;)Z=Z.parentNode;return Z==this.canvas.parentNode&&(Z=H),Z=Z&&Z.raphael?this.getById(Z.raphaelid):null},w.getElementsByBBox=function(e){var t=this.set();return this.forEach(function(a){o.isBBoxIntersect(a.getBBox(),e)&&t.push(a)}),t},w.getById=function(e){for(var t=this.bottom;t;){if(t.id==e)return t;t=t.next}return null},w.forEach=function(e,t){for(var a=this.bottom;a;){if(e.call(t,a)===!1)return this;a=a.next}return this},w.getElementsByPoint=function(e,t){var a=this.set();return this.forEach(function(l){l.isPointInside(e,t)&&a.push(l)}),a},Ne.isPointInside=function(e,t){var a=this.realPath=Me[this.type](this);return this.attr("transform")&&this.attr("transform").length&&(a=o.transformPath(a,this.attr("transform"))),o.isPointInsidePath(a,e,t)},Ne.getBBox=function(e){if(this.removed)return{};var t=this._;return e?(!t.dirty&&t.bboxwt||(this.realPath=Me[this.type](this),t.bboxwt=Qe(this.realPath),t.bboxwt.toString=rn,t.dirty=0),t.bboxwt):((t.dirty||t.dirtyT||!t.bbox)&&(!t.dirty&&this.realPath||(t.bboxwt=0,this.realPath=Me[this.type](this)),t.bbox=Qe(De(this.realPath,this.matrix)),t.bbox.toString=rn,t.dirty=t.dirtyT=0),t.bbox)},Ne.clone=function(){if(this.removed)return null;var e=this.paper[this.type]().attr(this.attr());return this.__set__&&this.__set__.push(e),e},Ne.glow=function(e){if(this.type=="text")return null;var t={width:((e=e||{}).width||10)+(+this.attr("stroke-width")||1),fill:e.fill||!1,opacity:e.opacity==null?.5:e.opacity,offsetx:e.offsetx||0,offsety:e.offsety||0,color:e.color||"#000"},a=t.width/2,l=this.paper,g=l.set(),S=this.realPath||Me[this.type](this);S=this.matrix?De(S,this.matrix):S;for(var P=1;P<a+1;P++)g.push(l.path(S).attr({stroke:t.color,fill:t.fill?t.color:"none","stroke-linejoin":"round","stroke-linecap":"round","stroke-width":+(t.width/a*P).toFixed(3),opacity:+(t.opacity/a).toFixed(3)}));return g.insertBefore(this).translate(t.offsetx,t.offsety)};var Vt=function(e,t,a,l,g,S,P,E,L){return L==null?Ge(e,t,a,l,g,S,P,E):o.findDotsAtSegment(e,t,a,l,g,S,P,E,function(H,Z,le,te,K,ne,ce,se,ee){if(!(ee<0||Ge(H,Z,le,te,K,ne,ce,se)<ee)){var Ce,ue=.5,me=1-ue;for(Ce=Ge(H,Z,le,te,K,ne,ce,se,me);Y(Ce-ee)>.01;)Ce=Ge(H,Z,le,te,K,ne,ce,se,me+=(Ce<ee?1:-1)*(ue/=2));return me}}(e,t,a,l,g,S,P,E,L))},Ut=function(e,t){return function(a,l,g){for(var S,P,E,L,H,Z="",le={},te=0,K=0,ne=(a=St(a)).length;K<ne;K++){if((E=a[K])[0]=="M")S=+E[1],P=+E[2];else{if(te+(L=Vt(S,P,E[1],E[2],E[3],E[4],E[5],E[6]))>l){if(t&&!le.start){if(Z+=["C"+(H=Vt(S,P,E[1],E[2],E[3],E[4],E[5],E[6],l-te)).start.x,H.start.y,H.m.x,H.m.y,H.x,H.y],g)return Z;le.start=Z,Z=["M"+H.x,H.y+"C"+H.n.x,H.n.y,H.end.x,H.end.y,E[5],E[6]].join(),te+=L,S=+E[5],P=+E[6];continue}if(!e&&!t)return{x:(H=Vt(S,P,E[1],E[2],E[3],E[4],E[5],E[6],l-te)).x,y:H.y,alpha:H.alpha}}te+=L,S=+E[5],P=+E[6]}Z+=E.shift()+E}return le.end=Z,(H=e?te:t?le:o.findDotsAtSegment(S,P,E[0],E[1],E[2],E[3],E[4],E[5],1)).alpha&&(H={x:H.x,y:H.y,alpha:H.alpha}),H}},sn=Ut(1),an=Ut(),Gt=Ut(0,1);o.getTotalLength=sn,o.getPointAtLength=an,o.getSubpath=function(e,t,a){if(this.getTotalLength(e)-a<1e-6)return Gt(e,t).end;var l=Gt(e,a,1);return t?Gt(l,t).end:l},Ne.getTotalLength=function(){var e=this.getPath();if(e)return this.node.getTotalLength?this.node.getTotalLength():sn(e)},Ne.getPointAtLength=function(e){var t=this.getPath();if(t)return an(t,e)},Ne.getPath=function(){var e,t=o._getPath[this.type];if(this.type!="text"&&this.type!="set")return t&&(e=t(this)),e},Ne.getSubpath=function(e,t){var a=this.getPath();if(a)return o.getSubpath(a,e,t)};var Ve=o.easing_formulas={linear:function(e){return e},"<":function(e){return fe(e,1.7)},">":function(e){return fe(e,.48)},"<>":function(e){var t=.48-e/1.04,a=re.sqrt(.1734+t*t),l=a-t,g=-a-t,S=fe(Y(l),1/3)*(l<0?-1:1)+fe(Y(g),1/3)*(g<0?-1:1)+.5;return 3*(1-S)*S*S+S*S*S},backIn:function(e){var t=1.70158;return e*e*((t+1)*e-t)},backOut:function(e){var t=1.70158;return(e-=1)*e*((t+1)*e+t)+1},elastic:function(e){return e==!!e?e:fe(2,-10*e)*re.sin(2*pe*(e-.075)/.3)+1},bounce:function(e){var t=7.5625,a=2.75;return e<1/a?t*e*e:e<2/a?t*(e-=1.5/a)*e+.75:e<2.5/a?t*(e-=2.25/a)*e+.9375:t*(e-=2.625/a)*e+.984375}};Ve.easeIn=Ve["ease-in"]=Ve["<"],Ve.easeOut=Ve["ease-out"]=Ve[">"],Ve.easeInOut=Ve["ease-in-out"]=Ve["<>"],Ve["back-in"]=Ve.backIn,Ve["back-out"]=Ve.backOut;var Le=[],on=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){setTimeout(e,16)},jt=function(){for(var e=+new Date,t=0;t<Le.length;t++){var a=Le[t];if(!a.el.removed&&!a.paused){var l,g,S=e-a.start,P=a.ms,E=a.easing,L=a.from,H=a.diff,Z=a.to,le=(a.t,a.el),te={},K={};if(a.initstatus?(S=(a.initstatus*a.anim.top-a.prev)/(a.percent-a.prev)*P,a.status=a.initstatus,delete a.initstatus,a.stop&&Le.splice(t--,1)):a.status=(a.prev+(a.percent-a.prev)*(S/P))/a.anim.top,!(S<0))if(S<P){var ne=E(S/P);for(var ce in L)if(L[B](ce)){switch(T[ce]){case c:l=+L[ce]+ne*P*H[ce];break;case"colour":l="rgb("+[Xt(h(L[ce].r+ne*P*H[ce].r)),Xt(h(L[ce].g+ne*P*H[ce].g)),Xt(h(L[ce].b+ne*P*H[ce].b))].join(",")+")";break;case"path":l=[];for(var se=0,ee=L[ce].length;se<ee;se++){l[se]=[L[ce][se][0]];for(var Ce=1,ue=L[ce][se].length;Ce<ue;Ce++)l[se][Ce]=+L[ce][se][Ce]+ne*P*H[ce][se][Ce];l[se]=l[se].join(ve)}l=l.join(ve);break;case"transform":if(H[ce].real)for(l=[],se=0,ee=L[ce].length;se<ee;se++)for(l[se]=[L[ce][se][0]],Ce=1,ue=L[ce][se].length;Ce<ue;Ce++)l[se][Ce]=L[ce][se][Ce]+ne*P*H[ce][se][Ce];else{var me=function(Pe){return+L[ce][Pe]+ne*P*H[ce][Pe]};l=[["m",me(0),me(1),me(2),me(3),me(4),me(5)]]}break;case"csv":if(ce=="clip-rect")for(l=[],se=4;se--;)l[se]=+L[ce][se]+ne*P*H[ce][se];break;default:var he=[][G](L[ce]);for(l=[],se=le.paper.customAttributes[ce].length;se--;)l[se]=+he[se]+ne*P*H[ce][se]}te[ce]=l}le.attr(te),function(Pe,Se,Re){setTimeout(function(){i("raphael.anim.frame."+Pe,Se,Re)})}(le.id,le,a.anim)}else{if(function(Pe,Se,Re){setTimeout(function(){i("raphael.anim.frame."+Se.id,Se,Re),i("raphael.anim.finish."+Se.id,Se,Re),o.is(Pe,"function")&&Pe.call(Se)})}(a.callback,le,a.anim),le.attr(Z),Le.splice(t--,1),a.repeat>1&&!a.next){for(g in Z)Z[B](g)&&(K[g]=a.totalOrigin[g]);a.el.attr(K),At(a.anim,a.el,a.anim.percents[0],null,a.totalOrigin,a.repeat-1)}a.next&&!a.stop&&At(a.anim,a.el,a.next,null,a.totalOrigin,a.repeat)}}}Le.length&&on(jt)},Xt=function(e){return e>255?255:e<0?0:e};function Tn(e,t,a,l,g,S){var P=3*t,E=3*(l-t)-P,L=1-P-E,H=3*a,Z=3*(g-a)-H,le=1-H-Z;function te(K){return((L*K+E)*K+P)*K}return function(K,ne){var ce=function(se,ee){var Ce,ue,me,he,Pe,Se;for(me=se,Se=0;Se<8;Se++){if(he=te(me)-se,Y(he)<ee)return me;if(Y(Pe=(3*L*me+2*E)*me+P)<1e-6)break;me-=he/Pe}if(ue=1,(me=se)<(Ce=0))return Ce;if(me>ue)return ue;for(;Ce<ue;){if(he=te(me),Y(he-se)<ee)return me;se>he?Ce=me:ue=me,me=(ue-Ce)/2+Ce}return me}(K,ne);return((le*ce+Z)*ce+H)*ce}(e,1/(200*S))}function Xe(e,t){var a=[],l={};if(this.ms=t,this.times=1,e){for(var g in e)e[B](g)&&(l[m(g)]=e[g],a.push(m(g)));a.sort(Ee)}this.anim=l,this.top=a[a.length-1],this.percents=a}function At(e,t,a,l,g,S){a=m(a);var P,E,L,H,Z,le,te=e.ms,K={},ne={},ce={};if(l)for(ee=0,Ce=Le.length;ee<Ce;ee++){var se=Le[ee];if(se.el.id==t.id&&se.anim==e){se.percent!=a?(Le.splice(ee,1),L=1):E=se,t.attr(se.totalOrigin);break}}else l=+ne;for(var ee=0,Ce=e.percents.length;ee<Ce;ee++){if(e.percents[ee]==a||e.percents[ee]>l*e.top){a=e.percents[ee],Z=e.percents[ee-1]||0,te=te/e.top*(a-Z),H=e.percents[ee+1],P=e.anim[a];break}l&&t.attr(e.anim[e.percents[ee]])}if(P){if(E)E.initstatus=l,E.start=new Date-E.ms*l;else{for(var ue in P)if(P[B](ue)&&(T[B](ue)||t.paper.customAttributes[B](ue)))switch(K[ue]=t.attr(ue),K[ue]==null&&(K[ue]=M[ue]),ne[ue]=P[ue],T[ue]){case c:ce[ue]=(ne[ue]-K[ue])/te;break;case"colour":K[ue]=o.getRGB(K[ue]);var me=o.getRGB(ne[ue]);ce[ue]={r:(me.r-K[ue].r)/te,g:(me.g-K[ue].g)/te,b:(me.b-K[ue].b)/te};break;case"path":var he=St(K[ue],ne[ue]),Pe=he[1];for(K[ue]=he[0],ce[ue]=[],ee=0,Ce=K[ue].length;ee<Ce;ee++){ce[ue][ee]=[0];for(var Se=1,Re=K[ue][ee].length;Se<Re;Se++)ce[ue][ee][Se]=(Pe[ee][Se]-K[ue][ee][Se])/te}break;case"transform":var mt=t._,Pt=An(mt[ue],ne[ue]);if(Pt)for(K[ue]=Pt.from,ne[ue]=Pt.to,ce[ue]=[],ce[ue].real=!0,ee=0,Ce=K[ue].length;ee<Ce;ee++)for(ce[ue][ee]=[K[ue][ee][0]],Se=1,Re=K[ue][ee].length;Se<Re;Se++)ce[ue][ee][Se]=(ne[ue][ee][Se]-K[ue][ee][Se])/te;else{var $e=t.matrix||new rt,je={_:{transform:mt.transform},getBBox:function(){return t.getBBox(1)}};K[ue]=[$e.a,$e.b,$e.c,$e.d,$e.e,$e.f],Zt(je,ne[ue]),ne[ue]=je._.transform,ce[ue]=[(je.matrix.a-$e.a)/te,(je.matrix.b-$e.b)/te,(je.matrix.c-$e.c)/te,(je.matrix.d-$e.d)/te,(je.matrix.e-$e.e)/te,(je.matrix.f-$e.f)/te]}break;case"csv":var gt=$(P[ue])[J](R),xt=$(K[ue])[J](R);if(ue=="clip-rect")for(K[ue]=xt,ce[ue]=[],ee=xt.length;ee--;)ce[ue][ee]=(gt[ee]-K[ue][ee])/te;ne[ue]=gt;break;default:for(gt=[][G](P[ue]),xt=[][G](K[ue]),ce[ue]=[],ee=t.paper.customAttributes[ue].length;ee--;)ce[ue][ee]=((gt[ee]||0)-(xt[ee]||0))/te}var Dt=P.easing,We=o.easing_formulas[Dt];if(!We)if((We=$(Dt).match(s))&&We.length==5){var it=We;We=function(It){return Tn(It,+it[1],+it[2],+it[3],+it[4],te)}}else We=_e;if(se={anim:e,percent:a,timestamp:le=P.start||e.start||+new Date,start:le+(e.del||0),status:0,initstatus:l||0,stop:!1,ms:te,easing:We,from:K,diff:ce,to:ne,el:t,callback:P.callback,prev:Z,next:H,repeat:S||e.times,origin:t.attr(),totalOrigin:g},Le.push(se),l&&!E&&!L&&(se.stop=!0,se.start=new Date-te*l,Le.length==1))return jt();L&&(se.start=new Date-se.ms*l),Le.length==1&&on(jt)}i("raphael.anim.start."+t.id,t,e)}}function ln(e){for(var t=0;t<Le.length;t++)Le[t].el.paper==e&&Le.splice(t--,1)}Ne.animateWith=function(e,t,a,l,g,S){if(this.removed)return S&&S.call(this),this;var P=a instanceof Xe?a:o.animation(a,l,g,S);At(P,this,P.percents[0],null,this.attr());for(var E=0,L=Le.length;E<L;E++)if(Le[E].anim==t&&Le[E].el==e){Le[L-1].start=Le[E].start;break}return this},Ne.onAnimation=function(e){return e?i.on("raphael.anim.frame."+this.id,e):i.unbind("raphael.anim.frame."+this.id),this},Xe.prototype.delay=function(e){var t=new Xe(this.anim,this.ms);return t.times=this.times,t.del=+e||0,t},Xe.prototype.repeat=function(e){var t=new Xe(this.anim,this.ms);return t.del=this.del,t.times=re.floor(ge(e,0))||1,t},o.animation=function(e,t,a,l){if(e instanceof Xe)return e;!o.is(a,"function")&&a||(l=l||a||null,a=null),e=Object(e),t=+t||0;var g,S,P={};for(S in e)e[B](S)&&m(S)!=S&&m(S)+"%"!=S&&(g=!0,P[S]=e[S]);if(g)return a&&(P.easing=a),l&&(P.callback=l),new Xe({100:P},t);if(l){var E=0;for(var L in e){var H=v(L);e[B](L)&&H>E&&(E=H)}!e[E+="%"].callback&&(e[E].callback=l)}return new Xe(e,t)},Ne.animate=function(e,t,a,l){if(this.removed)return l&&l.call(this),this;var g=e instanceof Xe?e:o.animation(e,t,a,l);return At(g,this,g.percents[0],null,this.attr()),this},Ne.setTime=function(e,t){return e&&t!=null&&this.status(e,xe(t,e.ms)/e.ms),this},Ne.status=function(e,t){var a,l,g=[],S=0;if(t!=null)return At(e,this,-1,xe(t,1)),this;for(a=Le.length;S<a;S++)if((l=Le[S]).el.id==this.id&&(!e||l.anim==e)){if(e)return l.status;g.push({anim:l.anim,status:l.status})}return e?0:g},Ne.pause=function(e){for(var t=0;t<Le.length;t++)Le[t].el.id!=this.id||e&&Le[t].anim!=e||i("raphael.anim.pause."+this.id,this,Le[t].anim)!==!1&&(Le[t].paused=!0);return this},Ne.resume=function(e){for(var t=0;t<Le.length;t++)if(Le[t].el.id==this.id&&(!e||Le[t].anim==e)){var a=Le[t];i("raphael.anim.resume."+this.id,this,a.anim)!==!1&&(delete a.paused,this.status(a.anim,a.status))}return this},Ne.stop=function(e){for(var t=0;t<Le.length;t++)Le[t].el.id!=this.id||e&&Le[t].anim!=e||i("raphael.anim.stop."+this.id,this,Le[t].anim)!==!1&&Le.splice(t--,1);return this},i.on("raphael.remove",ln),i.on("raphael.clear",ln),Ne.toString=function(){return"Rapha\xEBl\u2019s object"};var cn,un,st,hn,Et=function(e){if(this.items=[],this.length=0,this.type="set",e)for(var t=0,a=e.length;t<a;t++)!e[t]||e[t].constructor!=Ne.constructor&&e[t].constructor!=Et||(this[this.items.length]=this.items[this.items.length]=e[t],this.length++)},Oe=Et.prototype;for(var Wt in Oe.push=function(){for(var e,t,a=0,l=arguments.length;a<l;a++)!(e=arguments[a])||e.constructor!=Ne.constructor&&e.constructor!=Et||(this[t=this.items.length]=this.items[t]=e,this.length++);return this},Oe.pop=function(){return this.length&&delete this[this.length--],this.items.pop()},Oe.forEach=function(e,t){for(var a=0,l=this.items.length;a<l;a++)if(e.call(t,this.items[a],a)===!1)return this;return this},Ne)Ne[B](Wt)&&(Oe[Wt]=function(e){return function(){var t=arguments;return this.forEach(function(a){a[e][U](a,t)})}}(Wt));return Oe.attr=function(e,t){if(e&&o.is(e,u)&&o.is(e[0],"object"))for(var a=0,l=e.length;a<l;a++)this.items[a].attr(e[a]);else for(var g=0,S=this.items.length;g<S;g++)this.items[g].attr(e,t);return this},Oe.clear=function(){for(;this.length;)this.pop()},Oe.splice=function(e,t,a){e=e<0?ge(this.length+e,0):e,t=ge(0,xe(this.length-e,t));var l,g=[],S=[],P=[];for(l=2;l<arguments.length;l++)P.push(arguments[l]);for(l=0;l<t;l++)S.push(this[e+l]);for(;l<this.length-e;l++)g.push(this[e+l]);var E=P.length;for(l=0;l<E+g.length;l++)this.items[e+l]=this[e+l]=l<E?P[l]:g[l-E];for(l=this.items.length=this.length-=t-E;this[l];)delete this[l++];return new Et(S)},Oe.exclude=function(e){for(var t=0,a=this.length;t<a;t++)if(this[t]==e)return this.splice(t,1),!0},Oe.animate=function(e,t,a,l){(o.is(a,"function")||!a)&&(l=a||null);var g,S,P=this.items.length,E=P,L=this;if(!P)return this;l&&(S=function(){!--P&&l.call(L)}),a=o.is(a,"string")?a:S;var H=o.animation(e,t,a,S);for(g=this.items[--E].animate(H);E--;)this.items[E]&&!this.items[E].removed&&this.items[E].animateWith(g,H,H),this.items[E]&&!this.items[E].removed||P--;return this},Oe.insertAfter=function(e){for(var t=this.items.length;t--;)this.items[t].insertAfter(e);return this},Oe.getBBox=function(){for(var e=[],t=[],a=[],l=[],g=this.items.length;g--;)if(!this.items[g].removed){var S=this.items[g].getBBox();e.push(S.x),t.push(S.y),a.push(S.x+S.width),l.push(S.y+S.height)}return{x:e=xe[U](0,e),y:t=xe[U](0,t),x2:a=ge[U](0,a),y2:l=ge[U](0,l),width:a-e,height:l-t}},Oe.clone=function(e){e=this.paper.set();for(var t=0,a=this.items.length;t<a;t++)e.push(this.items[t].clone());return e},Oe.toString=function(){return"Rapha\xEBl\u2018s set"},Oe.glow=function(e){var t=this.paper.set();return this.forEach(function(a,l){var g=a.glow(e);g!=null&&g.forEach(function(S,P){t.push(S)})}),t},Oe.isPointInside=function(e,t){var a=!1;return this.forEach(function(l){if(l.isPointInside(e,t))return a=!0,!1}),a},o.registerFont=function(e){if(!e.face)return e;this.fonts=this.fonts||{};var t={w:e.w,face:{},glyphs:{}},a=e.face["font-family"];for(var l in e.face)e.face[B](l)&&(t.face[l]=e.face[l]);if(this.fonts[a]?this.fonts[a].push(t):this.fonts[a]=[t],!e.svg){for(var g in t.face["units-per-em"]=v(e.face["units-per-em"],10),e.glyphs)if(e.glyphs[B](g)){var S=e.glyphs[g];if(t.glyphs[g]={w:S.w,k:{},d:S.d&&"M"+S.d.replace(/[mlcxtrv]/g,function(E){return{l:"L",c:"C",x:"z",t:"m",r:"l",v:"c"}[E]||"M"})+"z"},S.k)for(var P in S.k)S[B](P)&&(t.glyphs[g].k[P]=S.k[P])}}return e},w.getFont=function(e,t,a,l){if(l=l||"normal",a=a||"normal",t=+t||{normal:400,bold:700,lighter:300,bolder:800}[t]||400,o.fonts){var g,S=o.fonts[e];if(!S){var P=new RegExp("(^|\\s)"+e.replace(/[^\w\d\s+!~.:_-]/g,de)+"(\\s|$)","i");for(var E in o.fonts)if(o.fonts[B](E)&&P.test(E)){S=o.fonts[E];break}}if(S)for(var L=0,H=S.length;L<H&&((g=S[L]).face["font-weight"]!=t||g.face["font-style"]!=a&&g.face["font-style"]||g.face["font-stretch"]!=l);L++);return g}},w.print=function(e,t,a,l,g,S,P,E){S=S||"middle",P=ge(xe(P||0,1),-1),E=ge(xe(E||1,3),1);var L,H=$(a)[J](de),Z=0,le=0,te=de;if(o.is(l,"string")&&(l=this.getFont(l)),l){L=(g||16)/l.face["units-per-em"];for(var K=l.face.bbox[J](R),ne=+K[0],ce=K[3]-K[1],se=0,ee=+K[1]+(S=="baseline"?ce+ +l.face.descent:ce/2),Ce=0,ue=H.length;Ce<ue;Ce++){if(H[Ce]==`
`)Z=0,he=0,le=0,se+=ce*E;else{var me=le&&l.glyphs[H[Ce-1]]||{},he=l.glyphs[H[Ce]];Z+=le?(me.w||l.w)+(me.k&&me.k[H[Ce]]||0)+l.w*P:0,le=1}he&&he.d&&(te+=o.transformPath(he.d,["t",Z*L,se*L,"s",L,L,ne,ee,"t",(e-ne)/L,(t-ee)/L]))}}return this.path(te).attr({fill:"#000",stroke:"none"})},w.add=function(e){if(o.is(e,"array"))for(var t,a=this.set(),l=0,g=e.length;l<g;l++)t=e[l]||{},q[B](t.type)&&a.push(this[t.type]().attr(t));return a},o.format=function(e,t){var a=o.is(t,u)?[0][G](t):arguments;return e&&o.is(e,"string")&&a.length-1&&(e=e.replace(z,function(l,g){return a[++g]==null?de:a[g]})),e||de},o.fullfill=(cn=/\{([^\}]+)\}/g,un=/(?:(?:^|\.)(.+?)(?=\[|\.|$|\()|\[('|")(.+?)\2\])(\(\))?/g,function(e,t){return String(e).replace(cn,function(a,l){return function(g,S,P){var E=P;return S.replace(un,function(L,H,Z,le,te){H=H||le,E&&(H in E&&(E=E[H]),typeof E=="function"&&te&&(E=E()))}),E=(E==null||E==P?g:E)+""}(a,l,t)})}),o.ninja=function(){if(j.was)D.win.Raphael=j.is;else{window.Raphael=void 0;try{delete window.Raphael}catch{}}return o},o.st=Oe,i.on("raphael.DOMload",function(){x=!0}),(st=document).readyState==null&&st.addEventListener&&(st.addEventListener("DOMContentLoaded",hn=function(){st.removeEventListener("DOMContentLoaded",hn,!1),st.readyState="complete"},!1),st.readyState="loading"),function e(){/in/.test(st.readyState)?setTimeout(e,9):o.eve("raphael.DOMload")}(),o}.apply(O,b))===void 0||(N.exports=f)},function(N,O,C){var b,f;b=[C(0),C(3),C(4)],(f=function(i){return i}.apply(O,b))===void 0||(N.exports=f)},function(N,O,C){var b,f,i,o,x,w,R,q,z,B,D,j,Q,U;o="hasOwnProperty",x=/[\.\/]/,w=/\s*,\s*/,R=function(G,ie){return G-ie},q={n:{}},z=function(){for(var G=0,ie=this.length;G<ie;G++)if(this[G]!==void 0)return this[G]},B=function(){for(var G=this.length;--G;)if(this[G]!==void 0)return this[G]},D=Object.prototype.toString,j=String,Q=Array.isArray||function(G){return G instanceof Array||D.call(G)=="[object Array]"},(U=function(G,ie){var de,ve=i,$=Array.prototype.slice.call(arguments,2),J=U.listeners(G),X=0,I=[],ae={},re=[],ge=f;re.firstDefined=z,re.lastDefined=B,f=G,i=0;for(var xe=0,Y=J.length;xe<Y;xe++)"zIndex"in J[xe]&&(I.push(J[xe].zIndex),J[xe].zIndex<0&&(ae[J[xe].zIndex]=J[xe]));for(I.sort(R);I[X]<0;)if(de=ae[I[X++]],re.push(de.apply(ie,$)),i)return i=ve,re;for(xe=0;xe<Y;xe++)if("zIndex"in(de=J[xe]))if(de.zIndex==I[X]){if(re.push(de.apply(ie,$)),i)break;do if((de=ae[I[++X]])&&re.push(de.apply(ie,$)),i)break;while(de)}else ae[de.zIndex]=de;else if(re.push(de.apply(ie,$)),i)break;return i=ve,f=ge,re})._events=q,U.listeners=function(G){var ie,de,ve,$,J,X,I,ae,re=Q(G)?G:G.split(x),ge=q,xe=[ge],Y=[];for($=0,J=re.length;$<J;$++){for(ae=[],X=0,I=xe.length;X<I;X++)for(de=[(ge=xe[X].n)[re[$]],ge["*"]],ve=2;ve--;)(ie=de[ve])&&(ae.push(ie),Y=Y.concat(ie.f||[]));xe=ae}return Y},U.separator=function(G){G?(G="["+(G=j(G).replace(/(?=[\.\^\]\[\-])/g,"\\"))+"]",x=new RegExp(G)):x=/[\.\/]/},U.on=function(G,ie){if(typeof ie!="function")return function(){};for(var de=Q(G)?Q(G[0])?G:[G]:j(G).split(w),ve=0,$=de.length;ve<$;ve++)(function(J){for(var X,I=Q(J)?J:j(J).split(x),ae=q,re=0,ge=I.length;re<ge;re++)ae=(ae=ae.n).hasOwnProperty(I[re])&&ae[I[re]]||(ae[I[re]]={n:{}});for(ae.f=ae.f||[],re=0,ge=ae.f.length;re<ge;re++)if(ae.f[re]==ie){X=!0;break}!X&&ae.f.push(ie)})(de[ve]);return function(J){+J==+J&&(ie.zIndex=+J)}},U.f=function(G){var ie=[].slice.call(arguments,1);return function(){U.apply(null,[G,null].concat(ie).concat([].slice.call(arguments,0)))}},U.stop=function(){i=1},U.nt=function(G){var ie=Q(f)?f.join("."):f;return G?new RegExp("(?:\\.|\\/|^)"+G+"(?:\\.|\\/|$)").test(ie):ie},U.nts=function(){return Q(f)?f:f.split(x)},U.off=U.unbind=function(G,ie){if(G){var de=Q(G)?Q(G[0])?G:[G]:j(G).split(w);if(de.length>1)for(var ve=0,$=de.length;ve<$;ve++)U.off(de[ve],ie);else{de=Q(G)?G:j(G).split(x);var J,X,I,ae,re,ge=[q];for(ve=0,$=de.length;ve<$;ve++)for(ae=0;ae<ge.length;ae+=I.length-2){if(I=[ae,1],J=ge[ae].n,de[ve]!="*")J[de[ve]]&&I.push(J[de[ve]]);else for(X in J)J[o](X)&&I.push(J[X]);ge.splice.apply(ge,I)}for(ve=0,$=ge.length;ve<$;ve++)for(J=ge[ve];J.n;){if(ie){if(J.f){for(ae=0,re=J.f.length;ae<re;ae++)if(J.f[ae]==ie){J.f.splice(ae,1);break}!J.f.length&&delete J.f}for(X in J.n)if(J.n[o](X)&&J.n[X].f){var xe=J.n[X].f;for(ae=0,re=xe.length;ae<re;ae++)if(xe[ae]==ie){xe.splice(ae,1);break}!xe.length&&delete J.n[X].f}}else for(X in delete J.f,J.n)J.n[o](X)&&J.n[X].f&&delete J.n[X].f;J=J.n}}}else U._events=q={n:{}}},U.once=function(G,ie){var de=function(){return U.off(G,de),ie.apply(this,arguments)};return U.on(G,de)},U.version="0.5.0",U.toString=function(){return"You are running Eve 0.5.0"},N.exports?N.exports=U:(b=function(){return U}.apply(O,[]))===void 0||(N.exports=b)},function(N,O,C){var b,f;b=[C(0)],(f=function(i){if(!i||i.svg){var o="hasOwnProperty",x=String,w=parseFloat,R=parseInt,q=Math,z=q.max,B=q.abs,D=q.pow,j=/[, ]+/,Q=i.eve,U="",G=" ",ie="http://www.w3.org/1999/xlink",de={block:"M5,0 0,2.5 5,5z",classic:"M5,0 0,2.5 5,5 3.5,3 3.5,2z",diamond:"M2.5,0 5,2.5 2.5,5 0,2.5z",open:"M6,1 1,3.5 6,6",oval:"M2.5,0A2.5,2.5,0,0,1,2.5,5 2.5,2.5,0,0,1,2.5,0z"},ve={};i.toString=function(){return`Your browser supports SVG.
You are running Rapha\xEBl `+this.version};var $=function(n,r){if(r)for(var s in typeof n=="string"&&(n=$(n)),r)r[o](s)&&(s.substring(0,6)=="xlink:"?n.setAttributeNS(ie,s.substring(6),x(r[s])):n.setAttribute(s,x(r[s])));else(n=i._g.doc.createElementNS("http://www.w3.org/2000/svg",n)).style&&(n.style.webkitTapHighlightColor="rgba(0,0,0,0)");return n},J=function(n,r){var s="linear",h=n.id+r,m=.5,v=.5,A=n.node,M=n.paper,T=A.style,V=i._g.doc.getElementById(h);if(!V){if(r=(r=x(r).replace(i._radial_gradient,function(Ee,_e,ke){if(s="radial",_e&&ke){m=w(_e);var Be=2*((v=w(ke))>.5)-1;D(m-.5,2)+D(v-.5,2)>.25&&(v=q.sqrt(.25-D(m-.5,2))*Be+.5)&&v!=.5&&(v=v.toFixed(5)-1e-5*Be)}return U})).split(/\s*\-\s*/),s=="linear"){var W=r.shift();if(W=-w(W),isNaN(W))return null;var oe=[0,0,q.cos(i.rad(W)),q.sin(i.rad(W))],be=1/(z(B(oe[2]),B(oe[3]))||1);oe[2]*=be,oe[3]*=be,oe[2]<0&&(oe[0]=-oe[2],oe[2]=0),oe[3]<0&&(oe[1]=-oe[3],oe[3]=0)}var we=i._parseDots(r);if(!we)return null;if(h=h.replace(/[\(\)\s,\xb0#]/g,"_"),n.gradient&&h!=n.gradient.id&&(M.defs.removeChild(n.gradient),delete n.gradient),!n.gradient){V=$(s+"Gradient",{id:h}),n.gradient=V,$(V,s=="radial"?{fx:m,fy:v}:{x1:oe[0],y1:oe[1],x2:oe[2],y2:oe[3],gradientTransform:n.matrix.invert()}),M.defs.appendChild(V);for(var ye=0,Ae=we.length;ye<Ae;ye++)V.appendChild($("stop",{offset:we[ye].offset?we[ye].offset:ye?"100%":"0%","stop-color":we[ye].color||"#fff","stop-opacity":isFinite(we[ye].opacity)?we[ye].opacity:1}))}}return $(A,{fill:X(h),opacity:1,"fill-opacity":1}),T.fill=U,T.opacity=1,T.fillOpacity=1,1},X=function(n){if((r=document.documentMode)&&(r===9||r===10))return"url('#"+n+"')";var r,s=document.location;return"url('"+(s.protocol+"//"+s.host+s.pathname+s.search)+"#"+n+"')"},I=function(n){var r=n.getBBox(1);$(n.pattern,{patternTransform:n.matrix.invert()+" translate("+r.x+","+r.y+")"})},ae=function(n,r,s){if(n.type=="path"){for(var h,m,v,A,M,T=x(r).toLowerCase().split("-"),V=n.paper,W=s?"end":"start",oe=n.node,be=n.attrs,we=be["stroke-width"],ye=T.length,Ae="classic",Ee=3,_e=3,ke=5;ye--;)switch(T[ye]){case"block":case"classic":case"oval":case"diamond":case"open":case"none":Ae=T[ye];break;case"wide":_e=5;break;case"narrow":_e=2;break;case"long":Ee=5;break;case"short":Ee=2}if(Ae=="open"?(Ee+=2,_e+=2,ke+=2,v=1,A=s?4:1,M={fill:"none",stroke:be.stroke}):(A=v=Ee/2,M={fill:be.stroke,stroke:"none"}),n._.arrows?s?(n._.arrows.endPath&&ve[n._.arrows.endPath]--,n._.arrows.endMarker&&ve[n._.arrows.endMarker]--):(n._.arrows.startPath&&ve[n._.arrows.startPath]--,n._.arrows.startMarker&&ve[n._.arrows.startMarker]--):n._.arrows={},Ae!="none"){var Be="raphael-marker-"+Ae,Me="raphael-marker-"+W+Ae+Ee+_e+"-obj"+n.id;i._g.doc.getElementById(Be)?ve[Be]++:(V.defs.appendChild($($("path"),{"stroke-linecap":"round",d:de[Ae],id:Be})),ve[Be]=1);var De,Te=i._g.doc.getElementById(Me);Te?(ve[Me]++,De=Te.getElementsByTagName("use")[0]):(Te=$($("marker"),{id:Me,markerHeight:_e,markerWidth:Ee,orient:"auto",refX:A,refY:_e/2}),De=$($("use"),{"xlink:href":"#"+Be,transform:(s?"rotate(180 "+Ee/2+" "+_e/2+") ":U)+"scale("+Ee/ke+","+_e/ke+")","stroke-width":(1/((Ee/ke+_e/ke)/2)).toFixed(4)}),Te.appendChild(De),V.defs.appendChild(Te),ve[Me]=1),$(De,M);var Fe=v*(Ae!="diamond"&&Ae!="oval");s?(h=n._.arrows.startdx*we||0,m=i.getTotalLength(be.path)-Fe*we):(h=Fe*we,m=i.getTotalLength(be.path)-(n._.arrows.enddx*we||0)),(M={})["marker-"+W]="url(#"+Me+")",(m||h)&&(M.d=i.getSubpath(be.path,h,m)),$(oe,M),n._.arrows[W+"Path"]=Be,n._.arrows[W+"Marker"]=Me,n._.arrows[W+"dx"]=Fe,n._.arrows[W+"Type"]=Ae,n._.arrows[W+"String"]=r}else s?(h=n._.arrows.startdx*we||0,m=i.getTotalLength(be.path)-h):(h=0,m=i.getTotalLength(be.path)-(n._.arrows.enddx*we||0)),n._.arrows[W+"Path"]&&$(oe,{d:i.getSubpath(be.path,h,m)}),delete n._.arrows[W+"Path"],delete n._.arrows[W+"Marker"],delete n._.arrows[W+"dx"],delete n._.arrows[W+"Type"],delete n._.arrows[W+"String"];for(M in ve)if(ve[o](M)&&!ve[M]){var ze=i._g.doc.getElementById(M);ze&&ze.parentNode.removeChild(ze)}}},re={"-":[3,1],".":[1,1],"-.":[3,1,1,1],"-..":[3,1,1,1,1,1],". ":[1,3],"- ":[4,3],"--":[8,3],"- .":[4,3,1,3],"--.":[8,3,1,3],"--..":[8,3,1,3,1,3]},ge=function(n,r,s){if(r=re[x(r).toLowerCase()]){for(var h=n.attrs["stroke-width"]||"1",m={round:h,square:h,butt:0}[n.attrs["stroke-linecap"]||s["stroke-linecap"]]||0,v=[],A=r.length;A--;)v[A]=r[A]*h+(A%2?1:-1)*m;$(n.node,{"stroke-dasharray":v.join(",")})}else $(n.node,{"stroke-dasharray":"none"})},xe=function(n,r){var s=n.node,h=n.attrs,m=s.style.visibility;for(var v in s.style.visibility="hidden",r)if(r[o](v)){if(!i._availableAttrs[o](v))continue;var A=r[v];switch(h[v]=A,v){case"blur":n.blur(A);break;case"title":var M=s.getElementsByTagName("title");if(M.length&&(M=M[0]))M.firstChild.nodeValue=A;else{M=$("title");var T=i._g.doc.createTextNode(A);M.appendChild(T),s.appendChild(M)}break;case"href":case"target":var V=s.parentNode;if(V.tagName.toLowerCase()!="a"){var W=$("a");V.insertBefore(W,s),W.appendChild(s),V=W}v=="target"?V.setAttributeNS(ie,"show",A=="blank"?"new":A):V.setAttributeNS(ie,v,A);break;case"cursor":s.style.cursor=A;break;case"transform":n.transform(A);break;case"arrow-start":ae(n,A);break;case"arrow-end":ae(n,A,1);break;case"clip-rect":var oe=x(A).split(j);if(oe.length==4){n.clip&&n.clip.parentNode.parentNode.removeChild(n.clip.parentNode);var be=$("clipPath"),we=$("rect");be.id=i.createUUID(),$(we,{x:oe[0],y:oe[1],width:oe[2],height:oe[3]}),be.appendChild(we),n.paper.defs.appendChild(be),$(s,{"clip-path":"url(#"+be.id+")"}),n.clip=we}if(!A){var ye=s.getAttribute("clip-path");if(ye){var Ae=i._g.doc.getElementById(ye.replace(/(^url\(#|\)$)/g,U));Ae&&Ae.parentNode.removeChild(Ae),$(s,{"clip-path":U}),delete n.clip}}break;case"path":n.type=="path"&&($(s,{d:A?h.path=i._pathToAbsolute(A):"M0,0"}),n._.dirty=1,n._.arrows&&("startString"in n._.arrows&&ae(n,n._.arrows.startString),"endString"in n._.arrows&&ae(n,n._.arrows.endString,1)));break;case"width":if(s.setAttribute(v,A),n._.dirty=1,!h.fx)break;v="x",A=h.x;case"x":h.fx&&(A=-h.x-(h.width||0));case"rx":if(v=="rx"&&n.type=="rect")break;case"cx":s.setAttribute(v,A),n.pattern&&I(n),n._.dirty=1;break;case"height":if(s.setAttribute(v,A),n._.dirty=1,!h.fy)break;v="y",A=h.y;case"y":h.fy&&(A=-h.y-(h.height||0));case"ry":if(v=="ry"&&n.type=="rect")break;case"cy":s.setAttribute(v,A),n.pattern&&I(n),n._.dirty=1;break;case"r":n.type=="rect"?$(s,{rx:A,ry:A}):s.setAttribute(v,A),n._.dirty=1;break;case"src":n.type=="image"&&s.setAttributeNS(ie,"href",A);break;case"stroke-width":n._.sx==1&&n._.sy==1||(A/=z(B(n._.sx),B(n._.sy))||1),s.setAttribute(v,A),h["stroke-dasharray"]&&ge(n,h["stroke-dasharray"],r),n._.arrows&&("startString"in n._.arrows&&ae(n,n._.arrows.startString),"endString"in n._.arrows&&ae(n,n._.arrows.endString,1));break;case"stroke-dasharray":ge(n,A,r);break;case"fill":var Ee=x(A).match(i._ISURL);if(Ee){be=$("pattern");var _e=$("image");be.id=i.createUUID(),$(be,{x:0,y:0,patternUnits:"userSpaceOnUse",height:1,width:1}),$(_e,{x:0,y:0,"xlink:href":Ee[1]}),be.appendChild(_e),function(Te){i._preload(Ee[1],function(){var Fe=this.offsetWidth,ze=this.offsetHeight;$(Te,{width:Fe,height:ze}),$(_e,{width:Fe,height:ze})})}(be),n.paper.defs.appendChild(be),$(s,{fill:"url(#"+be.id+")"}),n.pattern=be,n.pattern&&I(n);break}var ke=i.getRGB(A);if(ke.error){if((n.type=="circle"||n.type=="ellipse"||x(A).charAt()!="r")&&J(n,A)){if("opacity"in h||"fill-opacity"in h){var Be=i._g.doc.getElementById(s.getAttribute("fill").replace(/^url\(#|\)$/g,U));if(Be){var Me=Be.getElementsByTagName("stop");$(Me[Me.length-1],{"stop-opacity":("opacity"in h?h.opacity:1)*("fill-opacity"in h?h["fill-opacity"]:1)})}}h.gradient=A,h.fill="none";break}}else delete r.gradient,delete h.gradient,!i.is(h.opacity,"undefined")&&i.is(r.opacity,"undefined")&&$(s,{opacity:h.opacity}),!i.is(h["fill-opacity"],"undefined")&&i.is(r["fill-opacity"],"undefined")&&$(s,{"fill-opacity":h["fill-opacity"]});ke[o]("opacity")&&$(s,{"fill-opacity":ke.opacity>1?ke.opacity/100:ke.opacity});case"stroke":ke=i.getRGB(A),s.setAttribute(v,ke.hex),v=="stroke"&&ke[o]("opacity")&&$(s,{"stroke-opacity":ke.opacity>1?ke.opacity/100:ke.opacity}),v=="stroke"&&n._.arrows&&("startString"in n._.arrows&&ae(n,n._.arrows.startString),"endString"in n._.arrows&&ae(n,n._.arrows.endString,1));break;case"gradient":(n.type=="circle"||n.type=="ellipse"||x(A).charAt()!="r")&&J(n,A);break;case"opacity":h.gradient&&!h[o]("stroke-opacity")&&$(s,{"stroke-opacity":A>1?A/100:A});case"fill-opacity":if(h.gradient){(Be=i._g.doc.getElementById(s.getAttribute("fill").replace(/^url\(#|\)$/g,U)))&&(Me=Be.getElementsByTagName("stop"),$(Me[Me.length-1],{"stop-opacity":A}));break}default:v=="font-size"&&(A=R(A,10)+"px");var De=v.replace(/(\-.)/g,function(Te){return Te.substring(1).toUpperCase()});s.style[De]=A,n._.dirty=1,s.setAttribute(v,A)}}Y(n,r),s.style.visibility=m},Y=function(n,r){if(n.type=="text"&&(r[o]("text")||r[o]("font")||r[o]("font-size")||r[o]("x")||r[o]("y"))){var s=n.attrs,h=n.node,m=h.firstChild?R(i._g.doc.defaultView.getComputedStyle(h.firstChild,U).getPropertyValue("font-size"),10):10;if(r[o]("text")){for(s.text=r.text;h.firstChild;)h.removeChild(h.firstChild);for(var v,A=x(r.text).split(`
`),M=[],T=0,V=A.length;T<V;T++)v=$("tspan"),T&&$(v,{dy:1.2*m,x:s.x}),v.appendChild(i._g.doc.createTextNode(A[T])),h.appendChild(v),M[T]=v}else for(T=0,V=(M=h.getElementsByTagName("tspan")).length;T<V;T++)T?$(M[T],{dy:1.2*m,x:s.x}):$(M[0],{dy:0});$(h,{x:s.x,y:s.y}),n._.dirty=1;var W=n._getBBox(),oe=s.y-(W.y+W.height/2);oe&&i.is(oe,"finite")&&$(M[0],{dy:oe})}},fe=function(n){return n.parentNode&&n.parentNode.tagName.toLowerCase()==="a"?n.parentNode:n},pe=function(n,r){this[0]=this.node=n,n.raphael=!0,this.id=("0000"+(Math.random()*Math.pow(36,5)<<0).toString(36)).slice(-5),n.raphaelid=this.id,this.matrix=i.matrix(),this.realPath=null,this.paper=r,this.attrs=this.attrs||{},this._={transform:[],sx:1,sy:1,deg:0,dx:0,dy:0,dirty:1},!r.bottom&&(r.bottom=this),this.prev=r.top,r.top&&(r.top.next=this),r.top=this,this.next=null},c=i.el;pe.prototype=c,c.constructor=pe,i._engine.path=function(n,r){var s=$("path");r.canvas&&r.canvas.appendChild(s);var h=new pe(s,r);return h.type="path",xe(h,{fill:"none",stroke:"#000",path:n}),h},c.rotate=function(n,r,s){if(this.removed)return this;if((n=x(n).split(j)).length-1&&(r=w(n[1]),s=w(n[2])),n=w(n[0]),s==null&&(r=s),r==null||s==null){var h=this.getBBox(1);r=h.x+h.width/2,s=h.y+h.height/2}return this.transform(this._.transform.concat([["r",n,r,s]])),this},c.scale=function(n,r,s,h){if(this.removed)return this;if((n=x(n).split(j)).length-1&&(r=w(n[1]),s=w(n[2]),h=w(n[3])),n=w(n[0]),r==null&&(r=n),h==null&&(s=h),s==null||h==null)var m=this.getBBox(1);return s=s==null?m.x+m.width/2:s,h=h==null?m.y+m.height/2:h,this.transform(this._.transform.concat([["s",n,r,s,h]])),this},c.translate=function(n,r){return this.removed?this:((n=x(n).split(j)).length-1&&(r=w(n[1])),n=w(n[0])||0,r=+r||0,this.transform(this._.transform.concat([["t",n,r]])),this)},c.transform=function(n){var r=this._;if(n==null)return r.transform;if(i._extractTransform(this,n),this.clip&&$(this.clip,{transform:this.matrix.invert()}),this.pattern&&I(this),this.node&&$(this.node,{transform:this.matrix}),r.sx!=1||r.sy!=1){var s=this.attrs[o]("stroke-width")?this.attrs["stroke-width"]:1;this.attr({"stroke-width":s})}return this},c.hide=function(){return this.removed||(this.node.style.display="none"),this},c.show=function(){return this.removed||(this.node.style.display=""),this},c.remove=function(){var n=fe(this.node);if(!this.removed&&n.parentNode){var r=this.paper;for(var s in r.__set__&&r.__set__.exclude(this),Q.unbind("raphael.*.*."+this.id),this.gradient&&r.defs.removeChild(this.gradient),i._tear(this,r),n.parentNode.removeChild(n),this.removeData(),this)this[s]=typeof this[s]=="function"?i._removedFactory(s):null;this.removed=!0}},c._getBBox=function(){if(this.node.style.display=="none"){this.show();var n=!0}var r,s=!1;this.paper.canvas.parentElement?r=this.paper.canvas.parentElement.style:this.paper.canvas.parentNode&&(r=this.paper.canvas.parentNode.style),r&&r.display=="none"&&(s=!0,r.display="");var h={};try{h=this.node.getBBox()}catch{h={x:this.node.clientLeft,y:this.node.clientTop,width:this.node.clientWidth,height:this.node.clientHeight}}finally{h=h||{},s&&(r.display="none")}return n&&this.hide(),h},c.attr=function(n,r){if(this.removed)return this;if(n==null){var s={};for(var h in this.attrs)this.attrs[o](h)&&(s[h]=this.attrs[h]);return s.gradient&&s.fill=="none"&&(s.fill=s.gradient)&&delete s.gradient,s.transform=this._.transform,s}if(r==null&&i.is(n,"string")){if(n=="fill"&&this.attrs.fill=="none"&&this.attrs.gradient)return this.attrs.gradient;if(n=="transform")return this._.transform;for(var m=n.split(j),v={},A=0,M=m.length;A<M;A++)(n=m[A])in this.attrs?v[n]=this.attrs[n]:i.is(this.paper.customAttributes[n],"function")?v[n]=this.paper.customAttributes[n].def:v[n]=i._availableAttrs[n];return M-1?v:v[m[0]]}if(r==null&&i.is(n,"array")){for(v={},A=0,M=n.length;A<M;A++)v[n[A]]=this.attr(n[A]);return v}if(r!=null){var T={};T[n]=r}else n!=null&&i.is(n,"object")&&(T=n);for(var V in T)Q("raphael.attr."+V+"."+this.id,this,T[V]);for(V in this.paper.customAttributes)if(this.paper.customAttributes[o](V)&&T[o](V)&&i.is(this.paper.customAttributes[V],"function")){var W=this.paper.customAttributes[V].apply(this,[].concat(T[V]));for(var oe in this.attrs[V]=T[V],W)W[o](oe)&&(T[oe]=W[oe])}return xe(this,T),this},c.toFront=function(){if(this.removed)return this;var n=fe(this.node);n.parentNode.appendChild(n);var r=this.paper;return r.top!=this&&i._tofront(this,r),this},c.toBack=function(){if(this.removed)return this;var n=fe(this.node),r=n.parentNode;return r.insertBefore(n,r.firstChild),i._toback(this,this.paper),this.paper,this},c.insertAfter=function(n){if(this.removed||!n)return this;var r=fe(this.node),s=fe(n.node||n[n.length-1].node);return s.nextSibling?s.parentNode.insertBefore(r,s.nextSibling):s.parentNode.appendChild(r),i._insertafter(this,n,this.paper),this},c.insertBefore=function(n){if(this.removed||!n)return this;var r=fe(this.node),s=fe(n.node||n[0].node);return s.parentNode.insertBefore(r,s),i._insertbefore(this,n,this.paper),this},c.blur=function(n){var r=this;if(+n!=0){var s=$("filter"),h=$("feGaussianBlur");r.attrs.blur=n,s.id=i.createUUID(),$(h,{stdDeviation:+n||1.5}),s.appendChild(h),r.paper.defs.appendChild(s),r._blur=s,$(r.node,{filter:"url(#"+s.id+")"})}else r._blur&&(r._blur.parentNode.removeChild(r._blur),delete r._blur,delete r.attrs.blur),r.node.removeAttribute("filter");return r},i._engine.circle=function(n,r,s,h){var m=$("circle");n.canvas&&n.canvas.appendChild(m);var v=new pe(m,n);return v.attrs={cx:r,cy:s,r:h,fill:"none",stroke:"#000"},v.type="circle",$(m,v.attrs),v},i._engine.rect=function(n,r,s,h,m,v){var A=$("rect");n.canvas&&n.canvas.appendChild(A);var M=new pe(A,n);return M.attrs={x:r,y:s,width:h,height:m,rx:v||0,ry:v||0,fill:"none",stroke:"#000"},M.type="rect",$(A,M.attrs),M},i._engine.ellipse=function(n,r,s,h,m){var v=$("ellipse");n.canvas&&n.canvas.appendChild(v);var A=new pe(v,n);return A.attrs={cx:r,cy:s,rx:h,ry:m,fill:"none",stroke:"#000"},A.type="ellipse",$(v,A.attrs),A},i._engine.image=function(n,r,s,h,m,v){var A=$("image");$(A,{x:s,y:h,width:m,height:v,preserveAspectRatio:"none"}),A.setAttributeNS(ie,"href",r),n.canvas&&n.canvas.appendChild(A);var M=new pe(A,n);return M.attrs={x:s,y:h,width:m,height:v,src:r},M.type="image",M},i._engine.text=function(n,r,s,h){var m=$("text");n.canvas&&n.canvas.appendChild(m);var v=new pe(m,n);return v.attrs={x:r,y:s,"text-anchor":"middle",text:h,"font-family":i._availableAttrs["font-family"],"font-size":i._availableAttrs["font-size"],stroke:"none",fill:"#000"},v.type="text",xe(v,v.attrs),v},i._engine.setSize=function(n,r){return this.width=n||this.width,this.height=r||this.height,this.canvas.setAttribute("width",this.width),this.canvas.setAttribute("height",this.height),this._viewBox&&this.setViewBox.apply(this,this._viewBox),this},i._engine.create=function(){var n=i._getContainer.apply(0,arguments),r=n&&n.container;if(!r)throw new Error("SVG container not found.");var s,h=n.x,m=n.y,v=n.width,A=n.height,M=$("svg"),T="overflow:hidden;";return h=h||0,m=m||0,$(M,{height:A=A||342,version:1.1,width:v=v||512,xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink"}),r==1?(M.style.cssText=T+"position:absolute;left:"+h+"px;top:"+m+"px",i._g.doc.body.appendChild(M),s=1):(M.style.cssText=T+"position:relative",r.firstChild?r.insertBefore(M,r.firstChild):r.appendChild(M)),(r=new i._Paper).width=v,r.height=A,r.canvas=M,r.clear(),r._left=r._top=0,s&&(r.renderfix=function(){}),r.renderfix(),r},i._engine.setViewBox=function(n,r,s,h,m){Q("raphael.setViewBox",this,this._viewBox,[n,r,s,h,m]);var v,A,M=this.getSize(),T=z(s/M.width,h/M.height),V=this.top,W=m?"xMidYMid meet":"xMinYMin";for(n==null?(this._vbSize&&(T=1),delete this._vbSize,v="0 0 "+this.width+G+this.height):(this._vbSize=T,v=n+G+r+G+s+G+h),$(this.canvas,{viewBox:v,preserveAspectRatio:W});T&&V;)A="stroke-width"in V.attrs?V.attrs["stroke-width"]:1,V.attr({"stroke-width":A}),V._.dirty=1,V._.dirtyT=1,V=V.prev;return this._viewBox=[n,r,s,h,!!m],this},i.prototype.renderfix=function(){var n,r=this.canvas,s=r.style;try{n=r.getScreenCTM()||r.createSVGMatrix()}catch{n=r.createSVGMatrix()}var h=-n.e%1,m=-n.f%1;(h||m)&&(h&&(this._left=(this._left+h)%1,s.left=this._left+"px"),m&&(this._top=(this._top+m)%1,s.top=this._top+"px"))},i.prototype.clear=function(){i.eve("raphael.clear",this);for(var n=this.canvas;n.firstChild;)n.removeChild(n.firstChild);this.bottom=this.top=null,(this.desc=$("desc")).appendChild(i._g.doc.createTextNode("Created with Rapha\xEBl "+i.version)),n.appendChild(this.desc),n.appendChild(this.defs=$("defs"))},i.prototype.remove=function(){for(var n in Q("raphael.remove",this),this.canvas.parentNode&&this.canvas.parentNode.removeChild(this.canvas),this)this[n]=typeof this[n]=="function"?i._removedFactory(n):null};var u=i.st;for(var p in c)c[o](p)&&!u[o](p)&&(u[p]=function(n){return function(){var r=arguments;return this.forEach(function(s){s[n].apply(s,r)})}}(p))}}.apply(O,b))===void 0||(N.exports=f)},function(N,O,C){var b,f;b=[C(0)],(f=function(i){if(!i||i.vml){var o="hasOwnProperty",x=String,w=parseFloat,R=Math,q=R.round,z=R.max,B=R.min,D=R.abs,j=/[, ]+/,Q=i.eve,U=" ",G="",ie={M:"m",L:"l",C:"c",Z:"x",m:"t",l:"r",c:"v",z:"x"},de=/([clmz]),?([^clmz]*)/gi,ve=/ progid:\S+Blur\([^\)]+\)/g,$=/-?[^,\s-]+/g,J="position:absolute;left:0;top:0;width:1px;height:1px;behavior:url(#default#VML)",X=21600,I={path:1,rect:1,image:1},ae={circle:1,ellipse:1},re=function(r,s,h){var m=i.matrix();return m.rotate(-r,.5,.5),{dx:m.x(s,h),dy:m.y(s,h)}},ge=function(r,s,h,m,v,A){var M=r._,T=r.matrix,V=M.fillpos,W=r.node,oe=W.style,be=1,we="",ye=X/s,Ae=X/h;if(oe.visibility="hidden",s&&h){if(W.coordsize=D(ye)+U+D(Ae),oe.rotation=A*(s*h<0?-1:1),A){var Ee=re(A,m,v);m=Ee.dx,v=Ee.dy}if(s<0&&(we+="x"),h<0&&(we+=" y")&&(be=-1),oe.flip=we,W.coordorigin=m*-ye+U+v*-Ae,V||M.fillsize){var _e=W.getElementsByTagName("fill");_e=_e&&_e[0],W.removeChild(_e),V&&(Ee=re(A,T.x(V[0],V[1]),T.y(V[0],V[1])),_e.position=Ee.dx*be+U+Ee.dy*be),M.fillsize&&(_e.size=M.fillsize[0]*D(s)+U+M.fillsize[1]*D(h)),W.appendChild(_e)}oe.visibility="visible"}};i.toString=function(){return`Your browser doesn\u2019t support SVG. Falling down to VML.
You are running Rapha\xEBl `+this.version};var xe,Y=function(r,s,h){for(var m=x(s).toLowerCase().split("-"),v=h?"end":"start",A=m.length,M="classic",T="medium",V="medium";A--;)switch(m[A]){case"block":case"classic":case"oval":case"diamond":case"open":case"none":M=m[A];break;case"wide":case"narrow":V=m[A];break;case"long":case"short":T=m[A]}var W=r.node.getElementsByTagName("stroke")[0];W[v+"arrow"]=M,W[v+"arrowlength"]=T,W[v+"arrowwidth"]=V},fe=function(r,s){r.attrs=r.attrs||{};var h=r.node,m=r.attrs,v=h.style,A=I[r.type]&&(s.x!=m.x||s.y!=m.y||s.width!=m.width||s.height!=m.height||s.cx!=m.cx||s.cy!=m.cy||s.rx!=m.rx||s.ry!=m.ry||s.r!=m.r),M=ae[r.type]&&(m.cx!=s.cx||m.cy!=s.cy||m.r!=s.r||m.rx!=s.rx||m.ry!=s.ry),T=r;for(var V in s)s[o](V)&&(m[V]=s[V]);if(A&&(m.path=i._getPath[r.type](r),r._.dirty=1),s.href&&(h.href=s.href),s.title&&(h.title=s.title),s.target&&(h.target=s.target),s.cursor&&(v.cursor=s.cursor),"blur"in s&&r.blur(s.blur),(s.path&&r.type=="path"||A)&&(h.path=function(qe){var Ke=/[ahqstv]/gi,ct=i._pathToAbsolute;if(x(qe).match(Ke)&&(ct=i._path2curve),Ke=/[clmz]/g,ct==i._pathToAbsolute&&!x(qe).match(Ke)){var Ue=x(qe).replace(de,function(Qt,dt,ft){var Ze=[],Tt=dt.toLowerCase()=="m",nt=ie[dt];return ft.replace($,function(Nt){Tt&&Ze.length==2&&(nt+=Ze+ie[dt=="m"?"l":"L"],Ze=[]),Ze.push(q(Nt*X))}),nt+Ze});return Ue}var ut,Ge,kt=ct(qe);Ue=[];for(var ht=0,_t=kt.length;ht<_t;ht++){ut=kt[ht],(Ge=kt[ht][0].toLowerCase())=="z"&&(Ge="x");for(var Qe=1,He=ut.length;Qe<He;Qe++)Ge+=q(ut[Qe]*X)+(Qe!=He-1?",":G);Ue.push(Ge)}return Ue.join(U)}(~x(m.path).toLowerCase().indexOf("r")?i._pathToAbsolute(m.path):m.path),r._.dirty=1,r.type=="image"&&(r._.fillpos=[m.x,m.y],r._.fillsize=[m.width,m.height],ge(r,1,1,0,0,0))),"transform"in s&&r.transform(s.transform),M){var W=+m.cx,oe=+m.cy,be=+m.rx||+m.r||0,we=+m.ry||+m.r||0;h.path=i.format("ar{0},{1},{2},{3},{4},{1},{4},{1}x",q((W-be)*X),q((oe-we)*X),q((W+be)*X),q((oe+we)*X),q(W*X)),r._.dirty=1}if("clip-rect"in s){var ye=x(s["clip-rect"]).split(j);if(ye.length==4){ye[2]=+ye[2]+ +ye[0],ye[3]=+ye[3]+ +ye[1];var Ae=h.clipRect||i._g.doc.createElement("div"),Ee=Ae.style;Ee.clip=i.format("rect({1}px {2}px {3}px {0}px)",ye),h.clipRect||(Ee.position="absolute",Ee.top=0,Ee.left=0,Ee.width=r.paper.width+"px",Ee.height=r.paper.height+"px",h.parentNode.insertBefore(Ae,h),Ae.appendChild(h),h.clipRect=Ae)}s["clip-rect"]||h.clipRect&&(h.clipRect.style.clip="auto")}if(r.textpath){var _e=r.textpath.style;s.font&&(_e.font=s.font),s["font-family"]&&(_e.fontFamily='"'+s["font-family"].split(",")[0].replace(/^['"]+|['"]+$/g,G)+'"'),s["font-size"]&&(_e.fontSize=s["font-size"]),s["font-weight"]&&(_e.fontWeight=s["font-weight"]),s["font-style"]&&(_e.fontStyle=s["font-style"])}if("arrow-start"in s&&Y(T,s["arrow-start"]),"arrow-end"in s&&Y(T,s["arrow-end"],1),s.opacity!=null||s.fill!=null||s.src!=null||s.stroke!=null||s["stroke-width"]!=null||s["stroke-opacity"]!=null||s["fill-opacity"]!=null||s["stroke-dasharray"]!=null||s["stroke-miterlimit"]!=null||s["stroke-linejoin"]!=null||s["stroke-linecap"]!=null){var ke=h.getElementsByTagName("fill");if(!(ke=ke&&ke[0])&&(ke=xe("fill")),r.type=="image"&&s.src&&(ke.src=s.src),s.fill&&(ke.on=!0),ke.on!=null&&s.fill!="none"&&s.fill!==null||(ke.on=!1),ke.on&&s.fill){var Be=x(s.fill).match(i._ISURL);if(Be){ke.parentNode==h&&h.removeChild(ke),ke.rotate=!0,ke.src=Be[1],ke.type="tile";var Me=r.getBBox(1);ke.position=Me.x+U+Me.y,r._.fillpos=[Me.x,Me.y],i._preload(Be[1],function(){r._.fillsize=[this.offsetWidth,this.offsetHeight]})}else ke.color=i.getRGB(s.fill).hex,ke.src=G,ke.type="solid",i.getRGB(s.fill).error&&(T.type in{circle:1,ellipse:1}||x(s.fill).charAt()!="r")&&pe(T,s.fill,ke)&&(m.fill="none",m.gradient=s.fill,ke.rotate=!1)}if("fill-opacity"in s||"opacity"in s){var De=((+m["fill-opacity"]+1||2)-1)*((+m.opacity+1||2)-1)*((+i.getRGB(s.fill).o+1||2)-1);De=B(z(De,0),1),ke.opacity=De,ke.src&&(ke.color="none")}h.appendChild(ke);var Te=h.getElementsByTagName("stroke")&&h.getElementsByTagName("stroke")[0],Fe=!1;!Te&&(Fe=Te=xe("stroke")),(s.stroke&&s.stroke!="none"||s["stroke-width"]||s["stroke-opacity"]!=null||s["stroke-dasharray"]||s["stroke-miterlimit"]||s["stroke-linejoin"]||s["stroke-linecap"])&&(Te.on=!0),(s.stroke=="none"||s.stroke===null||Te.on==null||s.stroke==0||s["stroke-width"]==0)&&(Te.on=!1);var ze=i.getRGB(s.stroke);Te.on&&s.stroke&&(Te.color=ze.hex),De=((+m["stroke-opacity"]+1||2)-1)*((+m.opacity+1||2)-1)*((+ze.o+1||2)-1);var Ye=.75*(w(s["stroke-width"])||1);if(De=B(z(De,0),1),s["stroke-width"]==null&&(Ye=m["stroke-width"]),s["stroke-width"]&&(Te.weight=Ye),Ye&&Ye<1&&(De*=Ye)&&(Te.weight=1),Te.opacity=De,s["stroke-linejoin"]&&(Te.joinstyle=s["stroke-linejoin"]||"miter"),Te.miterlimit=s["stroke-miterlimit"]||8,s["stroke-linecap"]&&(Te.endcap=s["stroke-linecap"]=="butt"?"flat":s["stroke-linecap"]=="square"?"square":"round"),"stroke-dasharray"in s){var wt={"-":"shortdash",".":"shortdot","-.":"shortdashdot","-..":"shortdashdotdot",". ":"dot","- ":"dash","--":"longdash","- .":"dashdot","--.":"longdashdot","--..":"longdashdotdot"};Te.dashstyle=wt[o](s["stroke-dasharray"])?wt[s["stroke-dasharray"]]:G}Fe&&h.appendChild(Te)}if(T.type=="text"){T.paper.canvas.style.display=G;var Je=T.paper.span,at=m.font&&m.font.match(/\d+(?:\.\d*)?(?=px)/);v=Je.style,m.font&&(v.font=m.font),m["font-family"]&&(v.fontFamily=m["font-family"]),m["font-weight"]&&(v.fontWeight=m["font-weight"]),m["font-style"]&&(v.fontStyle=m["font-style"]),at=w(m["font-size"]||at&&at[0])||10,v.fontSize=100*at+"px",T.textpath.string&&(Je.innerHTML=x(T.textpath.string).replace(/</g,"&#60;").replace(/&/g,"&#38;").replace(/\n/g,"<br>"));var ot=Je.getBoundingClientRect();T.W=m.w=(ot.right-ot.left)/100,T.H=m.h=(ot.bottom-ot.top)/100,T.X=m.x,T.Y=m.y+T.H/2,("x"in s||"y"in s)&&(T.path.v=i.format("m{0},{1}l{2},{1}",q(m.x*X),q(m.y*X),q(m.x*X)+1));for(var Ct=["x","y","text","font","font-family","font-weight","font-style","font-size"],lt=0,Bt=Ct.length;lt<Bt;lt++)if(Ct[lt]in s){T._.dirty=1;break}switch(m["text-anchor"]){case"start":T.textpath.style["v-text-align"]="left",T.bbx=T.W/2;break;case"end":T.textpath.style["v-text-align"]="right",T.bbx=-T.W/2;break;default:T.textpath.style["v-text-align"]="center",T.bbx=0}T.textpath.style["v-text-kern"]=!0}},pe=function(r,s,h){r.attrs=r.attrs||{},r.attrs;var m=Math.pow,v="linear",A=".5 .5";if(r.attrs.gradient=s,s=(s=x(s).replace(i._radial_gradient,function(be,we,ye){return v="radial",we&&ye&&(we=w(we),ye=w(ye),m(we-.5,2)+m(ye-.5,2)>.25&&(ye=R.sqrt(.25-m(we-.5,2))*(2*(ye>.5)-1)+.5),A=we+U+ye),G})).split(/\s*\-\s*/),v=="linear"){var M=s.shift();if(M=-w(M),isNaN(M))return null}var T=i._parseDots(s);if(!T)return null;if(r=r.shape||r.node,T.length){r.removeChild(h),h.on=!0,h.method="none",h.color=T[0].color,h.color2=T[T.length-1].color;for(var V=[],W=0,oe=T.length;W<oe;W++)T[W].offset&&V.push(T[W].offset+U+T[W].color);h.colors=V.length?V.join():"0% "+h.color,v=="radial"?(h.type="gradientTitle",h.focus="100%",h.focussize="0 0",h.focusposition=A,h.angle=0):(h.type="gradient",h.angle=(270-M)%360),r.appendChild(h)}return 1},c=function(r,s){this[0]=this.node=r,r.raphael=!0,this.id=i._oid++,r.raphaelid=this.id,this.X=0,this.Y=0,this.attrs={},this.paper=s,this.matrix=i.matrix(),this._={transform:[],sx:1,sy:1,dx:0,dy:0,deg:0,dirty:1,dirtyT:1},!s.bottom&&(s.bottom=this),this.prev=s.top,s.top&&(s.top.next=this),s.top=this,this.next=null},u=i.el;c.prototype=u,u.constructor=c,u.transform=function(r){if(r==null)return this._.transform;var s,h=this.paper._viewBoxShift,m=h?"s"+[h.scale,h.scale]+"-1-1t"+[h.dx,h.dy]:G;h&&(s=r=x(r).replace(/\.{3}|\u2026/g,this._.transform||G)),i._extractTransform(this,m+r);var v,A=this.matrix.clone(),M=this.skew,T=this.node,V=~x(this.attrs.fill).indexOf("-"),W=!x(this.attrs.fill).indexOf("url(");if(A.translate(1,1),W||V||this.type=="image")if(M.matrix="1 0 0 1",M.offset="0 0",v=A.split(),V&&v.noRotation||!v.isSimple){T.style.filter=A.toFilter();var oe=this.getBBox(),be=this.getBBox(1),we=oe.x-be.x,ye=oe.y-be.y;T.coordorigin=we*-X+U+ye*-X,ge(this,1,1,we,ye,0)}else T.style.filter=G,ge(this,v.scalex,v.scaley,v.dx,v.dy,v.rotate);else T.style.filter=G,M.matrix=x(A),M.offset=A.offset();return s!==null&&(this._.transform=s,i._extractTransform(this,s)),this},u.rotate=function(r,s,h){if(this.removed)return this;if(r!=null){if((r=x(r).split(j)).length-1&&(s=w(r[1]),h=w(r[2])),r=w(r[0]),h==null&&(s=h),s==null||h==null){var m=this.getBBox(1);s=m.x+m.width/2,h=m.y+m.height/2}return this._.dirtyT=1,this.transform(this._.transform.concat([["r",r,s,h]])),this}},u.translate=function(r,s){return this.removed?this:((r=x(r).split(j)).length-1&&(s=w(r[1])),r=w(r[0])||0,s=+s||0,this._.bbox&&(this._.bbox.x+=r,this._.bbox.y+=s),this.transform(this._.transform.concat([["t",r,s]])),this)},u.scale=function(r,s,h,m){if(this.removed)return this;if((r=x(r).split(j)).length-1&&(s=w(r[1]),h=w(r[2]),m=w(r[3]),isNaN(h)&&(h=null),isNaN(m)&&(m=null)),r=w(r[0]),s==null&&(s=r),m==null&&(h=m),h==null||m==null)var v=this.getBBox(1);return h=h==null?v.x+v.width/2:h,m=m==null?v.y+v.height/2:m,this.transform(this._.transform.concat([["s",r,s,h,m]])),this._.dirtyT=1,this},u.hide=function(){return!this.removed&&(this.node.style.display="none"),this},u.show=function(){return!this.removed&&(this.node.style.display=G),this},u.auxGetBBox=i.el.getBBox,u.getBBox=function(){var r=this.auxGetBBox();if(this.paper&&this.paper._viewBoxShift){var s={},h=1/this.paper._viewBoxShift.scale;return s.x=r.x-this.paper._viewBoxShift.dx,s.x*=h,s.y=r.y-this.paper._viewBoxShift.dy,s.y*=h,s.width=r.width*h,s.height=r.height*h,s.x2=s.x+s.width,s.y2=s.y+s.height,s}return r},u._getBBox=function(){return this.removed?{}:{x:this.X+(this.bbx||0)-this.W/2,y:this.Y-this.H,width:this.W,height:this.H}},u.remove=function(){if(!this.removed&&this.node.parentNode){for(var r in this.paper.__set__&&this.paper.__set__.exclude(this),i.eve.unbind("raphael.*.*."+this.id),i._tear(this,this.paper),this.node.parentNode.removeChild(this.node),this.shape&&this.shape.parentNode.removeChild(this.shape),this)this[r]=typeof this[r]=="function"?i._removedFactory(r):null;this.removed=!0}},u.attr=function(r,s){if(this.removed)return this;if(r==null){var h={};for(var m in this.attrs)this.attrs[o](m)&&(h[m]=this.attrs[m]);return h.gradient&&h.fill=="none"&&(h.fill=h.gradient)&&delete h.gradient,h.transform=this._.transform,h}if(s==null&&i.is(r,"string")){if(r=="fill"&&this.attrs.fill=="none"&&this.attrs.gradient)return this.attrs.gradient;for(var v=r.split(j),A={},M=0,T=v.length;M<T;M++)(r=v[M])in this.attrs?A[r]=this.attrs[r]:i.is(this.paper.customAttributes[r],"function")?A[r]=this.paper.customAttributes[r].def:A[r]=i._availableAttrs[r];return T-1?A:A[v[0]]}if(this.attrs&&s==null&&i.is(r,"array")){for(A={},M=0,T=r.length;M<T;M++)A[r[M]]=this.attr(r[M]);return A}var V;for(var W in s!=null&&((V={})[r]=s),s==null&&i.is(r,"object")&&(V=r),V)Q("raphael.attr."+W+"."+this.id,this,V[W]);if(V){for(W in this.paper.customAttributes)if(this.paper.customAttributes[o](W)&&V[o](W)&&i.is(this.paper.customAttributes[W],"function")){var oe=this.paper.customAttributes[W].apply(this,[].concat(V[W]));for(var be in this.attrs[W]=V[W],oe)oe[o](be)&&(V[be]=oe[be])}V.text&&this.type=="text"&&(this.textpath.string=V.text),fe(this,V)}return this},u.toFront=function(){return!this.removed&&this.node.parentNode.appendChild(this.node),this.paper&&this.paper.top!=this&&i._tofront(this,this.paper),this},u.toBack=function(){return this.removed?this:(this.node.parentNode.firstChild!=this.node&&(this.node.parentNode.insertBefore(this.node,this.node.parentNode.firstChild),i._toback(this,this.paper)),this)},u.insertAfter=function(r){return this.removed?this:(r.constructor==i.st.constructor&&(r=r[r.length-1]),r.node.nextSibling?r.node.parentNode.insertBefore(this.node,r.node.nextSibling):r.node.parentNode.appendChild(this.node),i._insertafter(this,r,this.paper),this)},u.insertBefore=function(r){return this.removed?this:(r.constructor==i.st.constructor&&(r=r[0]),r.node.parentNode.insertBefore(this.node,r.node),i._insertbefore(this,r,this.paper),this)},u.blur=function(r){var s=this.node.runtimeStyle,h=s.filter;return h=h.replace(ve,G),+r!=0?(this.attrs.blur=r,s.filter=h+U+" progid:DXImageTransform.Microsoft.Blur(pixelradius="+(+r||1.5)+")",s.margin=i.format("-{0}px 0 0 -{0}px",q(+r||1.5))):(s.filter=h,s.margin=0,delete this.attrs.blur),this},i._engine.path=function(r,s){var h=xe("shape");h.style.cssText=J,h.coordsize=X+U+X,h.coordorigin=s.coordorigin;var m=new c(h,s),v={fill:"none",stroke:"#000"};r&&(v.path=r),m.type="path",m.path=[],m.Path=G,fe(m,v),s.canvas&&s.canvas.appendChild(h);var A=xe("skew");return A.on=!0,h.appendChild(A),m.skew=A,m.transform(G),m},i._engine.rect=function(r,s,h,m,v,A){var M=i._rectPath(s,h,m,v,A),T=r.path(M),V=T.attrs;return T.X=V.x=s,T.Y=V.y=h,T.W=V.width=m,T.H=V.height=v,V.r=A,V.path=M,T.type="rect",T},i._engine.ellipse=function(r,s,h,m,v){var A=r.path();return A.attrs,A.X=s-m,A.Y=h-v,A.W=2*m,A.H=2*v,A.type="ellipse",fe(A,{cx:s,cy:h,rx:m,ry:v}),A},i._engine.circle=function(r,s,h,m){var v=r.path();return v.attrs,v.X=s-m,v.Y=h-m,v.W=v.H=2*m,v.type="circle",fe(v,{cx:s,cy:h,r:m}),v},i._engine.image=function(r,s,h,m,v,A){var M=i._rectPath(h,m,v,A),T=r.path(M).attr({stroke:"none"}),V=T.attrs,W=T.node,oe=W.getElementsByTagName("fill")[0];return V.src=s,T.X=V.x=h,T.Y=V.y=m,T.W=V.width=v,T.H=V.height=A,V.path=M,T.type="image",oe.parentNode==W&&W.removeChild(oe),oe.rotate=!0,oe.src=s,oe.type="tile",T._.fillpos=[h,m],T._.fillsize=[v,A],W.appendChild(oe),ge(T,1,1,0,0,0),T},i._engine.text=function(r,s,h,m){var v=xe("shape"),A=xe("path"),M=xe("textpath");s=s||0,h=h||0,m=m||"",A.v=i.format("m{0},{1}l{2},{1}",q(s*X),q(h*X),q(s*X)+1),A.textpathok=!0,M.string=x(m),M.on=!0,v.style.cssText=J,v.coordsize=X+U+X,v.coordorigin="0 0";var T=new c(v,r),V={fill:"#000",stroke:"none",font:i._availableAttrs.font,text:m};T.shape=v,T.path=A,T.textpath=M,T.type="text",T.attrs.text=x(m),T.attrs.x=s,T.attrs.y=h,T.attrs.w=1,T.attrs.h=1,fe(T,V),v.appendChild(M),v.appendChild(A),r.canvas.appendChild(v);var W=xe("skew");return W.on=!0,v.appendChild(W),T.skew=W,T.transform(G),T},i._engine.setSize=function(r,s){var h=this.canvas.style;return this.width=r,this.height=s,r==+r&&(r+="px"),s==+s&&(s+="px"),h.width=r,h.height=s,h.clip="rect(0 "+r+" "+s+" 0)",this._viewBox&&i._engine.setViewBox.apply(this,this._viewBox),this},i._engine.setViewBox=function(r,s,h,m,v){i.eve("raphael.setViewBox",this,this._viewBox,[r,s,h,m,v]);var A,M,T=this.getSize(),V=T.width,W=T.height;return v&&(h*(A=W/m)<V&&(r-=(V-h*A)/2/A),m*(M=V/h)<W&&(s-=(W-m*M)/2/M)),this._viewBox=[r,s,h,m,!!v],this._viewBoxShift={dx:-r,dy:-s,scale:T},this.forEach(function(oe){oe.transform("...")}),this},i._engine.initWin=function(r){var s=r.document;s.styleSheets.length<31?s.createStyleSheet().addRule(".rvml","behavior:url(#default#VML)"):s.styleSheets[0].addRule(".rvml","behavior:url(#default#VML)");try{!s.namespaces.rvml&&s.namespaces.add("rvml","urn:schemas-microsoft-com:vml"),xe=function(h){return s.createElement("<rvml:"+h+' class="rvml">')}}catch{xe=function(m){return s.createElement("<"+m+' xmlns="urn:schemas-microsoft.com:vml" class="rvml">')}}},i._engine.initWin(i._g.win),i._engine.create=function(){var r=i._getContainer.apply(0,arguments),s=r.container,h=r.height,m=r.width,v=r.x,A=r.y;if(!s)throw new Error("VML container not found.");var M=new i._Paper,T=M.canvas=i._g.doc.createElement("div"),V=T.style;return v=v||0,A=A||0,m=m||512,h=h||342,M.width=m,M.height=h,m==+m&&(m+="px"),h==+h&&(h+="px"),M.coordsize=216e5+U+216e5,M.coordorigin="0 0",M.span=i._g.doc.createElement("span"),M.span.style.cssText="position:absolute;left:-9999em;top:-9999em;padding:0;margin:0;line-height:1;",T.appendChild(M.span),V.cssText=i.format("top:0;left:0;width:{0};height:{1};display:inline-block;position:relative;clip:rect(0 {0} {1} 0);overflow:hidden",m,h),s==1?(i._g.doc.body.appendChild(T),V.left=v+"px",V.top=A+"px",V.position="absolute"):s.firstChild?s.insertBefore(T,s.firstChild):s.appendChild(T),M.renderfix=function(){},M},i.prototype.clear=function(){i.eve("raphael.clear",this),this.canvas.innerHTML=G,this.span=i._g.doc.createElement("span"),this.span.style.cssText="position:absolute;left:-9999em;top:-9999em;padding:0;margin:0;line-height:1;display:inline;",this.canvas.appendChild(this.span),this.bottom=this.top=null},i.prototype.remove=function(){for(var r in i.eve("raphael.remove",this),this.canvas.parentNode.removeChild(this.canvas),this)this[r]=typeof this[r]=="function"?i._removedFactory(r):null;return!0};var p=i.st;for(var n in u)u[o](n)&&!p[o](n)&&(p[n]=function(r){return function(){var s=arguments;return this.forEach(function(h){h[r].apply(h,s)})}}(n))}}.apply(O,b))===void 0||(N.exports=f)}])})})(kn);const qt=Mn(kn.exports);var F={};F.Common={nodeIdIncrement:0,activeNode:0,roundFloat:function(d,k){for(var N=0,O=1;N<k;)O*=10,N++;return Math.round(d*O)/O},apply:function(d,k){if(d&&typeof k=="object")for(var N in k)d[N]=k[N];return d},addRaphEventHandler:function(d,k,N,O){try{d[k](function(C,b){return function(f,i){var o=b;o.e=f,C(o)}}(N,O))}catch{}},isInteger:function(d){return!isNaN(parseInt(d))},isXMLSerializerAvailable:function(){return typeof XMLSerializer=="function"},createSvgEl:function(d,k){if(d=document.createElementNS("http://www.w3.org/2000/svg",d),k)for(var N in k)k.hasOwnProperty(N)&&d.setAttribute(N,String(k[N]));return d},createGradientEl:function(d,k,N){if(k.type!="radialGradient")return!1;var O=F.Common.createSvgEl("radialGradient",{id:d,gradientUnits:"userSpaceOnUse",cx:N[0],cy:N[1],r:N[2],fx:N[0],fy:N[1]});if(k.stop)for(var C=k.stop,b=0;b<C.length;b++){var f=C[b];f["@attributes"]?O.appendChild(F.Common.createSvgEl("stop",f["@attributes"])):(f._attributes&&delete f._attributes,f._children&&delete f._children,f.__proto__&&delete f.__proto__,O.appendChild(F.Common.createSvgEl("stop",f)))}return O},setCssStyle:function(d,k){var N=document.styleSheets[0];N.addRule?N.addRule(d,k):N.insertRule&&N.insertRule(d+" { "+k+" }",N.cssRules.length)}};F.PhyloCanvas=function(){var d,k,N,O,C;return function(b,f,i,o,x){if(this.getNewickObject=function(){return N},this.clear=function(){},this.scale=function(R){O.svg.scale(R)},this.getSvg=function(){return O},this.getPhylogram=function(){return d},this.getSvgSource=function(){if(qt.svg&&F.Common.isXMLSerializerAvailable()){var R=new XMLSerializer;return R.serializeToString(O.svg.canvas)}else return!1},typeof b=="object")if(b.xml){if(b.fileSource)var w=b.xml;else var w=yt.textToXML(b.xml);w=yt.xmlToJSON(w),C=new F.PhyloCanvas.PhyloxmlParse(w)}else if(b.phyloxml){if(b.fileSource)var w=b.phyloxml;else var w=yt.textToXML(b.phyloxml);w=yt.xmlToJSON(w),C=new F.PhyloCanvas.PhyloxmlParse(w)}else if(b.nexml){if(b.fileSource)var w=b.nexml;else var w=yt.textToXML(b.nexml);w=yt.xmlToJSON(w),C=new F.PhyloCanvas.NexmlParse(w,b)}else b.json?C=new F.PhyloCanvas.PhyloxmlParse(b.json):b.newick?C=new F.PhyloCanvas.NewickParse(b.newick):b.nexmlJson?C=new F.PhyloCanvas.NexmlJsonParse(b):alert("Please set the format of input data");else C=new F.PhyloCanvas.NewickParse(b);k=f,O=new F.PhyloCanvas.Render.SVG(k,i,o),x=="circular"?d=new F.PhyloCanvas.Render.CircularPhylogram(O,C):d=new F.PhyloCanvas.Render.Phylogram(O,C)}}();F.PhyloCanvas.prototype={};F.PhyloCanvas.Node=function(){return function(d,k){this.id=F.Common.nodeIdIncrement+=1,this.level=0,this.len=0,this.newickLen=0,this.name="",this.type="",this.chart={},this.img=[],d&&F.Common.apply(this,d),this._countAllChildren=!1,this._countImmediateChildren=!1,this._midBranchPosition=!1,this.children=new Array,k&&k.children.push(this)}}();F.PhyloCanvas.Node.prototype={getCountAllChildren:function(){if(this._countAllChildren!==!1)return this._countAllChildren;var d=0;for(var k in this.children)if(F.Common.isInteger(k)){var N=this.children[k];N.children&&N.children.length>0?d+=N.getCountAllChildren():d++}return this._countAllChildren=d,d},getCountImmediateChildren:function(){if(this._countImmediateChildren!==!1)return this._countImmediateChildren;var d=0;for(var k in this.children){var N=this.children[k];d+=N.length}return this._countImmediateChildren=d,d},getMidbranchPosition:function(d){if(this._midBranchPosition!==!1)return this._midBranchPosition;for(var k=[0,0],N=0;N<this.children.length;N++){var O=this.children[N];O.children&&O.children.length>0?N==0&&d?(k[0]=O.getMidbranchPosition(!0),k[1]+=O.getCountAllChildren()-1):N==0?(k[0]=O.getMidbranchPosition(),k[1]+=O.getCountAllChildren()):N==this.children.length-1?k[1]+=O.getMidbranchPosition():k[1]+=O.getCountAllChildren():N==0&&d?k[0]=0:N==0?(k[0]=1,k[1]+=1):(N==this.children.length-1,k[1]+=1)}return this._midBranchPosition=k[1]>=k[0]?(k[1]+k[0])/2:k[0],this._midBranchPosition}};F.PhyloCanvas.NewickParse=function(){var d,k,N,O=0,C=0,b,f,i=function(z){for(var B=new F.PhyloCanvas.Node;k!==")"&&k!==",";)k===":"?(R(),B.len=F.Common.roundFloat(x(),4),B.len==0&&(B.len=1e-4)):k==="'"||k==='"'?(B.type="label",B.name=w(k)):(B.type="label",B.name=x());return B.level=z.level+1,B},o=function(z){var B=new F.PhyloCanvas.Node;for(z&&(B.level=z.level+1);k!==")";)R(),k==="("?B.children.push(o(B)):B.children.push(i(B));return R(),k!==":"&&k!==")"&&k!==","&&k!==";"&&(B.type="label",B.name=x()),k===":"&&(R(),B.len=F.Common.roundFloat(x(),4),B.len==0&&(B.len=1e-4),B.type="stem"),B},x=function(){for(var z="";k!==":"&&k!==")"&&k!==","&&k!==";";)z+=k,R();return z},w=function(z){for(var B="";k!==z;)B+=k,R();return B},R=function(){return k=d.charAt(N),N+=1,k},q=function(z,B){if(z.children&&z.children.length)for(var D=0;D<z.children.length;D++){var j=z.children[D];j.len===0&&(j.len=1),j.newickLen=F.Common.roundFloat(j.len+z.newickLen,4),j.level>O&&(O=j.level),j.newickLen>C&&(C=j.newickLen),j.children.length>0&&q(j)}return z};return function(z){this.getRoot=function(){return b},this.getLevels=function(){return O},this.getNewickLen=function(){return C},this.getValidate=function(){return f},O=0,C=0,d=z,N=0,R(),b=o(),b=q(b)}}();F.PhyloCanvas.NewickParse.prototype={};F.PhyloCanvas.PhyloxmlParse=function(){var d=0,k=0,N,O,C=function(i,o){var x=new F.PhyloCanvas.Node;if(o&&(x.level=o.level+1),i.clade&&i.clade.length)for(var w=0;w<i.clade.length;w++){var R=i.clade[w];x.children.push(C(R,x))}if(i.branch_length&&(typeof i.branch_length=="object"&&(i.branch_length=i.branch_length[0].Text),x.len=F.Common.roundFloat(i.branch_length,4),x.len==0&&(x.len=1e-4)),i.color?(x.red=i.color[0].red[0].Text,x.green=i.color[0].green[0].Text,x.blue=i.color[0].blue[0].Text):(x.red=0,x.green=0,x.blue=0),i.property&&i.property[0].applies_to=="node"&&i.property[0].ref=="style:font_color"&&(x.font_color_hex=i.property[0].Text),i.name?(x.type="label",x.name=i.name[0].Text,i.name[0]&&i.name[0].style&&(x.style=i.name[0].style),i.name[0]&&i.name[0].bgStyle&&(x.bgStyle=i.name[0].bgStyle)):i.confidence&&(x.name=i.confidence[0].Text),i.sequence&&i.sequence[0]&&i.sequence[0].name&&i.sequence[0].name[0]&&i.sequence[0].name[0].Text&&(x.sequenceName=i.sequence[0].name[0].Text),i.taxonomy&&i.taxonomy[0]&&(i.taxonomy[0].scientific_name&&i.taxonomy[0].scientific_name[0]&&i.taxonomy[0].scientific_name[0].Text&&(x.taxonomyScientificName=i.taxonomy[0].scientific_name[0].Text),i.taxonomy[0].common_name&&i.taxonomy[0].common_name[0]&&i.taxonomy[0].common_name[0].Text&&(x.taxonomyCommonName=i.taxonomy[0].common_name[0].Text)),i.sequence&&i.sequence[0]&&i.sequence[0].accession&&i.sequence[0].accession[0]&&i.sequence[0].accession[0].Text&&(x.sequenceAccession=i.sequence[0].accession[0].Text),i.point&&(x.LatLong=[i.point[0].lat[0].Text,i.point[0].long[0].Text]),x.name||(x.sequenceName?x.name=x.sequenceName:x.taxonomyScientificName?x.name=x.taxonomyScientificName:x.taxonomyCommonName?x.name=x.taxonomyCommonName:x.sequenceAccession&&(x.name=x.sequenceAccession),x.name&&(x.type="label")),i.annotation&&(i.annotation[0]&&i.annotation[0].desc&&i.annotation[0].desc[0]&&i.annotation[0].desc[0].Text&&(x.description=i.annotation[0].desc[0].Text),i.annotation[0]&&i.annotation[0].uri&&i.annotation[0].uri[0]&&i.annotation[0].uri[0].Text&&(x.uri=i.annotation[0].uri[0].Text),i.annotation[0]&&i.annotation[0].img))for(var w in i.annotation[0].img)F.Common.isInteger(w)&&(x.img[w]=i.annotation[0].img[w].Text);if(i.chart&&i.chart[0])for(var w in i.chart[0])w!="Text"&&w!="_children"&&(x.chart[w]=i.chart[0][w][0].Text);return x&&x.level>1&&(x.len||(O="Error. Please include Branch Lengths - we only draw rooted phylogenetic trees.")),x},b=function(i,o){if(i.children&&i.children.length)for(var x=0;x<i.children.length;x++){var w=i.children[x];w.newickLen=Math.round((w.len+i.newickLen)*1e4)/1e4,w.level>d&&(d=w.level),w.newickLen>k&&(k=w.newickLen),w.children.length>0&&b(w)}return i},f=function(i,o){for(var x in i)x!="_children"&&x!="Text"&&(x=="rectangular"||x=="circular"?f(i[x][0],x):(F.PhyloCanvas.Render.Parameters[x]||(F.PhyloCanvas.Render.Parameters[x]={}),F.PhyloCanvas.Render.Parameters.set(x,i[x][0].Text,o)))};return function(i){if(this.getRoot=function(){return N},this.getLevels=function(){return d},this.getNewickLen=function(){return k},this.getValidate=function(){return O},i.phylogeny&&i.phylogeny[0]&&i.phylogeny[0].clade&&(N=C(i.phylogeny[0].clade[0])),i.phylogeny&&i.phylogeny[0]&&i.phylogeny[0].render&&i.phylogeny[0].render[0]){var o=i.phylogeny[0].render[0];if(o&&o.styles){var x=o.styles[0];for(var w in x)if(w!="_children"&&w!="Text")if(x[w][0].type&&x[w][0].type=="radialGradient"&&qt.svg)x[w][0].name=w,F.PhyloCanvas.Render.Style[w]=x[w][0],F.PhyloCanvas.Render.Style.jsphylosvgGradientList||(F.PhyloCanvas.Render.Style.jsphylosvgGradientList=[]),F.PhyloCanvas.Render.Style.jsphylosvgGradientList.push(w);else{F.PhyloCanvas.Render.Style[w]||(F.PhyloCanvas.Render.Style[w]={});for(var R in x[w][0])R!="_attributes"&&R!="_children"&&R!="type"&&(F.PhyloCanvas.Render.Style[w][R.replace("_","-")]=x[w][0][R])}}if(o&&o.parameters&&f(o.parameters[0]),o&&o.charts){var q=o.charts[0];for(var w in q)if(w!="_children"&&w!="Text")for(var R in q[w])q[w][R].type=="binary"?(q[w][R].chart=w,F.PhyloCanvas.Render.Parameters.binaryCharts.push(q[w][R])):q[w][R].type=="integratedBinary"?(q[w][R].chart=w,F.PhyloCanvas.Render.Parameters.integratedBinaryCharts.push(q[w][R])):q[w][R].type=="bar"&&(q[w][R].chart=w,F.PhyloCanvas.Render.Parameters.barCharts.length==1&&F.PhyloCanvas.Render.Parameters.barCharts.shift(),F.PhyloCanvas.Render.Parameters.barCharts.push(q[w][R]))}}N=b(N)}}();F.PhyloCanvas.PhyloxmlParse.prototype={};F.PhyloCanvas.NexmlParse=function(){var d=0,k=0,N,O,C,b,f=function(o,x,w){var R=new F.PhyloCanvas.Node;w&&(R.level=w.level+1);for(var q=0;q<C.length;q++)if(C[q].source==o.id)for(var z=0;z<b.length;z++)C[q].target==b[z].id&&R.children.push(f(b[z],C[q].length,R));if(R&&R.level>0&&!R.len&&(R.len=1),x&&(R.len=F.Common.roundFloat(x,4),R.len==0&&(R.len=1e-4)),o.label&&(R.type="label",R.name=o.label,o.style&&(R.style=o.style)),o.color){const B=o.color.replace(/[a-z%\s\(\)]/g,"").split(",");R.red=B[0],R.green=B[1],R.blue=B[2]}else{const B=F.PhyloCanvas.Render.Style.line.stroke.replace(/[a-z%\s\(\)]/g,"").split(",");R.red=B[0],R.green=B[1],R.blue=B[2]}return R},i=function(o,x){if(o.children&&o.children.length)for(var w=0;w<o.children.length;w++){var R=o.children[w];R.newickLen=Math.round((R.len+o.newickLen)*1e4)/1e4,R.level>d&&(d=R.level),R.newickLen>k&&(k=R.newickLen),R.children.length>0&&i(R)}return o};return function(o,x){this.getRoot=function(){return N},this.getLevels=function(){return d},this.getNewickLen=function(){return k},this.getValidate=function(){return O},x.tree&&o.trees[0]&&o.trees[0].tree[x.tree-1]?(C=o.trees[0].tree[x.tree-1].edge,b=o.trees[0].tree[x.tree-1].node):(C=o.trees[0].tree[0].edge,b=o.trees[0].tree[0].node);for(var w=0;w<b.length;w++){var R=0;if(b[w].root&&b[w].root=="true"){N=b[w];break}for(var q=0;q<C.length;q++)C[q].target==b[w].id&&R++;if(R==0){N=b[w];break}}N?(N=f(N),N=i(N)):O="Error. Currently, only rooted NeXML trees are supported."}}();F.PhyloCanvas.NexmlParse.prototype={};F.PhyloCanvas.NexmlJsonParse=function(){var d=0,k=0,N,O,C=[],b=[],f=function(x,w,R){var q=new F.PhyloCanvas.Node;R&&(q.level=R.level+1);for(var z=0;z<C.length;z++)if(C[z].source==x.id)for(var B=0;B<b.length;B++)C[z].target==b[B].id&&q.children.push(f(b[B],C[z].length,q));return w&&(q.len=F.Common.roundFloat(w,4),q.len==0&&(q.len=1e-4)),x.label&&(q.type="label",q.name=x.label,x.accession&&(q.accession=x.accession),x.style&&(q.style=x.style),x.bgStyle&&(q.bgStyle=x.bgStyle)),x.chart&&(q.chart=x.chart),q&&q.level>1&&(q.len||(O="Error. Please include Branch Lengths - we only draw rooted phylogenetic trees.")),q},i=function(x,w){if(x.children&&x.children.length)for(var R=0;R<x.children.length;R++){var q=x.children[R];q.newickLen=Math.round((q.len+x.newickLen)*1e4)/1e4,q.level>d&&(d=q.level),q.newickLen>k&&(k=q.newickLen),q.children.length>0&&i(q)}return x},o=function(x,w){for(var R in x)R!="_children"&&R!="Text"&&(R=="rectangular"||R=="circular"?o(x[R],R):(F.PhyloCanvas.Render.Parameters[R]||(F.PhyloCanvas.Render.Parameters[R]={}),F.PhyloCanvas.Render.Parameters.set(R,x[R],w)))};return function(x){this.getRoot=function(){return N},this.getLevels=function(){return d},this.getNewickLen=function(){return k},this.getValidate=function(){return O};var w=x.nexmlJson.nexml,R=w.render;if(R&&R.styles){var q=R.styles;for(var z in q)if(z!="_children"&&z!="Text")if(q[z]["@attributes"].type&&q[z]["@attributes"].type=="radialGradient"&&qt.svg)q[z].name=z,q[z].type=q[z]["@attributes"].type,F.PhyloCanvas.Render.Style[z]=q[z],F.PhyloCanvas.Render.Style.jsphylosvgGradientList||(F.PhyloCanvas.Render.Style.jsphylosvgGradientList=[]),F.PhyloCanvas.Render.Style.jsphylosvgGradientList.push(z);else{F.PhyloCanvas.Render.Style[z]||(F.PhyloCanvas.Render.Style[z]={});for(var B in q[z]["@attributes"])B!="_attributes"&&B!="_children"&&B!="type"&&(F.PhyloCanvas.Render.Style[z][B.replace("_","-")]=q[z]["@attributes"][B])}}if(R&&R.parameters&&o(R.parameters),R&&R.charts){var D=R.charts;for(var z in D)D[z]["@attributes"].chart=z,D[z]["@attributes"].type=="binary"?F.PhyloCanvas.Render.Parameters.binaryCharts.push(D[z]["@attributes"]):D[z]["@attributes"].type=="integratedBinary"?F.PhyloCanvas.Render.Parameters.integratedBinaryCharts.push(D[z]["@attributes"]):D[z]["@attributes"].type=="bar"&&F.PhyloCanvas.Render.Parameters.barCharts.push(D[z]["@attributes"])}if(x.tree&&w.trees[0]&&w.trees[0].tree[x.tree-1])C=w.trees[0].tree[x.tree-1].edge,b=w.trees[0].tree[x.tree-1].node;else{for(var z=0;z<w.trees.tree.edge.length;z++)C.push(w.trees.tree.edge[z]["@attributes"]);for(var z=0;z<w.trees.tree.node.length;z++){var j=w.trees.tree.node[z]["@attributes"];j.label&&(j.chart=w.trees.tree.node[z].chart),b.push(j)}}for(var z=0;z<b.length;z++)b[z].root&&b[z].root=="true"&&(N=b[z]);N?(N=f(N),N=i(N)):O="Error. Currently, only rooted NeXML trees are supported."}}();F.PhyloCanvas.NexmlParse.prototype={};F.PhyloCanvas.Render={};F.PhyloCanvas.Render.Style={line:{stroke:"rgb(0,0,0)","stroke-width":1},text:{"font-family":"Verdana","font-size":12,"text-anchor":"start"},path:{stroke:"rgb(0,0,0)","stroke-width":1},connectedDash:{stroke:"rgb(200,200,200)","stroke-dasharray":". "},textSecantBg:{fill:"#EEE",stroke:"#DDD"},highlightedEdgeCircle:{fill:"black",stroke:"black"},barChart:{fill:"#003300",stroke:"#DDD"},getStyle:function(d,k){return this[d]?this[d]:this[k]}};F.PhyloCanvas.Render.Parameters={jsOverride:0,Rectangular:{bufferX:200,paddingX:10,paddingY:20,bufferInnerLabels:10,bufferOuterLabels:5,minHeightBetweenLeaves:10,alignPadding:0,alignRight:!1,showScaleBar:!1},Circular:{bufferRadius:.33,bufferAngle:20,initStartAngle:160,innerCircleRadius:0,minHeightBetweenLeaves:5,bufferInnerLabels:2,bufferOuterLabels:5},binaryCharts:[],integratedBinaryCharts:[],barCharts:[],binaryChartBufferInner:5,binaryChartBufferSiblings:.01,binaryChartThickness:15,binaryChartDisjointed:!1,barChartBufferInner:3,barChartHeight:50,barChartWidth:.5,set:function(d,k,N){this.jsOverride||(N?N=="circular"?this.Circular[d]=parseFloat(k):N=="rectangular"&&(this.Rectangular[d]=parseFloat(k)):this[d]=parseFloat(k))}};F.PhyloCanvas.Render.Line=function(){return function(d,k,N,O,C,b,f,i){this.type="line",this.attr=F.PhyloCanvas.Render.Style.line,this.attr.stroke=["rgb(",C,",",b,",",f,")"].join(""),this.x1=d,this.x2=k,this.y1=N,this.y2=O,i&&(F.Common.apply(this,i),i.attr&&(this.attr=i.attr))}}();F.PhyloCanvas.Render.Text=function(){return function(d,k,N,O){this.type="text",this.attr=F.PhyloCanvas.Render.Style.text,this.x=d,this.y=k,this.text=N,O&&(F.Common.apply(this,O),O.attr&&(this.attr=O.attr))}}();F.PhyloCanvas.Render.Path=function(){return F.PhyloCanvas.Render.Style.path,function(d,k){this.type="path",this.attr=F.PhyloCanvas.Render.Style.path,this.path=d,k&&(F.Common.apply(this,k),k.attr&&(this.attr=k.attr))}}();F.PhyloCanvas.Render.Circle=function(){return function(d,k,N,O){this.type="circle",this.x=d,this.y=k,this.radius=N,O&&(F.Common.apply(this,O),O.attr&&(this.attr=O.attr))}}();F.PhyloCanvas.Render.SVG=function(){return function(d,k,N){this.canvasSize=[k,N],this.svg=qt(d,this.canvasSize[0],this.canvasSize[1])}}();F.PhyloCanvas.Render.SVG.prototype={render:function(){for(var d=this.phylogramObject.getDrawInstructs(),k=0;k<d.length;k++)if(d[k].type=="line")this.svg.path(["M",d[k].x1,d[k].y1,"L",d[k].x2,d[k].y2]).attr(F.PhyloCanvas.Render.Style.line);else if(d[k].type=="path")this.svg.path(d[k].path).attr(d[k].attr);else if(d[k].type=="circle")this.svg.circle(d[k].x,d[k].y,d[k].radius).attr({stroke:"black",fill:"black"});else{var N=this.svg.text(d[k].x,d[k].y,d[k].text).attr(F.PhyloCanvas.Render.Style.text);d[k].attr&&N.attr(d[k].attr),d[k].rotate&&N.rotate(d[k].rotate);var O=N.getBBox();Math.sqrt(O.height*O.height+O.width*O.width)}},draw:function(d){var k,N;if(d.type=="line")k=this.svg.path(["M",d.x1,d.y1,"L",d.x2,d.y2]).attr(F.PhyloCanvas.Render.Style.line);else if(d.type=="path")k=this.svg.path(d.path).attr(d.attr);else if(d.type=="circle")k=this.svg.circle(d.x,d.y,d.radius).attr({stroke:"black",fill:"black"});else if(d.type=="text"){k=this.svg.text(d.x,d.y,d.text).attr(F.PhyloCanvas.Render.Style.text),d.attr&&k.attr(d.attr),d.rotate&&k.rotate(d.rotate);var O=k.getBBox();N=Math.sqrt(O.height*O.height+O.width*O.width)}return[k,N]}};F.PhyloCanvas.Render.Phylogram=function(){var d,k=F.PhyloCanvas.Render.Parameters.Rectangular,N,O,C,b,f,i,o=!0,x=0,w=0,R,q,z,B,D,j,Q=[],U=function($,J,X,I){return["M",$,J,"L",X,J,"L",X,I,"L",$,I,"Z"]},G=function($,J){if($.len&&o==!1&&$.children.length==0&&(x=F.Common.roundFloat(x+b,4)),$.children.length>0){var X=[],I,ae,re,ge,xe,Y,fe;if($.len&&(I=J,ae=J=F.Common.roundFloat(J+C*$.len,4),re=x+$.getMidbranchPosition(o)*b,ge=re,xe=$.red,Y=$.green,fe=$.blue,d.draw(new F.PhyloCanvas.Render.Line(I,ae,re,ge,xe,Y,fe))),$.name){var pe={};if(pe=F.PhyloCanvas.Render.Style.getStyle("bootstrap","text"),$.font_color_hex?pe.fill=$.font_color_hex:pe.fill="#000000",$.uri&&(pe.href=$.uri),$.description&&(pe.title=$.description),$.level==0)var c=x+$.getMidbranchPosition(o)*b;else var c=ge;d.draw(new F.PhyloCanvas.Render.Text((ae||J)+5,c,$.name,{attr:pe}))}if($.children&&$.children.length)for(var u=0;u<$.children.length;u++){var p=$.children[u];X.push(G(p,J))}for(var n=[],u=0;u<X.length;u++)X[u][0]&&n.push(X[u][0]),X[u][1]&&n.push(X[u][1]);for(var r=Math.min.apply(null,n),s=Math.max.apply(null,n),h=(r+s)/2,m="",v="",A="",M=0,u=0;u<$.children.length;++u){var T=$.children[u];if(u==0)m=T.red,v=T.green,A=T.blue;else if(m==T.red&&v==T.green&&A==T.blue)M=1;else{M=0;break}}M==0?F.PhyloCanvas.Render.Style.line.stroke="black":(xe=$.children[0].red,Y=$.children[0].green,fe=$.children[0].blue,F.PhyloCanvas.Render.Style.line.stroke=["rgb(",xe,",",Y,",",fe,")"].join("")),$.children.length==2?(xe=$.children[0].red,Y=$.children[0].green,fe=$.children[0].blue,F.PhyloCanvas.Render.Style.line.stroke=["rgb(",xe,",",Y,",",fe,")"].join(""),d.draw(new F.PhyloCanvas.Render.Path(["M",J+1e-4,r,"L",J,r,"L",J,h],{attr:F.PhyloCanvas.Render.Style.line})),xe=$.children[1].red,Y=$.children[1].green,fe=$.children[1].blue,F.PhyloCanvas.Render.Style.line.stroke=["rgb(",xe,",",Y,",",fe,")"].join(""),d.draw(new F.PhyloCanvas.Render.Path(["M",J,h,"L",J,s,"L",J+1e-4,s],{attr:F.PhyloCanvas.Render.Style.line}))):d.draw(new F.PhyloCanvas.Render.Path(["M",J+1e-4,r,"L",J,r,"L",J,s,"L",J+1e-4,s],{attr:F.PhyloCanvas.Render.Style.line}))}else{if(I=J,ae=F.Common.roundFloat(J+C*$.len,2),re=x,ge=x,xe=$.red,Y=$.green,fe=$.blue,$.y=x,Q.push($),d.draw(new F.PhyloCanvas.Render.Line(I,ae,re,ge,xe,Y,fe)),k.alignRight&&d.draw(new F.PhyloCanvas.Render.Path(["M",ae,re,"L",k.alignPadding+f,ge],{attr:F.PhyloCanvas.Render.Style.connectedDash})),$.name){var pe={};$.style&&(pe=F.PhyloCanvas.Render.Style.getStyle($.style,"text")),$.font_color_hex?pe.fill=$.font_color_hex:pe.fill="#000000",pe["text-anchor"]="start",$.uri&&(pe.href=$.uri),$.description&&(pe.title=$.description);var V=d.draw(new F.PhyloCanvas.Render.Text(k.alignRight?f+k.bufferInnerLabels+k.alignPadding:ae+k.bufferInnerLabels,ge,$.name,{attr:pe}));w=Math.max(V[1],w),F.PhyloCanvas.Render.Parameters.mouseRollOver&&F.Common.addRaphEventHandler(V[0],"mouseover",F.PhyloCanvas.Render.Parameters.mouseRollOver,{svg:d,node:$,x:ae,y:ge,textEl:V[0]}),F.PhyloCanvas.Render.Parameters.mouseRollOut&&F.Common.addRaphEventHandler(V[0],"mouseout",F.PhyloCanvas.Render.Parameters.mouseRollOut,{svg:d,node:$,x:ae,y:ge,textEl:V[0]}),F.PhyloCanvas.Render.Parameters.onClickAction&&F.Common.addRaphEventHandler(V[0],"click",F.PhyloCanvas.Render.Parameters.onClickAction,{svg:d,node:$,x:ae,y:ge,textEl:V[0]})}o&&(o=!1)}return[re,ge]},ie=function(){y=x+b,q=0,z=k.showScaleBar*C,d.draw(new F.PhyloCanvas.Render.Line(q,z,y,y)),d.draw(new F.PhyloCanvas.Render.Text((q+z)/2,y-8,k.showScaleBar))},de=function($,J,X){for(var I=(X&&X.bufferInner?X.bufferInner:0)|F.PhyloCanvas.Render.Parameters.binaryChartBufferInner,ae=(X&&X.bufferSiblings?X.bufferSiblings*b:0)|(F.PhyloCanvas.Render.Parameters.binaryChartBufferSiblings<1?b*F.PhyloCanvas.Render.Parameters.binaryChartBufferSiblings:F.PhyloCanvas.Render.Parameters.binaryChartBufferSiblings),re=(X&&X.thickness?X.thickness:0)|F.PhyloCanvas.Render.Parameters.binaryChartThickness,ge=0;ge<Q.length;ge++){var xe=Q[ge];d.draw(new F.PhyloCanvas.Render.Path(U($+I,xe.y-b/2+ae/2,$+I+re,xe.y+b/2-ae/2),{attr:F.PhyloCanvas.Render.Style.getStyle(xe.chart[J],"textSecantBg")}))}return $+I+re},ve=function($,J,X){for(var I=[],ae,re=X&&X.bufferInner?X.bufferInner:0|F.PhyloCanvas.Render.Parameters.barChartBufferInner,ge=X&&X.height?X.height:0|F.PhyloCanvas.Render.Parameters.barChartHeight,xe=X&&X.width?X.width<1?b*X.width:X.width:0|(F.PhyloCanvas.Render.Parameters.barChartWidth<1?b*F.PhyloCanvas.Render.Parameters.barChartWidth:F.PhyloCanvas.Render.Parameters.barChartWidth),Y=0,fe=0;fe<Q.length;fe++)I.push(Q[fe].chart[J]);ae=Math.max.apply(null,I),Y=F.Common.roundFloat(ge/ae,4);for(var fe=0;fe<Q.length;fe++){var pe=Q[fe];d.draw(new F.PhyloCanvas.Render.Path(U($+re,pe.y-xe/2,$+re+Y*pe.chart[J],pe.y+xe/2),{attr:F.PhyloCanvas.Render.Style.getStyle(pe.chart[J],"barChart")}))}return $+re+ge};return function($,J){this.getCanvasSize=function(){return[N,O]},this.getRoot=function(){return J.getRoot()},J.getValidate()&&d.draw(0,0,J.getValidate()),o=!0,d=$;var X=J.getRoot(),I=J.getNewickLen();if(N=d.canvasSize[0],O=d.canvasSize[1],B=k.bufferX,D=k.paddingX,j=k.paddingY,i=k.minHeightBetweenLeaves,x=j,C=Math.round((N-B-D*2)/I),b=Math.round((O-j*2)/(k.showScaleBar?X.getCountAllChildren():X.getCountAllChildren()-1)),b<i&&(b=i),f=Math.round(N-B-D*2),(F.PhyloCanvas.Render.Parameters.binaryCharts.length||F.PhyloCanvas.Render.Parameters.barCharts.length)&&(k.alignRight=!0),G(X,D),k.showScaleBar&&ie(),R=f+w+k.bufferInnerLabels,F.PhyloCanvas.Render.Parameters.binaryCharts.length){var ae=F.PhyloCanvas.Render.Parameters.binaryCharts;for(var re in ae)R=de(R,ae[re].chart,ae[re])}if(F.PhyloCanvas.Render.Parameters.barCharts.length){var ge=F.PhyloCanvas.Render.Parameters.barCharts;for(var re in ge)ve(R,ge[re].chart,ge[re])}Q=[],typeof bgLabelsHold<"u"&&(bgLabelsHold=[])}}();F.PhyloCanvas.Render.Phylogram.prototype={};F.PhyloCanvas.Render.CircularPhylogram=function(){var d,k=F.PhyloCanvas.Render.Parameters.Circular,N,O,C,b,f,i,o=!0,x=0,w,R,q,z=[],B=[],D,j,Q=0,U,G=Math.PI/180;function ie(Y,fe){return fe+=U,[F.Common.roundFloat(w+Y*Math.sin(fe*G),4),F.Common.roundFloat(R+Y*Math.cos(fe*G),4)]}function de(Y){var fe=J(90-Y-U);if(fe>90&&fe<270){fe+=180;var pe="end"}else var pe="start";return[fe,pe]}function ve(Y,fe,pe,c){var u=ie(Y,fe),p=ie(Y,pe),n=[],r,s=0;return Math.abs(J(pe-fe))>180?r=1:r=-1,c&&c.invertSecant&&(r*=-1,s=1),c&&c.noMove||n.push("M"),n.push(u[0],u[1],"A",Y,Y,0,r<1?0:1,s,p[0],p[1]),n}function $(Y,fe,pe,c){var u=[],p=ie(fe,Y),n=ie(pe,Y);return c&&c.noMove||u.push("M"),u.push(p[0],p[1],"L",n[0],n[1]),u}function J(Y){for(;Y>360||Y<0;)Y>360?Y-=360:Y<0&&(Y+=360);return Y}function X(Y,fe,pe,c){if(!fe&&Y.length>1)var c=Y[3],pe=Y[2],fe=Y[1],Y=Y[0];var u=ae("M",ve(Y,pe,c,{noMove:1,invertSecant:0}),"L",ve(fe,c,pe,{noMove:1,invertSecant:1}),"Z");return u}function I(Y,fe){if(fe=fe,Y.len&&(o?x=D||1:Y.children.length==0&&(x=F.Common.roundFloat(x+f,4))),Y.children.length>0){var pe=[],c,u,p;if(c=fe,u=fe+=F.Common.roundFloat(b*Y.len,4),Y.name,Y.children&&Y.children.length)for(var n=0;n<Y.children.length;n++){var r=Y.children[n],s=I(r,fe);s>0&&pe.push(s)}var h=F.Common.roundFloat(Math.min.apply(null,pe),4),m=F.Common.roundFloat(Math.max.apply(null,pe),4);Y.level!=0&&d.draw(new F.PhyloCanvas.Render.Path(ae("M",ie(fe+.01,h),"L",ve(fe,h,m,{noMove:!0}),"L",ie(fe+.01,m)))),Y.len&&(p=F.Common.roundFloat(h+(m-h)/2,4),d.draw(new F.PhyloCanvas.Render.Path($(p,c,u))))}else if(Y.y=x,z.push(Y),c=fe,u=fe=F.Common.roundFloat(fe+b*Y.len),p=x,d.draw(new F.PhyloCanvas.Render.Path($(p,c,u))),d.draw(new F.PhyloCanvas.Render.Path($(p,u,q),{attr:F.PhyloCanvas.Render.Style.connectedDash})),Y.name){var W=ie(q+k.bufferInnerLabels,p),v=de(p),A=v[0],M=v[1],T={};Y.style&&F.Common.apply(T,F.PhyloCanvas.Render.Style.getStyle(Y.style,"text")),Y.font_color_hex?T.fill=Y.font_color_hex:T.fill="#000000",T["text-anchor"]=M,Y.uri&&(T.href=Y.uri),Y.description&&(T.title=Y.description);var V=d.draw(new F.PhyloCanvas.Render.Text(W[0],W[1],Y.name,{attr:T,rotate:[A,W[0],W[1]]}));Y.bgStyle&&B.push([Y.bgStyle,p]);var W=ie(u,p);F.PhyloCanvas.Render.Parameters.mouseRollOver&&F.Common.addRaphEventHandler(V[0],"mouseover",F.PhyloCanvas.Render.Parameters.mouseRollOver,{svg:d,node:Y,x:W[0],y:W[1],textEl:V[0]}),F.PhyloCanvas.Render.Parameters.mouseRollOut&&F.Common.addRaphEventHandler(V[0],"mouseout",F.PhyloCanvas.Render.Parameters.mouseRollOut,{svg:d,node:Y,x:W[0],y:W[1],textEl:V[0]}),F.PhyloCanvas.Render.Parameters.onClickAction&&F.Common.addRaphEventHandler(V[0],"click",F.PhyloCanvas.Render.Parameters.onClickAction,{svg:d,node:Y,x:W[0],y:W[1],textEl:V[0]}),Q=Math.max(V[1],Q)}return o&&(o=!1),p}function ae(Y){for(var fe=Y,pe=1;pe<arguments.length;pe++)fe=fe.concat(arguments[pe]);return fe}function re(){var u=[];if(B.length>0){if(F.PhyloCanvas.Render.Style.jsphylosvgGradientList)for(var Y=0;Y<F.PhyloCanvas.Render.Style.jsphylosvgGradientList.length;Y++){var fe=F.PhyloCanvas.Render.Style.jsphylosvgGradientList[Y],pe=F.Common.createGradientEl(fe,F.PhyloCanvas.Render.Style[fe],[w,R,q+Q+k.bufferOuterLabels]);d.svg.defs.appendChild(pe)}for(var Y=0;Y<B.length;Y++){if(Y!=B.length-1&&B[Y][0]==B[Y+1][0]){B[Y+1][2]=B[Y][2]?B[Y][2]:B[Y][1];continue}var u=X(q,q+Q+k.bufferOuterLabels,B[Y][2]?B[Y][2]-f/2:B[Y][1]-f/2,B[Y][1]+f/2),c=F.PhyloCanvas.Render.Style.getStyle(B[Y][0],"textSecantBg"),p=d.draw(new F.PhyloCanvas.Render.Path(u,{attr:c.type?{}:c}));c.type&&c.type=="radialGradient"&&p[0].node.setAttribute("fill","url(#"+c.name+")"),c.type&&c.type=="radialGradient"&&p[0].node.setAttribute("stroke","none"),p[0].toBack()}}var u=X(q,q+Q+k.bufferOuterLabels,(D||1)-f/2,360-f/2),p=d.draw(new F.PhyloCanvas.Render.Path(u,{attr:F.PhyloCanvas.Render.Style.textSecantBg}));return p[0].toBack(),q+Q+k.bufferOuterLabels}function ge(Y,fe,pe){for(var c=pe&&pe.bufferInner?parseFloat(pe.bufferInner):F.PhyloCanvas.Render.Parameters.binaryChartBufferInner,u=(pe&&pe.bufferSiblings?pe.bufferSiblings*f:0)|(F.PhyloCanvas.Render.Parameters.binaryChartBufferSiblings<1?f*F.PhyloCanvas.Render.Parameters.binaryChartBufferSiblings:F.PhyloCanvas.Render.Parameters.binaryChartBufferSiblings),p=pe&&pe.thickness?parseFloat(pe.thickness):F.PhyloCanvas.Render.Parameters.binaryChartThickness,n=(pe&&pe.disjointed?pe.disjointed:!1)|F.PhyloCanvas.Render.Parameters.binaryChartDisjointed,r=pe&&pe.isInternal?pe.isInternal:!1,s=!0,h,m=0;m<z.length;m++){var v=z[m];if((!z[m+1]||v.chart[fe]!==z[m+1].chart[fe]||n)&&v.chart[fe]!="none"){var A=F.PhyloCanvas.Render.Style.getStyle(v.chart[fe],"textSecantBg");if(r)var M=[q-c-p,q-c,(h||v.y)-f/2+(s&&!n?0:u/2),v.y+f/2-(m==z.length-1&&!n?0:u/2)];else var M=[Y+c,Y+c+p,(h||v.y)-f/2+(s&&!n?0:u/2),v.y+f/2-(m==z.length-1&&!n?0:u/2)];if(A.label){var T=F.PhyloCanvas.Render.Style.getStyle(A.labelStyle,"text"),V=ie((M[0]+M[1])/2,(M[2]+M[3])/2),W=de((M[2]+M[3])/2),oe=J(W[0]+(T.rotate?parseFloat(T.rotate):0)),be=J(90-(M[2]+M[3])/2-U);be>90&&be<270&&(oe+=180),T["text-anchor"]||(T["text-anchor"]="middle"),v.font_color_hex?A.fill=v.font_color_hex:A.fill="#000000";var we=d.draw(new F.PhyloCanvas.Render.Text(V[0],V[1],A.label,{attr:T,rotate:oe}));we[0].toBack()}if(A.borderStyle){var ye=F.PhyloCanvas.Render.Style.getStyle(A.borderStyle,"textSecantBg"),Ae=[q,ye.fullsize?M[1]:M[0],M[2],M[3]],Ee=d.draw(new F.PhyloCanvas.Render.Path(X(Ae),{attr:ye}));Ee[0].toBack()}var _e=d.draw(new F.PhyloCanvas.Render.Path(X(M),{attr:A}));_e[0].toBack(),h=0,s=!1}else h||(h=v.y),v.chart[fe]=="none"&&(h=0);s=!1}return r?Y:Y+c+p}function xe(Y,fe,pe){for(var c=[],u,p=pe&&pe.bufferInner?parseFloat(pe.bufferInner):F.PhyloCanvas.Render.Parameters.barChartBufferInner,n=pe&&pe.height?parseFloat(pe.height):F.PhyloCanvas.Render.Parameters.barChartHeight?F.PhyloCanvas.Render.Parameters.barChartHeight:0,r=pe&&pe.width?parseFloat(pe.width)<1?f*parseFloat(pe.width):parseFloat(pe.width):0|(F.PhyloCanvas.Render.Parameters.barChartWidth<1?f*F.PhyloCanvas.Render.Parameters.barChartWidth:F.PhyloCanvas.Render.Parameters.barChartWidth),s=0,h=0;h<z.length;h++)c.push(z[h].chart[fe]);u=Math.max.apply(null,c),s=F.Common.roundFloat(n/u,4);for(var h=0;h<z.length;h++){var m=z[h];m.chart[fe]>0&&d.draw(new F.PhyloCanvas.Render.Path(X(Y+p,Y+p+s*m.chart[fe],m.y-r/2,m.y+r/2),{attr:F.PhyloCanvas.Render.Style.getStyle(m.chart[fe],"barChart")}))}return Y+p+n}return function(Y,fe,pe){if(this.getCanvasSize=function(){return[N,O]},this.getRoot=function(){return fe.getRoot()},fe.getValidate()){Y.draw({type:"text",x:0,y:Y.canvasSize[1]/3,text:fe.getValidate()});return}d=Y;var c=fe.getRoot(),u=fe.getNewickLen();if(N=d.canvasSize[0],O=d.canvasSize[1],w=N/2,R=O/2,C=Math.min.apply(null,[N,O]),pe=k.bufferRadius>1?k.bufferRadius:F.Common.roundFloat(C*k.bufferRadius,4),D=k.bufferAngle,i=k.innerCircleRadius,k.minHeightBetweenLeaves,U=k.initStartAngle,q=Math.round((C-pe-i)/2),b=(q-i)/u,f=F.Common.roundFloat((360-D)/c.getCountAllChildren(),4),I(c,i),j=q+Q+k.bufferOuterLabels,F.PhyloCanvas.Render.Parameters.integratedBinaryCharts.length){var p=F.PhyloCanvas.Render.Parameters.integratedBinaryCharts;for(var n in p){var r=p[n].bufferInner?p[n].bufferInner:F.PhyloCanvas.Render.Parameters.binaryChartBufferInner,s=p[n].thickness?p[n].thickness:F.PhyloCanvas.Render.Parameters.binaryChartThickness;j=ge(j-s-r,p[n].chart,p[n])}}if(j=re(),F.PhyloCanvas.Render.Parameters.binaryCharts.length){var h=F.PhyloCanvas.Render.Parameters.binaryCharts;for(var n in h)j=ge(j,h[n].chart,h[n])}if(F.PhyloCanvas.Render.Parameters.barCharts.length){var m=F.PhyloCanvas.Render.Parameters.barCharts;for(var n in m)j=xe(j,m[n].chart,m[n])}z=[],B=[]}}();F.PhyloCanvas.Render.CircularPhylogram.prototype={};var yt=function(){var d=function(O){if(!!O&&typeof O=="object"){let C=function(){};return C.prototype=O,new C}},k=function(O){var C="";!!O&&typeof O=="string"&&(C=O);var b=/^((-)?([0-9]*)((\.{0,1})([0-9]+))?$)/;return b.test(C)},N={xmlToJSON:function(O){try{let o=function(z){return z.replace(/^\s+|\s+$/gm,"")},x=function(z){var B=/-/g,D=String(z).replace(B,"_");return D},w=function(z,B){if(B.attributes.length>0){var D=B.attributes.length-1,j;z._attributes=[];do j=String(x(B.attributes[D].name)),z._attributes.push(j),z[j]=o(B.attributes[D].value);while(D--)}},R=function(z){z.getNodeByAttribute=function(B,D){if(this.length>0){var j,Q=this.length-1;try{do if(j=this[Q],j[B]==D)return j;while(Q--)}catch{return!1}return!1}},z.contains=function(B,D){if(this.length>0){var j=this.length-1;try{do if(this[j][B]==D)return!0;while(j--)}catch{return!1}return!1}},z.indexOf=function(B,D){var j=-1;if(this.length>0){var Q=this.length-1;try{do this[Q][B]==D&&(j=Q);while(Q--)}catch{return-1}return j}},z.SortByAttribute=function(B,D){if(this.length){let j=function(U,G){var ie=U[G];return ie=k(ie)?parseFloat(ie):ie,ie},Q=function(U,G){var ie=0,de,ve;return de=j(U,B),ve=j(G,B),de<ve?ie=-1:ve<de&&(ie=1),D&&(ie=D.toUpperCase()=="DESC"?0-ie:ie),ie};this.sort(Q)}},z.SortByValue=function(B){if(this.length){let D=function(Q){var U=Q.Text;return U=k(U)?parseFloat(U):U,U},j=function(Q,U){var G=0,ie,de;return ie=D(Q),de=D(U),ie<de?G=-1:de<ie&&(G=1),B&&(G=B.toUpperCase()=="DESC"?0-G:G),G};this.sort(j)}},z.SortByNode=function(B,D){if(this.length){let j=function(U,G){var ie=U[G][0].Text;return ie=k(ie)?parseFloat(ie):ie,ie},Q=function(U,G){var ie=0,de,ve;return de=j(U,B),ve=j(G,B),de<ve?ie=-1:ve<de&&(ie=1),D&&(ie=D.toUpperCase()=="DESC"?0-ie:ie),ie};this.sort(Q)}}},q=function(z,B){var D,j,Q,U="";if(!B)return null;if(B.attributes.length>0&&w(z,B),z.Text="",B.hasChildNodes()){var G=B.childNodes.length-1,ie=0;do switch(j=B.childNodes[ie],j.nodeType){case 1:z._children=[],D=j.localName?j.localName:j.baseName,D=x(D),U!=D&&z._children.push(D),z[D]||(z[D]=[]),Q={},z[D].push(Q),j.attributes.length>0&&w(Q,j),z[D].contains||R(z[D]),U=D,j.hasChildNodes()&&q(Q,j);break;case 3:z.Text+=o(j.nodeValue);break;case 4:z.Text+=j.text?o(j.text):o(j.nodeValue);break}while(ie++<G)}};if(!O)return null;var C={};C.typeOf="JSXBObject";var b=O.nodeType==9?O.documentElement:O;if(C.RootName=b.nodeName||"",O.nodeType==3||O.nodeType==4)return O.nodeValue;var f=function(){var z={activate:function(){var B=[];return B&&(B.getNodesByAttribute=function(D,j){if(!!B&&B.length>0){var Q=[],U,G=B.length-1;try{do U=B[G],U[D]===j&&Q.push(U);while(G--);return Q.reverse(),Q}catch{return null}return null}},B.getNodeByAttribute=function(D,j){if(!!B&&B.length>0){var Q,U=B.length-1;try{do if(Q=B[U],Q[D]===j)return Q;while(U--)}catch{return null}return null}},B.getNodesByValue=function(D){if(!!B&&B.length>0){var j=[],Q,U=B.length-1;try{do Q=B[U],!!Q.Text&&Q.Text===D&&j.push(Q);while(U--);return j}catch{return null}return null}},B.contains=function(D,j){if(!!B&&B.length>0){var Q=B.length-1;try{do if(B[Q][D]===j)return!0;while(Q--)}catch{return!1}return!1}},B.indexOf=function(D,j){var Q=-1;if(!!B&&B.length>0){var U=B.length-1;try{do B[U][D]===j&&(Q=U);while(U--)}catch{return-1}return Q}},B.SortByAttribute=function(D,j){if(!!B&&B.length>0){let Q=function(G,ie){var de=G[ie];return de=bam.validation.isNumeric(de)?parseFloat(de):de,de},U=function(G,ie){var de,ve;de=Q(G,D),ve=Q(ie,D);var $=de<ve?-1:ve<de?1:0;return j&&($=j.toUpperCase()==="DESC"?0-$:$),$};B.sort(U)}},B.SortByValue=function(D){if(!!B&&B.length>0){let j=function(U){var G=U.Text;return G=bam.validation.isNumeric(G)?parseFloat(G):G,G},Q=function(U,G){var ie,de;ie=j(U),de=j(G);var ve=ie<de?-1:de<ie?1:0;return D&&(ve=D.toUpperCase()==="DESC"?0-ve:ve),ve};B.sort(Q)}},B.SortByNode=function(D,j){if(!!B&&B.length>0){let Q=function(G,ie){var de=G[ie][0].Text;return de=bam.validation.isNumeric(de)?parseFloat(de):de,de},U=function(G,ie){var de,ve;de=Q(G,D),ve=Q(ie,D);var $=de<ve?-1:ve<de?1:0;return j&&($=j.toUpperCase()==="DESC"?0-$:$),$};B.sort(U)}}),B}};return z}(),i=function(){var z=d(f);return z.activate()};return q(C,b),O=null,b=null,C}catch{return null}},textToXML:function(O){var C=null;try{C=document.all?new ActiveXObject("Microsoft.XMLDOM"):new DOMParser,C.async=!1}catch{throw new Error("XML Parser could not be instantiated")}var b;try{document.all?b=C.loadXML(O)?C:!1:b=C.parseFromString(O,"text/xml")}catch{throw new Error("Error parsing XML string")}return b}};return N}();const Ie={};Ie.defaults={skip_sgml:!1,syncope:!1};var zt=Ie.schemes={balinese:{vowels:"\u1B05 \u1B06 \u1B07 \u1B08 \u1B09 \u1B0A \u1B0B \u1B0C \u1B0D \u1B0E  \u1B0F \u1B10  \u1B11 \u1B12".split(" "),vowel_marks:"\u1B35 \u1B36 \u1B37 \u1B38 \u1B39 \u1B3A \u1B3B \u1B3C \u1B3D \u1B42 \u1B3E \u1B3F \u1B43 \u1B40 \u1B41".split(" "),other_marks:["\u1B02","\u1B04","\u1B01",""],virama:["\u1B44"],consonants:"\u1B13 \u1B14 \u1B15 \u1B16 \u1B17 \u1B18 \u1B19 \u1B1A \u1B1B \u1B1C \u1B1D \u1B1E \u1B1F \u1B20 \u1B21 \u1B22 \u1B23 \u1B24 \u1B25 \u1B26 \u1B27 \u1B28 \u1B29 \u1B2A \u1B2B \u1B2C \u1B2D \u1B2E \u1B2F \u1B30 \u1B31 \u1B32 \u1B33".split(" "),symbols:"\u1B50 \u1B51 \u1B52 \u1B53 \u1B54 \u1B55 \u1B56 \u1B57 \u1B58 \u1B59   \u1B5E \u1B5F".split(" "),zwj:["\u200D"],skip:[""]},bengali:{vowels:"\u0985 \u0986 \u0987 \u0988 \u0989 \u098A \u098B \u09E0 \u098C \u09E1  \u098F \u0990  \u0993 \u0994".split(" "),vowel_marks:"\u09BE \u09BF \u09C0 \u09C1 \u09C2 \u09C3 \u09C4 \u09E2 \u09E3  \u09C7 \u09C8  \u09CB \u09CC".split(" "),other_marks:"\u0982 \u0983 \u0981".split(" "),virama:["\u09CD"],consonants:"\u0995 \u0996 \u0997 \u0998 \u0999 \u099A \u099B \u099C \u099D \u099E \u099F \u09A0 \u09A1 \u09A2 \u09A3 \u09A4 \u09A5 \u09A6 \u09A7 \u09A8 \u09AA \u09AB \u09AC \u09AD \u09AE \u09AF \u09B0 \u09B2 \u09AC \u09B6 \u09B7 \u09B8 \u09B9 \u0933 \u0995\u09CD\u09B7 \u099C\u09CD\u099E".split(" "),symbols:"\u09E6 \u09E7 \u09E8 \u09E9 \u09EA \u09EB \u09EC \u09ED \u09EE \u09EF \u0950 \u09BD \u0964 \u0965".split(" "),other:"    \u09A1 \u09A2  \u09AF ".split(" ")},newa:{vowels:["\u{11400}","\u{11401}","\u{11402}","\u{11403}","\u{11404}","\u{11405}","\u{11406}","\u{11407}","\u{11408}","\u{11409}","","\u{1140A}","\u{1140B}","","\u{1140C}","\u{1140D}"],vowel_marks:["\u{11435}","\u{11436}","\u{11437}","\u{11438}","\u{11439}","\u{1143A}","\u{1143B}","\u{1143C}","\u{1143D}","","\u{1143E}","\u{1143F}","","\u{11440}","\u{11441}"],other_marks:["\u{11444}","\u{11445}","\u{11443}","\u{11460}","\u{11461}",""],virama:["\u{11442}"],consonants:["\u{1140E}","\u{1140F}","\u{11410}","\u{11411}","\u{11412}","\u{11414}","\u{11415}","\u{11416}","\u{11417}","\u{11418}","\u{1141A}","\u{1141B}","\u{1141C}","\u{1141D}","\u{1141E}","\u{1141F}","\u{11420}","\u{11421}","\u{11422}","\u{11423}","\u{11425}","\u{11426}","\u{11427}","\u{11428}","\u{11429}","\u{1142B}","\u{1142C}","\u{1142E}","\u{11430}","\u{11431}","\u{11432}","\u{11433}","\u{11434}"],symbols:["\u{11450}","\u{11451}","\u{11452}","\u{11453}","\u{11454}","\u{11455}","\u{11456}","\u{11457}","\u{11458}","\u{11459}","\u{11449}","\u{11447}","\u{1144B}","\u{1144C}"]},sarada:{vowels:["\u{11183}","\u{11184}","\u{11185}","\u{11186}","\u{11187}","\u{11188}","\u{11189}","\u{1118A}","\u{1118B}","\u{1118C}","","\u{1118D}","\u{1118E}","","\u{1118F}","\u{11190}"],vowel_marks:["\u{111B3}","\u{111B4}","\u{111B5}","\u{111B6}","\u{111B7}","\u{111B8}","\u{111B9}","\u{111BA}","\u{111BB}","","\u{111BC}","\u{111BD}","","\u{111BE}","\u{111BF}"],other_marks:["\u{11181}","\u{11182}","\u{11180}","\u{111C2}","\u{111C3}"],virama:["\u{111C0}"],consonants:["\u{11191}","\u{11192}","\u{11193}","\u{11194}","\u{11195}","\u{11196}","\u{11197}","\u{11198}","\u{11199}","\u{1119A}","\u{1119B}","\u{1119C}","\u{1119D}","\u{1119E}","\u{1119F}","\u{111A0}","\u{111A1}","\u{111A2}","\u{111A3}","\u{111A4}","\u{111A5}","\u{111A6}","\u{111A7}","\u{111A8}","\u{111A9}","\u{111AA}","\u{111AB}","\u{111AC}","\u{111AE}","\u{111AF}","\u{111B0}","\u{111B1}","\u{111B2}","\u{111AD}"],symbols:["\u{111D0}","\u{111D1}","\u{111D2}","\u{111D3}","\u{111D4}","\u{111D5}","\u{111D6}","\u{111D7}","\u{111D8}","\u{111D9}","\u{111C4}","\u{111C1}","\u{111C5}","\u{111C6}"]},devanagari:{vowels:"\u0905 \u0906 \u0907 \u0908 \u0909 \u090A \u090B \u0960 \u090C \u0961 \u090E \u090F \u0910 \u0912 \u0913 \u0914 \u090F \u0910 \u0913".split(" "),vowel_marks:"\u093E \u093F \u0940 \u0941 \u0942 \u0943 \u0944 \u0962 \u0963 \u0946 \u0947 \u0948 \u094A \u094B \u094C \u094E \u094E\u0947 \u094E\u093E \u094E\u094B \u0946 \u094F".split(" "),other_marks:"\u0902 \u0903 \u0901 \u1CF5 \u1CF6 \uA8FD".split(" "),virama:["\u094D"],consonants:"\u0915 \u0916 \u0917 \u0918 \u0919 \u091A \u091B \u091C \u091D \u091E \u091F \u0920 \u0921 \u0922 \u0923 \u0924 \u0925 \u0926 \u0927 \u0928 \u092A \u092B \u092C \u092D \u092E \u092F \u0930 \u0932 \u0935 \u0936 \u0937 \u0938 \u0939 \u0933".split(" "),symbols:"\u0966 \u0967 \u0968 \u0969 \u096A \u096B \u096C \u096D \u096E \u096F \u0950 \u093D \u0964 \u0965".split(" "),zwj:["\u200D"],skip:[""],accent:["\u0951","\u0952"],combo_accent:"\u0903\u0951 \u0903\u0952 \u0902\u0951 \u0902\u0952".split(" "),candra:["\u0945"],other:"\u0915\u093C \u0916\u093C \u0917\u093C \u091C\u093C \u0921\u093C \u0922\u093C \u092B\u093C \u092F\u093C \u0931".split(" ")},gujarati:{vowels:"\u0A85 \u0A86 \u0A87 \u0A88 \u0A89 \u0A8A \u0A8B \u0AE0 \u0A8C \u0AE1  \u0A8F \u0A90  \u0A93 \u0A94".split(" "),vowel_marks:"\u0ABE \u0ABF \u0AC0 \u0AC1 \u0AC2 \u0AC3 \u0AC4 \u0AE2 \u0AE3  \u0AC7 \u0AC8  \u0ACB \u0ACC".split(" "),other_marks:"\u0A82 \u0A83 \u0A81".split(" "),virama:["\u0ACD"],consonants:"\u0A95 \u0A96 \u0A97 \u0A98 \u0A99 \u0A9A \u0A9B \u0A9C \u0A9D \u0A9E \u0A9F \u0AA0 \u0AA1 \u0AA2 \u0AA3 \u0AA4 \u0AA5 \u0AA6 \u0AA7 \u0AA8 \u0AAA \u0AAB \u0AAC \u0AAD \u0AAE \u0AAF \u0AB0 \u0AB2 \u0AB5 \u0AB6 \u0AB7 \u0AB8 \u0AB9 \u0AB3".split(" "),symbols:"\u0AE6 \u0AE7 \u0AE8 \u0AE9 \u0AEA \u0AEB \u0AEC \u0AED \u0AEE \u0AEF \u0AD0 \u0ABD \u0AE4 \u0AE5".split(" "),candra:["\u0AC5"]},gurmukhi:{vowels:"\u0A05 \u0A06 \u0A07 \u0A08 \u0A09 \u0A0A      \u0A0F \u0A10  \u0A13 \u0A14".split(" "),vowel_marks:"\u0A3E \u0A3F \u0A40 \u0A41 \u0A42      \u0A47 \u0A48  \u0A4B \u0A4C".split(" "),other_marks:"\u0A02 \u0A03 \u0A01".split(" "),virama:["\u0A4D"],consonants:"\u0A15 \u0A16 \u0A17 \u0A18 \u0A19 \u0A1A \u0A1B \u0A1C \u0A1D \u0A1E \u0A1F \u0A20 \u0A21 \u0A22 \u0A23 \u0A24 \u0A25 \u0A26 \u0A27 \u0A28 \u0A2A \u0A2B \u0A2C \u0A2D \u0A2E \u0A2F \u0A30 \u0A32 \u0A35 \u0A36 \u0A36 \u0A38 \u0A39 \u0A33".split(" "),symbols:"\u0A66 \u0A67 \u0A68 \u0A69 \u0A6A \u0A6B \u0A6C \u0A6D \u0A6E \u0A6F \u0950 \u093D \u0964 \u0965".split(" "),other:" \u0A16 \u0A17 \u0A1C \u0A21  \u0A2B  ".split(" ")},kannada:{vowels:"\u0C85 \u0C86 \u0C87 \u0C88 \u0C89 \u0C8A \u0C8B \u0CE0 \u0C8C \u0CE1 \u0C8E \u0C8F \u0C90 \u0C92 \u0C93 \u0C94".split(" "),vowel_marks:"\u0CBE \u0CBF \u0CC0 \u0CC1 \u0CC2 \u0CC3 \u0CC4 \u0CE2 \u0CE3 \u0CC6 \u0CC7 \u0CC8 \u0CCA \u0CCB \u0CCC".split(" "),other_marks:"\u0C82 \u0C83 \u0901".split(" "),virama:["\u0CCD"],consonants:"\u0C95 \u0C96 \u0C97 \u0C98 \u0C99 \u0C9A \u0C9B \u0C9C \u0C9D \u0C9E \u0C9F \u0CA0 \u0CA1 \u0CA2 \u0CA3 \u0CA4 \u0CA5 \u0CA6 \u0CA7 \u0CA8 \u0CAA \u0CAB \u0CAC \u0CAD \u0CAE \u0CAF \u0CB0 \u0CB2 \u0CB5 \u0CB6 \u0CB7 \u0CB8 \u0CB9 \u0CB3".split(" "),symbols:"\u0CE6 \u0CE7 \u0CE8 \u0CE9 \u0CEA \u0CEB \u0CEC \u0CED \u0CEE \u0CEF \u0C93\u0C82 \u0CBD \u0964 \u0965".split(" "),other:"      \u0CAB  \u0CB1".split(" ")},malayalam:{vowels:"\u0D05 \u0D06 \u0D07 \u0D08 \u0D09 \u0D0A \u0D0B \u0D60 \u0D0C \u0D61 \u0D0E \u0D0F \u0D10 \u0D12 \u0D13 \u0D14".split(" "),vowel_marks:"\u0D3E \u0D3F \u0D40 \u0D41 \u0D42 \u0D43 \u0D44 \u0D62 \u0D63 \u0D46 \u0D47 \u0D48 \u0D4A \u0D4B \u0D4C".split(" "),other_marks:"\u0D02 \u0D03 \u0901".split(" "),virama:["\u0D4D"],consonants:"\u0D15 \u0D16 \u0D17 \u0D18 \u0D19 \u0D1A \u0D1B \u0D1C \u0D1D \u0D1E \u0D1F \u0D20 \u0D21 \u0D22 \u0D23 \u0D24 \u0D25 \u0D26 \u0D27 \u0D28 \u0D2A \u0D2B \u0D2C \u0D2D \u0D2E \u0D2F \u0D30 \u0D32 \u0D35 \u0D36 \u0D37 \u0D38 \u0D39 \u0D33".split(" "),symbols:"\u0D66 \u0D67 \u0D68 \u0D69 \u0D6A \u0D6B \u0D6C \u0D6D \u0D6E \u0D6F \u0D13\u0D02 \u0D3D \u0964 \u0965".split(" "),other:"        \u0D31".split(" ")},oriya:{vowels:"\u0B05 \u0B06 \u0B07 \u0B08 \u0B09 \u0B0A \u0B0B \u0B60 \u0B0C \u0B61  \u0B0F \u0B10  \u0B13 \u0B14".split(" "),vowel_marks:"\u0B3E \u0B3F \u0B40 \u0B41 \u0B42 \u0B43 \u0B44 \u0B62 \u0B63  \u0B47 \u0B48  \u0B4B \u0B4C".split(" "),other_marks:"\u0B02 \u0B03 \u0B01".split(" "),virama:["\u0B4D"],consonants:"\u0B15 \u0B16 \u0B17 \u0B18 \u0B19 \u0B1A \u0B1B \u0B1C \u0B1D \u0B1E \u0B1F \u0B20 \u0B21 \u0B22 \u0B23 \u0B24 \u0B25 \u0B26 \u0B27 \u0B28 \u0B2A \u0B2B \u0B2C \u0B2D \u0B2E \u0B2F \u0B30 \u0B32 \u0B35 \u0B36 \u0B37 \u0B38 \u0B39 \u0B33".split(" "),symbols:"\u0B66 \u0B67 \u0B68 \u0B69 \u0B6A \u0B6B \u0B6C \u0B6D \u0B6E \u0B6F \u0B13\u0B02 \u0B3D \u0964 \u0965".split(" "),other:"    \u0B21 \u0B22  \u0B2F ".split(" ")},tamil:{vowels:"\u0B85 \u0B86 \u0B87 \u0B88 \u0B89 \u0B8A     \u0B8E \u0B8F \u0B90 \u0B92 \u0B93 \u0B94".split(" "),vowel_marks:"\u0BBE \u0BBF \u0BC0 \u0BC1 \u0BC2     \u0BC6 \u0BC7 \u0BC8 \u0BCA \u0BCB \u0BCC".split(" "),other_marks:"\u0B82 \u0B83 ".split(" "),virama:["\u0BCD"],consonants:"\u0B95 \u0B95 \u0B95 \u0B95 \u0B99 \u0B9A \u0B9A \u0B9C \u0B9A \u0B9E \u0B9F \u0B9F \u0B9F \u0B9F \u0BA3 \u0BA4 \u0BA4 \u0BA4 \u0BA4 \u0BA8 \u0BAA \u0BAA \u0BAA \u0BAA \u0BAE \u0BAF \u0BB0 \u0BB2 \u0BB5 \u0BB6 \u0BB7 \u0BB8 \u0BB9 \u0BB3".split(" "),symbols:"\u0BE6 \u0BE7 \u0BE8 \u0BE9 \u0BEA \u0BEB \u0BEC \u0BED \u0BEE \u0BEF \u0BD0 \u093D \u0964 \u0965".split(" "),other:"        \u0BB1".split(" ")},telugu:{vowels:"\u0C05 \u0C06 \u0C07 \u0C08 \u0C09 \u0C0A \u0C0B \u0C60 \u0C0C \u0C61 \u0C0E \u0C0F \u0C10 \u0C12 \u0C13 \u0C14".split(" "),vowel_marks:"\u0C3E \u0C3F \u0C40 \u0C41 \u0C42 \u0C43 \u0C44 \u0C62 \u0C63 \u0C46 \u0C47 \u0C48 \u0C4A \u0C4B \u0C4C".split(" "),other_marks:"\u0C02 \u0C03 \u0C01 \u1CF2 \u1CF2".split(" "),virama:["\u0C4D"],consonants:"\u0C15 \u0C16 \u0C17 \u0C18 \u0C19 \u0C1A \u0C1B \u0C1C \u0C1D \u0C1E \u0C1F \u0C20 \u0C21 \u0C22 \u0C23 \u0C24 \u0C25 \u0C26 \u0C27 \u0C28 \u0C2A \u0C2B \u0C2C \u0C2D \u0C2E \u0C2F \u0C30 \u0C32 \u0C35 \u0C36 \u0C37 \u0C38 \u0C39 \u0C33".split(" "),symbols:"\u0C66 \u0C67 \u0C68 \u0C69 \u0C6A \u0C6B \u0C6C \u0C6D \u0C6E \u0C6F \u0C13\u0C02 \u0C3D \u0964 \u0965".split(" "),other:"        \u0C31".split(" ")},iast:{vowels:"a \u0101 i \u012B u \u016B \u1E5B \u1E5D \u1E37 \u1E39 \u1EBD e ai \xF5 o au \xEA a\xEE \xF4 a\xFB".split(" "),other_marks:["\u1E43","\u1E25","m\u0310","\u1E96","\u1E2B","o\u1E3F"],virama:[""],consonants:"k kh g gh \u1E45 c ch j jh \xF1 \u1E6D \u1E6Dh \u1E0D \u1E0Dh \u1E47 t th d dh n p ph b bh m y r l v \u015B \u1E63 s h \u1E3B".split(" "),symbols:"0 1 2 3 4 5 6 7 8 9 o\u1E41 ' | ||".split(" ")},iso:{vowels:"a \u0101 i \u012B u \u016B r\u0325 r\u0325\u0304 l\u0325 l\u0325\u0304 \u1EBD e ai \xF5 o au \xEA a\xEE \xF4 a\xFB".split(" "),other_marks:["\u1E41","\u1E25","m\u0310","o\u1E3F"],virama:[""],consonants:"k kh g gh \u1E45 c ch j jh \xF1 \u1E6D \u1E6Dh \u1E0D \u1E0Dh \u1E47 t th d dh n p ph b bh m y r l v \u015B \u1E63 s h \u1E37 k\u1E63 j\xF1".split(" "),symbols:"0 1 2 3 4 5 6 7 8 9 om\u0310 ' | ||".split(" ")},itrans:{vowels:"a A i I u U RRi RRI LLi LLI  e ai  o au".split(" "),other_marks:["M","H",".N"],virama:[""],consonants:"k kh g gh ~N ch Ch j jh ~n T Th D Dh N t th d dh n p ph b bh m y r l v sh Sh s h L kSh j~n".split(" "),symbols:"0 1 2 3 4 5 6 7 8 9 OM .a | ||".split(" "),candra:[".c"],zwj:["{}"],skip:"_",accent:["\\'","\\_"],combo_accent:"\\'H \\_H \\'M \\_M".split(" "),other:"q K G z .D .Dh f Y R".split(" ")},hk:{vowels:"a A i I u U R RR lR lRR  e ai  o au".split(" "),other_marks:"M H ~".split(" "),virama:[""],consonants:"k kh g gh G c ch j jh J T Th D Dh N t th d dh n p ph b bh m y r l v z S s h L kS jJ".split(" "),symbols:"0 1 2 3 4 5 6 7 8 9 OM ' | ||".split(" ")},slp1:{vowels:"a A i I u U f F x X \u1EBD e E \xF5 o O \xEA \xCA \xF4 \xD4".split(" "),other_marks:"M H m\u0310 \u1E96 \u1E2B o\u1E3F".split(" "),virama:[""],consonants:"k K g G N c C j J Y w W q Q R t T d D n p P b B m y r l v S z s h L".split(" "),symbols:"0 1 2 3 4 5 6 7 8 9 o\u1E41 ' | ||".split(" ")},velthuis:{vowels:"a aa i ii u uu .r .rr .li .ll  e ai  o au".split(" "),other_marks:".m .h ".split(" "),virama:[""],consonants:'k kh g gh "n c ch j jh ~n .t .th .d .d .n t th d dh n p ph b bh m y r l v ~s .s s h L k.s j~n'.split(" "),symbols:"0 1 2 3 4 5 6 7 8 9 o.m ' | ||".split(" ")},wx:{vowels:"a A i I u U q Q L   e E  o O".split(" "),other_marks:"M H z".split(" "),virama:[""],consonants:"k K g G f c C j J F t T d D N w W x X n p P b B m y r l v S R s h  kR jF".split(" "),symbols:"0 1 2 3 4 5 6 7 8 9 oM ' | ||".split(" ")}},_n={},Kt={iast:{\u1E5B:["r\u0325"],\u1E43:["\u1E41"]},itrans:{A:["aa"],I:["ii","ee"],U:["uu","oo"],RRi:["R^i"],RRI:["R^I"],LLi:["L^i"],LLI:["L^I"],M:[".m",".n"],"~N":["N^"],ch:["c"],Ch:["C","chh"],"~n":["JN"],v:["w"],Sh:["S","shh"],kSh:["kS","x"],"j~n":["GY","dny"],OM:["AUM"],"\\_":["\\`"],"\\_H":["\\`H"],"\\'M":["\\'.m","\\'.n"],"\\_M":"\\_.m \\_.n \\`M \\`.m \\`.n".split(" "),".a":["~"],"|":["."],"||":[".."],z:["J"]}},Rt={};Ie.isRomanScheme=function(d){return _n.hasOwnProperty(d)};Ie.addBrahmicScheme=function(d,k){Ie.schemes[d]=k};Ie.addRomanScheme=function(d,k){"vowel_marks"in k||(k.vowel_marks=k.vowels.slice(1)),Ie.schemes[d]=k,_n[d]=!0};var yn=function(d){var k={};for(var N in d)!d.hasOwnProperty(N)||(k[N]=d[N].slice(0));return k};(function(){var d=zt.kolkata=yn(zt.iast),k="iast itrans hk kolkata slp1 velthuis wx".split(" ");d.vowels="a \u0101 i \u012B u \u016B \u1E5B \u1E5D \u1E37 \u1E39 e \u0113 ai o \u014D au".split(" ");for(var N=0,O;O=k[N];N++)Ie.addRomanScheme(O,zt[O]);var C=yn(zt.itrans);C.vowels="a A i I u U Ri RRI LLi LLi e E ai o O au".split(" "),C.vowel_marks=C.vowels.slice(1),Kt.itrans_dravidian=Kt.itrans,Ie.addRomanScheme("itrans_dravidian",C)})();var Dn=function(d,k){var N=Kt[d]||{},O={},C=Ie.schemes[d],b={},f=[],i={},o=Ie.schemes[k];for(var x in C)if(!!C.hasOwnProperty(x)){var w=C[x],R=o[x];if(R!==void 0)for(var q=0;q<w.length;q++){var z=w[q],B=R[q],D=N[z]||[],j=D.length,Q=0;for(f.push(z.length),Q=0;Q<j;Q++)f.push(D[Q].length);if(x==="vowel_marks"||x==="virama")for(i[z]=B,Q=0;Q<j;Q++)i[D[Q]]=B;else{for(b[z]=B,Q=0;Q<j;Q++)b[D[Q]]=B;if(x==="consonants"||x==="other")for(O[z]=B,Q=0;Q<j;Q++)O[D[Q]]=B}}}return{consonants:O,fromRoman:Ie.isRomanScheme(d),letters:b,marks:i,maxTokenLength:Math.max.apply(Math,f),toRoman:Ie.isRomanScheme(k),virama:o.virama}},In=function(d,k,N){for(var O=[],C=k.consonants,b=d.length,f=!1,i=k.letters,o=k.marks,x=k.maxTokenLength,w=N.skip_sgml,R=N.syncope,q,z,B="",D=k.toRoman,j=k.virama,Q=!1,U=!1,G=!1,ie=0,de;(de=d.charAt(ie))||B;ie++){var ve=x-B.length;if(!(ve>0&&ie<b&&(B+=de,ve>1)))for(var $=0;$<x;$++){var J=B.substr(0,x-$);if(Q===!0)Q=J!==">";else if(J==="<")Q=w;else if(J==="##"){G=!G,B=B.substr(2);break}if(U=Q||G,(q=i[J])!==void 0&&!U){D?O.push(q):(f?(z=o[J])?O.push(z):J!=="a"&&(O.push(j),O.push(q)):O.push(q),f=J in C),B=B.substr(x-$);break}else $===x-1&&(f&&(f=!1,R||O.push(j)),O.push(J),B=B.substr(1))}}return f&&!R&&O.push(j),O.join("")},Fn=function(d,k){for(var N=[],O=k.consonants,C=!1,b=!1,f=k.letters,i=k.marks,o,x=k.toRoman,w=!1,R=0,q;q=d.charAt(R);R++){if(q==="#"){C?(w=!w,C=!1):C=!0,b&&(N.push("a"),b=!1);continue}else if(w){N.push(q);continue}(o=i[q])!==void 0?(N.push(o),b=!1):(C&&(N.push("#"),C=!1),b&&(N.push("a"),b=!1),(o=f[q])?(N.push(o),b=x&&q in O):N.push(q))}return b&&N.push("a"),N.join("")};Ie.t=function(d,k,N,O){O=O||{};var C=Rt.options||{},b=Ie.defaults,f=Rt.from===k&&Rt.to===N,i;for(var o in b)if(b.hasOwnProperty(o)){var x=b[o];o in O&&(x=O[o]),O[o]=x,x!==C[o]&&(f=!1)}return f?i=Rt.map:(i=Dn(k,N),Rt={from:k,map:i,options:O,to:N}),k==="itrans"&&(d=d.replace(/\{\\m\+\}/g,".h.N"),d=d.replace(/\.h/g,""),d=d.replace(/\\([^'`_]|$)/g,"##$1##")),i.fromRoman?In(d,i,O):Fn(d,i)};const zn=function(){const d=[{name:"valapalagilaka",search:"\u1E59",replace:()=>"r"},{name:"short e",search:"\u1EBD",replace:()=>"e"},{name:"short o",search:"\xF5",replace:()=>"o"},{name:"p\u1E5B\u1E63\u1E6Dham\u0101tr\u0101 e",search:"\xEA",replace:()=>"e"},{name:"p\u1E5B\u1E63\u1E6Dham\u0101tr\u0101 o",search:"\xF4",replace:()=>"o"},{name:"p\u1E5B\u1E63\u1E6Dham\u0101tr\u0101 ai",search:"\xCA",replace:()=>"E"},{name:"p\u1E5B\u1E63\u1E6Dham\u0101tr\u0101 au",search:"\xD4",replace:()=>"O"},{name:"candrabindu",search:"m\u0310",replace:()=>"M"},{name:"o\u1E43k\u0101ras",search:"o\u1E41",replace:()=>"oM"},{name:"additional punctuation",search:"[()\\[\\],;?!|_\\-=+\\d.'\\/]+",replace:()=>""},{name:"geminated aspirated consonants",search:"(?:kK|gG|cC|jJ|wW|qQ|tT|dD|pP|bB)",replace:b=>b[0].slice(-1)},{name:"geminated m after h",search:"(?:Mhm|hmm)",replace:()=>"hm"},{name:"geminated t",search:"([rfi]|p[aA])tt|tt(?=[rvy]\\S)",replace:b=>`${b[1]}t`},{name:"geminated consonants after r",search:"([rf]\\s*)([kgcjwqdpbRnmyvl])\\2{1,2}",replace:b=>`${b[1]}${b[2]}`},{name:"final nasal variants",search:"(?:M[lSs]|nn)(?!\\S)",replace:()=>"n"},{name:"internal nasal variants",search:"[mnNYR](?=[pPbBmdDtTnwWqQcCjJkKgG])",replace:()=>"M"},{name:"final anusv\u0101ra variants",search:"M?[mN](?!\\S)|n(?=\\s+[tdn])|Y(?=\\s+[jc])",replace:()=>"M"},{name:"visarga a\u1E25 before voiced consonants",search:"(?<!\\sB)(?:a[Hr]|[o])(?=\\s+['gGjJqQdDnbBmrylvh])",replace:()=>"aH"},{name:"visarga a\u1E25 before vowels",search:"aH(?=\\s+[AiIeuUof])",replace:()=>"a"},{name:"visarga a\u1E25 before unvoiced consonants and space + anusv\u0101ra",search:"o\\s+(?=[kKcCwWtTpPszSM])",replace:()=>"aH a"},{name:"visarga \u0101\u1E25 variants",search:"AH(?=\\s+[aAiIeEuUogGjJqQdDbBnmyrlvh])",replace:()=>"A"},{name:"other visarga variants",search:"H?[rszS](?!\\S)",replace:()=>"H"},{name:"avagrahas",search:"'",replace:()=>"a"},{name:"internal visarga variants",search:"z(?=[kK])|s(?=s)",replace:()=>"H"},{name:"final au/\u0101v",search:"Av(?!\\S)",replace:()=>"O"},{name:"final su",search:"(?<=[sz])v(?=\\s+[aAiIuUoOeE])",replace:()=>"u"},{name:"final i",search:"i(?=\\s+[aAuUoOeE])",replace:()=>"y"},{name:"kcch/k\u015B",search:"k(\\s*)(?:S|c?C)",replace:b=>`k${b[1]}S`},{name:"c\u015B/t\u015B",search:"[tc](\\s*)S",replace:b=>`c${b[1]}C`},{name:"cch/ch",search:"([aAiIuUeEoO])C",replace:b=>`${b[1]}cC`},{name:"final t + hi",search:"d(\\s+)D(?=[iy](?:\\s|$))",replace:b=>`t${b[1]}h`},{name:"final t + voiced syllable",search:"d(?=(?:\\s+[aAiIeEuUoOgGdDbByrv]|\\s*$))",replace:()=>"t"},{name:"final t + n/m",search:"([ai])n(?=\\s+[nm])",replace:b=>`${b[1]}t`},{name:"final t + c/j",search:"j(?=\\s+j)|c(?=\\s+c)",replace:()=>"t"},{name:"i/y + vowel",search:"y(?=\\s+[aAuUeEoO])",replace:()=>"i"},{name:"bhd for bdh",search:"Bd",replace:()=>"bD"}],k={none:{name:"remove spaces",search:"\\s",replace:()=>""},collapse:{name:"collapse spaces",search:"\\s+",replace:()=>" "}},N=function(b,f){const i=f.join(""),o=[],x=[...i.matchAll(b.search)];let w=0,R=null;for(const q of f){const z=w+q.length;let B=q,D=0;if(R)if(R.length<=q.length)B=O(q,0,R.length,R.text),D=R.text.length-R.length,R=null;else{B=R.text.slice(0,q.length);const Q=R.text.slice(q.length);R={length:R.length-q.length,text:Q};continue}for(;x.length>0&&x[0].index<z;){const j=x.shift(),Q=j.index-w+D,U=b.replace(j);if(j.index+j[0].length<z)B=O(B,Q,j[0].length,U),D=D+U.length-j[0].length;else{const G=q.length-Q+D,ie=U.slice(0,G);B=B.slice(0,Q)+ie;const de=U.slice(G);R={length:j[0].length-G,text:de}}}o.push(B),w=z}return o},O=function(b,f,i,o){return b.slice(0,f)+o+b.slice(f+i)};return function(b){let f=b.map(i=>Ie.t(i,"iast","slp1"));for(const i of[...d,k.none])f=N(i,f);return f.map(i=>Ie.t(i,"slp1","iast"))}}(),Lt={smush:function(d,k){return d.toLowerCase().replace(/([ḍdrmvynhs]) ([aāiīuūṛeoéó])/g,"$1$2"+k).replace(/([kgcjṭḍtdpb]) h/g,"$1\u200C"+k+"h").replace(/([kgcjñḍtdnpbmrlyvśṣsṙ]) ([kgcjṭḍtdnpbmyrlvśṣshḻ])/g,"$1"+k+"$2").replace(/([oóeéā]) ([ṃ'])/g,"$1"+k+"$2").replace(/^ṃ/,"'\u200D\u1E43").replace(/^ḥ/,"'\u200D\u1E25").replace(/^_y/,"'\u200Dy").replace(/ü/g,"\u200Cu").replace(/ï/g,"\u200Ci").replace(/_{1,2}(?=\s*)/g,function(N){if(N==="__")return"\u200D";if(N==="_")return"\u200C"})},iast:function(d,k){const N=k||"devanagari";return Ie.t(d,N,"iast",{skip_sgml:!0})},devanagari:function(d,k){const N=k||"",O={skip_sgml:!0},C=d.replace(/ṙ/g,"r").replace(/^_ā/,"\u093D\u200D\u093E"),b=Lt.smush(C,N);return Ie.t(b,"iast","devanagari",O).replace(/¯/g,"\uA8FB")},malayalam:function(d,k){const N=k||"",O={skip_sgml:!0},C={\u0D15:"\u0D7F",\u0D24:"\u0D7D",\u0D28:"\u0D7B",\u0D2E:"\u0D54",\u0D30:"\u0D7C"},b=d.replace(/^_ā/,"\u0D3D\u200D\u0D3E"),f=Lt.smush(b,N).replace(/e/g,"\u1EBD").replace(/o/g,"\xF5").replace(/ṙ/g,"r").replace(/ṁ/g,"\u1E43").replace(/ḿ/g,"\u1E43").replace(/í/g,"i").replace(/ú/g,"u").replace(/é/g,"e");return Ie.t(f,"iast","malayalam",O).replace(/(^|[^്])ര്(?=\S)/g,"$1\u0D4E").replace(/([കതനമര])്(?![^\s\u200C,—’―])/g,function(o,x){return C[x]})},grantha:function(d,k){const N=k||"",O={skip_sgml:!0},C=new Map([["\u0D38","\uE1D3"],["\u0D30","\u0D7C"],["\u0D2F","\uE1CB"],["\u0D1A","\uE1B6"],["\u0D26","\uE1C2"],["\u0D36","\uE1D2"]]),b=new RegExp("(["+[...C.keys()].join("")+"])\u0D4D(?![^\u200C ,\u2014\u2019\u2015])","g"),f=d.replace(/^_ā/,"\u0D3D\u200D\u0D3E"),i=Lt.smush(f,N).replace(/e/g,"\u1EBD").replace(/o/g,"\xF5").replace(/ṙ/g,"r").replace(/ṁ/g,"\u1E43").replace(/ḿ/g,"\u1E43").replace(/í/g,"i").replace(/ú/g,"u").replace(/é/g,"e");return Ie.t(i,"iast","malayalam",O).replace(/(^|[^്])ര്(?=\S)/g,"$1\u0D4E").replace(b,(x,w)=>C.get(w)).replace(/ക്ഷി/g,"\u0B95\u0BCD\u0BB7\u0BBF")},telugu:function(d,k){var N=k||"";const O={skip_sgml:!0},C=d.replace(/^_ā/,"\u0C3D\u200D\u0C3E"),b=Lt.smush(C,N).replace(/e/g,"\u1EBD").replace(/o/g,"\xF5").replace(/ṙ/g,"r\u200D").replace(/ṁ/g,"\u1E43").replace(/ḿ/g,"\u1E43").replace(/í/g,"i").replace(/ú/g,"u").replace(/é/g,"e");return Ie.t(b,"iast","telugu",O)}},Jt=function(d,k,N=!1,O="sa"){const C=Lt[k],b=d.cloneNode(!0),f=function(i,o){let x=i.childNodes;for(let w of x)if(w.nodeType!==8){if(w.nodeType===3){if(o!=="sa")continue;w.data=C(w.data,N)}else if(w.hasChildNodes()){let R=w.getAttribute("lang")||o;R==="sa"&&w.classList.contains("subst")&&qn(w,k),f(w,R)}}};return f(b,O),b},bn=function(d,k=!1){if(d.nodeType===3)return d;const N=document.createTreeWalker(d,NodeFilter.SHOW_TEXT,null,!1);if(k){let O;for(;N.nextNode();)O=N.currentNode;return O}else return N.nextNode},qn=function(d,k){if(d.firstChild.nodeType!==3&&d.lastChild.nodeType!==3)return;const N=d.childNodes,O=/^[aāiīuūeoṛṝḷṃḥ]/,C=/[kgṅcjñṭḍṇtdnpbmyrlvṣśsh]$/,b=["\u0101","i","\u012B","e","o","_","ai","au"],f=["h","k","\u015B","y","g","gh","c","ch","jh","\u1E6Dh","\u1E0D","\u1E0Dh","t","th","d","dh","n","p","ph","bh","m","r","\u1E3B","v","\u1E63","s"];var i=!1,o=[],x=[];const w=N[0].nodeType===3;for(let R of N){if(R.nodeType>3)continue;const q=R.textContent.trim();if(q!==""){if(q==="a"){R.textContent="";continue}if(q.match(C)){const z=bn(R,!0);z.textContent=z.textContent.replace(/\s+$/,"")+"a",k==="telugu"&&f.indexOf(q)>=0&&o.push(R)}if(R===d.lastChild&&R.nodeType===3){const z=document.createElement("span");z.appendChild(R.cloneNode(!1)),d.replaceChild(z,R),R=z,R.classList.add("aalt")}else w&&q.match(O)&&R.classList.add("aalt");switch(k){case"devanagari":(q==="i"||q==="\xE9")&&x.unshift(R);break;case"grantha":case"malayalam":if(q==="e"||q==="ai")x.unshift(R);else if(q==="o"){const z=R.cloneNode(!0);wn("o","e",z),x.unshift(z),wn("o","\u0101",R)}break;case"telugu":!i&&b.indexOf(q)>=0&&(i=!0);break}}}for(const R of x)d.insertBefore(R,d.firstChild);if(i)for(const R of o){const q=bn(R,!0);q.textContent=q.textContent+"\u200D\u0C4D"}},wn=function(d,k,N){const O=document.createTreeWalker(N,NodeFilter.SHOW_TEXT,null,!1);for(;O.nextNode();)O.currentNode.textContent.match(d)&&(O.currentNode.textContent=k)},On=`<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
        xmlns:x="http://www.tei-c.org/ns/1.0"
        exclude-result-prefixes="x">
<xsl:output method="text" omit-xml-declaration="yes"/>
    <xsl:strip-space elements="*"/>
    <xsl:template match="/">
        <xsl:apply-templates/>
    </xsl:template>
    <xsl:template match="para[content-style][not(text())]">
        <xsl:value-of select="normalize-space(.)"/>
    </xsl:template>
    <xsl:template match="x:teiCorpus">
        <xsl:apply-templates/>
    </xsl:template>
    <xsl:template match="x:TEI">
        <xsl:value-of select="@n"/><xsl:text>,</xsl:text>
        <xsl:apply-templates/>
        <xsl:text>&#xa;</xsl:text>
    </xsl:template>
    <xsl:template match="x:text">
        <xsl:apply-templates/>
    </xsl:template>
    <xsl:template match="x:w">
        <xsl:text>"</xsl:text><xsl:apply-templates/><xsl:text>"</xsl:text>
        <!--xsl:if test="not(position() = last())"-->
            <xsl:text>,</xsl:text>
        <!--/xsl:if-->
    </xsl:template>
    <!--xsl:template match="node()|@*">
        <xsl:copy>
            <xsl:apply-templates select="node()|@*"/>
        </xsl:copy>
    </xsl:template-->
</xsl:stylesheet>
`,Hn=`<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
        xmlns:x="http://www.tei-c.org/ns/1.0"
        exclude-result-prefixes="x">
    <xsl:output indent="yes"/>
    <xsl:template match="x:span">
        <xsl:apply-templates/>
    </xsl:template>
    <xsl:template match="para[content-style][not(text())]">
        <xsl:value-of select="normalize-space(.)"/>
    </xsl:template>
    <xsl:template match="x:teiHeader">
        <xsl:text>&#10;&#32;&#32;&#32;&#32;</xsl:text>
            <xsl:copy><xsl:apply-templates select="node()|@*"/></xsl:copy>
    </xsl:template>
    <xsl:template match="x:xenoData">
        <xsl:text>&#10;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;</xsl:text>
            <xsl:copy><xsl:apply-templates select="node()|@*"/></xsl:copy>
        <xsl:text>&#10;&#32;&#32;&#32;&#32;</xsl:text>
    </xsl:template>
    <xsl:template match="x:TEI">
        <xsl:text>&#10;&#32;&#32;&#32;&#32;</xsl:text>
            <xsl:copy><xsl:apply-templates select="node()|@*"/></xsl:copy>
    </xsl:template>
    <xsl:template match="x:text">
        <xsl:text>&#10;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;</xsl:text>
            <xsl:copy><xsl:apply-templates select="node()|@*"/></xsl:copy>
        <xsl:text>&#10;&#32;&#32;&#32;&#32;</xsl:text>
    </xsl:template>
    <xsl:template match="x:w">
        <xsl:copy><xsl:apply-templates select="node()|@*"/></xsl:copy>
        <!--xsl:if test="not(position() = last())">
            <xsl:text>&#32;</xsl:text>
        </xsl:if-->
    </xsl:template>
    <xsl:template match="node()|@*">
        <xsl:copy>
            <xsl:apply-templates select="node()|@*"/>
        </xsl:copy>
    </xsl:template>
</xsl:stylesheet>
`,$n=`<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform" 
                xmlns:x="http://www.tei-c.org/ns/1.0"
                exclude-result-prefixes="x">
<xsl:output method="html"/>
<xsl:template match="x:teiCorpus">
    <xsl:element name="table">
        <xsl:apply-templates/>
    </xsl:element>
</xsl:template>
<xsl:template match="x:TEI">
    <xsl:apply-templates/>
</xsl:template>
<xsl:template match="x:text">
    <xsl:element name="tr">
        <xsl:attribute name="data-n"><xsl:value-of select="../@n"/></xsl:attribute>
        <xsl:if test="../@corresp">
            <xsl:attribute name="data-treename"><xsl:value-of select="../@corresp"/></xsl:attribute>
            <xsl:attribute name="data-nodename"><xsl:value-of select="../@select"/></xsl:attribute>
        </xsl:if>
        <xsl:element name="th">
            <xsl:attribute name="scope">row</xsl:attribute>
            <xsl:attribute name="draggable">true</xsl:attribute>
            <xsl:value-of select="../@n"/>
        </xsl:element>
        <xsl:apply-templates/>
    </xsl:element>
</xsl:template>
<xsl:template match="x:w">
    <xsl:element name="td">
        <xsl:choose>
            <xsl:when test="parent::x:cl">
                <xsl:choose>
                    <xsl:when test="position() = '1'">
                        <xsl:attribute name="class">lemma group-start</xsl:attribute>
                    </xsl:when>
                    <xsl:when test="position() = last()">
                        <xsl:attribute name="class">lemma group-end</xsl:attribute>
                    </xsl:when>
                    <xsl:otherwise>
                        <xsl:attribute name="class">lemma group-internal</xsl:attribute>
                    </xsl:otherwise>
                </xsl:choose>
            </xsl:when>
            <xsl:otherwise>
                <xsl:attribute name="class">lemma</xsl:attribute>
            </xsl:otherwise>
        </xsl:choose>
        <xsl:if test="@lemma">
            <xsl:attribute name="data-normal"><xsl:value-of select="@lemma"/></xsl:attribute>
        </xsl:if>
        <xsl:if test="@emended">
            <xsl:attribute name="data-emended">true</xsl:attribute>
        </xsl:if>
        <xsl:attribute name="data-n">
            <xsl:value-of select="@n"/>
        </xsl:attribute>
        <xsl:if test="@insignificant='true'">
            <xsl:attribute name="data-insignificant">true</xsl:attribute>
        </xsl:if>
        <xsl:if test="@binary='true'">
            <xsl:attribute name="data-binary">true</xsl:attribute>
        </xsl:if>
        <xsl:apply-templates/>
    </xsl:element>
</xsl:template>
</xsl:stylesheet>
`,Vn=`<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform" 
                xmlns:x="http://www.w3.org/1999/xhtml"
                exclude-result-prefixes="x">
<xsl:output method="html" omit-xml-declaration="yes"/>

<xsl:template match="x:pb">
    <xsl:element name="hr">
        <xsl:attribute name="data-n"><xsl:value-of select="@n"/></xsl:attribute>
    </xsl:element>
    <xsl:element name="img">
        <xsl:attribute name="class">editbutton</xsl:attribute>
        <xsl:attribute name="data-n"><xsl:value-of select="@n"/></xsl:attribute>
        <xsl:attribute name="src">edit_icon.svg</xsl:attribute>
    </xsl:element>
    <h3 class="pb" lang="en"><xsl:value-of select="@n"/></h3>
</xsl:template>

<xsl:template match="x:lb">
<br />
<span class="lb" lang="en"><xsl:value-of select="@n"/></span>
</xsl:template>

<xsl:template match="x:fw">
<div class="fw">(<i lang="en"><xsl:value-of select="@type"/>, <xsl:value-of select="@place"/></i>): <xsl:apply-templates/></div>
</xsl:template>

<xsl:template match="x:div[@type='story']">
    <span class="story" lang="en">(story no. <xsl:value-of select="@num"/>, <xsl:value-of select="@city"/>, <xsl:value-of select="@king"/>)</span>
    <xsl:apply-templates/>
</xsl:template>

<xsl:template match="x:div[@type='verse']">
    <span class="verse"><xsl:apply-templates /></span>
</xsl:template>

<xsl:template match="x:del">
    <xsl:variable name="rend" select="@rend"/>
    <xsl:element name="del">
        <xsl:attribute name="data-title">
            <xsl:text>deleted</xsl:text>
            <xsl:if test="string($rend)">
                <xsl:text> (</xsl:text>
                <xsl:value-of select="$rend"/>
                <xsl:text>)</xsl:text>
           </xsl:if>
        </xsl:attribute>
        <xsl:apply-templates/>
    </xsl:element>
</xsl:template>

<xsl:template match="x:add">
    <xsl:variable name="place" select="@place"/>
    <xsl:variable name="rend" select="@rend"/>
    <xsl:element name="ins">
        <xsl:attribute name="data-title">
            <xsl:text>added</xsl:text>
            <xsl:if test="string($rend) or string($place)">
                <xsl:text> (</xsl:text>
                <xsl:value-of select="$rend"/>
                <xsl:if test="string($rend) and string($place)">
                    <xsl:text>, </xsl:text>
                </xsl:if>
                <xsl:value-of select="$place"/>
                <xsl:text>)</xsl:text>
            </xsl:if>
        </xsl:attribute>
        <xsl:apply-templates/>
    </xsl:element>
</xsl:template>

<xsl:template match="x:subst">
    <span class="subst"><xsl:apply-templates /></span>
</xsl:template>

<xsl:template match="x:g">
    <xsl:element name="span">
        <xsl:attribute name="data-title"><xsl:value-of select="@rend"/></xsl:attribute>
        <xsl:attribute name="class">gaiji</xsl:attribute>
        <xsl:apply-templates/>
    </xsl:element>
</xsl:template>

<xsl:template match="x:lg">
  <xsl:element name="span">
    <xsl:attribute name="class">tree-verse</xsl:attribute>
    <xsl:attribute name="lang">en</xsl:attribute>
    <xsl:text>[verse </xsl:text>
    <xsl:value-of select="@n"/>
    <xsl:text>]</xsl:text>
  </xsl:element>
</xsl:template>

<xsl:template match="x:l">
  <xsl:element name="span">
    <xsl:attribute name="class">l</xsl:attribute>
    <xsl:apply-templates/>
  </xsl:element>
</xsl:template>
</xsl:stylesheet>
`,Un=`<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform" 
                xmlns:x="http://www.tei-c.org/ns/1.0"
                exclude-result-prefixes="x">
<xsl:output method="html"/>
<xsl:template match="x:w">
    <xsl:element name="span">
        <xsl:attribute name="data-n"><xsl:value-of select="@n"/></xsl:attribute>
        <xsl:if test="@lemma">
            <xsl:attribute name="data-normal"><xsl:value-of select="@lemma"/></xsl:attribute>
        </xsl:if>
        <xsl:if test="@emended">
            <xsl:attribute name="data-emended"><xsl:value-of select="@emended"/></xsl:attribute>
        </xsl:if>
       <xsl:choose>
           <xsl:when test="not(normalize-space(.))">
                <xsl:attribute name="class">lemma invisible</xsl:attribute>
                <xsl:text>&#x00A0;</xsl:text>
            </xsl:when>
            <xsl:otherwise>
                <xsl:attribute name="class">lemma</xsl:attribute>
            </xsl:otherwise>
        </xsl:choose>
        <xsl:apply-templates/>
    </xsl:element>
    <xsl:text>&#173;</xsl:text>
</xsl:template>
<xsl:template match="x:cl">
    <xsl:element name="span">
        <xsl:attribute name="class">group</xsl:attribute>
        <xsl:apply-templates/>
    </xsl:element>
</xsl:template>
<xsl:template match="x:pb">
    <xsl:element name="hr">
        <xsl:attribute name="data-n"><xsl:value-of select="@n"/></xsl:attribute>
    </xsl:element>
    <xsl:element name="img">
        <xsl:attribute name="class">editbutton</xsl:attribute>
        <xsl:attribute name="data-n"><xsl:value-of select="@n"/></xsl:attribute>
        <xsl:attribute name="src">edit_icon.svg</xsl:attribute>
    </xsl:element>
    <h3 class="pb" lang="en"><xsl:value-of select="@n"/></h3>
</xsl:template>

<xsl:template match="x:lb">
<br />
<span class="lb" lang="en"><xsl:value-of select="@n"/></span>
</xsl:template>

<xsl:template match="x:fw">
<div class="fw">(<i lang="en"><xsl:value-of select="@type"/>, <xsl:value-of select="@place"/></i>): <xsl:apply-templates/></div>
</xsl:template>

<xsl:template match="x:div[@type='story']">
    <span class="story" lang="en">(story no. <xsl:value-of select="@num"/>, <xsl:value-of select="@city"/>, <xsl:value-of select="@king"/>)</span>
    <xsl:apply-templates/>
</xsl:template>

<xsl:template match="x:div[@type='verse']">
    <span class="verse"><xsl:apply-templates /></span>
</xsl:template>

<xsl:template match="x:del">
    <xsl:variable name="rend" select="@rend"/>
    <xsl:element name="del">
        <xsl:attribute name="data-title">
            <xsl:text>deleted</xsl:text>
            <xsl:if test="string($rend)">
                <xsl:text> (</xsl:text>
                <xsl:value-of select="$rend"/>
                <xsl:text>)</xsl:text>
           </xsl:if>
        </xsl:attribute>
        <xsl:apply-templates/>
    </xsl:element>
</xsl:template>

<xsl:template match="x:add">
    <xsl:variable name="place" select="@place"/>
    <xsl:variable name="rend" select="@rend"/>
    <xsl:element name="ins">
        <xsl:attribute name="data-title">
            <xsl:text>added</xsl:text>
            <xsl:if test="string($rend) or string($place)">
                <xsl:text> (</xsl:text>
                <xsl:value-of select="$rend"/>
                <xsl:if test="string($rend) and string($place)">
                    <xsl:text>, </xsl:text>
                </xsl:if>
                <xsl:value-of select="$place"/>
                <xsl:text>)</xsl:text>
            </xsl:if>
        </xsl:attribute>
        <xsl:apply-templates/>
    </xsl:element>
</xsl:template>

<xsl:template match="x:subst">
    <span class="subst"><xsl:apply-templates /></span>
</xsl:template>

<xsl:template match="x:g">
    <xsl:element name="span">
        <xsl:attribute name="data-title"><xsl:value-of select="@rend"/></xsl:attribute>
        <xsl:attribute name="class">gaiji</xsl:attribute>
        <xsl:apply-templates/>
    </xsl:element>
</xsl:template>

<xsl:template match="x:lg">
  <xsl:element name="span">
    <xsl:attribute name="class">lg</xsl:attribute>
    <xsl:apply-templates/>
  </xsl:element>
</xsl:template>

<xsl:template match="x:l">
  <xsl:element name="span">
    <xsl:attribute name="class">l</xsl:attribute>
    <xsl:apply-templates/>
  </xsl:element>
</xsl:template>
</xsl:stylesheet>
`,Gn=`<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform" 
                xmlns:x="http://www.w3.org/1999/xhtml"
                exclude-result-prefixes="x">
<xsl:output method="text" omit-xml-declaration="yes"/>
<xsl:template match="x:lg">
<xsl:value-of select="@n"/>
</xsl:template>
</xsl:stylesheet>
`,bt=function(d){const N=new DOMParser().parseFromString(d,"text/xml"),O=new XSLTProcessor;return O.importStylesheet(N),O},jn=function(d){this.transformString=function(k,N){const O=d.xml.createElementNS(d.teins,"ab");return O.innerHTML=k,N.transformToFragment(O,document)},this.sheets={csv:bt(On),xml:bt(Hn),matrix:bt($n),lemma:bt(Un),lg:bt(Gn),tree:bt(Vn)}},Xn=function(d){const k={curxml(){return d.xml},teins(){return d.teins},basename(){return d.filename.split(/\.[^.]+$/)[0]},range(C,b){return Array.from(Array(parseInt(b)-parseInt(C)+1).keys(),f=>f+C)},maxlemma(){return[...k.firsttext().querySelectorAll("w[n]")].length-1},lemmata(C,b){const f=b||document.querySelector("#views");return C===!1?f.querySelectorAll(".lemma"):f.querySelectorAll(`.lemma[data-n="${C}"]`)},tds(C,b){const f=b||d.matrix.boxdiv;return C===!1?f.querySelectorAll("td[data-n]"):f.querySelectorAll(`td[data-n="${C}"]`)},firsttd(C,b){return(b||d.matrix.boxdiv).querySelector(`td[data-n="${C}"]`)},tr(C){return d.matrix.boxdiv.querySelector(`tr[data-n="${C}"]`)},trs(C){return(C||d.matrix.boxdiv).querySelectorAll("tr[data-n]")},firsttr(C){return(C||d.matrix.boxdiv).querySelector("tr[data-n]")},lasttr(C){return(C||d.matrix.boxdiv).querySelector("tr[data-n]:last-of-type")},trWalker(C){return document.createNodeIterator(C,NodeFilter.SHOW_ELEMENT,{acceptNode:function(b){if(b.tagName==="TD")return NodeFilter.FILTER_ACCEPT}},!1)},textWalker(C){return document.createNodeIterator(C,NodeFilter.SHOW_ELEMENT,{acceptNode:function(b){if(b.tagName.toLowerCase()==="w")return NodeFilter.FILTER_ACCEPT}},!1)},tei(C,b=d.xml){return b.querySelector(`TEI[n="${C}"]`)},teis(C=d.xml){return C.querySelectorAll("TEI")},texts(C){return(C||d.xml).querySelectorAll("text")},serializedtexts(C,b){const f=[...C.querySelectorAll("otu[label]")].map(o=>o.getAttribute("label"));return[...k.teis()].filter(o=>f.indexOf(o.getAttribute("n"))!==-1).map(o=>[C.querySelector(`node[label="${o.getAttribute("n")}"]`).getAttribute("id"),[...o.querySelectorAll("w")].map(x=>b&&x.hasAttribute("lemma")?x.getAttribute("lemma"):x.textContent)])},serializedlevels(C){return C.map(b=>{if(b instanceof Map){const f=new Map;for(const[i,o]of b)f.set(i.getAttribute("id"),o.map(x=>x.getAttribute("id")));return f}else return b.map(f=>f.getAttribute("id"))})},firsttext(C){return C?d.xml.querySelector(`[n="${C}"] text`):d.xml.querySelector("text")},words(C,b){const f=b||d.xml;return C===!1?f.querySelectorAll("w[n]"):f.querySelectorAll(`w[n="${C}"]`)},firstword(C,b){return(b||d.xml).querySelector(`w[n="${C}"]`)},normal(C){return(C||document.getElementById("views")).querySelectorAll(".lemma[data-normal], .tree-lemma[data-normal]")},htmlreading(C,b){return b&&C.dataset.normal?C.dataset.normal:C.IAST.textContent},ths(){return d.matrix.boxdiv.querySelectorAll("th[data-ref]")},firstth(C){return d.matrix.boxdiv.querySelector(`th[data-ref="${C}"]`)},checkbox(C,b){return d.matrix.boxdiv.querySelector(`th[data-ref="${C}"] input.${b}`)},highlit(){const b=k.firsttr().querySelectorAll(".highlit"),f=new Set;for(const i of b)f.add(i.dataset.n);return f},highlitcell(){return d.matrix.boxdiv.querySelector("td.highlitcell")},highlitrow(){const C=k.highlitcell();return C?C.closest("tr"):!1},lowhigh(C){const b=[...C].sort((o,x)=>parseInt(o)-parseInt(x)),f=parseInt(b[0]),i=b.length>1?parseInt(b[b.length-1]):void 0;return[f,i]},readings(C,b){const f=b||d.matrix.boxdiv,i=k.tds(C,f);var o=0;const x=new Set;for(const w of i){const R=w.textContent;R!==""&&(o++,x.add(R))}return[o,x.size]},attr(C,b){const f=k.firsttr();var i=[];for(const o of b)k.firsttd(o,f).dataset[C]==="true"?i.push([o,!0]):i.push([o,!1]);return new Map(i)},whichattr(C){return C.hasAttribute("n")?"n":C.hasAttribute("data-n")?"data-n":C.hasAttribute("data-ref")?"data-ref":!1},clauses(C,b=!1){const f=k.firsttext();var i=!1;const o=new Set;for(const w of C){const q=k.firstword(w,f).closest("cl");q?o.add(q):b&&(i=!0)}if(o.size===0)return!1;const x=[...o].map(w=>{const R=w.querySelectorAll("w");return new Set([...R].map(q=>q.getAttribute("n")))});return i?[null].concat(x):x},clausesToRemove(C,b,f=0){const i=new Set;for(const o of C){const x=new Set(o);for(const w of b)x.delete(w);x.size<=f&&i.add(o)}return[...i]},empty(){const C=new Set,b=[...k.trs()],f=b.map(x=>k.trWalker(x)),i=b[0].querySelector("td:last-of-type").dataset.n;for(let x=0;x<=i;x++){var o=!0;for(const w of f){const R=w.nextNode();o&&R.textContent!==""&&(o=!1)}o&&C.add(x)}return C},emptyRows(C=!1){const b=k.trs(),f=new Set;for(let i=0;i<b.length;i++){const o=k.tds(!1,b[i]);(()=>{for(const w of o)if(w.textContent!=="")return!1;return!0})()&&(C?f.add(b[i].dataset.n):f.add(i))}return f},prevNonempty(C,b){for(let f=C;f>=0;f--)if(b[f].textContent!=="")return f;return!1},nextNonempty(C,b){for(let f=C;f<b.length;f++)if(b[f].textContent!=="")return f;return!1},cursorPos(C){const b=window.getSelection().getRangeAt(0),f=b.cloneRange();f.selectNodeContents(C);const i=f.toString().length;return f.setEnd(b.endContainer,b.endOffset),[f.toString().length,i]},selection(){const C=window.getSelection();if(C.isCollapsed)return!1;const b=C.rangeCount>1?C.getRangeAt(1).cloneContents():C.getRangeAt(0).cloneContents();if(!b)return!1;const f=new Set,i=b.querySelectorAll(".lemma");for(const o of i)f.add(o.dataset.n);return f}},N={undo(){return d.undo.length>0},redo(){return d.redo.length>0},checkbox(C,b=null){if(!N.anyhighlit())return!1;const f=b===null?k.highlit():b,i=k.attr(C,f);for(const o of i.values())if(o===!1)return!1;return!0},grouped(){const C=k.highlit();if(!C)return!1;const b=k.firsttr();for(const f of C){const i=k.firsttd(f,b);if(i.classList.contains("group-start")||i.classList.contains("group-internal")||i.classList.contains("group-end"))return!0}return!1},oneGrouped(){const C=k.highlit();if(C.size===0)return!1;if(C.size===1){const b=k.firsttr(),f=k.firsttd([...C][0],b);return!!(f.classList.contains("group-start")||f.classList.contains("group-end")||f.classList.contains("group-internal"))}return!0},anyhighlit(){return!!d.matrix.boxdiv.querySelector("td.highlit")},manyhighlit(){return k.highlit().size>1},highlitcell(){return!!d.matrix.boxdiv.querySelector("td.highlitcell")},normalizedView(){return document.getElementById("views").classList.contains("normalized")},anyNormalized(){return d.matrix.boxdiv.querySelector(".lemma[data-normal]")},headerView(){return d.matrix.boxdiv.querySelector("tr.header").style.display!=="none"}},O={tei:function(C){const b=d.xml.createElementNS(d.teins,"TEI");b.setAttribute("n",C);const f=k.firsttext().cloneNode(!0);b.appendChild(f);for(const i of k.words(!1,f))for(i.removeAttribute("lemma");i.firstChild;)i.firstChild.remove();return b},xmlel:function(C,b=d.xml){return b.createElementNS(d.teins,C)},emptycell:function(C){const b=document.createElement("td");return b.className="lemma",b.dataset.n=C,b},emptyword:function(C,b=d.xml){const f=b.createElementNS(d.teins,"w");return f.setAttribute("n",C),f},emptywords:function(C,b,f){const i=b||d.maxlemma,o=f||0;for(let x=o;x<=i;x++){const w=O.emptyword(x);C.appendChild(w)}},row:function(C,b){const f=document.createElement("tr"),i=document.createElement("th");i.scope="row",i.draggable=!0,i.appendChild(document.createTextNode(C)),f.dataset.n=C,f.appendChild(i);const o=k.firsttr();for(const x of o.querySelectorAll("td")){const w=document.createElement("td");w.dataset.n=x.dataset.n,w.className=x.className,b&&w.classList.add(b),f.appendChild(w)}return f},blackout(C,b){const f=document.createElement("div");f.id="blackout",f.appendChild(C),document.body.appendChild(f);const i=function(w){b(w),f.parentNode.removeChild(f)},o=function(w){if(!w.target.closest(".popup")){const q=document.querySelector("#blackout");q.parentNode.removeChild(q)}};f.querySelector("button").addEventListener("click",i),f.addEventListener("click",o)}};return{find:k,check:N,make:O}},Wn=function(d,k){const N={Intersection:function(...i){const o=i[0];return new Set([...o].filter(x=>{for(let w=1;w<i.length;w++)if(!i[w].has(x))return!1;return!0}))},Union:function(...i){return new Set(i.reduce((o,x)=>(o=[...o,...x],o),[]))}},O=function(i){const o=new Map;for(const x of k[0]){const w=d.get(x),R=w!==void 0?[w]:[];o.set(x,new Set(R))}for(let x=1;x<k.length;x++)for(const[w,R]of k[x]){const q=R.map(D=>o.get(D)),z=N.Intersection(...q);if(i&&w===i&&z.size===1)return[...z][0];const B=z.size>0?z:N.Union(...q);o.set(w,B)}return o},C=function(i,o){const x=k[0],w=new Map;for(const R of k[k.length-1])w.set(R[0],i.get(R[0]));for(let R=k.length-1;R>1;R--)for(const[q,z]of k[R]){const B=w.get(q);for(const D of z){if(x.indexOf(D)!==-1)continue;const j=i.get(D),Q=(()=>{if(j.size===1)return j;const U=N.Intersection(B,j);return U.size>0?U:j})();if(o&&D===o)return Q;w.set(D,Q)}}return o?w.get(o):w},b=function(i=null){const o=O(i);if(typeof o=="string")return o;const x=C(o,i);return i?f(x):new Map(Array.from(x,([w,R])=>[w,f(R,!0)]))},f=function(i,o=!1){if(!o&&i.size===1)return[...i][0].trim();const x=[...i].map(w=>w.trim()===""?"_":w);return x.length===1?x[0]:"{"+x.join(", ")+"}"};return{run:b}},Yn=function(d,k){const N=d.find,O=d.make,C=N.teins(),b={write:async function(f,i){const o=await i.createWritable();o.write(f),o.close()},xml:async function(f){const i=new XMLSerializer().serializeToString(k.sheets.xml.transformToDocument(f)),o=new Blob([i],{type:"text/xml;charset=utf-8"}),x=N.basename()+".xml",w=await Yt({_preferPolyfill:!1,suggestedName:x,types:[{description:"TEI XML",accept:{"text/xml":[".xml"]}}]});b.write(o,w)},csv:async function(f){const i=k.sheets.csv.transformToDocument(f).documentElement.textContent,o=new Blob([i],{type:"text/csv;charset=utf-8"}),x=N.basename()+".csv",w=await Yt({_preferPolyfill:!1,suggestedName:x,types:[{description:"CSV file",accept:{"text/csv":[".csv"]}}]});b.write(o,w)},nexus:async function(f){const i=[...N.texts(f)],o=i.length,x="0 1 2 3 4 5 6 7 8 9 A B C D E F G H K L M N P Q R S T U V W X Y Z a b c d e f g h k l m n p q r s t u v w x y z",[w,...R]=x.split(" "),q="-",z=i.map(J=>"'"+J.parentElement.getAttribute("n")+"'"),B=i.map(J=>N.textWalker(J)),D=i[0].querySelectorAll("w").length,j=[],Q=z.map(J=>[J+" "]);for(let J=0;J<D;J++){const X=new Set,I=[];for(let re=0;re<B.length;re++){const xe=B[re].nextNode(),Y=Ie.t(xe.textContent.trim().toLowerCase(),"iast","hk").replace(/'/g,"()");I.push(Y),Y!==""&&Y!=="[]"&&X.add(Y)}j.push(["[]",...X]);const ae=new Map([...X].map((re,ge)=>[re,R[ge]]));for(let re=0;re<I.length;re++){const ge=(xe=>{switch(I[xe]){case"":return q;case"[]":return w;default:return ae.get(I[xe])}})(re);Q[re].push(ge)}}const U=j.map((J,X)=>X+1+" / "+[...J].map(I=>`'${I}'`).join(" ")).join(`,
`),G=Q.map(J=>J.join("")).map(J=>J.replace(/0{8,}/g,X=>X.replace(/0/g,"-"))).reduce((J,X)=>J+`
`+X),ie=`#NEXUS

BEGIN TAXA;
  DIMENSIONS NTAX=${o};
  TAXLABELS ${z.join(" ")};
END;

BEGIN CHARACTERS;
  DIMENSIONS
    NCHAR=${D};
  FORMAT 
    DATATYPE=STANDARD 
    RESPECTCASE 
    GAP=${q} 
    MISSING=? 
    SYMBOLS="${x}";
  CHARSTATELABELS
${U}
;
MATRIX
${G}
;
END;
`,de=new Blob([ie],{type:"text/nexus;charset=iso8859-1"}),ve=N.basename()+".nex",$=await Yt({_preferPolyfill:!1,suggestedName:ve,types:[{description:"NEXUS file",accept:{"text/nexus":[".nex"]}}]});b.write(de,$)},processOptions:function(f){const i=N.curxml().cloneNode(!0);if(f.get("option_normalize")){const o=i.querySelectorAll("w[lemma]");for(const x of o)x.textContent=x.getAttribute("lemma")}if(f.get("option_mergegroups")){const o=i.querySelectorAll("cl");for(const x of o){const w=x.removeChild(x.firstChild);for(;x.firstChild;){const R=w.getAttribute("lemma")||w.textContent,q=x.firstChild.getAttribute("lemma")||x.firstChild.textContent;for(w.setAttribute("lemma",R+q);x.firstChild.firstChild;)w.appendChild(x.firstChild.firstChild);x.firstChild.remove()}w.getAttribute("lemma")===w.textContent&&w.removeAttribute("lemma"),x.parentNode.insertBefore(w,x),x.parentNode.removeChild(x)}}if(f.get("option_insignificant")){const o=i.querySelectorAll('w[insignificant="true"]');for(const x of o)x.parentNode.removeChild(x)}if(f.get("option_binary")){const x=[...N.firsttext().querySelectorAll('w[binary="true"]')].map(w=>w.getAttribute("n"));for(const w of x){const R=i.querySelectorAll(`w[n="${w}"]:not(:empty)`);if(R.length===0)continue;const q=`[${R[0].textContent}]`;for(const z of R)z.textContent=q}}if(f.get("option_noempty")){const o=i.querySelectorAll("w:empty");for(const x of o)x.textContent="[]"}return f.get("option_basetext")?b.makeApp(f,i):i},makeHeader(f,i){const o=f.createElementNS(C,"teiHeader"),x=f.createElementNS(C,"fileDesc"),w=f.createElementNS(C,"sourceDesc"),R=f.createElementNS(C,"msDesc"),q=f.createElementNS(C,"msIdentifier"),z=f.createElementNS(C,"abbr");z.setAttribute("type","siglum"),z.append(f.documentElement.getAttribute("n")),q.appendChild(z),R.appendChild(q),w.appendChild(R);const B=f.createElementNS(C,"listWit");for(const D of N.teis(i)){const j=D.getAttribute("n"),Q=f.createElementNS(C,"witness");Q.setAttribute("xml:id",j);const U=f.createElementNS(C,"abbr");U.setAttribute("type","siglum"),U.append(j),Q.appendChild(U),B.appendChild(Q)}return w.appendChild(B),x.appendChild(w),o.appendChild(x),o},makeApp(f,i){const o=f.get("option_basetext"),x=N.tei(o,i),w=f.get("option_app_normalize"),R=document.implementation.createDocument(C,"",null);R.appendChild(x);const q=R.createElementNS(C,"body"),z=R.createElementNS(C,"p"),B=x.querySelector("text");for(;B.firstChild;)z.appendChild(B.firstChild);q.appendChild(z),B.appendChild(q);const D=b.makeHeader(R,i);x.insertBefore(D,x.firstChild);const j=R.documentElement.getAttribute("n"),Q=N.words(!1,x);for(const U of Q){const G=U.getAttribute("n"),ie=w&&U.getAttribute("lemma")||U.textContent,de=[j],ve=new Map,$=N.words(G,i);for(const J of $){const X=J.closest("TEI").getAttribute("n");if(w&&J.getAttribute("lemma")===ie)de.push(X);else if(J.textContent===ie)de.push(X);else{const I=J.textContent===""?"[om.]":J.textContent,ae=ve.get(I)||[];ae.push(X),ve.set(I,ae)}}if(ve.size===0)for(;U.firstChild;)U.parentElement.insertBefore(U.firstChild,U);else{const J=R.createElementNS(C,"app");J.setAttribute("n",G);const X=R.createElementNS(C,"lem"),I=de.map(ae=>`#${ae}`).join(" ");for(I!==""&&X.setAttribute("wit",I);U.firstChild;)X.appendChild(U.firstChild);J.appendChild(X);for(const[ae,re]of ve){const ge=R.createElementNS(C,"rdg"),xe=re.map(Y=>`#${Y}`).join(" ");ge.setAttribute("wit",xe),ge.append(ae),J.appendChild(ge)}U.parentElement.insertBefore(J,U),X.textContent.match(/\s$/)&&(U.parentElement.insertBefore(R.createTextNode(" "),U),X.textContent=X.textContent.trimEnd())}U.remove()}return R},options(){return document.createRange().createContextualFragment(`<div id="exportoptions" class="popup">
    <form id="exportform">
      <div style="font-weight: bold">Export</div>
      <div>
        <input type="checkbox" id="option_insignificant" name="option_insignificant"><label for="option_insignificant">Remove insignifiant lemmata</label>
      </div>
      <div>
        <input type="checkbox" id="option_binary" name="option_binary"><label for="option_binary">Binarize marked lemmata</label>
      </div>
      <div>
        <input type="checkbox" id="option_noempty" name="option_noempty"><label for="option_noempty">Gaps are significant</label>
      </div>
      <div>
        <input type="checkbox" id="option_mergegroups" name="option_mergegroups"><label for="option_mergegroups">Merge groups</label>
      </div>
      <div>
        <input type="checkbox" id="option_normalize" name="option_normalize"><label for="option_normalize">Normalize spellings</label>
      </div>
      <div>
        <button type="submit">Export</button>
      </div>
    </form>
</div>`)},appOptions(){const f=document.createRange().createContextualFragment(`<div id="exportoptions" class="popup">
    <form id="exportform">
      <div style="font-weight: bold">Export</div>
      <div>
        <label for="option__basetext">Base text</label>
        <select id="option__basetext" name="option_basetext"></select>
      </div>
      <div>
        <input type="checkbox" id="option__app_insignificant" name="option_app_insignificant"><label for="option_app_insignificant">Ignore insignifiant lemmata</label>
      </div>
      <div>
        <input type="checkbox" id="option_mergegroups" name="option_mergegroups" checked><label for="option_mergegroups">Merge groups</label>
      </div>
      <div>
        <input type="checkbox" id="option_app_normalize" name="option_app_normalize" checked><label for="option_app_normalize">Normalized spellings in positive apparatus</label>
      </div>
      <div>
        <input type="checkbox" id="option_normalize" name="option_normalize"><label for="option_normalize">Normalize spellings in negative apparatus</label>
      </div>
      <div>
        <button type="submit">Export</button>
      </div>
    </form>
</div>`),i=f.getElementById("option__basetext"),o=[...N.trs()].map(x=>x.dataset.n);for(const x of o){const w=document.createElement("option");w.value=x,w.append(x),i.appendChild(w)}return f},showOptions:function(f,i){const o=i(),x=function(w){w.preventDefault();var R=[];const q=document.getElementById("exportform").elements;for(const B of q)B.type==="checkbox"?R.push([B.name,B.checked]):R.push([B.name,B.value]);const z=b.processOptions(new Map(R));f(z)};O.blackout(o,x)}};return b},Jn=function(d){const{find:k,check:N,make:O}=d;return{group:function(f){const i=[...f],o=i.shift(),x=k.texts();for(const R of x){const q=O.xmlel("cl"),z=k.firstword(o,R);z.parentNode.insertBefore(q,z),q.appendChild(z);for(const B of f)q.appendChild(k.firstword(B,R))}const w=i.pop();for(const R of k.tds(o))R.classList.add("group-start");for(const R of k.tds(w))R.classList.add("group-end");for(const R of i)for(const q of k.tds(R))q.classList.add("group-internal")},ungroup:function(f){const i=k.texts();for(const x of i){let w;for(const R of f){const q=k.firstword(R,x);w||(w=q.closest("cl")),w.parentNode.insertBefore(q,w)}w.parentNode.removeChild(w)}const o=[...f].flatMap(x=>[...k.tds(x)]);for(const x of o)x.classList.remove("group-start","group-internal","group-end")}}};function Ot(d){var k=[],N=0;if(this.trie=this.createTrie(d.patterns),this.leftMin=d.leftmin,this.rightMin=d.rightmin,this.exceptions={},d.exceptions)for(k=d.exceptions.split(/,\s?/g);N<k.length;N+=1)this.exceptions[k[N].replace(/\u2027/g,"").toLowerCase()]=new RegExp("("+k[N].split("\u2027").join(")(")+")","i")}Ot.prototype.createTrie=function(d){var k=0,N=0,O=0,C=0,b=null,f=null,i=null,o=null,x={_points:[]},w;for(k in d)if(d.hasOwnProperty(k))for(w=d[k].match(new RegExp(".{1,"+ +k+"}","g")),N=0;N<w.length;N+=1){for(b=w[N].replace(/[0-9]/g,"").split(""),f=w[N].split(/\D/),o=x,O=0;O<b.length;O+=1)i=b[O].charCodeAt(0),o[i]||(o[i]={}),o=o[i];for(o._points=[],C=0;C<f.length;C+=1)o._points[C]=f[C]||0}return x};Ot.prototype.hyphenateText=function(d,k){k=k||4;for(var N=d.split(/([a-zA-Z0-9_\u0027\u00AD\u00DF-\u00EA\u00EB\u00EC-\u00EF\u00F1-\u00F6\u00F8-\u00FD\u0101\u0103\u0105\u0107\u0109\u010D\u010F\u0111\u0113\u0117\u0119\u011B\u011D\u011F\u0123\u0125\u012B\u012F\u0131\u0135\u0137\u013C\u013E\u0142\u0144\u0146\u0148\u0151\u0153\u0155\u0159\u015B\u015D\u015F\u0161\u0165\u016B\u016D\u016F\u0171\u0173\u017A\u017C\u017E\u017F\u0219\u021B\u02BC\u0390\u03AC-\u03CE\u03F2\u0401\u0410-\u044F\u0451\u0454\u0456\u0457\u045E\u0491\u0531-\u0556\u0561-\u0587\u0902\u0903\u0905-\u090B\u090E-\u0910\u0912\u0914-\u0928\u092A-\u0939\u093E-\u0943\u0946-\u0948\u094A-\u094D\u0982\u0983\u0985-\u098B\u098F\u0990\u0994-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BE-\u09C3\u09C7\u09C8\u09CB-\u09CD\u09D7\u0A02\u0A03\u0A05-\u0A0A\u0A0F\u0A10\u0A14-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A82\u0A83\u0A85-\u0A8B\u0A8F\u0A90\u0A94-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABE-\u0AC3\u0AC7\u0AC8\u0ACB-\u0ACD\u0B02\u0B03\u0B05-\u0B0B\u0B0F\u0B10\u0B14-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3E-\u0B43\u0B47\u0B48\u0B4B-\u0B4D\u0B57\u0B82\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB5\u0BB7-\u0BB9\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD7\u0C02\u0C03\u0C05-\u0C0B\u0C0E-\u0C10\u0C12\u0C14-\u0C28\u0C2A-\u0C33\u0C35-\u0C39\u0C3E-\u0C43\u0C46-\u0C48\u0C4A-\u0C4D\u0C82\u0C83\u0C85-\u0C8B\u0C8E-\u0C90\u0C92\u0C94-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBE-\u0CC3\u0CC6-\u0CC8\u0CCA-\u0CCD\u0D02\u0D03\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D28\u0D2A-\u0D39\u0D3E-\u0D43\u0D46-\u0D48\u0D4A-\u0D4D\u0D57\u0D60\u0D61\u0D7A-\u0D7F\u1F00-\u1F07\u1F10-\u1F15\u1F20-\u1F27\u1F30-\u1F37\u1F40-\u1F45\u1F50-\u1F57\u1F60-\u1F67\u1F70-\u1F7D\u1F80-\u1F87\u1F90-\u1F97\u1FA0-\u1FA7\u1FB2-\u1FB4\u1FB6\u1FB7\u1FBD\u1FBF\u1FC2-\u1FC4\u1FC6\u1FC7\u1FD2\u1FD3\u1FD6\u1FD7\u1FE2-\u1FE7\u1FF2-\u1FF4\u1FF6\u1FF7\u200D\u2019]+)/gi),O=0;O<N.length;O+=1)N[O].indexOf("/")!==-1?O!==0&&O!==N.length-1&&!/\s+\/|\/\s+/.test(N[O])&&(N[O]+="\u200B"):N[O].length>k&&(N[O]=this.hyphenate(N[O]).join("\xAD"));return N.join("")};Ot.prototype.hyphenate=function(d){var k,N=[],O,C,b,f,i,o=[],x,w=d.toLowerCase(),R,q,z=Math.max,B=this.trie,D=[""];if(this.exceptions.hasOwnProperty(w))return d.match(this.exceptions[w]).slice(1);if(d.indexOf("\xAD")!==-1)return[d];for(d="_"+d+"_",k=d.toLowerCase().split(""),O=d.split(""),x=k.length,C=0;C<x;C+=1)o[C]=0,N[C]=k[C].charCodeAt(0);for(C=0;C<x;C+=1)for(i=B,b=C;b<x&&(i=i[N[b]],i);b+=1)if(R=i._points,R)for(f=0,q=R.length;f<q;f+=1)o[C+f]=z(o[C+f],R[f]);for(C=1;C<x-1;C+=1)C>this.leftMin&&C<x-this.rightMin&&o[C]%2?D.push(O[C]):D[D.length-1]+=O[C];return D};var Kn=Ot;const Qn={id:"sa",leftmin:2,rightmin:2,patterns:{2:"a1e1i1o1u1\xE91\xED1\xEF1\xF31\xFA1\xFC1\u01011\u012B1\u016B1\u1E371\u1E391\u1E5B1\u1E5D1",3:"2b_2c_2d_2g_2h_2j_2k_2l_2m_2n_2p_2r_2s_2t_2v_2y_2\xF1_2\u015B_2\u1E0D_2\u1E2512\u1E2B12\u1E37_2\u1E4112\u1E4312\u1E45_2\u1E47_2\u1E6D_2\u1E961l\u03251r\u03251",4:"2bh_2ch_2dh_2gh_2jh_2kh_2m\u031012ph_2rb_2rd_2rg_2rk_2rp_2rt_2r\u1E0D_2r\u1E6D_2th_2\u1E0Dh_2\u1E6Dh_a2i1a2u1a3\xEF1a3\xFC1l\u0325\u03041r\u0325\u03041"}};window.comboView=function(){const d={teins:"http://www.tei-c.org/ns/1.0",scripts:["iast","devanagari","telugu","grantha","malayalam"],filename:null,xml:null,treelist:new Map,trees:[],textboxes:[],matrix:null,viewdiv:null,descs:null,maxlemma:null,windows:[window],dragged:null,undo:[],redo:[],editing:!1},k=new Kn(Qn),N=new jn(d),O=new Xn(d),C=new Jn(O),b=new Yn(O,N),{find:f,check:i,make:o}=O,x=function(){const c=document.getElementById("tooltip");c&&c.remove()},w={matrix:function(){return d.matrix=new pe,d.matrix.init(),d.matrix.show(),document.getElementById("matrixmenu").style.display="none",R(),D.rehighlight(),d.matrix},text:function(c){const u=new fe(c);return d.textboxes.push(u),u.init(),u.show(),R(),D.rehighlight(),document.querySelector(".highlit")||X.textClick({target:u.boxdiv.querySelector(".lemma:not(.invisible)")}),u},tree:function(c,u){const p=new Y(c,u);return d.trees.push(p),p.init(),p.show(),R(),D.rehighlight(),p}},R=function(){for(const c of d.trees)c.draw()},q=function(){const c=window.getSelection?window.getSelection():document.selection;c&&(c.removeAllRanges?c.removeAllRanges():c.empty&&c.empty())},z=function(c){const u=document.createTreeWalker(c,NodeFilter.SHOW_TEXT);for(;u.nextNode();){const p=B(u.currentNode.nodeValue);u.currentNode.nodeValue=p}},B=function(c){return k.hyphenateText(c.replace(/ \|/g,"\xA0|").replace(/\| (?=\d)/g,"|\xA0").replace(/\|\|/g,"\u0965").replace(/\|/g,"\u0964"))},D={getAllWindows:function(){return window.mainWindow?window.mainWindow.comboView.getWindows():d.windows},forEachWindow:function(c){const u=D.getAllWindows();for(const p of u)if(!p.closed&&c(p)===!1)break},highlightLemma:function(c,u){var p=!!u;D.forEachWindow(n=>{const r=n.comboView.getViewdiv().querySelectorAll('[data-n="'+c+'"]');for(const h of r)(!p||!h.classList.contains("invisible"))&&h.classList.add("highlit");const s=n.comboView.getViewdiv().querySelectorAll('[data-n-trans="'+c+'"]');for(const h of s)h.classList.add("translit")})},highlightRange:function(c){if(!c||c.size===0)return;D.unHighlightAll();const[u,p]=f.lowhigh(c);if(p!==void 0)for(let n=u;n<=p;n++)D.highlightLemma(n,!0);else D.highlightLemma(u);D.repopulateTrees(u,p);for(const n of d.viewdiv.querySelectorAll(".text-box"))n.querySelector(".highlit")||n.querySelector('[data-n="'+u+'"]').classList.add("highlit");ae.xScroll(u)},highlightAll:function(){i.anyhighlit()?D.unHighlightAll():D.highlightRange(new Set([0,f.maxlemma()]))},unHighlightAll:function(){D.forEachWindow(c=>{const u=c.comboView.getViewdiv().querySelectorAll(".highlit");for(const n of u)n.classList.remove("highlit");const p=c.comboView.getViewdiv().querySelectorAll(".translit");for(const n of p)n.classList.remove("translit");D.unCelllightAll()})},unCelllightAll:function(){D.forEachWindow(c=>{const u=c.comboView.getViewdiv().querySelectorAll(".highlitcell");for(const p of u)p.classList.remove("highlitcell")})},rehighlight:function(){var c;if(D.forEachWindow(p=>{if(c=p.document.querySelectorAll(".highlit"),c.length>0)return!1}),c.length>0){var u=new Set;for(const p of c)u.add(p.dataset.n);D.highlightRange(u)}},clearTrees:function(){D.forEachWindow(c=>{const u=c.comboView.getTrees();for(const p of u)p.clearlemmata()})},repopulateTrees:function(c,u){D.forEachWindow(p=>{const n=p.comboView.getTrees();for(const r of n)r.populate(c,u),r.colourizeVariants(c,u),r.updatescript()})},highlightTreeLemma:function(c){D.forEachWindow(u=>{const p=u.comboView.getTrees();for(const n of p){const r=n.boxdiv.querySelector('.tree-lemma[data-id="'+c+'"]'),s=n.boxdiv.querySelectorAll(".tree-lemma");for(const h of s)(r.dataset.nodes&&h.dataset.nodes===r.dataset.nodes||!r.dataset.nodes&&h.dataset.id===r.dataset.id)&&h.classList.add("highlit");n.clearLabels()}})},unhighlightTrees:function(){D.forEachWindow(c=>{const u=c.comboView.getViewdiv().querySelectorAll(".tree-lemma.highlit");for(const n of u)n.classList.remove("highlit");const p=c.comboView.getTrees();for(const n of p)n.clearLabels()})}},j=function(c,u){const p=u.target.files[0],n=[...u.target.files].slice(1),r=new FileReader;r.onload=c.bind(null,p,n),r.readAsText(p)},Q=function(c,u,p){d.filename=c.name,document.title=document.title+`: ${d.filename}`,d.filename.split(".").pop()==="csv"?ie(c,u,p):de(c,u,p)},U=function(c,u,p){const n=p.target.result,s=new DOMParser().parseFromString(n,"text/xml"),h=d.xml.querySelector("teiHeader > xenoData")||function(){const v=d.xml.querySelector("teiHeader")||function(){const M=o.xmlel("teiHeader");return d.xml.documentElement.appendChild(M),M}(),A=o.xmlel("xenoData");return v.appendChild(A),A}(),m=o.xmlel("stemma");m.setAttribute("format","nexml"),m.id="stemma"+[...h.querySelectorAll("stemma")].length,m.appendChild(s.firstChild.cloneNode(!0)),h.appendChild(m),G(s,m.id)},G=function(c,u,p=!0){const n=c.querySelectorAll("tree"),r=document.querySelector("#treemenu ul");for(const s of n){const h=s.id,m=c.cloneNode(!0);for(const M of m.querySelectorAll("tree"))M.id!==h&&M.parentNode.removeChild(M);const v=s.getAttribute("label")||"New Tree "+d.treelist.size;d.treelist.set(`#${u} #${h}`,m);const A=document.createElement("li");A.dataset.name=v,A.dataset.treeid=h,A.dataset.stemmaid=u,A.appendChild(document.createTextNode(v)),r.insertBefore(A,r.lastElementChild),p&&w.tree(u,h)}},ie=function(c,u,p){const n=Cn.parse(p.target.result,{delimiter:","});d.xml=document.implementation.createDocument(d.teins,"",null);const r=o.xmlel("teiCorpus"),s=o.xmlel("teiHeader");r.appendChild(s),d.xml.appendChild(r);for(const h of n){const m=h[0],v=h.slice(1),A=o.xmlel("TEI");A.setAttribute("n",m);const M=o.xmlel("text");for(let T=0;T<v.length;T++){const V=v[T],W=o.xmlel("w");V&&W.appendChild(document.createTextNode(V)),W.setAttribute("n",T),M.appendChild(W)}A.appendChild(M),r.appendChild(A)}d.xml.normalize(),d.maxlemma=f.maxlemma(),J()},de=function(c,u,p){const n=new DOMParser;d.xml=n.parseFromString(p.target.result,"text/xml");const r=d.xml.querySelectorAll("teiHeader xenoData stemma nexml");for(const s of r){const h=document.implementation.createDocument("http://www.nexml.org/2009","",null);h.appendChild(s.cloneNode(!0)),G(h,s.closest("stemma").id,!1)}d.maxlemma=f.maxlemma(),u.length>0?ve(u):J()},ve=function(c){const u=c[0],p=c.slice(1),n=function(h,m){const v=new Set(h);for(const A of m)v.delete(A);return v},r=function(h,m){const A=new DOMParser().parseFromString(m.target.result,"text/xml"),M=new Map;for(const Ee of f.teis()){const _e=Ee.getAttribute("n");M.set(_e,Ee)}const T=new Set(M.keys()),V=new Map;for(const Ee of A.querySelectorAll("TEI")){const _e=Ee.getAttribute("n");V.set(_e,Ee)}const W=new Set(V.keys()),oe=n(T,W),be=n(W,T);for(const Ee of be)o.tei(Ee);const we=[...A.querySelector("text").querySelectorAll("w[n]")].length,ye=d.maxlemma+we;for(const[Ee,_e]of V)if(M.has(Ee)){const ke=M.get(Ee).querySelector("text"),Me=_e.querySelector("text").querySelectorAll("w[n]");var Ae=d.maxlemma+1;for(const De of Me)De.setAttribute("n",Ae),ke.appendChild(De),Ae=Ae+1}else{const ke=o.xmlel("TEI");ke.setAttribute("n",Ee);const Be=o.xmlel("text");o.emptywords(Be,ye,0),ke.appendChild(Be),d.xml.documentElement.appendChild(ke)}for(const Ee of oe){const _e=M.get(Ee).querySelector("text");o.emptywords(_e,ye,d.maxlemma+1)}d.maxlemma=f.maxlemma(),h.length>0?ve(h):J()},s=new FileReader;s.onload=r.bind(null,p),s.readAsText(u)},$=function(){var c="";const u=[...f.teis()].map(p=>p.getAttribute("n"));for(const p of u)c+=`<li data-name="${p}">${p}</li>`;document.getElementById("menu").querySelector(".ms").innerHTML=c},J=function(){$();const c=new ge("Export");c.populate([{text:"TEI corpus",func:b.showOptions.bind(null,b.xml,b.options)},{text:"TEI apparatus",func:b.showOptions.bind(null,b.xml,b.appOptions)},{text:"CSV",func:b.showOptions.bind(null,b.csv,b.options)},{text:"NEXUS",func:b.showOptions.bind(null,b.nexus,b.options)}]);const u=new ge("Edit");u.populate([{text:"Undo",greyout:i.undo,func:I.undo},{text:"Redo",greyout:i.redo,func:I.redo},{text:"Select all",alt:"Deselect all",toggle:i.anyhighlit,func:D.highlightAll},{text:"Group all words",func:I.doGroupWords},{text:"Delete empty columns",func:I.startRemoveEmpty},{text:"Delete empty rows",func:I.startRemoveEmptyRows}]);const p=new ge("Column");p.populate([{text:"(Re)normalize column",alt:"(Re)normalize columns",greyout:i.anyhighlit,toggle:i.manyhighlit,func:I.startRenormalize.bind(null,!1)},{text:"Delete column",alt:"Delete columns",greyout:i.anyhighlit,toggle:i.manyhighlit,func:I.removeCol.start.bind(null,!1)},{text:"Merge columns",greyout:i.manyhighlit,func:I.startMerge.bind(null,!1)},{text:"Group columns",alt:"Ungroup columns",greyout:i.oneGrouped,toggle:i.grouped,func:I.group.start.bind(null,!1)},{text:"Insert column",greyout:i.anyhighlit,func:I.insertCol.start},{text:"Mark insignificant",checkbox:i.checkbox.bind(null,"insignificant"),greyout:i.anyhighlit,func:I.startMarkAs.bind(null,"insignificant",!1)},{text:"Mark binary",checkbox:i.checkbox.bind(null,"binary"),greyout:i.anyhighlit,func:I.startMarkAs.bind(null,"binary",!1)}]);const n=new ge("Row");n.populate([{text:"Insert row",func:I.startNewRow}]);const r=new ge("Cell");r.populate([{text:"Edit cell",greyout:i.highlitcell,func:I.startEditCell.bind(null,!1)}]);const s=new ge("View");s.populate([{text:"Header",checkbox:i.headerView,func:ae.toggleHeader},{text:"Normalized",checkbox:i.normalizedView,greyout:i.anyNormalized,func:ae.toggleNormalize}]);const h=document.getElementById("left_menu");h.appendChild(s.box),h.appendChild(u.box),h.appendChild(p.box),h.appendChild(n.box),h.appendChild(r.box),h.appendChild(c.box);const m=document.getElementById("views");m.style.justifyContent="flex-start",m.removeChild(m.querySelector("#splash")),w.matrix();const v=document.getElementById("matrixmenu");v.addEventListener("click",w.matrix),v.removeChild(v.querySelector("ul")),document.getElementById("mssmenu").style.display="block",document.getElementById("treemenu").style.display="block"},X={selectAll(c){const u=document.createRange();u.selectNodeContents(c);const p=window.getSelection();p.removeAllRanges(),p.addRange(u)},deselect(){const c=window.getSelection();c.removeAllRanges?c.removeAllRanges():c.empty&&c.empty()},treeMouseover(c){const u=c.target.classList.contains("tree-lemma")?c.target:c.target.closest(".tree-lemma");u&&(D.highlightTreeLemma(u.dataset.id),u.addEventListener("mouseout",D.unhighlightTrees));const p=c.target.dataset.reconstructed;if(!p)return;const n=document.createElement("div");n.id="tooltip",n.style.top=c.pageY+"px",n.style.left=c.pageX+"px",n.style.opacity=0,n.style.transition="opacity 0.2s ease-in",d.viewdiv.parentElement.appendChild(n);const r=document.createElement("div");if(r.appendChild(document.createTextNode(p)),this.script!==0?n.appendChild(Jt(r,d.scripts[this.script])):n.appendChild(r),c.target.classList.contains("reconstructed")){const s=c.target.parentNode.querySelector("span.tree-lemma");if(s&&s.dataset.hasOwnProperty("emended")){const h=document.createElement("div");h.classList.add("emphasis"),h.appendChild(document.createTextNode(s.textContent)),this.script!==0?n.prepend(Jt(h,d.scripts[this.script])):n.prepend(h)}}window.getComputedStyle(n).opacity,n.style.opacity=1,c.target.addEventListener("mouseout",x)},treeClick(c){c.target.classList.contains("witness")?w.text(c.target.dataset.key):c.target.classList.contains("reconstructed")?w.text(c.target.dataset.label):c.target.classList.contains("internal")&&I.startReconstruction(c),x()},keyDown(c){if(!d.editing&&c.key.substring(0,5)==="Arrow")X.cycleVariant(c);else if(c.ctrlKey||c.metaKey)c.key==="Z"?I.redo():c.key==="z"&&I.undo();else if(!d.editing&&d.matrix&&!d.matrix.closed&c.key==="Enter"){const u=f.highlitcell();u&&(c.preventDefault(),I.startEditCell(u))}},cycleVariant(c){const u=f.highlitcell()||d.viewdiv.querySelector("td.highlit")||d.viewdiv.querySelector('td[data-n="0"]');switch(c.key){case"ArrowRight":{if(!d.matrix.closed&&u){const p=u.nextElementSibling;p&&X.textClick({target:p})}else{const p=d.viewdiv.querySelector(".highlit"),n=p?p.dataset.n:0;let r=parseInt(n)+1;for(;r<=d.maxlemma;){const s=d.viewdiv.querySelectorAll('[data-n="'+r+'"]');for(const h of s)if(h&&!h.classList.contains("invisible")){X.textClick({target:h});return}r++}}break}case"ArrowLeft":{if(!d.matrix.closed&&u){const p=u.previousElementSibling;p&&X.textClick({target:p})}else{const p=d.viewdiv.querySelector(".highlit"),n=p?p.dataset.n:0;let r=parseInt(n)-1;for(;r>=0;){const s=d.viewdiv.querySelectorAll('[data-n="'+r+'"]');for(const h of s)if(h&&!h.classList.contains("invisible")){X.textClick({target:h});return}if(r--,u){X.textClick({target:u.previousElementSibling});return}}}break}case"ArrowUp":{if(d.matrix.closed||!u)return;const n=u.closest("tr").previousElementSibling;if(!n||!n.dataset.n)return;const r=n.querySelector(`td[data-n="${u.dataset.n}"]`);X.textClick({target:r});break}case"ArrowDown":{if(d.matrix.closed||!u)return;const n=u.closest("tr").nextElementSibling;if(!n||n.tagName!=="TR")return;const r=n.querySelector(`td[data-n="${u.dataset.n}"]`);X.textClick({target:r})}}},textClick(c,u=!1){if(c.target.closest("tr.header")){X.matrixHeaderClick(c);return}const p=c.target.classList.contains("lemma")?c.target:c.target.closest(".lemma");if(p){if(!u&&c.ctrlKey){X.rightClick(c);return}const n=p.dataset.n,r=f.highlitrow();if(D.unHighlightAll(),D.highlightLemma(n),D.repopulateTrees(n),ae.xScroll(n,r),p.tagName==="TD")p.classList.add("highlitcell");else{const s=p.closest(".text-box");if(s){const h=s.dataset.id;f.tr(h).querySelector(`td[data-n="${n}"]`).classList.add("highlitcell")}}}},textMouseup(){const c=f.selection();!c||(D.highlightRange(c),q())},menuMouseover(c){const u=c.target.classList.contains("menubox")?c.target:c.target.closest(".menubox");if(u){const p=u.querySelector("ul");p&&(p.style.display="block"),u.classList.add("open")}},menuMouseout(c){const u=c.target.classList.contains("menubox")?c.target:c.target.closest(".menubox");if(u){const p=u.querySelector("ul");p&&(p.style.display="none"),u.classList.remove("open")}},menuClick(c){!c.target.parentElement||(c.target.parentElement.className==="ms"&&(X.menuMouseout(c),w.text(c.target.dataset.name)),c.target.parentElement.className==="tree"&&(X.menuMouseout(c),c.target.closest("li[data-name]")&&w.tree(c.target.dataset.stemmaid,c.target.dataset.treeid)))},thDragStart(c){!c.target.closest('th[scope="row"]')||(c.dataTransfer.setData("text/plain",c.target.textContent),I.startMoveRow(c.target.parentNode,c))},trDragEnter(c){const u=c.target.nodeType===1?c.target.closest("tr"):c.target.parentElement.closest("tr");u&&u.classList.add("dragenter")},trDragLeave(c){const u=c.target.nodeType===1?c.target.closest("tr"):c.target.parentElement.closest("tr");u&&u.classList.remove("dragenter")},trDragDrop(c){c.preventDefault(),I.finishMoveRow(c)},matrixMousedown(c){if(c.button!==0)return;if(c.ctrlKey){X.rightClick(c);return}const u=c.target.nodeType===1?c.target.closest(".lemma"):c.target.parentElement.closest(".lemma");if(u){if(u.isContentEditable)return;D.unHighlightAll(),D.highlightLemma(u.dataset.n);const p=d.matrix.boxdiv.querySelector("table");p.addEventListener("mouseover",X.matrixMouseover),p.addEventListener("mouseup",X.matrixMouseup)}},matrixMouseup(c){const u=f.highlit();u.size===1?X.textClick(c):D.highlightRange(u);const p=d.matrix.boxdiv.querySelector("table");p.removeEventListener("mouseover",X.matrixMouseover),p.removeEventListener("mouseup",X.matrixMouseup)},matrixMouseover(c){const u=c.target.nodeType===1?c.target.closest(".lemma"):c.target.parentElement.closest(".lemma");u&&D.highlightLemma(u.dataset.n)},matrixHeaderClick(c){if(c.target.tagName!=="INPUT")return;const u=c.target.className;if(u!=="insignificant"&&u!=="binary")return;const p=c.target.closest("th").dataset.ref,n=f.firsttd(p).dataset[u]!=="true",r=new Map([[p,n]]);I.doMarkAs(u,r)},rightClick(c){const u=c.target.nodeType===1?c.target.closest("tr[data-n] th"):c.target.parentElement.closest("tr[data-n] th");if(u){c.preventDefault(),re.remove();const n=re.create(c),r=[{text:"move row",func:I.startMoveRow.bind(null,u.parentNode)},{text:"delete row",func:I.doDeleteRow.bind(null,u.parentNode.dataset.n)}];re.populate(n,r),re.show(n);return}const p=c.target.nodeType===1?c.target.closest("td.lemma"):c.target.parentElement.closest("td.lemma");if(p){c.preventDefault();const n=p.classList.contains("highlit")?function(){const h=f.highlit();return h.size===1&&!p.classList.contains("highlitcell")&&(D.unCelllightAll(),p.classList.add("highlitcell")),h}():(X.textClick(c,!0),new Set([p.dataset.n])),r=n.size>1?[{text:"merge columns",func:I.startMerge.bind(null,n)},{text:"ungroup columns",alt:"group columns",toggle:i.grouped,func:I.group.start.bind(null,!1)},{text:"delete columns",func:I.removeCol.start.bind(null,n)}]:[{text:"edit cell",func:I.startEditCell.bind(null,p)},{text:"delete column",func:I.removeCol.start.bind(null,n)},{text:"insert column",func:I.insertCol.start}];re.remove();const s=re.create(c);re.populate(s,r),re.show(s)}}},I={undo:function(){const c=d.undo.pop();c&&c[0](...c[1])},redo:function(){const c=d.redo.pop();c&&c[0](...c[1])},doStack:function(c,u="do"){u==="undo"?(c[1].push("redo"),d.redo.push(c)):u==="redo"?(c[1].push("undo"),d.undo.push(c)):(c[1].push("undo"),d.undo.push(c),d.redo=[])},doMulti:function(c,u){const p=[];for(const n of c){const r=n[0](...n[1],"multido");p.unshift(r)}I.doStack([I.doMulti,[p]],u)},startMoveRow:function(c,u){if(d.dragged=c,d.dragged.classList.add("dragging"),u.type!=="dragstart"){for(const p of f.trs())p.classList.add("moveinprogress");d.matrix.boxdiv.querySelector("table").addEventListener("mousedown",I.finishMoveRow)}},startMerge:function(c){const u=c===!1?f.highlit():c,p=f.clauses(u,!0);if(!p)I.doMerge(u,"do");else if(p[0]===null){const n=p.filter(r=>r!==null).map(r=>[I.ungroup.go,[r]]).concat([[I.doMerge,[u]]]);I.doMulti(n,"do")}else{const n=p.map(r=>[I.ungroup.go,[r]]).concat([[I.doMerge,[u]]]);I.doMulti(n,"do")}},group:{start:function(c){const u=c===!1?f.highlit():c;i.grouped()?I.ungroup.start(u):I.group.go(u,"do")},go:function(c,u="do"){C.group(c);for(const p of d.textboxes)p.refresh();if(u==="multido")return[I.ungroup.go,[c]];I.doStack([I.ungroup.go,[c]],u)}},ungroup:{start:function(c){const p=[...f.clauses(c)].map(n=>[I.ungroup.go,[n]]);I.doMulti(p,"do")},go:function(c,u="do"){C.ungroup(c);for(const p of d.textboxes)p.refresh();if(u==="multido")return[I.group.go,[c]];I.doStack([I.group.go,[c]],u)}},insertCol:{start:function(){const c=Math.max([...f.highlit()])||d.maxlemma;I.insertCol.go({mode:"append",start:c})},go:function(c,u="do"){const p=function(s,h,m,v){const A=s();for(var M=0;M<A.length;M++){const T=h(c.start,A[M]);if(c.mode==="append")if(m)for(const V of m[M].reverse())T.insertAdjacentElement("afterend",V);else{const V=v(c.start+1);T.insertAdjacentElement("afterend",V)}else if(m)for(const V of m[M])T.insertAdjacentElement("beforebegin",V);else{const V=v(c.start);T.insertAdjacentElement("beforebegin",V)}}return m?m[0].length:1};D.unHighlightAll();var n;c.hasOwnProperty("xml")?(p(...c.xml),n=p(...c.html)):(p(f.trs,f.firsttd,null,o.emptycell),p(f.texts,f.firstword,null,o.emptyword),n=1);const r=c.mode==="append"?[...Array(n).keys()].map(s=>c.start+s+1):[...Array(n).keys()].map(s=>c.start+s);if(I.renumber(c.start),D.highlightRange(new Set(r)),I.refresh(),I.reIAST(r),I.restyleGroups(r,!0),ae.updateAllHeaders(),u==="multido")return[I.removeCol.go,[r]];I.doStack([I.removeCol.go,[r]],u)}},removeCol:{start:function(c){const u=c===!1?f.highlit():c,p=f.clauses(u);if(!p)I.removeCol.go(u,"do");else{const n=p.map(r=>[I.ungroup.go,[r]]).concat([[I.removeCol.go,[u]]]);I.doMulti(n,"do")}},go:function(c,u="do"){const p=function(A,M){const T=A(),V=[];for(const W of T){const oe=[...c].map(we=>{const ye=M(we,W);return I.unnormalize(ye),ye}),be=oe.map(we=>we.cloneNode(!0));V.push(be);for(const we of oe)we.parentNode.removeChild(we)}return[A,M,V]},n={mode:"insert"};[...c].map(A=>parseInt(A));const r=Math.min(...c),s=Math.max(...c);f.firstword(s).nextElementSibling||(n.mode="append");const m=p(f.trs,f.firsttd),v=p(f.texts,f.firstword);if(I.renumber(r-1),I.refresh(),I.restyleGroups(c,!0),ae.updateAllHeaders(),n.html=m,n.xml=v,n.mode==="append"?n.start=r-1:n.start=r,u==="multido")return[I.insertCol.go,[n]];I.doStack([I.insertCol.go,[n]],u)}},startRemoveEmpty:function(){const c=f.empty(),u=f.clauses(c);if(!u)I.removeCol.go(c,"do");else{const p=f.clausesToRemove(u,c,1);if(!p)I.removeCol.go(c,"do");else{const n=p.map(r=>[I.ungroup.go,[r]]).concat([[I.removeCol.go,[c]]]);I.doMulti(n,"do")}}},startRemoveEmptyRows:function(){const u=[...f.emptyRows(!0)].map(p=>[I.doDeleteRow,[p]]);I.doMulti(u,"do")},startEditCell:function(c){const u=c||f.highlitcell();!u||(I.unnormalize(u),u.dataset.oldContent=u.textContent,u.contentEditable="true",u.focus(),d.editing=!0,X.selectAll(u),u.addEventListener("blur",I.finishEditCell),u.addEventListener("keydown",I.cellKeyDown))},cellKeyDown:function(c){switch(c.key){case"Enter":I.finishEditCell(c);break;case"Escape":I.finishEditCell(c,!0);break;case"ArrowRight":{const u=f.cursorPos(c.target);u[0]===u[1]&&(c.preventDefault(),I.finishEditCell(c),X.cycleVariant({key:"ArrowRight"}),I.startEditCell(f.highlitcell()));break}case"ArrowLeft":{f.cursorPos(c.target)[0]===0&&(c.preventDefault(),I.finishEditCell(c),X.cycleVariant({key:"ArrowLeft"}),I.startEditCell(f.highlitcell()));break}}},startMarkAs:function(c,u,p){const n=p.target.tagName==="INPUT"?p.target:p.target.querySelector("input"),r=u===!1?f.highlit():u,s=new Map([...r].map(h=>[h,!n.checked]));I.doMarkAs(c,s)},startNewRow:function(){const c=o.row("new row"),u=c.querySelector("th");u.contentEditable=!0,u.addEventListener("blur",I.finishNewRow),u.addEventListener("keydown",I.thKeyDown),d.matrix.boxdiv.querySelector("tbody").appendChild(c),u.scrollIntoView(),u.focus(),document.execCommand("selectAll",!1,null),d.editing=!0},startRenameRow:function(){},startReconstruction:function(c){const u=c.target.dataset.key,p=c.target.closest(".tree-box").myTree,n=p.desc,r=document.createRange().createContextualFragment(`<div id="reconstructionoptions" class="popup">
    <form id="reconstructionform">
      <div>
        <label for="reconstructed_node_name">Label for node:</label>
        <input type="text" id="reconstructed_node_name" name="reconstructed_node_name" placeholder="${n}-${u}" size="15">
      </div>
      <div style="width: 100%; display: flex; justify-content: center;padding-top: 1em;">
        <button type="submit">Add to matrix</button>
      </div>
    </form>
</div>`),s=function(h){h.preventDefault();const m=blackout.querySelector("input"),v=m.value?m.value:m.placeholder;I.doReconstruction(p,u,v)};o.blackout(r,s),document.getElementById("reconstructed_node_name").focus()},thKeyDown:function(c){c.key==="Enter"&&I.finishNewRow(c)},finishNewRow:function(c){const u=c.target,p=u.textContent;u.closest("tr").dataset.n=p;const n=o.tei(p);d.xml.documentElement.appendChild(n),d.editing=!1,u.contentEditable=!1,u.removeEventListener("blur",I.finishNewRow),u.removeEventListener("keydown",I.thKeyDown),I.doStack([I.doDeleteRow,[p]],"do")},finishEditCell:function(c,u=!1){const p=c.target;d.editing=!1,p.contentEditable="false",p.removeEventListener("blur",I.finishEditCell),p.removeEventListener("keydown",I.cellKeyDown),p.blur(),X.deselect();const n=p.textContent;if(n===""){const m=p.querySelector("br");m&&m.remove()}if(u||n===p.dataset.oldContent)return;p.hasOwnProperty("IAST")||(p.IAST=p.cloneNode(!0)),p.IAST.textContent=n;const r=parseInt(p.dataset.n),s=p.closest("tr"),h=s.dataset.n;if(I.xmlChangeCell(r,h,n),s.dataset.hasOwnProperty("treename")&&!p.dataset.hasOwnProperty("emended")){const m=I.doEmend(r,h,"multido"),v=[];v.push([I.doChangeCell,[r,h,p.dataset.oldContent]]),v.push(m),I.doStack([I.doMulti,[v]],"do")}else I.doStack([I.doChangeCell,[r,h,p.dataset.oldContent]],"do");delete p.dataset.oldContent,I.refresh(),ae.updateAllHeaders(!0),p.classList.add("highlitcell")},finishMoveRow:function(c){const u=c.target.nodeType===1?c.target.closest("tr"):c.target.parentElement.closest("tr");if(u&&I.doMoveRow(d.dragged,u,"do"),c.type!=="drop"){for(const p of f.trs())p.classList.remove("moveinprogress");d.matrix.boxdiv.querySelector("table").removeEventListener("mousedown",I.finishMoveRow)}else for(const p of f.trs())p.classList.remove("dragenter");d.dragged.classList.remove("dragging"),d.dragged=null},doReconstruction:function(c,u,p){const n=o.row(p,"pending");n.dataset.treename=c.name,n.dataset.nodename=u;const r=n.querySelector("th"),s=document.createElement("div");s.id="spinner",r.prepend(s);const h=o.tei(p);h.setAttribute("type","reconstructed"),h.setAttribute("corresp",c.name),h.setAttribute("select",`#${u}`);const m=[...f.tds(!1,n)],v=[...f.words(!1,h)];d.matrix.boxdiv.querySelector("tbody").appendChild(n),r.scrollIntoView();const A=new Worker(""+new URL("worker.26b50853.js",import.meta.url).href),M=i.normalizedView(),T=f.serializedtexts(c.nexml,M),V=new Map(T.map(W=>[W[0],W[1][0]]));A.postMessage({readings:V,levels:c.levels,num:0,id:u}),A.onmessage=function(W){const oe=W.data.n,be=W.data.result;if(m[oe].textContent=be,m[oe].IAST=m[oe].cloneNode(!0),m[oe].classList.remove("pending"),v[oe].textContent=be,oe<d.maxlemma){const we=new Map(T.map(ye=>[ye[0],ye[1][oe+1]]));A.postMessage({readings:we,levels:c.levels,num:oe+1,id:u})}else{r.removeChild(s),d.xml.documentElement.appendChild(h),ae.updateAllHeaders(),c.draw();const we=f.highlit();we.size>0&&D.repopulateTrees(...f.lowhigh(we));const ye=document.getElementById("menu").querySelector(".ms"),Ae=document.createElement("li");Ae.setAttribute("data-name",p),Ae.appendChild(document.createTextNode(p)),ye.appendChild(Ae),I.doStack([I.doDeleteRow,[p]],"do")}}},doDeleteRow:function(c,u="do"){const p=f.tr(c),n=f.tei(c),s=[...f.teis()].indexOf(n);if(p.parentNode.removeChild(p),n.parentNode.removeChild(n),ae.updateAllHeaders(),$(),R(),u==="multido")return[I.doUndeleteRow,[p,n,s]];I.doStack([I.doUndeleteRow,[p,n,s]],u)},doUndeleteRow:function(c,u,p,n="do"){const r=u.getAttribute("n"),s=[...f.teis()];if(p===s.length)d.xml.documentElement.appendChild(u),d.matrix.boxdiv.querySelector("tbody").appendChild(c);else{const h=[...f.trs()];d.xml.documentElement.insertBefore(u,s[p]),h[p].parentNode.insertBefore(c,h[p])}if(ae.updateAllHeaders(),$(),R(),n==="multido")return[I.doDeleteRow,[r]];I.doStack([I.doDeleteRow,[r]],n)},doMoveRow:function(c,u,p="do"){const n=c.parentNode,r=[...f.trs()],s=c.previousElementSibling,h=r.indexOf(c),m=u!==null?r.indexOf(u):null,v=function(){u===-1?n.insertBefore(c,n.firstChild):u.nextElementSibling?n.insertBefore(c,u.nextElementSibling):n.appendChild(c)},A=function(){const M=d.xml.documentElement,T=[...f.teis()],V=T[h];if(m===-1)M.insertBefore(V,T[0]);else{const W=T[m];W.nextElementSibling?M.insertBefore(V,W.nextElementSibling):M.appendChild(V)}};if(v(),A(),p==="multido")return[I.doMoveRow,[c,s]];I.doStack([I.doMoveRow,[c,s]],p)},doMerge:function(c,u="do"){const p=function(h,m,v){const A=h();var M=[];for(const T of A){const V=[...v].map(be=>m(be,T)),W=V.map(be=>be.cloneNode(!0));M.push(W);for(const be of V)I.unnormalize(be);const oe=V.reduce(function(be,we){if(we.hasChildNodes())for(;we.firstChild;)be.appendChild(we.firstChild);return we.parentNode.removeChild(we),be});oe.normalize(),oe.dataset?(delete oe.dataset.normal,oe.IAST=oe.cloneNode(!0)):oe.removeAttribute("lemma")}return[h,m,M]},n=p(f.trs,f.firsttd,c),r=p(f.texts,f.firstword,c),s=parseInt([...c][0]);if(I.renumber(s),I.restyleGroups(c),I.refresh(),ae.updateAllHeaders(),u==="multido")return[I.doUnmerge,[n,r]];I.doStack([I.doUnmerge,[n,r]],u)},doUnmerge:function(c,u,p="undo"){const n=function(m,v,A){const M=f.whichattr(A[0][0]),T=A[0].map(be=>be.getAttribute(M)),V=T[0],W=m();for(var oe=0;oe<W.length;oe++){const be=A[oe].pop(),we=v(V,W[oe]);we.parentNode.replaceChild(be,we);for(const ye of A[oe])be.parentNode.insertBefore(ye,be)}return T};n(...c);const r=n(...u),h=[...r].sort((m,v)=>parseInt(m)-parseInt(v))[0];if(I.renumber(h),I.reIAST(r),I.refresh(),I.restyleGroups(r),ae.updateAllHeaders(),p==="multido")return[I.doMerge,[r]];I.doStack([I.doMerge,[r]],p)},doGroupWords:function(){let c=0;const u=[],p=f.emptyRows();for(let n=0;n<=d.maxlemma;n++){const r=f.tds(n),s=r[0].classList;if(s.contains("group-start")||s.contains("group-internal")||s.contains("group-end")){c=n+1;continue}let h=r.length-p.size,m=0;if(n===d.maxlemma)m=h;else for(let v=0;v<r.length;v++){if(p.has(v))continue;const A=r[v];(A.IAST?A.IAST.textContent:A.textContent).slice(-1)===" "&&m++}if(m/h>=.5)if(c===n){c++;continue}else{const v=f.range(c,n);u.push([I.group.go,[v]]),c=n+1}}I.doMulti(u)},doEmend:function(c,u,p="do"){const n=[...f.trs()][u],r=f.firsttd(c,n);r.dataset.emended=!0;const s=f.tei(u).querySelector("text");if(f.firstword(c,s).setAttribute("emended","true"),p==="multido")return[I.doUnemend,[c,u]];I.doStack([I.doUnemend,[c,u]],p)},doUnemend:function(c,u,p="do"){const n=[...f.trs()][u],r=f.firsttd(c,n);delete r.dataset.emended;const s=f.tei(u).querySelector("text");if(f.firstword(c,s).removeAttribute("emended"),p==="multido")return[I.doEmend,[c,u]];I.doStack([I.doEmend,[c,u]],p)},doChangeCell:function(c,u,p,n="do"){const r=I.xmlChangeCell(c,u,p),s=I.htmlChangeCell(c,u,p);if(I.refresh(),ae.updateAllHeaders(!0),X.textClick({target:s}),n==="multido")return[I.doChangeCell,[c,u,r]];I.doStack([I.doChangeCell,[c,u,r]],n)},htmlChangeCell:function(c,u,p){const n=f.tr(u),r=f.firsttd(c,n);return I.unnormalize(r),r.textContent=p,r.IAST&&(r.IAST=r.cloneNode(!0)),r},xmlChangeCell:function(c,u,p){const n=f.tei(u).querySelector("text"),r=f.firstword(c,n);I.unnormalize(r);const s=r.textContent;return r.childNodes.length===0?r.appendChild(document.createTextNode(p)):r.textContent=p,s},doMarkAs:function(c,u,p="do"){const n=[...u.keys()],r=f.attr(c,n);for(const s of n){const h=f.tds(s),m=f.words(s);if(u.get(s)===!0){for(const A of h)A.dataset[c]="true";for(const A of m)A.setAttribute(c,"true")}else{for(const A of h)delete A.dataset[c];for(const A of m)A.removeAttribute(c)}const v=f.checkbox(s,c);v.checked=u.get(s)}if(p==="multido")return[I.doMarkAs,[c,r]];I.doStack([I.doMarkAs,[c,r]],p)},refresh:function(){for(const c of d.textboxes)c.refresh();D.rehighlight(),i.anyhighlit()?D.repopulateTrees(...f.lowhigh(f.highlit())):D.clearTrees()},renumber:function(c=0){const u=function(p,n,r){const s=p();for(const m of s){const v=[...n(!1,m)],A=f.whichattr(v[0]);for(var h=parseInt(r)+1;h<v.length;h++)v[h].setAttribute(A,h)}};u(f.trs,f.tds,c),u(()=>[!0],f.ths,c),u(f.texts,f.words,c),d.maxlemma=f.maxlemma()},reIAST:function(c){const u=[...c].map(p=>[...f.lemmata(p)]).flat();for(const p of u)p.IAST=p.cloneNode(!0)},restyleGroups:function(c,u=!1){const n=u?function(s){var h=[...s];const m=parseInt(c[0])-1,v=parseInt(c[c.length-1])+1;return h.unshift(m),h.push(v),h}(c):c,r=function(s,h=!1){const m=new Set(["group-start","group-internal","group-end"]);h&&m.delete(h);for(const v of s){for(const A of m)v.classList.remove(A);h&&v.classList.add(h)}};for(const s of n){const h=f.firstword(s),m=f.tds(s);if(m.length===0)continue;const v=h.closest("cl");v?h===v.firstElementChild?r(m,"group-start"):h===v.lastElementChild?r(m,"group-end"):r(m,"group-internal"):r(m)}},startRenormalize:function(c){const u=c===!1?f.highlit():c;I.doRenormalize(Math.min(...u),Math.max(...u))},doRenormalize:function(c,u,p=!1,n="do"){i.normalizedView()||ae.showNormalized();const r=new Map,s=[...f.trs()],h=[...f.texts()],m=p?[p]:[...s.keys()];for(const v of m){const A=new Map,M=h[v],T=[...f.words(!1,M)],V=f.firstword(c,M),W=f.firstword(u,M),oe=T.indexOf(V),be=T.indexOf(W),we=T.slice(oe,be+1),ye=s[v],Ee=[...f.tds(!1,ye)].slice(oe,be+1),_e=we.map(Be=>Be.textContent),ke=zn(_e);for(let Be=0;Be<ke.length;Be++){const Me=we[Be],De=ke[Be],Te=_e[Be],Fe=Ee[Be],ze=Me.hasAttribute("lemma")?Me.getAttribute("lemma"):!1;if(ze!==!1){if(ze===De)continue;A.set(Fe.dataset.n,ze),I.unnormalize(Me),I.unnormalize(Fe)}else A.set(Fe.dataset.n,null);De!==Te&&(Me.setAttribute("lemma",De),Fe.dataset.normal=De,Fe.textContent=De)}r.set(v,A)}ae.updateAllHeaders(!0),ae.xScrollToHighlit(),I.doStack([I.doUnrenormalize,[r]],n)},doUnrenormalize:function(c,u="undo"){i.normalizedView()||ae.showNormalized();const p=new Map,n=[...f.trs()],r=[...f.texts()];for(const[s,h]of c.entries()){const m=n[s],v=r[s],A=new Map;for(const[M,T]of h.entries()){const V=f.firsttd(M,m),W=f.firstword(M,v),oe=W.hasAttribute("lemma")?W.getAttribute("lemma"):null;A.set(M,oe),T===null?(I.unnormalize(V),I.unnormalize(W)):(V.dataset.normal=T,W.setAttribute("lemma",T),V.textContent=T)}p.set(s,A)}I.doStack([I.doUnrenormalize,[p]],u)},unnormalize:function(c){c.hasOwnProperty("IAST")&&(c.textContent=c.IAST.textContent),c.dataset&&c.dataset.hasOwnProperty("normal")&&delete c.dataset.normal,c.getAttribute("lemma")&&c.removeAttribute("lemma")}},ae={toggleNormalize:function(){i.normalizedView()?ae.showUnnormalized():ae.showNormalized()},showNormalized:function(c){if(c)c.updatescript();else{document.getElementById("views").classList.add("normalized");for(const p of d.textboxes)p.updatescript();d.matrix.updatescript(),i.anyhighlit()?D.repopulateTrees(...f.lowhigh(f.highlit())):D.clearTrees()}ae.updateAllHeaders(!0),ae.xScrollToHighlit()},showUnnormalized:function(){document.getElementById("views").classList.remove("normalized"),d.matrix.updatescript();for(const c of d.textboxes)c.updatescript();i.anyhighlit()?D.repopulateTrees(...f.lowhigh(f.highlit())):D.clearTrees(),ae.updateAllHeaders(!0),ae.xScrollToHighlit()},toggleHeader:function(){const c=d.matrix.boxdiv.querySelector("tr.header");c.style.display==="none"?c.style.display="table-row":c.style.display="none"},updateHeaders(c){for(const u of c){const p=f.firstth(u),[n,r]=f.readings(u),s=p.querySelector("span.readings"),h=n<2?n:`${n}(${r.size})`;s.textContent=h}},updateAllHeaders(c=!1){const u=[...f.trs()],p=u.map(m=>f.trWalker(m)),n=[...f.tds(!1,u[0])],r=[...f.ths()],s=d.matrix.boxdiv.querySelector("tr.header"),h=function(){const m=document.createElement("th"),v=document.createElement("span");v.classList.add("readings"),m.appendChild(v);const A=document.createElement("form");return A.innerHTML='<div><input class="insignificant" type="checkbox">Insignificant</div><div><input class="binary" type="checkbox">Binary</div>',m.appendChild(A),s.appendChild(m),m};for(let m=0;m<n.length;m++){const v=m>=r.length?h():r[m],A=n[m];v.dataset.ref=A.dataset.n;let M=0;const T=new Set;for(const W of p){const oe=W.nextNode().textContent;oe!==""&&(M++,T.add(oe))}const V=M<2?M:`${M}(${T.size})`;v.querySelector("span.readings").textContent=V,c||(v.querySelector("input.insignificant").checked=!!A.dataset.insignificant,v.querySelector("input.binary").checked=!!A.dataset.binary)}if(r.length>n.length)for(let m=n.length;m<r.length;m++)s.removeChild(r[m])},xScrollToHighlit:function(){const c=f.highlit();c.size>0&&ae.xScroll([...c][0])},xScroll:function(c,u){if(!c)return;const p=u||f.firsttr(),n=f.firsttd(c,p),r=n.getBoundingClientRect(),s=d.matrix.boxdiv,m=s.getBoundingClientRect().right,v=p.querySelector("th").getBoundingClientRect(),A=v.right,M=r.right>m,T=r.left+.1<A;M&&n.scrollIntoView({inline:"end",block:"nearest"}),T&&(n.scrollIntoView({inline:"start",block:"nearest"}),s.scroll({left:s.scrollLeft-v.width}))}},re={create:function(c){const u=document.createElement("div");return u.classList.add("contextmenu"),u.style.left=c.clientX-12+"px",u.style.top=c.clientY-22+"px",u},remove:function(){for(const c of document.querySelectorAll(".contextmenu"))c.parentNode.removeChild(c)},show:function(c){document.body.appendChild(c)},populate:function(c,u){const p=document.createElement("ul");for(const n of u){const r=document.createElement("li");if(n.hasOwnProperty("cond")){const s=document.createRange().createContextualFragment('<form><input type="checkbox"'+(n.cond()?" checked":"")+"></form>");r.appendChild(s)}if(n.hasOwnProperty("toggle")){const s=n.toggle()?n.text:n.alt;r.appendChild(document.createTextNode(s))}else r.appendChild(document.createTextNode(n.text));r.addEventListener("mouseup",n.func),p.appendChild(r)}c.appendChild(p)}};class ge{constructor(u){this.name=u,this.box=document.createElement("div"),this.box.classList.add("menubox");const p=document.createElement("div");p.classList.add("heading"),p.appendChild(document.createTextNode(u)),this.box.appendChild(p),p.addEventListener("mouseover",this.checkConditions.bind(this)),this.box.addEventListener("mouseup",this.click.bind(this)),this.items=new Map,this.conditions=new Map}populate(u){const p=this.box.querySelector("ul")||function(n){const r=document.createElement("ul");return n.box.appendChild(r),r}(this);for(const n of u){const r=document.createElement("li");if(n.hasOwnProperty("checkbox")){const s=document.createElement("form"),h=document.createElement("input");h.type="checkbox",h.addEventListener("click",m=>m.preventDefault()),s.appendChild(h),r.appendChild(s),r.appendChild(document.createTextNode(n.text)),this.conditions.set(h,n.checkbox)}else if(n.hasOwnProperty("toggle")){const s=document.createElement("span");s.appendChild(document.createTextNode(n.text)),s.dataset.text=n.text,s.dataset.alt=n.alt,this.conditions.set(s,n.toggle),r.appendChild(s)}else r.appendChild(document.createTextNode(n.text));n.hasOwnProperty("greyout")&&this.conditions.set(r,n.greyout),this.items.set(r,n.func),p.appendChild(r)}}click(u){const p=u.target.tagName==="LI"?u.target:u.target.closest("li");if(p&&!p.classList.contains("greyedout")){const n=this.items.get(p);n&&(n(u),this.checkConditions())}}checkConditions(){const u=new Map;for(const[p,n]of this.conditions){const r=u.get(n)||function(){const s=n();return u.set(n,s),s}();p.tagName==="INPUT"?p.checked=r:p.tagName==="SPAN"?r?p.textContent=p.dataset.alt:p.textContent=p.dataset.text:p.tagName==="LI"&&(r?p.classList.remove("greyedout"):p.classList.add("greyedout"))}}}class xe{constructor(u){this.name=u,this.script=0}show(){d.descs.appendChild(this.descbox),i.normalizedView()&&ae.showNormalized(this),d.viewdiv.appendChild(this.boxdiv),this.closed=!1}clear(){for(;this.boxdiv.firstChild;)this.boxdiv.removeChild(this.boxdiv.firstChild);this.svgcontainer&&(this.clearsvg(),this.boxdiv.appendChild(this.svgcontainer))}destroy(){d.viewdiv.removeChild(this.boxdiv),d.descs.removeChild(this.descbox);const u=d.trees.indexOf(this);u>-1&&d.trees.splice(u,1);const p=d.textboxes.indexOf(this);p>-1&&d.textboxes.splice(p,1),this.closed=!0,this.name==="Matrix"&&(document.getElementById("matrixmenu").style.display="block"),R(),D.rehighlight()}pullout(){this.destroy();const u="menubar=no,location=no,status=no,height=620,width=620,scrollbars=yes,centerscreen=yes",p=window.mainWindow?window.mainWindow.comboView.getWindows().length:d.windows.length,n=window.open("branch.html","branch"+p,u);n.mainWindow=window.mainWindow?window.mainWindow:window,n.startbox=this.text?{text:{name:this.name}}:{tree:this.name},n.mainWindow.comboView.addWindow(n)}makeDescBox(){const u=document.createElement("div"),p=document.createElement("div");p.classList.add("closer"),p.innerHTML="x",p.title="close";const n=document.createElement("div");n.classList.add("scripter"),n.innerHTML="A",n.title="change script",u.appendChild(p),u.appendChild(n),u.appendChild(document.createTextNode(this.desc)),this.descbox=u,p.addEventListener("click",this.destroy.bind(this)),n.addEventListener("click",this.cyclescript.bind(this))}cyclescript(){this.script=this.script+1,this.script===d.scripts.length&&(this.script=0);const u=this.descbox.querySelector(".scripter");this.script===0?u.innerHTML="A":u.innerHTML=to[d.scripts[this.script]]("a"),d.scripts[this.script]==="grantha"?u.classList.add("grantha"):u.classList.remove("grantha"),this.updatescript()}updatescript(){const u=this.boxdiv.querySelectorAll(".lemma,.tree-lemma");for(const p of u){const n=p.dataset.hasOwnProperty("normal");if(!n&&p.textContent.trim()==="")continue;const r=function(){if(i.normalizedView()&&n){const h=document.createElement("span");return h.appendChild(document.createTextNode(p.dataset.normal)),h}else return p.IAST.cloneNode(!0)}(),s=this.script===0?r:Jt(r,d.scripts[this.script]);for(p.innerHTML="";s.firstChild;)p.appendChild(s.firstChild)}d.scripts[this.script]==="grantha"?this.boxdiv.classList.add("grantha"):this.boxdiv.classList.remove("grantha"),this.boxdiv.classList.contains("matrix")&&ae.xScrollToHighlit()}}class Y extends xe{constructor(u,p){super(`#${u} #${p}`),this.stemmaid=u,this.id=p,this.nexml=d.treelist.get(this.name).cloneNode(!0),this.desc=this.nexml.querySelector("tree").getAttribute("label")}init(){this.makeDescBox();const u=document.createElement("div");u.classList.add("tree-box");var p,n=0;do p="tree"+n,n++;while(document.getElementById(p));u.id=p,this.boxdiv=u,this.boxdiv.addEventListener("mouseover",X.treeMouseover.bind(this)),this.boxdiv.addEventListener("click",X.treeClick),this.svgcontainer=document.createElement("div"),this.svgcontainer.id=this.boxdiv.id+"container",this.boxdiv.appendChild(this.svgcontainer),this.boxdiv.myTree=this,this.calcPaths(),this.jiggleroot(),this.findLevels(),this.labelInternal()}show(){d.descs.appendChild(this.descbox),d.viewdiv.appendChild(this.boxdiv)}jiggleroot(){const u=this.nexml.evaluate('//nex:node[@root="true"]',this.nexml,this.nsResolver,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue,p=this.nexml.evaluate('//nex:edge[@source="'+u.id+'"]|//nex:edge[@target="'+u.id+'"]',this.nexml,this.nsResolver,XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE,null);if(p.snapshotLength===3){var n,r;for(let s=0;s<p.snapshotLength;s++){const h=p.snapshotItem(s),m=h.getAttribute("source"),v=h.getAttribute("target"),A=this.nexml.evaluate('//nex:node[@id="'+m+'"]',this.nexml,this.nsResolver,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue,M=this.nexml.evaluate('//nex:node[@id="'+v+'"]',this.nexml,this.nsResolver,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue;if(!A.hasAttribute("otu")&&!M.hasAttribute("otu")){n=h,r=v===u.id?"target":"source";break}}if(n){const s=this.nexml.createElementNS(u.namespaceURI,"node");s.id="fakeroot",s.setAttribute("root","true"),u.removeAttribute("root"),u.parentElement.insertBefore(s,u);const h=this.nexml.createElementNS(u.namespaceURI,"edge");h.id="newrootedge",h.setAttribute("length","0"),h.setAttribute("source","fakeroot"),h.setAttribute("target",u.id),u.parentElement.insertBefore(h,n),n.setAttribute(r,s.id)}}}findLevels(){const u=this.nexml.querySelectorAll("edge"),p=[...this.nexml.querySelectorAll("node[otu]")],n=this.nexml,r=[p],s=function(v,A){const M=v.map(ye=>ye.id),T=new Map,V=new Map,W=[];for(const ye of A){const Ae=ye.getAttribute("target"),Ee=ye.getAttribute("source"),_e=(()=>M.indexOf(Ae)!==-1?{ancestor:n.getElementById(Ee),child:n.getElementById(Ae)}:M.indexOf(Ee)!==-1?{ancestor:n.getElementById(Ae),child:n.getElementById(Ee)}:null)();if(_e!==null)if(V.has(_e.ancestor)){const ke=V.get(_e.ancestor);T.set(_e.ancestor,[ke.child,_e.child]),W.push(ye),W.push(ke.edge)}else V.set(_e.ancestor,{child:_e.child,edge:ye})}const oe=[...T.keys()],be=[...V.keys()].reduce((ye,Ae)=>(oe.indexOf(Ae)===-1&&ye.push(V.get(Ae).child),ye),[]),we=[...A].reduce((ye,Ae)=>(W.indexOf(Ae)===-1&&ye.push(Ae),ye),[]);return{match:T,remainder:[...new Set(be)],edges:we}};var h=p,m=u;do{const v=s(h,m);r.push(v.match),h=[...v.match.keys(),...v.remainder],m=v.edges}while(m.length>0);this.levels=f.serializedlevels(r)}labelInternal(){for(const u of this.nexml.querySelectorAll("node:not([label])"))u.setAttribute("label",u.id)}fitch(){const u=new Map(this.levels[0].map(n=>{const r=i.normalizedView(),s=this.nexml.querySelector(`node[id="${n}"]`).getAttribute("label"),h=this.boxdiv.querySelector(`span.tree-lemma[data-id="${s}"]`),m=h?f.htmlreading(h,r):void 0;return[n,m]})),p=new Wn(u,this.levels).run();for(const[n,r]of p){const s=this.boxdiv.querySelector(`span.internal[data-key="${n}"]`);s.dataset.reconstructed=r}}clearsvg(){for(;this.svgcontainer.firstChild;)this.svgcontainer.removeChild(this.svgcontainer.firstChild)}removecolors(){const u=this.nexml.querySelectorAll("node[color]");for(let p=0;p<u.snapshotLength;p++)u.snapshotItem(p).removeAttribute("color")}drawlines(u,p){if(this.removecolors(),u){const m=this.getPath(...u.split(";")).path,v=new Set;for(const A of m)v.add(A.getAttribute("target")),v.add(A.getAttribute("source"));for(const A of v){const M=this.nexml.evaluate('//nex:node[@id="'+A+'"]',this.nexml,this.nsResolver,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue;M.getAttribute("root")||M.setAttribute("color",p)}}const n=parseInt(window.getComputedStyle(this.svgcontainer,null).width)-15,r=parseInt(window.getComputedStyle(this.boxdiv,null).height)-10,s=function(){return r<600?600:r}();F.PhyloCanvas.Render.Style.line.stroke="rgb(162,164,170)",this.phylocanvas=new F.PhyloCanvas({nexml:this.nexml,fileSource:!0},this.svgcontainer.id,n,s);const h=this.svgcontainer.querySelectorAll('path:not([stroke="#a2a4aa"])');for(const m of h)m.style.strokeWidth="2"}draw(){this.clear(),this.drawlines(),this.makeLabels()}clearLabels(){for(const u of this.boxdiv.firstChild.querySelectorAll("text"))u.parentElement.removeChild(u)}makeLabels(){const u=[...f.texts()],p=new Set(u.map(r=>r.parentNode.getAttribute("n"))),n=new Map(u.filter(r=>r.parentNode.hasAttribute("corresp")&&r.parentNode.getAttribute("corresp")===this.name).map(r=>[r.parentNode.getAttribute("select").replace(/^#/,""),r.parentNode.getAttribute("n")]));for(const r of this.boxdiv.firstChild.querySelectorAll("text")){const s=document.createElement("div");s.setAttribute("class","tree-div");const h=parseInt(r.getAttribute("x")-5),m=parseInt(r.getAttribute("y"))-15;s.style.left=h+"px",s.style.top=m+"px";const v=r.textContent.trim();p.has(v)?s.innerHTML=`<span class="witness inactive" data-key="${v}">${v}</span><span class="tree-lemma ${v}" data-id="${v}"></span>`:v!=="fakeroot"?n.has(v)?s.innerHTML=`<span class="internal reconstructed" data-key="${v}" data-label="${n.get(v)}">${n.get(v)}</span><span class="tree-lemma invisible ${v}" data-id="${v}" data-label="${n.get(v)}"></span>`:s.innerHTML=`<span class="internal" data-key="${v}">0</span>`:s.innerHTML=`<span class="internal" data-key="${v}"></span>`,r.parentElement.removeChild(r),this.boxdiv.appendChild(s)}}clearlemmata(){for(const u of this.boxdiv.querySelectorAll("span.tree-lemma"))u.innerHTML="",u.dataset.hasOwnProperty("normal")&&delete u.dataset.normal,u.IAST=u.cloneNode(!0)}populate(u,p){const n=f.texts();for(const h of n){const m=h.parentNode.getAttribute("n"),v=this.boxdiv.querySelector(`span.tree-lemma[data-id="${m}"]`)||this.boxdiv.querySelector(`span.tree-lemma[data-label="${m}"]`);if(!!v){if(v.hasOwnProperty("IAST")||(v.IAST=v.cloneNode(!0)),v.IAST.innerHTML="",p){const A=[],M=[];var r=!1;for(let T=u;T<=p;T++){const V=f.firstword(T,h);A.push(V.innerHTML),V.hasAttribute("lemma")&&(M[T-u]=V.getAttribute("lemma")),V.hasAttribute("emended")&&(r=!0)}if(v.IAST.appendChild(N.transformString(A.join(" ").replace(/\s+/g," ").trim(),N.sheets.tree)),M.length!==0){const T=A.slice(0).map((W,oe)=>M.hasOwnProperty(oe)?M[oe]:W),V=document.createElement("span");V.appendChild(N.transformString(T.join(" ").replace(/\s+/g," ").trim(),N.sheets.tree)),v.dataset.normal=V.innerHTML}r?v.dataset.emended=!0:v.dataset.hasOwnProperty("emended")&&delete v.dataset.emended}else{const A=f.firstword(u,h);v.IAST.appendChild(N.transformString(A.innerHTML,N.sheets.tree)),A.hasAttribute("lemma")?v.dataset.normal=A.getAttribute("lemma"):delete v.dataset.normal,A.hasAttribute("emended")?v.dataset.emended=!0:v.dataset.hasOwnProperty("emended")&&delete v.dataset.emended}i.normalizedView()&&v.dataset.hasOwnProperty("normal")?v.innerHTML=v.dataset.normal:v.innerHTML=v.IAST.innerHTML}}const s=this.boxdiv.querySelectorAll(".inactive");for(const h of s)h.classList.remove("inactive");this.fitch()}calcPaths(){this.nodes=[],this.paths=[],this.longest={path:[]},this.nsResolver=this.nexml.createNSResolver(this.nexml.ownerDocument==null?this.nexml.documentElement:this.nexml.ownerDocument.documentElement);const u=this.nexml.evaluate("//nex:node[@label]",this.nexml,this.nsResolver,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE);for(let p=0;p<u.snapshotLength;p++)this.nodes.push(u.snapshotItem(p));for(let p=0;p<this.nodes.length;p++){const n=this.nodes[p],r=n.getAttribute("label"),s=n.id;for(let h=p+1;h<this.nodes.length;h++){const m=this.nodes[h],v=m.getAttribute("label"),A=m.id;this.paths.push({nodes:[r,v],path:this.pathFind(s,A)})}}for(const p of Object.keys(this.paths))this.paths[p].path.length>this.longest.path.length&&(this.longest=this.paths[p])}pathFind(u,p,n){n||(n=[]);const r=this.nexml.evaluate('//nex:edge[@source="'+u+'"]|//nex:edge[@target="'+u+'"]',this.nexml,this.nsResolver,XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE,null);var s;for(let h=0;h<r.snapshotLength;h++){const m=r.snapshotItem(h);if(s=[m],n.indexOf(m.id)!=-1)continue;n.push(m.id);const v=m.getAttribute("source")!==u?m.getAttribute("source"):m.getAttribute("target");if(v===p)return s;if(!this.nexml.evaluate('//nex:node[@id="'+v+'"]',this.nexml,this.nsResolver,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue.hasAttribute("otu")){const M=this.pathFind(v,p,n);if(M)return s.concat(M);continue}}return!1}analyzeVariants(u,p){const n=[],r=[],s=function(M){return M.startsWith("<lg")?N.transformString(M,N.sheets.lg).firstChild.data.slice(1):M},h=function(M){return M.map(T=>s(T)).join(" ").replace(/\s+/g," ").trim()},m=i.normalizedView()?function(M,T){const V=f.firstword(M,T);return V.hasAttribute("lemma")?V.getAttribute("lemma"):V.textContent}:function(M,T){return f.firstword(M,T).textContent};for(const M of f.texts()){const T=M.parentNode.getAttribute("n");if(!this.nexml.querySelector(`otu[label="${T}"]`))continue;const V=p?h(f.range(u,p).map(W=>m(W,M))):s(m(u,M));V===""?n.hasOwnProperty("")?n[""].push(T):n[""]=[T]:n.hasOwnProperty(V)?n[V].push(T):n[V]=[T]}const v={};for(const M of Object.keys(n)){var A={length:0,branch_length:0,paths:[]};if(n[M].length===1)A=!1;else for(let T=0;T<n[M].length;T++)for(let V=T+1;V<n[M].length;V++){const W=this.getPath(n[M][T],n[M][V]);if(W.hasOwnProperty("path")||alert(W),W.path.length===A.length){const oe=this.calcBranchLength(W.path);oe===A.branch_length?A.paths.push(W):oe>A.branch_length&&(A={length:W.path.length,branch_length:oe,paths:[W]})}else W.path.length>A.length&&(A={length:W.path.length,branch_length:this.calcBranchLength(W.path),paths:[W]})}v[M]=A}for(const M of Object.keys(r))v[M]=r[M];return v}getPath(u,p){for(const n of this.paths)if(n.nodes.indexOf(u)>-1&&n.nodes.indexOf(p)>-1)return n;return!1}calcBranchLength(u){return u.map(p=>p.getAttribute("length")).reduce((p,n)=>parseFloat(p)+parseFloat(n))}pickColour(u,p,n,r){var s=p,h=n,m=u;r&&(m=m*2,m>=1&&(m-=1,s=n,h=r));const v=h.red-s.red,A=h.green-s.green,M=h.blue-s.blue,T={red:parseInt(Math.floor(s.red+v*m),10),green:parseInt(Math.floor(s.green+A*m),10),blue:parseInt(Math.floor(s.blue+M*m),10)};return"rgb("+T.red+","+T.green+","+T.blue+")"}colourizeVariants(u,p){const n=this.analyzeVariants(u,p);for(const r of this.boxdiv.querySelectorAll("span.tree-lemma")){const s=n.hasOwnProperty(r.dataset.id)?n[n[r.dataset.id]]:n[r.textContent],h={red:252,green:70,blue:107},m={red:63,green:94,blue:251};s?(r.style.color=this.pickColour(s.length/this.longest.path.length,m,h),r.dataset.length=s.length,r.dataset.branch_length=s.branch_length,r.dataset.nodes=s.paths[0].nodes.join(";")):(r.style.color=this.pickColour(1/this.longest.path.length,m,h),r.dataset.length=0,r.dataset.branch_length=0,r.dataset.nodes=""),r.textContent.trim()===""?(r.innerHTML='<span lang="en">\xA0\xA0\xA0</span>',r.style.backgroundColor=r.style.color):r.style.backgroundColor=""}}}class fe extends xe{constructor(u){super(u),this.desc=u,this.text=f.firsttext(u)}init(){this.makeTextBox(),this.makeDescBox(),this.descbox.style.maxWidth="595px",this.descbox.style.paddingLeft="5px",this.boxdiv.addEventListener("mouseup",X.textMouseup)}refresh(){this.boxdiv.innerHTML="",this.boxdiv.appendChild(N.sheets.lemma.transformToFragment(this.text,document)),z(this.boxdiv);for(const u of f.lemmata(!1,this.boxdiv))u.IAST=u.cloneNode(!0);this.updatescript()}makeTextBox(){const u=document.createElement("div");u.dataset.id=this.name,u.classList.add("text-box"),u.appendChild(N.sheets.lemma.transformToFragment(this.text,document)),z(u);for(const p of f.lemmata(!1,u))p.IAST=p.cloneNode(!0);this.boxdiv=u}}class pe extends xe{constructor(){super(name),this.desc="Matrix",this.name="Matrix",this.makeDescBox(),this.makeViewBox(),this.descbox.style.maxWidth="100vw",this.descbox.style.paddingLeft="5px"}init(){this.makeTable()}makeViewBox(){const u=document.createElement("div");u.classList.add("matrix"),u.dataset.id=this.name,this.boxdiv=u}makeTable(){const u=document.createElement("div");u.classList.add("scroller"),u.append(N.sheets.matrix.transformToFragment(d.xml,document)),u.addEventListener("dragstart",X.thDragStart),u.addEventListener("dragenter",X.trDragEnter),u.addEventListener("dragleave",X.trDragLeave),u.addEventListener("dragover",v=>v.preventDefault()),u.addEventListener("drop",X.trDragDrop),u.addEventListener("mousedown",X.matrixMousedown);const p=document.createElement("tr");p.classList.add("header");const n=document.createElement("td");n.classList.add("anchor"),p.appendChild(n);const r=[...f.trs(u)],s=r.map(v=>f.trWalker(v)),h=f.tds(!1,r[0]);for(const v of h){const A=document.createElement("th");A.dataset.ref=v.dataset.n;let M=0;const T=new Set;for(const be of s){const we=be.nextNode();we.IAST=we.cloneNode(!0);const ye=we.textContent;ye!==""&&(M++,T.add(ye))}const V=M<2?M:`${M}(${T.size})`,W=document.createElement("span");W.classList.add("readings"),W.appendChild(document.createTextNode(V)),A.appendChild(W);const oe=document.createElement("form");oe.innerHTML='<div><input class="insignificant" title="insignificant" type="checkbox"'+(v.dataset.insignificant?"checked":"")+'></div><div><input class="binary" title="binary" type="checkbox"'+(v.dataset.binary?"checked":"")+"></div>",A.appendChild(oe),p.appendChild(A)}const m=u.querySelector("tbody");m.insertBefore(p,m.firstChild),this.boxdiv.append(u)}}return{branchinit:function(){comboView.init(),window.startbox!==void 0&&(window.startbox.tree?w.tree(window.startbox.tree.stemmaid,window.startbox.tree.id):window.startbox.text&&w.text(window.startbox.text.name,window.startbox.text.map))},maininit:function(){const c=document.getElementById("menu");c.addEventListener("mouseover",X.menuMouseover),c.addEventListener("mouseout",X.menuMouseout),c.addEventListener("click",X.menuClick),c.querySelector("#file").addEventListener("change",j.bind(null,Q),!1),c.querySelector("#treefile").addEventListener("change",j.bind(null,U),!1),c.style.display="block",comboView.init()},init:function(){d.viewdiv=document.getElementById("views"),d.descs=document.getElementById("descs"),d.viewdiv.addEventListener("click",X.textClick),document.addEventListener("keydown",X.keyDown,{capture:!0}),document.addEventListener("contextmenu",X.rightClick),document.addEventListener("mouseup",re.remove)},getWindows:function(){return d.windows},addWindow:function(c){d.windows.push(c)},getViewdiv:function(){return d.viewdiv},getTrees:function(){return d.trees}}}();window.addEventListener("load",window.comboView.maininit);
