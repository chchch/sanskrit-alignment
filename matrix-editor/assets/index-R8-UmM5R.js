import{showSaveFilePicker as jt}from"https://cdn.jsdelivr.net/npm/native-file-system-adapter/mod.js";(function(){const w=document.createElement("link").relList;if(w&&w.supports&&w.supports("modulepreload"))return;for(const C of document.querySelectorAll('link[rel="modulepreload"]'))z(C);new MutationObserver(C=>{for(const k of C)if(k.type==="childList")for(const f of k.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&z(f)}).observe(document,{childList:!0,subtree:!0});function T(C){const k={};return C.integrity&&(k.integrity=C.integrity),C.referrerPolicy&&(k.referrerPolicy=C.referrerPolicy),C.crossOrigin==="use-credentials"?k.credentials="include":C.crossOrigin==="anonymous"?k.credentials="omit":k.credentials="same-origin",k}function z(C){if(C.ep)return;C.ep=!0;const k=T(C);fetch(C.href,k)}})();var bn={};(function(h){h.__type__="csv";var w=typeof jQuery<"u"&&jQuery.Deferred||typeof _<"u"&&_.Deferred||function(){var a,o,x=new Promise(function(b,R){a=b,o=R});return{resolve:a,reject:o,promise:function(){return x}}};h.fetch=function(a){var o=new w;if(a.file){var x=new FileReader,b=a.encoding||"UTF-8";x.onload=function(F){var B=h.extractFields(h.parse(F.target.result,a),a);B.useMemoryStore=!0,B.metadata={filename:a.file.name},o.resolve(B)},x.onerror=function(F){o.reject({error:{message:"Failed to load file. Code: "+F.target.error.code}})},x.readAsText(a.file,b)}else if(a.data){var R=h.extractFields(h.parse(a.data,a),a);R.useMemoryStore=!0,o.resolve(R)}else if(a.url){var $=window.fetch||function(F){var B=jQuery.get(F),M={then:function(U){return B.done(U),M},catch:function(U){return B.fail(U),M}};return M};$(a.url).then(function(F){return F.text?F.text():F}).then(function(F){var B=h.extractFields(h.parse(F,a),a);B.useMemoryStore=!0,o.resolve(B)}).catch(function(F,B){o.reject({error:{message:"Failed to load file. "+F.statusText+". Code: "+F.status,request:F}})})}return o.promise()},h.extractFields=function(a,o){return o.noHeaderRow!==!0&&a.length>0?{fields:a[0],records:a.slice(1)}:{records:a}},h.normalizeDialectOptions=function(a){var o={delimiter:",",doublequote:!0,lineterminator:`
`,quotechar:'"',skipinitialspace:!0,skipinitialrows:0};for(var x in a)x==="trim"?o.skipinitialspace=a.trim:o[x.toLowerCase()]=a[x];return o},h.parse=function(a,o){(!o||o&&!o.lineterminator)&&(a=h.normalizeLineTerminator(a,o));var x=h.normalizeDialectOptions(o);a=f(a,x.lineterminator);var b="",R=!1,$=!1,F="",B=[],M=[],U,j;for(j=function(X){return $!==!0&&(X===""?X=null:x.skipinitialspace===!0&&(X=k(X)),T.test(X)?X=parseInt(X,10):z.test(X)&&(X=parseFloat(X,10))),X},U=0;U<a.length;U+=1)b=a.charAt(U),R===!1&&(b===x.delimiter||b===x.lineterminator)?(F=j(F),B.push(F),b===x.lineterminator&&(M.push(B),B=[]),F="",$=!1):b!==x.quotechar?F+=b:R?a.charAt(U+1)===x.quotechar?(F+=x.quotechar,U+=1):R=!1:(R=!0,$=!0);return F=j(F),B.push(F),M.push(B),x.skipinitialrows&&(M=M.slice(x.skipinitialrows)),M},h.normalizeLineTerminator=function(a,o){return o=o||{},o.lineterminator?a:a.replace(/(\r\n|\n|\r)/gm,`
`)},h.objectToArray=function(a){for(var o=[],x=[],b=[],R=0;R<a.fields.length;R++){var $=a.fields[R].id;b.push($);var F=a.fields[R].label?a.fields[R].label:$;x.push(F)}o.push(x);for(var R=0;R<a.records.length;R++){for(var B=[],M=a.records[R],U=0;U<b.length;U++)B.push(M[b[U]]);o.push(B)}return o},h.serialize=function(a,o){var x=null;a instanceof Array?x=a:x=h.objectToArray(a);var b=h.normalizeDialectOptions(o),R="",$="",F="",B="",M,U,j;for(j=function(X){return X===null?X="":typeof X=="string"&&C.test(X)?(b.doublequote&&(X=X.replace(/"/g,'""')),X=b.quotechar+X+b.quotechar):typeof X=="number"&&(X=X.toString(10)),X},M=0;M<x.length;M+=1)for(R=x[M],U=0;U<R.length;U+=1)$=j(R[U]),U===R.length-1?(F+=$,B+=F+b.lineterminator,F=""):F+=$+b.delimiter,$="";return B};var T=/^\d+$/,z=/^\d*\.\d+$|^\d+\.\d*$/,C=/^\s|\s$|,|"|\n/,k=function(){return String.prototype.trim?function(a){return a.trim()}:function(a){return a.replace(/^\s*/,"").replace(/\s*$/,"")}}();function f(a,o){return a.charAt(a.length-o.length)!==o?a:a.substring(0,a.length-o.length)}})(bn);function wn(h){return h&&h.__esModule&&Object.prototype.hasOwnProperty.call(h,"default")?h.default:h}var Cn={exports:{}};(function(h,w){(function(T,z){h.exports=z()})(window,function(){return function(T){var z={};function C(k){if(z[k])return z[k].exports;var f=z[k]={i:k,l:!1,exports:{}};return T[k].call(f.exports,f,f.exports,C),f.l=!0,f.exports}return C.m=T,C.c=z,C.d=function(k,f,a){C.o(k,f)||Object.defineProperty(k,f,{enumerable:!0,get:a})},C.r=function(k){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(k,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(k,"__esModule",{value:!0})},C.t=function(k,f){if(1&f&&(k=C(k)),8&f||4&f&&typeof k=="object"&&k&&k.__esModule)return k;var a=Object.create(null);if(C.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:k}),2&f&&typeof k!="string")for(var o in k)C.d(a,o,(function(x){return k[x]}).bind(null,o));return a},C.n=function(k){var f=k&&k.__esModule?function(){return k.default}:function(){return k};return C.d(f,"a",f),f},C.o=function(k,f){return Object.prototype.hasOwnProperty.call(k,f)},C.p="",C(C.s=1)}([function(T,z,C){var k,f;k=[C(2)],(f=(function(a){function o(e){if(o.is(e,"function"))return x?e():a.on("raphael.DOMload",e);if(o.is(e,u))return o._engine.create[X](o,e.splice(0,3+o.is(e[0],c))).add(e);var t=Array.prototype.slice.call(arguments,0);if(o.is(t[t.length-1],"function")){var i=t.pop();return x?i.call(o._engine.create[X](o,t)):a.on("raphael.DOMload",function(){i.call(o._engine.create[X](o,t))})}return o._engine.create[X](o,arguments)}o.version="2.3.0",o.eve=a;var x,b,R=/[, ]+/,$={circle:1,rect:1,path:1,ellipse:1,text:1,image:1},F=/\{(\d+)\}/g,B="hasOwnProperty",M={doc:document,win:window},U={was:Object.prototype[B].call(M.win,"Raphael"),is:M.win.Raphael},j=function(){this.ca=this.customAttributes={}},X="apply",G="concat",ae="ontouchstart"in window||window.TouchEvent||window.DocumentTouch&&document instanceof DocumentTouch,fe="",ve=" ",O=String,J="split",Y="click dblclick mousedown mousemove mouseout mouseover mouseup touchstart touchmove touchend touchcancel"[J](ve),I={mousedown:"touchstart",mousemove:"touchmove",mouseup:"touchend"},ue=O.prototype.toLowerCase,ne=Math,ge=ne.max,xe=ne.min,K=ne.abs,de=ne.pow,pe=ne.PI,c="number",u="array",p=Object.prototype.toString,n=(o._ISURL=/^url\(['"]?(.+?)['"]?\)$/i,/^\s*((#[a-f\d]{6})|(#[a-f\d]{3})|rgba?\(\s*([\d\.]+%?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+%?(?:\s*,\s*[\d\.]+%?)?)\s*\)|hsba?\(\s*([\d\.]+(?:deg|\xb0|%)?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+(?:%?\s*,\s*[\d\.]+)?)%?\s*\)|hsla?\(\s*([\d\.]+(?:deg|\xb0|%)?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+(?:%?\s*,\s*[\d\.]+)?)%?\s*\))\s*$/i),r={NaN:1,Infinity:1,"-Infinity":1},s=/^(?:cubic-)?bezier\(([^,]+),([^,]+),([^,]+),([^\)]+)\)/,d=ne.round,m=parseFloat,v=parseInt,A=O.prototype.toUpperCase,D=o._availableAttrs={"arrow-end":"none","arrow-start":"none",blur:0,"clip-rect":"0 0 1e9 1e9",cursor:"default",cx:0,cy:0,fill:"#fff","fill-opacity":1,font:'10px "Arial"',"font-family":'"Arial"',"font-size":"10","font-style":"normal","font-weight":400,gradient:0,height:0,href:"http://raphaeljs.com/","letter-spacing":0,opacity:1,path:"M0,0",r:0,rx:0,ry:0,src:"",stroke:"#000","stroke-dasharray":"","stroke-linecap":"butt","stroke-linejoin":"butt","stroke-miterlimit":0,"stroke-opacity":1,"stroke-width":1,target:"_blank","text-anchor":"middle",title:"Raphael",transform:"",width:0,x:0,y:0,class:""},N=o._availableAnimAttrs={blur:c,"clip-rect":"csv",cx:c,cy:c,fill:"colour","fill-opacity":c,"font-size":c,height:c,opacity:c,path:"path",r:c,rx:c,ry:c,stroke:"colour","stroke-opacity":c,"stroke-width":c,transform:"transform",width:c,x:c,y:c},V=/[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*/,W={hs:1,rg:1},ie=/,?([achlmqrstvxz]),?/gi,be=/([achlmrqstvz])[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029,]*((-?\d*\.?\d*(?:e[\-+]?\d+)?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*)+)/gi,Ce=/([rstm])[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029,]*((-?\d*\.?\d*(?:e[\-+]?\d+)?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*)+)/gi,ye=/(-?\d*\.?\d*(?:e[\-+]?\d+)?)[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*/gi,_e=(o._radial_gradient=/^r(?:\(([^,]+?)[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*([^\)]+?)\))?/,{}),Se=function(e,t){return m(e)-m(t)},Ae=function(e){return e},ke=o._rectPath=function(e,t,i,l,g){return g?[["M",e+g,t],["l",i-2*g,0],["a",g,g,0,0,1,g,g],["l",0,l-2*g],["a",g,g,0,0,1,-g,g],["l",2*g-i,0],["a",g,g,0,0,1,-g,-g],["l",0,2*g-l],["a",g,g,0,0,1,g,-g],["z"]]:[["M",e,t],["l",i,0],["l",0,l],["l",-i,0],["z"]]},Ne=function(e,t,i,l){return l==null&&(l=i),[["M",e,t],["m",0,-l],["a",i,l,0,1,1,0,2*l],["a",i,l,0,1,1,0,-2*l],["z"]]},Me=o._getPath={path:function(e){return e.attr("path")},circle:function(e){var t=e.attrs;return Ne(t.cx,t.cy,t.r)},ellipse:function(e){var t=e.attrs;return Ne(t.cx,t.cy,t.rx,t.ry)},rect:function(e){var t=e.attrs;return ke(t.x,t.y,t.width,t.height,t.r)},image:function(e){var t=e.attrs;return ke(t.x,t.y,t.width,t.height)},text:function(e){var t=e._getBBox();return ke(t.x,t.y,t.width,t.height)},set:function(e){var t=e._getBBox();return ke(t.x,t.y,t.width,t.height)}},De=o.mapPath=function(e,t){if(!t)return e;var i,l,g,S,P,E,L;for(g=0,P=(e=At(e)).length;g<P;g++)for(S=1,E=(L=e[g]).length;S<E;S+=2)i=t.x(L[S],L[S+1]),l=t.y(L[S],L[S+1]),L[S]=i,L[S+1]=l;return e};if(o._g=M,o.type=M.win.SVGAngle||M.doc.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1")?"SVG":"VML",o.type=="VML"){var Re,qe=M.doc.createElement("div");if(qe.innerHTML='<v:shape adj="1"/>',(Re=qe.firstChild).style.behavior="url(#default#VML)",!Re||typeof Re.adj!="object")return o.type=fe;qe=null}function Fe(e){if(typeof e=="function"||Object(e)!==e)return e;var t=new e.constructor;for(var i in e)e[B](i)&&(t[i]=Fe(e[i]));return t}o.svg=!(o.vml=o.type=="VML"),o._Paper=j,o.fn=b=j.prototype=o.prototype,o._id=0,o.is=function(e,t){return(t=ue.call(t))=="finite"?!r[B](+e):t=="array"?e instanceof Array:t=="null"&&e===null||t==typeof e&&e!==null||t=="object"&&e===Object(e)||t=="array"&&Array.isArray&&Array.isArray(e)||p.call(e).slice(8,-1).toLowerCase()==t},o.angle=function(e,t,i,l,g,S){if(g==null){var P=e-i,E=t-l;return P||E?(180+180*ne.atan2(-E,-P)/pe+360)%360:0}return o.angle(e,t,g,S)-o.angle(i,l,g,S)},o.rad=function(e){return e%360*pe/180},o.deg=function(e){return Math.round(180*e/pe%360*1e3)/1e3},o.snapTo=function(e,t,i){if(i=o.is(i,"finite")?i:10,o.is(e,u)){for(var l=e.length;l--;)if(K(e[l]-t)<=i)return e[l]}else{var g=t%(e=+e);if(g<i)return t-g;if(g>e-i)return t-g+e}return t};var je,Xe;o.createUUID=(je=/[xy]/g,Xe=function(e){var t=16*ne.random()|0;return(e=="x"?t:3&t|8).toString(16)},function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(je,Xe).toUpperCase()}),o.setWindow=function(e){a("raphael.setWindow",o,M.win,e),M.win=e,M.doc=M.win.document,o._engine.initWin&&o._engine.initWin(M.win)};var Ge=function(e){if(o.vml){var t,i=/^\s+|\s+$/g;try{var l=new ActiveXObject("htmlfile");l.write("<body>"),l.close(),t=l.body}catch{t=createPopup().document.body}var g=t.createTextRange();Ge=ze(function(P){try{t.style.color=O(P).replace(i,fe);var E=g.queryCommandValue("ForeColor");return"#"+("000000"+(E=(255&E)<<16|65280&E|(16711680&E)>>>16).toString(16)).slice(-6)}catch{return"none"}})}else{var S=M.doc.createElement("i");S.title="Raphaël Colour Picker",S.style.display="none",M.doc.body.appendChild(S),Ge=ze(function(P){return S.style.color=P,M.doc.defaultView.getComputedStyle(S,fe).getPropertyValue("color")})}return Ge(e)},lt=function(){return"hsb("+[this.h,this.s,this.b]+")"},ct=function(){return"hsl("+[this.h,this.s,this.l]+")"},kt=function(){return this.hex},ut=function(e,t,i){if(t==null&&o.is(e,"object")&&"r"in e&&"g"in e&&"b"in e&&(i=e.b,t=e.g,e=e.r),t==null&&o.is(e,"string")){var l=o.getRGB(e);e=l.r,t=l.g,i=l.b}return(e>1||t>1||i>1)&&(e/=255,t/=255,i/=255),[e,t,i]},Tt=function(e,t,i,l){var g={r:e*=255,g:t*=255,b:i*=255,hex:o.rgb(e,t,i),toString:kt};return o.is(l,"finite")&&(g.opacity=l),g};function ze(e,t,i){return function l(){var g=Array.prototype.slice.call(arguments,0),S=g.join("␀"),P=l.cache=l.cache||{},E=l.count=l.count||[];return P[B](S)?(function(L,H){for(var Z=0,oe=L.length;Z<oe;Z++)if(L[Z]===H)return L.push(L.splice(Z,1)[0])}(E,S),i?i(P[S]):P[S]):(E.length>=1e3&&delete P[E.shift()],E.push(S),P[S]=e[X](t,g),i?i(P[S]):P[S])}}o.color=function(e){var t;return o.is(e,"object")&&"h"in e&&"s"in e&&"b"in e?(t=o.hsb2rgb(e),e.r=t.r,e.g=t.g,e.b=t.b,e.hex=t.hex):o.is(e,"object")&&"h"in e&&"s"in e&&"l"in e?(t=o.hsl2rgb(e),e.r=t.r,e.g=t.g,e.b=t.b,e.hex=t.hex):(o.is(e,"string")&&(e=o.getRGB(e)),o.is(e,"object")&&"r"in e&&"g"in e&&"b"in e?(t=o.rgb2hsl(e),e.h=t.h,e.s=t.s,e.l=t.l,t=o.rgb2hsb(e),e.v=t.b):(e={hex:"none"}).r=e.g=e.b=e.h=e.s=e.v=e.l=-1),e.toString=kt,e},o.hsb2rgb=function(e,t,i,l){var g,S,P,E,L;return this.is(e,"object")&&"h"in e&&"s"in e&&"b"in e&&(i=e.b,t=e.s,l=e.o,e=e.h),E=(L=i*t)*(1-K((e=(e*=360)%360/60)%2-1)),g=S=P=i-L,Tt(g+=[L,E,0,0,E,L][e=~~e],S+=[E,L,L,E,0,0][e],P+=[0,0,E,L,L,E][e],l)},o.hsl2rgb=function(e,t,i,l){var g,S,P,E,L;return this.is(e,"object")&&"h"in e&&"s"in e&&"l"in e&&(i=e.l,t=e.s,e=e.h),(e>1||t>1||i>1)&&(e/=360,t/=100,i/=100),E=(L=2*t*(i<.5?i:1-i))*(1-K((e=(e*=360)%360/60)%2-1)),g=S=P=i-L/2,Tt(g+=[L,E,0,0,E,L][e=~~e],S+=[E,L,L,E,0,0][e],P+=[0,0,E,L,L,E][e],l)},o.rgb2hsb=function(e,t,i){var l,g;return e=(i=ut(e,t,i))[0],t=i[1],i=i[2],{h:(((g=(l=ge(e,t,i))-xe(e,t,i))==0?null:l==e?(t-i)/g:l==t?(i-e)/g+2:(e-t)/g+4)+360)%6*60/360,s:g==0?0:g/l,b:l,toString:lt}},o.rgb2hsl=function(e,t,i){var l,g,S,P;return e=(i=ut(e,t,i))[0],t=i[1],i=i[2],l=((g=ge(e,t,i))+(S=xe(e,t,i)))/2,{h:(((P=g-S)==0?null:g==e?(t-i)/P:g==t?(i-e)/P+2:(e-t)/P+4)+360)%6*60/360,s:P==0?0:l<.5?P/(2*l):P/(2-2*l),l,toString:ct}},o._path2string=function(){return this.join(",").replace(ie,"$1")},o._preload=function(e,t){var i=M.doc.createElement("img");i.style.cssText="position:absolute;left:-9999em;top:-9999em",i.onload=function(){t.call(this),this.onload=null,M.doc.body.removeChild(this)},i.onerror=function(){M.doc.body.removeChild(this)},M.doc.body.appendChild(i),i.src=e};function Qe(){return this.hex}function ht(e,t){for(var i=[],l=0,g=e.length;g-2*!t>l;l+=2){var S=[{x:+e[l-2],y:+e[l-1]},{x:+e[l],y:+e[l+1]},{x:+e[l+2],y:+e[l+3]},{x:+e[l+4],y:+e[l+5]}];t?l?g-4==l?S[3]={x:+e[0],y:+e[1]}:g-2==l&&(S[2]={x:+e[0],y:+e[1]},S[3]={x:+e[2],y:+e[3]}):S[0]={x:+e[g-2],y:+e[g-1]}:g-4==l?S[3]=S[2]:l||(S[0]={x:+e[l],y:+e[l+1]}),i.push(["C",(-S[0].x+6*S[1].x+S[2].x)/6,(-S[0].y+6*S[1].y+S[2].y)/6,(S[1].x+6*S[2].x-S[3].x)/6,(S[1].y+6*S[2].y-S[3].y)/6,S[2].x,S[2].y])}return i}o.getRGB=ze(function(e){if(!e||(e=O(e)).indexOf("-")+1)return{r:-1,g:-1,b:-1,hex:"none",error:1,toString:Qe};if(e=="none")return{r:-1,g:-1,b:-1,hex:"none",toString:Qe};!W[B](e.toLowerCase().substring(0,2))&&e.charAt()!="#"&&(e=Ge(e));var t,i,l,g,S,P,E=e.match(n);return E?(E[2]&&(l=v(E[2].substring(5),16),i=v(E[2].substring(3,5),16),t=v(E[2].substring(1,3),16)),E[3]&&(l=v((S=E[3].charAt(3))+S,16),i=v((S=E[3].charAt(2))+S,16),t=v((S=E[3].charAt(1))+S,16)),E[4]&&(P=E[4][J](V),t=m(P[0]),P[0].slice(-1)=="%"&&(t*=2.55),i=m(P[1]),P[1].slice(-1)=="%"&&(i*=2.55),l=m(P[2]),P[2].slice(-1)=="%"&&(l*=2.55),E[1].toLowerCase().slice(0,4)=="rgba"&&(g=m(P[3])),P[3]&&P[3].slice(-1)=="%"&&(g/=100)),E[5]?(P=E[5][J](V),t=m(P[0]),P[0].slice(-1)=="%"&&(t*=2.55),i=m(P[1]),P[1].slice(-1)=="%"&&(i*=2.55),l=m(P[2]),P[2].slice(-1)=="%"&&(l*=2.55),(P[0].slice(-3)=="deg"||P[0].slice(-1)=="°")&&(t/=360),E[1].toLowerCase().slice(0,4)=="hsba"&&(g=m(P[3])),P[3]&&P[3].slice(-1)=="%"&&(g/=100),o.hsb2rgb(t,i,l,g)):E[6]?(P=E[6][J](V),t=m(P[0]),P[0].slice(-1)=="%"&&(t*=2.55),i=m(P[1]),P[1].slice(-1)=="%"&&(i*=2.55),l=m(P[2]),P[2].slice(-1)=="%"&&(l*=2.55),(P[0].slice(-3)=="deg"||P[0].slice(-1)=="°")&&(t/=360),E[1].toLowerCase().slice(0,4)=="hsla"&&(g=m(P[3])),P[3]&&P[3].slice(-1)=="%"&&(g/=100),o.hsl2rgb(t,i,l,g)):((E={r:t,g:i,b:l,toString:Qe}).hex="#"+(16777216|l|i<<8|t<<16).toString(16).slice(1),o.is(g,"finite")&&(E.opacity=g),E)):{r:-1,g:-1,b:-1,hex:"none",error:1,toString:Qe}},o),o.hsb=ze(function(e,t,i){return o.hsb2rgb(e,t,i).hex}),o.hsl=ze(function(e,t,i){return o.hsl2rgb(e,t,i).hex}),o.rgb=ze(function(e,t,i){function l(g){return g+.5|0}return"#"+(16777216|l(i)|l(t)<<8|l(e)<<16).toString(16).slice(1)}),o.getColor=function(e){var t=this.getColor.start=this.getColor.start||{h:0,s:1,b:e||.75},i=this.hsb2rgb(t.h,t.s,t.b);return t.h+=.075,t.h>1&&(t.h=0,t.s-=.2,t.s<=0&&(this.getColor.start={h:0,s:1,b:t.b})),i.hex},o.getColor.reset=function(){delete this.start},o.parsePathString=function(e){if(!e)return null;var t=Ue(e);if(t.arr)return $e(t.arr);var i={a:7,c:6,h:1,l:2,m:2,r:4,q:4,s:4,t:2,v:1,z:0},l=[];return o.is(e,u)&&o.is(e[0],u)&&(l=$e(e)),l.length||O(e).replace(be,function(g,S,P){var E=[],L=S.toLowerCase();if(P.replace(ye,function(H,Z){Z&&E.push(+Z)}),L=="m"&&E.length>2&&(l.push([S][G](E.splice(0,2))),L="l",S=S=="m"?"l":"L"),L=="r")l.push([S][G](E));else for(;E.length>=i[L]&&(l.push([S][G](E.splice(0,i[L]))),i[L]););}),l.toString=o._path2string,t.arr=$e(l),l},o.parseTransformString=ze(function(e){if(!e)return null;var t=[];return o.is(e,u)&&o.is(e[0],u)&&(t=$e(e)),t.length||O(e).replace(Ce,function(i,l,g){var S=[];ue.call(l),g.replace(ye,function(P,E){E&&S.push(+E)}),t.push([l][G](S))}),t.toString=o._path2string,t},this,function(e){if(!e)return e;for(var t=[],i=0;i<e.length;i++){for(var l=[],g=0;g<e[i].length;g++)l.push(e[i][g]);t.push(l)}return t});var Ue=function(e){var t=Ue.ps=Ue.ps||{};return t[e]?t[e].sleep=100:t[e]={sleep:100},setTimeout(function(){for(var i in t)t[B](i)&&i!=e&&(t[i].sleep--,!t[i].sleep&&delete t[i])}),t[e]};function dt(e,t,i,l,g){return e*(e*(-3*t+9*i-9*l+3*g)+6*t-12*i+6*l)-3*t+3*i}function We(e,t,i,l,g,S,P,E,L){L==null&&(L=1);for(var H=(L=L>1?1:L<0?0:L)/2,Z=[-.1252,.1252,-.3678,.3678,-.5873,.5873,-.7699,.7699,-.9041,.9041,-.9816,.9816],oe=[.2491,.2491,.2335,.2335,.2032,.2032,.1601,.1601,.1069,.1069,.0472,.0472],te=0,Q=0;Q<12;Q++){var re=H*Z[Q]+H,le=dt(re,e,i,g,P),se=dt(re,t,l,S,E),ee=le*le+se*se;te+=oe[Q]*ne.sqrt(ee)}return H*te}function _t(e,t,i,l,g,S,P,E){if(!(ge(e,i)<xe(g,P)||xe(e,i)>ge(g,P)||ge(t,l)<xe(S,E)||xe(t,l)>ge(S,E))){var L=(e-i)*(S-E)-(t-l)*(g-P);if(L){var H=((e*l-t*i)*(g-P)-(e-i)*(g*E-S*P))/L,Z=((e*l-t*i)*(S-E)-(t-l)*(g*E-S*P))/L,oe=+H.toFixed(2),te=+Z.toFixed(2);if(!(oe<+xe(e,i).toFixed(2)||oe>+ge(e,i).toFixed(2)||oe<+xe(g,P).toFixed(2)||oe>+ge(g,P).toFixed(2)||te<+xe(t,l).toFixed(2)||te>+ge(t,l).toFixed(2)||te<+xe(S,E).toFixed(2)||te>+ge(S,E).toFixed(2)))return{x:H,y:Z}}}}function ft(e,t,i){var l=o.bezierBBox(e),g=o.bezierBBox(t);if(!o.isBBoxIntersect(l,g))return i?0:[];for(var S=We.apply(0,e),P=We.apply(0,t),E=ge(~~(S/5),1),L=ge(~~(P/5),1),H=[],Z=[],oe={},te=i?0:[],Q=0;Q<E+1;Q++){var re=o.findDotsAtSegment.apply(o,e.concat(Q/E));H.push({x:re.x,y:re.y,t:Q/E})}for(Q=0;Q<L+1;Q++)re=o.findDotsAtSegment.apply(o,t.concat(Q/L)),Z.push({x:re.x,y:re.y,t:Q/L});for(Q=0;Q<E;Q++)for(var le=0;le<L;le++){var se=H[Q],ee=H[Q+1],we=Z[le],ce=Z[le+1],me=K(ee.x-se.x)<.001?"y":"x",he=K(ce.x-we.x)<.001?"y":"x",Pe=_t(se.x,se.y,ee.x,ee.y,we.x,we.y,ce.x,ce.y);if(Pe){if(oe[Pe.x.toFixed(4)]==Pe.y.toFixed(4))continue;oe[Pe.x.toFixed(4)]=Pe.y.toFixed(4);var Ee=se.t+K((Pe[me]-se[me])/(ee[me]-se[me]))*(ee.t-se.t),Le=we.t+K((Pe[he]-we[he])/(ce[he]-we[he]))*(ce.t-we.t);Ee>=0&&Ee<=1.001&&Le>=0&&Le<=1.001&&(i?te++:te.push({x:Pe.x,y:Pe.y,t1:xe(Ee,1),t2:xe(Le,1)}))}}return te}function St(e,t,i){e=o._path2curve(e),t=o._path2curve(t);for(var l,g,S,P,E,L,H,Z,oe,te,Q=i?0:[],re=0,le=e.length;re<le;re++){var se=e[re];if(se[0]=="M")l=E=se[1],g=L=se[2];else{se[0]=="C"?(oe=[l,g].concat(se.slice(1)),l=oe[6],g=oe[7]):(oe=[l,g,l,g,E,L,E,L],l=E,g=L);for(var ee=0,we=t.length;ee<we;ee++){var ce=t[ee];if(ce[0]=="M")S=H=ce[1],P=Z=ce[2];else{ce[0]=="C"?(te=[S,P].concat(ce.slice(1)),S=te[6],P=te[7]):(te=[S,P,S,P,H,Z,H,Z],S=H,P=Z);var me=ft(oe,te,i);if(i)Q+=me;else{for(var he=0,Pe=me.length;he<Pe;he++)me[he].segment1=re,me[he].segment2=ee,me[he].bez1=oe,me[he].bez2=te;Q=Q.concat(me)}}}}}return Q}o.findDotsAtSegment=function(e,t,i,l,g,S,P,E,L){var H=1-L,Z=de(H,3),oe=de(H,2),te=L*L,Q=te*L,re=Z*e+3*oe*L*i+3*H*L*L*g+Q*P,le=Z*t+3*oe*L*l+3*H*L*L*S+Q*E,se=e+2*L*(i-e)+te*(g-2*i+e),ee=t+2*L*(l-t)+te*(S-2*l+t),we=i+2*L*(g-i)+te*(P-2*g+i),ce=l+2*L*(S-l)+te*(E-2*S+l),me=H*e+L*i,he=H*t+L*l,Pe=H*g+L*P,Ee=H*S+L*E,Le=90-180*ne.atan2(se-we,ee-ce)/pe;return(se>we||ee<ce)&&(Le+=180),{x:re,y:le,m:{x:se,y:ee},n:{x:we,y:ce},start:{x:me,y:he},end:{x:Pe,y:Ee},alpha:Le}},o.bezierBBox=function(e,t,i,l,g,S,P,E){o.is(e,"array")||(e=[e,t,i,l,g,S,P,E]);var L=Mt.apply(null,e);return{x:L.min.x,y:L.min.y,x2:L.max.x,y2:L.max.y,width:L.max.x-L.min.x,height:L.max.y-L.min.y}},o.isPointInsideBBox=function(e,t,i){return t>=e.x&&t<=e.x2&&i>=e.y&&i<=e.y2},o.isBBoxIntersect=function(e,t){var i=o.isPointInsideBBox;return i(t,e.x,e.y)||i(t,e.x2,e.y)||i(t,e.x,e.y2)||i(t,e.x2,e.y2)||i(e,t.x,t.y)||i(e,t.x2,t.y)||i(e,t.x,t.y2)||i(e,t.x2,t.y2)||(e.x<t.x2&&e.x>t.x||t.x<e.x2&&t.x>e.x)&&(e.y<t.y2&&e.y>t.y||t.y<e.y2&&t.y>e.y)},o.pathIntersection=function(e,t){return St(e,t)},o.pathIntersectionNumber=function(e,t){return St(e,t,1)},o.isPointInsidePath=function(e,t,i){var l=o.pathBBox(e);return o.isPointInsideBBox(l,t,i)&&St(e,[["M",t,i],["H",l.x2+10]],1)%2==1},o._removedFactory=function(e){return function(){a("raphael.log",null,"Raphaël: you are calling to method “"+e+"” of removed object",e)}};var Ze=o.pathBBox=function(e){var t=Ue(e);if(t.bbox)return Fe(t.bbox);if(!e)return{x:0,y:0,width:0,height:0,x2:0,y2:0};for(var i,l=0,g=0,S=[],P=[],E=0,L=(e=At(e)).length;E<L;E++)if((i=e[E])[0]=="M")l=i[1],g=i[2],S.push(l),P.push(g);else{var H=Mt(l,g,i[1],i[2],i[3],i[4],i[5],i[6]);S=S[G](H.min.x,H.max.x),P=P[G](H.min.y,H.max.y),l=i[5],g=i[6]}var Z=xe[X](0,S),oe=xe[X](0,P),te=ge[X](0,S),Q=ge[X](0,P),re=te-Z,le=Q-oe,se={x:Z,y:oe,x2:te,y2:Q,width:re,height:le,cx:Z+re/2,cy:oe+le/2};return t.bbox=Fe(se),se},$e=function(e){var t=Fe(e);return t.toString=o._path2string,t},Kt=o._pathToRelative=function(e){var t=Ue(e);if(t.rel)return $e(t.rel);o.is(e,u)&&o.is(e&&e[0],u)||(e=o.parsePathString(e));var i=[],l=0,g=0,S=0,P=0,E=0;e[0][0]=="M"&&(S=l=e[0][1],P=g=e[0][2],E++,i.push(["M",l,g]));for(var L=E,H=e.length;L<H;L++){var Z=i[L]=[],oe=e[L];if(oe[0]!=ue.call(oe[0]))switch(Z[0]=ue.call(oe[0]),Z[0]){case"a":Z[1]=oe[1],Z[2]=oe[2],Z[3]=oe[3],Z[4]=oe[4],Z[5]=oe[5],Z[6]=+(oe[6]-l).toFixed(3),Z[7]=+(oe[7]-g).toFixed(3);break;case"v":Z[1]=+(oe[1]-g).toFixed(3);break;case"m":S=oe[1],P=oe[2];default:for(var te=1,Q=oe.length;te<Q;te++)Z[te]=+(oe[te]-(te%2?l:g)).toFixed(3)}else{Z=i[L]=[],oe[0]=="m"&&(S=oe[1]+l,P=oe[2]+g);for(var re=0,le=oe.length;re<le;re++)i[L][re]=oe[re]}var se=i[L].length;switch(i[L][0]){case"z":l=S,g=P;break;case"h":l+=+i[L][se-1];break;case"v":g+=+i[L][se-1];break;default:l+=+i[L][se-2],g+=+i[L][se-1]}}return i.toString=o._path2string,t.rel=$e(i),i},pt=o._pathToAbsolute=function(e){var t=Ue(e);if(t.abs)return $e(t.abs);if(o.is(e,u)&&o.is(e&&e[0],u)||(e=o.parsePathString(e)),!e||!e.length)return[["M",0,0]];var i=[],l=0,g=0,S=0,P=0,E=0;e[0][0]=="M"&&(S=l=+e[0][1],P=g=+e[0][2],E++,i[0]=["M",l,g]);for(var L,H,Z=e.length==3&&e[0][0]=="M"&&e[1][0].toUpperCase()=="R"&&e[2][0].toUpperCase()=="Z",oe=E,te=e.length;oe<te;oe++){if(i.push(L=[]),(H=e[oe])[0]!=A.call(H[0]))switch(L[0]=A.call(H[0]),L[0]){case"A":L[1]=H[1],L[2]=H[2],L[3]=H[3],L[4]=H[4],L[5]=H[5],L[6]=+(H[6]+l),L[7]=+(H[7]+g);break;case"V":L[1]=+H[1]+g;break;case"H":L[1]=+H[1]+l;break;case"R":for(var Q=[l,g][G](H.slice(1)),re=2,le=Q.length;re<le;re++)Q[re]=+Q[re]+l,Q[++re]=+Q[re]+g;i.pop(),i=i[G](ht(Q,Z));break;case"M":S=+H[1]+l,P=+H[2]+g;default:for(re=1,le=H.length;re<le;re++)L[re]=+H[re]+(re%2?l:g)}else if(H[0]=="R")Q=[l,g][G](H.slice(1)),i.pop(),i=i[G](ht(Q,Z)),L=["R"][G](H.slice(-2));else for(var se=0,ee=H.length;se<ee;se++)L[se]=H[se];switch(L[0]){case"Z":l=S,g=P;break;case"H":l=L[1];break;case"V":g=L[1];break;case"M":S=L[L.length-2],P=L[L.length-1];default:l=L[L.length-2],g=L[L.length-1]}}return i.toString=o._path2string,t.abs=$e(i),i},mt=function(e,t,i,l){return[e,t,i,l,i,l]},et=function(e,t,i,l,g,S){return[1/3*e+2/3*i,1/3*t+2/3*l,1/3*g+2/3*i,1/3*S+2/3*l,g,S]},Nt=function(e,t,i,l,g,S,P,E,L,H){var Z,oe=120*pe/180,te=pe/180*(+g||0),Q=[],re=ze(function(mn,gn,qt){return{x:mn*ne.cos(qt)-gn*ne.sin(qt),y:mn*ne.sin(qt)+gn*ne.cos(qt)}});if(H)Ee=H[0],Le=H[1],he=H[2],Pe=H[3];else{e=(Z=re(e,t,-te)).x,t=Z.y,E=(Z=re(E,L,-te)).x,L=Z.y;var le=(e-E)/2,se=(t-L)/2,ee=le*le/(i*i)+se*se/(l*l);ee>1&&(i*=ee=ne.sqrt(ee),l*=ee);var we=i*i,ce=l*l,me=(S==P?-1:1)*ne.sqrt(K((we*ce-we*se*se-ce*le*le)/(we*se*se+ce*le*le))),he=me*i*se/l+(e+E)/2,Pe=me*-l*le/i+(t+L)/2,Ee=ne.asin(((t-Pe)/l).toFixed(9)),Le=ne.asin(((L-Pe)/l).toFixed(9));(Ee=e<he?pe-Ee:Ee)<0&&(Ee=2*pe+Ee),(Le=E<he?pe-Le:Le)<0&&(Le=2*pe+Le),P&&Ee>Le&&(Ee-=2*pe),!P&&Le>Ee&&(Le-=2*pe)}var xt=Le-Ee;if(K(xt)>oe){var Lt=Le,He=E,Ye=L;Le=Ee+oe*(P&&Le>Ee?1:-1),E=he+i*ne.cos(Le),L=Pe+l*ne.sin(Le),Q=Nt(E,L,i,l,g,0,P,He,Ye,[Le,Lt,he,Pe])}xt=Le-Ee;var vt=ne.cos(Ee),yt=ne.sin(Ee),It=ne.cos(Le),Je=ne.sin(Le),it=ne.tan(xt/4),Ft=4/3*i*it,un=4/3*l*it,hn=[e,t],bt=[e+Ft*yt,t-un*vt],dn=[E+Ft*Je,L-un*It],fn=[E,L];if(bt[0]=2*hn[0]-bt[0],bt[1]=2*hn[1]-bt[1],H)return[bt,dn,fn][G](Q);for(var pn=[],nt=0,Tn=(Q=[bt,dn,fn][G](Q).join()[J](",")).length;nt<Tn;nt++)pn[nt]=nt%2?re(Q[nt-1],Q[nt],te).y:re(Q[nt],Q[nt+1],te).x;return pn},rt=function(e,t,i,l,g,S,P,E,L){var H=1-L;return{x:de(H,3)*e+3*de(H,2)*L*i+3*H*L*L*g+de(L,3)*P,y:de(H,3)*t+3*de(H,2)*L*l+3*H*L*L*S+de(L,3)*E}},Mt=ze(function(e,t,i,l,g,S,P,E){var L,H=g-2*i+e-(P-2*g+i),Z=2*(i-e)-2*(g-i),oe=e-i,te=(-Z+ne.sqrt(Z*Z-4*H*oe))/2/H,Q=(-Z-ne.sqrt(Z*Z-4*H*oe))/2/H,re=[t,E],le=[e,P];return K(te)>"1e12"&&(te=.5),K(Q)>"1e12"&&(Q=.5),te>0&&te<1&&(L=rt(e,t,i,l,g,S,P,E,te),le.push(L.x),re.push(L.y)),Q>0&&Q<1&&(L=rt(e,t,i,l,g,S,P,E,Q),le.push(L.x),re.push(L.y)),H=S-2*l+t-(E-2*S+l),oe=t-l,te=(-(Z=2*(l-t)-2*(S-l))+ne.sqrt(Z*Z-4*H*oe))/2/H,Q=(-Z-ne.sqrt(Z*Z-4*H*oe))/2/H,K(te)>"1e12"&&(te=.5),K(Q)>"1e12"&&(Q=.5),te>0&&te<1&&(L=rt(e,t,i,l,g,S,P,E,te),le.push(L.x),re.push(L.y)),Q>0&&Q<1&&(L=rt(e,t,i,l,g,S,P,E,Q),le.push(L.x),re.push(L.y)),{min:{x:xe[X](0,le),y:xe[X](0,re)},max:{x:ge[X](0,le),y:ge[X](0,re)}}}),At=o._path2curve=ze(function(e,t){var i=!t&&Ue(e);if(!t&&i.curve)return $e(i.curve);for(var l=pt(e),g=t&&pt(t),S={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},P={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},E=function(me,he,Pe){var Ee,Le;if(!me)return["C",he.x,he.y,he.x,he.y,he.x,he.y];switch(!(me[0]in{T:1,Q:1})&&(he.qx=he.qy=null),me[0]){case"M":he.X=me[1],he.Y=me[2];break;case"A":me=["C"][G](Nt[X](0,[he.x,he.y][G](me.slice(1))));break;case"S":Pe=="C"||Pe=="S"?(Ee=2*he.x-he.bx,Le=2*he.y-he.by):(Ee=he.x,Le=he.y),me=["C",Ee,Le][G](me.slice(1));break;case"T":Pe=="Q"||Pe=="T"?(he.qx=2*he.x-he.qx,he.qy=2*he.y-he.qy):(he.qx=he.x,he.qy=he.y),me=["C"][G](et(he.x,he.y,he.qx,he.qy,me[1],me[2]));break;case"Q":he.qx=me[1],he.qy=me[2],me=["C"][G](et(he.x,he.y,me[1],me[2],me[3],me[4]));break;case"L":me=["C"][G](mt(he.x,he.y,me[1],me[2]));break;case"H":me=["C"][G](mt(he.x,he.y,me[1],he.y));break;case"V":me=["C"][G](mt(he.x,he.y,he.x,me[1]));break;case"Z":me=["C"][G](mt(he.x,he.y,he.X,he.Y))}return me},L=function(me,he){if(me[he].length>7){me[he].shift();for(var Pe=me[he];Pe.length;)Z[he]="A",g&&(oe[he]="A"),me.splice(he++,0,["C"][G](Pe.splice(0,6)));me.splice(he,1),le=ge(l.length,g&&g.length||0)}},H=function(me,he,Pe,Ee,Le){me&&he&&me[Le][0]=="M"&&he[Le][0]!="M"&&(he.splice(Le,0,["M",Ee.x,Ee.y]),Pe.bx=0,Pe.by=0,Pe.x=me[Le][1],Pe.y=me[Le][2],le=ge(l.length,g&&g.length||0))},Z=[],oe=[],te="",Q="",re=0,le=ge(l.length,g&&g.length||0);re<le;re++){l[re]&&(te=l[re][0]),te!="C"&&(Z[re]=te,re&&(Q=Z[re-1])),l[re]=E(l[re],S,Q),Z[re]!="A"&&te=="C"&&(Z[re]="C"),L(l,re),g&&(g[re]&&(te=g[re][0]),te!="C"&&(oe[re]=te,re&&(Q=oe[re-1])),g[re]=E(g[re],P,Q),oe[re]!="A"&&te=="C"&&(oe[re]="C"),L(g,re)),H(l,g,S,P,re),H(g,l,P,S,re);var se=l[re],ee=g&&g[re],we=se.length,ce=g&&ee.length;S.x=se[we-2],S.y=se[we-1],S.bx=m(se[we-4])||S.x,S.by=m(se[we-3])||S.y,P.bx=g&&(m(ee[ce-4])||P.x),P.by=g&&(m(ee[ce-3])||P.y),P.x=g&&ee[ce-2],P.y=g&&ee[ce-1]}return g||(i.curve=$e(l)),g?[l,g]:l},null,$e),Dt=(o._parseDots=ze(function(e){for(var t=[],i=0,l=e.length;i<l;i++){var g={},S=e[i].match(/^([^:]*):?([\d\.]*)/);if(g.color=o.getRGB(S[1]),g.color.error)return null;g.opacity=g.color.opacity,g.color=g.color.hex,S[2]&&(g.offset=S[2]+"%"),t.push(g)}for(i=1,l=t.length-1;i<l;i++)if(!t[i].offset){for(var P=m(t[i-1].offset||0),E=0,L=i+1;L<l;L++)if(t[L].offset){E=t[L].offset;break}E||(E=100,L=l);for(var H=((E=m(E))-P)/(L-i+1);i<L;i++)P+=H,t[i].offset=P+"%"}return t}),o._tear=function(e,t){e==t.top&&(t.top=e.prev),e==t.bottom&&(t.bottom=e.next),e.next&&(e.next.prev=e.prev),e.prev&&(e.prev.next=e.next)}),_n=(o._tofront=function(e,t){t.top!==e&&(Dt(e,t),e.next=null,e.prev=t.top,t.top.next=e,t.top=e)},o._toback=function(e,t){t.bottom!==e&&(Dt(e,t),e.next=t.bottom,e.prev=null,t.bottom.prev=e,t.bottom=e)},o._insertafter=function(e,t,i){Dt(e,i),t==i.top&&(i.top=e),t.next&&(t.next.prev=e),e.next=t.next,e.prev=t,t.next=e},o._insertbefore=function(e,t,i){Dt(e,i),t==i.bottom&&(i.bottom=e),t.prev&&(t.prev.next=e),e.prev=t.prev,t.prev=e,e.next=t},o.toMatrix=function(e,t){var i=Ze(e),l={_:{transform:fe},getBBox:function(){return i}};return Jt(l,t),l.matrix}),Jt=(o.transformPath=function(e,t){return De(e,_n(e,t))},o._extractTransform=function(e,t){if(t==null)return e._.transform;t=O(t).replace(/\.{3}|\u2026/g,e._.transform||fe);var i,l,g=o.parseTransformString(t),S=0,P=1,E=1,L=e._,H=new st;if(L.transform=g||[],g)for(var Z=0,oe=g.length;Z<oe;Z++){var te,Q,re,le,se,ee=g[Z],we=ee.length,ce=O(ee[0]).toLowerCase(),me=ee[0]!=ce,he=me?H.invert():0;ce=="t"&&we==3?me?(te=he.x(0,0),Q=he.y(0,0),re=he.x(ee[1],ee[2]),le=he.y(ee[1],ee[2]),H.translate(re-te,le-Q)):H.translate(ee[1],ee[2]):ce=="r"?we==2?(se=se||e.getBBox(1),H.rotate(ee[1],se.x+se.width/2,se.y+se.height/2),S+=ee[1]):we==4&&(me?(re=he.x(ee[2],ee[3]),le=he.y(ee[2],ee[3]),H.rotate(ee[1],re,le)):H.rotate(ee[1],ee[2],ee[3]),S+=ee[1]):ce=="s"?we==2||we==3?(se=se||e.getBBox(1),H.scale(ee[1],ee[we-1],se.x+se.width/2,se.y+se.height/2),P*=ee[1],E*=ee[we-1]):we==5&&(me?(re=he.x(ee[3],ee[4]),le=he.y(ee[3],ee[4]),H.scale(ee[1],ee[2],re,le)):H.scale(ee[1],ee[2],ee[3],ee[4]),P*=ee[1],E*=ee[2]):ce=="m"&&we==7&&H.add(ee[1],ee[2],ee[3],ee[4],ee[5],ee[6]),L.dirtyT=1,e.matrix=H}e.matrix=H,L.sx=P,L.sy=E,L.deg=S,L.dx=i=H.e,L.dy=l=H.f,P==1&&E==1&&!S&&L.bbox?(L.bbox.x+=+i,L.bbox.y+=+l):L.dirtyT=1}),Qt=function(e){var t=e[0];switch(t.toLowerCase()){case"t":return[t,0,0];case"m":return[t,1,0,0,1,0,0];case"r":return e.length==4?[t,0,e[2],e[3]]:[t,0];case"s":return e.length==5?[t,1,1,e[3],e[4]]:e.length==3?[t,1,1]:[t,1]}},Sn=o._equaliseTransform=function(e,t){t=O(t).replace(/\.{3}|\u2026/g,e),e=o.parseTransformString(e)||[],t=o.parseTransformString(t)||[];for(var i,l,g,S,P=ge(e.length,t.length),E=[],L=[],H=0;H<P;H++){if(g=e[H]||Qt(t[H]),S=t[H]||Qt(g),g[0]!=S[0]||g[0].toLowerCase()=="r"&&(g[2]!=S[2]||g[3]!=S[3])||g[0].toLowerCase()=="s"&&(g[3]!=S[3]||g[4]!=S[4]))return;for(E[H]=[],L[H]=[],i=0,l=ge(g.length,S.length);i<l;i++)i in g&&(E[H][i]=g[i]),i in S&&(L[H][i]=S[i])}return{from:E,to:L}};function st(e,t,i,l,g,S){e!=null?(this.a=+e,this.b=+t,this.c=+i,this.d=+l,this.e=+g,this.f=+S):(this.a=1,this.b=0,this.c=0,this.d=1,this.e=0,this.f=0)}o._getContainer=function(e,t,i,l){var g;if((g=l!=null||o.is(e,"object")?e:M.doc.getElementById(e))!=null)return g.tagName?t==null?{container:g,width:g.style.pixelWidth||g.offsetWidth,height:g.style.pixelHeight||g.offsetHeight}:{container:g,width:t,height:i}:{container:1,x:e,y:t,width:i,height:l}},o.pathToRelative=Kt,o._engine={},o.path2curve=At,o.matrix=function(e,t,i,l,g,S){return new st(e,t,i,l,g,S)},function(e){function t(l){return l[0]*l[0]+l[1]*l[1]}function i(l){var g=ne.sqrt(t(l));l[0]&&(l[0]/=g),l[1]&&(l[1]/=g)}e.add=function(l,g,S,P,E,L){var H,Z,oe,te,Q=[[],[],[]],re=[[this.a,this.c,this.e],[this.b,this.d,this.f],[0,0,1]],le=[[l,S,E],[g,P,L],[0,0,1]];for(l&&l instanceof st&&(le=[[l.a,l.c,l.e],[l.b,l.d,l.f],[0,0,1]]),H=0;H<3;H++)for(Z=0;Z<3;Z++){for(te=0,oe=0;oe<3;oe++)te+=re[H][oe]*le[oe][Z];Q[H][Z]=te}this.a=Q[0][0],this.b=Q[1][0],this.c=Q[0][1],this.d=Q[1][1],this.e=Q[0][2],this.f=Q[1][2]},e.invert=function(){var l=this,g=l.a*l.d-l.b*l.c;return new st(l.d/g,-l.b/g,-l.c/g,l.a/g,(l.c*l.f-l.d*l.e)/g,(l.b*l.e-l.a*l.f)/g)},e.clone=function(){return new st(this.a,this.b,this.c,this.d,this.e,this.f)},e.translate=function(l,g){this.add(1,0,0,1,l,g)},e.scale=function(l,g,S,P){g==null&&(g=l),(S||P)&&this.add(1,0,0,1,S,P),this.add(l,0,0,g,0,0),(S||P)&&this.add(1,0,0,1,-S,-P)},e.rotate=function(l,g,S){l=o.rad(l),g=g||0,S=S||0;var P=+ne.cos(l).toFixed(9),E=+ne.sin(l).toFixed(9);this.add(P,E,-E,P,g,S),this.add(1,0,0,1,-g,-S)},e.x=function(l,g){return l*this.a+g*this.c+this.e},e.y=function(l,g){return l*this.b+g*this.d+this.f},e.get=function(l){return+this[O.fromCharCode(97+l)].toFixed(4)},e.toString=function(){return o.svg?"matrix("+[this.get(0),this.get(1),this.get(2),this.get(3),this.get(4),this.get(5)].join()+")":[this.get(0),this.get(2),this.get(1),this.get(3),0,0].join()},e.toFilter=function(){return"progid:DXImageTransform.Microsoft.Matrix(M11="+this.get(0)+", M12="+this.get(2)+", M21="+this.get(1)+", M22="+this.get(3)+", Dx="+this.get(4)+", Dy="+this.get(5)+", sizingmethod='auto expand')"},e.offset=function(){return[this.e.toFixed(4),this.f.toFixed(4)]},e.split=function(){var l={};l.dx=this.e,l.dy=this.f;var g=[[this.a,this.c],[this.b,this.d]];l.scalex=ne.sqrt(t(g[0])),i(g[0]),l.shear=g[0][0]*g[1][0]+g[0][1]*g[1][1],g[1]=[g[1][0]-g[0][0]*l.shear,g[1][1]-g[0][1]*l.shear],l.scaley=ne.sqrt(t(g[1])),i(g[1]),l.shear/=l.scaley;var S=-g[0][1],P=g[1][1];return P<0?(l.rotate=o.deg(ne.acos(P)),S<0&&(l.rotate=360-l.rotate)):l.rotate=o.deg(ne.asin(S)),l.isSimple=!(+l.shear.toFixed(9)||l.scalex.toFixed(9)!=l.scaley.toFixed(9)&&l.rotate),l.isSuperSimple=!+l.shear.toFixed(9)&&l.scalex.toFixed(9)==l.scaley.toFixed(9)&&!l.rotate,l.noRotation=!+l.shear.toFixed(9)&&!l.rotate,l},e.toTransformString=function(l){var g=l||this[J]();return g.isSimple?(g.scalex=+g.scalex.toFixed(4),g.scaley=+g.scaley.toFixed(4),g.rotate=+g.rotate.toFixed(4),(g.dx||g.dy?"t"+[g.dx,g.dy]:fe)+(g.scalex!=1||g.scaley!=1?"s"+[g.scalex,g.scaley,0,0]:fe)+(g.rotate?"r"+[g.rotate,0,0]:fe)):"m"+[this.get(0),this.get(1),this.get(2),this.get(3),this.get(4),this.get(5)]}}(st.prototype);for(var An=function(){this.returnValue=!1},En=function(){return this.originalEvent.preventDefault()},Pn=function(){this.cancelBubble=!0},Ln=function(){return this.originalEvent.stopPropagation()},Zt=function(e){var t=M.doc.documentElement.scrollTop||M.doc.body.scrollTop,i=M.doc.documentElement.scrollLeft||M.doc.body.scrollLeft;return{x:e.clientX+i,y:e.clientY+t}},Rn=M.doc.addEventListener?function(e,t,i,l){var g=function(P){var E=Zt(P);return i.call(l,P,E.x,E.y)};if(e.addEventListener(t,g,!1),ae&&I[t]){var S=function(P){for(var E=Zt(P),L=P,H=0,Z=P.targetTouches&&P.targetTouches.length;H<Z;H++)if(P.targetTouches[H].target==e){(P=P.targetTouches[H]).originalEvent=L,P.preventDefault=En,P.stopPropagation=Ln;break}return i.call(l,P,E.x,E.y)};e.addEventListener(I[t],S,!1)}return function(){return e.removeEventListener(t,g,!1),ae&&I[t]&&e.removeEventListener(I[t],S,!1),!0}}:M.doc.attachEvent?function(e,t,i,l){var g=function(S){S=S||M.win.event;var P=M.doc.documentElement.scrollTop||M.doc.body.scrollTop,E=M.doc.documentElement.scrollLeft||M.doc.body.scrollLeft,L=S.clientX+E,H=S.clientY+P;return S.preventDefault=S.preventDefault||An,S.stopPropagation=S.stopPropagation||Pn,i.call(l,S,L,H)};return e.attachEvent("on"+t,g),function(){return e.detachEvent("on"+t,g),!0}}:void 0,tt=[],Ot=function(e){for(var t,i=e.clientX,l=e.clientY,g=M.doc.documentElement.scrollTop||M.doc.body.scrollTop,S=M.doc.documentElement.scrollLeft||M.doc.body.scrollLeft,P=tt.length;P--;){if(t=tt[P],ae&&e.touches){for(var E,L=e.touches.length;L--;)if((E=e.touches[L]).identifier==t.el._drag.id){i=E.clientX,l=E.clientY,(e.originalEvent?e.originalEvent:e).preventDefault();break}}else e.preventDefault();var H,Z=t.el.node,oe=Z.nextSibling,te=Z.parentNode,Q=Z.style.display;M.win.opera&&te.removeChild(Z),Z.style.display="none",H=t.el.paper.getElementByPoint(i,l),Z.style.display=Q,M.win.opera&&(oe?te.insertBefore(Z,oe):te.appendChild(Z)),H&&a("raphael.drag.over."+t.el.id,t.el,H),i+=S,l+=g,a("raphael.drag.move."+t.el.id,t.move_scope||t.el,i-t.el._drag.x,l-t.el._drag.y,i,l,e)}},$t=function(e){o.unmousemove(Ot).unmouseup($t);for(var t,i=tt.length;i--;)(t=tt[i]).el._drag={},a("raphael.drag.end."+t.el.id,t.end_scope||t.start_scope||t.move_scope||t.el,e);tt=[]},Te=o.el={},en=Y.length;en--;)(function(e){o[e]=Te[e]=function(t,i){return o.is(t,"function")&&(this.events=this.events||[],this.events.push({name:e,f:t,unbind:Rn(this.shape||this.node||M.doc,e,t,i||this)})),this},o["un"+e]=Te["un"+e]=function(t){for(var i=this.events||[],l=i.length;l--;)i[l].name!=e||!o.is(t,"undefined")&&i[l].f!=t||(i[l].unbind(),i.splice(l,1),!i.length&&delete this.events);return this}})(Y[en]);Te.data=function(e,t){var i=_e[this.id]=_e[this.id]||{};if(arguments.length==0)return i;if(arguments.length==1){if(o.is(e,"object")){for(var l in e)e[B](l)&&this.data(l,e[l]);return this}return a("raphael.data.get."+this.id,this,i[e],e),i[e]}return i[e]=t,a("raphael.data.set."+this.id,this,t,e),this},Te.removeData=function(e){return e==null?delete _e[this.id]:_e[this.id]&&delete _e[this.id][e],this},Te.getData=function(){return Fe(_e[this.id]||{})},Te.hover=function(e,t,i,l){return this.mouseover(e,i).mouseout(t,l||i)},Te.unhover=function(e,t){return this.unmouseover(e).unmouseout(t)};var gt=[];Te.drag=function(e,t,i,l,g,S){function P(E){(E.originalEvent||E).preventDefault();var L=E.clientX,H=E.clientY,Z=M.doc.documentElement.scrollTop||M.doc.body.scrollTop,oe=M.doc.documentElement.scrollLeft||M.doc.body.scrollLeft;if(this._drag.id=E.identifier,ae&&E.touches){for(var te,Q=E.touches.length;Q--;)if(te=E.touches[Q],this._drag.id=te.identifier,te.identifier==this._drag.id){L=te.clientX,H=te.clientY;break}}this._drag.x=L+oe,this._drag.y=H+Z,!tt.length&&o.mousemove(Ot).mouseup($t),tt.push({el:this,move_scope:l,start_scope:g,end_scope:S}),t&&a.on("raphael.drag.start."+this.id,t),e&&a.on("raphael.drag.move."+this.id,e),i&&a.on("raphael.drag.end."+this.id,i),a("raphael.drag.start."+this.id,g||l||this,this._drag.x,this._drag.y,E)}return this._drag={},gt.push({el:this,start:P}),this.mousedown(P),this},Te.onDragOver=function(e){e?a.on("raphael.drag.over."+this.id,e):a.unbind("raphael.drag.over."+this.id)},Te.undrag=function(){for(var e=gt.length;e--;)gt[e].el==this&&(this.unmousedown(gt[e].start),gt.splice(e,1),a.unbind("raphael.drag.*."+this.id));!gt.length&&o.unmousemove(Ot).unmouseup($t),tt=[]},b.circle=function(e,t,i){var l=o._engine.circle(this,e||0,t||0,i||0);return this.__set__&&this.__set__.push(l),l},b.rect=function(e,t,i,l,g){var S=o._engine.rect(this,e||0,t||0,i||0,l||0,g||0);return this.__set__&&this.__set__.push(S),S},b.ellipse=function(e,t,i,l){var g=o._engine.ellipse(this,e||0,t||0,i||0,l||0);return this.__set__&&this.__set__.push(g),g},b.path=function(e){e&&!o.is(e,"string")&&!o.is(e[0],u)&&(e+=fe);var t=o._engine.path(o.format[X](o,arguments),this);return this.__set__&&this.__set__.push(t),t},b.image=function(e,t,i,l,g){var S=o._engine.image(this,e||"about:blank",t||0,i||0,l||0,g||0);return this.__set__&&this.__set__.push(S),S},b.text=function(e,t,i){var l=o._engine.text(this,e||0,t||0,O(i));return this.__set__&&this.__set__.push(l),l},b.set=function(e){!o.is(e,"array")&&(e=Array.prototype.splice.call(arguments,0,arguments.length));var t=new Pt(e);return this.__set__&&this.__set__.push(t),t.paper=this,t.type="set",t},b.setStart=function(e){this.__set__=e||this.set()},b.setFinish=function(e){var t=this.__set__;return delete this.__set__,t},b.getSize=function(){var e=this.canvas.parentNode;return{width:e.offsetWidth,height:e.offsetHeight}},b.setSize=function(e,t){return o._engine.setSize.call(this,e,t)},b.setViewBox=function(e,t,i,l,g){return o._engine.setViewBox.call(this,e,t,i,l,g)},b.top=b.bottom=null,b.raphael=o;function tn(){return this.x+ve+this.y+ve+this.width+" × "+this.height}b.getElementByPoint=function(e,t){var i,l,g,S,P,E,L,H=this.canvas,Z=M.doc.elementFromPoint(e,t);if(M.win.opera&&Z.tagName=="svg"){var oe=(l=(i=H).getBoundingClientRect(),g=i.ownerDocument,S=g.body,P=g.documentElement,E=P.clientTop||S.clientTop||0,L=P.clientLeft||S.clientLeft||0,{y:l.top+(M.win.pageYOffset||P.scrollTop||S.scrollTop)-E,x:l.left+(M.win.pageXOffset||P.scrollLeft||S.scrollLeft)-L}),te=H.createSVGRect();te.x=e-oe.x,te.y=t-oe.y,te.width=te.height=1;var Q=H.getIntersectionList(te,null);Q.length&&(Z=Q[Q.length-1])}if(!Z)return null;for(;Z.parentNode&&Z!=H.parentNode&&!Z.raphael;)Z=Z.parentNode;return Z==this.canvas.parentNode&&(Z=H),Z=Z&&Z.raphael?this.getById(Z.raphaelid):null},b.getElementsByBBox=function(e){var t=this.set();return this.forEach(function(i){o.isBBoxIntersect(i.getBBox(),e)&&t.push(i)}),t},b.getById=function(e){for(var t=this.bottom;t;){if(t.id==e)return t;t=t.next}return null},b.forEach=function(e,t){for(var i=this.bottom;i;){if(e.call(t,i)===!1)return this;i=i.next}return this},b.getElementsByPoint=function(e,t){var i=this.set();return this.forEach(function(l){l.isPointInside(e,t)&&i.push(l)}),i},Te.isPointInside=function(e,t){var i=this.realPath=Me[this.type](this);return this.attr("transform")&&this.attr("transform").length&&(i=o.transformPath(i,this.attr("transform"))),o.isPointInsidePath(i,e,t)},Te.getBBox=function(e){if(this.removed)return{};var t=this._;return e?(!t.dirty&&t.bboxwt||(this.realPath=Me[this.type](this),t.bboxwt=Ze(this.realPath),t.bboxwt.toString=tn,t.dirty=0),t.bboxwt):((t.dirty||t.dirtyT||!t.bbox)&&(!t.dirty&&this.realPath||(t.bboxwt=0,this.realPath=Me[this.type](this)),t.bbox=Ze(De(this.realPath,this.matrix)),t.bbox.toString=tn,t.dirty=t.dirtyT=0),t.bbox)},Te.clone=function(){if(this.removed)return null;var e=this.paper[this.type]().attr(this.attr());return this.__set__&&this.__set__.push(e),e},Te.glow=function(e){if(this.type=="text")return null;var t={width:((e=e||{}).width||10)+(+this.attr("stroke-width")||1),fill:e.fill||!1,opacity:e.opacity==null?.5:e.opacity,offsetx:e.offsetx||0,offsety:e.offsety||0,color:e.color||"#000"},i=t.width/2,l=this.paper,g=l.set(),S=this.realPath||Me[this.type](this);S=this.matrix?De(S,this.matrix):S;for(var P=1;P<i+1;P++)g.push(l.path(S).attr({stroke:t.color,fill:t.fill?t.color:"none","stroke-linejoin":"round","stroke-linecap":"round","stroke-width":+(t.width/i*P).toFixed(3),opacity:+(t.opacity/i).toFixed(3)}));return g.insertBefore(this).translate(t.offsetx,t.offsety)};var Ht=function(e,t,i,l,g,S,P,E,L){return L==null?We(e,t,i,l,g,S,P,E):o.findDotsAtSegment(e,t,i,l,g,S,P,E,function(H,Z,oe,te,Q,re,le,se,ee){if(!(ee<0||We(H,Z,oe,te,Q,re,le,se)<ee)){var we,ce=.5,me=1-ce;for(we=We(H,Z,oe,te,Q,re,le,se,me);K(we-ee)>.01;)we=We(H,Z,oe,te,Q,re,le,se,me+=(we<ee?1:-1)*(ce/=2));return me}}(e,t,i,l,g,S,P,E,L))},Vt=function(e,t){return function(i,l,g){for(var S,P,E,L,H,Z="",oe={},te=0,Q=0,re=(i=At(i)).length;Q<re;Q++){if((E=i[Q])[0]=="M")S=+E[1],P=+E[2];else{if(te+(L=Ht(S,P,E[1],E[2],E[3],E[4],E[5],E[6]))>l){if(t&&!oe.start){if(Z+=["C"+(H=Ht(S,P,E[1],E[2],E[3],E[4],E[5],E[6],l-te)).start.x,H.start.y,H.m.x,H.m.y,H.x,H.y],g)return Z;oe.start=Z,Z=["M"+H.x,H.y+"C"+H.n.x,H.n.y,H.end.x,H.end.y,E[5],E[6]].join(),te+=L,S=+E[5],P=+E[6];continue}if(!e&&!t)return{x:(H=Ht(S,P,E[1],E[2],E[3],E[4],E[5],E[6],l-te)).x,y:H.y,alpha:H.alpha}}te+=L,S=+E[5],P=+E[6]}Z+=E.shift()+E}return oe.end=Z,(H=e?te:t?oe:o.findDotsAtSegment(S,P,E[0],E[1],E[2],E[3],E[4],E[5],1)).alpha&&(H={x:H.x,y:H.y,alpha:H.alpha}),H}},nn=Vt(1),rn=Vt(),Gt=Vt(0,1);o.getTotalLength=nn,o.getPointAtLength=rn,o.getSubpath=function(e,t,i){if(this.getTotalLength(e)-i<1e-6)return Gt(e,t).end;var l=Gt(e,i,1);return t?Gt(l,t).end:l},Te.getTotalLength=function(){var e=this.getPath();if(e)return this.node.getTotalLength?this.node.getTotalLength():nn(e)},Te.getPointAtLength=function(e){var t=this.getPath();if(t)return rn(t,e)},Te.getPath=function(){var e,t=o._getPath[this.type];if(this.type!="text"&&this.type!="set")return t&&(e=t(this)),e},Te.getSubpath=function(e,t){var i=this.getPath();if(i)return o.getSubpath(i,e,t)};var Ve=o.easing_formulas={linear:function(e){return e},"<":function(e){return de(e,1.7)},">":function(e){return de(e,.48)},"<>":function(e){var t=.48-e/1.04,i=ne.sqrt(.1734+t*t),l=i-t,g=-i-t,S=de(K(l),1/3)*(l<0?-1:1)+de(K(g),1/3)*(g<0?-1:1)+.5;return 3*(1-S)*S*S+S*S*S},backIn:function(e){var t=1.70158;return e*e*((t+1)*e-t)},backOut:function(e){var t=1.70158;return(e-=1)*e*((t+1)*e+t)+1},elastic:function(e){return e==!!e?e:de(2,-10*e)*ne.sin(2*pe*(e-.075)/.3)+1},bounce:function(e){var t=7.5625,i=2.75;return e<1/i?t*e*e:e<2/i?t*(e-=1.5/i)*e+.75:e<2.5/i?t*(e-=2.25/i)*e+.9375:t*(e-=2.625/i)*e+.984375}};Ve.easeIn=Ve["ease-in"]=Ve["<"],Ve.easeOut=Ve["ease-out"]=Ve[">"],Ve.easeInOut=Ve["ease-in-out"]=Ve["<>"],Ve["back-in"]=Ve.backIn,Ve["back-out"]=Ve.backOut;var Be=[],sn=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){setTimeout(e,16)},Ut=function(){for(var e=+new Date,t=0;t<Be.length;t++){var i=Be[t];if(!i.el.removed&&!i.paused){var l,g,S=e-i.start,P=i.ms,E=i.easing,L=i.from,H=i.diff,Z=i.to,oe=(i.t,i.el),te={},Q={};if(i.initstatus?(S=(i.initstatus*i.anim.top-i.prev)/(i.percent-i.prev)*P,i.status=i.initstatus,delete i.initstatus,i.stop&&Be.splice(t--,1)):i.status=(i.prev+(i.percent-i.prev)*(S/P))/i.anim.top,!(S<0))if(S<P){var re=E(S/P);for(var le in L)if(L[B](le)){switch(N[le]){case c:l=+L[le]+re*P*H[le];break;case"colour":l="rgb("+[Xt(d(L[le].r+re*P*H[le].r)),Xt(d(L[le].g+re*P*H[le].g)),Xt(d(L[le].b+re*P*H[le].b))].join(",")+")";break;case"path":l=[];for(var se=0,ee=L[le].length;se<ee;se++){l[se]=[L[le][se][0]];for(var we=1,ce=L[le][se].length;we<ce;we++)l[se][we]=+L[le][se][we]+re*P*H[le][se][we];l[se]=l[se].join(ve)}l=l.join(ve);break;case"transform":if(H[le].real)for(l=[],se=0,ee=L[le].length;se<ee;se++)for(l[se]=[L[le][se][0]],we=1,ce=L[le][se].length;we<ce;we++)l[se][we]=L[le][se][we]+re*P*H[le][se][we];else{var me=function(Pe){return+L[le][Pe]+re*P*H[le][Pe]};l=[["m",me(0),me(1),me(2),me(3),me(4),me(5)]]}break;case"csv":if(le=="clip-rect")for(l=[],se=4;se--;)l[se]=+L[le][se]+re*P*H[le][se];break;default:var he=[][G](L[le]);for(l=[],se=oe.paper.customAttributes[le].length;se--;)l[se]=+he[se]+re*P*H[le][se]}te[le]=l}oe.attr(te),function(Pe,Ee,Le){setTimeout(function(){a("raphael.anim.frame."+Pe,Ee,Le)})}(oe.id,oe,i.anim)}else{if(function(Pe,Ee,Le){setTimeout(function(){a("raphael.anim.frame."+Ee.id,Ee,Le),a("raphael.anim.finish."+Ee.id,Ee,Le),o.is(Pe,"function")&&Pe.call(Ee)})}(i.callback,oe,i.anim),oe.attr(Z),Be.splice(t--,1),i.repeat>1&&!i.next){for(g in Z)Z[B](g)&&(Q[g]=i.totalOrigin[g]);i.el.attr(Q),Et(i.anim,i.el,i.anim.percents[0],null,i.totalOrigin,i.repeat-1)}i.next&&!i.stop&&Et(i.anim,i.el,i.next,null,i.totalOrigin,i.repeat)}}}Be.length&&sn(Ut)},Xt=function(e){return e>255?255:e<0?0:e};function Bn(e,t,i,l,g,S){var P=3*t,E=3*(l-t)-P,L=1-P-E,H=3*i,Z=3*(g-i)-H,oe=1-H-Z;function te(Q){return((L*Q+E)*Q+P)*Q}return function(Q,re){var le=function(se,ee){var we,ce,me,he,Pe,Ee;for(me=se,Ee=0;Ee<8;Ee++){if(he=te(me)-se,K(he)<ee)return me;if(K(Pe=(3*L*me+2*E)*me+P)<1e-6)break;me-=he/Pe}if(ce=1,(me=se)<(we=0))return we;if(me>ce)return ce;for(;we<ce;){if(he=te(me),K(he-se)<ee)return me;se>he?we=me:ce=me,me=(ce-we)/2+we}return me}(Q,re);return((oe*le+Z)*le+H)*le}(e,1/(200*S))}function Ke(e,t){var i=[],l={};if(this.ms=t,this.times=1,e){for(var g in e)e[B](g)&&(l[m(g)]=e[g],i.push(m(g)));i.sort(Se)}this.anim=l,this.top=i[i.length-1],this.percents=i}function Et(e,t,i,l,g,S){i=m(i);var P,E,L,H,Z,oe,te=e.ms,Q={},re={},le={};if(l)for(ee=0,we=Be.length;ee<we;ee++){var se=Be[ee];if(se.el.id==t.id&&se.anim==e){se.percent!=i?(Be.splice(ee,1),L=1):E=se,t.attr(se.totalOrigin);break}}else l=+re;for(var ee=0,we=e.percents.length;ee<we;ee++){if(e.percents[ee]==i||e.percents[ee]>l*e.top){i=e.percents[ee],Z=e.percents[ee-1]||0,te=te/e.top*(i-Z),H=e.percents[ee+1],P=e.anim[i];break}l&&t.attr(e.anim[e.percents[ee]])}if(P){if(E)E.initstatus=l,E.start=new Date-E.ms*l;else{for(var ce in P)if(P[B](ce)&&(N[B](ce)||t.paper.customAttributes[B](ce)))switch(Q[ce]=t.attr(ce),Q[ce]==null&&(Q[ce]=D[ce]),re[ce]=P[ce],N[ce]){case c:le[ce]=(re[ce]-Q[ce])/te;break;case"colour":Q[ce]=o.getRGB(Q[ce]);var me=o.getRGB(re[ce]);le[ce]={r:(me.r-Q[ce].r)/te,g:(me.g-Q[ce].g)/te,b:(me.b-Q[ce].b)/te};break;case"path":var he=At(Q[ce],re[ce]),Pe=he[1];for(Q[ce]=he[0],le[ce]=[],ee=0,we=Q[ce].length;ee<we;ee++){le[ce][ee]=[0];for(var Ee=1,Le=Q[ce][ee].length;Ee<Le;Ee++)le[ce][ee][Ee]=(Pe[ee][Ee]-Q[ce][ee][Ee])/te}break;case"transform":var xt=t._,Lt=Sn(xt[ce],re[ce]);if(Lt)for(Q[ce]=Lt.from,re[ce]=Lt.to,le[ce]=[],le[ce].real=!0,ee=0,we=Q[ce].length;ee<we;ee++)for(le[ce][ee]=[Q[ce][ee][0]],Ee=1,Le=Q[ce][ee].length;Ee<Le;Ee++)le[ce][ee][Ee]=(re[ce][ee][Ee]-Q[ce][ee][Ee])/te;else{var He=t.matrix||new st,Ye={_:{transform:xt.transform},getBBox:function(){return t.getBBox(1)}};Q[ce]=[He.a,He.b,He.c,He.d,He.e,He.f],Jt(Ye,re[ce]),re[ce]=Ye._.transform,le[ce]=[(Ye.matrix.a-He.a)/te,(Ye.matrix.b-He.b)/te,(Ye.matrix.c-He.c)/te,(Ye.matrix.d-He.d)/te,(Ye.matrix.e-He.e)/te,(Ye.matrix.f-He.f)/te]}break;case"csv":var vt=O(P[ce])[J](R),yt=O(Q[ce])[J](R);if(ce=="clip-rect")for(Q[ce]=yt,le[ce]=[],ee=yt.length;ee--;)le[ce][ee]=(vt[ee]-Q[ce][ee])/te;re[ce]=vt;break;default:for(vt=[][G](P[ce]),yt=[][G](Q[ce]),le[ce]=[],ee=t.paper.customAttributes[ce].length;ee--;)le[ce][ee]=((vt[ee]||0)-(yt[ee]||0))/te}var It=P.easing,Je=o.easing_formulas[It];if(!Je)if((Je=O(It).match(s))&&Je.length==5){var it=Je;Je=function(Ft){return Bn(Ft,+it[1],+it[2],+it[3],+it[4],te)}}else Je=Ae;if(se={anim:e,percent:i,timestamp:oe=P.start||e.start||+new Date,start:oe+(e.del||0),status:0,initstatus:l||0,stop:!1,ms:te,easing:Je,from:Q,diff:le,to:re,el:t,callback:P.callback,prev:Z,next:H,repeat:S||e.times,origin:t.attr(),totalOrigin:g},Be.push(se),l&&!E&&!L&&(se.stop=!0,se.start=new Date-te*l,Be.length==1))return Ut();L&&(se.start=new Date-se.ms*l),Be.length==1&&sn(Ut)}a("raphael.anim.start."+t.id,t,e)}}function an(e){for(var t=0;t<Be.length;t++)Be[t].el.paper==e&&Be.splice(t--,1)}Te.animateWith=function(e,t,i,l,g,S){if(this.removed)return S&&S.call(this),this;var P=i instanceof Ke?i:o.animation(i,l,g,S);Et(P,this,P.percents[0],null,this.attr());for(var E=0,L=Be.length;E<L;E++)if(Be[E].anim==t&&Be[E].el==e){Be[L-1].start=Be[E].start;break}return this},Te.onAnimation=function(e){return e?a.on("raphael.anim.frame."+this.id,e):a.unbind("raphael.anim.frame."+this.id),this},Ke.prototype.delay=function(e){var t=new Ke(this.anim,this.ms);return t.times=this.times,t.del=+e||0,t},Ke.prototype.repeat=function(e){var t=new Ke(this.anim,this.ms);return t.del=this.del,t.times=ne.floor(ge(e,0))||1,t},o.animation=function(e,t,i,l){if(e instanceof Ke)return e;!o.is(i,"function")&&i||(l=l||i||null,i=null),e=Object(e),t=+t||0;var g,S,P={};for(S in e)e[B](S)&&m(S)!=S&&m(S)+"%"!=S&&(g=!0,P[S]=e[S]);if(g)return i&&(P.easing=i),l&&(P.callback=l),new Ke({100:P},t);if(l){var E=0;for(var L in e){var H=v(L);e[B](L)&&H>E&&(E=H)}!e[E+="%"].callback&&(e[E].callback=l)}return new Ke(e,t)},Te.animate=function(e,t,i,l){if(this.removed)return l&&l.call(this),this;var g=e instanceof Ke?e:o.animation(e,t,i,l);return Et(g,this,g.percents[0],null,this.attr()),this},Te.setTime=function(e,t){return e&&t!=null&&this.status(e,xe(t,e.ms)/e.ms),this},Te.status=function(e,t){var i,l,g=[],S=0;if(t!=null)return Et(e,this,-1,xe(t,1)),this;for(i=Be.length;S<i;S++)if((l=Be[S]).el.id==this.id&&(!e||l.anim==e)){if(e)return l.status;g.push({anim:l.anim,status:l.status})}return e?0:g},Te.pause=function(e){for(var t=0;t<Be.length;t++)Be[t].el.id!=this.id||e&&Be[t].anim!=e||a("raphael.anim.pause."+this.id,this,Be[t].anim)!==!1&&(Be[t].paused=!0);return this},Te.resume=function(e){for(var t=0;t<Be.length;t++)if(Be[t].el.id==this.id&&(!e||Be[t].anim==e)){var i=Be[t];a("raphael.anim.resume."+this.id,this,i.anim)!==!1&&(delete i.paused,this.status(i.anim,i.status))}return this},Te.stop=function(e){for(var t=0;t<Be.length;t++)Be[t].el.id!=this.id||e&&Be[t].anim!=e||a("raphael.anim.stop."+this.id,this,Be[t].anim)!==!1&&Be.splice(t--,1);return this},a.on("raphael.remove",an),a.on("raphael.clear",an),Te.toString=function(){return"Raphaël’s object"};var on,ln,at,cn,Pt=function(e){if(this.items=[],this.length=0,this.type="set",e)for(var t=0,i=e.length;t<i;t++)!e[t]||e[t].constructor!=Te.constructor&&e[t].constructor!=Pt||(this[this.items.length]=this.items[this.items.length]=e[t],this.length++)},Oe=Pt.prototype;for(var Wt in Oe.push=function(){for(var e,t,i=0,l=arguments.length;i<l;i++)!(e=arguments[i])||e.constructor!=Te.constructor&&e.constructor!=Pt||(this[t=this.items.length]=this.items[t]=e,this.length++);return this},Oe.pop=function(){return this.length&&delete this[this.length--],this.items.pop()},Oe.forEach=function(e,t){for(var i=0,l=this.items.length;i<l;i++)if(e.call(t,this.items[i],i)===!1)return this;return this},Te)Te[B](Wt)&&(Oe[Wt]=function(e){return function(){var t=arguments;return this.forEach(function(i){i[e][X](i,t)})}}(Wt));return Oe.attr=function(e,t){if(e&&o.is(e,u)&&o.is(e[0],"object"))for(var i=0,l=e.length;i<l;i++)this.items[i].attr(e[i]);else for(var g=0,S=this.items.length;g<S;g++)this.items[g].attr(e,t);return this},Oe.clear=function(){for(;this.length;)this.pop()},Oe.splice=function(e,t,i){e=e<0?ge(this.length+e,0):e,t=ge(0,xe(this.length-e,t));var l,g=[],S=[],P=[];for(l=2;l<arguments.length;l++)P.push(arguments[l]);for(l=0;l<t;l++)S.push(this[e+l]);for(;l<this.length-e;l++)g.push(this[e+l]);var E=P.length;for(l=0;l<E+g.length;l++)this.items[e+l]=this[e+l]=l<E?P[l]:g[l-E];for(l=this.items.length=this.length-=t-E;this[l];)delete this[l++];return new Pt(S)},Oe.exclude=function(e){for(var t=0,i=this.length;t<i;t++)if(this[t]==e)return this.splice(t,1),!0},Oe.animate=function(e,t,i,l){(o.is(i,"function")||!i)&&(l=i||null);var g,S,P=this.items.length,E=P,L=this;if(!P)return this;l&&(S=function(){!--P&&l.call(L)}),i=o.is(i,"string")?i:S;var H=o.animation(e,t,i,S);for(g=this.items[--E].animate(H);E--;)this.items[E]&&!this.items[E].removed&&this.items[E].animateWith(g,H,H),this.items[E]&&!this.items[E].removed||P--;return this},Oe.insertAfter=function(e){for(var t=this.items.length;t--;)this.items[t].insertAfter(e);return this},Oe.getBBox=function(){for(var e=[],t=[],i=[],l=[],g=this.items.length;g--;)if(!this.items[g].removed){var S=this.items[g].getBBox();e.push(S.x),t.push(S.y),i.push(S.x+S.width),l.push(S.y+S.height)}return{x:e=xe[X](0,e),y:t=xe[X](0,t),x2:i=ge[X](0,i),y2:l=ge[X](0,l),width:i-e,height:l-t}},Oe.clone=function(e){e=this.paper.set();for(var t=0,i=this.items.length;t<i;t++)e.push(this.items[t].clone());return e},Oe.toString=function(){return"Raphaël‘s set"},Oe.glow=function(e){var t=this.paper.set();return this.forEach(function(i,l){var g=i.glow(e);g!=null&&g.forEach(function(S,P){t.push(S)})}),t},Oe.isPointInside=function(e,t){var i=!1;return this.forEach(function(l){if(l.isPointInside(e,t))return i=!0,!1}),i},o.registerFont=function(e){if(!e.face)return e;this.fonts=this.fonts||{};var t={w:e.w,face:{},glyphs:{}},i=e.face["font-family"];for(var l in e.face)e.face[B](l)&&(t.face[l]=e.face[l]);if(this.fonts[i]?this.fonts[i].push(t):this.fonts[i]=[t],!e.svg){for(var g in t.face["units-per-em"]=v(e.face["units-per-em"],10),e.glyphs)if(e.glyphs[B](g)){var S=e.glyphs[g];if(t.glyphs[g]={w:S.w,k:{},d:S.d&&"M"+S.d.replace(/[mlcxtrv]/g,function(E){return{l:"L",c:"C",x:"z",t:"m",r:"l",v:"c"}[E]||"M"})+"z"},S.k)for(var P in S.k)S[B](P)&&(t.glyphs[g].k[P]=S.k[P])}}return e},b.getFont=function(e,t,i,l){if(l=l||"normal",i=i||"normal",t=+t||{normal:400,bold:700,lighter:300,bolder:800}[t]||400,o.fonts){var g,S=o.fonts[e];if(!S){var P=new RegExp("(^|\\s)"+e.replace(/[^\w\d\s+!~.:_-]/g,fe)+"(\\s|$)","i");for(var E in o.fonts)if(o.fonts[B](E)&&P.test(E)){S=o.fonts[E];break}}if(S)for(var L=0,H=S.length;L<H&&((g=S[L]).face["font-weight"]!=t||g.face["font-style"]!=i&&g.face["font-style"]||g.face["font-stretch"]!=l);L++);return g}},b.print=function(e,t,i,l,g,S,P,E){S=S||"middle",P=ge(xe(P||0,1),-1),E=ge(xe(E||1,3),1);var L,H=O(i)[J](fe),Z=0,oe=0,te=fe;if(o.is(l,"string")&&(l=this.getFont(l)),l){L=(g||16)/l.face["units-per-em"];for(var Q=l.face.bbox[J](R),re=+Q[0],le=Q[3]-Q[1],se=0,ee=+Q[1]+(S=="baseline"?le+ +l.face.descent:le/2),we=0,ce=H.length;we<ce;we++){if(H[we]==`
`)Z=0,he=0,oe=0,se+=le*E;else{var me=oe&&l.glyphs[H[we-1]]||{},he=l.glyphs[H[we]];Z+=oe?(me.w||l.w)+(me.k&&me.k[H[we]]||0)+l.w*P:0,oe=1}he&&he.d&&(te+=o.transformPath(he.d,["t",Z*L,se*L,"s",L,L,re,ee,"t",(e-re)/L,(t-ee)/L]))}}return this.path(te).attr({fill:"#000",stroke:"none"})},b.add=function(e){if(o.is(e,"array"))for(var t,i=this.set(),l=0,g=e.length;l<g;l++)t=e[l]||{},$[B](t.type)&&i.push(this[t.type]().attr(t));return i},o.format=function(e,t){var i=o.is(t,u)?[0][G](t):arguments;return e&&o.is(e,"string")&&i.length-1&&(e=e.replace(F,function(l,g){return i[++g]==null?fe:i[g]})),e||fe},o.fullfill=(on=/\{([^\}]+)\}/g,ln=/(?:(?:^|\.)(.+?)(?=\[|\.|$|\()|\[('|")(.+?)\2\])(\(\))?/g,function(e,t){return String(e).replace(on,function(i,l){return function(g,S,P){var E=P;return S.replace(ln,function(L,H,Z,oe,te){H=H||oe,E&&(H in E&&(E=E[H]),typeof E=="function"&&te&&(E=E()))}),E=(E==null||E==P?g:E)+""}(i,l,t)})}),o.ninja=function(){if(U.was)M.win.Raphael=U.is;else{window.Raphael=void 0;try{delete window.Raphael}catch{}}return o},o.st=Oe,a.on("raphael.DOMload",function(){x=!0}),(at=document).readyState==null&&at.addEventListener&&(at.addEventListener("DOMContentLoaded",cn=function(){at.removeEventListener("DOMContentLoaded",cn,!1),at.readyState="complete"},!1),at.readyState="loading"),function e(){/in/.test(at.readyState)?setTimeout(e,9):o.eve("raphael.DOMload")}(),o}).apply(z,k))===void 0||(T.exports=f)},function(T,z,C){var k,f;k=[C(0),C(3),C(4)],(f=(function(a){return a}).apply(z,k))===void 0||(T.exports=f)},function(T,z,C){var k,f,a,o,x,b,R,$,F,B,M,U,j,X;o="hasOwnProperty",x=/[\.\/]/,b=/\s*,\s*/,R=function(G,ae){return G-ae},$={n:{}},F=function(){for(var G=0,ae=this.length;G<ae;G++)if(this[G]!==void 0)return this[G]},B=function(){for(var G=this.length;--G;)if(this[G]!==void 0)return this[G]},M=Object.prototype.toString,U=String,j=Array.isArray||function(G){return G instanceof Array||M.call(G)=="[object Array]"},(X=function(G,ae){var fe,ve=a,O=Array.prototype.slice.call(arguments,2),J=X.listeners(G),Y=0,I=[],ue={},ne=[],ge=f;ne.firstDefined=F,ne.lastDefined=B,f=G,a=0;for(var xe=0,K=J.length;xe<K;xe++)"zIndex"in J[xe]&&(I.push(J[xe].zIndex),J[xe].zIndex<0&&(ue[J[xe].zIndex]=J[xe]));for(I.sort(R);I[Y]<0;)if(fe=ue[I[Y++]],ne.push(fe.apply(ae,O)),a)return a=ve,ne;for(xe=0;xe<K;xe++)if("zIndex"in(fe=J[xe]))if(fe.zIndex==I[Y]){if(ne.push(fe.apply(ae,O)),a)break;do if((fe=ue[I[++Y]])&&ne.push(fe.apply(ae,O)),a)break;while(fe)}else ue[fe.zIndex]=fe;else if(ne.push(fe.apply(ae,O)),a)break;return a=ve,f=ge,ne})._events=$,X.listeners=function(G){var ae,fe,ve,O,J,Y,I,ue,ne=j(G)?G:G.split(x),ge=$,xe=[ge],K=[];for(O=0,J=ne.length;O<J;O++){for(ue=[],Y=0,I=xe.length;Y<I;Y++)for(fe=[(ge=xe[Y].n)[ne[O]],ge["*"]],ve=2;ve--;)(ae=fe[ve])&&(ue.push(ae),K=K.concat(ae.f||[]));xe=ue}return K},X.separator=function(G){G?(G="["+(G=U(G).replace(/(?=[\.\^\]\[\-])/g,"\\"))+"]",x=new RegExp(G)):x=/[\.\/]/},X.on=function(G,ae){if(typeof ae!="function")return function(){};for(var fe=j(G)?j(G[0])?G:[G]:U(G).split(b),ve=0,O=fe.length;ve<O;ve++)(function(J){for(var Y,I=j(J)?J:U(J).split(x),ue=$,ne=0,ge=I.length;ne<ge;ne++)ue=(ue=ue.n).hasOwnProperty(I[ne])&&ue[I[ne]]||(ue[I[ne]]={n:{}});for(ue.f=ue.f||[],ne=0,ge=ue.f.length;ne<ge;ne++)if(ue.f[ne]==ae){Y=!0;break}!Y&&ue.f.push(ae)})(fe[ve]);return function(J){+J==+J&&(ae.zIndex=+J)}},X.f=function(G){var ae=[].slice.call(arguments,1);return function(){X.apply(null,[G,null].concat(ae).concat([].slice.call(arguments,0)))}},X.stop=function(){a=1},X.nt=function(G){var ae=j(f)?f.join("."):f;return G?new RegExp("(?:\\.|\\/|^)"+G+"(?:\\.|\\/|$)").test(ae):ae},X.nts=function(){return j(f)?f:f.split(x)},X.off=X.unbind=function(G,ae){if(G){var fe=j(G)?j(G[0])?G:[G]:U(G).split(b);if(fe.length>1)for(var ve=0,O=fe.length;ve<O;ve++)X.off(fe[ve],ae);else{fe=j(G)?G:U(G).split(x);var J,Y,I,ue,ne,ge=[$];for(ve=0,O=fe.length;ve<O;ve++)for(ue=0;ue<ge.length;ue+=I.length-2){if(I=[ue,1],J=ge[ue].n,fe[ve]!="*")J[fe[ve]]&&I.push(J[fe[ve]]);else for(Y in J)J[o](Y)&&I.push(J[Y]);ge.splice.apply(ge,I)}for(ve=0,O=ge.length;ve<O;ve++)for(J=ge[ve];J.n;){if(ae){if(J.f){for(ue=0,ne=J.f.length;ue<ne;ue++)if(J.f[ue]==ae){J.f.splice(ue,1);break}!J.f.length&&delete J.f}for(Y in J.n)if(J.n[o](Y)&&J.n[Y].f){var xe=J.n[Y].f;for(ue=0,ne=xe.length;ue<ne;ue++)if(xe[ue]==ae){xe.splice(ue,1);break}!xe.length&&delete J.n[Y].f}}else for(Y in delete J.f,J.n)J.n[o](Y)&&J.n[Y].f&&delete J.n[Y].f;J=J.n}}}else X._events=$={n:{}}},X.once=function(G,ae){var fe=function(){return X.off(G,fe),ae.apply(this,arguments)};return X.on(G,fe)},X.version="0.5.0",X.toString=function(){return"You are running Eve 0.5.0"},T.exports?T.exports=X:(k=(function(){return X}).apply(z,[]))===void 0||(T.exports=k)},function(T,z,C){var k,f;k=[C(0)],(f=(function(a){if(!a||a.svg){var o="hasOwnProperty",x=String,b=parseFloat,R=parseInt,$=Math,F=$.max,B=$.abs,M=$.pow,U=/[, ]+/,j=a.eve,X="",G=" ",ae="http://www.w3.org/1999/xlink",fe={block:"M5,0 0,2.5 5,5z",classic:"M5,0 0,2.5 5,5 3.5,3 3.5,2z",diamond:"M2.5,0 5,2.5 2.5,5 0,2.5z",open:"M6,1 1,3.5 6,6",oval:"M2.5,0A2.5,2.5,0,0,1,2.5,5 2.5,2.5,0,0,1,2.5,0z"},ve={};a.toString=function(){return`Your browser supports SVG.
You are running Raphaël `+this.version};var O=function(n,r){if(r)for(var s in typeof n=="string"&&(n=O(n)),r)r[o](s)&&(s.substring(0,6)=="xlink:"?n.setAttributeNS(ae,s.substring(6),x(r[s])):n.setAttribute(s,x(r[s])));else(n=a._g.doc.createElementNS("http://www.w3.org/2000/svg",n)).style&&(n.style.webkitTapHighlightColor="rgba(0,0,0,0)");return n},J=function(n,r){var s="linear",d=n.id+r,m=.5,v=.5,A=n.node,D=n.paper,N=A.style,V=a._g.doc.getElementById(d);if(!V){if(r=(r=x(r).replace(a._radial_gradient,function(Se,Ae,ke){if(s="radial",Ae&&ke){m=b(Ae);var Ne=2*((v=b(ke))>.5)-1;M(m-.5,2)+M(v-.5,2)>.25&&(v=$.sqrt(.25-M(m-.5,2))*Ne+.5)&&v!=.5&&(v=v.toFixed(5)-1e-5*Ne)}return X})).split(/\s*\-\s*/),s=="linear"){var W=r.shift();if(W=-b(W),isNaN(W))return null;var ie=[0,0,$.cos(a.rad(W)),$.sin(a.rad(W))],be=1/(F(B(ie[2]),B(ie[3]))||1);ie[2]*=be,ie[3]*=be,ie[2]<0&&(ie[0]=-ie[2],ie[2]=0),ie[3]<0&&(ie[1]=-ie[3],ie[3]=0)}var Ce=a._parseDots(r);if(!Ce)return null;if(d=d.replace(/[\(\)\s,\xb0#]/g,"_"),n.gradient&&d!=n.gradient.id&&(D.defs.removeChild(n.gradient),delete n.gradient),!n.gradient){V=O(s+"Gradient",{id:d}),n.gradient=V,O(V,s=="radial"?{fx:m,fy:v}:{x1:ie[0],y1:ie[1],x2:ie[2],y2:ie[3],gradientTransform:n.matrix.invert()}),D.defs.appendChild(V);for(var ye=0,_e=Ce.length;ye<_e;ye++)V.appendChild(O("stop",{offset:Ce[ye].offset?Ce[ye].offset:ye?"100%":"0%","stop-color":Ce[ye].color||"#fff","stop-opacity":isFinite(Ce[ye].opacity)?Ce[ye].opacity:1}))}}return O(A,{fill:Y(d),opacity:1,"fill-opacity":1}),N.fill=X,N.opacity=1,N.fillOpacity=1,1},Y=function(n){if((r=document.documentMode)&&(r===9||r===10))return"url('#"+n+"')";var r,s=document.location;return"url('"+(s.protocol+"//"+s.host+s.pathname+s.search)+"#"+n+"')"},I=function(n){var r=n.getBBox(1);O(n.pattern,{patternTransform:n.matrix.invert()+" translate("+r.x+","+r.y+")"})},ue=function(n,r,s){if(n.type=="path"){for(var d,m,v,A,D,N=x(r).toLowerCase().split("-"),V=n.paper,W=s?"end":"start",ie=n.node,be=n.attrs,Ce=be["stroke-width"],ye=N.length,_e="classic",Se=3,Ae=3,ke=5;ye--;)switch(N[ye]){case"block":case"classic":case"oval":case"diamond":case"open":case"none":_e=N[ye];break;case"wide":Ae=5;break;case"narrow":Ae=2;break;case"long":Se=5;break;case"short":Se=2}if(_e=="open"?(Se+=2,Ae+=2,ke+=2,v=1,A=s?4:1,D={fill:"none",stroke:be.stroke}):(A=v=Se/2,D={fill:be.stroke,stroke:"none"}),n._.arrows?s?(n._.arrows.endPath&&ve[n._.arrows.endPath]--,n._.arrows.endMarker&&ve[n._.arrows.endMarker]--):(n._.arrows.startPath&&ve[n._.arrows.startPath]--,n._.arrows.startMarker&&ve[n._.arrows.startMarker]--):n._.arrows={},_e!="none"){var Ne="raphael-marker-"+_e,Me="raphael-marker-"+W+_e+Se+Ae+"-obj"+n.id;a._g.doc.getElementById(Ne)?ve[Ne]++:(V.defs.appendChild(O(O("path"),{"stroke-linecap":"round",d:fe[_e],id:Ne})),ve[Ne]=1);var De,Re=a._g.doc.getElementById(Me);Re?(ve[Me]++,De=Re.getElementsByTagName("use")[0]):(Re=O(O("marker"),{id:Me,markerHeight:Ae,markerWidth:Se,orient:"auto",refX:A,refY:Ae/2}),De=O(O("use"),{"xlink:href":"#"+Ne,transform:(s?"rotate(180 "+Se/2+" "+Ae/2+") ":X)+"scale("+Se/ke+","+Ae/ke+")","stroke-width":(1/((Se/ke+Ae/ke)/2)).toFixed(4)}),Re.appendChild(De),V.defs.appendChild(Re),ve[Me]=1),O(De,D);var qe=v*(_e!="diamond"&&_e!="oval");s?(d=n._.arrows.startdx*Ce||0,m=a.getTotalLength(be.path)-qe*Ce):(d=qe*Ce,m=a.getTotalLength(be.path)-(n._.arrows.enddx*Ce||0)),(D={})["marker-"+W]="url(#"+Me+")",(m||d)&&(D.d=a.getSubpath(be.path,d,m)),O(ie,D),n._.arrows[W+"Path"]=Ne,n._.arrows[W+"Marker"]=Me,n._.arrows[W+"dx"]=qe,n._.arrows[W+"Type"]=_e,n._.arrows[W+"String"]=r}else s?(d=n._.arrows.startdx*Ce||0,m=a.getTotalLength(be.path)-d):(d=0,m=a.getTotalLength(be.path)-(n._.arrows.enddx*Ce||0)),n._.arrows[W+"Path"]&&O(ie,{d:a.getSubpath(be.path,d,m)}),delete n._.arrows[W+"Path"],delete n._.arrows[W+"Marker"],delete n._.arrows[W+"dx"],delete n._.arrows[W+"Type"],delete n._.arrows[W+"String"];for(D in ve)if(ve[o](D)&&!ve[D]){var Fe=a._g.doc.getElementById(D);Fe&&Fe.parentNode.removeChild(Fe)}}},ne={"-":[3,1],".":[1,1],"-.":[3,1,1,1],"-..":[3,1,1,1,1,1],". ":[1,3],"- ":[4,3],"--":[8,3],"- .":[4,3,1,3],"--.":[8,3,1,3],"--..":[8,3,1,3,1,3]},ge=function(n,r,s){if(r=ne[x(r).toLowerCase()]){for(var d=n.attrs["stroke-width"]||"1",m={round:d,square:d,butt:0}[n.attrs["stroke-linecap"]||s["stroke-linecap"]]||0,v=[],A=r.length;A--;)v[A]=r[A]*d+(A%2?1:-1)*m;O(n.node,{"stroke-dasharray":v.join(",")})}else O(n.node,{"stroke-dasharray":"none"})},xe=function(n,r){var s=n.node,d=n.attrs,m=s.style.visibility;for(var v in s.style.visibility="hidden",r)if(r[o](v)){if(!a._availableAttrs[o](v))continue;var A=r[v];switch(d[v]=A,v){case"blur":n.blur(A);break;case"title":var D=s.getElementsByTagName("title");if(D.length&&(D=D[0]))D.firstChild.nodeValue=A;else{D=O("title");var N=a._g.doc.createTextNode(A);D.appendChild(N),s.appendChild(D)}break;case"href":case"target":var V=s.parentNode;if(V.tagName.toLowerCase()!="a"){var W=O("a");V.insertBefore(W,s),W.appendChild(s),V=W}v=="target"?V.setAttributeNS(ae,"show",A=="blank"?"new":A):V.setAttributeNS(ae,v,A);break;case"cursor":s.style.cursor=A;break;case"transform":n.transform(A);break;case"arrow-start":ue(n,A);break;case"arrow-end":ue(n,A,1);break;case"clip-rect":var ie=x(A).split(U);if(ie.length==4){n.clip&&n.clip.parentNode.parentNode.removeChild(n.clip.parentNode);var be=O("clipPath"),Ce=O("rect");be.id=a.createUUID(),O(Ce,{x:ie[0],y:ie[1],width:ie[2],height:ie[3]}),be.appendChild(Ce),n.paper.defs.appendChild(be),O(s,{"clip-path":"url(#"+be.id+")"}),n.clip=Ce}if(!A){var ye=s.getAttribute("clip-path");if(ye){var _e=a._g.doc.getElementById(ye.replace(/(^url\(#|\)$)/g,X));_e&&_e.parentNode.removeChild(_e),O(s,{"clip-path":X}),delete n.clip}}break;case"path":n.type=="path"&&(O(s,{d:A?d.path=a._pathToAbsolute(A):"M0,0"}),n._.dirty=1,n._.arrows&&("startString"in n._.arrows&&ue(n,n._.arrows.startString),"endString"in n._.arrows&&ue(n,n._.arrows.endString,1)));break;case"width":if(s.setAttribute(v,A),n._.dirty=1,!d.fx)break;v="x",A=d.x;case"x":d.fx&&(A=-d.x-(d.width||0));case"rx":if(v=="rx"&&n.type=="rect")break;case"cx":s.setAttribute(v,A),n.pattern&&I(n),n._.dirty=1;break;case"height":if(s.setAttribute(v,A),n._.dirty=1,!d.fy)break;v="y",A=d.y;case"y":d.fy&&(A=-d.y-(d.height||0));case"ry":if(v=="ry"&&n.type=="rect")break;case"cy":s.setAttribute(v,A),n.pattern&&I(n),n._.dirty=1;break;case"r":n.type=="rect"?O(s,{rx:A,ry:A}):s.setAttribute(v,A),n._.dirty=1;break;case"src":n.type=="image"&&s.setAttributeNS(ae,"href",A);break;case"stroke-width":n._.sx==1&&n._.sy==1||(A/=F(B(n._.sx),B(n._.sy))||1),s.setAttribute(v,A),d["stroke-dasharray"]&&ge(n,d["stroke-dasharray"],r),n._.arrows&&("startString"in n._.arrows&&ue(n,n._.arrows.startString),"endString"in n._.arrows&&ue(n,n._.arrows.endString,1));break;case"stroke-dasharray":ge(n,A,r);break;case"fill":var Se=x(A).match(a._ISURL);if(Se){be=O("pattern");var Ae=O("image");be.id=a.createUUID(),O(be,{x:0,y:0,patternUnits:"userSpaceOnUse",height:1,width:1}),O(Ae,{x:0,y:0,"xlink:href":Se[1]}),be.appendChild(Ae),function(Re){a._preload(Se[1],function(){var qe=this.offsetWidth,Fe=this.offsetHeight;O(Re,{width:qe,height:Fe}),O(Ae,{width:qe,height:Fe})})}(be),n.paper.defs.appendChild(be),O(s,{fill:"url(#"+be.id+")"}),n.pattern=be,n.pattern&&I(n);break}var ke=a.getRGB(A);if(ke.error){if((n.type=="circle"||n.type=="ellipse"||x(A).charAt()!="r")&&J(n,A)){if("opacity"in d||"fill-opacity"in d){var Ne=a._g.doc.getElementById(s.getAttribute("fill").replace(/^url\(#|\)$/g,X));if(Ne){var Me=Ne.getElementsByTagName("stop");O(Me[Me.length-1],{"stop-opacity":("opacity"in d?d.opacity:1)*("fill-opacity"in d?d["fill-opacity"]:1)})}}d.gradient=A,d.fill="none";break}}else delete r.gradient,delete d.gradient,!a.is(d.opacity,"undefined")&&a.is(r.opacity,"undefined")&&O(s,{opacity:d.opacity}),!a.is(d["fill-opacity"],"undefined")&&a.is(r["fill-opacity"],"undefined")&&O(s,{"fill-opacity":d["fill-opacity"]});ke[o]("opacity")&&O(s,{"fill-opacity":ke.opacity>1?ke.opacity/100:ke.opacity});case"stroke":ke=a.getRGB(A),s.setAttribute(v,ke.hex),v=="stroke"&&ke[o]("opacity")&&O(s,{"stroke-opacity":ke.opacity>1?ke.opacity/100:ke.opacity}),v=="stroke"&&n._.arrows&&("startString"in n._.arrows&&ue(n,n._.arrows.startString),"endString"in n._.arrows&&ue(n,n._.arrows.endString,1));break;case"gradient":(n.type=="circle"||n.type=="ellipse"||x(A).charAt()!="r")&&J(n,A);break;case"opacity":d.gradient&&!d[o]("stroke-opacity")&&O(s,{"stroke-opacity":A>1?A/100:A});case"fill-opacity":if(d.gradient){(Ne=a._g.doc.getElementById(s.getAttribute("fill").replace(/^url\(#|\)$/g,X)))&&(Me=Ne.getElementsByTagName("stop"),O(Me[Me.length-1],{"stop-opacity":A}));break}default:v=="font-size"&&(A=R(A,10)+"px");var De=v.replace(/(\-.)/g,function(Re){return Re.substring(1).toUpperCase()});s.style[De]=A,n._.dirty=1,s.setAttribute(v,A)}}K(n,r),s.style.visibility=m},K=function(n,r){if(n.type=="text"&&(r[o]("text")||r[o]("font")||r[o]("font-size")||r[o]("x")||r[o]("y"))){var s=n.attrs,d=n.node,m=d.firstChild?R(a._g.doc.defaultView.getComputedStyle(d.firstChild,X).getPropertyValue("font-size"),10):10;if(r[o]("text")){for(s.text=r.text;d.firstChild;)d.removeChild(d.firstChild);for(var v,A=x(r.text).split(`
`),D=[],N=0,V=A.length;N<V;N++)v=O("tspan"),N&&O(v,{dy:1.2*m,x:s.x}),v.appendChild(a._g.doc.createTextNode(A[N])),d.appendChild(v),D[N]=v}else for(N=0,V=(D=d.getElementsByTagName("tspan")).length;N<V;N++)N?O(D[N],{dy:1.2*m,x:s.x}):O(D[0],{dy:0});O(d,{x:s.x,y:s.y}),n._.dirty=1;var W=n._getBBox(),ie=s.y-(W.y+W.height/2);ie&&a.is(ie,"finite")&&O(D[0],{dy:ie})}},de=function(n){return n.parentNode&&n.parentNode.tagName.toLowerCase()==="a"?n.parentNode:n},pe=function(n,r){this[0]=this.node=n,n.raphael=!0,this.id=("0000"+(Math.random()*Math.pow(36,5)<<0).toString(36)).slice(-5),n.raphaelid=this.id,this.matrix=a.matrix(),this.realPath=null,this.paper=r,this.attrs=this.attrs||{},this._={transform:[],sx:1,sy:1,deg:0,dx:0,dy:0,dirty:1},!r.bottom&&(r.bottom=this),this.prev=r.top,r.top&&(r.top.next=this),r.top=this,this.next=null},c=a.el;pe.prototype=c,c.constructor=pe,a._engine.path=function(n,r){var s=O("path");r.canvas&&r.canvas.appendChild(s);var d=new pe(s,r);return d.type="path",xe(d,{fill:"none",stroke:"#000",path:n}),d},c.rotate=function(n,r,s){if(this.removed)return this;if((n=x(n).split(U)).length-1&&(r=b(n[1]),s=b(n[2])),n=b(n[0]),s==null&&(r=s),r==null||s==null){var d=this.getBBox(1);r=d.x+d.width/2,s=d.y+d.height/2}return this.transform(this._.transform.concat([["r",n,r,s]])),this},c.scale=function(n,r,s,d){if(this.removed)return this;if((n=x(n).split(U)).length-1&&(r=b(n[1]),s=b(n[2]),d=b(n[3])),n=b(n[0]),r==null&&(r=n),d==null&&(s=d),s==null||d==null)var m=this.getBBox(1);return s=s??m.x+m.width/2,d=d??m.y+m.height/2,this.transform(this._.transform.concat([["s",n,r,s,d]])),this},c.translate=function(n,r){return this.removed?this:((n=x(n).split(U)).length-1&&(r=b(n[1])),n=b(n[0])||0,r=+r||0,this.transform(this._.transform.concat([["t",n,r]])),this)},c.transform=function(n){var r=this._;if(n==null)return r.transform;if(a._extractTransform(this,n),this.clip&&O(this.clip,{transform:this.matrix.invert()}),this.pattern&&I(this),this.node&&O(this.node,{transform:this.matrix}),r.sx!=1||r.sy!=1){var s=this.attrs[o]("stroke-width")?this.attrs["stroke-width"]:1;this.attr({"stroke-width":s})}return this},c.hide=function(){return this.removed||(this.node.style.display="none"),this},c.show=function(){return this.removed||(this.node.style.display=""),this},c.remove=function(){var n=de(this.node);if(!this.removed&&n.parentNode){var r=this.paper;for(var s in r.__set__&&r.__set__.exclude(this),j.unbind("raphael.*.*."+this.id),this.gradient&&r.defs.removeChild(this.gradient),a._tear(this,r),n.parentNode.removeChild(n),this.removeData(),this)this[s]=typeof this[s]=="function"?a._removedFactory(s):null;this.removed=!0}},c._getBBox=function(){if(this.node.style.display=="none"){this.show();var n=!0}var r,s=!1;this.paper.canvas.parentElement?r=this.paper.canvas.parentElement.style:this.paper.canvas.parentNode&&(r=this.paper.canvas.parentNode.style),r&&r.display=="none"&&(s=!0,r.display="");var d={};try{d=this.node.getBBox()}catch{d={x:this.node.clientLeft,y:this.node.clientTop,width:this.node.clientWidth,height:this.node.clientHeight}}finally{d=d||{},s&&(r.display="none")}return n&&this.hide(),d},c.attr=function(n,r){if(this.removed)return this;if(n==null){var s={};for(var d in this.attrs)this.attrs[o](d)&&(s[d]=this.attrs[d]);return s.gradient&&s.fill=="none"&&(s.fill=s.gradient)&&delete s.gradient,s.transform=this._.transform,s}if(r==null&&a.is(n,"string")){if(n=="fill"&&this.attrs.fill=="none"&&this.attrs.gradient)return this.attrs.gradient;if(n=="transform")return this._.transform;for(var m=n.split(U),v={},A=0,D=m.length;A<D;A++)(n=m[A])in this.attrs?v[n]=this.attrs[n]:a.is(this.paper.customAttributes[n],"function")?v[n]=this.paper.customAttributes[n].def:v[n]=a._availableAttrs[n];return D-1?v:v[m[0]]}if(r==null&&a.is(n,"array")){for(v={},A=0,D=n.length;A<D;A++)v[n[A]]=this.attr(n[A]);return v}if(r!=null){var N={};N[n]=r}else n!=null&&a.is(n,"object")&&(N=n);for(var V in N)j("raphael.attr."+V+"."+this.id,this,N[V]);for(V in this.paper.customAttributes)if(this.paper.customAttributes[o](V)&&N[o](V)&&a.is(this.paper.customAttributes[V],"function")){var W=this.paper.customAttributes[V].apply(this,[].concat(N[V]));for(var ie in this.attrs[V]=N[V],W)W[o](ie)&&(N[ie]=W[ie])}return xe(this,N),this},c.toFront=function(){if(this.removed)return this;var n=de(this.node);n.parentNode.appendChild(n);var r=this.paper;return r.top!=this&&a._tofront(this,r),this},c.toBack=function(){if(this.removed)return this;var n=de(this.node),r=n.parentNode;return r.insertBefore(n,r.firstChild),a._toback(this,this.paper),this.paper,this},c.insertAfter=function(n){if(this.removed||!n)return this;var r=de(this.node),s=de(n.node||n[n.length-1].node);return s.nextSibling?s.parentNode.insertBefore(r,s.nextSibling):s.parentNode.appendChild(r),a._insertafter(this,n,this.paper),this},c.insertBefore=function(n){if(this.removed||!n)return this;var r=de(this.node),s=de(n.node||n[0].node);return s.parentNode.insertBefore(r,s),a._insertbefore(this,n,this.paper),this},c.blur=function(n){var r=this;if(+n!=0){var s=O("filter"),d=O("feGaussianBlur");r.attrs.blur=n,s.id=a.createUUID(),O(d,{stdDeviation:+n||1.5}),s.appendChild(d),r.paper.defs.appendChild(s),r._blur=s,O(r.node,{filter:"url(#"+s.id+")"})}else r._blur&&(r._blur.parentNode.removeChild(r._blur),delete r._blur,delete r.attrs.blur),r.node.removeAttribute("filter");return r},a._engine.circle=function(n,r,s,d){var m=O("circle");n.canvas&&n.canvas.appendChild(m);var v=new pe(m,n);return v.attrs={cx:r,cy:s,r:d,fill:"none",stroke:"#000"},v.type="circle",O(m,v.attrs),v},a._engine.rect=function(n,r,s,d,m,v){var A=O("rect");n.canvas&&n.canvas.appendChild(A);var D=new pe(A,n);return D.attrs={x:r,y:s,width:d,height:m,rx:v||0,ry:v||0,fill:"none",stroke:"#000"},D.type="rect",O(A,D.attrs),D},a._engine.ellipse=function(n,r,s,d,m){var v=O("ellipse");n.canvas&&n.canvas.appendChild(v);var A=new pe(v,n);return A.attrs={cx:r,cy:s,rx:d,ry:m,fill:"none",stroke:"#000"},A.type="ellipse",O(v,A.attrs),A},a._engine.image=function(n,r,s,d,m,v){var A=O("image");O(A,{x:s,y:d,width:m,height:v,preserveAspectRatio:"none"}),A.setAttributeNS(ae,"href",r),n.canvas&&n.canvas.appendChild(A);var D=new pe(A,n);return D.attrs={x:s,y:d,width:m,height:v,src:r},D.type="image",D},a._engine.text=function(n,r,s,d){var m=O("text");n.canvas&&n.canvas.appendChild(m);var v=new pe(m,n);return v.attrs={x:r,y:s,"text-anchor":"middle",text:d,"font-family":a._availableAttrs["font-family"],"font-size":a._availableAttrs["font-size"],stroke:"none",fill:"#000"},v.type="text",xe(v,v.attrs),v},a._engine.setSize=function(n,r){return this.width=n||this.width,this.height=r||this.height,this.canvas.setAttribute("width",this.width),this.canvas.setAttribute("height",this.height),this._viewBox&&this.setViewBox.apply(this,this._viewBox),this},a._engine.create=function(){var n=a._getContainer.apply(0,arguments),r=n&&n.container;if(!r)throw new Error("SVG container not found.");var s,d=n.x,m=n.y,v=n.width,A=n.height,D=O("svg"),N="overflow:hidden;";return d=d||0,m=m||0,O(D,{height:A=A||342,version:1.1,width:v=v||512,xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink"}),r==1?(D.style.cssText=N+"position:absolute;left:"+d+"px;top:"+m+"px",a._g.doc.body.appendChild(D),s=1):(D.style.cssText=N+"position:relative",r.firstChild?r.insertBefore(D,r.firstChild):r.appendChild(D)),(r=new a._Paper).width=v,r.height=A,r.canvas=D,r.clear(),r._left=r._top=0,s&&(r.renderfix=function(){}),r.renderfix(),r},a._engine.setViewBox=function(n,r,s,d,m){j("raphael.setViewBox",this,this._viewBox,[n,r,s,d,m]);var v,A,D=this.getSize(),N=F(s/D.width,d/D.height),V=this.top,W=m?"xMidYMid meet":"xMinYMin";for(n==null?(this._vbSize&&(N=1),delete this._vbSize,v="0 0 "+this.width+G+this.height):(this._vbSize=N,v=n+G+r+G+s+G+d),O(this.canvas,{viewBox:v,preserveAspectRatio:W});N&&V;)A="stroke-width"in V.attrs?V.attrs["stroke-width"]:1,V.attr({"stroke-width":A}),V._.dirty=1,V._.dirtyT=1,V=V.prev;return this._viewBox=[n,r,s,d,!!m],this},a.prototype.renderfix=function(){var n,r=this.canvas,s=r.style;try{n=r.getScreenCTM()||r.createSVGMatrix()}catch{n=r.createSVGMatrix()}var d=-n.e%1,m=-n.f%1;(d||m)&&(d&&(this._left=(this._left+d)%1,s.left=this._left+"px"),m&&(this._top=(this._top+m)%1,s.top=this._top+"px"))},a.prototype.clear=function(){a.eve("raphael.clear",this);for(var n=this.canvas;n.firstChild;)n.removeChild(n.firstChild);this.bottom=this.top=null,(this.desc=O("desc")).appendChild(a._g.doc.createTextNode("Created with Raphaël "+a.version)),n.appendChild(this.desc),n.appendChild(this.defs=O("defs"))},a.prototype.remove=function(){for(var n in j("raphael.remove",this),this.canvas.parentNode&&this.canvas.parentNode.removeChild(this.canvas),this)this[n]=typeof this[n]=="function"?a._removedFactory(n):null};var u=a.st;for(var p in c)c[o](p)&&!u[o](p)&&(u[p]=function(n){return function(){var r=arguments;return this.forEach(function(s){s[n].apply(s,r)})}}(p))}}).apply(z,k))===void 0||(T.exports=f)},function(T,z,C){var k,f;k=[C(0)],(f=(function(a){if(!a||a.vml){var o="hasOwnProperty",x=String,b=parseFloat,R=Math,$=R.round,F=R.max,B=R.min,M=R.abs,U=/[, ]+/,j=a.eve,X=" ",G="",ae={M:"m",L:"l",C:"c",Z:"x",m:"t",l:"r",c:"v",z:"x"},fe=/([clmz]),?([^clmz]*)/gi,ve=/ progid:\S+Blur\([^\)]+\)/g,O=/-?[^,\s-]+/g,J="position:absolute;left:0;top:0;width:1px;height:1px;behavior:url(#default#VML)",Y=21600,I={path:1,rect:1,image:1},ue={circle:1,ellipse:1},ne=function(r,s,d){var m=a.matrix();return m.rotate(-r,.5,.5),{dx:m.x(s,d),dy:m.y(s,d)}},ge=function(r,s,d,m,v,A){var D=r._,N=r.matrix,V=D.fillpos,W=r.node,ie=W.style,be=1,Ce="",ye=Y/s,_e=Y/d;if(ie.visibility="hidden",s&&d){if(W.coordsize=M(ye)+X+M(_e),ie.rotation=A*(s*d<0?-1:1),A){var Se=ne(A,m,v);m=Se.dx,v=Se.dy}if(s<0&&(Ce+="x"),d<0&&(Ce+=" y")&&(be=-1),ie.flip=Ce,W.coordorigin=m*-ye+X+v*-_e,V||D.fillsize){var Ae=W.getElementsByTagName("fill");Ae=Ae&&Ae[0],W.removeChild(Ae),V&&(Se=ne(A,N.x(V[0],V[1]),N.y(V[0],V[1])),Ae.position=Se.dx*be+X+Se.dy*be),D.fillsize&&(Ae.size=D.fillsize[0]*M(s)+X+D.fillsize[1]*M(d)),W.appendChild(Ae)}ie.visibility="visible"}};a.toString=function(){return`Your browser doesn’t support SVG. Falling down to VML.
You are running Raphaël `+this.version};var xe,K=function(r,s,d){for(var m=x(s).toLowerCase().split("-"),v=d?"end":"start",A=m.length,D="classic",N="medium",V="medium";A--;)switch(m[A]){case"block":case"classic":case"oval":case"diamond":case"open":case"none":D=m[A];break;case"wide":case"narrow":V=m[A];break;case"long":case"short":N=m[A]}var W=r.node.getElementsByTagName("stroke")[0];W[v+"arrow"]=D,W[v+"arrowlength"]=N,W[v+"arrowwidth"]=V},de=function(r,s){r.attrs=r.attrs||{};var d=r.node,m=r.attrs,v=d.style,A=I[r.type]&&(s.x!=m.x||s.y!=m.y||s.width!=m.width||s.height!=m.height||s.cx!=m.cx||s.cy!=m.cy||s.rx!=m.rx||s.ry!=m.ry||s.r!=m.r),D=ue[r.type]&&(m.cx!=s.cx||m.cy!=s.cy||m.r!=s.r||m.rx!=s.rx||m.ry!=s.ry),N=r;for(var V in s)s[o](V)&&(m[V]=s[V]);if(A&&(m.path=a._getPath[r.type](r),r._.dirty=1),s.href&&(d.href=s.href),s.title&&(d.title=s.title),s.target&&(d.target=s.target),s.cursor&&(v.cursor=s.cursor),"blur"in s&&r.blur(s.blur),(s.path&&r.type=="path"||A)&&(d.path=function(ze){var Qe=/[ahqstv]/gi,ht=a._pathToAbsolute;if(x(ze).match(Qe)&&(ht=a._path2curve),Qe=/[clmz]/g,ht==a._pathToAbsolute&&!x(ze).match(Qe)){var Ue=x(ze).replace(fe,function(Kt,pt,mt){var et=[],Nt=pt.toLowerCase()=="m",rt=ae[pt];return mt.replace(O,function(Mt){Nt&&et.length==2&&(rt+=et+ae[pt=="m"?"l":"L"],et=[]),et.push($(Mt*Y))}),rt+et});return Ue}var dt,We,_t=ht(ze);Ue=[];for(var ft=0,St=_t.length;ft<St;ft++){dt=_t[ft],(We=_t[ft][0].toLowerCase())=="z"&&(We="x");for(var Ze=1,$e=dt.length;Ze<$e;Ze++)We+=$(dt[Ze]*Y)+(Ze!=$e-1?",":G);Ue.push(We)}return Ue.join(X)}(~x(m.path).toLowerCase().indexOf("r")?a._pathToAbsolute(m.path):m.path),r._.dirty=1,r.type=="image"&&(r._.fillpos=[m.x,m.y],r._.fillsize=[m.width,m.height],ge(r,1,1,0,0,0))),"transform"in s&&r.transform(s.transform),D){var W=+m.cx,ie=+m.cy,be=+m.rx||+m.r||0,Ce=+m.ry||+m.r||0;d.path=a.format("ar{0},{1},{2},{3},{4},{1},{4},{1}x",$((W-be)*Y),$((ie-Ce)*Y),$((W+be)*Y),$((ie+Ce)*Y),$(W*Y)),r._.dirty=1}if("clip-rect"in s){var ye=x(s["clip-rect"]).split(U);if(ye.length==4){ye[2]=+ye[2]+ +ye[0],ye[3]=+ye[3]+ +ye[1];var _e=d.clipRect||a._g.doc.createElement("div"),Se=_e.style;Se.clip=a.format("rect({1}px {2}px {3}px {0}px)",ye),d.clipRect||(Se.position="absolute",Se.top=0,Se.left=0,Se.width=r.paper.width+"px",Se.height=r.paper.height+"px",d.parentNode.insertBefore(_e,d),_e.appendChild(d),d.clipRect=_e)}s["clip-rect"]||d.clipRect&&(d.clipRect.style.clip="auto")}if(r.textpath){var Ae=r.textpath.style;s.font&&(Ae.font=s.font),s["font-family"]&&(Ae.fontFamily='"'+s["font-family"].split(",")[0].replace(/^['"]+|['"]+$/g,G)+'"'),s["font-size"]&&(Ae.fontSize=s["font-size"]),s["font-weight"]&&(Ae.fontWeight=s["font-weight"]),s["font-style"]&&(Ae.fontStyle=s["font-style"])}if("arrow-start"in s&&K(N,s["arrow-start"]),"arrow-end"in s&&K(N,s["arrow-end"],1),s.opacity!=null||s.fill!=null||s.src!=null||s.stroke!=null||s["stroke-width"]!=null||s["stroke-opacity"]!=null||s["fill-opacity"]!=null||s["stroke-dasharray"]!=null||s["stroke-miterlimit"]!=null||s["stroke-linejoin"]!=null||s["stroke-linecap"]!=null){var ke=d.getElementsByTagName("fill");if(!(ke=ke&&ke[0])&&(ke=xe("fill")),r.type=="image"&&s.src&&(ke.src=s.src),s.fill&&(ke.on=!0),ke.on!=null&&s.fill!="none"&&s.fill!==null||(ke.on=!1),ke.on&&s.fill){var Ne=x(s.fill).match(a._ISURL);if(Ne){ke.parentNode==d&&d.removeChild(ke),ke.rotate=!0,ke.src=Ne[1],ke.type="tile";var Me=r.getBBox(1);ke.position=Me.x+X+Me.y,r._.fillpos=[Me.x,Me.y],a._preload(Ne[1],function(){r._.fillsize=[this.offsetWidth,this.offsetHeight]})}else ke.color=a.getRGB(s.fill).hex,ke.src=G,ke.type="solid",a.getRGB(s.fill).error&&(N.type in{circle:1,ellipse:1}||x(s.fill).charAt()!="r")&&pe(N,s.fill,ke)&&(m.fill="none",m.gradient=s.fill,ke.rotate=!1)}if("fill-opacity"in s||"opacity"in s){var De=((+m["fill-opacity"]+1||2)-1)*((+m.opacity+1||2)-1)*((+a.getRGB(s.fill).o+1||2)-1);De=B(F(De,0),1),ke.opacity=De,ke.src&&(ke.color="none")}d.appendChild(ke);var Re=d.getElementsByTagName("stroke")&&d.getElementsByTagName("stroke")[0],qe=!1;!Re&&(qe=Re=xe("stroke")),(s.stroke&&s.stroke!="none"||s["stroke-width"]||s["stroke-opacity"]!=null||s["stroke-dasharray"]||s["stroke-miterlimit"]||s["stroke-linejoin"]||s["stroke-linecap"])&&(Re.on=!0),(s.stroke=="none"||s.stroke===null||Re.on==null||s.stroke==0||s["stroke-width"]==0)&&(Re.on=!1);var Fe=a.getRGB(s.stroke);Re.on&&s.stroke&&(Re.color=Fe.hex),De=((+m["stroke-opacity"]+1||2)-1)*((+m.opacity+1||2)-1)*((+Fe.o+1||2)-1);var je=.75*(b(s["stroke-width"])||1);if(De=B(F(De,0),1),s["stroke-width"]==null&&(je=m["stroke-width"]),s["stroke-width"]&&(Re.weight=je),je&&je<1&&(De*=je)&&(Re.weight=1),Re.opacity=De,s["stroke-linejoin"]&&(Re.joinstyle=s["stroke-linejoin"]||"miter"),Re.miterlimit=s["stroke-miterlimit"]||8,s["stroke-linecap"]&&(Re.endcap=s["stroke-linecap"]=="butt"?"flat":s["stroke-linecap"]=="square"?"square":"round"),"stroke-dasharray"in s){var Xe={"-":"shortdash",".":"shortdot","-.":"shortdashdot","-..":"shortdashdotdot",". ":"dot","- ":"dash","--":"longdash","- .":"dashdot","--.":"longdashdot","--..":"longdashdotdot"};Re.dashstyle=Xe[o](s["stroke-dasharray"])?Xe[s["stroke-dasharray"]]:G}qe&&d.appendChild(Re)}if(N.type=="text"){N.paper.canvas.style.display=G;var Ge=N.paper.span,lt=m.font&&m.font.match(/\d+(?:\.\d*)?(?=px)/);v=Ge.style,m.font&&(v.font=m.font),m["font-family"]&&(v.fontFamily=m["font-family"]),m["font-weight"]&&(v.fontWeight=m["font-weight"]),m["font-style"]&&(v.fontStyle=m["font-style"]),lt=b(m["font-size"]||lt&&lt[0])||10,v.fontSize=100*lt+"px",N.textpath.string&&(Ge.innerHTML=x(N.textpath.string).replace(/</g,"&#60;").replace(/&/g,"&#38;").replace(/\n/g,"<br>"));var ct=Ge.getBoundingClientRect();N.W=m.w=(ct.right-ct.left)/100,N.H=m.h=(ct.bottom-ct.top)/100,N.X=m.x,N.Y=m.y+N.H/2,("x"in s||"y"in s)&&(N.path.v=a.format("m{0},{1}l{2},{1}",$(m.x*Y),$(m.y*Y),$(m.x*Y)+1));for(var kt=["x","y","text","font","font-family","font-weight","font-style","font-size"],ut=0,Tt=kt.length;ut<Tt;ut++)if(kt[ut]in s){N._.dirty=1;break}switch(m["text-anchor"]){case"start":N.textpath.style["v-text-align"]="left",N.bbx=N.W/2;break;case"end":N.textpath.style["v-text-align"]="right",N.bbx=-N.W/2;break;default:N.textpath.style["v-text-align"]="center",N.bbx=0}N.textpath.style["v-text-kern"]=!0}},pe=function(r,s,d){r.attrs=r.attrs||{},r.attrs;var m=Math.pow,v="linear",A=".5 .5";if(r.attrs.gradient=s,s=(s=x(s).replace(a._radial_gradient,function(be,Ce,ye){return v="radial",Ce&&ye&&(Ce=b(Ce),ye=b(ye),m(Ce-.5,2)+m(ye-.5,2)>.25&&(ye=R.sqrt(.25-m(Ce-.5,2))*(2*(ye>.5)-1)+.5),A=Ce+X+ye),G})).split(/\s*\-\s*/),v=="linear"){var D=s.shift();if(D=-b(D),isNaN(D))return null}var N=a._parseDots(s);if(!N)return null;if(r=r.shape||r.node,N.length){r.removeChild(d),d.on=!0,d.method="none",d.color=N[0].color,d.color2=N[N.length-1].color;for(var V=[],W=0,ie=N.length;W<ie;W++)N[W].offset&&V.push(N[W].offset+X+N[W].color);d.colors=V.length?V.join():"0% "+d.color,v=="radial"?(d.type="gradientTitle",d.focus="100%",d.focussize="0 0",d.focusposition=A,d.angle=0):(d.type="gradient",d.angle=(270-D)%360),r.appendChild(d)}return 1},c=function(r,s){this[0]=this.node=r,r.raphael=!0,this.id=a._oid++,r.raphaelid=this.id,this.X=0,this.Y=0,this.attrs={},this.paper=s,this.matrix=a.matrix(),this._={transform:[],sx:1,sy:1,dx:0,dy:0,deg:0,dirty:1,dirtyT:1},!s.bottom&&(s.bottom=this),this.prev=s.top,s.top&&(s.top.next=this),s.top=this,this.next=null},u=a.el;c.prototype=u,u.constructor=c,u.transform=function(r){if(r==null)return this._.transform;var s,d=this.paper._viewBoxShift,m=d?"s"+[d.scale,d.scale]+"-1-1t"+[d.dx,d.dy]:G;d&&(s=r=x(r).replace(/\.{3}|\u2026/g,this._.transform||G)),a._extractTransform(this,m+r);var v,A=this.matrix.clone(),D=this.skew,N=this.node,V=~x(this.attrs.fill).indexOf("-"),W=!x(this.attrs.fill).indexOf("url(");if(A.translate(1,1),W||V||this.type=="image")if(D.matrix="1 0 0 1",D.offset="0 0",v=A.split(),V&&v.noRotation||!v.isSimple){N.style.filter=A.toFilter();var ie=this.getBBox(),be=this.getBBox(1),Ce=ie.x-be.x,ye=ie.y-be.y;N.coordorigin=Ce*-Y+X+ye*-Y,ge(this,1,1,Ce,ye,0)}else N.style.filter=G,ge(this,v.scalex,v.scaley,v.dx,v.dy,v.rotate);else N.style.filter=G,D.matrix=x(A),D.offset=A.offset();return s!==null&&(this._.transform=s,a._extractTransform(this,s)),this},u.rotate=function(r,s,d){if(this.removed)return this;if(r!=null){if((r=x(r).split(U)).length-1&&(s=b(r[1]),d=b(r[2])),r=b(r[0]),d==null&&(s=d),s==null||d==null){var m=this.getBBox(1);s=m.x+m.width/2,d=m.y+m.height/2}return this._.dirtyT=1,this.transform(this._.transform.concat([["r",r,s,d]])),this}},u.translate=function(r,s){return this.removed?this:((r=x(r).split(U)).length-1&&(s=b(r[1])),r=b(r[0])||0,s=+s||0,this._.bbox&&(this._.bbox.x+=r,this._.bbox.y+=s),this.transform(this._.transform.concat([["t",r,s]])),this)},u.scale=function(r,s,d,m){if(this.removed)return this;if((r=x(r).split(U)).length-1&&(s=b(r[1]),d=b(r[2]),m=b(r[3]),isNaN(d)&&(d=null),isNaN(m)&&(m=null)),r=b(r[0]),s==null&&(s=r),m==null&&(d=m),d==null||m==null)var v=this.getBBox(1);return d=d??v.x+v.width/2,m=m??v.y+v.height/2,this.transform(this._.transform.concat([["s",r,s,d,m]])),this._.dirtyT=1,this},u.hide=function(){return!this.removed&&(this.node.style.display="none"),this},u.show=function(){return!this.removed&&(this.node.style.display=G),this},u.auxGetBBox=a.el.getBBox,u.getBBox=function(){var r=this.auxGetBBox();if(this.paper&&this.paper._viewBoxShift){var s={},d=1/this.paper._viewBoxShift.scale;return s.x=r.x-this.paper._viewBoxShift.dx,s.x*=d,s.y=r.y-this.paper._viewBoxShift.dy,s.y*=d,s.width=r.width*d,s.height=r.height*d,s.x2=s.x+s.width,s.y2=s.y+s.height,s}return r},u._getBBox=function(){return this.removed?{}:{x:this.X+(this.bbx||0)-this.W/2,y:this.Y-this.H,width:this.W,height:this.H}},u.remove=function(){if(!this.removed&&this.node.parentNode){for(var r in this.paper.__set__&&this.paper.__set__.exclude(this),a.eve.unbind("raphael.*.*."+this.id),a._tear(this,this.paper),this.node.parentNode.removeChild(this.node),this.shape&&this.shape.parentNode.removeChild(this.shape),this)this[r]=typeof this[r]=="function"?a._removedFactory(r):null;this.removed=!0}},u.attr=function(r,s){if(this.removed)return this;if(r==null){var d={};for(var m in this.attrs)this.attrs[o](m)&&(d[m]=this.attrs[m]);return d.gradient&&d.fill=="none"&&(d.fill=d.gradient)&&delete d.gradient,d.transform=this._.transform,d}if(s==null&&a.is(r,"string")){if(r=="fill"&&this.attrs.fill=="none"&&this.attrs.gradient)return this.attrs.gradient;for(var v=r.split(U),A={},D=0,N=v.length;D<N;D++)(r=v[D])in this.attrs?A[r]=this.attrs[r]:a.is(this.paper.customAttributes[r],"function")?A[r]=this.paper.customAttributes[r].def:A[r]=a._availableAttrs[r];return N-1?A:A[v[0]]}if(this.attrs&&s==null&&a.is(r,"array")){for(A={},D=0,N=r.length;D<N;D++)A[r[D]]=this.attr(r[D]);return A}var V;for(var W in s!=null&&((V={})[r]=s),s==null&&a.is(r,"object")&&(V=r),V)j("raphael.attr."+W+"."+this.id,this,V[W]);if(V){for(W in this.paper.customAttributes)if(this.paper.customAttributes[o](W)&&V[o](W)&&a.is(this.paper.customAttributes[W],"function")){var ie=this.paper.customAttributes[W].apply(this,[].concat(V[W]));for(var be in this.attrs[W]=V[W],ie)ie[o](be)&&(V[be]=ie[be])}V.text&&this.type=="text"&&(this.textpath.string=V.text),de(this,V)}return this},u.toFront=function(){return!this.removed&&this.node.parentNode.appendChild(this.node),this.paper&&this.paper.top!=this&&a._tofront(this,this.paper),this},u.toBack=function(){return this.removed?this:(this.node.parentNode.firstChild!=this.node&&(this.node.parentNode.insertBefore(this.node,this.node.parentNode.firstChild),a._toback(this,this.paper)),this)},u.insertAfter=function(r){return this.removed?this:(r.constructor==a.st.constructor&&(r=r[r.length-1]),r.node.nextSibling?r.node.parentNode.insertBefore(this.node,r.node.nextSibling):r.node.parentNode.appendChild(this.node),a._insertafter(this,r,this.paper),this)},u.insertBefore=function(r){return this.removed?this:(r.constructor==a.st.constructor&&(r=r[0]),r.node.parentNode.insertBefore(this.node,r.node),a._insertbefore(this,r,this.paper),this)},u.blur=function(r){var s=this.node.runtimeStyle,d=s.filter;return d=d.replace(ve,G),+r!=0?(this.attrs.blur=r,s.filter=d+X+" progid:DXImageTransform.Microsoft.Blur(pixelradius="+(+r||1.5)+")",s.margin=a.format("-{0}px 0 0 -{0}px",$(+r||1.5))):(s.filter=d,s.margin=0,delete this.attrs.blur),this},a._engine.path=function(r,s){var d=xe("shape");d.style.cssText=J,d.coordsize=Y+X+Y,d.coordorigin=s.coordorigin;var m=new c(d,s),v={fill:"none",stroke:"#000"};r&&(v.path=r),m.type="path",m.path=[],m.Path=G,de(m,v),s.canvas&&s.canvas.appendChild(d);var A=xe("skew");return A.on=!0,d.appendChild(A),m.skew=A,m.transform(G),m},a._engine.rect=function(r,s,d,m,v,A){var D=a._rectPath(s,d,m,v,A),N=r.path(D),V=N.attrs;return N.X=V.x=s,N.Y=V.y=d,N.W=V.width=m,N.H=V.height=v,V.r=A,V.path=D,N.type="rect",N},a._engine.ellipse=function(r,s,d,m,v){var A=r.path();return A.attrs,A.X=s-m,A.Y=d-v,A.W=2*m,A.H=2*v,A.type="ellipse",de(A,{cx:s,cy:d,rx:m,ry:v}),A},a._engine.circle=function(r,s,d,m){var v=r.path();return v.attrs,v.X=s-m,v.Y=d-m,v.W=v.H=2*m,v.type="circle",de(v,{cx:s,cy:d,r:m}),v},a._engine.image=function(r,s,d,m,v,A){var D=a._rectPath(d,m,v,A),N=r.path(D).attr({stroke:"none"}),V=N.attrs,W=N.node,ie=W.getElementsByTagName("fill")[0];return V.src=s,N.X=V.x=d,N.Y=V.y=m,N.W=V.width=v,N.H=V.height=A,V.path=D,N.type="image",ie.parentNode==W&&W.removeChild(ie),ie.rotate=!0,ie.src=s,ie.type="tile",N._.fillpos=[d,m],N._.fillsize=[v,A],W.appendChild(ie),ge(N,1,1,0,0,0),N},a._engine.text=function(r,s,d,m){var v=xe("shape"),A=xe("path"),D=xe("textpath");s=s||0,d=d||0,m=m||"",A.v=a.format("m{0},{1}l{2},{1}",$(s*Y),$(d*Y),$(s*Y)+1),A.textpathok=!0,D.string=x(m),D.on=!0,v.style.cssText=J,v.coordsize=Y+X+Y,v.coordorigin="0 0";var N=new c(v,r),V={fill:"#000",stroke:"none",font:a._availableAttrs.font,text:m};N.shape=v,N.path=A,N.textpath=D,N.type="text",N.attrs.text=x(m),N.attrs.x=s,N.attrs.y=d,N.attrs.w=1,N.attrs.h=1,de(N,V),v.appendChild(D),v.appendChild(A),r.canvas.appendChild(v);var W=xe("skew");return W.on=!0,v.appendChild(W),N.skew=W,N.transform(G),N},a._engine.setSize=function(r,s){var d=this.canvas.style;return this.width=r,this.height=s,r==+r&&(r+="px"),s==+s&&(s+="px"),d.width=r,d.height=s,d.clip="rect(0 "+r+" "+s+" 0)",this._viewBox&&a._engine.setViewBox.apply(this,this._viewBox),this},a._engine.setViewBox=function(r,s,d,m,v){a.eve("raphael.setViewBox",this,this._viewBox,[r,s,d,m,v]);var A,D,N=this.getSize(),V=N.width,W=N.height;return v&&(d*(A=W/m)<V&&(r-=(V-d*A)/2/A),m*(D=V/d)<W&&(s-=(W-m*D)/2/D)),this._viewBox=[r,s,d,m,!!v],this._viewBoxShift={dx:-r,dy:-s,scale:N},this.forEach(function(ie){ie.transform("...")}),this},a._engine.initWin=function(r){var s=r.document;s.styleSheets.length<31?s.createStyleSheet().addRule(".rvml","behavior:url(#default#VML)"):s.styleSheets[0].addRule(".rvml","behavior:url(#default#VML)");try{!s.namespaces.rvml&&s.namespaces.add("rvml","urn:schemas-microsoft-com:vml"),xe=function(d){return s.createElement("<rvml:"+d+' class="rvml">')}}catch{xe=function(m){return s.createElement("<"+m+' xmlns="urn:schemas-microsoft.com:vml" class="rvml">')}}},a._engine.initWin(a._g.win),a._engine.create=function(){var r=a._getContainer.apply(0,arguments),s=r.container,d=r.height,m=r.width,v=r.x,A=r.y;if(!s)throw new Error("VML container not found.");var D=new a._Paper,N=D.canvas=a._g.doc.createElement("div"),V=N.style;return v=v||0,A=A||0,m=m||512,d=d||342,D.width=m,D.height=d,m==+m&&(m+="px"),d==+d&&(d+="px"),D.coordsize=216e5+X+216e5,D.coordorigin="0 0",D.span=a._g.doc.createElement("span"),D.span.style.cssText="position:absolute;left:-9999em;top:-9999em;padding:0;margin:0;line-height:1;",N.appendChild(D.span),V.cssText=a.format("top:0;left:0;width:{0};height:{1};display:inline-block;position:relative;clip:rect(0 {0} {1} 0);overflow:hidden",m,d),s==1?(a._g.doc.body.appendChild(N),V.left=v+"px",V.top=A+"px",V.position="absolute"):s.firstChild?s.insertBefore(N,s.firstChild):s.appendChild(N),D.renderfix=function(){},D},a.prototype.clear=function(){a.eve("raphael.clear",this),this.canvas.innerHTML=G,this.span=a._g.doc.createElement("span"),this.span.style.cssText="position:absolute;left:-9999em;top:-9999em;padding:0;margin:0;line-height:1;display:inline;",this.canvas.appendChild(this.span),this.bottom=this.top=null},a.prototype.remove=function(){for(var r in a.eve("raphael.remove",this),this.canvas.parentNode.removeChild(this.canvas),this)this[r]=typeof this[r]=="function"?a._removedFactory(r):null;return!0};var p=a.st;for(var n in u)u[o](n)&&!p[o](n)&&(p[n]=function(r){return function(){var s=arguments;return this.forEach(function(d){d[r].apply(d,s)})}}(n))}}).apply(z,k))===void 0||(T.exports=f)}])})})(Cn);var Nn=Cn.exports;const zt=wn(Nn);var q={};q.Common={nodeIdIncrement:0,activeNode:0,roundFloat:function(h,w){for(var T=0,z=1;T<w;)z*=10,T++;return Math.round(h*z)/z},apply:function(h,w){if(h&&typeof w=="object")for(var T in w)h[T]=w[T];return h},addRaphEventHandler:function(h,w,T,z){try{h[w](function(C,k){return function(f,a){var o=k;o.e=f,C(o)}}(T,z))}catch{}},isInteger:function(h){return!isNaN(parseInt(h))},isXMLSerializerAvailable:function(){return typeof XMLSerializer=="function"},createSvgEl:function(h,w){if(h=document.createElementNS("http://www.w3.org/2000/svg",h),w)for(var T in w)w.hasOwnProperty(T)&&h.setAttribute(T,String(w[T]));return h},createGradientEl:function(h,w,T){if(w.type!="radialGradient")return!1;var z=q.Common.createSvgEl("radialGradient",{id:h,gradientUnits:"userSpaceOnUse",cx:T[0],cy:T[1],r:T[2],fx:T[0],fy:T[1]});if(w.stop)for(var C=w.stop,k=0;k<C.length;k++){var f=C[k];f["@attributes"]?z.appendChild(q.Common.createSvgEl("stop",f["@attributes"])):(f._attributes&&delete f._attributes,f._children&&delete f._children,f.__proto__&&delete f.__proto__,z.appendChild(q.Common.createSvgEl("stop",f)))}return z},setCssStyle:function(h,w){var T=document.styleSheets[0];T.addRule?T.addRule(h,w):T.insertRule&&T.insertRule(h+" { "+w+" }",T.cssRules.length)}};q.PhyloCanvas=function(){var h,w,T,z,C;return function(k,f,a,o,x){if(this.getNewickObject=function(){return T},this.clear=function(){},this.scale=function(R){z.svg.scale(R)},this.getSvg=function(){return z},this.getPhylogram=function(){return h},this.getSvgSource=function(){if(zt.svg&&q.Common.isXMLSerializerAvailable()){var R=new XMLSerializer;return R.serializeToString(z.svg.canvas)}else return!1},typeof k=="object")if(k.xml){if(k.fileSource)var b=k.xml;else var b=wt.textToXML(k.xml);b=wt.xmlToJSON(b),C=new q.PhyloCanvas.PhyloxmlParse(b)}else if(k.phyloxml){if(k.fileSource)var b=k.phyloxml;else var b=wt.textToXML(k.phyloxml);b=wt.xmlToJSON(b),C=new q.PhyloCanvas.PhyloxmlParse(b)}else if(k.nexml){if(k.fileSource)var b=k.nexml;else var b=wt.textToXML(k.nexml);b=wt.xmlToJSON(b),C=new q.PhyloCanvas.NexmlParse(b,k)}else k.json?C=new q.PhyloCanvas.PhyloxmlParse(k.json):k.newick?C=new q.PhyloCanvas.NewickParse(k.newick):k.nexmlJson?C=new q.PhyloCanvas.NexmlJsonParse(k):alert("Please set the format of input data");else C=new q.PhyloCanvas.NewickParse(k);w=f,z=new q.PhyloCanvas.Render.SVG(w,a,o),x=="circular"?h=new q.PhyloCanvas.Render.CircularPhylogram(z,C):h=new q.PhyloCanvas.Render.Phylogram(z,C)}}();q.PhyloCanvas.prototype={};q.PhyloCanvas.Node=function(){return function(h,w){this.id=q.Common.nodeIdIncrement+=1,this.level=0,this.len=0,this.newickLen=0,this.name="",this.type="",this.chart={},this.img=[],h&&q.Common.apply(this,h),this._countAllChildren=!1,this._countImmediateChildren=!1,this._midBranchPosition=!1,this.children=new Array,w&&w.children.push(this)}}();q.PhyloCanvas.Node.prototype={getCountAllChildren:function(){if(this._countAllChildren!==!1)return this._countAllChildren;var h=0;for(var w in this.children)if(q.Common.isInteger(w)){var T=this.children[w];T.children&&T.children.length>0?h+=T.getCountAllChildren():h++}return this._countAllChildren=h,h},getCountImmediateChildren:function(){if(this._countImmediateChildren!==!1)return this._countImmediateChildren;var h=0;for(var w in this.children){var T=this.children[w];h+=T.length}return this._countImmediateChildren=h,h},getMidbranchPosition:function(h){if(this._midBranchPosition!==!1)return this._midBranchPosition;for(var w=[0,0],T=0;T<this.children.length;T++){var z=this.children[T];z.children&&z.children.length>0?T==0&&h?(w[0]=z.getMidbranchPosition(!0),w[1]+=z.getCountAllChildren()-1):T==0?(w[0]=z.getMidbranchPosition(),w[1]+=z.getCountAllChildren()):T==this.children.length-1?w[1]+=z.getMidbranchPosition():w[1]+=z.getCountAllChildren():T==0&&h?w[0]=0:T==0?(w[0]=1,w[1]+=1):(T==this.children.length-1,w[1]+=1)}return this._midBranchPosition=w[1]>=w[0]?(w[1]+w[0])/2:w[0],this._midBranchPosition}};q.PhyloCanvas.NewickParse=function(){var h,w,T,z=0,C=0,k,f,a=function(F){for(var B=new q.PhyloCanvas.Node;w!==")"&&w!==",";)w===":"?(R(),B.len=q.Common.roundFloat(x(),4),B.len==0&&(B.len=1e-4)):w==="'"||w==='"'?(B.type="label",B.name=b(w)):(B.type="label",B.name=x());return B.level=F.level+1,B},o=function(F){var B=new q.PhyloCanvas.Node;for(F&&(B.level=F.level+1);w!==")";)R(),w==="("?B.children.push(o(B)):B.children.push(a(B));return R(),w!==":"&&w!==")"&&w!==","&&w!==";"&&(B.type="label",B.name=x()),w===":"&&(R(),B.len=q.Common.roundFloat(x(),4),B.len==0&&(B.len=1e-4),B.type="stem"),B},x=function(){for(var F="";w!==":"&&w!==")"&&w!==","&&w!==";";)F+=w,R();return F},b=function(F){for(var B="";w!==F;)B+=w,R();return B},R=function(){return w=h.charAt(T),T+=1,w},$=function(F,B){if(F.children&&F.children.length)for(var M=0;M<F.children.length;M++){var U=F.children[M];U.len===0&&(U.len=1),U.newickLen=q.Common.roundFloat(U.len+F.newickLen,4),U.level>z&&(z=U.level),U.newickLen>C&&(C=U.newickLen),U.children.length>0&&$(U)}return F};return function(F){this.getRoot=function(){return k},this.getLevels=function(){return z},this.getNewickLen=function(){return C},this.getValidate=function(){return f},z=0,C=0,h=F,T=0,R(),k=o(),k=$(k)}}();q.PhyloCanvas.NewickParse.prototype={};q.PhyloCanvas.PhyloxmlParse=function(){var h=0,w=0,T,z,C=function(a,o){var x=new q.PhyloCanvas.Node;if(o&&(x.level=o.level+1),a.clade&&a.clade.length)for(var b=0;b<a.clade.length;b++){var R=a.clade[b];x.children.push(C(R,x))}if(a.branch_length&&(typeof a.branch_length=="object"&&(a.branch_length=a.branch_length[0].Text),x.len=q.Common.roundFloat(a.branch_length,4),x.len==0&&(x.len=1e-4)),a.color?(x.red=a.color[0].red[0].Text,x.green=a.color[0].green[0].Text,x.blue=a.color[0].blue[0].Text):(x.red=0,x.green=0,x.blue=0),a.property&&a.property[0].applies_to=="node"&&a.property[0].ref=="style:font_color"&&(x.font_color_hex=a.property[0].Text),a.name?(x.type="label",x.name=a.name[0].Text,a.name[0]&&a.name[0].style&&(x.style=a.name[0].style),a.name[0]&&a.name[0].bgStyle&&(x.bgStyle=a.name[0].bgStyle)):a.confidence&&(x.name=a.confidence[0].Text),a.sequence&&a.sequence[0]&&a.sequence[0].name&&a.sequence[0].name[0]&&a.sequence[0].name[0].Text&&(x.sequenceName=a.sequence[0].name[0].Text),a.taxonomy&&a.taxonomy[0]&&(a.taxonomy[0].scientific_name&&a.taxonomy[0].scientific_name[0]&&a.taxonomy[0].scientific_name[0].Text&&(x.taxonomyScientificName=a.taxonomy[0].scientific_name[0].Text),a.taxonomy[0].common_name&&a.taxonomy[0].common_name[0]&&a.taxonomy[0].common_name[0].Text&&(x.taxonomyCommonName=a.taxonomy[0].common_name[0].Text)),a.sequence&&a.sequence[0]&&a.sequence[0].accession&&a.sequence[0].accession[0]&&a.sequence[0].accession[0].Text&&(x.sequenceAccession=a.sequence[0].accession[0].Text),a.point&&(x.LatLong=[a.point[0].lat[0].Text,a.point[0].long[0].Text]),x.name||(x.sequenceName?x.name=x.sequenceName:x.taxonomyScientificName?x.name=x.taxonomyScientificName:x.taxonomyCommonName?x.name=x.taxonomyCommonName:x.sequenceAccession&&(x.name=x.sequenceAccession),x.name&&(x.type="label")),a.annotation&&(a.annotation[0]&&a.annotation[0].desc&&a.annotation[0].desc[0]&&a.annotation[0].desc[0].Text&&(x.description=a.annotation[0].desc[0].Text),a.annotation[0]&&a.annotation[0].uri&&a.annotation[0].uri[0]&&a.annotation[0].uri[0].Text&&(x.uri=a.annotation[0].uri[0].Text),a.annotation[0]&&a.annotation[0].img))for(var b in a.annotation[0].img)q.Common.isInteger(b)&&(x.img[b]=a.annotation[0].img[b].Text);if(a.chart&&a.chart[0])for(var b in a.chart[0])b!="Text"&&b!="_children"&&(x.chart[b]=a.chart[0][b][0].Text);return x&&x.level>1&&(x.len||(z="Error. Please include Branch Lengths - we only draw rooted phylogenetic trees.")),x},k=function(a,o){if(a.children&&a.children.length)for(var x=0;x<a.children.length;x++){var b=a.children[x];b.newickLen=Math.round((b.len+a.newickLen)*1e4)/1e4,b.level>h&&(h=b.level),b.newickLen>w&&(w=b.newickLen),b.children.length>0&&k(b)}return a},f=function(a,o){for(var x in a)x!="_children"&&x!="Text"&&(x=="rectangular"||x=="circular"?f(a[x][0],x):(q.PhyloCanvas.Render.Parameters[x]||(q.PhyloCanvas.Render.Parameters[x]={}),q.PhyloCanvas.Render.Parameters.set(x,a[x][0].Text,o)))};return function(a){if(this.getRoot=function(){return T},this.getLevels=function(){return h},this.getNewickLen=function(){return w},this.getValidate=function(){return z},a.phylogeny&&a.phylogeny[0]&&a.phylogeny[0].clade&&(T=C(a.phylogeny[0].clade[0])),a.phylogeny&&a.phylogeny[0]&&a.phylogeny[0].render&&a.phylogeny[0].render[0]){var o=a.phylogeny[0].render[0];if(o&&o.styles){var x=o.styles[0];for(var b in x)if(b!="_children"&&b!="Text")if(x[b][0].type&&x[b][0].type=="radialGradient"&&zt.svg)x[b][0].name=b,q.PhyloCanvas.Render.Style[b]=x[b][0],q.PhyloCanvas.Render.Style.jsphylosvgGradientList||(q.PhyloCanvas.Render.Style.jsphylosvgGradientList=[]),q.PhyloCanvas.Render.Style.jsphylosvgGradientList.push(b);else{q.PhyloCanvas.Render.Style[b]||(q.PhyloCanvas.Render.Style[b]={});for(var R in x[b][0])R!="_attributes"&&R!="_children"&&R!="type"&&(q.PhyloCanvas.Render.Style[b][R.replace("_","-")]=x[b][0][R])}}if(o&&o.parameters&&f(o.parameters[0]),o&&o.charts){var $=o.charts[0];for(var b in $)if(b!="_children"&&b!="Text")for(var R in $[b])$[b][R].type=="binary"?($[b][R].chart=b,q.PhyloCanvas.Render.Parameters.binaryCharts.push($[b][R])):$[b][R].type=="integratedBinary"?($[b][R].chart=b,q.PhyloCanvas.Render.Parameters.integratedBinaryCharts.push($[b][R])):$[b][R].type=="bar"&&($[b][R].chart=b,q.PhyloCanvas.Render.Parameters.barCharts.length==1&&q.PhyloCanvas.Render.Parameters.barCharts.shift(),q.PhyloCanvas.Render.Parameters.barCharts.push($[b][R]))}}T=k(T)}}();q.PhyloCanvas.PhyloxmlParse.prototype={};q.PhyloCanvas.NexmlParse=function(){var h=0,w=0,T,z,C,k,f=function(o,x,b){var R=new q.PhyloCanvas.Node;b&&(R.level=b.level+1);for(var $=0;$<C.length;$++)if(C[$].source==o.id)for(var F=0;F<k.length;F++)C[$].target==k[F].id&&R.children.push(f(k[F],C[$].length,R));if(R&&R.level>0&&!R.len&&(R.len=1),x&&(R.len=q.Common.roundFloat(x,4),R.len==0&&(R.len=1e-4)),o.label&&(R.type="label",R.name=o.label,o.style&&(R.style=o.style)),o.color){const B=o.color.replace(/[a-z%\s\(\)]/g,"").split(",");R.red=B[0],R.green=B[1],R.blue=B[2]}else{const B=q.PhyloCanvas.Render.Style.line.stroke.replace(/[a-z%\s\(\)]/g,"").split(",");R.red=B[0],R.green=B[1],R.blue=B[2]}return R},a=function(o,x){if(o.children&&o.children.length)for(var b=0;b<o.children.length;b++){var R=o.children[b];R.newickLen=Math.round((R.len+o.newickLen)*1e4)/1e4,R.level>h&&(h=R.level),R.newickLen>w&&(w=R.newickLen),R.children.length>0&&a(R)}return o};return function(o,x){this.getRoot=function(){return T},this.getLevels=function(){return h},this.getNewickLen=function(){return w},this.getValidate=function(){return z},x.tree&&o.trees[0]&&o.trees[0].tree[x.tree-1]?(C=o.trees[0].tree[x.tree-1].edge,k=o.trees[0].tree[x.tree-1].node):(C=o.trees[0].tree[0].edge,k=o.trees[0].tree[0].node);for(var b=0;b<k.length;b++){var R=0;if(k[b].root&&k[b].root=="true"){T=k[b];break}for(var $=0;$<C.length;$++)C[$].target==k[b].id&&R++;if(R==0){T=k[b];break}}T?(T=f(T),T=a(T)):z="Error. Currently, only rooted NeXML trees are supported."}}();q.PhyloCanvas.NexmlParse.prototype={};q.PhyloCanvas.NexmlJsonParse=function(){var h=0,w=0,T,z,C=[],k=[],f=function(x,b,R){var $=new q.PhyloCanvas.Node;R&&($.level=R.level+1);for(var F=0;F<C.length;F++)if(C[F].source==x.id)for(var B=0;B<k.length;B++)C[F].target==k[B].id&&$.children.push(f(k[B],C[F].length,$));return b&&($.len=q.Common.roundFloat(b,4),$.len==0&&($.len=1e-4)),x.label&&($.type="label",$.name=x.label,x.accession&&($.accession=x.accession),x.style&&($.style=x.style),x.bgStyle&&($.bgStyle=x.bgStyle)),x.chart&&($.chart=x.chart),$&&$.level>1&&($.len||(z="Error. Please include Branch Lengths - we only draw rooted phylogenetic trees.")),$},a=function(x,b){if(x.children&&x.children.length)for(var R=0;R<x.children.length;R++){var $=x.children[R];$.newickLen=Math.round(($.len+x.newickLen)*1e4)/1e4,$.level>h&&(h=$.level),$.newickLen>w&&(w=$.newickLen),$.children.length>0&&a($)}return x},o=function(x,b){for(var R in x)R!="_children"&&R!="Text"&&(R=="rectangular"||R=="circular"?o(x[R],R):(q.PhyloCanvas.Render.Parameters[R]||(q.PhyloCanvas.Render.Parameters[R]={}),q.PhyloCanvas.Render.Parameters.set(R,x[R],b)))};return function(x){this.getRoot=function(){return T},this.getLevels=function(){return h},this.getNewickLen=function(){return w},this.getValidate=function(){return z};var b=x.nexmlJson.nexml,R=b.render;if(R&&R.styles){var $=R.styles;for(var F in $)if(F!="_children"&&F!="Text")if($[F]["@attributes"].type&&$[F]["@attributes"].type=="radialGradient"&&zt.svg)$[F].name=F,$[F].type=$[F]["@attributes"].type,q.PhyloCanvas.Render.Style[F]=$[F],q.PhyloCanvas.Render.Style.jsphylosvgGradientList||(q.PhyloCanvas.Render.Style.jsphylosvgGradientList=[]),q.PhyloCanvas.Render.Style.jsphylosvgGradientList.push(F);else{q.PhyloCanvas.Render.Style[F]||(q.PhyloCanvas.Render.Style[F]={});for(var B in $[F]["@attributes"])B!="_attributes"&&B!="_children"&&B!="type"&&(q.PhyloCanvas.Render.Style[F][B.replace("_","-")]=$[F]["@attributes"][B])}}if(R&&R.parameters&&o(R.parameters),R&&R.charts){var M=R.charts;for(var F in M)M[F]["@attributes"].chart=F,M[F]["@attributes"].type=="binary"?q.PhyloCanvas.Render.Parameters.binaryCharts.push(M[F]["@attributes"]):M[F]["@attributes"].type=="integratedBinary"?q.PhyloCanvas.Render.Parameters.integratedBinaryCharts.push(M[F]["@attributes"]):M[F]["@attributes"].type=="bar"&&q.PhyloCanvas.Render.Parameters.barCharts.push(M[F]["@attributes"])}if(x.tree&&b.trees[0]&&b.trees[0].tree[x.tree-1])C=b.trees[0].tree[x.tree-1].edge,k=b.trees[0].tree[x.tree-1].node;else{for(var F=0;F<b.trees.tree.edge.length;F++)C.push(b.trees.tree.edge[F]["@attributes"]);for(var F=0;F<b.trees.tree.node.length;F++){var U=b.trees.tree.node[F]["@attributes"];U.label&&(U.chart=b.trees.tree.node[F].chart),k.push(U)}}for(var F=0;F<k.length;F++)k[F].root&&k[F].root=="true"&&(T=k[F]);T?(T=f(T),T=a(T)):z="Error. Currently, only rooted NeXML trees are supported."}}();q.PhyloCanvas.NexmlParse.prototype={};q.PhyloCanvas.Render={};q.PhyloCanvas.Render.Style={line:{stroke:"rgb(0,0,0)","stroke-width":1},text:{"font-family":"Verdana","font-size":12,"text-anchor":"start"},path:{stroke:"rgb(0,0,0)","stroke-width":1},connectedDash:{stroke:"rgb(200,200,200)","stroke-dasharray":". "},textSecantBg:{fill:"#EEE",stroke:"#DDD"},highlightedEdgeCircle:{fill:"black",stroke:"black"},barChart:{fill:"#003300",stroke:"#DDD"},getStyle:function(h,w){return this[h]?this[h]:this[w]}};q.PhyloCanvas.Render.Parameters={jsOverride:0,Rectangular:{bufferX:200,paddingX:10,paddingY:20,bufferInnerLabels:10,bufferOuterLabels:5,minHeightBetweenLeaves:10,alignPadding:0,alignRight:!1,showScaleBar:!1},Circular:{bufferRadius:.33,bufferAngle:20,initStartAngle:160,innerCircleRadius:0,minHeightBetweenLeaves:5,bufferInnerLabels:2,bufferOuterLabels:5},binaryCharts:[],integratedBinaryCharts:[],barCharts:[],binaryChartBufferInner:5,binaryChartBufferSiblings:.01,binaryChartThickness:15,binaryChartDisjointed:!1,barChartBufferInner:3,barChartHeight:50,barChartWidth:.5,set:function(h,w,T){this.jsOverride||(T?T=="circular"?this.Circular[h]=parseFloat(w):T=="rectangular"&&(this.Rectangular[h]=parseFloat(w)):this[h]=parseFloat(w))}};q.PhyloCanvas.Render.Line=function(){return function(h,w,T,z,C,k,f,a){this.type="line",this.attr=q.PhyloCanvas.Render.Style.line,this.attr.stroke=["rgb(",C,",",k,",",f,")"].join(""),this.x1=h,this.x2=w,this.y1=T,this.y2=z,a&&(q.Common.apply(this,a),a.attr&&(this.attr=a.attr))}}();q.PhyloCanvas.Render.Text=function(){return function(h,w,T,z){this.type="text",this.attr=q.PhyloCanvas.Render.Style.text,this.x=h,this.y=w,this.text=T,z&&(q.Common.apply(this,z),z.attr&&(this.attr=z.attr))}}();q.PhyloCanvas.Render.Path=function(){return q.PhyloCanvas.Render.Style.path,function(h,w){this.type="path",this.attr=q.PhyloCanvas.Render.Style.path,this.path=h,w&&(q.Common.apply(this,w),w.attr&&(this.attr=w.attr))}}();q.PhyloCanvas.Render.Circle=function(){return function(h,w,T,z){this.type="circle",this.x=h,this.y=w,this.radius=T,z&&(q.Common.apply(this,z),z.attr&&(this.attr=z.attr))}}();q.PhyloCanvas.Render.SVG=function(){return function(h,w,T){this.canvasSize=[w,T],this.svg=zt(h,this.canvasSize[0],this.canvasSize[1])}}();q.PhyloCanvas.Render.SVG.prototype={render:function(){for(var h=this.phylogramObject.getDrawInstructs(),w=0;w<h.length;w++)if(h[w].type=="line")this.svg.path(["M",h[w].x1,h[w].y1,"L",h[w].x2,h[w].y2]).attr(q.PhyloCanvas.Render.Style.line);else if(h[w].type=="path")this.svg.path(h[w].path).attr(h[w].attr);else if(h[w].type=="circle")this.svg.circle(h[w].x,h[w].y,h[w].radius).attr({stroke:"black",fill:"black"});else{var T=this.svg.text(h[w].x,h[w].y,h[w].text).attr(q.PhyloCanvas.Render.Style.text);h[w].attr&&T.attr(h[w].attr),h[w].rotate&&T.rotate(h[w].rotate);var z=T.getBBox();Math.sqrt(z.height*z.height+z.width*z.width)}},draw:function(h){var w,T;if(h.type=="line")w=this.svg.path(["M",h.x1,h.y1,"L",h.x2,h.y2]).attr(q.PhyloCanvas.Render.Style.line);else if(h.type=="path")w=this.svg.path(h.path).attr(h.attr);else if(h.type=="circle")w=this.svg.circle(h.x,h.y,h.radius).attr({stroke:"black",fill:"black"});else if(h.type=="text"){w=this.svg.text(h.x,h.y,h.text).attr(q.PhyloCanvas.Render.Style.text),h.attr&&w.attr(h.attr),h.rotate&&w.rotate(h.rotate);var z=w.getBBox();T=Math.sqrt(z.height*z.height+z.width*z.width)}return[w,T]}};q.PhyloCanvas.Render.Phylogram=function(){var h,w=q.PhyloCanvas.Render.Parameters.Rectangular,T,z,C,k,f,a,o=!0,x=0,b=0,R,$,F,B,M,U,j=[],X=function(O,J,Y,I){return["M",O,J,"L",Y,J,"L",Y,I,"L",O,I,"Z"]},G=function(O,J){if(O.len&&o==!1&&O.children.length==0&&(x=q.Common.roundFloat(x+k,4)),O.children.length>0){var Y=[],I,ue,ne,ge,xe,K,de;if(O.len&&(I=J,ue=J=q.Common.roundFloat(J+C*O.len,4),ne=x+O.getMidbranchPosition(o)*k,ge=ne,xe=O.red,K=O.green,de=O.blue,h.draw(new q.PhyloCanvas.Render.Line(I,ue,ne,ge,xe,K,de))),O.name){var pe={};if(pe=q.PhyloCanvas.Render.Style.getStyle("bootstrap","text"),O.font_color_hex?pe.fill=O.font_color_hex:pe.fill="#000000",O.uri&&(pe.href=O.uri),O.description&&(pe.title=O.description),O.level==0)var c=x+O.getMidbranchPosition(o)*k;else var c=ge;h.draw(new q.PhyloCanvas.Render.Text((ue||J)+5,c,O.name,{attr:pe}))}if(O.children&&O.children.length)for(var u=0;u<O.children.length;u++){var p=O.children[u];Y.push(G(p,J))}for(var n=[],u=0;u<Y.length;u++)Y[u][0]&&n.push(Y[u][0]),Y[u][1]&&n.push(Y[u][1]);for(var r=Math.min.apply(null,n),s=Math.max.apply(null,n),d=(r+s)/2,m="",v="",A="",D=0,u=0;u<O.children.length;++u){var N=O.children[u];if(u==0)m=N.red,v=N.green,A=N.blue;else if(m==N.red&&v==N.green&&A==N.blue)D=1;else{D=0;break}}D==0?q.PhyloCanvas.Render.Style.line.stroke="black":(xe=O.children[0].red,K=O.children[0].green,de=O.children[0].blue,q.PhyloCanvas.Render.Style.line.stroke=["rgb(",xe,",",K,",",de,")"].join("")),O.children.length==2?(xe=O.children[0].red,K=O.children[0].green,de=O.children[0].blue,q.PhyloCanvas.Render.Style.line.stroke=["rgb(",xe,",",K,",",de,")"].join(""),h.draw(new q.PhyloCanvas.Render.Path(["M",J+1e-4,r,"L",J,r,"L",J,d],{attr:q.PhyloCanvas.Render.Style.line})),xe=O.children[1].red,K=O.children[1].green,de=O.children[1].blue,q.PhyloCanvas.Render.Style.line.stroke=["rgb(",xe,",",K,",",de,")"].join(""),h.draw(new q.PhyloCanvas.Render.Path(["M",J,d,"L",J,s,"L",J+1e-4,s],{attr:q.PhyloCanvas.Render.Style.line}))):h.draw(new q.PhyloCanvas.Render.Path(["M",J+1e-4,r,"L",J,r,"L",J,s,"L",J+1e-4,s],{attr:q.PhyloCanvas.Render.Style.line}))}else{if(I=J,ue=q.Common.roundFloat(J+C*O.len,2),ne=x,ge=x,xe=O.red,K=O.green,de=O.blue,O.y=x,j.push(O),h.draw(new q.PhyloCanvas.Render.Line(I,ue,ne,ge,xe,K,de)),w.alignRight&&h.draw(new q.PhyloCanvas.Render.Path(["M",ue,ne,"L",w.alignPadding+f,ge],{attr:q.PhyloCanvas.Render.Style.connectedDash})),O.name){var pe={};O.style&&(pe=q.PhyloCanvas.Render.Style.getStyle(O.style,"text")),O.font_color_hex?pe.fill=O.font_color_hex:pe.fill="#000000",pe["text-anchor"]="start",O.uri&&(pe.href=O.uri),O.description&&(pe.title=O.description);var V=h.draw(new q.PhyloCanvas.Render.Text(w.alignRight?f+w.bufferInnerLabels+w.alignPadding:ue+w.bufferInnerLabels,ge,O.name,{attr:pe}));b=Math.max(V[1],b),q.PhyloCanvas.Render.Parameters.mouseRollOver&&q.Common.addRaphEventHandler(V[0],"mouseover",q.PhyloCanvas.Render.Parameters.mouseRollOver,{svg:h,node:O,x:ue,y:ge,textEl:V[0]}),q.PhyloCanvas.Render.Parameters.mouseRollOut&&q.Common.addRaphEventHandler(V[0],"mouseout",q.PhyloCanvas.Render.Parameters.mouseRollOut,{svg:h,node:O,x:ue,y:ge,textEl:V[0]}),q.PhyloCanvas.Render.Parameters.onClickAction&&q.Common.addRaphEventHandler(V[0],"click",q.PhyloCanvas.Render.Parameters.onClickAction,{svg:h,node:O,x:ue,y:ge,textEl:V[0]})}o&&(o=!1)}return[ne,ge]},ae=function(){y=x+k,$=0,F=w.showScaleBar*C,h.draw(new q.PhyloCanvas.Render.Line($,F,y,y)),h.draw(new q.PhyloCanvas.Render.Text(($+F)/2,y-8,w.showScaleBar))},fe=function(O,J,Y){for(var I=(Y&&Y.bufferInner?Y.bufferInner:0)|q.PhyloCanvas.Render.Parameters.binaryChartBufferInner,ue=(Y&&Y.bufferSiblings?Y.bufferSiblings*k:0)|(q.PhyloCanvas.Render.Parameters.binaryChartBufferSiblings<1?k*q.PhyloCanvas.Render.Parameters.binaryChartBufferSiblings:q.PhyloCanvas.Render.Parameters.binaryChartBufferSiblings),ne=(Y&&Y.thickness?Y.thickness:0)|q.PhyloCanvas.Render.Parameters.binaryChartThickness,ge=0;ge<j.length;ge++){var xe=j[ge];h.draw(new q.PhyloCanvas.Render.Path(X(O+I,xe.y-k/2+ue/2,O+I+ne,xe.y+k/2-ue/2),{attr:q.PhyloCanvas.Render.Style.getStyle(xe.chart[J],"textSecantBg")}))}return O+I+ne},ve=function(O,J,Y){for(var I=[],ue,ne=Y&&Y.bufferInner?Y.bufferInner:0|q.PhyloCanvas.Render.Parameters.barChartBufferInner,ge=Y&&Y.height?Y.height:0|q.PhyloCanvas.Render.Parameters.barChartHeight,xe=Y&&Y.width?Y.width<1?k*Y.width:Y.width:0|(q.PhyloCanvas.Render.Parameters.barChartWidth<1?k*q.PhyloCanvas.Render.Parameters.barChartWidth:q.PhyloCanvas.Render.Parameters.barChartWidth),K=0,de=0;de<j.length;de++)I.push(j[de].chart[J]);ue=Math.max.apply(null,I),K=q.Common.roundFloat(ge/ue,4);for(var de=0;de<j.length;de++){var pe=j[de];h.draw(new q.PhyloCanvas.Render.Path(X(O+ne,pe.y-xe/2,O+ne+K*pe.chart[J],pe.y+xe/2),{attr:q.PhyloCanvas.Render.Style.getStyle(pe.chart[J],"barChart")}))}return O+ne+ge};return function(O,J){this.getCanvasSize=function(){return[T,z]},this.getRoot=function(){return J.getRoot()},J.getValidate()&&h.draw(0,0,J.getValidate()),o=!0,h=O;var Y=J.getRoot(),I=J.getNewickLen();if(T=h.canvasSize[0],z=h.canvasSize[1],B=w.bufferX,M=w.paddingX,U=w.paddingY,a=w.minHeightBetweenLeaves,x=U,C=Math.round((T-B-M*2)/I),k=Math.round((z-U*2)/(w.showScaleBar?Y.getCountAllChildren():Y.getCountAllChildren()-1)),k<a&&(k=a),f=Math.round(T-B-M*2),(q.PhyloCanvas.Render.Parameters.binaryCharts.length||q.PhyloCanvas.Render.Parameters.barCharts.length)&&(w.alignRight=!0),G(Y,M),w.showScaleBar&&ae(),R=f+b+w.bufferInnerLabels,q.PhyloCanvas.Render.Parameters.binaryCharts.length){var ue=q.PhyloCanvas.Render.Parameters.binaryCharts;for(var ne in ue)R=fe(R,ue[ne].chart,ue[ne])}if(q.PhyloCanvas.Render.Parameters.barCharts.length){var ge=q.PhyloCanvas.Render.Parameters.barCharts;for(var ne in ge)ve(R,ge[ne].chart,ge[ne])}j=[],typeof bgLabelsHold<"u"&&(bgLabelsHold=[])}}();q.PhyloCanvas.Render.Phylogram.prototype={};q.PhyloCanvas.Render.CircularPhylogram=function(){var h,w=q.PhyloCanvas.Render.Parameters.Circular,T,z,C,k,f,a,o=!0,x=0,b,R,$,F=[],B=[],M,U,j=0,X,G=Math.PI/180;function ae(K,de){return de+=X,[q.Common.roundFloat(b+K*Math.sin(de*G),4),q.Common.roundFloat(R+K*Math.cos(de*G),4)]}function fe(K){var de=J(90-K-X);if(de>90&&de<270){de+=180;var pe="end"}else var pe="start";return[de,pe]}function ve(K,de,pe,c){var u=ae(K,de),p=ae(K,pe),n=[],r,s=0;return Math.abs(J(pe-de))>180?r=1:r=-1,c&&c.invertSecant&&(r*=-1,s=1),c&&c.noMove||n.push("M"),n.push(u[0],u[1],"A",K,K,0,r<1?0:1,s,p[0],p[1]),n}function O(K,de,pe,c){var u=[],p=ae(de,K),n=ae(pe,K);return c&&c.noMove||u.push("M"),u.push(p[0],p[1],"L",n[0],n[1]),u}function J(K){for(;K>360||K<0;)K>360?K-=360:K<0&&(K+=360);return K}function Y(K,de,pe,c){if(!de&&K.length>1)var c=K[3],pe=K[2],de=K[1],K=K[0];var u=ue("M",ve(K,pe,c,{noMove:1,invertSecant:0}),"L",ve(de,c,pe,{noMove:1,invertSecant:1}),"Z");return u}function I(K,de){if(de=de,K.len&&(o?x=M||1:K.children.length==0&&(x=q.Common.roundFloat(x+f,4))),K.children.length>0){var pe=[],c,u,p;if(c=de,u=de+=q.Common.roundFloat(k*K.len,4),K.name,K.children&&K.children.length)for(var n=0;n<K.children.length;n++){var r=K.children[n],s=I(r,de);s>0&&pe.push(s)}var d=q.Common.roundFloat(Math.min.apply(null,pe),4),m=q.Common.roundFloat(Math.max.apply(null,pe),4);K.level!=0&&h.draw(new q.PhyloCanvas.Render.Path(ue("M",ae(de+.01,d),"L",ve(de,d,m,{noMove:!0}),"L",ae(de+.01,m)))),K.len&&(p=q.Common.roundFloat(d+(m-d)/2,4),h.draw(new q.PhyloCanvas.Render.Path(O(p,c,u))))}else if(K.y=x,F.push(K),c=de,u=de=q.Common.roundFloat(de+k*K.len),p=x,h.draw(new q.PhyloCanvas.Render.Path(O(p,c,u))),h.draw(new q.PhyloCanvas.Render.Path(O(p,u,$),{attr:q.PhyloCanvas.Render.Style.connectedDash})),K.name){var W=ae($+w.bufferInnerLabels,p),v=fe(p),A=v[0],D=v[1],N={};K.style&&q.Common.apply(N,q.PhyloCanvas.Render.Style.getStyle(K.style,"text")),K.font_color_hex?N.fill=K.font_color_hex:N.fill="#000000",N["text-anchor"]=D,K.uri&&(N.href=K.uri),K.description&&(N.title=K.description);var V=h.draw(new q.PhyloCanvas.Render.Text(W[0],W[1],K.name,{attr:N,rotate:[A,W[0],W[1]]}));K.bgStyle&&B.push([K.bgStyle,p]);var W=ae(u,p);q.PhyloCanvas.Render.Parameters.mouseRollOver&&q.Common.addRaphEventHandler(V[0],"mouseover",q.PhyloCanvas.Render.Parameters.mouseRollOver,{svg:h,node:K,x:W[0],y:W[1],textEl:V[0]}),q.PhyloCanvas.Render.Parameters.mouseRollOut&&q.Common.addRaphEventHandler(V[0],"mouseout",q.PhyloCanvas.Render.Parameters.mouseRollOut,{svg:h,node:K,x:W[0],y:W[1],textEl:V[0]}),q.PhyloCanvas.Render.Parameters.onClickAction&&q.Common.addRaphEventHandler(V[0],"click",q.PhyloCanvas.Render.Parameters.onClickAction,{svg:h,node:K,x:W[0],y:W[1],textEl:V[0]}),j=Math.max(V[1],j)}return o&&(o=!1),p}function ue(K){for(var de=K,pe=1;pe<arguments.length;pe++)de=de.concat(arguments[pe]);return de}function ne(){var u=[];if(B.length>0){if(q.PhyloCanvas.Render.Style.jsphylosvgGradientList)for(var K=0;K<q.PhyloCanvas.Render.Style.jsphylosvgGradientList.length;K++){var de=q.PhyloCanvas.Render.Style.jsphylosvgGradientList[K],pe=q.Common.createGradientEl(de,q.PhyloCanvas.Render.Style[de],[b,R,$+j+w.bufferOuterLabels]);h.svg.defs.appendChild(pe)}for(var K=0;K<B.length;K++){if(K!=B.length-1&&B[K][0]==B[K+1][0]){B[K+1][2]=B[K][2]?B[K][2]:B[K][1];continue}var u=Y($,$+j+w.bufferOuterLabels,B[K][2]?B[K][2]-f/2:B[K][1]-f/2,B[K][1]+f/2),c=q.PhyloCanvas.Render.Style.getStyle(B[K][0],"textSecantBg"),p=h.draw(new q.PhyloCanvas.Render.Path(u,{attr:c.type?{}:c}));c.type&&c.type=="radialGradient"&&p[0].node.setAttribute("fill","url(#"+c.name+")"),c.type&&c.type=="radialGradient"&&p[0].node.setAttribute("stroke","none"),p[0].toBack()}}var u=Y($,$+j+w.bufferOuterLabels,(M||1)-f/2,360-f/2),p=h.draw(new q.PhyloCanvas.Render.Path(u,{attr:q.PhyloCanvas.Render.Style.textSecantBg}));return p[0].toBack(),$+j+w.bufferOuterLabels}function ge(K,de,pe){for(var c=pe&&pe.bufferInner?parseFloat(pe.bufferInner):q.PhyloCanvas.Render.Parameters.binaryChartBufferInner,u=(pe&&pe.bufferSiblings?pe.bufferSiblings*f:0)|(q.PhyloCanvas.Render.Parameters.binaryChartBufferSiblings<1?f*q.PhyloCanvas.Render.Parameters.binaryChartBufferSiblings:q.PhyloCanvas.Render.Parameters.binaryChartBufferSiblings),p=pe&&pe.thickness?parseFloat(pe.thickness):q.PhyloCanvas.Render.Parameters.binaryChartThickness,n=(pe&&pe.disjointed?pe.disjointed:!1)|q.PhyloCanvas.Render.Parameters.binaryChartDisjointed,r=pe&&pe.isInternal?pe.isInternal:!1,s=!0,d,m=0;m<F.length;m++){var v=F[m];if((!F[m+1]||v.chart[de]!==F[m+1].chart[de]||n)&&v.chart[de]!="none"){var A=q.PhyloCanvas.Render.Style.getStyle(v.chart[de],"textSecantBg");if(r)var D=[$-c-p,$-c,(d||v.y)-f/2+(s&&!n?0:u/2),v.y+f/2-(m==F.length-1&&!n?0:u/2)];else var D=[K+c,K+c+p,(d||v.y)-f/2+(s&&!n?0:u/2),v.y+f/2-(m==F.length-1&&!n?0:u/2)];if(A.label){var N=q.PhyloCanvas.Render.Style.getStyle(A.labelStyle,"text"),V=ae((D[0]+D[1])/2,(D[2]+D[3])/2),W=fe((D[2]+D[3])/2),ie=J(W[0]+(N.rotate?parseFloat(N.rotate):0)),be=J(90-(D[2]+D[3])/2-X);be>90&&be<270&&(ie+=180),N["text-anchor"]||(N["text-anchor"]="middle"),v.font_color_hex?A.fill=v.font_color_hex:A.fill="#000000";var Ce=h.draw(new q.PhyloCanvas.Render.Text(V[0],V[1],A.label,{attr:N,rotate:ie}));Ce[0].toBack()}if(A.borderStyle){var ye=q.PhyloCanvas.Render.Style.getStyle(A.borderStyle,"textSecantBg"),_e=[$,ye.fullsize?D[1]:D[0],D[2],D[3]],Se=h.draw(new q.PhyloCanvas.Render.Path(Y(_e),{attr:ye}));Se[0].toBack()}var Ae=h.draw(new q.PhyloCanvas.Render.Path(Y(D),{attr:A}));Ae[0].toBack(),d=0,s=!1}else d||(d=v.y),v.chart[de]=="none"&&(d=0);s=!1}return r?K:K+c+p}function xe(K,de,pe){for(var c=[],u,p=pe&&pe.bufferInner?parseFloat(pe.bufferInner):q.PhyloCanvas.Render.Parameters.barChartBufferInner,n=pe&&pe.height?parseFloat(pe.height):q.PhyloCanvas.Render.Parameters.barChartHeight?q.PhyloCanvas.Render.Parameters.barChartHeight:0,r=pe&&pe.width?parseFloat(pe.width)<1?f*parseFloat(pe.width):parseFloat(pe.width):0|(q.PhyloCanvas.Render.Parameters.barChartWidth<1?f*q.PhyloCanvas.Render.Parameters.barChartWidth:q.PhyloCanvas.Render.Parameters.barChartWidth),s=0,d=0;d<F.length;d++)c.push(F[d].chart[de]);u=Math.max.apply(null,c),s=q.Common.roundFloat(n/u,4);for(var d=0;d<F.length;d++){var m=F[d];m.chart[de]>0&&h.draw(new q.PhyloCanvas.Render.Path(Y(K+p,K+p+s*m.chart[de],m.y-r/2,m.y+r/2),{attr:q.PhyloCanvas.Render.Style.getStyle(m.chart[de],"barChart")}))}return K+p+n}return function(K,de,pe){if(this.getCanvasSize=function(){return[T,z]},this.getRoot=function(){return de.getRoot()},de.getValidate()){K.draw({type:"text",x:0,y:K.canvasSize[1]/3,text:de.getValidate()});return}h=K;var c=de.getRoot(),u=de.getNewickLen();if(T=h.canvasSize[0],z=h.canvasSize[1],b=T/2,R=z/2,C=Math.min.apply(null,[T,z]),pe=w.bufferRadius>1?w.bufferRadius:q.Common.roundFloat(C*w.bufferRadius,4),M=w.bufferAngle,a=w.innerCircleRadius,w.minHeightBetweenLeaves,X=w.initStartAngle,$=Math.round((C-pe-a)/2),k=($-a)/u,f=q.Common.roundFloat((360-M)/c.getCountAllChildren(),4),I(c,a),U=$+j+w.bufferOuterLabels,q.PhyloCanvas.Render.Parameters.integratedBinaryCharts.length){var p=q.PhyloCanvas.Render.Parameters.integratedBinaryCharts;for(var n in p){var r=p[n].bufferInner?p[n].bufferInner:q.PhyloCanvas.Render.Parameters.binaryChartBufferInner,s=p[n].thickness?p[n].thickness:q.PhyloCanvas.Render.Parameters.binaryChartThickness;U=ge(U-s-r,p[n].chart,p[n])}}if(U=ne(),q.PhyloCanvas.Render.Parameters.binaryCharts.length){var d=q.PhyloCanvas.Render.Parameters.binaryCharts;for(var n in d)U=ge(U,d[n].chart,d[n])}if(q.PhyloCanvas.Render.Parameters.barCharts.length){var m=q.PhyloCanvas.Render.Parameters.barCharts;for(var n in m)U=xe(U,m[n].chart,m[n])}F=[],B=[]}}();q.PhyloCanvas.Render.CircularPhylogram.prototype={};var wt=function(){var h=function(z){if(z&&typeof z=="object"){let C=function(){};return C.prototype=z,new C}},w=function(z){var C="";z&&typeof z=="string"&&(C=z);var k=/^((-)?([0-9]*)((\.{0,1})([0-9]+))?$)/;return k.test(C)},T={xmlToJSON:function(z){try{let o=function(F){return F.replace(/^\s+|\s+$/gm,"")},x=function(F){var B=/-/g,M=String(F).replace(B,"_");return M},b=function(F,B){if(B.attributes.length>0){var M=B.attributes.length-1,U;F._attributes=[];do U=String(x(B.attributes[M].name)),F._attributes.push(U),F[U]=o(B.attributes[M].value);while(M--)}},R=function(F){F.getNodeByAttribute=function(B,M){if(this.length>0){var U,j=this.length-1;try{do if(U=this[j],U[B]==M)return U;while(j--)}catch{return!1}return!1}},F.contains=function(B,M){if(this.length>0){var U=this.length-1;try{do if(this[U][B]==M)return!0;while(U--)}catch{return!1}return!1}},F.indexOf=function(B,M){var U=-1;if(this.length>0){var j=this.length-1;try{do this[j][B]==M&&(U=j);while(j--)}catch{return-1}return U}},F.SortByAttribute=function(B,M){if(this.length){let U=function(X,G){var ae=X[G];return ae=w(ae)?parseFloat(ae):ae,ae},j=function(X,G){var ae=0,fe,ve;return fe=U(X,B),ve=U(G,B),fe<ve?ae=-1:ve<fe&&(ae=1),M&&(ae=M.toUpperCase()=="DESC"?0-ae:ae),ae};this.sort(j)}},F.SortByValue=function(B){if(this.length){let M=function(j){var X=j.Text;return X=w(X)?parseFloat(X):X,X},U=function(j,X){var G=0,ae,fe;return ae=M(j),fe=M(X),ae<fe?G=-1:fe<ae&&(G=1),B&&(G=B.toUpperCase()=="DESC"?0-G:G),G};this.sort(U)}},F.SortByNode=function(B,M){if(this.length){let U=function(X,G){var ae=X[G][0].Text;return ae=w(ae)?parseFloat(ae):ae,ae},j=function(X,G){var ae=0,fe,ve;return fe=U(X,B),ve=U(G,B),fe<ve?ae=-1:ve<fe&&(ae=1),M&&(ae=M.toUpperCase()=="DESC"?0-ae:ae),ae};this.sort(j)}}},$=function(F,B){var M,U,j,X="";if(!B)return null;if(B.attributes.length>0&&b(F,B),F.Text="",B.hasChildNodes()){var G=B.childNodes.length-1,ae=0;do switch(U=B.childNodes[ae],U.nodeType){case 1:F._children=[],M=U.localName?U.localName:U.baseName,M=x(M),X!=M&&F._children.push(M),F[M]||(F[M]=[]),j={},F[M].push(j),U.attributes.length>0&&b(j,U),F[M].contains||R(F[M]),X=M,U.hasChildNodes()&&$(j,U);break;case 3:F.Text+=o(U.nodeValue);break;case 4:F.Text+=U.text?o(U.text):o(U.nodeValue);break}while(ae++<G)}};if(!z)return null;var C={};C.typeOf="JSXBObject";var k=z.nodeType==9?z.documentElement:z;if(C.RootName=k.nodeName||"",z.nodeType==3||z.nodeType==4)return z.nodeValue;var f=function(){var F={activate:function(){var B=[];return B&&(B.getNodesByAttribute=function(M,U){if(B&&B.length>0){var j=[],X,G=B.length-1;try{do X=B[G],X[M]===U&&j.push(X);while(G--);return j.reverse(),j}catch{return null}return null}},B.getNodeByAttribute=function(M,U){if(B&&B.length>0){var j,X=B.length-1;try{do if(j=B[X],j[M]===U)return j;while(X--)}catch{return null}return null}},B.getNodesByValue=function(M){if(B&&B.length>0){var U=[],j,X=B.length-1;try{do j=B[X],j.Text&&j.Text===M&&U.push(j);while(X--);return U}catch{return null}return null}},B.contains=function(M,U){if(B&&B.length>0){var j=B.length-1;try{do if(B[j][M]===U)return!0;while(j--)}catch{return!1}return!1}},B.indexOf=function(M,U){var j=-1;if(B&&B.length>0){var X=B.length-1;try{do B[X][M]===U&&(j=X);while(X--)}catch{return-1}return j}},B.SortByAttribute=function(M,U){if(B&&B.length>0){let j=function(G,ae){var fe=G[ae];return fe=bam.validation.isNumeric(fe)?parseFloat(fe):fe,fe},X=function(G,ae){var fe,ve;fe=j(G,M),ve=j(ae,M);var O=fe<ve?-1:ve<fe?1:0;return U&&(O=U.toUpperCase()==="DESC"?0-O:O),O};B.sort(X)}},B.SortByValue=function(M){if(B&&B.length>0){let U=function(X){var G=X.Text;return G=bam.validation.isNumeric(G)?parseFloat(G):G,G},j=function(X,G){var ae,fe;ae=U(X),fe=U(G);var ve=ae<fe?-1:fe<ae?1:0;return M&&(ve=M.toUpperCase()==="DESC"?0-ve:ve),ve};B.sort(j)}},B.SortByNode=function(M,U){if(B&&B.length>0){let j=function(G,ae){var fe=G[ae][0].Text;return fe=bam.validation.isNumeric(fe)?parseFloat(fe):fe,fe},X=function(G,ae){var fe,ve;fe=j(G,M),ve=j(ae,M);var O=fe<ve?-1:ve<fe?1:0;return U&&(O=U.toUpperCase()==="DESC"?0-O:O),O};B.sort(X)}}),B}};return F}(),a=function(){var F=h(f);return F.activate()};return $(C,k),z=null,k=null,C}catch{return null}},textToXML:function(z){var C=null;try{C=document.all?new ActiveXObject("Microsoft.XMLDOM"):new DOMParser,C.async=!1}catch{throw new Error("XML Parser could not be instantiated")}var k;try{document.all?k=C.loadXML(z)?C:!1:k=C.parseFromString(z,"text/xml")}catch{throw new Error("Error parsing XML string")}return k}};return T}();const Ie={};Ie.defaults={skip_sgml:!1,syncope:!1};var Mn=Ie.schemes={tamil:{vowels:["அ","ஆ","இ","ஈ","உ","ஊ","𑌋","𑍠","𑌌","𑍡","எ","ஏ","ஐ","ஒ","ஓ","ஔ"],vowel_marks:["ா","ி","ீ","ு","ூ","𑍃","𑍄","𑍢","𑍣","ெ","ே","ை","ொ","ோ","ௌ"],other_marks:["𑌂","𑌃","𑌁","","","ஃ"],virama:["்"],consonants:["க","𑌖","𑌗","𑌘","ங","ச","𑌛","ஜ","𑌝","ஞ","ட","𑌠","𑌡","𑌢","ண","த","𑌥","𑌦","𑌧","ந","ப","𑌫","𑌬","𑌭","ம","ய","ர","ல","வ","ஶ","ஷ","ஸ","ஹ","ள","ழ","ற","ன"],symbols:["௦","௧","௨","௩","௪","௫","௬","௭","௮","௯","ௐ","","𑌽","।","॥","௰","௱","௲"]},grantha:{vowels:["𑌅","𑌆","𑌇","𑌈","𑌉","𑌊","𑌋","𑍠","𑌌","𑍡","எ","𑌏","𑌐","ஒ","𑌓","𑌔"],vowel_marks:["𑌾","𑌿","𑍀","𑍁","𑍂","𑍃","𑍄","𑍢","𑍣","ெ","𑍇","𑍈","ொ","𑍋","𑍌"],other_marks:["𑌂","𑌃","𑌁","𑍞","𑍟","ஃ"],virama:["𑍍"],consonants:["𑌕","𑌖","𑌗","𑌘","𑌙","𑌚","𑌛","𑌜","𑌝","𑌞","𑌟","𑌠","𑌡","𑌢","𑌣","𑌤","𑌥","𑌦","𑌧","𑌨","𑌪","𑌫","𑌬","𑌭","𑌮","𑌯","𑌰","𑌲","𑌵","𑌶","𑌷","𑌸","𑌹","𑌳","ழ","ற","ன"],symbols:["௦","௧","௨","௩","௪","௫","௬","௭","௮","௯","𑍐","","𑌽","।","॥","௰","௱","௲"]},malayalam:{vowels:["അ","ആ","ഇ","ഈ","ഉ","ഊ","ഋ","ൠ","ഌ","ൡ","എ","ഏ","ഐ","ഒ","ഓ","ഔ"],vowel_marks:["ാ","ി","ീ","ു","ൂ","ൃ","ൄ","ൢ","ൣ","െ","േ","ൈ","ൊ","ോ","ൌ"],other_marks:["ം","ഃ","ഁ","","",""],virama:["്"],consonants:["ക","ഖ","ഗ","ഘ","ങ","ച","ഛ","ജ","ഝ","ഞ","ട","ഠ","ഡ","ഢ","ണ","ത","ഥ","ദ","ധ","ന","പ","ഫ","ബ","ഭ","മ","യ","ര","ല","വ","ശ","ഷ","സ","ഹ","ള","ഴ","റ","ഩ"],symbols:["൦","൧","൨","൩","൪","൫","൬","൭","൮","൯","ഒം","","ഽ","।","॥","൰","൱","൲"]},newa:{vowels:["𑐀","𑐁","𑐂","𑐃","𑐄","𑐅","𑐆","𑐇","𑐈","𑐉","","𑐊","𑐋","","𑐌","𑐍"],vowel_marks:["𑐵","𑐶","𑐷","𑐸","𑐹","𑐺","𑐻","𑐼","𑐽","","𑐾","𑐿","","𑑀","𑑁"],other_marks:["𑑄","𑑅","𑑃","𑑠","𑑡",""],virama:["𑑂"],consonants:["𑐎","𑐏","𑐐","𑐑","𑐒","𑐔","𑐕","𑐖","𑐗","𑐘","𑐚","𑐛","𑐜","𑐝","𑐞","𑐟","𑐠","𑐡","𑐢","𑐣","𑐥","𑐦","𑐧","𑐨","𑐩","𑐫","𑐬","𑐮","𑐰","𑐱","𑐲","𑐳","𑐴"],symbols:["𑑐","𑑑","𑑒","𑑓","𑑔","𑑕","𑑖","𑑗","𑑘","𑑙","𑑉","","𑑇","𑑋","𑑌"]},sarada:{vowels:["𑆃","𑆄","𑆅","𑆆","𑆇","𑆈","𑆉","𑆊","𑆋","𑆌","","𑆍","𑆎","","𑆏","𑆐"],vowel_marks:["𑆳","𑆴","𑆵","𑆶","𑆷","𑆸","𑆹","𑆺","𑆻","","𑆼","𑆽","","𑆾","𑆿"],other_marks:["𑆁","𑆂","𑆀","𑇁","𑇂",""],virama:["𑇀"],consonants:["𑆑","𑆒","𑆓","𑆔","𑆕","𑆖","𑆗","𑆘","𑆙","𑆚","𑆛","𑆜","𑆝","𑆞","𑆟","𑆠","𑆡","𑆢","𑆣","𑆤","𑆥","𑆦","𑆧","𑆨","𑆩","𑆪","𑆫","𑆬","𑆮","𑆯","𑆰","𑆱","𑆲","𑆭"],symbols:["𑇐","𑇑","𑇒","𑇓","𑇔","𑇕","𑇖","𑇗","𑇘","𑇙","𑇄","","𑇁","𑇅","𑇆"]},nandinagari:{vowels:["𑦠","𑦡","𑦢","𑦣","ᆔ","𑦥","𑦦","𑦧","𑧉𑧖","𑧉𑧗","","𑦪","𑦫","","𑦬","𑦭"],vowel_marks:["𑧑","𑧒","𑧓","𑧔","𑧕","𑧖","𑧗","𑧉𑧖","𑧉𑧗","","𑧚","𑧛","","𑧜","𑧝"],other_marks:["𑧞","𑧟","","",""],virama:["𑧠"],consonants:["𑦮","𑦯","𑦰","𑦱","ᆲ","𑦳","𑦴","𑦵","𑦶","𑦷","𑦸","𑦹","𑦺","𑦻","𑦼","𑦽","𑦾","𑦿","𑧀","𑧁","𑧂","𑧃","𑧄","𑧅","𑧆","𑧇","𑧈","𑧉","𑧊","𑧋","𑧌","𑧍","𑧎","𑧏","","𑧐"],symbols:["೦","೧","೨","೩","೪","೫","೬","೭","೮","೯","𑦬𑧞","","𑧡","।","॥"]},bengali:{vowels:["অ","আ","ই","ঈ","উ","ঊ","ঋ","ৠ","ঌ","ৡ","","এ","ঐ","","ও","ঔ"],vowel_marks:["া","ি","ী","ু","ূ","ৃ","ৄ","ৢ","ৣ","","ে","ৈ","ো","ৌ"],other_marks:["ং","ঃ","ঁ","","",""],virama:["্"],consonants:["ক","খ","গ","ঘ","ঙ","চ","ছ","জ","ঝ","ঞ","ট","ঠ","ড","ঢ","ণ","ত","থ","দ","ধ","ন","প","ফ","ব","ভ","ম","য","র","ল","ব","শ","ষ","স","হ","ळ","","","","য়","","","","","","","ড়","ঢ়"],symbols:["০","১","২","৩","৪","৫","৬","৭","৮","৯","ওঁ","","ঽ","।","॥"]},devanagari:{vowels:["अ","आ","इ","ई","उ","ऊ","ऋ","ॠ","ऌ","ॡ","ऎ","ए","ऐ","ऒ","ओ","औ"],vowel_marks:["ा","ि","ी","ु","ू","ृ","ॄ","ॢ","ॣ","ॆ","े","ै","ॊ","ो","ौ","ॎ","ॎे","ॎा","ॎो"],other_marks:["ं","ः","ँ","ᳵ","ᳶ",""],virama:["्"],consonants:["क","ख","ग","घ","ङ","च","छ","ज","झ","ञ","ट","ठ","ड","ढ","ण","त","थ","द","ध","न","प","फ","ब","भ","म","य","र","ल","व","श","ष","स","ह","ळ","ऴ","ऱ","ऩ","य़","क़","ख़","ग़","ज़","झ़","फ़","ड़","ढ़","थ़","ध़","व़"],symbols:["०","१","२","३","४","५","६","७","८","९","ॐ","ꣽ","ऽ","।","॥"],zwj:["‍"],skip:[""],accent:["॑","॒"],combo_accent:"ः॑ ः॒ ं॑ ं॒".split(" ")},telugu:{vowels:["అ","ఆ","ఇ","ఈ","ఉ","ఊ","ఋ","ౠ","ఌ","ౡ","ఎ","ఏ","ఐ","ఒ","ఓ","ఔ"],vowel_marks:["ా","ి","ీ","ు","ూ","ృ","ౄ","ౢ","ౣ","ె","ే","ై","ొ","ో","ౌ"],other_marks:["ం","ః","ఀ","","",""],virama:["్"],consonants:["క","ఖ","గ","ఘ","ఙ","చ","ఛ","జ","ఝ","ఞ","ట","ఠ","డ","ఢ","ణ","త","థ","ద","ధ","న","ప","ఫ","బ","భ","మ","య","ర","ల","వ","శ","ష","స","హ","ళ","ఴ","ఱ"],symbols:["౦","౧","౨","౩","౪","౫","౬","౭","౮","౯","ఓం","","ఽ","।","॥"]},iast:{vowels:["a","ā","i","ī","u","ū","ṛ","ṝ","l̥","l̥̄","e","ē","ai","o","ō","au","ê","aî","ô","aû"],other_marks:["ṃ","ḥ","m̐","ẖ","ḫ","ḵ"],virama:[""],consonants:["k","kh","g","gh","ṅ","c","ch","j","jh","ñ","ṭ","ṭh","ḍ","ḍh","ṇ","t","th","d","dh","n","p","ph","b","bh","m","y","r","l","v","ś","ṣ","s","h","ḷ","ḻ","ṟ","ṉ","ẏ","q","qh","ġ","z","zh","f","ṙ","ṙh","ṫh","ḋh","w"],symbols:["0","1","2","3","4","5","6","7","8","9","oṁ","oḿ","'","|","||","⁰","⁰⁰","⁰⁰⁰"]},slpish:{vowels:["a","ā","i","ī","u","ū","ṛ","ṝ","l̥","l̥̄","e","ē","E","o","ō","O","ê","Ê","ô","Ô"],other_marks:["ṃ","ḥ","m̐","ẖ","ḫ","ḵ"],virama:[""],consonants:["k","K","g","G","ṅ","c","C","j","J","ñ","ṭ","Ṭ","ḍ","Ḍ","ṇ","t","T","d","D","n","p","P","b","B","m","y","r","l","v","ś","ṣ","s","h","ḷ","ḻ","ṟ","ṉ","ẏ","q","Q","ġ","z","Z","f","ṙ","Ṙ","Ṫ","Ḋ","w"],symbols:["0","1","2","3","4","5","6","7","8","9","õ","ó","'","|","||","⁰","⁰⁰","⁰⁰⁰"]},hk:{vowels:["a","A","i","I","u","U","R","RR","lR","lRR","e","E","ai","o","O","au","e","ai","o","au"],other_marks:["M","H","M","H","H","H"],virama:[""],consonants:["k","kh","g","gh","G","c","ch","j","jh","J","T","Th","D","Dh","N","t","th","d","dh","n","p","ph","b","bh","m","y","r","l","v","z","S","s","h","L","zh","_r","_n"],symbols:["0","1","2","3","4","5","6","7","8","9","om","om","'","|","||","⁰","⁰⁰","⁰⁰⁰"]}},kn={},Dn={},Rt={};Ie.isRomanScheme=function(h){return kn.hasOwnProperty(h)};Ie.addBrahmicScheme=function(h,w){Ie.schemes[h]=w};Ie.addRomanScheme=function(h,w){"vowel_marks"in w||(w.vowel_marks=w.vowels.slice(1)),Ie.schemes[h]=w,kn[h]=!0};(function(){for(var h=["iast","slpish","hk"],w=0,T;T=h[w];w++)Ie.addRomanScheme(T,Mn[T])})();var In=function(h,w){var T=Dn[h]||{},z={},C=Ie.schemes[h],k={},f=[],a={},o=Ie.schemes[w];for(var x in C)if(C.hasOwnProperty(x)){var b=C[x],R=o[x];if(R!==void 0)for(var $=0;$<b.length;$++){var F=b[$],B=R[$],M=T[F]||[],U=M.length,j=0;for(f.push(F.length),j=0;j<U;j++)f.push(M[j].length);if(x==="vowel_marks"||x==="virama")for(a[F]=B,j=0;j<U;j++)a[M[j]]=B;else{for(k[F]=B,j=0;j<U;j++)k[M[j]]=B;if(x==="consonants"||x==="other")for(z[F]=B,j=0;j<U;j++)z[M[j]]=B}}}return{consonants:z,fromRoman:Ie.isRomanScheme(h),letters:k,marks:a,maxTokenLength:Math.max.apply(Math,f),toRoman:Ie.isRomanScheme(w),virama:o.virama}},Fn=function(h,w,T){for(var z=[],C=w.consonants,k=h.length,f=!1,a=w.letters,o=w.marks,x=w.maxTokenLength,b=T.skip_sgml,R=T.syncope,$,F,B="",M=w.toRoman,U=w.virama,j=!1,X=!1,G=!1,ae=0,fe;(fe=h.charAt(ae))||B;ae++){var ve=x-B.length;if(!(ve>0&&ae<k&&(B+=fe,ve>1)))for(var O=0;O<x;O++){var J=B.substr(0,x-O);if(j===!0)j=J!==">";else if(J==="<")j=b;else if(J==="##"){G=!G,B=B.substr(2);break}if(X=j||G,($=a[J])!==void 0&&!X){M?z.push($):(f?(F=o[J])?z.push(F):J!=="a"&&(z.push(U),z.push($)):z.push($),f=J in C),B=B.substr(x-O);break}else O===x-1&&(f&&(f=!1,R||z.push(U)),z.push(J),B=B.substr(1))}}return f&&!R&&z.push(U),z.join("")},qn=function(h,w){for(var T=[],z=w.consonants,C=!1,k=w.letters,f=w.marks,a=h.length,o=w.maxTokenLength,x,b="",R=w.toRoman,$=!1,F=0,B;(B=h.charAt(F))||b;F++){var M=o-b.length;if(!(M>0&&F<a&&(b+=B,M>1)))for(var U=0;U<o;U++){var j=b.substr(0,o-U);if((x=f[j])!==void 0&&!$){T.push(x),C=!1,b=b.substr(o-U);break}else if(x=k[j]){C&&(T.push("a"),C=!1),T.push(x),C=R&&j in z,b=b.substr(o-U);break}else U===o-1&&(C&&(T.push("a"),C=!1),T.push(j),b=b.substr(1))}}return C&&T.push("a"),T.join("")};Ie.t=function(h,w,T,z){z=z||{};var C=Rt.options||{},k=Ie.defaults,f=Rt.from===w&&Rt.to===T,a;for(var o in k)if(k.hasOwnProperty(o)){var x=k[o];o in z&&(x=z[o]),z[o]=x,x!==C[o]&&(f=!1)}return f?a=Rt.map:(a=In(w,T),Rt={from:w,map:a,options:z,to:T}),a.fromRoman?Fn(h,a,z):qn(h,a)};const zn=new Map([["c","ñ"],["t","n"],["k","ṅ"]]),On=[{name:"valapalagilaka",search:"ṙ",replace:()=>"r"},{name:"long e",group:"tamil",search:"ē",replace:()=>"e"},{name:"long o",group:"tamil",search:"ō",replace:()=>"o"},{name:"insert glide after back vowels",group:"tamil",search:"([aāuūoō])\\s+([aāiīuūeēoō])",replace:h=>`${h[1]} v${h[2]}`},{name:"insert glide after front vowels",group:"tamil",search:"([iīeē])\\s+([aāiīuūeēoō])",replace:h=>`${h[1]} y${h[2]}`},{name:"final -m sandhi variants",group:"tamil",search:"m(\\s*)([ṅkt])",replace:h=>`${zn.get(h[2])}${h[1]}${h[2]}`},{name:"ignore puḷḷi",group:"tamil",search:"[kṅcñṭtnpmyrlvḻḷṟṉ](?!\\s*[aāiīuūeēEoōOḵh])|[kṅcñṭtnpmyrlvḻḷṟṉ]$",replace:h=>`${h[0]}a`},{name:"pṛṣṭhamātrā e",search:"ê",replace:()=>"e"},{name:"pṛṣṭhamātrā o",search:"ô",replace:()=>"o"},{name:"pṛṣṭhamātrā ai",search:"Ê",replace:()=>"E"},{name:"pṛṣṭhamātrā au",search:"Ô",replace:()=>"O"},{name:"candrabindu",search:"m̐",replace:()=>"ṃ"},{name:"oṃkāras",search:"õ",replace:()=>"oṃ"},{name:"additional punctuation",group:"all",search:"[()\\[\\],;?!|¦_‘’“”·\\-–—―=+\\d.\\/]+",replace:()=>""},{name:"geminated aspirated consonants",search:"(?:kK|gG|cC|jJ|ṭṬ|ḍḌ|tT|dD|pP|bB)",replace:h=>h[0].slice(-1)},{name:"geminated m after h",search:"(?:ṃhm|hmm)",replace:()=>"hm"},{name:"geminated t",search:"([rṛi]|p[aā])tt|tt(?=[rvy]\\S)",replace:h=>h[1]?`${h[1]}t`:"t"},{name:"geminated consonants after r",search:"([rṛ]\\s*)([kgcjṭḍdpbṛnmyvl])\\2{1,2}",replace:h=>`${h[1]}${h[2]}`},{name:"final nasal variants",search:"(?:[ṃṅ][lśs]|nn)(?!\\S)",replace:()=>"n"},{name:"internal nasal variants",search:"[mnṅñṇ](?=[pPbBmdDtTnṭṬḍḌcCjJkKgG])",replace:()=>"ṃ"},{name:"final anusvāra variants",search:"ṃ?[mṅ](?!\\S)|n(?=\\s+[tdn])|Y(?=\\s+[jc])",replace:()=>"ṃ"},{name:"visarga aḥ before voiced consonants",search:"(?<!\\sB)(?:a[ḥr]|[o])(?=\\s+['gGjJḍḌdDnbBmrylvh])",replace:()=>"aḥ"},{name:"visarga aḥ before vowels",search:"aḥ(?=\\s+[āiīeuūoṛ])",replace:()=>"a"},{name:"visarga aḥ before unvoiced consonants and space + anusvāra",search:"o\\s+(?=[kKcCṭṬtTpPśṣsṃ])",replace:()=>"aḥ a"},{name:"visarga āḥ variants",search:"āḥ(?=\\s+[aāiīeEuUogGjḍḌdDbBnmyrlvh])",replace:()=>"ā"},{name:"other visarga variants",search:"ḥ?[rśṣs](?!\\S)",replace:()=>"ḥ"},{name:"superfluous avagrahas",search:"(\\S)'+",replace:h=>h[1]},{name:"double avagrahas",search:"''",replace:()=>"ā"},{name:"avagrahas",search:"'",replace:()=>"a"},{name:"internal visarga variants",search:"ṣ(?=[kK])|s(?=s)",replace:()=>"ḥ"},{name:"final au/āv",search:"āv(?!\\S)",replace:()=>"O"},{name:"final su",search:"(?<=[ṣs])v(?=\\s+[aāiīuūoOeE])",replace:()=>"u"},{name:"final i",search:"i(?=\\s+[aāuūoOeE])",replace:()=>"y"},{name:"kcch/kś",search:"k(\\s*)(?:ś|c?C)",replace:h=>`k${h[1]}ś`},{name:"cś/tś",search:"[tc](\\s*)S",replace:h=>`c${h[1]}C`},{name:"cch/ch",search:"([aāiīuūeEoO])C",replace:h=>`${h[1]}cC`},{name:"final t + hi",search:"d(\\s+)D(?=[iy](?:\\s|$))",replace:h=>`t${h[1]}h`},{name:"final t + voiced syllable",search:"d(?=(?:\\s+[aāiīeEuūoOgGdDbByrv]|\\s*$))",replace:()=>"t"},{name:"final t + n/m",search:"([ai])n(?=\\s+[nm])",replace:h=>`${h[1]}t`},{name:"final t + c/j",search:"j(?=\\s+j)|c(?=\\s+c)",replace:()=>"t"},{name:"i/y + vowel",search:"y(?=\\s+[aāuūeEoO])",replace:()=>"i"},{name:"bhd for bdh",search:"Bd",replace:()=>"bD"}],$n={none:{name:"remove spaces",group:"all",search:"\\s",replace:()=>""},collapse:{name:"collapse spaces",group:"all",search:"\\s+",replace:()=>" "}},Hn=function(h,w){const T=["a","ā","i","ī","u","ū","o","ō","O","e","ē","E","ṛ","ṝ","l̥","l̥̄"],z=w.join(""),C=[],k=[...z.matchAll(h.search)];let f=0,a=null;for(const o of w){const x=f+o.length;let b=o,R=0;if(a)if(a.length<=o.length)b=xn(o,0,a.length,a.text),R=a.text.length-a.length,a=null;else{b=a.text.slice(0,o.length);const F=a.text.slice(o.length);a={length:a.length-o.length,text:F};continue}for(;k.length>0&&k[0].index<x;){const $=k.shift(),F=$.index-f+R,B=h.replace($);if($.index+$[0].length<x)b=xn(b,F,$[0].length,B),R=R+B.length-$[0].length;else{const M=o.length-F+R,U=B.slice(0,M);b=b.slice(0,F)+U;const j=B.slice(M);T.includes(j)?b=b+j:a={length:$[0].length-M,text:j}}}C.push(b),f=x}return C},xn=function(h,w,T,z){return h.slice(0,w)+z+h.slice(w+T)},Vn=function(h,w=!1){let T=h.map(z=>Ie.t(z,"iast","slpish"));for(const z of[...On,$n.none]){if(w){if(z.group!=="tamil"&&z.group!=="all")continue}else if(z.group==="tamil")continue;T=Hn(z,T)}return T.map(z=>Ie.t(z,"slpish","iast"))},ot={smush:function(h,w){return h.toLowerCase().replace(/([ḍdrmvynhs]) ([aāiīuūṛeoéó])/g,"$1$2"+w).replace(/([kgcjṭḍtdpb]) h/g,"$1‌"+w+"h").replace(/([kgcjñḍtdnpbmrlyvśṣsṙ]) ([kgcjṭḍtdnpbmyrlvśṣshḻ])/g,"$1"+w+"$2").replace(/([oóeéā]) ([ṃ'])/g,"$1"+w+"$2").replace(/^ṃ/,"'‍ṃ").replace(/^ḥ/,"'‍ḥ").replace(/^_y/,"'‍y").replace(/ü/g,"‌u").replace(/ï/g,"‌i").replace(/_{1,2}(?=\s*)/g,function(T){if(T==="__")return"‍";if(T==="_")return"‌"})},iast:function(h,w){const T=w||"devanagari";return Ie.t(h,T,"iast",{skip_sgml:!0})},devanagari:function(h,w){const T=w||"",z={skip_sgml:!0},C=h.replace(/ṙ/g,"r").replace(/^_ā/,"ऽ‍ा"),k=ot.smush(C,T);return Ie.t(k,"iast","devanagari",z).replace(/¯/g,"ꣻ")},malayalam:function(h,w){const T=w||"",z={skip_sgml:!0},C={ക:"ൿ",ത:"ൽ",ന:"ൻ",മ:"ൔ",ര:"ർ"},k=h.replace(/^_ā/,"ഽ‍ാ"),f=ot.smush(k,T).replace(/e/g,"ẽ").replace(/o/g,"õ").replace(/ṙ/g,"r").replace(/ṁ/g,"ṃ").replace(/ḿ/g,"ṃ").replace(/í/g,"i").replace(/ú/g,"u").replace(/é/g,"e");return Ie.t(f,"iast","malayalam",z).replace(/(^|[^്])ര്(?=\S)/g,"$1ൎ").replace(/([കതനമര])്(?![^\s\u200C,—’―])/g,function(o,x){return C[x]})},grantha:function(h,w){const T=w||"",z={skip_sgml:!0},C=new Map([["സ",""],["ര","ർ"],["യ",""],["ച",""],["ദ",""],["ശ",""]]),k=new RegExp("(["+[...C.keys()].join("")+"])്(?![^‌ ,—’―])","g"),f=h.replace(/^_ā/,"ഽ‍ാ"),a=ot.smush(f,T).replace(/e/g,"ẽ").replace(/o/g,"õ").replace(/ṙ/g,"r").replace(/ṁ/g,"ṃ").replace(/ḿ/g,"ṃ").replace(/í/g,"i").replace(/ú/g,"u").replace(/é/g,"e");return Ie.t(a,"iast","malayalam",z).replace(/(^|[^്])ര്(?=\S)/g,"$1ൎ").replace(k,(x,b)=>C.get(b)).replace(/ക്ഷി/g,"க்ஷி")},tamil:function(h){ot.smush(h);const w=new Map([["ஂ","𑌀"],["ா","𑌾"],["ி","𑌿"],["ீ","𑍀"],["ு","𑍁"],["ூ","𑍂"],["ெ","𑍇"],["ே","𑍇"],["ை","𑍈"],["ொ","𑍋"],["ோ","𑍋"],["ௌ","𑍌"],["்","𑍍"],["ௗ","𑍗"]]),T=["𑌖","𑌗","𑌘","𑌛","𑌝","𑌠","𑌡","𑌢","𑌥","𑌦","𑌧","𑌫","𑌬","𑌭"],z=h.replace(/([kṅcñṭṇtnpmyrlvḻḷṟṉ])\s+([aāiīuūeēoō])/g,"$1$2").replace(/(^|\s)_ā/g,"$1அ‍ா").replace(/(\S)([AĀIĪUŪEĒOŌ])/g,"$1‌$2").replace(/(\S)·/g,"$1‌").toLowerCase(),C=new RegExp(`([${T.join("")}])([${[...w.keys()].join("")}])`,"g");return Ie.t(z,"iast","tamil").replace(C,function(f,a,o){return a+w.get(o)})},telugu:function(h,w){var T=w||"";const z={skip_sgml:!0},C=h.replace(/^_ā/,"ఽ‍ా"),k=ot.smush(C,T).replace(/e/g,"ẽ").replace(/o/g,"õ").replace(/ṙ/g,"r‍").replace(/ṁ/g,"ṃ").replace(/ḿ/g,"ṃ").replace(/í/g,"i").replace(/ú/g,"u").replace(/é/g,"e");return Ie.t(k,"iast","telugu",z)}},Yt=function(h,w,T=!1,z="sa"){const C=ot[w],k=h.cloneNode(!0),f=function(a,o){let x=a.childNodes;for(let b of x)if(b.nodeType!==8){if(b.nodeType===3){if(o!=="sa")continue;b.data=C(b.data,T)}else if(b.hasChildNodes()){let R=b.getAttribute("lang")||o;R==="sa"&&b.classList.contains("subst")&&Gn(b,w),f(b,R)}}};return f(k,z),k},vn=function(h,w=!1){if(h.nodeType===3)return h;const T=document.createTreeWalker(h,NodeFilter.SHOW_TEXT,null,!1);if(w){let z;for(;T.nextNode();)z=T.currentNode;return z}else return T.nextNode},Gn=function(h,w){if(h.firstChild.nodeType!==3&&h.lastChild.nodeType!==3)return;const T=h.childNodes,z=/^[aāiīuūeoṛṝḷṃḥ]/,C=/[kgṅcjñṭḍṇtdnpbmyrlvṣśsh]$/,k=["ā","i","ī","e","o","_","ai","au"],f=["h","k","ś","y","g","gh","c","ch","jh","ṭh","ḍ","ḍh","t","th","d","dh","n","p","ph","bh","m","r","ḻ","v","ṣ","s"];var a=!1,o=[],x=[];const b=T[0].nodeType===3;for(let R of T){if(R.nodeType>3)continue;const $=R.textContent.trim();if($!==""){if($==="a"){R.textContent="";continue}if($.match(C)){const F=vn(R,!0);F.textContent=F.textContent.replace(/\s+$/,"")+"a",w==="telugu"&&f.indexOf($)>=0&&o.push(R)}if(R===h.lastChild&&R.nodeType===3){const F=document.createElement("span");F.appendChild(R.cloneNode(!1)),h.replaceChild(F,R),R=F,R.classList.add("aalt")}else b&&$.match(z)&&R.classList.add("aalt");switch(w){case"devanagari":($==="i"||$==="é")&&x.unshift(R);break;case"grantha":case"malayalam":if($==="e"||$==="ai")x.unshift(R);else if($==="o"){const F=R.cloneNode(!0);yn("o","e",F),x.unshift(F),yn("o","ā",R)}break;case"telugu":!a&&k.indexOf($)>=0&&(a=!0);break}}}for(const R of x)h.insertBefore(R,h.firstChild);if(a)for(const R of o){const $=vn(R,!0);$.textContent=$.textContent+"‍్"}},yn=function(h,w,T){const z=document.createTreeWalker(T,NodeFilter.SHOW_TEXT,null,!1);for(;z.nextNode();)z.currentNode.textContent.match(h)&&(z.currentNode.textContent=w)},Un=`<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
        xmlns:x="http://www.tei-c.org/ns/1.0"
        exclude-result-prefixes="x">
<xsl:output method="text" omit-xml-declaration="yes"/>
    <xsl:strip-space elements="*"/>
    <xsl:template match="/">
        <xsl:apply-templates/>
    </xsl:template>
    <xsl:template match="para[content-style][not(text())]">
        <xsl:value-of select="normalize-space(.)"/>
    </xsl:template>

    <xsl:template match="x:teiHeader"/>

    <xsl:template match="x:teiCorpus">
        <xsl:apply-templates/>
    </xsl:template>
    <xsl:template match="x:TEI">
        <xsl:value-of select="@n"/><xsl:text>,</xsl:text>
        <xsl:apply-templates/>
        <xsl:text>&#xa;</xsl:text>
    </xsl:template>
    <xsl:template match="x:text">
        <xsl:apply-templates/>
    </xsl:template>
    <xsl:template match="x:w">
        <xsl:text>"</xsl:text><xsl:apply-templates/><xsl:text>"</xsl:text>
        <!--xsl:if test="not(position() = last())"-->
            <xsl:text>,</xsl:text>
        <!--/xsl:if-->
    </xsl:template>
    <!--xsl:template match="node()|@*">
        <xsl:copy>
            <xsl:apply-templates select="node()|@*"/>
        </xsl:copy>
    </xsl:template-->
</xsl:stylesheet>
`,Xn=`<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
        xmlns:x="http://www.tei-c.org/ns/1.0"
        exclude-result-prefixes="x">
    <xsl:output indent="yes"/>
    <xsl:template match="x:span">
        <xsl:apply-templates/>
    </xsl:template>
    <xsl:template match="para[content-style][not(text())]">
        <xsl:value-of select="normalize-space(.)"/>
    </xsl:template>
    <xsl:template match="x:teiHeader">
        <xsl:text>&#10;&#32;&#32;&#32;&#32;</xsl:text>
            <xsl:copy><xsl:apply-templates select="node()|@*"/></xsl:copy>
    </xsl:template>
    <xsl:template match="x:xenoData">
        <xsl:text>&#10;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;</xsl:text>
            <xsl:copy><xsl:apply-templates select="node()|@*"/></xsl:copy>
        <xsl:text>&#10;&#32;&#32;&#32;&#32;</xsl:text>
    </xsl:template>
    <xsl:template match="x:TEI">
        <xsl:text>&#10;&#32;&#32;&#32;&#32;</xsl:text>
            <xsl:copy><xsl:apply-templates select="node()|@*"/></xsl:copy>
    </xsl:template>
    <xsl:template match="x:text">
        <xsl:text>&#10;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;</xsl:text>
            <xsl:copy><xsl:apply-templates select="node()|@*"/></xsl:copy>
        <xsl:text>&#10;&#32;&#32;&#32;&#32;</xsl:text>
    </xsl:template>
    <xsl:template match="x:w">
        <xsl:copy><xsl:apply-templates select="node()|@*"/></xsl:copy>
        <!--xsl:if test="not(position() = last())">
            <xsl:text>&#32;</xsl:text>
        </xsl:if-->
    </xsl:template>
    <xsl:template match="node()|@*">
        <xsl:copy>
            <xsl:apply-templates select="node()|@*"/>
        </xsl:copy>
    </xsl:template>
</xsl:stylesheet>
`,Wn=`<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform" 
                xmlns:x="http://www.tei-c.org/ns/1.0"
                exclude-result-prefixes="x">
<xsl:output method="html"/>

<xsl:strip-space elements="x:cl"/>

<xsl:template match="x:teiHeader"/>

<xsl:template match="x:teiCorpus">
    <xsl:element name="table">
        <xsl:apply-templates/>
    </xsl:element>
</xsl:template>
<xsl:template match="x:TEI">
    <xsl:apply-templates/>
</xsl:template>
<xsl:template match="x:text">
    <xsl:element name="tr">
        <xsl:attribute name="data-n"><xsl:value-of select="../@n"/></xsl:attribute>
        <xsl:if test="../@corresp">
            <xsl:attribute name="data-treename"><xsl:value-of select="../@corresp"/></xsl:attribute>
            <xsl:attribute name="data-nodename"><xsl:value-of select="../@select"/></xsl:attribute>
        </xsl:if>
        <xsl:element name="th">
            <xsl:attribute name="scope">row</xsl:attribute>
            <xsl:attribute name="draggable">true</xsl:attribute>
            <xsl:value-of select="../@n"/>
        </xsl:element>
        <xsl:apply-templates/>
    </xsl:element>
</xsl:template>
<xsl:template match="x:w">
    <xsl:element name="td">
        <xsl:choose>
            <xsl:when test="parent::x:cl">
                <xsl:choose>
                    <xsl:when test="position() = '1'">
                        <xsl:attribute name="class">lemma group-start</xsl:attribute>
                    </xsl:when>
                    <xsl:when test="position() = last()">
                        <xsl:attribute name="class">lemma group-end</xsl:attribute>
                    </xsl:when>
                    <xsl:otherwise>
                        <xsl:attribute name="class">lemma group-internal</xsl:attribute>
                    </xsl:otherwise>
                </xsl:choose>
            </xsl:when>
            <xsl:otherwise>
                <xsl:attribute name="class">lemma</xsl:attribute>
            </xsl:otherwise>
        </xsl:choose>
        <xsl:if test="@lemma">
            <xsl:attribute name="data-normal"><xsl:value-of select="@lemma"/></xsl:attribute>
        </xsl:if>
        <xsl:if test="@emended">
            <xsl:attribute name="data-emended">true</xsl:attribute>
        </xsl:if>
        <xsl:attribute name="data-n">
            <xsl:value-of select="@n"/>
        </xsl:attribute>
        <xsl:if test="@insignificant='true'">
            <xsl:attribute name="data-insignificant">true</xsl:attribute>
        </xsl:if>
        <xsl:if test="@binary='true'">
            <xsl:attribute name="data-binary">true</xsl:attribute>
        </xsl:if>
        <xsl:apply-templates/>
    </xsl:element>
</xsl:template>
</xsl:stylesheet>
`,jn=`<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform" 
                xmlns:x="http://www.w3.org/1999/xhtml"
                exclude-result-prefixes="x">
<xsl:output method="html" omit-xml-declaration="yes"/>

<xsl:template match="x:pb">
    <xsl:element name="hr">
        <xsl:attribute name="data-n"><xsl:value-of select="@n"/></xsl:attribute>
    </xsl:element>
    <xsl:element name="img">
        <xsl:attribute name="class">editbutton</xsl:attribute>
        <xsl:attribute name="data-n"><xsl:value-of select="@n"/></xsl:attribute>
        <xsl:attribute name="src">edit_icon.svg</xsl:attribute>
    </xsl:element>
    <h3 class="pb" lang="en"><xsl:value-of select="@n"/></h3>
</xsl:template>

<xsl:template match="x:lb">
<br />
<span class="lb" lang="en"><xsl:value-of select="@n"/></span>
</xsl:template>

<xsl:template match="x:fw">
<div class="fw">(<i lang="en"><xsl:value-of select="@type"/>, <xsl:value-of select="@place"/></i>): <xsl:apply-templates/></div>
</xsl:template>

<xsl:template match="x:div[@type='story']">
    <span class="story" lang="en">(story no. <xsl:value-of select="@num"/>, <xsl:value-of select="@city"/>, <xsl:value-of select="@king"/>)</span>
    <xsl:apply-templates/>
</xsl:template>

<xsl:template match="x:div[@type='verse']">
    <span class="verse"><xsl:apply-templates /></span>
</xsl:template>

<xsl:template match="x:del">
    <xsl:variable name="rend" select="@rend"/>
    <xsl:element name="del">
        <xsl:attribute name="data-title">
            <xsl:text>deleted</xsl:text>
            <xsl:if test="string($rend)">
                <xsl:text> (</xsl:text>
                <xsl:value-of select="$rend"/>
                <xsl:text>)</xsl:text>
           </xsl:if>
        </xsl:attribute>
        <xsl:apply-templates/>
    </xsl:element>
</xsl:template>

<xsl:template match="x:add">
    <xsl:variable name="place" select="@place"/>
    <xsl:variable name="rend" select="@rend"/>
    <xsl:element name="ins">
        <xsl:attribute name="data-title">
            <xsl:text>added</xsl:text>
            <xsl:if test="string($rend) or string($place)">
                <xsl:text> (</xsl:text>
                <xsl:value-of select="$rend"/>
                <xsl:if test="string($rend) and string($place)">
                    <xsl:text>, </xsl:text>
                </xsl:if>
                <xsl:value-of select="$place"/>
                <xsl:text>)</xsl:text>
            </xsl:if>
        </xsl:attribute>
        <xsl:apply-templates/>
    </xsl:element>
</xsl:template>

<xsl:template match="x:subst">
    <span class="subst"><xsl:apply-templates /></span>
</xsl:template>

<xsl:template match="x:g">
    <xsl:element name="span">
        <xsl:attribute name="data-title"><xsl:value-of select="@rend"/></xsl:attribute>
        <xsl:attribute name="class">gaiji</xsl:attribute>
        <xsl:apply-templates/>
    </xsl:element>
</xsl:template>

<xsl:template match="x:lg">
  <xsl:element name="span">
    <xsl:attribute name="class">tree-verse</xsl:attribute>
    <xsl:attribute name="lang">en</xsl:attribute>
    <xsl:text>[verse </xsl:text>
    <xsl:value-of select="@n"/>
    <xsl:text>]</xsl:text>
  </xsl:element>
</xsl:template>

<xsl:template match="x:l">
  <xsl:element name="span">
    <xsl:attribute name="class">l</xsl:attribute>
    <xsl:apply-templates/>
  </xsl:element>
</xsl:template>
</xsl:stylesheet>
`,Yn=`<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform" 
                xmlns:x="http://www.tei-c.org/ns/1.0"
                exclude-result-prefixes="x">
<xsl:output method="html"/>
<xsl:template match="x:w">
    <xsl:element name="span">
        <xsl:attribute name="data-n"><xsl:value-of select="@n"/></xsl:attribute>
        <xsl:if test="@lemma">
            <xsl:attribute name="data-normal"><xsl:value-of select="@lemma"/></xsl:attribute>
        </xsl:if>
        <xsl:if test="@emended">
            <xsl:attribute name="data-emended"><xsl:value-of select="@emended"/></xsl:attribute>
        </xsl:if>
       <xsl:choose>
           <xsl:when test="not(normalize-space(.))">
                <xsl:attribute name="class">lemma invisible</xsl:attribute>
                <xsl:text>&#x00A0;</xsl:text>
            </xsl:when>
            <xsl:otherwise>
                <xsl:attribute name="class">lemma</xsl:attribute>
            </xsl:otherwise>
        </xsl:choose>
        <xsl:apply-templates/>
    </xsl:element>
    <xsl:text>&#173;</xsl:text>
</xsl:template>
<xsl:template match="x:cl">
    <xsl:element name="span">
        <xsl:attribute name="class">group</xsl:attribute>
        <xsl:apply-templates/>
    </xsl:element>
</xsl:template>
<xsl:template match="x:pb">
    <xsl:element name="hr">
        <xsl:attribute name="data-n"><xsl:value-of select="@n"/></xsl:attribute>
    </xsl:element>
    <xsl:element name="img">
        <xsl:attribute name="class">editbutton</xsl:attribute>
        <xsl:attribute name="data-n"><xsl:value-of select="@n"/></xsl:attribute>
        <xsl:attribute name="src">edit_icon.svg</xsl:attribute>
    </xsl:element>
    <h3 class="pb" lang="en"><xsl:value-of select="@n"/></h3>
</xsl:template>

<xsl:template match="x:lb">
<br />
<span class="lb" lang="en"><xsl:value-of select="@n"/></span>
</xsl:template>

<xsl:template match="x:fw">
<div class="fw">(<i lang="en"><xsl:value-of select="@type"/>, <xsl:value-of select="@place"/></i>): <xsl:apply-templates/></div>
</xsl:template>

<xsl:template match="x:div[@type='story']">
    <span class="story" lang="en">(story no. <xsl:value-of select="@num"/>, <xsl:value-of select="@city"/>, <xsl:value-of select="@king"/>)</span>
    <xsl:apply-templates/>
</xsl:template>

<xsl:template match="x:div[@type='verse']">
    <span class="verse"><xsl:apply-templates /></span>
</xsl:template>

<xsl:template match="x:del">
    <xsl:variable name="rend" select="@rend"/>
    <xsl:element name="del">
        <xsl:attribute name="data-title">
            <xsl:text>deleted</xsl:text>
            <xsl:if test="string($rend)">
                <xsl:text> (</xsl:text>
                <xsl:value-of select="$rend"/>
                <xsl:text>)</xsl:text>
           </xsl:if>
        </xsl:attribute>
        <xsl:apply-templates/>
    </xsl:element>
</xsl:template>

<xsl:template match="x:add">
    <xsl:variable name="place" select="@place"/>
    <xsl:variable name="rend" select="@rend"/>
    <xsl:element name="ins">
        <xsl:attribute name="data-title">
            <xsl:text>added</xsl:text>
            <xsl:if test="string($rend) or string($place)">
                <xsl:text> (</xsl:text>
                <xsl:value-of select="$rend"/>
                <xsl:if test="string($rend) and string($place)">
                    <xsl:text>, </xsl:text>
                </xsl:if>
                <xsl:value-of select="$place"/>
                <xsl:text>)</xsl:text>
            </xsl:if>
        </xsl:attribute>
        <xsl:apply-templates/>
    </xsl:element>
</xsl:template>

<xsl:template match="x:subst">
    <span class="subst"><xsl:apply-templates /></span>
</xsl:template>

<xsl:template match="x:g">
    <xsl:element name="span">
        <xsl:attribute name="data-title"><xsl:value-of select="@rend"/></xsl:attribute>
        <xsl:attribute name="class">gaiji</xsl:attribute>
        <xsl:apply-templates/>
    </xsl:element>
</xsl:template>

<xsl:template match="x:lg">
  <xsl:element name="span">
    <xsl:attribute name="class">lg</xsl:attribute>
    <xsl:apply-templates/>
  </xsl:element>
</xsl:template>

<xsl:template match="x:l">
  <xsl:element name="span">
    <xsl:attribute name="class">l</xsl:attribute>
    <xsl:apply-templates/>
  </xsl:element>
</xsl:template>
</xsl:stylesheet>
`,Kn=`<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform" 
                xmlns:x="http://www.w3.org/1999/xhtml"
                exclude-result-prefixes="x">
<xsl:output method="text" omit-xml-declaration="yes"/>
<xsl:template match="x:lg">
<xsl:value-of select="@n"/>
</xsl:template>
</xsl:stylesheet>
`,Ct=function(h){const T=new DOMParser().parseFromString(h,"text/xml"),z=new XSLTProcessor;return z.importStylesheet(T),z},Jn=function(h){this.transformString=function(w,T){const z=h.xml.createElementNS(h.teins,"ab");return z.innerHTML=w,T.transformToFragment(z,document)},this.sheets={csv:Ct(Un),xml:Ct(Xn),matrix:Ct(Wn),lemma:Ct(Yn),lg:Ct(Kn),tree:Ct(jn)}},Qn=function(h){const w={curxml(){return h.xml},teins(){return h.teins},basename(){return h.filename.split(/\.[^.]+$/)[0]},range(C,k){return Array.from(Array(parseInt(k)-parseInt(C)+1).keys(),f=>f+C)},maxlemma(){return[...w.firsttext().querySelectorAll("w[n]")].length-1},lemmata(C,k){const f=k||document.querySelector("#views");return C===!1?f.querySelectorAll(".lemma"):f.querySelectorAll(`.lemma[data-n="${C}"]`)},tds(C,k){const f=k||h.matrix.boxdiv;return C===!1?f.querySelectorAll("td[data-n]"):f.querySelectorAll(`td[data-n="${C}"]`)},firsttd(C,k){return(k||h.matrix.boxdiv).querySelector(`td[data-n="${C}"]`)},tr(C){return h.matrix.boxdiv.querySelector(`tr[data-n="${C}"]`)},trs(C){return(C||h.matrix.boxdiv).querySelectorAll("tr[data-n]")},firsttr(C){return(C||h.matrix.boxdiv).querySelector("tr[data-n]")},lasttr(C){return(C||h.matrix.boxdiv).querySelector("tr[data-n]:last-of-type")},trWalker(C){return document.createNodeIterator(C,NodeFilter.SHOW_ELEMENT,{acceptNode:function(k){if(k.tagName==="TD")return NodeFilter.FILTER_ACCEPT}},!1)},textWalker(C){return document.createNodeIterator(C,NodeFilter.SHOW_ELEMENT,{acceptNode:function(k){if(k.tagName.toLowerCase()==="w")return NodeFilter.FILTER_ACCEPT}},!1)},tei(C,k=h.xml){return k.querySelector(`TEI[n="${C}"]`)},teis(C=h.xml){return C.querySelectorAll("TEI")},texts(C){return(C||h.xml).querySelectorAll("text")},serializedtexts(C,k){const f=[...C.querySelectorAll("otu[label]")].map(o=>o.getAttribute("label"));return[...w.teis()].filter(o=>f.indexOf(o.getAttribute("n"))!==-1).map(o=>[C.querySelector(`node[label="${o.getAttribute("n")}"]`).getAttribute("id"),[...o.querySelectorAll("w")].map(x=>k&&x.hasAttribute("lemma")?x.getAttribute("lemma"):x.textContent)])},serializedlevels(C){return C.map(k=>{if(k instanceof Map){const f=new Map;for(const[a,o]of k)f.set(a.getAttribute("id"),o.map(x=>x.getAttribute("id")));return f}else return k.map(f=>f.getAttribute("id"))})},firsttext(C){return C?h.xml.querySelector(`[n="${C}"] text`):h.xml.querySelector("text")},words(C,k){const f=k||h.xml;return C===!1?f.querySelectorAll("w[n]"):f.querySelectorAll(`w[n="${C}"]`)},firstword(C,k){return(k||h.xml).querySelector(`w[n="${C}"]`)},normal(C){return(C||document.getElementById("views")).querySelectorAll(".lemma[data-normal], .tree-lemma[data-normal]")},htmlreading(C,k){return k&&C.dataset.normal?C.dataset.normal:C.IAST.textContent},ths(){return h.matrix.boxdiv.querySelectorAll("th[data-ref]")},firstth(C){return h.matrix.boxdiv.querySelector(`th[data-ref="${C}"]`)},checkbox(C,k){return h.matrix.boxdiv.querySelector(`th[data-ref="${C}"] input.${k}`)},highlit(){const k=w.firsttr().querySelectorAll(".highlit"),f=new Set;for(const a of k)f.add(a.dataset.n);return f},highlitcell(){return h.matrix.boxdiv.querySelector("td.highlitcell")},highlitrow(){const C=w.highlitcell();return C?C.closest("tr"):!1},lowhigh(C){const k=[...C].sort((o,x)=>parseInt(o)-parseInt(x)),f=parseInt(k[0]),a=k.length>1?parseInt(k[k.length-1]):void 0;return[f,a]},readings(C,k){const f=k||h.matrix.boxdiv,a=w.tds(C,f);var o=0;const x=new Set;for(const b of a){const R=b.textContent;R!==""&&(o++,x.add(R))}return[o,x.size]},attr(C,k){const f=w.firsttr();var a=[];for(const o of k)w.firsttd(o,f).dataset[C]==="true"?a.push([o,!0]):a.push([o,!1]);return new Map(a)},whichattr(C){return C.hasAttribute("n")?"n":C.hasAttribute("data-n")?"data-n":C.hasAttribute("data-ref")?"data-ref":!1},clauses(C,k=!1){const f=w.firsttext();var a=!1;const o=new Set;for(const b of C){const $=w.firstword(b,f).closest("cl");$?o.add($):k&&(a=!0)}if(o.size===0)return!1;const x=[...o].map(b=>{const R=b.querySelectorAll("w");return new Set([...R].map($=>$.getAttribute("n")))});return a?[null].concat(x):x},clausesToRemove(C,k,f=0){const a=new Set;for(const o of C){const x=new Set(o);for(const b of k)x.delete(b);x.size<=f&&a.add(o)}return[...a]},empty(){const C=new Set,k=[...w.trs()],f=k.map(x=>w.trWalker(x)),a=k[0].querySelector("td:last-of-type").dataset.n;for(let x=0;x<=a;x++){var o=!0;for(const b of f){const R=b.nextNode();o&&R.textContent!==""&&(o=!1)}o&&C.add(x)}return C},emptyRows(C=!1){const k=w.trs(),f=new Set;for(let a=0;a<k.length;a++){const o=w.tds(!1,k[a]);(()=>{for(const b of o)if(b.textContent!=="")return!1;return!0})()&&(C?f.add(k[a].dataset.n):f.add(a))}return f},prevNonempty(C,k){for(let f=C;f>=0;f--)if(k[f].textContent!=="")return f;return!1},nextNonempty(C,k){for(let f=C;f<k.length;f++)if(k[f].textContent!=="")return f;return!1},cursorPos(C){const k=window.getSelection().getRangeAt(0),f=k.cloneRange();f.selectNodeContents(C);const a=f.toString().length;return f.setEnd(k.endContainer,k.endOffset),[f.toString().length,a]},selection(){const C=window.getSelection();if(C.isCollapsed)return!1;const k=C.rangeCount>1?C.getRangeAt(1).cloneContents():C.getRangeAt(0).cloneContents();if(!k)return!1;const f=new Set,a=k.querySelectorAll(".lemma");for(const o of a)f.add(o.dataset.n);return f}},T={undo(){return h.undo.length>0},redo(){return h.redo.length>0},checkbox(C,k=null){if(!T.anyhighlit())return!1;const f=k===null?w.highlit():k,a=w.attr(C,f);for(const o of a.values())if(o===!1)return!1;return!0},grouped(){const C=w.highlit();if(!C)return!1;const k=w.firsttr();for(const f of C){const a=w.firsttd(f,k);if(a.classList.contains("group-start")||a.classList.contains("group-internal")||a.classList.contains("group-end"))return!0}return!1},oneGrouped(){const C=w.highlit();if(C.size===0)return!1;if(C.size===1){const k=w.firsttr(),f=w.firsttd([...C][0],k);return!!(f.classList.contains("group-start")||f.classList.contains("group-end")||f.classList.contains("group-internal"))}return!0},anyhighlit(){return!!h.matrix.boxdiv.querySelector("td.highlit")},manyhighlit(){return w.highlit().size>1},highlitcell(){return!!h.matrix.boxdiv.querySelector("td.highlitcell")},normalizedView(){return document.getElementById("views").classList.contains("normalized")},anyNormalized(){return h.matrix.boxdiv.querySelector(".lemma[data-normal]")},headerView(){return h.matrix.boxdiv.querySelector("tr.header").style.display!=="none"}},z={tei:function(C){const k=h.xml.createElementNS(h.teins,"TEI");k.setAttribute("n",C);const f=w.firsttext().cloneNode(!0);k.appendChild(f);for(const a of w.words(!1,f))for(a.removeAttribute("lemma");a.firstChild;)a.firstChild.remove();return k},xmlel:function(C,k=h.xml){return k.createElementNS(h.teins,C)},emptycell:function(C){const k=document.createElement("td");return k.className="lemma",k.dataset.n=C,k},emptyword:function(C,k=h.xml){const f=k.createElementNS(h.teins,"w");return f.setAttribute("n",C),f},emptywords:function(C,k,f){const a=k||h.maxlemma,o=f||0;for(let x=o;x<=a;x++){const b=z.emptyword(x);C.appendChild(b)}},row:function(C,k){const f=document.createElement("tr"),a=document.createElement("th");a.scope="row",a.draggable=!0,a.appendChild(document.createTextNode(C)),f.dataset.n=C,f.appendChild(a);const o=w.firsttr();for(const x of o.querySelectorAll("td")){const b=document.createElement("td");b.dataset.n=x.dataset.n,b.className=x.className,k&&b.classList.add(k),f.appendChild(b)}return f},blackout(C,k){const f=document.createElement("div");f.id="blackout",f.appendChild(C),document.body.appendChild(f);const a=function(b){k(b),f.parentNode.removeChild(f)},o=function(b){if(!b.target.closest(".popup")){const $=document.querySelector("#blackout");$.parentNode.removeChild($)}};f.querySelector("button").addEventListener("click",a),f.addEventListener("click",o)}};return{find:w,check:T,make:z}},Zn=function(h,w){const T={Intersection:function(...a){const o=a[0];return new Set([...o].filter(x=>{for(let b=1;b<a.length;b++)if(!a[b].has(x))return!1;return!0}))},Union:function(...a){return new Set(a.reduce((o,x)=>(o=[...o,...x],o),[]))}},z=function(a){const o=new Map;for(const x of w[0]){const b=h.get(x),R=b!==void 0?[b]:[];o.set(x,new Set(R))}for(let x=1;x<w.length;x++)for(const[b,R]of w[x]){const $=R.map(M=>o.get(M)),F=T.Intersection(...$);if(a&&b===a&&F.size===1)return[...F][0];const B=F.size>0?F:T.Union(...$);o.set(b,B)}return o},C=function(a,o){const x=w[0],b=new Map;for(const R of w[w.length-1])b.set(R[0],a.get(R[0]));for(let R=w.length-1;R>1;R--)for(const[$,F]of w[R]){const B=b.get($);for(const M of F){if(x.indexOf(M)!==-1)continue;const U=a.get(M),j=(()=>{if(U.size===1)return U;const X=T.Intersection(B,U);return X.size>0?X:U})();if(o&&M===o)return j;b.set(M,j)}}return o?b.get(o):b},k=function(a=null){const o=z(a);if(typeof o=="string")return o;const x=C(o,a);return a?f(x):new Map(Array.from(x,([b,R])=>[b,f(R,!0)]))},f=function(a,o=!1){if(!o&&a.size===1)return[...a][0].trim();const x=[...a].map(b=>b.trim()===""?"_":b);return x.length===1?x[0]:"{"+x.join(", ")+"}"};return{run:k}},er=function(h,w){const T=h.find,z=h.make,C=T.teins(),k={write:async function(f,a){const o=await a.createWritable();o.write(f),o.close()},xml:async function(f){const a=new XMLSerializer().serializeToString(w.sheets.xml.transformToDocument(f)),o=new Blob([a],{type:"text/xml;charset=utf-8"}),x=T.basename()+".xml",b=await jt({_preferPolyfill:!1,suggestedName:x,types:[{description:"TEI XML",accept:{"text/xml":[".xml"]}}]});k.write(o,b)},csv:async function(f){const a=w.sheets.csv.transformToDocument(f).documentElement.textContent,o=new Blob([a],{type:"text/csv;charset=utf-8"}),x=T.basename()+".csv",b=await jt({_preferPolyfill:!1,suggestedName:x,types:[{description:"CSV file",accept:{"text/csv":[".csv"]}}]});k.write(o,b)},nexus:async function(f){const a=[...T.texts(f)],o=a.length,x="0 1 2 3 4 5 6 7 8 9 A B C D E F G H K L M N P Q R S T U V W X Y Z a b c d e f g h k l m n p q r s t u v w x y z",[b,...R]=x.split(" "),$="-",F=a.map(J=>"'"+J.parentElement.getAttribute("n")+"'"),B=a.map(J=>T.textWalker(J)),M=a[0].querySelectorAll("w").length,U=[],j=F.map(J=>[J+" "]);for(let J=0;J<M;J++){const Y=new Set,I=[];for(let ne=0;ne<B.length;ne++){const xe=B[ne].nextNode(),K=Ie.t(xe.textContent.trim().toLowerCase(),"iast","hk").replace(/'/g,"()");I.push(K),K!==""&&K!=="[]"&&Y.add(K)}U.push(["[]",...Y]);const ue=new Map([...Y].map((ne,ge)=>[ne,R[ge]]));for(let ne=0;ne<I.length;ne++){const ge=(xe=>{switch(I[xe]){case"":return $;case"[]":return b;default:return ue.get(I[xe])}})(ne);j[ne].push(ge)}}const X=U.map((J,Y)=>Y+1+" / "+[...J].map(I=>`'${I}'`).join(" ")).join(`,
`),G=j.map(J=>J.join("")).map(J=>J.replace(/0{8,}/g,Y=>Y.replace(/0/g,"-"))).reduce((J,Y)=>J+`
`+Y),ae=`#NEXUS

BEGIN TAXA;
  DIMENSIONS NTAX=${o};
  TAXLABELS ${F.join(" ")};
END;

BEGIN CHARACTERS;
  DIMENSIONS
    NCHAR=${M};
  FORMAT 
    DATATYPE=STANDARD 
    RESPECTCASE 
    GAP=${$} 
    MISSING=? 
    SYMBOLS="${x}";
  CHARSTATELABELS
${X}
;
MATRIX
${G}
;
END;
`,fe=new Blob([ae],{type:"text/nexus;charset=iso8859-1"}),ve=T.basename()+".nex",O=await jt({_preferPolyfill:!1,suggestedName:ve,types:[{description:"NEXUS file",accept:{"text/nexus":[".nex"]}}]});k.write(fe,O)},processOptions:function(f){const a=T.curxml().cloneNode(!0);if(f.get("option_normalize")){const o=a.querySelectorAll("w[lemma]");for(const x of o)x.textContent=x.getAttribute("lemma")}if(f.get("option_mergegroups")){const o=a.querySelectorAll("cl");for(const x of o){const b=x.removeChild(x.firstChild);for(;x.firstChild;){const R=b.getAttribute("lemma")||b.textContent,$=x.firstChild.getAttribute("lemma")||x.firstChild.textContent;for(b.setAttribute("lemma",R+$);x.firstChild.firstChild;)b.appendChild(x.firstChild.firstChild);x.firstChild.remove()}b.getAttribute("lemma")===b.textContent&&b.removeAttribute("lemma"),x.parentNode.insertBefore(b,x),x.parentNode.removeChild(x)}}if(f.get("option_insignificant")){const o=a.querySelectorAll('w[insignificant="true"]');for(const x of o)x.parentNode.removeChild(x)}if(f.get("option_binary")){const x=[...T.firsttext().querySelectorAll('w[binary="true"]')].map(b=>b.getAttribute("n"));for(const b of x){const R=a.querySelectorAll(`w[n="${b}"]:not(:empty)`);if(R.length===0)continue;const $=`[${R[0].textContent}]`;for(const F of R)F.textContent=$}}if(f.get("option_noempty")){const o=a.querySelectorAll("w:empty");for(const x of o)x.textContent="[]"}return f.get("option_basetext")?k.makeApp(f,a):a},makeHeader(f,a){const o=f.createElementNS(C,"teiHeader"),x=f.createElementNS(C,"fileDesc"),b=f.createElementNS(C,"sourceDesc"),R=f.createElementNS(C,"msDesc"),$=f.createElementNS(C,"msIdentifier"),F=f.createElementNS(C,"abbr");F.setAttribute("type","siglum"),F.append(f.documentElement.getAttribute("n")),$.appendChild(F),R.appendChild($),b.appendChild(R);const B=a.querySelector("listWit");if(B)b.appendChild(B);else{const M=f.createElementNS(C,"listWit");for(const U of T.teis(a)){const j=U.getAttribute("n"),X=f.createElementNS(C,"witness");X.setAttribute("xml:id",j);const G=f.createElementNS(C,"abbr");G.setAttribute("type","siglum"),G.append(j),X.appendChild(G),M.appendChild(X)}b.appendChild(M)}return x.appendChild(b),o.appendChild(x),o},makeApp(f,a){const o=f.get("option_basetext"),x=T.tei(o,a),b=f.get("option_app_normalize"),R=document.implementation.createDocument(C,"",null);R.appendChild(x);const $=R.createElementNS(C,"body"),F=R.createElementNS(C,"p"),B=x.querySelector("text");for(;B.firstChild;)F.appendChild(B.firstChild);$.appendChild(F),B.appendChild($);const M=k.makeHeader(R,a);x.insertBefore(M,x.firstChild),R.documentElement.getAttribute("n");const U=T.words(!1,x);for(const j of U){const X=j.getAttribute("n"),G=b&&j.getAttribute("lemma")||j.textContent,ae=new Set,fe=new Map,ve=T.words(X,a);for(const O of ve){const J=O.closest("TEI").getAttribute("n");if(b&&O.getAttribute("lemma")===G)ae.add(J);else if(O.textContent===G)ae.add(J);else{const Y=O.textContent===""?"[om.]":O.textContent,I=fe.get(Y)||[];I.push(J),fe.set(Y,I)}}if(fe.size===0)for(;j.firstChild;)j.parentElement.insertBefore(j.firstChild,j);else{const O=R.createElementNS(C,"app"),J=R.createElementNS(C,"lem"),Y=[...ae].map(I=>`#${I}`).join(" ");for(Y!==""&&J.setAttribute("wit",Y);j.firstChild;)J.appendChild(j.firstChild);O.appendChild(J);for(const[I,ue]of fe){const ne=R.createElementNS(C,"rdg"),ge=ue.map(xe=>`#${xe}`).join(" ");ne.setAttribute("wit",ge),ne.append(I),O.appendChild(ne)}j.parentElement.insertBefore(O,j),J.textContent.match(/\s$/)&&(j.parentElement.insertBefore(R.createTextNode(" "),j),J.textContent=J.textContent.trimEnd())}j.remove()}return R},options(){return document.createRange().createContextualFragment(`<div id="exportoptions" class="popup">
    <form id="exportform">
      <div style="font-weight: bold">Export</div>
      <div>
        <input type="checkbox" id="option_insignificant" name="option_insignificant"><label for="option_insignificant">Remove insignifiant lemmata</label>
      </div>
      <div>
        <input type="checkbox" id="option_binary" name="option_binary"><label for="option_binary">Binarize marked lemmata</label>
      </div>
      <div>
        <input type="checkbox" id="option_noempty" name="option_noempty"><label for="option_noempty">Gaps are significant</label>
      </div>
      <div>
        <input type="checkbox" id="option_mergegroups" name="option_mergegroups"><label for="option_mergegroups">Merge groups</label>
      </div>
      <div>
        <input type="checkbox" id="option_normalize" name="option_normalize"><label for="option_normalize">Normalize spellings</label>
      </div>
      <div>
        <button type="submit">Export</button>
      </div>
    </form>
</div>`)},appOptions(){const f=document.createRange().createContextualFragment(`<div id="exportoptions" class="popup">
    <form id="exportform">
      <div style="font-weight: bold">Export</div>
      <div>
        <label for="option__basetext">Base text</label>
        <select id="option__basetext" name="option_basetext"></select>
      </div>
      <div>
        <input type="checkbox" id="option__app_insignificant" name="option_app_insignificant"><label for="option_app_insignificant">Ignore insignifiant lemmata</label>
      </div>
      <div>
        <input type="checkbox" id="option_mergegroups" name="option_mergegroups" checked><label for="option_mergegroups">Merge groups</label>
      </div>
      <div>
        <input type="checkbox" id="option_app_normalize" name="option_app_normalize" checked><label for="option_app_normalize">Normalized spellings in positive apparatus</label>
      </div>
      <div>
        <input type="checkbox" id="option_normalize" name="option_normalize"><label for="option_normalize">Normalize spellings in negative apparatus</label>
      </div>
      <div>
        <button type="submit">Export</button>
      </div>
    </form>
</div>`),a=f.getElementById("option__basetext"),o=[...T.trs()].map(x=>x.dataset.n);for(const x of o){const b=document.createElement("option");b.value=x,b.append(x),a.appendChild(b)}return f},showOptions:function(f,a){const o=a(),x=function(b){b.preventDefault();var R=[];const $=document.getElementById("exportform").elements;for(const B of $)B.type==="checkbox"?R.push([B.name,B.checked]):R.push([B.name,B.value]);const F=k.processOptions(new Map(R));f(F)};z.blackout(o,x)}};return k},tr=function(h){const{find:w,check:T,make:z}=h;return{group:function(f){const a=[...f],o=a.shift(),x=w.texts();for(const R of x){const $=z.xmlel("cl"),F=w.firstword(o,R);F.parentNode.insertBefore($,F),$.appendChild(F);for(const B of f)$.appendChild(w.firstword(B,R))}const b=a.pop();for(const R of w.tds(o))R.classList.add("group-start");for(const R of w.tds(b))R.classList.add("group-end");for(const R of a)for(const $ of w.tds(R))$.classList.add("group-internal")},ungroup:function(f){const a=w.texts();for(const x of a){let b;for(const R of f){const $=w.firstword(R,x);b||(b=$.closest("cl")),b.parentNode.insertBefore($,b)}b.parentNode.removeChild(b)}const o=[...f].flatMap(x=>[...w.tds(x)]);for(const x of o)x.classList.remove("group-start","group-internal","group-end")}}};function Bt(h){var w=[],T=0;if(this.trie=this.createTrie(h.patterns),this.leftMin=h.leftmin,this.rightMin=h.rightmin,this.exceptions={},h.exceptions)for(w=h.exceptions.split(/,\s?/g);T<w.length;T+=1)this.exceptions[w[T].replace(/\u2027/g,"").toLowerCase()]=new RegExp("("+w[T].split("‧").join(")(")+")","i")}Bt.TrieNode;Bt.prototype.createTrie=function(h){var w=0,T=0,z=0,C=0,k=null,f=null,a=null,o=null,x={_points:[]},b;for(w in h)if(h.hasOwnProperty(w))for(b=h[w].match(new RegExp(".{1,"+ +w+"}","g")),T=0;T<b.length;T+=1){for(k=b[T].replace(/[0-9]/g,"").split(""),f=b[T].split(/\D/),o=x,z=0;z<k.length;z+=1)a=k[z].charCodeAt(0),o[a]||(o[a]={}),o=o[a];for(o._points=[],C=0;C<f.length;C+=1)o._points[C]=f[C]||0}return x};Bt.prototype.hyphenateText=function(h,w){w=w||4;for(var T=h.split(/([a-zA-Z0-9_\u0027\u00AD\u00DF-\u00EA\u00EB\u00EC-\u00EF\u00F1-\u00F6\u00F8-\u00FD\u0101\u0103\u0105\u0107\u0109\u010D\u010F\u0111\u0113\u0117\u0119\u011B\u011D\u011F\u0123\u0125\u012B\u012F\u0131\u0135\u0137\u013C\u013E\u0142\u0144\u0146\u0148\u0151\u0153\u0155\u0159\u015B\u015D\u015F\u0161\u0165\u016B\u016D\u016F\u0171\u0173\u017A\u017C\u017E\u017F\u0219\u021B\u02BC\u0390\u03AC-\u03CE\u03F2\u0401\u0410-\u044F\u0451\u0454\u0456\u0457\u045E\u0491\u0531-\u0556\u0561-\u0587\u0902\u0903\u0905-\u090B\u090E-\u0910\u0912\u0914-\u0928\u092A-\u0939\u093E-\u0943\u0946-\u0948\u094A-\u094D\u0982\u0983\u0985-\u098B\u098F\u0990\u0994-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BE-\u09C3\u09C7\u09C8\u09CB-\u09CD\u09D7\u0A02\u0A03\u0A05-\u0A0A\u0A0F\u0A10\u0A14-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A82\u0A83\u0A85-\u0A8B\u0A8F\u0A90\u0A94-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABE-\u0AC3\u0AC7\u0AC8\u0ACB-\u0ACD\u0B02\u0B03\u0B05-\u0B0B\u0B0F\u0B10\u0B14-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3E-\u0B43\u0B47\u0B48\u0B4B-\u0B4D\u0B57\u0B82\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB5\u0BB7-\u0BB9\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD7\u0C02\u0C03\u0C05-\u0C0B\u0C0E-\u0C10\u0C12\u0C14-\u0C28\u0C2A-\u0C33\u0C35-\u0C39\u0C3E-\u0C43\u0C46-\u0C48\u0C4A-\u0C4D\u0C82\u0C83\u0C85-\u0C8B\u0C8E-\u0C90\u0C92\u0C94-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBE-\u0CC3\u0CC6-\u0CC8\u0CCA-\u0CCD\u0D02\u0D03\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D28\u0D2A-\u0D39\u0D3E-\u0D43\u0D46-\u0D48\u0D4A-\u0D4D\u0D57\u0D60\u0D61\u0D7A-\u0D7F\u1F00-\u1F07\u1F10-\u1F15\u1F20-\u1F27\u1F30-\u1F37\u1F40-\u1F45\u1F50-\u1F57\u1F60-\u1F67\u1F70-\u1F7D\u1F80-\u1F87\u1F90-\u1F97\u1FA0-\u1FA7\u1FB2-\u1FB4\u1FB6\u1FB7\u1FBD\u1FBF\u1FC2-\u1FC4\u1FC6\u1FC7\u1FD2\u1FD3\u1FD6\u1FD7\u1FE2-\u1FE7\u1FF2-\u1FF4\u1FF6\u1FF7\u200D\u2019]+)/gi),z=0;z<T.length;z+=1)T[z].indexOf("/")!==-1?z!==0&&z!==T.length-1&&!/\s+\/|\/\s+/.test(T[z])&&(T[z]+="​"):T[z].length>w&&(T[z]=this.hyphenate(T[z]).join("­"));return T.join("")};Bt.prototype.hyphenate=function(h){var w,T=[],z,C,k,f,a,o=[],x,b=h.toLowerCase(),R,$,F=Math.max,B=this.trie,M=[""];if(this.exceptions.hasOwnProperty(b))return h.match(this.exceptions[b]).slice(1);if(h.indexOf("­")!==-1)return[h];for(h="_"+h+"_",w=h.toLowerCase().split(""),z=h.split(""),x=w.length,C=0;C<x;C+=1)o[C]=0,T[C]=w[C].charCodeAt(0);for(C=0;C<x;C+=1)for(a=B,k=C;k<x&&(a=a[T[k]],a);k+=1)if(R=a._points,R)for(f=0,$=R.length;f<$;f+=1)o[C+f]=F(o[C+f],R[f]);for(C=1;C<x-1;C+=1)C>this.leftMin&&C<x-this.rightMin&&o[C]%2?M.push(z[C]):M[M.length-1]+=z[C];return M};var nr=Bt;const rr=wn(nr),sr={id:"sa",leftmin:2,rightmin:2,patterns:{2:"a1e1i1o1u1é1í1ï1ó1ú1ü1ā1ī1ū1ḷ1ḹ1ṛ1ṝ1",3:"2b_2c_2d_2g_2h_2j_2k_2l_2m_2n_2p_2r_2s_2t_2v_2y_2ñ_2ś_2ḍ_2ḥ12ḫ12ḷ_2ṁ12ṃ12ṅ_2ṇ_2ṭ_2ẖ1l̥1r̥1",4:"2bh_2ch_2dh_2gh_2jh_2kh_2m̐12ph_2rb_2rd_2rg_2rk_2rp_2rt_2rḍ_2rṭ_2th_2ḍh_2ṭh_a2i1a2u1a3ï1a3ü1l̥̄1r̥̄1"}};window.comboView=function(){const h={teins:"http://www.tei-c.org/ns/1.0",scripts:["iast","devanagari","telugu","grantha","malayalam"],filename:null,xml:null,treelist:new Map,trees:[],textboxes:[],matrix:null,viewdiv:null,descs:null,maxlemma:null,windows:[window],dragged:null,draganchor:null,undo:[],redo:[],editing:!1},w=new rr(sr),T=new Jn(h),z=new Qn(h),C=new tr(z),k=new er(z,T),{find:f,check:a,make:o}=z,x=function(){const c=document.getElementById("tooltip");c&&c.remove()},b={matrix:function(){return h.matrix=new pe,h.matrix.init(),h.matrix.show(),document.getElementById("matrixmenu").style.display="none",R(),M.rehighlight(),h.matrix},text:function(c){const u=new de(c);return h.textboxes.push(u),u.init(),u.show(),R(),M.rehighlight(),document.querySelector(".highlit")||Y.textClick({target:u.boxdiv.querySelector(".lemma:not(.invisible)")}),u},tree:function(c,u){const p=new K(c,u);return h.trees.push(p),p.init(),p.show(),R(),M.rehighlight(),p}},R=function(){for(const c of h.trees)c.draw()},$=function(){const c=window.getSelection?window.getSelection():document.selection;c&&(c.removeAllRanges?c.removeAllRanges():c.empty&&c.empty())},F=function(c){const u=document.createTreeWalker(c,NodeFilter.SHOW_TEXT);for(;u.nextNode();){const p=B(u.currentNode.nodeValue);u.currentNode.nodeValue=p}},B=function(c){return w.hyphenateText(c.replace(/ \|/g," |").replace(/\| (?=\d)/g,"| ").replace(/\|\|/g,"॥").replace(/\|/g,"।"))},M={getAllWindows:function(){return window.mainWindow?window.mainWindow.comboView.getWindows():h.windows},forEachWindow:function(c){const u=M.getAllWindows();for(const p of u)if(!p.closed&&c(p)===!1)break},highlightLemma:function(c,u){var p=!!u;M.forEachWindow(n=>{const r=n.comboView.getViewdiv().querySelectorAll('[data-n="'+c+'"]');for(const d of r)(!p||!d.classList.contains("invisible"))&&d.classList.add("highlit");const s=n.comboView.getViewdiv().querySelectorAll('[data-n-trans="'+c+'"]');for(const d of s)d.classList.add("translit")})},highlightRange:function(c){if(!c||c.size===0)return;M.unHighlightAll();const[u,p]=f.lowhigh(c);if(p!==void 0)for(let n=u;n<=p;n++)M.highlightLemma(n,!0);else M.highlightLemma(u);M.repopulateTrees(u,p);for(const n of h.viewdiv.querySelectorAll(".text-box"))n.querySelector(".highlit")||n.querySelector('[data-n="'+u+'"]').classList.add("highlit");ue.xScroll(u)},highlightAll:function(){a.anyhighlit()?M.unHighlightAll():M.highlightRange(new Set([0,f.maxlemma()]))},unHighlightAll:function(){M.forEachWindow(c=>{const u=c.comboView.getViewdiv().querySelectorAll(".highlit");for(const n of u)n.classList.remove("highlit");const p=c.comboView.getViewdiv().querySelectorAll(".translit");for(const n of p)n.classList.remove("translit");M.unCelllightAll()})},unCelllightAll:function(){M.forEachWindow(c=>{const u=c.comboView.getViewdiv().querySelectorAll(".highlitcell");for(const p of u)p.classList.remove("highlitcell")})},rehighlight:function(){var c;if(M.forEachWindow(p=>{if(c=p.document.querySelectorAll(".highlit"),c.length>0)return!1}),c.length>0){var u=new Set;for(const p of c)u.add(p.dataset.n);M.highlightRange(u)}},clearTrees:function(){M.forEachWindow(c=>{const u=c.comboView.getTrees();for(const p of u)p.clearlemmata()})},repopulateTrees:function(c,u){M.forEachWindow(p=>{const n=p.comboView.getTrees();for(const r of n)r.populate(c,u),r.colourizeVariants(c,u),r.updatescript()})},highlightTreeLemma:function(c){M.forEachWindow(u=>{const p=u.comboView.getTrees();for(const n of p){const r=n.boxdiv.querySelector('.tree-lemma[data-id="'+c+'"]'),s=n.boxdiv.querySelectorAll(".tree-lemma");for(const d of s)(r.dataset.nodes&&d.dataset.nodes===r.dataset.nodes||!r.dataset.nodes&&d.dataset.id===r.dataset.id)&&d.classList.add("highlit");n.clearLabels()}})},unhighlightTrees:function(){M.forEachWindow(c=>{const u=c.comboView.getViewdiv().querySelectorAll(".tree-lemma.highlit");for(const n of u)n.classList.remove("highlit");const p=c.comboView.getTrees();for(const n of p)n.clearLabels()})}},U=function(c,u){const p=u.target.files[0],n=[...u.target.files].slice(1),r=new FileReader;r.onload=c.bind(null,p,n),r.readAsText(p)},j=function(c,u,p){h.filename=c.name,document.title=document.title+`: ${h.filename}`,h.filename.split(".").pop()==="csv"?ae(c,u,p):fe(c,u,p)},X=function(c,u,p){const n=p.target.result,s=new DOMParser().parseFromString(n,"text/xml"),d=h.xml.querySelector("teiHeader > xenoData")||function(){const v=h.xml.querySelector("teiHeader")||function(){const D=o.xmlel("teiHeader");return h.xml.documentElement.appendChild(D),D}(),A=o.xmlel("xenoData");return v.appendChild(A),A}(),m=o.xmlel("stemma");m.setAttribute("format","nexml"),m.id="stemma"+[...d.querySelectorAll("stemma")].length,m.appendChild(s.firstChild.cloneNode(!0)),d.appendChild(m),G(s,m.id)},G=function(c,u,p=!0){const n=c.querySelectorAll("tree"),r=document.querySelector("#treemenu ul");for(const s of n){const d=s.id,m=c.cloneNode(!0);for(const D of m.querySelectorAll("tree"))D.id!==d&&D.parentNode.removeChild(D);const v=s.getAttribute("label")||"New Tree "+h.treelist.size;h.treelist.set(`#${u} #${d}`,m);const A=document.createElement("li");A.dataset.name=v,A.dataset.treeid=d,A.dataset.stemmaid=u,A.appendChild(document.createTextNode(v)),r.insertBefore(A,r.lastElementChild),p&&b.tree(u,d)}},ae=function(c,u,p){const n=bn.parse(p.target.result,{delimiter:","});h.xml=document.implementation.createDocument(h.teins,"",null);const r=o.xmlel("teiCorpus"),s=o.xmlel("teiHeader");r.appendChild(s),h.xml.appendChild(r);for(const d of n){const m=d[0],v=d.slice(1),A=o.xmlel("TEI");A.setAttribute("n",m);const D=o.xmlel("text");for(let N=0;N<v.length;N++){const V=v[N],W=o.xmlel("w");V&&W.appendChild(document.createTextNode(V)),W.setAttribute("n",N),D.appendChild(W)}A.appendChild(D),r.appendChild(A)}h.xml.normalize(),h.maxlemma=f.maxlemma(),J()},fe=function(c,u,p){const n=new DOMParser;h.xml=n.parseFromString(p.target.result,"text/xml"),h.xml.documentElement.getAttribute("xml:lang")==="ta"&&(h.scripts=["iast","tamil"]);const r=h.xml.querySelectorAll("teiHeader xenoData stemma nexml");for(const s of r){const d=document.implementation.createDocument("http://www.nexml.org/2009","",null);d.appendChild(s.cloneNode(!0)),G(d,s.closest("stemma").id,!1)}h.maxlemma=f.maxlemma(),u.length>0?ve(u):J()},ve=function(c){const u=c[0],p=c.slice(1),n=function(d,m){const v=new Set(d);for(const A of m)v.delete(A);return v},r=function(d,m){const A=new DOMParser().parseFromString(m.target.result,"text/xml"),D=new Map;for(const Se of f.teis()){const Ae=Se.getAttribute("n");D.set(Ae,Se)}const N=new Set(D.keys()),V=new Map;for(const Se of A.querySelectorAll("TEI")){const Ae=Se.getAttribute("n");V.set(Ae,Se)}const W=new Set(V.keys()),ie=n(N,W),be=n(W,N);for(const Se of be)o.tei(Se);const Ce=[...A.querySelector("text").querySelectorAll("w[n]")].length,ye=h.maxlemma+Ce;for(const[Se,Ae]of V)if(D.has(Se)){const ke=D.get(Se).querySelector("text"),Me=Ae.querySelector("text").querySelectorAll("w[n]");var _e=h.maxlemma+1;for(const De of Me)De.setAttribute("n",_e),ke.appendChild(De),_e=_e+1}else{const ke=o.xmlel("TEI");ke.setAttribute("n",Se);const Ne=o.xmlel("text");o.emptywords(Ne,ye,0),ke.appendChild(Ne),h.xml.documentElement.appendChild(ke)}for(const Se of ie){const Ae=D.get(Se).querySelector("text");o.emptywords(Ae,ye,h.maxlemma+1)}h.maxlemma=f.maxlemma(),d.length>0?ve(d):J()},s=new FileReader;s.onload=r.bind(null,p),s.readAsText(u)},O=function(){var c="";const u=[...f.teis()].map(p=>p.getAttribute("n"));for(const p of u)c+=`<li data-name="${p}">${p}</li>`;document.getElementById("menu").querySelector(".ms").innerHTML=c},J=function(){O();const c=new ge("Export");c.populate([{text:"TEI corpus",func:k.showOptions.bind(null,k.xml,k.options)},{text:"TEI apparatus",func:k.showOptions.bind(null,k.xml,k.appOptions)},{text:"CSV",func:k.showOptions.bind(null,k.csv,k.options)},{text:"NEXUS",func:k.showOptions.bind(null,k.nexus,k.options)}]);const u=new ge("Edit");u.populate([{text:"Undo",greyout:a.undo,func:I.undo},{text:"Redo",greyout:a.redo,func:I.redo},{text:"Select all",alt:"Deselect all",toggle:a.anyhighlit,func:M.highlightAll},{text:"Group by whitespace",func:I.doGroupWords},{text:"Delete empty columns",func:I.startRemoveEmpty},{text:"Delete empty rows",func:I.startRemoveEmptyRows}]);const p=new ge("Column");p.populate([{text:"(Re)normalize column",alt:"(Re)normalize columns",greyout:a.anyhighlit,toggle:a.manyhighlit,func:I.startRenormalize.bind(null,!1)},{text:"Delete column",alt:"Delete columns",greyout:a.anyhighlit,toggle:a.manyhighlit,func:I.removeCol.start.bind(null,!1)},{text:"Merge columns",greyout:a.manyhighlit,func:I.startMerge.bind(null,!1)},{text:"Group columns",alt:"Ungroup columns",greyout:a.oneGrouped,toggle:a.grouped,func:I.group.start.bind(null,!1)},{text:"Insert column",greyout:a.anyhighlit,func:I.insertCol.start},{text:"Mark insignificant",checkbox:a.checkbox.bind(null,"insignificant"),greyout:a.anyhighlit,func:I.startMarkAs.bind(null,"insignificant",!1)},{text:"Mark binary",checkbox:a.checkbox.bind(null,"binary"),greyout:a.anyhighlit,func:I.startMarkAs.bind(null,"binary",!1)}]);const n=new ge("Row");n.populate([{text:"Insert row",func:I.startNewRow}]);const r=new ge("Cell");r.populate([{text:"Edit cell",greyout:a.highlitcell,func:I.startEditCell.bind(null,!1)}]);const s=new ge("View");s.populate([{text:"Header",checkbox:a.headerView,func:ue.toggleHeader},{text:"Normalized",checkbox:a.normalizedView,greyout:a.anyNormalized,func:ue.toggleNormalize}]);const d=document.getElementById("left_menu");d.appendChild(s.box),d.appendChild(u.box),d.appendChild(p.box),d.appendChild(n.box),d.appendChild(r.box),d.appendChild(c.box);const m=document.getElementById("views");m.style.justifyContent="flex-start",m.removeChild(m.querySelector("#splash")),b.matrix();const v=document.getElementById("matrixmenu");v.addEventListener("click",b.matrix),v.removeChild(v.querySelector("ul")),document.getElementById("mssmenu").style.display="block",document.getElementById("treemenu").style.display="block"},Y={selectAll(c){const u=document.createRange();u.selectNodeContents(c);const p=window.getSelection();p.removeAllRanges(),p.addRange(u)},deselect(){const c=window.getSelection();c.removeAllRanges?c.removeAllRanges():c.empty&&c.empty()},treeMouseover(c){const u=c.target.classList.contains("tree-lemma")?c.target:c.target.closest(".tree-lemma");u&&(M.highlightTreeLemma(u.dataset.id),u.addEventListener("mouseout",M.unhighlightTrees));const p=c.target.dataset.reconstructed;if(!p)return;const n=document.createElement("div");n.id="tooltip",n.style.top=c.pageY+"px",n.style.left=c.pageX+"px",n.style.opacity=0,n.style.transition="opacity 0.2s ease-in",h.viewdiv.parentElement.appendChild(n);const r=document.createElement("div");if(r.appendChild(document.createTextNode(p)),this.script!==0?n.appendChild(Yt(r,h.scripts[this.script])):n.appendChild(r),c.target.classList.contains("reconstructed")){const s=c.target.parentNode.querySelector("span.tree-lemma");if(s&&s.dataset.hasOwnProperty("emended")){const d=document.createElement("div");d.classList.add("emphasis"),d.appendChild(document.createTextNode(s.textContent)),this.script!==0?n.prepend(Yt(d,h.scripts[this.script])):n.prepend(d)}}window.getComputedStyle(n).opacity,n.style.opacity=1,c.target.addEventListener("mouseout",x)},treeClick(c){c.target.classList.contains("witness")?b.text(c.target.dataset.key):c.target.classList.contains("reconstructed")?b.text(c.target.dataset.label):c.target.classList.contains("internal")&&I.startReconstruction(c),x()},keyDown(c){if(!h.editing&&c.key.substring(0,5)==="Arrow")Y.cycleVariant(c);else if(c.ctrlKey||c.metaKey)c.key==="Z"?I.redo():c.key==="z"&&I.undo();else if(!h.editing&&h.matrix&&!h.matrix.closed&c.key==="Enter"){const u=f.highlitcell();u&&(c.preventDefault(),I.startEditCell(u))}},cycleVariant(c){const u=f.highlitcell()||h.viewdiv.querySelector("td.highlit")||h.viewdiv.querySelector('td[data-n="0"]');switch(c.key){case"ArrowRight":{if(!h.matrix.closed&&u){const p=u.nextElementSibling;p&&Y.textClick({target:p})}else{const p=h.viewdiv.querySelector(".highlit"),n=p?p.dataset.n:0;let r=parseInt(n)+1;for(;r<=h.maxlemma;){const s=h.viewdiv.querySelectorAll('[data-n="'+r+'"]');for(const d of s)if(d&&!d.classList.contains("invisible")){Y.textClick({target:d});return}r++}}break}case"ArrowLeft":{if(!h.matrix.closed&&u){const p=u.previousElementSibling;p&&Y.textClick({target:p})}else{const p=h.viewdiv.querySelector(".highlit"),n=p?p.dataset.n:0;let r=parseInt(n)-1;for(;r>=0;){const s=h.viewdiv.querySelectorAll('[data-n="'+r+'"]');for(const d of s)if(d&&!d.classList.contains("invisible")){Y.textClick({target:d});return}if(r--,u){Y.textClick({target:u.previousElementSibling});return}}}break}case"ArrowUp":{if(h.matrix.closed||!u)return;const n=u.closest("tr").previousElementSibling;if(!n||!n.dataset.n)return;const r=n.querySelector(`td[data-n="${u.dataset.n}"]`);Y.textClick({target:r});break}case"ArrowDown":{if(h.matrix.closed||!u)return;const n=u.closest("tr").nextElementSibling;if(!n||n.tagName!=="TR")return;const r=n.querySelector(`td[data-n="${u.dataset.n}"]`);Y.textClick({target:r})}}},textClick(c,u=!1){if(c.target.closest("tr.header")){Y.matrixHeaderClick(c);return}const p=c.target.classList.contains("lemma")?c.target:c.target.closest(".lemma");if(p){if(!u&&c.ctrlKey){Y.rightClick(c);return}const n=p.dataset.n,r=f.highlitrow();if(M.unHighlightAll(),M.highlightLemma(n),M.repopulateTrees(n),ue.xScroll(n,r),p.tagName==="TD")p.classList.add("highlitcell");else{const s=p.closest(".text-box");if(s){const d=s.dataset.id;f.tr(d).querySelector(`td[data-n="${n}"]`).classList.add("highlitcell")}}}},textMouseup(){const c=f.selection();c&&(M.highlightRange(c),$())},menuMouseover(c){const u=c.target.classList.contains("menubox")?c.target:c.target.closest(".menubox");if(u){const p=u.querySelector("ul");p&&(p.style.display="block"),u.classList.add("open")}},menuMouseout(c){const u=c.target.classList.contains("menubox")?c.target:c.target.closest(".menubox");if(u){const p=u.querySelector("ul");p&&(p.style.display="none"),u.classList.remove("open")}},menuClick(c){c.target.parentElement&&(c.target.parentElement.className==="ms"&&(Y.menuMouseout(c),b.text(c.target.dataset.name)),c.target.parentElement.className==="tree"&&(Y.menuMouseout(c),c.target.closest("li[data-name]")&&b.tree(c.target.dataset.stemmaid,c.target.dataset.treeid)))},thDragStart(c){c.target.closest('th[scope="row"]')&&(c.dataTransfer.setData("text/plain",c.target.textContent),I.startMoveRow(c.target.parentNode,c))},trDragEnter(c){const u=c.target.nodeType===1?c.target.closest("tr"):c.target.parentElement.closest("tr");u&&u.classList.add("dragenter")},trDragLeave(c){const u=c.target.nodeType===1?c.target.closest("tr"):c.target.parentElement.closest("tr");u&&u.classList.remove("dragenter")},trDragDrop(c){c.preventDefault(),I.finishMoveRow(c)},matrixMousedown(c){if(c.button!==0)return;if(c.ctrlKey){Y.rightClick(c);return}const u=c.target.nodeType===1?c.target.closest(".lemma"):c.target.parentElement.closest(".lemma");if(u){if(u.isContentEditable)return;M.unHighlightAll(),M.highlightLemma(u.dataset.n),h.draganchor=parseInt(u.dataset.n),h.matrix.boxdiv.querySelector("table").addEventListener("mouseover",Y.matrixMouseover),window.addEventListener("mouseup",Y.matrixMouseup)}},matrixMouseup(c){const u=f.highlit();u.size===1?Y.textClick(c):(M.clearTrees(),M.highlightRange(u)),h.draganchor=null,h.matrix.boxdiv.querySelector("table").removeEventListener("mouseover",Y.matrixMouseover),window.removeEventListener("mouseup",Y.matrixMouseup)},matrixMouseover(c){const u=c.target.nodeType===1?c.target.closest(".lemma"):c.target.parentElement.closest(".lemma");if(u){M.unHighlightAll();const r=h.draganchor,s=parseInt(u.dataset.n);if(r===s)M.highlightLemma(r);else{var p,n;r>s?(p=r,n=s):(p=s,n=r);for(let d=n;d<=p;d++)M.highlightLemma(d,!0)}}},matrixHeaderClick(c){if(c.target.tagName!=="INPUT")return;const u=c.target.className;if(u!=="insignificant"&&u!=="binary")return;const p=c.target.closest("th").dataset.ref,n=f.firsttd(p).dataset[u]!=="true",r=new Map([[p,n]]);I.doMarkAs(u,r)},rightClick(c){const u=c.target.nodeType===1?c.target.closest("tr[data-n] th"):c.target.parentElement.closest("tr[data-n] th");if(u){c.preventDefault(),ne.remove();const n=ne.create(c),r=[{text:"move row",func:I.startMoveRow.bind(null,u.parentNode)},{text:"delete row",func:I.doDeleteRow.bind(null,u.parentNode.dataset.n)}];ne.populate(n,r),ne.show(n);return}const p=c.target.nodeType===1?c.target.closest("td.lemma"):c.target.parentElement.closest("td.lemma");if(p){c.preventDefault();const n=p.classList.contains("highlit")?function(){const d=f.highlit();return d.size===1&&!p.classList.contains("highlitcell")&&(M.unCelllightAll(),p.classList.add("highlitcell")),d}():(Y.textClick(c,!0),new Set([p.dataset.n])),r=n.size>1?[{text:"merge columns",func:I.startMerge.bind(null,n)},{text:"ungroup columns",alt:"group columns",toggle:a.grouped,func:I.group.start.bind(null,!1)},{text:"delete columns",func:I.removeCol.start.bind(null,n)}]:[{text:"edit cell",func:I.startEditCell.bind(null,p)},{text:"delete column",func:I.removeCol.start.bind(null,n)},{text:"insert column",func:I.insertCol.start}];ne.remove();const s=ne.create(c);ne.populate(s,r),ne.show(s)}}},I={undo:function(){const c=h.undo.pop();c&&c[0](...c[1])},redo:function(){const c=h.redo.pop();c&&c[0](...c[1])},doStack:function(c,u="do"){u==="undo"?(c[1].push("redo"),h.redo.push(c)):u==="redo"?(c[1].push("undo"),h.undo.push(c)):(c[1].push("undo"),h.undo.push(c),h.redo=[])},doMulti:function(c,u){const p=[];for(const n of c){const r=n[0](...n[1],"multido");p.unshift(r)}I.doStack([I.doMulti,[p]],u)},startMoveRow:function(c,u){if(h.dragged=c,h.dragged.classList.add("dragging"),u.type!=="dragstart"){for(const p of f.trs())p.classList.add("moveinprogress");h.matrix.boxdiv.querySelector("table").addEventListener("mousedown",I.finishMoveRow)}},startMerge:function(c){const u=c===!1?f.highlit():c,p=f.clauses(u,!0);if(!p)I.doMerge(u,"do");else if(p[0]===null){const n=p.filter(r=>r!==null).map(r=>[I.ungroup.go,[r]]).concat([[I.doMerge,[u]]]);I.doMulti(n,"do")}else{const n=p.map(r=>[I.ungroup.go,[r]]).concat([[I.doMerge,[u]]]);I.doMulti(n,"do")}},group:{start:function(c){const u=c===!1?f.highlit():c;a.grouped()?I.ungroup.start(u):I.group.go(u,"do")},go:function(c,u="do"){C.group(c);for(const p of h.textboxes)p.refresh();if(u==="multido")return[I.ungroup.go,[c]];I.doStack([I.ungroup.go,[c]],u)}},ungroup:{start:function(c){const p=[...f.clauses(c)].map(n=>[I.ungroup.go,[n]]);I.doMulti(p,"do")},go:function(c,u="do"){C.ungroup(c);for(const p of h.textboxes)p.refresh();if(u==="multido")return[I.group.go,[c]];I.doStack([I.group.go,[c]],u)}},insertCol:{start:function(){const c=Math.max([...f.highlit()])||h.maxlemma;I.insertCol.go({mode:"append",start:c})},go:function(c,u="do"){const p=function(s,d,m,v){const A=s();for(var D=0;D<A.length;D++){const N=d(c.start,A[D]);if(c.mode==="append")if(m)for(const V of m[D].reverse())N.insertAdjacentElement("afterend",V);else{const V=v(c.start+1);N.insertAdjacentElement("afterend",V)}else if(m)for(const V of m[D])N.insertAdjacentElement("beforebegin",V);else{const V=v(c.start);N.insertAdjacentElement("beforebegin",V)}}return m?m[0].length:1};M.unHighlightAll();var n;c.hasOwnProperty("xml")?(p(...c.xml),n=p(...c.html)):(p(f.trs,f.firsttd,null,o.emptycell),p(f.texts,f.firstword,null,o.emptyword),n=1);const r=c.mode==="append"?[...Array(n).keys()].map(s=>c.start+s+1):[...Array(n).keys()].map(s=>c.start+s);if(I.renumber(c.start),M.highlightRange(new Set(r)),I.refresh(),I.reIAST(r),I.restyleGroups(r,!0),ue.updateAllHeaders(),u==="multido")return[I.removeCol.go,[r]];I.doStack([I.removeCol.go,[r]],u)}},removeCol:{start:function(c){const u=c===!1?f.highlit():c,p=f.clauses(u);if(!p)I.removeCol.go(u,"do");else{const n=p.map(r=>[I.ungroup.go,[r]]).concat([[I.removeCol.go,[u]]]);I.doMulti(n,"do")}},go:function(c,u="do"){const p=function(A,D){const N=A(),V=[];for(const W of N){const ie=[...c].map(Ce=>{const ye=D(Ce,W);return I.unnormalize(ye),ye}),be=ie.map(Ce=>Ce.cloneNode(!0));V.push(be);for(const Ce of ie)Ce.parentNode.removeChild(Ce)}return[A,D,V]},n={mode:"insert"};[...c].map(A=>parseInt(A));const r=Math.min(...c),s=Math.max(...c);f.firstword(s).nextElementSibling||(n.mode="append");const m=p(f.trs,f.firsttd),v=p(f.texts,f.firstword);if(I.renumber(r-1),I.refresh(),I.restyleGroups(c,!0),ue.updateAllHeaders(),n.html=m,n.xml=v,n.mode==="append"?n.start=r-1:n.start=r,u==="multido")return[I.insertCol.go,[n]];I.doStack([I.insertCol.go,[n]],u)}},startRemoveEmpty:function(){const c=f.empty(),u=f.clauses(c);if(!u)I.removeCol.go(c,"do");else{const p=f.clausesToRemove(u,c,1);if(!p)I.removeCol.go(c,"do");else{const n=p.map(r=>[I.ungroup.go,[r]]).concat([[I.removeCol.go,[c]]]);I.doMulti(n,"do")}}},startRemoveEmptyRows:function(){const u=[...f.emptyRows(!0)].map(p=>[I.doDeleteRow,[p]]);I.doMulti(u,"do")},startEditCell:function(c){const u=c||f.highlitcell();u&&(I.unnormalize(u),u.dataset.oldContent=u.textContent,u.contentEditable="true",u.focus(),h.editing=!0,Y.selectAll(u),u.addEventListener("blur",I.finishEditCell),u.addEventListener("keydown",I.cellKeyDown))},cellKeyDown:function(c){switch(c.key){case"Enter":I.finishEditCell(c);break;case"Escape":I.finishEditCell(c,!0);break;case"ArrowRight":{const u=f.cursorPos(c.target);u[0]===u[1]&&window.getSelection().type==="Caret"&&(c.preventDefault(),I.finishEditCell(c),Y.cycleVariant({key:"ArrowRight"}),I.startEditCell(f.highlitcell()));break}case"ArrowLeft":{f.cursorPos(c.target)[0]===0&&(c.preventDefault(),I.finishEditCell(c),Y.cycleVariant({key:"ArrowLeft"}),I.startEditCell(f.highlitcell()));break}}},startMarkAs:function(c,u,p){const n=p.target.tagName==="INPUT"?p.target:p.target.querySelector("input"),r=u===!1?f.highlit():u,s=new Map([...r].map(d=>[d,!n.checked]));I.doMarkAs(c,s)},startNewRow:function(){const c=o.row("new row"),u=c.querySelector("th");u.contentEditable=!0,u.addEventListener("blur",I.finishNewRow),u.addEventListener("keydown",I.thKeyDown),h.matrix.boxdiv.querySelector("tbody").appendChild(c),u.scrollIntoView(),u.focus(),document.execCommand("selectAll",!1,null),h.editing=!0},startRenameRow:function(){},startReconstruction:function(c){const u=c.target.dataset.key,p=c.target.closest(".tree-box").myTree,n=p.desc,r=document.createRange().createContextualFragment(`<div id="reconstructionoptions" class="popup">
    <form id="reconstructionform">
      <div>
        <label for="reconstructed_node_name">Label for node:</label>
        <input type="text" id="reconstructed_node_name" name="reconstructed_node_name" placeholder="${n}-${u}" size="15">
      </div>
      <div style="width: 100%; display: flex; justify-content: center;padding-top: 1em;">
        <button type="submit">Add to matrix</button>
      </div>
    </form>
</div>`),s=function(d){d.preventDefault();const m=blackout.querySelector("input"),v=m.value?m.value:m.placeholder;I.doReconstruction(p,u,v)};o.blackout(r,s),document.getElementById("reconstructed_node_name").focus()},thKeyDown:function(c){c.key==="Enter"&&I.finishNewRow(c)},finishNewRow:function(c){const u=c.target,p=u.textContent;u.closest("tr").dataset.n=p;const n=o.tei(p);h.xml.documentElement.appendChild(n),h.editing=!1,u.contentEditable=!1,u.removeEventListener("blur",I.finishNewRow),u.removeEventListener("keydown",I.thKeyDown),I.doStack([I.doDeleteRow,[p]],"do")},finishEditCell:function(c,u=!1){const p=c.target;h.editing=!1,p.contentEditable="false",p.removeEventListener("blur",I.finishEditCell),p.removeEventListener("keydown",I.cellKeyDown),p.blur(),Y.deselect();const n=p.textContent;if(n===""){const m=p.querySelector("br");m&&m.remove()}if(u)return;if(n===p.dataset.oldContent){delete p.dataset.oldContent;return}p.hasOwnProperty("IAST")||(p.IAST=p.cloneNode(!0)),p.IAST.textContent=n;const r=parseInt(p.dataset.n),s=p.closest("tr"),d=s.dataset.n;if(I.xmlChangeCell(r,d,n),s.dataset.hasOwnProperty("treename")&&!p.dataset.hasOwnProperty("emended")){const m=I.doEmend(r,d,"multido"),v=[];v.push([I.doChangeCell,[r,d,p.dataset.oldContent]]),v.push(m),I.doStack([I.doMulti,[v]],"do")}else I.doStack([I.doChangeCell,[r,d,p.dataset.oldContent]],"do");delete p.dataset.oldContent,I.refresh(),ue.updateAllHeaders(!0),p.classList.add("highlitcell")},finishMoveRow:function(c){const u=c.target.nodeType===1?c.target.closest("tr"):c.target.parentElement.closest("tr");if(u&&I.doMoveRow(h.dragged,u,"do"),c.type!=="drop"){for(const p of f.trs())p.classList.remove("moveinprogress");h.matrix.boxdiv.querySelector("table").removeEventListener("mousedown",I.finishMoveRow)}else for(const p of f.trs())p.classList.remove("dragenter");h.dragged.classList.remove("dragging"),h.dragged=null},doReconstruction:function(c,u,p){const n=o.row(p,"pending");n.dataset.treename=c.name,n.dataset.nodename=u;const r=n.querySelector("th"),s=document.createElement("div");s.id="spinner",r.prepend(s);const d=o.tei(p);d.setAttribute("type","reconstructed"),d.setAttribute("corresp",c.name),d.setAttribute("select",`#${u}`);const m=[...f.tds(!1,n)],v=[...f.words(!1,d)];h.matrix.boxdiv.querySelector("tbody").appendChild(n),r.scrollIntoView();const A=new Worker(new URL(""+new URL("worker-uuz1IgR3.js",import.meta.url).href,import.meta.url)),D=a.normalizedView(),N=f.serializedtexts(c.nexml,D),V=new Map(N.map(W=>[W[0],W[1][0]]));A.postMessage({readings:V,levels:c.levels,num:0,id:u}),A.onmessage=function(W){const ie=W.data.n,be=W.data.result;if(m[ie].textContent=be,m[ie].IAST=m[ie].cloneNode(!0),m[ie].classList.remove("pending"),v[ie].textContent=be,ie<h.maxlemma){const Ce=new Map(N.map(ye=>[ye[0],ye[1][ie+1]]));A.postMessage({readings:Ce,levels:c.levels,num:ie+1,id:u})}else{r.removeChild(s),h.xml.documentElement.appendChild(d),ue.updateAllHeaders(),c.draw();const Ce=f.highlit();Ce.size>0&&M.repopulateTrees(...f.lowhigh(Ce));const ye=document.getElementById("menu").querySelector(".ms"),_e=document.createElement("li");_e.setAttribute("data-name",p),_e.appendChild(document.createTextNode(p)),ye.appendChild(_e),I.doStack([I.doDeleteRow,[p]],"do")}}},doDeleteRow:function(c,u="do"){const p=f.tr(c),n=f.tei(c),s=[...f.teis()].indexOf(n);if(p.parentNode.removeChild(p),n.parentNode.removeChild(n),ue.updateAllHeaders(),O(),R(),u==="multido")return[I.doUndeleteRow,[p,n,s]];I.doStack([I.doUndeleteRow,[p,n,s]],u)},doUndeleteRow:function(c,u,p,n="do"){const r=u.getAttribute("n"),s=[...f.teis()];if(p===s.length)h.xml.documentElement.appendChild(u),h.matrix.boxdiv.querySelector("tbody").appendChild(c);else{const d=[...f.trs()];h.xml.documentElement.insertBefore(u,s[p]),d[p].parentNode.insertBefore(c,d[p])}if(ue.updateAllHeaders(),O(),R(),n==="multido")return[I.doDeleteRow,[r]];I.doStack([I.doDeleteRow,[r]],n)},doMoveRow:function(c,u,p="do"){const n=c.parentNode,r=[...f.trs()],s=c.previousElementSibling,d=r.indexOf(c),m=u!==null?r.indexOf(u):null,v=function(){u===-1?n.insertBefore(c,n.firstChild):u.nextElementSibling?n.insertBefore(c,u.nextElementSibling):n.appendChild(c)},A=function(){const D=h.xml.documentElement,N=[...f.teis()],V=N[d];if(m===-1)D.insertBefore(V,N[0]);else{const W=N[m];W.nextElementSibling?D.insertBefore(V,W.nextElementSibling):D.appendChild(V)}};if(v(),A(),p==="multido")return[I.doMoveRow,[c,s]];I.doStack([I.doMoveRow,[c,s]],p)},doMerge:function(c,u="do"){const p=function(d,m,v){const A=d();var D=[];for(const N of A){const V=[...v].map(be=>m(be,N)),W=V.map(be=>be.cloneNode(!0));D.push(W);for(const be of V)I.unnormalize(be);const ie=V.reduce(function(be,Ce){if(Ce.hasChildNodes())for(;Ce.firstChild;)be.appendChild(Ce.firstChild);return Ce.parentNode.removeChild(Ce),be});ie.normalize(),ie.dataset?(delete ie.dataset.normal,ie.IAST=ie.cloneNode(!0)):ie.removeAttribute("lemma")}return[d,m,D]},n=p(f.trs,f.firsttd,c),r=p(f.texts,f.firstword,c),s=parseInt([...c][0]);if(I.renumber(s),I.restyleGroups(c),I.refresh(),ue.updateAllHeaders(),u==="multido")return[I.doUnmerge,[n,r]];I.doStack([I.doUnmerge,[n,r]],u)},doUnmerge:function(c,u,p="undo"){const n=function(m,v,A){const D=f.whichattr(A[0][0]),N=A[0].map(be=>be.getAttribute(D)),V=N[0],W=m();for(var ie=0;ie<W.length;ie++){const be=A[ie].pop(),Ce=v(V,W[ie]);Ce.parentNode.replaceChild(be,Ce);for(const ye of A[ie])be.parentNode.insertBefore(ye,be)}return N};n(...c);const r=n(...u),d=[...r].sort((m,v)=>parseInt(m)-parseInt(v))[0];if(I.renumber(d),I.reIAST(r),I.refresh(),I.restyleGroups(r),ue.updateAllHeaders(),p==="multido")return[I.doMerge,[r]];I.doStack([I.doMerge,[r]],p)},doGroupWords:function(){let c=0;const u=[],p=f.emptyRows();for(let n=0;n<=h.maxlemma;n++){const r=f.tds(n),s=r[0].classList;if(s.contains("group-start")||s.contains("group-internal")||s.contains("group-end")){c=n+1;continue}let d=r.length-p.size,m=0;if(n===h.maxlemma)m=d;else for(let v=0;v<r.length;v++){if(p.has(v))continue;const A=r[v];(A.IAST?A.IAST.textContent:A.textContent).slice(-1)===" "&&m++}if(m/d>=.5)if(c===n){c++;continue}else{const v=f.range(c,n);u.push([I.group.go,[v]]),c=n+1}}I.doMulti(u)},doEmend:function(c,u,p="do"){const n=[...f.trs()][u],r=f.firsttd(c,n);r.dataset.emended=!0;const s=f.tei(u).querySelector("text");if(f.firstword(c,s).setAttribute("emended","true"),p==="multido")return[I.doUnemend,[c,u]];I.doStack([I.doUnemend,[c,u]],p)},doUnemend:function(c,u,p="do"){const n=[...f.trs()][u],r=f.firsttd(c,n);delete r.dataset.emended;const s=f.tei(u).querySelector("text");if(f.firstword(c,s).removeAttribute("emended"),p==="multido")return[I.doEmend,[c,u]];I.doStack([I.doEmend,[c,u]],p)},doChangeCell:function(c,u,p,n="do"){const r=I.xmlChangeCell(c,u,p),s=I.htmlChangeCell(c,u,p);if(I.refresh(),ue.updateAllHeaders(!0),Y.textClick({target:s}),n==="multido")return[I.doChangeCell,[c,u,r]];I.doStack([I.doChangeCell,[c,u,r]],n)},htmlChangeCell:function(c,u,p){const n=f.tr(u),r=f.firsttd(c,n);return I.unnormalize(r),r.textContent=p,r.IAST&&(r.IAST=r.cloneNode(!0)),r},xmlChangeCell:function(c,u,p){const n=f.tei(u).querySelector("text"),r=f.firstword(c,n);I.unnormalize(r);const s=r.textContent;return r.childNodes.length===0?r.appendChild(document.createTextNode(p)):r.textContent=p,s},doMarkAs:function(c,u,p="do"){const n=[...u.keys()],r=f.attr(c,n);for(const s of n){const d=f.tds(s),m=f.words(s);if(u.get(s)===!0){for(const A of d)A.dataset[c]="true";for(const A of m)A.setAttribute(c,"true")}else{for(const A of d)delete A.dataset[c];for(const A of m)A.removeAttribute(c)}const v=f.checkbox(s,c);v.checked=u.get(s)}if(p==="multido")return[I.doMarkAs,[c,r]];I.doStack([I.doMarkAs,[c,r]],p)},refresh:function(){for(const c of h.textboxes)c.refresh();M.rehighlight(),a.anyhighlit()?M.repopulateTrees(...f.lowhigh(f.highlit())):M.clearTrees()},renumber:function(c=0){const u=function(p,n,r){const s=p();for(const m of s){const v=[...n(!1,m)],A=f.whichattr(v[0]);for(var d=parseInt(r)+1;d<v.length;d++)v[d].setAttribute(A,d)}};u(f.trs,f.tds,c),u(()=>[!0],f.ths,c),u(f.texts,f.words,c),h.maxlemma=f.maxlemma()},reIAST:function(c){const u=[...c].map(p=>[...f.lemmata(p)]).flat();for(const p of u)p.IAST=p.cloneNode(!0)},restyleGroups:function(c,u=!1){const n=u?function(s){var d=[...s];const m=parseInt(c[0])-1,v=parseInt(c[c.length-1])+1;return d.unshift(m),d.push(v),d}(c):c,r=function(s,d=!1){const m=new Set(["group-start","group-internal","group-end"]);d&&m.delete(d);for(const v of s){for(const A of m)v.classList.remove(A);d&&v.classList.add(d)}};for(const s of n){const d=f.firstword(s),m=f.tds(s);if(m.length===0)continue;const v=d.closest("cl");v?d===v.firstElementChild?r(m,"group-start"):d===v.lastElementChild?r(m,"group-end"):r(m,"group-internal"):r(m)}},startRenormalize:function(c){const u=c===!1?f.highlit():c;I.doRenormalize(Math.min(...u),Math.max(...u))},doRenormalize:function(c,u,p=!1,n="do"){const r=new Map,s=[...f.trs()],d=[...f.texts()],m=p?[p]:[...s.keys()],v=h.xml.documentElement.getAttribute("xml:lang")==="ta";for(const A of m){const D=new Map,N=d[A],V=N.parentNode.getAttribute("n"),W=document.querySelector(`.text-box[data-id="${V}"]`),ie=[...f.words(!1,N)],be=f.firstword(c,N),Ce=f.firstword(u,N),ye=ie.indexOf(be),_e=ie.indexOf(Ce),Se=ie.slice(ye,_e+1),Ae=s[A],Ne=[...f.tds(!1,Ae)].slice(ye,_e+1),Me=Se.map(Re=>Re.textContent),De=Vn(Me,v);for(let Re=0;Re<De.length;Re++){const qe=Se[Re],Fe=De[Re],je=Me[Re],Xe=Ne[Re],Ge=qe.hasAttribute("lemma")?qe.getAttribute("lemma"):!1;if(Ge!==!1){if(Ge===Fe)continue;D.set(Xe.dataset.n,Ge),I.unnormalize(qe),I.unnormalize(Xe)}else D.set(Xe.dataset.n,null);Fe!==je&&(qe.setAttribute("lemma",Fe),Xe.dataset.normal=Fe,W&&(W.querySelector(`.lemma[data-n="${Xe.dataset.n}"]`).dataset.normal=Fe))}r.set(A,D)}ue.showNormalized(),ue.updateAllHeaders(!0),ue.xScrollToHighlit(),I.doStack([I.doUnrenormalize,[r]],n)},doUnrenormalize:function(c,u="undo"){a.normalizedView()||ue.showNormalized();const p=new Map,n=[...f.trs()],r=[...f.texts()];for(const[s,d]of c.entries()){const m=n[s],v=r[s],A=new Map;for(const[D,N]of d.entries()){const V=f.firsttd(D,m),W=f.firstword(D,v),ie=W.hasAttribute("lemma")?W.getAttribute("lemma"):null;A.set(D,ie),N===null?(I.unnormalize(V),I.unnormalize(W)):(V.dataset.normal=N,W.setAttribute("lemma",N),V.textContent=N)}p.set(s,A)}I.doStack([I.doUnrenormalize,[p]],u)},unnormalize:function(c){c.hasOwnProperty("IAST")&&(c.textContent=c.IAST.textContent),c.dataset&&c.dataset.hasOwnProperty("normal")&&delete c.dataset.normal,c.getAttribute("lemma")&&c.removeAttribute("lemma")}},ue={toggleNormalize:function(){a.normalizedView()?ue.showUnnormalized():ue.showNormalized()},showNormalized:function(c){if(c)c.updatescript();else{document.getElementById("views").classList.add("normalized");for(const p of h.textboxes)p.updatescript();h.matrix.updatescript(),a.anyhighlit()?M.repopulateTrees(...f.lowhigh(f.highlit())):M.clearTrees()}ue.updateAllHeaders(!0),ue.xScrollToHighlit()},showUnnormalized:function(){document.getElementById("views").classList.remove("normalized"),h.matrix.updatescript();for(const c of h.textboxes)c.updatescript();a.anyhighlit()?M.repopulateTrees(...f.lowhigh(f.highlit())):M.clearTrees(),ue.updateAllHeaders(!0),ue.xScrollToHighlit()},toggleHeader:function(){const c=h.matrix.boxdiv.querySelector("tr.header");c.style.display==="none"?c.style.display="table-row":c.style.display="none"},updateHeaders(c){for(const u of c){const p=f.firstth(u),[n,r]=f.readings(u),s=p.querySelector("span.readings"),d=n<2?n:`${n}(${r.size})`;s.textContent=d}},updateAllHeaders(c=!1){const u=[...f.trs()],p=u.map(m=>f.trWalker(m)),n=[...f.tds(!1,u[0])],r=[...f.ths()],s=h.matrix.boxdiv.querySelector("tr.header"),d=function(){const m=document.createElement("th"),v=document.createElement("span");v.classList.add("readings"),m.appendChild(v);const A=document.createElement("form");return A.innerHTML='<div><input class="insignificant" type="checkbox">Insignificant</div><div><input class="binary" type="checkbox">Binary</div>',m.appendChild(A),s.appendChild(m),m};for(let m=0;m<n.length;m++){const v=m>=r.length?d():r[m],A=n[m];v.dataset.ref=A.dataset.n;let D=0;const N=new Set;for(const W of p){const ie=W.nextNode().textContent;ie!==""&&(D++,N.add(ie))}const V=D<2?D:`${D}(${N.size})`;v.querySelector("span.readings").textContent=V,c||(v.querySelector("input.insignificant").checked=!!A.dataset.insignificant,v.querySelector("input.binary").checked=!!A.dataset.binary)}if(r.length>n.length)for(let m=n.length;m<r.length;m++)s.removeChild(r[m])},xScrollToHighlit:function(){const c=f.highlit();c.size>0&&ue.xScroll([...c][0])},xScroll:function(c,u){if(!c)return;const p=u||f.firsttr(),n=f.firsttd(c,p),r=n.getBoundingClientRect(),s=h.matrix.boxdiv,m=s.getBoundingClientRect().right,v=p.querySelector("th").getBoundingClientRect(),A=v.right,D=r.right>m,N=r.left+.1<A;D&&n.scrollIntoView({inline:"end",block:"nearest"}),N&&(n.scrollIntoView({inline:"start",block:"nearest"}),s.scroll({left:s.scrollLeft-v.width}))}},ne={create:function(c){const u=document.createElement("div");return u.classList.add("contextmenu"),u.style.left=c.clientX-12+"px",u.style.top=c.clientY-22+"px",u},remove:function(){for(const c of document.querySelectorAll(".contextmenu"))c.parentNode.removeChild(c)},show:function(c){document.body.appendChild(c)},populate:function(c,u){const p=document.createElement("ul");for(const n of u){const r=document.createElement("li");if(n.hasOwnProperty("cond")){const s=document.createRange().createContextualFragment('<form><input type="checkbox"'+(n.cond()?" checked":"")+"></form>");r.appendChild(s)}if(n.hasOwnProperty("toggle")){const s=n.toggle()?n.text:n.alt;r.appendChild(document.createTextNode(s))}else r.appendChild(document.createTextNode(n.text));r.addEventListener("mouseup",n.func),p.appendChild(r)}c.appendChild(p)}};class ge{constructor(u){this.name=u,this.box=document.createElement("div"),this.box.classList.add("menubox");const p=document.createElement("div");p.classList.add("heading"),p.appendChild(document.createTextNode(u)),this.box.appendChild(p),p.addEventListener("mouseover",this.checkConditions.bind(this)),this.box.addEventListener("mouseup",this.click.bind(this)),this.items=new Map,this.conditions=new Map}populate(u){const p=this.box.querySelector("ul")||function(n){const r=document.createElement("ul");return n.box.appendChild(r),r}(this);for(const n of u){const r=document.createElement("li");if(n.hasOwnProperty("checkbox")){const s=document.createElement("form"),d=document.createElement("input");d.type="checkbox",d.addEventListener("click",m=>m.preventDefault()),s.appendChild(d),r.appendChild(s),r.appendChild(document.createTextNode(n.text)),this.conditions.set(d,n.checkbox)}else if(n.hasOwnProperty("toggle")){const s=document.createElement("span");s.appendChild(document.createTextNode(n.text)),s.dataset.text=n.text,s.dataset.alt=n.alt,this.conditions.set(s,n.toggle),r.appendChild(s)}else r.appendChild(document.createTextNode(n.text));n.hasOwnProperty("greyout")&&this.conditions.set(r,n.greyout),this.items.set(r,n.func),p.appendChild(r)}}click(u){const p=u.target.tagName==="LI"?u.target:u.target.closest("li");if(p&&!p.classList.contains("greyedout")){const n=this.items.get(p);n&&(n(u),this.checkConditions())}}checkConditions(){const u=new Map;for(const[p,n]of this.conditions){const r=u.get(n)||function(){const s=n();return u.set(n,s),s}();p.tagName==="INPUT"?p.checked=r:p.tagName==="SPAN"?r?p.textContent=p.dataset.alt:p.textContent=p.dataset.text:p.tagName==="LI"&&(r?p.classList.remove("greyedout"):p.classList.add("greyedout"))}}}class xe{constructor(u){this.name=u,this.script=0}show(){h.descs.appendChild(this.descbox),a.normalizedView()&&ue.showNormalized(this),h.viewdiv.appendChild(this.boxdiv),this.closed=!1}clear(){for(;this.boxdiv.firstChild;)this.boxdiv.removeChild(this.boxdiv.firstChild);this.svgcontainer&&(this.clearsvg(),this.boxdiv.appendChild(this.svgcontainer))}destroy(){h.viewdiv.removeChild(this.boxdiv),h.descs.removeChild(this.descbox);const u=h.trees.indexOf(this);u>-1&&h.trees.splice(u,1);const p=h.textboxes.indexOf(this);p>-1&&h.textboxes.splice(p,1),this.closed=!0,this.name==="Matrix"&&(document.getElementById("matrixmenu").style.display="block"),R(),M.rehighlight()}pullout(){this.destroy();const u="menubar=no,location=no,status=no,height=620,width=620,scrollbars=yes,centerscreen=yes",p=window.mainWindow?window.mainWindow.comboView.getWindows().length:h.windows.length,n=window.open("branch.html","branch"+p,u);n.mainWindow=window.mainWindow?window.mainWindow:window,n.startbox=this.text?{text:{name:this.name}}:{tree:this.name},n.mainWindow.comboView.addWindow(n)}makeDescBox(){const u=document.createElement("div"),p=document.createElement("div");p.classList.add("closer"),p.innerHTML="x",p.title="close";const n=document.createElement("div");n.classList.add("scripter"),n.innerHTML="A",n.title="change script",u.appendChild(p),u.appendChild(n),u.appendChild(document.createTextNode(this.desc)),this.descbox=u,p.addEventListener("click",this.destroy.bind(this)),n.addEventListener("click",this.cyclescript.bind(this))}cyclescript(){const u=h.scripts[this.script];this.script=this.script+1,this.script===h.scripts.length&&(this.script=0);const p=this.descbox.querySelector(".scripter");this.script===0?p.innerHTML="A":p.innerHTML=ot[h.scripts[this.script]]("a"),p.classList.add(h.scripts[this.script]),p.classList.remove(u),this.updatescript(),this.boxdiv.classList.add(h.scripts[this.script]),this.boxdiv.classList.remove(u)}updatescript(u){const p=u?u.map(n=>this.boxdiv.querySelector(`.lemma[data-n=${n}]`)):this.boxdiv.querySelectorAll(".lemma,.tree-lemma");for(const n of p){const r=n.dataset.hasOwnProperty("normal");if(!r&&n.textContent.trim()==="")continue;const s=(m=>{if(a.normalizedView()&&r){const v=m.createElement("span");return v.appendChild(m.createTextNode(n.dataset.normal)),v}else return n.IAST.cloneNode(!0)})(document),d=this.script===0?s:Yt(s,h.scripts[this.script]);for(n.innerHTML="";d.firstChild;)n.appendChild(d.firstChild)}this.boxdiv.classList.contains("matrix")&&ue.xScrollToHighlit()}}class K extends xe{constructor(u,p){super(`#${u} #${p}`),this.stemmaid=u,this.id=p,this.nexml=h.treelist.get(this.name).cloneNode(!0),this.desc=this.nexml.querySelector("tree").getAttribute("label")}init(){this.makeDescBox();const u=document.createElement("div");u.classList.add("tree-box");var p,n=0;do p="tree"+n,n++;while(document.getElementById(p));u.id=p,this.boxdiv=u,this.boxdiv.addEventListener("mouseover",Y.treeMouseover.bind(this)),this.boxdiv.addEventListener("click",Y.treeClick),this.svgcontainer=document.createElement("div"),this.svgcontainer.id=this.boxdiv.id+"container",this.boxdiv.appendChild(this.svgcontainer),this.boxdiv.myTree=this,this.calcPaths(),this.jiggleroot(),this.findLevels(),this.labelInternal()}show(){h.descs.appendChild(this.descbox),h.viewdiv.appendChild(this.boxdiv)}jiggleroot(){const u=this.nexml.evaluate('//nex:node[@root="true"]',this.nexml,this.nsResolver,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue,p=this.nexml.evaluate('//nex:edge[@source="'+u.id+'"]|//nex:edge[@target="'+u.id+'"]',this.nexml,this.nsResolver,XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE,null);if(p.snapshotLength===3){var n,r;for(let s=0;s<p.snapshotLength;s++){const d=p.snapshotItem(s),m=d.getAttribute("source"),v=d.getAttribute("target"),A=this.nexml.evaluate('//nex:node[@id="'+m+'"]',this.nexml,this.nsResolver,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue,D=this.nexml.evaluate('//nex:node[@id="'+v+'"]',this.nexml,this.nsResolver,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue;if(!A.hasAttribute("otu")&&!D.hasAttribute("otu")){n=d,r=v===u.id?"target":"source";break}}if(n){const s=this.nexml.createElementNS(u.namespaceURI,"node");s.id="fakeroot",s.setAttribute("root","true"),u.removeAttribute("root"),u.parentElement.insertBefore(s,u);const d=this.nexml.createElementNS(u.namespaceURI,"edge");d.id="newrootedge",d.setAttribute("length","0"),d.setAttribute("source","fakeroot"),d.setAttribute("target",u.id),u.parentElement.insertBefore(d,n),n.setAttribute(r,s.id)}}}findLevels(){const u=this.nexml.querySelectorAll("edge"),p=[...this.nexml.querySelectorAll("node[otu]")],n=this.nexml,r=[p],s=function(v,A){const D=v.map(ye=>ye.id),N=new Map,V=new Map,W=[];for(const ye of A){const _e=ye.getAttribute("target"),Se=ye.getAttribute("source"),Ae=D.indexOf(_e)!==-1?{ancestor:n.getElementById(Se),child:n.getElementById(_e)}:D.indexOf(Se)!==-1?{ancestor:n.getElementById(_e),child:n.getElementById(Se)}:null;if(Ae!==null)if(V.has(Ae.ancestor)){const ke=V.get(Ae.ancestor);N.set(Ae.ancestor,[ke.child,Ae.child]),W.push(ye),W.push(ke.edge)}else V.set(Ae.ancestor,{child:Ae.child,edge:ye})}const ie=[...N.keys()],be=[...V.keys()].reduce((ye,_e)=>(ie.indexOf(_e)===-1&&ye.push(V.get(_e).child),ye),[]),Ce=[...A].reduce((ye,_e)=>(W.indexOf(_e)===-1&&ye.push(_e),ye),[]);return{match:N,remainder:[...new Set(be)],edges:Ce}};var d=p,m=u;do{const v=s(d,m);r.push(v.match),d=[...v.match.keys(),...v.remainder],m=v.edges}while(m.length>0);this.levels=f.serializedlevels(r)}labelInternal(){for(const u of this.nexml.querySelectorAll("node:not([label])"))u.setAttribute("label",u.id)}fitch(){const u=new Map(this.levels[0].map(n=>{const r=a.normalizedView(),s=this.nexml.querySelector(`node[id="${n}"]`).getAttribute("label"),d=this.boxdiv.querySelector(`span.tree-lemma[data-id="${s}"]`),m=d?f.htmlreading(d,r):void 0;return[n,m]})),p=new Zn(u,this.levels).run();for(const[n,r]of p){const s=this.boxdiv.querySelector(`span.internal[data-key="${n}"]`);s.dataset.reconstructed=r}}clearsvg(){for(;this.svgcontainer.firstChild;)this.svgcontainer.removeChild(this.svgcontainer.firstChild)}removecolors(){const u=this.nexml.querySelectorAll("node[color]");for(let p=0;p<u.snapshotLength;p++)u.snapshotItem(p).removeAttribute("color")}drawlines(u,p){if(this.removecolors(),u){const m=this.getPath(...u.split(";")).path,v=new Set;for(const A of m)v.add(A.getAttribute("target")),v.add(A.getAttribute("source"));for(const A of v){const D=this.nexml.evaluate('//nex:node[@id="'+A+'"]',this.nexml,this.nsResolver,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue;D.getAttribute("root")||D.setAttribute("color",p)}}const n=parseInt(window.getComputedStyle(this.svgcontainer,null).width)-15,r=parseInt(window.getComputedStyle(this.boxdiv,null).height)-10,s=function(){return r<600?600:r}();q.PhyloCanvas.Render.Style.line.stroke="rgb(162,164,170)",this.phylocanvas=new q.PhyloCanvas({nexml:this.nexml,fileSource:!0},this.svgcontainer.id,n,s);const d=this.svgcontainer.querySelectorAll('path:not([stroke="#a2a4aa"])');for(const m of d)m.style.strokeWidth="2"}draw(){this.clear(),this.drawlines(),this.makeLabels()}clearLabels(){for(const u of this.boxdiv.firstChild.querySelectorAll("text"))u.parentElement.removeChild(u)}makeLabels(){const u=[...f.texts()],p=new Set(u.map(r=>r.parentNode.getAttribute("n"))),n=new Map(u.filter(r=>r.parentNode.hasAttribute("corresp")&&r.parentNode.getAttribute("corresp")===this.name).map(r=>[r.parentNode.getAttribute("select").replace(/^#/,""),r.parentNode.getAttribute("n")]));for(const r of this.boxdiv.firstChild.querySelectorAll("text")){const s=document.createElement("div");s.setAttribute("class","tree-div");const d=parseInt(r.getAttribute("x")-5),m=parseInt(r.getAttribute("y"))-15;s.style.left=d+"px",s.style.top=m+"px";const v=r.textContent.trim();p.has(v)?s.innerHTML=`<span class="witness inactive" data-key="${v}">${v}</span><span class="tree-lemma ${v}" data-id="${v}"></span>`:v!=="fakeroot"?n.has(v)?s.innerHTML=`<span class="internal reconstructed" data-key="${v}" data-label="${n.get(v)}">${n.get(v)}</span><span class="tree-lemma invisible ${v}" data-id="${v}" data-label="${n.get(v)}"></span>`:s.innerHTML=`<span class="internal" data-key="${v}">0</span>`:s.innerHTML=`<span class="internal" data-key="${v}"></span>`,r.parentElement.removeChild(r),this.boxdiv.appendChild(s)}}clearlemmata(){for(const u of this.boxdiv.querySelectorAll("span.tree-lemma"))u.innerHTML="",u.dataset.hasOwnProperty("normal")&&delete u.dataset.normal,u.IAST=u.cloneNode(!0)}populate(u,p){const n=f.texts();for(const d of n){const m=d.parentNode.getAttribute("n"),v=this.boxdiv.querySelector(`span.tree-lemma[data-id="${m}"]`)||this.boxdiv.querySelector(`span.tree-lemma[data-label="${m}"]`);if(v){if(v.hasOwnProperty("IAST")||(v.IAST=v.cloneNode(!0)),v.IAST.innerHTML="",p){const A=[],D=[];var r=!1;for(let N=u;N<=p;N++){const V=f.firstword(N,d);A.push(V.innerHTML),V.hasAttribute("lemma")&&(D[N-u]=V.getAttribute("lemma")),V.hasAttribute("emended")&&(r=!0)}if(v.IAST.appendChild(T.transformString(A.join(" ").replace(/\s+/g," ").trim(),T.sheets.tree)),D.length!==0){const N=A.slice(0).map((W,ie)=>D.hasOwnProperty(ie)?D[ie]:W),V=document.createElement("span");V.appendChild(T.transformString(N.join(" ").replace(/\s+/g," ").trim(),T.sheets.tree)),v.dataset.normal=V.innerHTML}r?v.dataset.emended=!0:v.dataset.hasOwnProperty("emended")&&delete v.dataset.emended}else{const A=f.firstword(u,d);v.IAST.appendChild(T.transformString(A.innerHTML,T.sheets.tree)),A.hasAttribute("lemma")?v.dataset.normal=A.getAttribute("lemma"):delete v.dataset.normal,A.hasAttribute("emended")?v.dataset.emended=!0:v.dataset.hasOwnProperty("emended")&&delete v.dataset.emended}a.normalizedView()&&v.dataset.hasOwnProperty("normal")?v.innerHTML=v.dataset.normal:v.innerHTML=v.IAST.innerHTML}}const s=this.boxdiv.querySelectorAll(".inactive");for(const d of s)d.classList.remove("inactive");this.fitch()}calcPaths(){this.nodes=[],this.paths=[],this.longest={path:[]},this.nsResolver=this.nexml.createNSResolver(this.nexml.ownerDocument==null?this.nexml.documentElement:this.nexml.ownerDocument.documentElement);const u=this.nexml.evaluate("//nex:node[@label]",this.nexml,this.nsResolver,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE);for(let p=0;p<u.snapshotLength;p++)this.nodes.push(u.snapshotItem(p));for(let p=0;p<this.nodes.length;p++){const n=this.nodes[p],r=n.getAttribute("label"),s=n.id;for(let d=p+1;d<this.nodes.length;d++){const m=this.nodes[d],v=m.getAttribute("label"),A=m.id;this.paths.push({nodes:[r,v],path:this.pathFind(s,A)})}}for(const p of Object.keys(this.paths))this.paths[p].path.length>this.longest.path.length&&(this.longest=this.paths[p])}pathFind(u,p,n){n||(n=[]);const r=this.nexml.evaluate('//nex:edge[@source="'+u+'"]|//nex:edge[@target="'+u+'"]',this.nexml,this.nsResolver,XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE,null);var s;for(let d=0;d<r.snapshotLength;d++){const m=r.snapshotItem(d);if(s=[m],n.indexOf(m.id)!=-1)continue;n.push(m.id);const v=m.getAttribute("source")!==u?m.getAttribute("source"):m.getAttribute("target");if(v===p)return s;if(!this.nexml.evaluate('//nex:node[@id="'+v+'"]',this.nexml,this.nsResolver,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue.hasAttribute("otu")){const D=this.pathFind(v,p,n);if(D)return s.concat(D);continue}}return!1}analyzeVariants(u,p){const n=[],r=[],s=function(D){return D.startsWith("<lg")?T.transformString(D,T.sheets.lg).firstChild.data.slice(1):D},d=function(D){return D.map(N=>s(N)).join(" ").replace(/\s+/g," ").trim()},m=a.normalizedView()?function(D,N){const V=f.firstword(D,N);return V.hasAttribute("lemma")?V.getAttribute("lemma"):V.textContent}:function(D,N){return f.firstword(D,N).textContent};for(const D of f.texts()){const N=D.parentNode.getAttribute("n");if(!this.nexml.querySelector(`otu[label="${N}"]`))continue;const V=p?d(f.range(u,p).map(W=>m(W,D))):s(m(u,D));V===""?n.hasOwnProperty("")?n[""].push(N):n[""]=[N]:n.hasOwnProperty(V)?n[V].push(N):n[V]=[N]}const v={};for(const D of Object.keys(n)){var A={length:0,branch_length:0,paths:[]};if(n[D].length===1)A=!1;else for(let N=0;N<n[D].length;N++)for(let V=N+1;V<n[D].length;V++){const W=this.getPath(n[D][N],n[D][V]);if(W.hasOwnProperty("path")||alert(W),W.path.length===A.length){const ie=this.calcBranchLength(W.path);ie===A.branch_length?A.paths.push(W):ie>A.branch_length&&(A={length:W.path.length,branch_length:ie,paths:[W]})}else W.path.length>A.length&&(A={length:W.path.length,branch_length:this.calcBranchLength(W.path),paths:[W]})}v[D]=A}for(const D of Object.keys(r))v[D]=r[D];return v}getPath(u,p){for(const n of this.paths)if(n.nodes.indexOf(u)>-1&&n.nodes.indexOf(p)>-1)return n;return!1}calcBranchLength(u){return u.map(p=>p.getAttribute("length")).reduce((p,n)=>parseFloat(p)+parseFloat(n))}pickColour(u,p,n,r){var s=p,d=n,m=u;r&&(m=m*2,m>=1&&(m-=1,s=n,d=r));const v=d.red-s.red,A=d.green-s.green,D=d.blue-s.blue,N={red:parseInt(Math.floor(s.red+v*m),10),green:parseInt(Math.floor(s.green+A*m),10),blue:parseInt(Math.floor(s.blue+D*m),10)};return"rgb("+N.red+","+N.green+","+N.blue+")"}colourizeVariants(u,p){const n=this.analyzeVariants(u,p);for(const r of this.boxdiv.querySelectorAll("span.tree-lemma")){const s=n.hasOwnProperty(r.dataset.id)?n[n[r.dataset.id]]:n[r.textContent],d={red:252,green:70,blue:107},m={red:63,green:94,blue:251};s?(r.style.color=this.pickColour(s.length/this.longest.path.length,m,d),r.dataset.length=s.length,r.dataset.branch_length=s.branch_length,r.dataset.nodes=s.paths[0].nodes.join(";")):(r.style.color=this.pickColour(1/this.longest.path.length,m,d),r.dataset.length=0,r.dataset.branch_length=0,r.dataset.nodes=""),r.textContent.trim()===""?(r.innerHTML='<span lang="en">   </span>',r.style.backgroundColor=r.style.color):r.style.backgroundColor=""}}}class de extends xe{constructor(u){super(u),this.desc=u,this.text=f.firsttext(u)}init(){this.makeTextBox(),this.makeDescBox(),this.descbox.style.maxWidth="595px",this.descbox.style.paddingLeft="5px",this.boxdiv.addEventListener("mouseup",Y.textMouseup)}refresh(){this.boxdiv.innerHTML="",this.boxdiv.appendChild(T.sheets.lemma.transformToFragment(this.text,document)),F(this.boxdiv);for(const u of f.lemmata(!1,this.boxdiv))u.IAST=u.cloneNode(!0);this.updatescript()}makeTextBox(){const u=document.createElement("div");u.dataset.id=this.name,u.classList.add("text-box"),u.appendChild(T.sheets.lemma.transformToFragment(this.text,document)),F(u);for(const p of f.lemmata(!1,u))p.IAST=p.cloneNode(!0);this.boxdiv=u}}class pe extends xe{constructor(){super(name),this.desc="Matrix",this.name="Matrix",this.makeDescBox(),this.makeViewBox(),this.descbox.style.maxWidth="100vw",this.descbox.style.paddingLeft="5px"}init(){this.makeTable()}makeViewBox(){const u=document.createElement("div");u.classList.add("matrix"),u.dataset.id=this.name,this.boxdiv=u}makeTable(){const u=document.createElement("div");u.classList.add("scroller"),u.append(T.sheets.matrix.transformToFragment(h.xml,document)),u.addEventListener("dragstart",Y.thDragStart),u.addEventListener("dragenter",Y.trDragEnter),u.addEventListener("dragleave",Y.trDragLeave),u.addEventListener("dragover",v=>v.preventDefault()),u.addEventListener("drop",Y.trDragDrop),u.addEventListener("mousedown",Y.matrixMousedown);const p=document.createElement("tr");p.classList.add("header");const n=document.createElement("td");n.classList.add("anchor"),p.appendChild(n);const r=[...f.trs(u)],s=r.map(v=>f.trWalker(v)),d=f.tds(!1,r[0]);for(const v of d){const A=document.createElement("th");A.dataset.ref=v.dataset.n;let D=0;const N=new Set;for(const be of s){const Ce=be.nextNode();Ce.IAST=Ce.cloneNode(!0);const ye=Ce.textContent;ye!==""&&(D++,N.add(ye))}const V=D<2?D:`${D}(${N.size})`,W=document.createElement("span");W.classList.add("readings"),W.appendChild(document.createTextNode(V)),A.appendChild(W);const ie=document.createElement("form");ie.innerHTML='<div><input class="insignificant" title="insignificant" type="checkbox"'+(v.dataset.insignificant?"checked":"")+'></div><div><input class="binary" title="binary" type="checkbox"'+(v.dataset.binary?"checked":"")+"></div>",A.appendChild(ie),p.appendChild(A)}const m=u.querySelector("tbody");m.insertBefore(p,m.firstChild),this.boxdiv.append(u)}}return{branchinit:function(){comboView.init(),window.startbox!==void 0&&(window.startbox.tree?b.tree(window.startbox.tree.stemmaid,window.startbox.tree.id):window.startbox.text&&b.text(window.startbox.text.name,window.startbox.text.map))},maininit:function(){const c=document.getElementById("menu");c.addEventListener("mouseover",Y.menuMouseover),c.addEventListener("mouseout",Y.menuMouseout),c.addEventListener("click",Y.menuClick),c.querySelector("#file").addEventListener("change",U.bind(null,j),!1),c.querySelector("#treefile").addEventListener("change",U.bind(null,X),!1),c.style.display="block",comboView.init()},init:function(){h.viewdiv=document.getElementById("views"),h.descs=document.getElementById("descs"),h.viewdiv.addEventListener("click",Y.textClick),document.addEventListener("keydown",Y.keyDown,{capture:!0}),document.addEventListener("contextmenu",Y.rightClick),document.addEventListener("mouseup",ne.remove)},getWindows:function(){return h.windows},addWindow:function(c){h.windows.push(c)},getViewdiv:function(){return h.viewdiv},getTrees:function(){return h.trees}}}();window.addEventListener("load",window.comboView.maininit);
