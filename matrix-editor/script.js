"use strict";var tt={};tt.defaults={skip_sgml:!1,syncope:!1};var zt=tt.schemes={balinese:{vowels:"á¬… á¬† á¬‡ á¬ˆ á¬‰ á¬Š á¬‹ á¬Œ á¬ á¬  á¬ á¬  á¬‘ á¬’".split(" "),vowel_marks:"á¬µ á¬¶ á¬· á¬¸ á¬¹ á¬º á¬» á¬¼ á¬½ á­‚ á¬¾ á¬¿ á­ƒ á­€ á­".split(" "),other_marks:["á¬‚","á¬„","á¬",""],virama:["á­„"],consonants:"á¬“ á¬” á¬• á¬– á¬— á¬˜ á¬™ á¬š á¬› á¬œ á¬ á¬ á¬Ÿ á¬  á¬¡ á¬¢ á¬£ á¬¤ á¬¥ á¬¦ á¬§ á¬¨ á¬© á¬ª á¬« á¬¬ á¬­ á¬® á¬¯ á¬° á¬± á¬² á¬³".split(" "),symbols:"á­ á­‘ á­’ á­“ á­” á­• á­– á­— á­˜ á­™   á­ á­Ÿ".split(" "),zwj:["â€"],skip:[""]},bengali:{vowels:"à¦… à¦† à¦‡ à¦ˆ à¦‰ à¦Š à¦‹ à§  à¦Œ à§¡  à¦ à¦  à¦“ à¦”".split(" "),vowel_marks:"à¦¾ à¦¿ à§€ à§ à§‚ à§ƒ à§„ à§¢ à§£  à§‡ à§ˆ  à§‹ à§Œ".split(" "),other_marks:"à¦‚ à¦ƒ à¦".split(" "),virama:["à§"],consonants:"à¦• à¦– à¦— à¦˜ à¦™ à¦š à¦› à¦œ à¦ à¦ à¦Ÿ à¦  à¦¡ à¦¢ à¦£ à¦¤ à¦¥ à¦¦ à¦§ à¦¨ à¦ª à¦« à¦¬ à¦­ à¦® à¦¯ à¦° à¦² à¦¬ à¦¶ à¦· à¦¸ à¦¹ à¤³ à¦•à§à¦· à¦œà§à¦".split(" "),symbols:"à§¦ à§§ à§¨ à§© à§ª à§« à§¬ à§­ à§® à§¯ à¥ à¦½ à¥¤ à¥¥".split(" "),other:"    à¦¡ à¦¢  à¦¯ ".split(" ")},newa:{vowels:["ğ‘€","ğ‘","ğ‘‚","ğ‘ƒ","ğ‘„","ğ‘…","ğ‘†","ğ‘‡","ğ‘ˆ","ğ‘‰","","ğ‘Š","ğ‘‹","","ğ‘Œ","ğ‘"],vowel_marks:["ğ‘µ","ğ‘¶","ğ‘·","ğ‘¸","ğ‘¹","ğ‘º","ğ‘»","ğ‘¼","ğ‘½","","ğ‘¾","ğ‘¿","","ğ‘‘€","ğ‘‘"],other_marks:["ğ‘‘„","ğ‘‘…","ğ‘‘ƒ","ğ‘‘ ","ğ‘‘¡",""],virama:["ğ‘‘‚"],consonants:["ğ‘","ğ‘","ğ‘","ğ‘‘","ğ‘’","ğ‘”","ğ‘•","ğ‘–","ğ‘—","ğ‘˜","ğ‘š","ğ‘›","ğ‘œ","ğ‘","ğ‘","ğ‘Ÿ","ğ‘ ","ğ‘¡","ğ‘¢","ğ‘£","ğ‘¥","ğ‘¦","ğ‘§","ğ‘¨","ğ‘©","ğ‘«","ğ‘¬","ğ‘®","ğ‘°","ğ‘±","ğ‘²","ğ‘³","ğ‘´"],symbols:["ğ‘‘","ğ‘‘‘","ğ‘‘’","ğ‘‘“","ğ‘‘”","ğ‘‘•","ğ‘‘–","ğ‘‘—","ğ‘‘˜","ğ‘‘™","ğ‘‘‰","ğ‘‘‡","ğ‘‘‹","ğ‘‘Œ"]},sarada:{vowels:["ğ‘†ƒ","ğ‘†„","ğ‘†…","ğ‘††","ğ‘†‡","ğ‘†ˆ","ğ‘†‰","ğ‘†Š","ğ‘†‹","ğ‘†Œ","","ğ‘†","ğ‘†","","ğ‘†","ğ‘†"],vowel_marks:["ğ‘†³","ğ‘†´","ğ‘†µ","ğ‘†¶","ğ‘†·","ğ‘†¸","ğ‘†¹","ğ‘†º","ğ‘†»","","ğ‘†¼","ğ‘†½","","ğ‘†¾","ğ‘†¿"],other_marks:["ğ‘†","ğ‘†‚","ğ‘†€","ğ‘‡‚","ğ‘‡ƒ"],virama:["ğ‘‡€"],consonants:["ğ‘†‘","ğ‘†’","ğ‘†“","ğ‘†”","ğ‘†•","ğ‘†–","ğ‘†—","ğ‘†˜","ğ‘†™","ğ‘†š","ğ‘†›","ğ‘†œ","ğ‘†","ğ‘†","ğ‘†Ÿ","ğ‘† ","ğ‘†¡","ğ‘†¢","ğ‘†£","ğ‘†¤","ğ‘†¥","ğ‘†¦","ğ‘†§","ğ‘†¨","ğ‘†©","ğ‘†ª","ğ‘†«","ğ‘†¬","ğ‘†®","ğ‘†¯","ğ‘†°","ğ‘†±","ğ‘†²","ğ‘†­"],symbols:["ğ‘‡","ğ‘‡‘","ğ‘‡’","ğ‘‡“","ğ‘‡”","ğ‘‡•","ğ‘‡–","ğ‘‡—","ğ‘‡˜","ğ‘‡™","ğ‘‡„","ğ‘‡","ğ‘‡…","ğ‘‡†"]},devanagari:{vowels:"à¤… à¤† à¤‡ à¤ˆ à¤‰ à¤Š à¤‹ à¥  à¤Œ à¥¡ à¤ à¤ à¤ à¤’ à¤“ à¤” à¤ à¤ à¤“".split(" "),vowel_marks:"à¤¾ à¤¿ à¥€ à¥ à¥‚ à¥ƒ à¥„ à¥¢ à¥£ à¥† à¥‡ à¥ˆ à¥Š à¥‹ à¥Œ à¥ à¥à¥‡ à¥à¤¾ à¥à¥‹ à¥† à¥".split(" "),other_marks:"à¤‚ à¤ƒ à¤ á³µ á³¶ ê£½".split(" "),virama:["à¥"],consonants:"à¤• à¤– à¤— à¤˜ à¤™ à¤š à¤› à¤œ à¤ à¤ à¤Ÿ à¤  à¤¡ à¤¢ à¤£ à¤¤ à¤¥ à¤¦ à¤§ à¤¨ à¤ª à¤« à¤¬ à¤­ à¤® à¤¯ à¤° à¤² à¤µ à¤¶ à¤· à¤¸ à¤¹ à¤³".split(" "),symbols:"à¥¦ à¥§ à¥¨ à¥© à¥ª à¥« à¥¬ à¥­ à¥® à¥¯ à¥ à¤½ à¥¤ à¥¥".split(" "),zwj:["â€"],skip:[""],accent:["à¥‘","à¥’"],combo_accent:"à¤ƒà¥‘ à¤ƒà¥’ à¤‚à¥‘ à¤‚à¥’".split(" "),candra:["à¥…"],other:"à¤•à¤¼ à¤–à¤¼ à¤—à¤¼ à¤œà¤¼ à¤¡à¤¼ à¤¢à¤¼ à¤«à¤¼ à¤¯à¤¼ à¤±".split(" ")},gujarati:{vowels:"àª… àª† àª‡ àªˆ àª‰ àªŠ àª‹ à«  àªŒ à«¡  àª àª  àª“ àª”".split(" "),vowel_marks:"àª¾ àª¿ à«€ à« à«‚ à«ƒ à«„ à«¢ à«£  à«‡ à«ˆ  à«‹ à«Œ".split(" "),other_marks:"àª‚ àªƒ àª".split(" "),virama:["à«"],consonants:"àª• àª– àª— àª˜ àª™ àªš àª› àªœ àª àª àªŸ àª  àª¡ àª¢ àª£ àª¤ àª¥ àª¦ àª§ àª¨ àªª àª« àª¬ àª­ àª® àª¯ àª° àª² àªµ àª¶ àª· àª¸ àª¹ àª³".split(" "),symbols:"à«¦ à«§ à«¨ à«© à«ª à«« à«¬ à«­ à«® à«¯ à« àª½ à«¤ à«¥".split(" "),candra:["à«…"]},gurmukhi:{vowels:"à¨… à¨† à¨‡ à¨ˆ à¨‰ à¨Š      à¨ à¨  à¨“ à¨”".split(" "),vowel_marks:"à¨¾ à¨¿ à©€ à© à©‚      à©‡ à©ˆ  à©‹ à©Œ".split(" "),other_marks:"à¨‚ à¨ƒ à¨".split(" "),virama:["à©"],consonants:"à¨• à¨– à¨— à¨˜ à¨™ à¨š à¨› à¨œ à¨ à¨ à¨Ÿ à¨  à¨¡ à¨¢ à¨£ à¨¤ à¨¥ à¨¦ à¨§ à¨¨ à¨ª à¨« à¨¬ à¨­ à¨® à¨¯ à¨° à¨² à¨µ à¨¶ à¨¶ à¨¸ à¨¹ à¨³".split(" "),symbols:"à©¦ à©§ à©¨ à©© à©ª à©« à©¬ à©­ à©® à©¯ à¥ à¤½ à¥¤ à¥¥".split(" "),other:" à¨– à¨— à¨œ à¨¡  à¨«  ".split(" ")},kannada:{vowels:"à²… à²† à²‡ à²ˆ à²‰ à²Š à²‹ à³  à²Œ à³¡ à² à² à² à²’ à²“ à²”".split(" "),vowel_marks:"à²¾ à²¿ à³€ à³ à³‚ à³ƒ à³„ à³¢ à³£ à³† à³‡ à³ˆ à³Š à³‹ à³Œ".split(" "),other_marks:"à²‚ à²ƒ à¤".split(" "),virama:["à³"],consonants:"à²• à²– à²— à²˜ à²™ à²š à²› à²œ à² à² à²Ÿ à²  à²¡ à²¢ à²£ à²¤ à²¥ à²¦ à²§ à²¨ à²ª à²« à²¬ à²­ à²® à²¯ à²° à²² à²µ à²¶ à²· à²¸ à²¹ à²³".split(" "),symbols:"à³¦ à³§ à³¨ à³© à³ª à³« à³¬ à³­ à³® à³¯ à²“à²‚ à²½ à¥¤ à¥¥".split(" "),other:"      à²«  à²±".split(" ")},malayalam:{vowels:"à´… à´† à´‡ à´ˆ à´‰ à´Š à´‹ àµ  à´Œ àµ¡ à´ à´ à´ à´’ à´“ à´”".split(" "),vowel_marks:"à´¾ à´¿ àµ€ àµ àµ‚ àµƒ àµ„ àµ¢ àµ£ àµ† àµ‡ àµˆ àµŠ àµ‹ àµŒ".split(" "),other_marks:"à´‚ à´ƒ à¤".split(" "),virama:["àµ"],consonants:"à´• à´– à´— à´˜ à´™ à´š à´› à´œ à´ à´ à´Ÿ à´  à´¡ à´¢ à´£ à´¤ à´¥ à´¦ à´§ à´¨ à´ª à´« à´¬ à´­ à´® à´¯ à´° à´² à´µ à´¶ à´· à´¸ à´¹ à´³".split(" "),symbols:"àµ¦ àµ§ àµ¨ àµ© àµª àµ« àµ¬ àµ­ àµ® àµ¯ à´“à´‚ à´½ à¥¤ à¥¥".split(" "),other:"        à´±".split(" ")},oriya:{vowels:"à¬… à¬† à¬‡ à¬ˆ à¬‰ à¬Š à¬‹ à­  à¬Œ à­¡  à¬ à¬  à¬“ à¬”".split(" "),vowel_marks:"à¬¾ à¬¿ à­€ à­ à­‚ à­ƒ à­„ à­¢ à­£  à­‡ à­ˆ  à­‹ à­Œ".split(" "),other_marks:"à¬‚ à¬ƒ à¬".split(" "),virama:["à­"],consonants:"à¬• à¬– à¬— à¬˜ à¬™ à¬š à¬› à¬œ à¬ à¬ à¬Ÿ à¬  à¬¡ à¬¢ à¬£ à¬¤ à¬¥ à¬¦ à¬§ à¬¨ à¬ª à¬« à¬¬ à¬­ à¬® à¬¯ à¬° à¬² à¬µ à¬¶ à¬· à¬¸ à¬¹ à¬³".split(" "),symbols:"à­¦ à­§ à­¨ à­© à­ª à­« à­¬ à­­ à­® à­¯ à¬“à¬‚ à¬½ à¥¤ à¥¥".split(" "),other:"    à¬¡ à¬¢  à¬¯ ".split(" ")},tamil:{vowels:"à®… à®† à®‡ à®ˆ à®‰ à®Š     à® à® à® à®’ à®“ à®”".split(" "),vowel_marks:"à®¾ à®¿ à¯€ à¯ à¯‚     à¯† à¯‡ à¯ˆ à¯Š à¯‹ à¯Œ".split(" "),other_marks:"à®‚ à®ƒ ".split(" "),virama:["à¯"],consonants:"à®• à®• à®• à®• à®™ à®š à®š à®œ à®š à® à®Ÿ à®Ÿ à®Ÿ à®Ÿ à®£ à®¤ à®¤ à®¤ à®¤ à®¨ à®ª à®ª à®ª à®ª à®® à®¯ à®° à®² à®µ à®¶ à®· à®¸ à®¹ à®³".split(" "),symbols:"à¯¦ à¯§ à¯¨ à¯© à¯ª à¯« à¯¬ à¯­ à¯® à¯¯ à¯ à¤½ à¥¤ à¥¥".split(" "),other:"        à®±".split(" ")},telugu:{vowels:"à°… à°† à°‡ à°ˆ à°‰ à°Š à°‹ à±  à°Œ à±¡ à° à° à° à°’ à°“ à°”".split(" "),vowel_marks:"à°¾ à°¿ à±€ à± à±‚ à±ƒ à±„ à±¢ à±£ à±† à±‡ à±ˆ à±Š à±‹ à±Œ".split(" "),other_marks:"à°‚ à°ƒ à° á³² á³²".split(" "),virama:["à±"],consonants:"à°• à°– à°— à°˜ à°™ à°š à°› à°œ à° à° à°Ÿ à°  à°¡ à°¢ à°£ à°¤ à°¥ à°¦ à°§ à°¨ à°ª à°« à°¬ à°­ à°® à°¯ à°° à°² à°µ à°¶ à°· à°¸ à°¹ à°³".split(" "),symbols:"à±¦ à±§ à±¨ à±© à±ª à±« à±¬ à±­ à±® à±¯ à°“à°‚ à°½ à¥¤ à¥¥".split(" "),other:"        à°±".split(" ")},iast:{vowels:"a Ä i Ä« u Å« á¹› á¹ á¸· á¸¹ áº½ e ai Ãµ o au Ãª aÃ® Ã´ aÃ»".split(" "),other_marks:["á¹ƒ","á¸¥","mÌ","áº–","á¸«","oá¸¿"],virama:[""],consonants:"k kh g gh á¹… c ch j jh Ã± á¹­ á¹­h á¸ á¸h á¹‡ t th d dh n p ph b bh m y r l v Å› á¹£ s h á¸»".split(" "),symbols:"0 1 2 3 4 5 6 7 8 9 oá¹ ' | ||".split(" ")},iso:{vowels:"a Ä i Ä« u Å« rÌ¥ rÌ¥Ì„ lÌ¥ lÌ¥Ì„ áº½ e ai Ãµ o au Ãª aÃ® Ã´ aÃ»".split(" "),other_marks:["á¹","á¸¥","mÌ","oá¸¿"],virama:[""],consonants:"k kh g gh á¹… c ch j jh Ã± á¹­ á¹­h á¸ á¸h á¹‡ t th d dh n p ph b bh m y r l v Å› á¹£ s h á¸· ká¹£ jÃ±".split(" "),symbols:"0 1 2 3 4 5 6 7 8 9 omÌ ' | ||".split(" ")},itrans:{vowels:"a A i I u U RRi RRI LLi LLI  e ai  o au".split(" "),other_marks:["M","H",".N"],virama:[""],consonants:"k kh g gh ~N ch Ch j jh ~n T Th D Dh N t th d dh n p ph b bh m y r l v sh Sh s h L kSh j~n".split(" "),symbols:"0 1 2 3 4 5 6 7 8 9 OM .a | ||".split(" "),candra:[".c"],zwj:["{}"],skip:"_",accent:["\\'","\\_"],combo_accent:"\\'H \\_H \\'M \\_M".split(" "),other:"q K G z .D .Dh f Y R".split(" ")},hk:{vowels:"a A i I u U R RR lR lRR  e ai  o au".split(" "),other_marks:"M H ~".split(" "),virama:[""],consonants:"k kh g gh G c ch j jh J T Th D Dh N t th d dh n p ph b bh m y r l v z S s h L kS jJ".split(" "),symbols:"0 1 2 3 4 5 6 7 8 9 OM ' | ||".split(" ")},slp1:{vowels:"a A i I u U f F x X áº½ e E Ãµ o O Ãª ÃŠ Ã´ Ã”".split(" "),other_marks:"M H mÌ áº– á¸« oá¸¿".split(" "),virama:[""],consonants:"k K g G N c C j J Y w W q Q R t T d D n p P b B m y r l v S z s h L".split(" "),symbols:"0 1 2 3 4 5 6 7 8 9 oá¹ ' | ||".split(" ")},velthuis:{vowels:"a aa i ii u uu .r .rr .li .ll  e ai  o au".split(" "),other_marks:".m .h ".split(" "),virama:[""],consonants:'k kh g gh "n c ch j jh ~n .t .th .d .d .n t th d dh n p ph b bh m y r l v ~s .s s h L k.s j~n'.split(" "),symbols:"0 1 2 3 4 5 6 7 8 9 o.m ' | ||".split(" ")},wx:{vowels:"a A i I u U q Q L   e E  o O".split(" "),other_marks:"M H z".split(" "),virama:[""],consonants:"k K g G f c C j J F t T d D N w W x X n p P b B m y r l v S R s h  kR jF".split(" "),symbols:"0 1 2 3 4 5 6 7 8 9 oM ' | ||".split(" ")}},vn={},Wt={iast:{á¹›:["rÌ¥"],á¹ƒ:["á¹"]},itrans:{A:["aa"],I:["ii","ee"],U:["uu","oo"],RRi:["R^i"],RRI:["R^I"],LLi:["L^i"],LLI:["L^I"],M:[".m",".n"],"~N":["N^"],ch:["c"],Ch:["C","chh"],"~n":["JN"],v:["w"],Sh:["S","shh"],kSh:["kS","x"],"j~n":["GY","dny"],OM:["AUM"],"\\_":["\\`"],"\\_H":["\\`H"],"\\'M":["\\'.m","\\'.n"],"\\_M":"\\_.m \\_.n \\`M \\`.m \\`.n".split(" "),".a":["~"],"|":["."],"||":[".."],z:["J"]}},Bt={};tt.isRomanScheme=function(A){return vn.hasOwnProperty(A)};tt.addBrahmicScheme=function(A,C){tt.schemes[A]=C};tt.addRomanScheme=function(A,C){"vowel_marks"in C||(C.vowel_marks=C.vowels.slice(1)),tt.schemes[A]=C,vn[A]=!0};var yn=function(A){var C={};for(var M in A)!A.hasOwnProperty(M)||(C[M]=A[M].slice(0));return C};(function(){var A=zt.kolkata=yn(zt.iast),C="iast itrans hk kolkata slp1 velthuis wx".split(" ");A.vowels="a Ä i Ä« u Å« á¹› á¹ á¸· á¸¹ e Ä“ ai o Å au".split(" ");for(var M=0,G;G=C[M];M++)tt.addRomanScheme(G,zt[G]);var X=yn(zt.itrans);X.vowels="a A i I u U Ri RRI LLi LLi e E ai o O au".split(" "),X.vowel_marks=X.vowels.slice(1),Wt.itrans_dravidian=Wt.itrans,tt.addRomanScheme("itrans_dravidian",X)})();var qn=function(A,C){var M=Wt[A]||{},G={},X=tt.schemes[A],$={},I=[],l={},d=tt.schemes[C];for(var x in X)if(!!X.hasOwnProperty(x)){var B=X[x],Y=d[x];if(Y!==void 0)for(var U=0;U<B.length;U++){var F=B[U],T=Y[U],O=M[F]||[],ee=O.length,de=0;for(I.push(F.length),de=0;de<ee;de++)I.push(O[de].length);if(x==="vowel_marks"||x==="virama")for(l[F]=T,de=0;de<ee;de++)l[O[de]]=T;else{for($[F]=T,de=0;de<ee;de++)$[O[de]]=T;if(x==="consonants"||x==="other")for(G[F]=T,de=0;de<ee;de++)G[O[de]]=T}}}return{consonants:G,fromRoman:tt.isRomanScheme(A),letters:$,marks:l,maxTokenLength:Math.max.apply(Math,I),toRoman:tt.isRomanScheme(C),virama:d.virama}},zn=function(A,C,M){for(var G=[],X=C.consonants,$=A.length,I=!1,l=C.letters,d=C.marks,x=C.maxTokenLength,B=M.skip_sgml,Y=M.syncope,U,F,T="",O=C.toRoman,ee=C.virama,de=!1,Q=!1,W=!1,me=0,be;(be=A.charAt(me))||T;me++){var ke=x-T.length;if(!(ke>0&&me<$&&(T+=be,ke>1)))for(var se=0;se<x;se++){var Se=T.substr(0,x-se);if(de===!0)de=Se!==">";else if(Se==="<")de=B;else if(Se==="##"){W=!W,T=T.substr(2);break}if(Q=de||W,(U=l[Se])!==void 0&&!Q){O?G.push(U):(I?(F=d[Se])?G.push(F):Se!=="a"&&(G.push(ee),G.push(U)):G.push(U),I=Se in X),T=T.substr(x-se);break}else se===x-1&&(I&&(I=!1,Y||G.push(ee)),G.push(Se),T=T.substr(1))}}return I&&!Y&&G.push(ee),G.join("")},Fn=function(A,C){for(var M=[],G=C.consonants,X=!1,$=!1,I=C.letters,l=C.marks,d,x=C.toRoman,B=!1,Y=0,U;U=A.charAt(Y);Y++){if(U==="#"){X?(B=!B,X=!1):X=!0,$&&(M.push("a"),$=!1);continue}else if(B){M.push(U);continue}(d=l[U])!==void 0?(M.push(d),$=!1):(X&&(M.push("#"),X=!1),$&&(M.push("a"),$=!1),(d=I[U])?(M.push(d),$=x&&U in G):M.push(U))}return $&&M.push("a"),M.join("")};tt.t=function(A,C,M,G){G=G||{};var X=Bt.options||{},$=tt.defaults,I=Bt.from===C&&Bt.to===M,l;for(var d in $)if($.hasOwnProperty(d)){var x=$[d];d in G&&(x=G[d]),G[d]=x,x!==X[d]&&(I=!1)}return I?l=Bt.map:(l=qn(C,M,G),Bt={from:C,map:l,options:G,to:M}),C==="itrans"&&(A=A.replace(/\{\\m\+\}/g,".h.N"),A=A.replace(/\.h/g,""),A=A.replace(/\\([^'`_]|$)/g,"##$1##")),l.fromRoman?zn(A,l,G):Fn(A,l,G)};var bn=function(){let A=[{name:"valapalagilaka",search:"á¹™",replace:()=>"r"},{name:"short e",search:"áº½",replace:()=>"e"},{name:"short o",search:"Ãµ",replace:()=>"o"},{name:"pá¹›á¹£á¹­hamÄtrÄ e",search:"Ãª",replace:()=>"e"},{name:"pá¹›á¹£á¹­hamÄtrÄ o",search:"Ã´",replace:()=>"o"},{name:"pá¹›á¹£á¹­hamÄtrÄ ai",search:"ÃŠ",replace:()=>"E"},{name:"pá¹›á¹£á¹­hamÄtrÄ au",search:"Ã”",replace:()=>"O"},{name:"candrabindu",search:"mÌ",replace:()=>"M"},{name:"oá¹ƒkÄras",search:"oá¹",replace:()=>"oM"},{name:"additional punctuation",search:"[()\\[\\],;?!|_\\-=+\\d.'\\/]+",replace:()=>""},{name:"geminated aspirated consonants",search:"(?:kK|gG|cC|jJ|wW|qQ|tT|dD|pP|bB)",replace:I=>I[0].slice(-1)},{name:"geminated m after h",search:"(?:Mhm|hmm)",replace:()=>"hm"},{name:"geminated t",search:"([rfi]|p[aA])tt|tt(?=[rvy]\\S)",replace:I=>`${I[1]}t`},{name:"geminated consonants after r",search:"([rf]\\s*)([kgcjwqdpbRnmyvl])\\2{1,2}",replace:I=>`${I[1]}${I[2]}`},{name:"final nasal variants",search:"(?:M[lSs]|nn)(?!\\S)",replace:()=>"n"},{name:"internal nasal variants",search:"[mnNYR](?=[pPbBmdDtTnwWqQcCjJkKgG])",replace:()=>"M"},{name:"final anusvÄra variants",search:"M?[mN](?!\\S)|n(?=\\s+[tdn])|Y(?=\\s+[jc])",replace:()=>"M"},{name:"visarga aá¸¥ before voiced consonants",search:"(?<!\\sB)(?:a[Hr]|[o])(?=\\s+['gGjJqQdDnbBmrylvh])",replace:()=>"aH"},{name:"visarga aá¸¥ before vowels",search:"aH(?=\\s+[AiIeuUof])",replace:()=>"a"},{name:"visarga aá¸¥ before unvoiced consonants and space + anusvÄra",search:"o\\s+(?=[kKcCwWtTpPszSM])",replace:()=>"aH a"},{name:"visarga Äá¸¥ variants",search:"AH(?=\\s+[aAiIeEuUogGjJqQdDbBnmyrlvh])",replace:()=>"A"},{name:"other visarga variants",search:"H?[rszS](?!\\S)",replace:()=>"H"},{name:"avagrahas",search:"'",replace:()=>"a"},{name:"internal visarga variants",search:"z(?=[kK])|s(?=s)",replace:()=>"H"},{name:"final au/Äv",search:"Av(?!\\S)",replace:()=>"O"},{name:"final su",search:"(?<=[sz])v(?=\\s+[aAiIuUoOeE])",replace:()=>"u"},{name:"final i",search:"i(?=\\s+[aAuUoOeE])",replace:()=>"y"},{name:"kcch/kÅ›",search:"k(\\s*)(?:S|c?C)",replace:I=>`k${I[1]}S`},{name:"cÅ›/tÅ›",search:"[tc](\\s*)S",replace:I=>`c${I[1]}C`},{name:"cch/ch",search:"([aAiIuUeEoO])C",replace:I=>`${I[1]}cC`},{name:"final t + hi",search:"d(\\s+)D(?=[iy](?:\\s|$))",replace:I=>`t${I[1]}h`},{name:"final t + voiced syllable",search:"d(?=(?:\\s+[aAiIeEuUoOgGdDbByrv]|\\s*$))",replace:()=>"t"},{name:"final t + n/m",search:"([ai])n(?=\\s+[nm])",replace:I=>`${I[1]}t`},{name:"final t + c/j",search:"j(?=\\s+j)|c(?=\\s+c)",replace:()=>"t"},{name:"i/y + vowel",search:"y(?=\\s+[aAuUeEoO])",replace:()=>"i"},{name:"bhd for bdh",search:"Bd",replace:()=>"bD"}],C=[{name:"valapalagilaka",search:"á¹™",replace:()=>"r"},{name:"short e",search:"áº½",replace:()=>"e"},{name:"short o",search:"Ãµ",replace:()=>"o"},{name:"pá¹›á¹£á¹­hamÄtrÄ e",search:"Ãª",replace:()=>"e"},{name:"pá¹›á¹£á¹­hamÄtrÄ o",search:"Ã´",replace:()=>"o"},{name:"pá¹›á¹£á¹­hamÄtrÄ ai",search:"aÃ®",replace:()=>"ai"},{name:"pá¹›á¹£á¹­hamÄtrÄ au",search:"aÃ»",replace:()=>"au"},{name:"candrabindu",search:"mÌ",replace:()=>"á¹ƒ"},{name:"oá¹ƒkÄras",search:"oá¹",replace:()=>"oá¹ƒ"},{name:"additional punctuation",search:"[()\\[\\],;?!|_\\-=+\\d.'\\/]+",replace:()=>""},{name:"geminated aspirated consonants",search:"([kgcjá¹­á¸tdpb]){2}h",replace:I=>`${I[1]}h`},{name:"geminated m after h",search:"(?:á¹ƒhm|hmm)",replace:()=>"hm"},{name:"geminated t",search:"([rá¹›i]|p[aÄ])tt|tt(?=[rvy]\\S)",replace:I=>`${I[1]}t`},{name:"geminated consonants after r",search:"([rá¹›]\\s*)([kgcjá¹­á¸á¹‡tdnpbmyvl])\\2{1,2}",replace:I=>`${I[1]}${I[2]}`},{name:"final nasal variants",search:"(?:á¹ƒ[lá¹£s]|nn)(?!\\S)",replace:()=>"n"},{name:"internal nasal variants",search:"[mná¹…Ã±á¹‡](?=[pbmdtná¹­á¸cjkg])",replace:()=>"á¹ƒ"},{name:"final anusvÄra variants",search:"á¹ƒ?[má¹…](?!\\S)|n(?=\\s+[tdn])|Ã±(?=\\s+[jc])",replace:()=>"á¹ƒ"},{name:"visarga aá¸¥ before voiced consonants",search:"(?:a[á¸¥r]|[o])(?=\\s+['gjá¸dnbmyrlvh])",replace:()=>"aá¸¥"},{name:"visarga aá¸¥ before vowels",search:"aá¸¥(?=\\s+[ÄiÄ«euÅ«oá¹›])",replace:()=>"a"},{name:"visarga aá¸¥ before unvoiced consonants and space + anusvÄra",search:"o\\s+(?=[kcá¹­tpÅ›á¹£sá¹ƒ])",replace:()=>"aá¸¥ a"},{name:"visarga Äá¸¥ variants",search:"Äá¸¥(?=\\s+[aÄiÄ«euÅ«ogjá¸dnbmyrlvh])",replace:()=>"Ä"},{name:"other visarga variants",search:"á¸¥?[rÅ›á¹£s](?!\\S)",replace:()=>"á¸¥"},{name:"avagrahas",search:"'",replace:()=>"a"},{name:"internal visarga variants",search:"á¹£(?=k)|s(?=s)",replace:()=>"s"},{name:"final au/Äv",search:"Äv(?!\\S)",replace:()=>"au"},{name:"final su",search:"(?<=[sá¹£])v(?=\\s+[aÄiÄ«uÅ«oe])",replace:()=>"u"},{name:"final i",search:"i(?=\\s+[aÄuÅ«eo])",replace:()=>"y"},{name:"kcch/kÅ›",search:"k(\\s*)(?:Å›|c?ch)",replace:I=>`k${I[1]}Å›`},{name:"cÅ›/tÅ›",search:"[tc](\\s*)Å›",replace:I=>`c${I[1]}ch`},{name:"cch/ch",search:"([aÄiÄ«uÅ«eo])ch",replace:I=>`${I[1]}cch`},{name:"final t + hi",search:"d(\\s+)dh(?=[iy](?:\\s|$))",replace:I=>`t${I[1]}h`},{name:"final t + voiced syllable",search:"d(?=(?:\\s+[aÄiÄ«euÅ«ogdbyrv]|\\s*$))",replace:()=>"t"},{name:"final t + n/m",search:"([ai])n(?=\\s+[nm])",replace:I=>`${I[1]}t`},{name:"final t + c/j",search:"j(?=\\s+j)|c(?=\\s+c)",replace:()=>"t"},{name:"i/y + vowel",search:"y(?=\\s+[aÄuÅ«eo])",replace:()=>"i"},{name:"bhd for bdh",search:"bhd",replace:()=>"bdh"}],M={none:{name:"remove spaces",search:"\\s",replace:()=>""},collapse:{name:"collapse spaces",search:"\\s+",replace:()=>" "}},G=function(I,l){let d=l.join(""),x=[],B=[...d.matchAll(I.search)],Y=0,U=null;for(let F of l){let T=Y+F.length,O=F,ee=0;if(U)if(U.length<=F.length)O=X(F,0,U.length,U.text),ee=U.text.length-U.length,U=null;else{O=U.text.slice(0,F.length);let Q=U.text.slice(F.length);U={length:U.length-F.length,text:Q};continue}for(;B.length>0&&B[0].index<T;){let de=B.shift(),Q=de.index-Y+ee,W=I.replace(de);if(de.index+de[0].length<T)O=X(O,Q,de[0].length,W),ee=ee+W.length-de[0].length;else{let me=F.length-Q+ee,be=W.slice(0,me);O=O.slice(0,Q)+be;let ke=W.slice(me);U={length:de[0].length-me,text:ke}}}x.push(O),Y=T}return x},X=function(I,l,d,x){return I.slice(0,l)+x+I.slice(l+d)};return function(I){let l=I.map(d=>tt.t(d,"iast","slp1"));for(let d of[...A,M.none])l=G(d,l);return l.map(d=>tt.t(d,"slp1","iast"))}}();var Yt={};(function(A){"use strict";A.__type__="csv";var C=typeof jQuery!="undefined"&&jQuery.Deferred||typeof _!="undefined"&&_.Deferred||function(){var l,d,x=new Promise(function(B,Y){l=B,d=Y});return{resolve:l,reject:d,promise:function(){return x}}};A.fetch=function(l){var d=new C;if(l.file){var x=new FileReader,B=l.encoding||"UTF-8";x.onload=function(F){var T=A.extractFields(A.parse(F.target.result,l),l);T.useMemoryStore=!0,T.metadata={filename:l.file.name},d.resolve(T)},x.onerror=function(F){d.reject({error:{message:"Failed to load file. Code: "+F.target.error.code}})},x.readAsText(l.file,B)}else if(l.data){var Y=A.extractFields(A.parse(l.data,l),l);Y.useMemoryStore=!0,d.resolve(Y)}else if(l.url){var U=window.fetch||function(F){var T=jQuery.get(F),O={then:function(ee){return T.done(ee),O},catch:function(ee){return T.fail(ee),O}};return O};U(l.url).then(function(F){return F.text?F.text():F}).then(function(F){var T=A.extractFields(A.parse(F,l),l);T.useMemoryStore=!0,d.resolve(T)}).catch(function(F,T){d.reject({error:{message:"Failed to load file. "+F.statusText+". Code: "+F.status,request:F}})})}return d.promise()},A.extractFields=function(l,d){return d.noHeaderRow!==!0&&l.length>0?{fields:l[0],records:l.slice(1)}:{records:l}},A.normalizeDialectOptions=function(l){var d={delimiter:",",doublequote:!0,lineterminator:`
`,quotechar:'"',skipinitialspace:!0,skipinitialrows:0};for(var x in l)x==="trim"?d.skipinitialspace=l.trim:d[x.toLowerCase()]=l[x];return d},A.parse=function(l,d){(!d||d&&!d.lineterminator)&&(l=A.normalizeLineTerminator(l,d));var x=A.normalizeDialectOptions(d);l=I(l,x.lineterminator);var B="",Y=!1,U=!1,F="",T=[],O=[],ee,de;for(de=function(Q){return U!==!0&&(Q===""?Q=null:x.skipinitialspace===!0&&(Q=$(Q)),M.test(Q)?Q=parseInt(Q,10):G.test(Q)&&(Q=parseFloat(Q,10))),Q},ee=0;ee<l.length;ee+=1)B=l.charAt(ee),Y===!1&&(B===x.delimiter||B===x.lineterminator)?(F=de(F),T.push(F),B===x.lineterminator&&(O.push(T),T=[]),F="",U=!1):B!==x.quotechar?F+=B:Y?l.charAt(ee+1)===x.quotechar?(F+=x.quotechar,ee+=1):Y=!1:(Y=!0,U=!0);return F=de(F),T.push(F),O.push(T),x.skipinitialrows&&(O=O.slice(x.skipinitialrows)),O},A.normalizeLineTerminator=function(l,d){return d=d||{},d.lineterminator?l:l.replace(/(\r\n|\n|\r)/gm,`
`)},A.objectToArray=function(l){for(var d=[],x=[],B=[],Y=0;Y<l.fields.length;Y++){var U=l.fields[Y].id;B.push(U);var F=l.fields[Y].label?l.fields[Y].label:U;x.push(F)}d.push(x);for(var Y=0;Y<l.records.length;Y++){for(var T=[],O=l.records[Y],ee=0;ee<B.length;ee++)T.push(O[B[ee]]);d.push(T)}return d},A.serialize=function(l,d){var x=null;l instanceof Array?x=l:x=A.objectToArray(l);var B=A.normalizeDialectOptions(d),Y="",U="",F="",T="",O,ee,de;for(de=function(Q){return Q===null?Q="":typeof Q=="string"&&X.test(Q)?(B.doublequote&&(Q=Q.replace(/"/g,'""')),Q=B.quotechar+Q+B.quotechar):typeof Q=="number"&&(Q=Q.toString(10)),Q},O=0;O<x.length;O+=1)for(Y=x[O],ee=0;ee<Y.length;ee+=1)U=de(Y[ee]),ee===Y.length-1?(F+=U,T+=F+B.lineterminator,F=""):F+=U+B.delimiter,U="";return T};var M=/^\d+$/,G=/^\d*\.\d+$|^\d+\.\d*$/,X=/^\s|\s$|,|"|\n/,$=function(){return String.prototype.trim?function(l){return l.trim()}:function(l){return l.replace(/^\s*/,"").replace(/\s*$/,"")}}();function I(l,d){return l.charAt(l.length-d.length)!==d?l:l.substring(0,l.length-d.length)}})(Yt);function On(A){return A&&A.__esModule&&Object.prototype.hasOwnProperty.call(A,"default")?A.default:A}function $n(A,C,M){return M={path:C,exports:{},require:function(G,X){return Hn(G,X==null?M.path:X)}},A(M,M.exports),M.exports}function Hn(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}var Vn=$n(function(A,C){(function(M,G){A.exports=G()})(window,function(){return function(M){var G={};function X($){if(G[$])return G[$].exports;var I=G[$]={i:$,l:!1,exports:{}};return M[$].call(I.exports,I,I.exports,X),I.l=!0,I.exports}return X.m=M,X.c=G,X.d=function($,I,l){X.o($,I)||Object.defineProperty($,I,{enumerable:!0,get:l})},X.r=function($){typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty($,Symbol.toStringTag,{value:"Module"}),Object.defineProperty($,"__esModule",{value:!0})},X.t=function($,I){if(1&I&&($=X($)),8&I||4&I&&typeof $=="object"&&$&&$.__esModule)return $;var l=Object.create(null);if(X.r(l),Object.defineProperty(l,"default",{enumerable:!0,value:$}),2&I&&typeof $!="string")for(var d in $)X.d(l,d,function(x){return $[x]}.bind(null,d));return l},X.n=function($){var I=$&&$.__esModule?function(){return $.default}:function(){return $};return X.d(I,"a",I),I},X.o=function($,I){return Object.prototype.hasOwnProperty.call($,I)},X.p="",X(X.s=1)}([function(M,G,X){var $,I;$=[X(2)],(I=function(l){function d(e){if(d.is(e,"function"))return x?e():l.on("raphael.DOMload",e);if(d.is(e,pe))return d._engine.create[Q](d,e.splice(0,3+d.is(e[0],te))).add(e);var t=Array.prototype.slice.call(arguments,0);if(d.is(t[t.length-1],"function")){var s=t.pop();return x?s.call(d._engine.create[Q](d,t)):l.on("raphael.DOMload",function(){s.call(d._engine.create[Q](d,t))})}return d._engine.create[Q](d,arguments)}d.version="2.3.0",d.eve=l;var x,B,Y=/[, ]+/,U={circle:1,rect:1,path:1,ellipse:1,text:1,image:1},F=/\{(\d+)\}/g,T="hasOwnProperty",O={doc:document,win:window},ee={was:Object.prototype[T].call(O.win,"Raphael"),is:O.win.Raphael},de=function(){this.ca=this.customAttributes={}},Q="apply",W="concat",me="ontouchstart"in window||window.TouchEvent||window.DocumentTouch&&document instanceof DocumentTouch,be="",ke=" ",se=String,Se="split",Ie="click dblclick mousedown mousemove mouseout mouseover mouseup touchstart touchmove touchend touchcancel"[Se](ke),We={mousedown:"touchstart",mousemove:"touchmove",mouseup:"touchend"},De=se.prototype.toLowerCase,Ee=Math,qe=Ee.max,Z=Ee.min,Re=Ee.abs,Me=Ee.pow,ue=Ee.PI,te="number",pe="array",Ce=Object.prototype.toString,p=(d._ISURL=/^url\(['"]?(.+?)['"]?\)$/i,/^\s*((#[a-f\d]{6})|(#[a-f\d]{3})|rgba?\(\s*([\d\.]+%?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+%?(?:\s*,\s*[\d\.]+%?)?)\s*\)|hsba?\(\s*([\d\.]+(?:deg|\xb0|%)?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+(?:%?\s*,\s*[\d\.]+)?)%?\s*\)|hsla?\(\s*([\d\.]+(?:deg|\xb0|%)?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+(?:%?\s*,\s*[\d\.]+)?)%?\s*\))\s*$/i),u={NaN:1,Infinity:1,"-Infinity":1},c=/^(?:cubic-)?bezier\(([^,]+),([^,]+),([^,]+),([^\)]+)\)/,g=Ee.round,S=parseFloat,N=parseInt,H=se.prototype.toUpperCase,ne=d._availableAttrs={"arrow-end":"none","arrow-start":"none",blur:0,"clip-rect":"0 0 1e9 1e9",cursor:"default",cx:0,cy:0,fill:"#fff","fill-opacity":1,font:'10px "Arial"',"font-family":'"Arial"',"font-size":"10","font-style":"normal","font-weight":400,gradient:0,height:0,href:"http://raphaeljs.com/","letter-spacing":0,opacity:1,path:"M0,0",r:0,rx:0,ry:0,src:"",stroke:"#000","stroke-dasharray":"","stroke-linecap":"butt","stroke-linejoin":"butt","stroke-miterlimit":0,"stroke-opacity":1,"stroke-width":1,target:"_blank","text-anchor":"middle",title:"Raphael",transform:"",width:0,x:0,y:0,class:""},j=d._availableAnimAttrs={blur:te,"clip-rect":"csv",cx:te,cy:te,fill:"colour","fill-opacity":te,"font-size":te,height:te,opacity:te,path:"path",r:te,rx:te,ry:te,stroke:"colour","stroke-opacity":te,"stroke-width":te,transform:"transform",width:te,x:te,y:te},K=/[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*/,ie={hs:1,rg:1},E=/,?([achlmqrstvxz]),?/gi,Pe=/([achlmrqstvz])[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029,]*((-?\d*\.?\d*(?:e[\-+]?\d+)?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*)+)/gi,L=/([rstm])[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029,]*((-?\d*\.?\d*(?:e[\-+]?\d+)?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*)+)/gi,Ae=/(-?\d*\.?\d*(?:e[\-+]?\d+)?)[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*/gi,He=(d._radial_gradient=/^r(?:\(([^,]+?)[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*([^\)]+?)\))?/,{}),$e=function(e,t){return S(e)-S(t)},Ye=function(e){return e},Fe=d._rectPath=function(e,t,s,i,h){return h?[["M",e+h,t],["l",s-2*h,0],["a",h,h,0,0,1,h,h],["l",0,i-2*h],["a",h,h,0,0,1,-h,h],["l",2*h-s,0],["a",h,h,0,0,1,-h,-h],["l",0,2*h-i],["a",h,h,0,0,1,h,-h],["z"]]:[["M",e,t],["l",s,0],["l",0,i],["l",-s,0],["z"]]},et=function(e,t,s,i){return i==null&&(i=s),[["M",e,t],["m",0,-i],["a",s,i,0,1,1,0,2*i],["a",s,i,0,1,1,0,-2*i],["z"]]},nt=d._getPath={path:function(e){return e.attr("path")},circle:function(e){var t=e.attrs;return et(t.cx,t.cy,t.r)},ellipse:function(e){var t=e.attrs;return et(t.cx,t.cy,t.rx,t.ry)},rect:function(e){var t=e.attrs;return Fe(t.x,t.y,t.width,t.height,t.r)},image:function(e){var t=e.attrs;return Fe(t.x,t.y,t.width,t.height)},text:function(e){var t=e._getBBox();return Fe(t.x,t.y,t.width,t.height)},set:function(e){var t=e._getBBox();return Fe(t.x,t.y,t.width,t.height)}},at=d.mapPath=function(e,t){if(!t)return e;var s,i,h,m,w,b,k;for(h=0,w=(e=mt(e)).length;h<w;h++)for(m=1,b=(k=e[h]).length;m<b;m+=2)s=t.x(k[m],k[m+1]),i=t.y(k[m],k[m+1]),k[m]=s,k[m+1]=i;return e};if(d._g=O,d.type=O.win.SVGAngle||O.doc.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1")?"SVG":"VML",d.type=="VML"){var Ke,n=O.doc.createElement("div");if(n.innerHTML='<v:shape adj="1"/>',(Ke=n.firstChild).style.behavior="url(#default#VML)",!Ke||typeof Ke.adj!="object")return d.type=be;n=null}function r(e){if(typeof e=="function"||Object(e)!==e)return e;var t=new e.constructor;for(var s in e)e[T](s)&&(t[s]=r(e[s]));return t}d.svg=!(d.vml=d.type=="VML"),d._Paper=de,d.fn=B=de.prototype=d.prototype,d._id=0,d.is=function(e,t){return(t=De.call(t))=="finite"?!u[T](+e):t=="array"?e instanceof Array:t=="null"&&e===null||t==typeof e&&e!==null||t=="object"&&e===Object(e)||t=="array"&&Array.isArray&&Array.isArray(e)||Ce.call(e).slice(8,-1).toLowerCase()==t},d.angle=function(e,t,s,i,h,m){if(h==null){var w=e-s,b=t-i;return w||b?(180+180*Ee.atan2(-b,-w)/ue+360)%360:0}return d.angle(e,t,h,m)-d.angle(s,i,h,m)},d.rad=function(e){return e%360*ue/180},d.deg=function(e){return Math.round(180*e/ue%360*1e3)/1e3},d.snapTo=function(e,t,s){if(s=d.is(s,"finite")?s:10,d.is(e,pe)){for(var i=e.length;i--;)if(Re(e[i]-t)<=s)return e[i]}else{var h=t%(e=+e);if(h<s)return t-h;if(h>e-s)return t-h+e}return t};var a,o;d.createUUID=(a=/[xy]/g,o=function(e){var t=16*Ee.random()|0;return(e=="x"?t:3&t|8).toString(16)},function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(a,o).toUpperCase()}),d.setWindow=function(e){l("raphael.setWindow",d,O.win,e),O.win=e,O.doc=O.win.document,d._engine.initWin&&d._engine.initWin(O.win)};var f=function(e){if(d.vml){var t,s=/^\s+|\s+$/g;try{var i=new ActiveXObject("htmlfile");i.write("<body>"),i.close(),t=i.body}catch(w){t=createPopup().document.body}var h=t.createTextRange();f=J(function(w){try{t.style.color=se(w).replace(s,be);var b=h.queryCommandValue("ForeColor");return"#"+("000000"+(b=(255&b)<<16|65280&b|(16711680&b)>>>16).toString(16)).slice(-6)}catch(k){return"none"}})}else{var m=O.doc.createElement("i");m.title="RaphaÃ«l Colour Picker",m.style.display="none",O.doc.body.appendChild(m),f=J(function(w){return m.style.color=w,O.doc.defaultView.getComputedStyle(m,be).getPropertyValue("color")})}return f(e)},v=function(){return"hsb("+[this.h,this.s,this.b]+")"},P=function(){return"hsl("+[this.h,this.s,this.l]+")"},z=function(){return this.hex},D=function(e,t,s){if(t==null&&d.is(e,"object")&&"r"in e&&"g"in e&&"b"in e&&(s=e.b,t=e.g,e=e.r),t==null&&d.is(e,"string")){var i=d.getRGB(e);e=i.r,t=i.g,s=i.b}return(e>1||t>1||s>1)&&(e/=255,t/=255,s/=255),[e,t,s]},V=function(e,t,s,i){var h={r:e*=255,g:t*=255,b:s*=255,hex:d.rgb(e,t,s),toString:z};return d.is(i,"finite")&&(h.opacity=i),h};function J(e,t,s){return function i(){var h=Array.prototype.slice.call(arguments,0),m=h.join("â€"),w=i.cache=i.cache||{},b=i.count=i.count||[];return w[T](m)?(function(k,q){for(var ae=0,ge=k.length;ae<ge;ae++)if(k[ae]===q)return k.push(k.splice(ae,1)[0])}(b,m),s?s(w[m]):w[m]):(b.length>=1e3&&delete w[b.shift()],b.push(m),w[m]=e[Q](t,h),s?s(w[m]):w[m])}}d.color=function(e){var t;return d.is(e,"object")&&"h"in e&&"s"in e&&"b"in e?(t=d.hsb2rgb(e),e.r=t.r,e.g=t.g,e.b=t.b,e.hex=t.hex):d.is(e,"object")&&"h"in e&&"s"in e&&"l"in e?(t=d.hsl2rgb(e),e.r=t.r,e.g=t.g,e.b=t.b,e.hex=t.hex):(d.is(e,"string")&&(e=d.getRGB(e)),d.is(e,"object")&&"r"in e&&"g"in e&&"b"in e?(t=d.rgb2hsl(e),e.h=t.h,e.s=t.s,e.l=t.l,t=d.rgb2hsb(e),e.v=t.b):(e={hex:"none"}).r=e.g=e.b=e.h=e.s=e.v=e.l=-1),e.toString=z,e},d.hsb2rgb=function(e,t,s,i){var h,m,w,b,k;return this.is(e,"object")&&"h"in e&&"s"in e&&"b"in e&&(s=e.b,t=e.s,i=e.o,e=e.h),b=(k=s*t)*(1-Re((e=(e*=360)%360/60)%2-1)),h=m=w=s-k,V(h+=[k,b,0,0,b,k][e=~~e],m+=[b,k,k,b,0,0][e],w+=[0,0,b,k,k,b][e],i)},d.hsl2rgb=function(e,t,s,i){var h,m,w,b,k;return this.is(e,"object")&&"h"in e&&"s"in e&&"l"in e&&(s=e.l,t=e.s,e=e.h),(e>1||t>1||s>1)&&(e/=360,t/=100,s/=100),b=(k=2*t*(s<.5?s:1-s))*(1-Re((e=(e*=360)%360/60)%2-1)),h=m=w=s-k/2,V(h+=[k,b,0,0,b,k][e=~~e],m+=[b,k,k,b,0,0][e],w+=[0,0,b,k,k,b][e],i)},d.rgb2hsb=function(e,t,s){var i,h;return e=(s=D(e,t,s))[0],t=s[1],s=s[2],{h:(((h=(i=qe(e,t,s))-Z(e,t,s))==0?null:i==e?(t-s)/h:i==t?(s-e)/h+2:(e-t)/h+4)+360)%6*60/360,s:h==0?0:h/i,b:i,toString:v}},d.rgb2hsl=function(e,t,s){var i,h,m,w;return e=(s=D(e,t,s))[0],t=s[1],s=s[2],i=((h=qe(e,t,s))+(m=Z(e,t,s)))/2,{h:(((w=h-m)==0?null:h==e?(t-s)/w:h==t?(s-e)/w+2:(e-t)/w+4)+360)%6*60/360,s:w==0?0:i<.5?w/(2*i):w/(2-2*i),l:i,toString:P}},d._path2string=function(){return this.join(",").replace(E,"$1")},d._preload=function(e,t){var s=O.doc.createElement("img");s.style.cssText="position:absolute;left:-9999em;top:-9999em",s.onload=function(){t.call(this),this.onload=null,O.doc.body.removeChild(this)},s.onerror=function(){O.doc.body.removeChild(this)},O.doc.body.appendChild(s),s.src=e};function oe(){return this.hex}function we(e,t){for(var s=[],i=0,h=e.length;h-2*!t>i;i+=2){var m=[{x:+e[i-2],y:+e[i-1]},{x:+e[i],y:+e[i+1]},{x:+e[i+2],y:+e[i+3]},{x:+e[i+4],y:+e[i+5]}];t?i?h-4==i?m[3]={x:+e[0],y:+e[1]}:h-2==i&&(m[2]={x:+e[0],y:+e[1]},m[3]={x:+e[2],y:+e[3]}):m[0]={x:+e[h-2],y:+e[h-1]}:h-4==i?m[3]=m[2]:i||(m[0]={x:+e[i],y:+e[i+1]}),s.push(["C",(-m[0].x+6*m[1].x+m[2].x)/6,(-m[0].y+6*m[1].y+m[2].y)/6,(m[1].x+6*m[2].x-m[3].x)/6,(m[1].y+6*m[2].y-m[3].y)/6,m[2].x,m[2].y])}return s}d.getRGB=J(function(e){if(!e||(e=se(e)).indexOf("-")+1)return{r:-1,g:-1,b:-1,hex:"none",error:1,toString:oe};if(e=="none")return{r:-1,g:-1,b:-1,hex:"none",toString:oe};!ie[T](e.toLowerCase().substring(0,2))&&e.charAt()!="#"&&(e=f(e));var t,s,i,h,m,w,b=e.match(p);return b?(b[2]&&(i=N(b[2].substring(5),16),s=N(b[2].substring(3,5),16),t=N(b[2].substring(1,3),16)),b[3]&&(i=N((m=b[3].charAt(3))+m,16),s=N((m=b[3].charAt(2))+m,16),t=N((m=b[3].charAt(1))+m,16)),b[4]&&(w=b[4][Se](K),t=S(w[0]),w[0].slice(-1)=="%"&&(t*=2.55),s=S(w[1]),w[1].slice(-1)=="%"&&(s*=2.55),i=S(w[2]),w[2].slice(-1)=="%"&&(i*=2.55),b[1].toLowerCase().slice(0,4)=="rgba"&&(h=S(w[3])),w[3]&&w[3].slice(-1)=="%"&&(h/=100)),b[5]?(w=b[5][Se](K),t=S(w[0]),w[0].slice(-1)=="%"&&(t*=2.55),s=S(w[1]),w[1].slice(-1)=="%"&&(s*=2.55),i=S(w[2]),w[2].slice(-1)=="%"&&(i*=2.55),(w[0].slice(-3)=="deg"||w[0].slice(-1)=="Â°")&&(t/=360),b[1].toLowerCase().slice(0,4)=="hsba"&&(h=S(w[3])),w[3]&&w[3].slice(-1)=="%"&&(h/=100),d.hsb2rgb(t,s,i,h)):b[6]?(w=b[6][Se](K),t=S(w[0]),w[0].slice(-1)=="%"&&(t*=2.55),s=S(w[1]),w[1].slice(-1)=="%"&&(s*=2.55),i=S(w[2]),w[2].slice(-1)=="%"&&(i*=2.55),(w[0].slice(-3)=="deg"||w[0].slice(-1)=="Â°")&&(t/=360),b[1].toLowerCase().slice(0,4)=="hsla"&&(h=S(w[3])),w[3]&&w[3].slice(-1)=="%"&&(h/=100),d.hsl2rgb(t,s,i,h)):((b={r:t,g:s,b:i,toString:oe}).hex="#"+(16777216|i|s<<8|t<<16).toString(16).slice(1),d.is(h,"finite")&&(b.opacity=h),b)):{r:-1,g:-1,b:-1,hex:"none",error:1,toString:oe}},d),d.hsb=J(function(e,t,s){return d.hsb2rgb(e,t,s).hex}),d.hsl=J(function(e,t,s){return d.hsl2rgb(e,t,s).hex}),d.rgb=J(function(e,t,s){function i(h){return h+.5|0}return"#"+(16777216|i(s)|i(t)<<8|i(e)<<16).toString(16).slice(1)}),d.getColor=function(e){var t=this.getColor.start=this.getColor.start||{h:0,s:1,b:e||.75},s=this.hsb2rgb(t.h,t.s,t.b);return t.h+=.075,t.h>1&&(t.h=0,t.s-=.2,t.s<=0&&(this.getColor.start={h:0,s:1,b:t.b})),s.hex},d.getColor.reset=function(){delete this.start},d.parsePathString=function(e){if(!e)return null;var t=Le(e);if(t.arr)return Je(t.arr);var s={a:7,c:6,h:1,l:2,m:2,r:4,q:4,s:4,t:2,v:1,z:0},i=[];return d.is(e,pe)&&d.is(e[0],pe)&&(i=Je(e)),i.length||se(e).replace(Pe,function(h,m,w){var b=[],k=m.toLowerCase();if(w.replace(Ae,function(q,ae){ae&&b.push(+ae)}),k=="m"&&b.length>2&&(i.push([m][W](b.splice(0,2))),k="l",m=m=="m"?"l":"L"),k=="r")i.push([m][W](b));else for(;b.length>=s[k]&&(i.push([m][W](b.splice(0,s[k]))),s[k]););}),i.toString=d._path2string,t.arr=Je(i),i},d.parseTransformString=J(function(e){if(!e)return null;var t=[];return d.is(e,pe)&&d.is(e[0],pe)&&(t=Je(e)),t.length||se(e).replace(L,function(s,i,h){var m=[];De.call(i),h.replace(Ae,function(w,b){b&&m.push(+b)}),t.push([i][W](m))}),t.toString=d._path2string,t},this,function(e){if(!e)return e;for(var t=[],s=0;s<e.length;s++){for(var i=[],h=0;h<e[s].length;h++)i.push(e[s][h]);t.push(i)}return t});var Le=function(e){var t=Le.ps=Le.ps||{};return t[e]?t[e].sleep=100:t[e]={sleep:100},setTimeout(function(){for(var s in t)t[T](s)&&s!=e&&(t[s].sleep--,!t[s].sleep&&delete t[s])}),t[e]};function Be(e,t,s,i,h){return e*(e*(-3*t+9*s-9*i+3*h)+6*t-12*s+6*i)-3*t+3*s}function Te(e,t,s,i,h,m,w,b,k){k==null&&(k=1);for(var q=(k=k>1?1:k<0?0:k)/2,ae=[-.1252,.1252,-.3678,.3678,-.5873,.5873,-.7699,.7699,-.9041,.9041,-.9816,.9816],ge=[.2491,.2491,.2335,.2335,.2032,.2032,.1601,.1601,.1069,.1069,.0472,.0472],ce=0,re=0;re<12;re++){var he=q*ae[re]+q,xe=Be(he,e,s,h,w),fe=Be(he,t,i,m,b),le=xe*xe+fe*fe;ce+=ge[re]*Ee.sqrt(le)}return q*ce}function ze(e,t,s,i,h,m,w,b){if(!(qe(e,s)<Z(h,w)||Z(e,s)>qe(h,w)||qe(t,i)<Z(m,b)||Z(t,i)>qe(m,b))){var k=(e-s)*(m-b)-(t-i)*(h-w);if(k){var q=((e*i-t*s)*(h-w)-(e-s)*(h*b-m*w))/k,ae=((e*i-t*s)*(m-b)-(t-i)*(h*b-m*w))/k,ge=+q.toFixed(2),ce=+ae.toFixed(2);if(!(ge<+Z(e,s).toFixed(2)||ge>+qe(e,s).toFixed(2)||ge<+Z(h,w).toFixed(2)||ge>+qe(h,w).toFixed(2)||ce<+Z(t,i).toFixed(2)||ce>+qe(t,i).toFixed(2)||ce<+Z(m,b).toFixed(2)||ce>+qe(m,b).toFixed(2)))return{x:q,y:ae}}}}function Ue(e,t,s){var i=d.bezierBBox(e),h=d.bezierBBox(t);if(!d.isBBoxIntersect(i,h))return s?0:[];for(var m=Te.apply(0,e),w=Te.apply(0,t),b=qe(~~(m/5),1),k=qe(~~(w/5),1),q=[],ae=[],ge={},ce=s?0:[],re=0;re<b+1;re++){var he=d.findDotsAtSegment.apply(d,e.concat(re/b));q.push({x:he.x,y:he.y,t:re/b})}for(re=0;re<k+1;re++)he=d.findDotsAtSegment.apply(d,t.concat(re/k)),ae.push({x:he.x,y:he.y,t:re/k});for(re=0;re<b;re++)for(var xe=0;xe<k;xe++){var fe=q[re],le=q[re+1],Ne=ae[xe],ve=ae[xe+1],_e=Re(le.x-fe.x)<.001?"y":"x",ye=Re(ve.x-Ne.x)<.001?"y":"x",je=ze(fe.x,fe.y,le.x,le.y,Ne.x,Ne.y,ve.x,ve.y);if(je){if(ge[je.x.toFixed(4)]==je.y.toFixed(4))continue;ge[je.x.toFixed(4)]=je.y.toFixed(4);var Oe=fe.t+Re((je[_e]-fe[_e])/(le[_e]-fe[_e]))*(le.t-fe.t),Ge=Ne.t+Re((je[ye]-Ne[ye])/(ve[ye]-Ne[ye]))*(ve.t-Ne.t);Oe>=0&&Oe<=1.001&&Ge>=0&&Ge<=1.001&&(s?ce++:ce.push({x:je.x,y:je.y,t1:Z(Oe,1),t2:Z(Ge,1)}))}}return ce}function Xe(e,t,s){e=d._path2curve(e),t=d._path2curve(t);for(var i,h,m,w,b,k,q,ae,ge,ce,re=s?0:[],he=0,xe=e.length;he<xe;he++){var fe=e[he];if(fe[0]=="M")i=b=fe[1],h=k=fe[2];else{fe[0]=="C"?(ge=[i,h].concat(fe.slice(1)),i=ge[6],h=ge[7]):(ge=[i,h,i,h,b,k,b,k],i=b,h=k);for(var le=0,Ne=t.length;le<Ne;le++){var ve=t[le];if(ve[0]=="M")m=q=ve[1],w=ae=ve[2];else{ve[0]=="C"?(ce=[m,w].concat(ve.slice(1)),m=ce[6],w=ce[7]):(ce=[m,w,m,w,q,ae,q,ae],m=q,w=ae);var _e=Ue(ge,ce,s);if(s)re+=_e;else{for(var ye=0,je=_e.length;ye<je;ye++)_e[ye].segment1=he,_e[ye].segment2=le,_e[ye].bez1=ge,_e[ye].bez2=ce;re=re.concat(_e)}}}}}return re}d.findDotsAtSegment=function(e,t,s,i,h,m,w,b,k){var q=1-k,ae=Me(q,3),ge=Me(q,2),ce=k*k,re=ce*k,he=ae*e+3*ge*k*s+3*q*k*k*h+re*w,xe=ae*t+3*ge*k*i+3*q*k*k*m+re*b,fe=e+2*k*(s-e)+ce*(h-2*s+e),le=t+2*k*(i-t)+ce*(m-2*i+t),Ne=s+2*k*(h-s)+ce*(w-2*h+s),ve=i+2*k*(m-i)+ce*(b-2*m+i),_e=q*e+k*s,ye=q*t+k*i,je=q*h+k*w,Oe=q*m+k*b,Ge=90-180*Ee.atan2(fe-Ne,le-ve)/ue;return(fe>Ne||le<ve)&&(Ge+=180),{x:he,y:xe,m:{x:fe,y:le},n:{x:Ne,y:ve},start:{x:_e,y:ye},end:{x:je,y:Oe},alpha:Ge}},d.bezierBBox=function(e,t,s,i,h,m,w,b){d.is(e,"array")||(e=[e,t,s,i,h,m,w,b]);var k=dt.apply(null,e);return{x:k.min.x,y:k.min.y,x2:k.max.x,y2:k.max.y,width:k.max.x-k.min.x,height:k.max.y-k.min.y}},d.isPointInsideBBox=function(e,t,s){return t>=e.x&&t<=e.x2&&s>=e.y&&s<=e.y2},d.isBBoxIntersect=function(e,t){var s=d.isPointInsideBBox;return s(t,e.x,e.y)||s(t,e.x2,e.y)||s(t,e.x,e.y2)||s(t,e.x2,e.y2)||s(e,t.x,t.y)||s(e,t.x2,t.y)||s(e,t.x,t.y2)||s(e,t.x2,t.y2)||(e.x<t.x2&&e.x>t.x||t.x<e.x2&&t.x>e.x)&&(e.y<t.y2&&e.y>t.y||t.y<e.y2&&t.y>e.y)},d.pathIntersection=function(e,t){return Xe(e,t)},d.pathIntersectionNumber=function(e,t){return Xe(e,t,1)},d.isPointInsidePath=function(e,t,s){var i=d.pathBBox(e);return d.isPointInsideBBox(i,t,s)&&Xe(e,[["M",t,s],["H",i.x2+10]],1)%2==1},d._removedFactory=function(e){return function(){l("raphael.log",null,"RaphaÃ«l: you are calling to method â€œ"+e+"â€ of removed object",e)}};var Ve=d.pathBBox=function(e){var t=Le(e);if(t.bbox)return r(t.bbox);if(!e)return{x:0,y:0,width:0,height:0,x2:0,y2:0};for(var s,i=0,h=0,m=[],w=[],b=0,k=(e=mt(e)).length;b<k;b++)if((s=e[b])[0]=="M")i=s[1],h=s[2],m.push(i),w.push(h);else{var q=dt(i,h,s[1],s[2],s[3],s[4],s[5],s[6]);m=m[W](q.min.x,q.max.x),w=w[W](q.min.y,q.max.y),i=s[5],h=s[6]}var ae=Z[Q](0,m),ge=Z[Q](0,w),ce=qe[Q](0,m),re=qe[Q](0,w),he=ce-ae,xe=re-ge,fe={x:ae,y:ge,x2:ce,y2:re,width:he,height:xe,cx:ae+he/2,cy:ge+xe/2};return t.bbox=r(fe),fe},Je=function(e){var t=r(e);return t.toString=d._path2string,t},lt=d._pathToRelative=function(e){var t=Le(e);if(t.rel)return Je(t.rel);d.is(e,pe)&&d.is(e&&e[0],pe)||(e=d.parsePathString(e));var s=[],i=0,h=0,m=0,w=0,b=0;e[0][0]=="M"&&(m=i=e[0][1],w=h=e[0][2],b++,s.push(["M",i,h]));for(var k=b,q=e.length;k<q;k++){var ae=s[k]=[],ge=e[k];if(ge[0]!=De.call(ge[0]))switch(ae[0]=De.call(ge[0]),ae[0]){case"a":ae[1]=ge[1],ae[2]=ge[2],ae[3]=ge[3],ae[4]=ge[4],ae[5]=ge[5],ae[6]=+(ge[6]-i).toFixed(3),ae[7]=+(ge[7]-h).toFixed(3);break;case"v":ae[1]=+(ge[1]-h).toFixed(3);break;case"m":m=ge[1],w=ge[2];default:for(var ce=1,re=ge.length;ce<re;ce++)ae[ce]=+(ge[ce]-(ce%2?i:h)).toFixed(3)}else{ae=s[k]=[],ge[0]=="m"&&(m=ge[1]+i,w=ge[2]+h);for(var he=0,xe=ge.length;he<xe;he++)s[k][he]=ge[he]}var fe=s[k].length;switch(s[k][0]){case"z":i=m,h=w;break;case"h":i+=+s[k][fe-1];break;case"v":h+=+s[k][fe-1];break;default:i+=+s[k][fe-2],h+=+s[k][fe-1]}}return s.toString=d._path2string,t.rel=Je(s),s},rt=d._pathToAbsolute=function(e){var t=Le(e);if(t.abs)return Je(t.abs);if(d.is(e,pe)&&d.is(e&&e[0],pe)||(e=d.parsePathString(e)),!e||!e.length)return[["M",0,0]];var s=[],i=0,h=0,m=0,w=0,b=0;e[0][0]=="M"&&(m=i=+e[0][1],w=h=+e[0][2],b++,s[0]=["M",i,h]);for(var k,q,ae=e.length==3&&e[0][0]=="M"&&e[1][0].toUpperCase()=="R"&&e[2][0].toUpperCase()=="Z",ge=b,ce=e.length;ge<ce;ge++){if(s.push(k=[]),(q=e[ge])[0]!=H.call(q[0]))switch(k[0]=H.call(q[0]),k[0]){case"A":k[1]=q[1],k[2]=q[2],k[3]=q[3],k[4]=q[4],k[5]=q[5],k[6]=+(q[6]+i),k[7]=+(q[7]+h);break;case"V":k[1]=+q[1]+h;break;case"H":k[1]=+q[1]+i;break;case"R":for(var re=[i,h][W](q.slice(1)),he=2,xe=re.length;he<xe;he++)re[he]=+re[he]+i,re[++he]=+re[he]+h;s.pop(),s=s[W](we(re,ae));break;case"M":m=+q[1]+i,w=+q[2]+h;default:for(he=1,xe=q.length;he<xe;he++)k[he]=+q[he]+(he%2?i:h)}else if(q[0]=="R")re=[i,h][W](q.slice(1)),s.pop(),s=s[W](we(re,ae)),k=["R"][W](q.slice(-2));else for(var fe=0,le=q.length;fe<le;fe++)k[fe]=q[fe];switch(k[0]){case"Z":i=m,h=w;break;case"H":i=k[1];break;case"V":h=k[1];break;case"M":m=k[k.length-2],w=k[k.length-1];default:i=k[k.length-2],h=k[k.length-1]}}return s.toString=d._path2string,t.abs=Je(s),s},st=function(e,t,s,i){return[e,t,s,i,s,i]},it=function(e,t,s,i,h,m){return[1/3*e+2/3*s,1/3*t+2/3*i,1/3*h+2/3*s,1/3*m+2/3*i,h,m]},ct=function(e,t,s,i,h,m,w,b,k,q){var ae,ge=120*ue/180,ce=ue/180*(+h||0),re=[],he=J(function(gn,xn,qt){return{x:gn*Ee.cos(qt)-xn*Ee.sin(qt),y:gn*Ee.sin(qt)+xn*Ee.cos(qt)}});if(q)Oe=q[0],Ge=q[1],ye=q[2],je=q[3];else{e=(ae=he(e,t,-ce)).x,t=ae.y,b=(ae=he(b,k,-ce)).x,k=ae.y;var xe=(e-b)/2,fe=(t-k)/2,le=xe*xe/(s*s)+fe*fe/(i*i);le>1&&(s*=le=Ee.sqrt(le),i*=le);var Ne=s*s,ve=i*i,_e=(m==w?-1:1)*Ee.sqrt(Re((Ne*ve-Ne*fe*fe-ve*xe*xe)/(Ne*fe*fe+ve*xe*xe))),ye=_e*s*fe/i+(e+b)/2,je=_e*-i*xe/s+(t+k)/2,Oe=Ee.asin(((t-je)/i).toFixed(9)),Ge=Ee.asin(((k-je)/i).toFixed(9));(Oe=e<ye?ue-Oe:Oe)<0&&(Oe=2*ue+Oe),(Ge=b<ye?ue-Ge:Ge)<0&&(Ge=2*ue+Ge),w&&Oe>Ge&&(Oe-=2*ue),!w&&Ge>Oe&&(Ge-=2*ue)}var kt=Ge-Oe;if(Re(kt)>ge){var Tt=Ge,ut=b,ft=k;Ge=Oe+ge*(w&&Ge>Oe?1:-1),b=ye+s*Ee.cos(Ge),k=je+i*Ee.sin(Ge),re=ct(b,k,s,i,h,0,w,ut,ft,[Ge,Tt,ye,je])}kt=Ge-Oe;var St=Ee.cos(Oe),At=Ee.sin(Oe),It=Ee.cos(Ge),xt=Ee.sin(Ge),Ct=Ee.tan(kt/4),Dt=4/3*s*Ct,hn=4/3*i*Ct,dn=[e,t],Pt=[e+Dt*At,t-hn*St],fn=[b+Dt*xt,k-hn*It],pn=[b,k];if(Pt[0]=2*dn[0]-Pt[0],Pt[1]=2*dn[1]-Pt[1],q)return[Pt,fn,pn][W](re);for(var mn=[],yt=0,Dn=(re=[Pt,fn,pn][W](re).join()[Se](",")).length;yt<Dn;yt++)mn[yt]=yt%2?he(re[yt-1],re[yt],ce).y:he(re[yt],re[yt+1],ce).x;return mn},pt=function(e,t,s,i,h,m,w,b,k){var q=1-k;return{x:Me(q,3)*e+3*Me(q,2)*k*s+3*q*k*k*h+Me(k,3)*w,y:Me(q,3)*t+3*Me(q,2)*k*i+3*q*k*k*m+Me(k,3)*b}},dt=J(function(e,t,s,i,h,m,w,b){var k,q=h-2*s+e-(w-2*h+s),ae=2*(s-e)-2*(h-s),ge=e-s,ce=(-ae+Ee.sqrt(ae*ae-4*q*ge))/2/q,re=(-ae-Ee.sqrt(ae*ae-4*q*ge))/2/q,he=[t,b],xe=[e,w];return Re(ce)>"1e12"&&(ce=.5),Re(re)>"1e12"&&(re=.5),ce>0&&ce<1&&(k=pt(e,t,s,i,h,m,w,b,ce),xe.push(k.x),he.push(k.y)),re>0&&re<1&&(k=pt(e,t,s,i,h,m,w,b,re),xe.push(k.x),he.push(k.y)),q=m-2*i+t-(b-2*m+i),ge=t-i,ce=(-(ae=2*(i-t)-2*(m-i))+Ee.sqrt(ae*ae-4*q*ge))/2/q,re=(-ae-Ee.sqrt(ae*ae-4*q*ge))/2/q,Re(ce)>"1e12"&&(ce=.5),Re(re)>"1e12"&&(re=.5),ce>0&&ce<1&&(k=pt(e,t,s,i,h,m,w,b,ce),xe.push(k.x),he.push(k.y)),re>0&&re<1&&(k=pt(e,t,s,i,h,m,w,b,re),xe.push(k.x),he.push(k.y)),{min:{x:Z[Q](0,xe),y:Z[Q](0,he)},max:{x:qe[Q](0,xe),y:qe[Q](0,he)}}}),mt=d._path2curve=J(function(e,t){var s=!t&&Le(e);if(!t&&s.curve)return Je(s.curve);for(var i=rt(e),h=t&&rt(t),m={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},w={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},b=function(_e,ye,je){var Oe,Ge;if(!_e)return["C",ye.x,ye.y,ye.x,ye.y,ye.x,ye.y];switch(!(_e[0]in{T:1,Q:1})&&(ye.qx=ye.qy=null),_e[0]){case"M":ye.X=_e[1],ye.Y=_e[2];break;case"A":_e=["C"][W](ct[Q](0,[ye.x,ye.y][W](_e.slice(1))));break;case"S":je=="C"||je=="S"?(Oe=2*ye.x-ye.bx,Ge=2*ye.y-ye.by):(Oe=ye.x,Ge=ye.y),_e=["C",Oe,Ge][W](_e.slice(1));break;case"T":je=="Q"||je=="T"?(ye.qx=2*ye.x-ye.qx,ye.qy=2*ye.y-ye.qy):(ye.qx=ye.x,ye.qy=ye.y),_e=["C"][W](it(ye.x,ye.y,ye.qx,ye.qy,_e[1],_e[2]));break;case"Q":ye.qx=_e[1],ye.qy=_e[2],_e=["C"][W](it(ye.x,ye.y,_e[1],_e[2],_e[3],_e[4]));break;case"L":_e=["C"][W](st(ye.x,ye.y,_e[1],_e[2]));break;case"H":_e=["C"][W](st(ye.x,ye.y,_e[1],ye.y));break;case"V":_e=["C"][W](st(ye.x,ye.y,ye.x,_e[1]));break;case"Z":_e=["C"][W](st(ye.x,ye.y,ye.X,ye.Y))}return _e},k=function(_e,ye){if(_e[ye].length>7){_e[ye].shift();for(var je=_e[ye];je.length;)ae[ye]="A",h&&(ge[ye]="A"),_e.splice(ye++,0,["C"][W](je.splice(0,6)));_e.splice(ye,1),xe=qe(i.length,h&&h.length||0)}},q=function(_e,ye,je,Oe,Ge){_e&&ye&&_e[Ge][0]=="M"&&ye[Ge][0]!="M"&&(ye.splice(Ge,0,["M",Oe.x,Oe.y]),je.bx=0,je.by=0,je.x=_e[Ge][1],je.y=_e[Ge][2],xe=qe(i.length,h&&h.length||0))},ae=[],ge=[],ce="",re="",he=0,xe=qe(i.length,h&&h.length||0);he<xe;he++){i[he]&&(ce=i[he][0]),ce!="C"&&(ae[he]=ce,he&&(re=ae[he-1])),i[he]=b(i[he],m,re),ae[he]!="A"&&ce=="C"&&(ae[he]="C"),k(i,he),h&&(h[he]&&(ce=h[he][0]),ce!="C"&&(ge[he]=ce,he&&(re=ge[he-1])),h[he]=b(h[he],w,re),ge[he]!="A"&&ce=="C"&&(ge[he]="C"),k(h,he)),q(i,h,m,w,he),q(h,i,w,m,he);var fe=i[he],le=h&&h[he],Ne=fe.length,ve=h&&le.length;m.x=fe[Ne-2],m.y=fe[Ne-1],m.bx=S(fe[Ne-4])||m.x,m.by=S(fe[Ne-3])||m.y,w.bx=h&&(S(le[ve-4])||w.x),w.by=h&&(S(le[ve-3])||w.y),w.x=h&&le[ve-2],w.y=h&&le[ve-1]}return h||(s.curve=Je(i)),h?[i,h]:i},null,Je),Mt=(d._parseDots=J(function(e){for(var t=[],s=0,i=e.length;s<i;s++){var h={},m=e[s].match(/^([^:]*):?([\d\.]*)/);if(h.color=d.getRGB(m[1]),h.color.error)return null;h.opacity=h.color.opacity,h.color=h.color.hex,m[2]&&(h.offset=m[2]+"%"),t.push(h)}for(s=1,i=t.length-1;s<i;s++)if(!t[s].offset){for(var w=S(t[s-1].offset||0),b=0,k=s+1;k<i;k++)if(t[k].offset){b=t[k].offset;break}b||(b=100,k=i);for(var q=((b=S(b))-w)/(k-s+1);s<k;s++)w+=q,t[s].offset=w+"%"}return t}),d._tear=function(e,t){e==t.top&&(t.top=e.prev),e==t.bottom&&(t.bottom=e.next),e.next&&(e.next.prev=e.prev),e.prev&&(e.prev.next=e.next)}),En=(d._tofront=function(e,t){t.top!==e&&(Mt(e,t),e.next=null,e.prev=t.top,t.top.next=e,t.top=e)},d._toback=function(e,t){t.bottom!==e&&(Mt(e,t),e.next=t.bottom,e.prev=null,t.bottom.prev=e,t.bottom=e)},d._insertafter=function(e,t,s){Mt(e,s),t==s.top&&(s.top=e),t.next&&(t.next.prev=e),e.next=t.next,e.prev=t,t.next=e},d._insertbefore=function(e,t,s){Mt(e,s),t==s.bottom&&(s.bottom=e),t.prev&&(t.prev.next=e),e.prev=t.prev,t.prev=e,e.next=t},d.toMatrix=function(e,t){var s=Ve(e),i={_:{transform:be},getBBox:function(){return s}};return Kt(i,t),i.matrix}),Kt=(d.transformPath=function(e,t){return at(e,En(e,t))},d._extractTransform=function(e,t){if(t==null)return e._.transform;t=se(t).replace(/\.{3}|\u2026/g,e._.transform||be);var s,i,h=d.parseTransformString(t),m=0,w=1,b=1,k=e._,q=new bt;if(k.transform=h||[],h)for(var ae=0,ge=h.length;ae<ge;ae++){var ce,re,he,xe,fe,le=h[ae],Ne=le.length,ve=se(le[0]).toLowerCase(),_e=le[0]!=ve,ye=_e?q.invert():0;ve=="t"&&Ne==3?_e?(ce=ye.x(0,0),re=ye.y(0,0),he=ye.x(le[1],le[2]),xe=ye.y(le[1],le[2]),q.translate(he-ce,xe-re)):q.translate(le[1],le[2]):ve=="r"?Ne==2?(fe=fe||e.getBBox(1),q.rotate(le[1],fe.x+fe.width/2,fe.y+fe.height/2),m+=le[1]):Ne==4&&(_e?(he=ye.x(le[2],le[3]),xe=ye.y(le[2],le[3]),q.rotate(le[1],he,xe)):q.rotate(le[1],le[2],le[3]),m+=le[1]):ve=="s"?Ne==2||Ne==3?(fe=fe||e.getBBox(1),q.scale(le[1],le[Ne-1],fe.x+fe.width/2,fe.y+fe.height/2),w*=le[1],b*=le[Ne-1]):Ne==5&&(_e?(he=ye.x(le[3],le[4]),xe=ye.y(le[3],le[4]),q.scale(le[1],le[2],he,xe)):q.scale(le[1],le[2],le[3],le[4]),w*=le[1],b*=le[2]):ve=="m"&&Ne==7&&q.add(le[1],le[2],le[3],le[4],le[5],le[6]),k.dirtyT=1,e.matrix=q}e.matrix=q,k.sx=w,k.sy=b,k.deg=m,k.dx=s=q.e,k.dy=i=q.f,w==1&&b==1&&!m&&k.bbox?(k.bbox.x+=+s,k.bbox.y+=+i):k.dirtyT=1}),Zt=function(e){var t=e[0];switch(t.toLowerCase()){case"t":return[t,0,0];case"m":return[t,1,0,0,1,0,0];case"r":return e.length==4?[t,0,e[2],e[3]]:[t,0];case"s":return e.length==5?[t,1,1,e[3],e[4]]:e.length==3?[t,1,1]:[t,1]}},Ln=d._equaliseTransform=function(e,t){t=se(t).replace(/\.{3}|\u2026/g,e),e=d.parseTransformString(e)||[],t=d.parseTransformString(t)||[];for(var s,i,h,m,w=qe(e.length,t.length),b=[],k=[],q=0;q<w;q++){if(h=e[q]||Zt(t[q]),m=t[q]||Zt(h),h[0]!=m[0]||h[0].toLowerCase()=="r"&&(h[2]!=m[2]||h[3]!=m[3])||h[0].toLowerCase()=="s"&&(h[3]!=m[3]||h[4]!=m[4]))return;for(b[q]=[],k[q]=[],s=0,i=qe(h.length,m.length);s<i;s++)s in h&&(b[q][s]=h[s]),s in m&&(k[q][s]=m[s])}return{from:b,to:k}};function bt(e,t,s,i,h,m){e!=null?(this.a=+e,this.b=+t,this.c=+s,this.d=+i,this.e=+h,this.f=+m):(this.a=1,this.b=0,this.c=0,this.d=1,this.e=0,this.f=0)}d._getContainer=function(e,t,s,i){var h;if((h=i!=null||d.is(e,"object")?e:O.doc.getElementById(e))!=null)return h.tagName?t==null?{container:h,width:h.style.pixelWidth||h.offsetWidth,height:h.style.pixelHeight||h.offsetHeight}:{container:h,width:t,height:s}:{container:1,x:e,y:t,width:s,height:i}},d.pathToRelative=lt,d._engine={},d.path2curve=mt,d.matrix=function(e,t,s,i,h,m){return new bt(e,t,s,i,h,m)},function(e){function t(i){return i[0]*i[0]+i[1]*i[1]}function s(i){var h=Ee.sqrt(t(i));i[0]&&(i[0]/=h),i[1]&&(i[1]/=h)}e.add=function(i,h,m,w,b,k){var q,ae,ge,ce,re=[[],[],[]],he=[[this.a,this.c,this.e],[this.b,this.d,this.f],[0,0,1]],xe=[[i,m,b],[h,w,k],[0,0,1]];for(i&&i instanceof bt&&(xe=[[i.a,i.c,i.e],[i.b,i.d,i.f],[0,0,1]]),q=0;q<3;q++)for(ae=0;ae<3;ae++){for(ce=0,ge=0;ge<3;ge++)ce+=he[q][ge]*xe[ge][ae];re[q][ae]=ce}this.a=re[0][0],this.b=re[1][0],this.c=re[0][1],this.d=re[1][1],this.e=re[0][2],this.f=re[1][2]},e.invert=function(){var i=this,h=i.a*i.d-i.b*i.c;return new bt(i.d/h,-i.b/h,-i.c/h,i.a/h,(i.c*i.f-i.d*i.e)/h,(i.b*i.e-i.a*i.f)/h)},e.clone=function(){return new bt(this.a,this.b,this.c,this.d,this.e,this.f)},e.translate=function(i,h){this.add(1,0,0,1,i,h)},e.scale=function(i,h,m,w){h==null&&(h=i),(m||w)&&this.add(1,0,0,1,m,w),this.add(i,0,0,h,0,0),(m||w)&&this.add(1,0,0,1,-m,-w)},e.rotate=function(i,h,m){i=d.rad(i),h=h||0,m=m||0;var w=+Ee.cos(i).toFixed(9),b=+Ee.sin(i).toFixed(9);this.add(w,b,-b,w,h,m),this.add(1,0,0,1,-h,-m)},e.x=function(i,h){return i*this.a+h*this.c+this.e},e.y=function(i,h){return i*this.b+h*this.d+this.f},e.get=function(i){return+this[se.fromCharCode(97+i)].toFixed(4)},e.toString=function(){return d.svg?"matrix("+[this.get(0),this.get(1),this.get(2),this.get(3),this.get(4),this.get(5)].join()+")":[this.get(0),this.get(2),this.get(1),this.get(3),0,0].join()},e.toFilter=function(){return"progid:DXImageTransform.Microsoft.Matrix(M11="+this.get(0)+", M12="+this.get(2)+", M21="+this.get(1)+", M22="+this.get(3)+", Dx="+this.get(4)+", Dy="+this.get(5)+", sizingmethod='auto expand')"},e.offset=function(){return[this.e.toFixed(4),this.f.toFixed(4)]},e.split=function(){var i={};i.dx=this.e,i.dy=this.f;var h=[[this.a,this.c],[this.b,this.d]];i.scalex=Ee.sqrt(t(h[0])),s(h[0]),i.shear=h[0][0]*h[1][0]+h[0][1]*h[1][1],h[1]=[h[1][0]-h[0][0]*i.shear,h[1][1]-h[0][1]*i.shear],i.scaley=Ee.sqrt(t(h[1])),s(h[1]),i.shear/=i.scaley;var m=-h[0][1],w=h[1][1];return w<0?(i.rotate=d.deg(Ee.acos(w)),m<0&&(i.rotate=360-i.rotate)):i.rotate=d.deg(Ee.asin(m)),i.isSimple=!(+i.shear.toFixed(9)||i.scalex.toFixed(9)!=i.scaley.toFixed(9)&&i.rotate),i.isSuperSimple=!+i.shear.toFixed(9)&&i.scalex.toFixed(9)==i.scaley.toFixed(9)&&!i.rotate,i.noRotation=!+i.shear.toFixed(9)&&!i.rotate,i},e.toTransformString=function(i){var h=i||this[Se]();return h.isSimple?(h.scalex=+h.scalex.toFixed(4),h.scaley=+h.scaley.toFixed(4),h.rotate=+h.rotate.toFixed(4),(h.dx||h.dy?"t"+[h.dx,h.dy]:be)+(h.scalex!=1||h.scaley!=1?"s"+[h.scalex,h.scaley,0,0]:be)+(h.rotate?"r"+[h.rotate,0,0]:be)):"m"+[this.get(0),this.get(1),this.get(2),this.get(3),this.get(4),this.get(5)]}}(bt.prototype);for(var Rn=function(){this.returnValue=!1},Tn=function(){return this.originalEvent.preventDefault()},Bn=function(){this.cancelBubble=!0},Nn=function(){return this.originalEvent.stopPropagation()},en=function(e){var t=O.doc.documentElement.scrollTop||O.doc.body.scrollTop,s=O.doc.documentElement.scrollLeft||O.doc.body.scrollLeft;return{x:e.clientX+s,y:e.clientY+t}},Mn=O.doc.addEventListener?function(e,t,s,i){var h=function(w){var b=en(w);return s.call(i,w,b.x,b.y)};if(e.addEventListener(t,h,!1),me&&We[t]){var m=function(w){for(var b=en(w),k=w,q=0,ae=w.targetTouches&&w.targetTouches.length;q<ae;q++)if(w.targetTouches[q].target==e){(w=w.targetTouches[q]).originalEvent=k,w.preventDefault=Tn,w.stopPropagation=Nn;break}return s.call(i,w,b.x,b.y)};e.addEventListener(We[t],m,!1)}return function(){return e.removeEventListener(t,h,!1),me&&We[t]&&e.removeEventListener(We[t],m,!1),!0}}:O.doc.attachEvent?function(e,t,s,i){var h=function(m){m=m||O.win.event;var w=O.doc.documentElement.scrollTop||O.doc.body.scrollTop,b=O.doc.documentElement.scrollLeft||O.doc.body.scrollLeft,k=m.clientX+b,q=m.clientY+w;return m.preventDefault=m.preventDefault||Rn,m.stopPropagation=m.stopPropagation||Bn,s.call(i,m,k,q)};return e.attachEvent("on"+t,h),function(){return e.detachEvent("on"+t,h),!0}}:void 0,vt=[],Ot=function(e){for(var t,s=e.clientX,i=e.clientY,h=O.doc.documentElement.scrollTop||O.doc.body.scrollTop,m=O.doc.documentElement.scrollLeft||O.doc.body.scrollLeft,w=vt.length;w--;){if(t=vt[w],me&&e.touches){for(var b,k=e.touches.length;k--;)if((b=e.touches[k]).identifier==t.el._drag.id){s=b.clientX,i=b.clientY,(e.originalEvent?e.originalEvent:e).preventDefault();break}}else e.preventDefault();var q,ae=t.el.node,ge=ae.nextSibling,ce=ae.parentNode,re=ae.style.display;O.win.opera&&ce.removeChild(ae),ae.style.display="none",q=t.el.paper.getElementByPoint(s,i),ae.style.display=re,O.win.opera&&(ge?ce.insertBefore(ae,ge):ce.appendChild(ae)),q&&l("raphael.drag.over."+t.el.id,t.el,q),s+=m,i+=h,l("raphael.drag.move."+t.el.id,t.move_scope||t.el,s-t.el._drag.x,i-t.el._drag.y,s,i,e)}},Ht=function(e){d.unmousemove(Ot).unmouseup(Ht);for(var t,s=vt.length;s--;)(t=vt[s]).el._drag={},l("raphael.drag.end."+t.el.id,t.end_scope||t.start_scope||t.move_scope||t.el,e);vt=[]},Ze=d.el={},tn=Ie.length;tn--;)(function(e){d[e]=Ze[e]=function(t,s){return d.is(t,"function")&&(this.events=this.events||[],this.events.push({name:e,f:t,unbind:Mn(this.shape||this.node||O.doc,e,t,s||this)})),this},d["un"+e]=Ze["un"+e]=function(t){for(var s=this.events||[],i=s.length;i--;)s[i].name!=e||!d.is(t,"undefined")&&s[i].f!=t||(s[i].unbind(),s.splice(i,1),!s.length&&delete this.events);return this}})(Ie[tn]);Ze.data=function(e,t){var s=He[this.id]=He[this.id]||{};if(arguments.length==0)return s;if(arguments.length==1){if(d.is(e,"object")){for(var i in e)e[T](i)&&this.data(i,e[i]);return this}return l("raphael.data.get."+this.id,this,s[e],e),s[e]}return s[e]=t,l("raphael.data.set."+this.id,this,t,e),this},Ze.removeData=function(e){return e==null?delete He[this.id]:He[this.id]&&delete He[this.id][e],this},Ze.getData=function(){return r(He[this.id]||{})},Ze.hover=function(e,t,s,i){return this.mouseover(e,s).mouseout(t,i||s)},Ze.unhover=function(e,t){return this.unmouseover(e).unmouseout(t)};var _t=[];Ze.drag=function(e,t,s,i,h,m){function w(b){(b.originalEvent||b).preventDefault();var k=b.clientX,q=b.clientY,ae=O.doc.documentElement.scrollTop||O.doc.body.scrollTop,ge=O.doc.documentElement.scrollLeft||O.doc.body.scrollLeft;if(this._drag.id=b.identifier,me&&b.touches){for(var ce,re=b.touches.length;re--;)if(ce=b.touches[re],this._drag.id=ce.identifier,ce.identifier==this._drag.id){k=ce.clientX,q=ce.clientY;break}}this._drag.x=k+ge,this._drag.y=q+ae,!vt.length&&d.mousemove(Ot).mouseup(Ht),vt.push({el:this,move_scope:i,start_scope:h,end_scope:m}),t&&l.on("raphael.drag.start."+this.id,t),e&&l.on("raphael.drag.move."+this.id,e),s&&l.on("raphael.drag.end."+this.id,s),l("raphael.drag.start."+this.id,h||i||this,this._drag.x,this._drag.y,b)}return this._drag={},_t.push({el:this,start:w}),this.mousedown(w),this},Ze.onDragOver=function(e){e?l.on("raphael.drag.over."+this.id,e):l.unbind("raphael.drag.over."+this.id)},Ze.undrag=function(){for(var e=_t.length;e--;)_t[e].el==this&&(this.unmousedown(_t[e].start),_t.splice(e,1),l.unbind("raphael.drag.*."+this.id));!_t.length&&d.unmousemove(Ot).unmouseup(Ht),vt=[]},B.circle=function(e,t,s){var i=d._engine.circle(this,e||0,t||0,s||0);return this.__set__&&this.__set__.push(i),i},B.rect=function(e,t,s,i,h){var m=d._engine.rect(this,e||0,t||0,s||0,i||0,h||0);return this.__set__&&this.__set__.push(m),m},B.ellipse=function(e,t,s,i){var h=d._engine.ellipse(this,e||0,t||0,s||0,i||0);return this.__set__&&this.__set__.push(h),h},B.path=function(e){e&&!d.is(e,"string")&&!d.is(e[0],pe)&&(e+=be);var t=d._engine.path(d.format[Q](d,arguments),this);return this.__set__&&this.__set__.push(t),t},B.image=function(e,t,s,i,h){var m=d._engine.image(this,e||"about:blank",t||0,s||0,i||0,h||0);return this.__set__&&this.__set__.push(m),m},B.text=function(e,t,s){var i=d._engine.text(this,e||0,t||0,se(s));return this.__set__&&this.__set__.push(i),i},B.set=function(e){!d.is(e,"array")&&(e=Array.prototype.splice.call(arguments,0,arguments.length));var t=new Rt(e);return this.__set__&&this.__set__.push(t),t.paper=this,t.type="set",t},B.setStart=function(e){this.__set__=e||this.set()},B.setFinish=function(e){var t=this.__set__;return delete this.__set__,t},B.getSize=function(){var e=this.canvas.parentNode;return{width:e.offsetWidth,height:e.offsetHeight}},B.setSize=function(e,t){return d._engine.setSize.call(this,e,t)},B.setViewBox=function(e,t,s,i,h){return d._engine.setViewBox.call(this,e,t,s,i,h)},B.top=B.bottom=null,B.raphael=d;function nn(){return this.x+ke+this.y+ke+this.width+" Ã— "+this.height}B.getElementByPoint=function(e,t){var s,i,h,m,w,b,k,q=this.canvas,ae=O.doc.elementFromPoint(e,t);if(O.win.opera&&ae.tagName=="svg"){var ge=(i=(s=q).getBoundingClientRect(),h=s.ownerDocument,m=h.body,w=h.documentElement,b=w.clientTop||m.clientTop||0,k=w.clientLeft||m.clientLeft||0,{y:i.top+(O.win.pageYOffset||w.scrollTop||m.scrollTop)-b,x:i.left+(O.win.pageXOffset||w.scrollLeft||m.scrollLeft)-k}),ce=q.createSVGRect();ce.x=e-ge.x,ce.y=t-ge.y,ce.width=ce.height=1;var re=q.getIntersectionList(ce,null);re.length&&(ae=re[re.length-1])}if(!ae)return null;for(;ae.parentNode&&ae!=q.parentNode&&!ae.raphael;)ae=ae.parentNode;return ae==this.canvas.parentNode&&(ae=q),ae=ae&&ae.raphael?this.getById(ae.raphaelid):null},B.getElementsByBBox=function(e){var t=this.set();return this.forEach(function(s){d.isBBoxIntersect(s.getBBox(),e)&&t.push(s)}),t},B.getById=function(e){for(var t=this.bottom;t;){if(t.id==e)return t;t=t.next}return null},B.forEach=function(e,t){for(var s=this.bottom;s;){if(e.call(t,s)===!1)return this;s=s.next}return this},B.getElementsByPoint=function(e,t){var s=this.set();return this.forEach(function(i){i.isPointInside(e,t)&&s.push(i)}),s},Ze.isPointInside=function(e,t){var s=this.realPath=nt[this.type](this);return this.attr("transform")&&this.attr("transform").length&&(s=d.transformPath(s,this.attr("transform"))),d.isPointInsidePath(s,e,t)},Ze.getBBox=function(e){if(this.removed)return{};var t=this._;return e?(!t.dirty&&t.bboxwt||(this.realPath=nt[this.type](this),t.bboxwt=Ve(this.realPath),t.bboxwt.toString=nn,t.dirty=0),t.bboxwt):((t.dirty||t.dirtyT||!t.bbox)&&(!t.dirty&&this.realPath||(t.bboxwt=0,this.realPath=nt[this.type](this)),t.bbox=Ve(at(this.realPath,this.matrix)),t.bbox.toString=nn,t.dirty=t.dirtyT=0),t.bbox)},Ze.clone=function(){if(this.removed)return null;var e=this.paper[this.type]().attr(this.attr());return this.__set__&&this.__set__.push(e),e},Ze.glow=function(e){if(this.type=="text")return null;var t={width:((e=e||{}).width||10)+(+this.attr("stroke-width")||1),fill:e.fill||!1,opacity:e.opacity==null?.5:e.opacity,offsetx:e.offsetx||0,offsety:e.offsety||0,color:e.color||"#000"},s=t.width/2,i=this.paper,h=i.set(),m=this.realPath||nt[this.type](this);m=this.matrix?at(m,this.matrix):m;for(var w=1;w<s+1;w++)h.push(i.path(m).attr({stroke:t.color,fill:t.fill?t.color:"none","stroke-linejoin":"round","stroke-linecap":"round","stroke-width":+(t.width/s*w).toFixed(3),opacity:+(t.opacity/s).toFixed(3)}));return h.insertBefore(this).translate(t.offsetx,t.offsety)};var $t=function(e,t,s,i,h,m,w,b,k){return k==null?Te(e,t,s,i,h,m,w,b):d.findDotsAtSegment(e,t,s,i,h,m,w,b,function(q,ae,ge,ce,re,he,xe,fe,le){if(!(le<0||Te(q,ae,ge,ce,re,he,xe,fe)<le)){var Ne,ve=.5,_e=1-ve;for(Ne=Te(q,ae,ge,ce,re,he,xe,fe,_e);Re(Ne-le)>.01;)Ne=Te(q,ae,ge,ce,re,he,xe,fe,_e+=(Ne<le?1:-1)*(ve/=2));return _e}}(e,t,s,i,h,m,w,b,k))},Vt=function(e,t){return function(s,i,h){for(var m,w,b,k,q,ae="",ge={},ce=0,re=0,he=(s=mt(s)).length;re<he;re++){if((b=s[re])[0]=="M")m=+b[1],w=+b[2];else{if(ce+(k=$t(m,w,b[1],b[2],b[3],b[4],b[5],b[6]))>i){if(t&&!ge.start){if(ae+=["C"+(q=$t(m,w,b[1],b[2],b[3],b[4],b[5],b[6],i-ce)).start.x,q.start.y,q.m.x,q.m.y,q.x,q.y],h)return ae;ge.start=ae,ae=["M"+q.x,q.y+"C"+q.n.x,q.n.y,q.end.x,q.end.y,b[5],b[6]].join(),ce+=k,m=+b[5],w=+b[6];continue}if(!e&&!t)return{x:(q=$t(m,w,b[1],b[2],b[3],b[4],b[5],b[6],i-ce)).x,y:q.y,alpha:q.alpha}}ce+=k,m=+b[5],w=+b[6]}ae+=b.shift()+b}return ge.end=ae,(q=e?ce:t?ge:d.findDotsAtSegment(m,w,b[0],b[1],b[2],b[3],b[4],b[5],1)).alpha&&(q={x:q.x,y:q.y,alpha:q.alpha}),q}},rn=Vt(1),sn=Vt(),Ut=Vt(0,1);d.getTotalLength=rn,d.getPointAtLength=sn,d.getSubpath=function(e,t,s){if(this.getTotalLength(e)-s<1e-6)return Ut(e,t).end;var i=Ut(e,s,1);return t?Ut(i,t).end:i},Ze.getTotalLength=function(){var e=this.getPath();if(e)return this.node.getTotalLength?this.node.getTotalLength():rn(e)},Ze.getPointAtLength=function(e){var t=this.getPath();if(t)return sn(t,e)},Ze.getPath=function(){var e,t=d._getPath[this.type];if(this.type!="text"&&this.type!="set")return t&&(e=t(this)),e},Ze.getSubpath=function(e,t){var s=this.getPath();if(s)return d.getSubpath(s,e,t)};var ht=d.easing_formulas={linear:function(e){return e},"<":function(e){return Me(e,1.7)},">":function(e){return Me(e,.48)},"<>":function(e){var t=.48-e/1.04,s=Ee.sqrt(.1734+t*t),i=s-t,h=-s-t,m=Me(Re(i),1/3)*(i<0?-1:1)+Me(Re(h),1/3)*(h<0?-1:1)+.5;return 3*(1-m)*m*m+m*m*m},backIn:function(e){var t=1.70158;return e*e*((t+1)*e-t)},backOut:function(e){var t=1.70158;return(e-=1)*e*((t+1)*e+t)+1},elastic:function(e){return e==!!e?e:Me(2,-10*e)*Ee.sin(2*ue*(e-.075)/.3)+1},bounce:function(e){var t=7.5625,s=2.75;return e<1/s?t*e*e:e<2/s?t*(e-=1.5/s)*e+.75:e<2.5/s?t*(e-=2.25/s)*e+.9375:t*(e-=2.625/s)*e+.984375}};ht.easeIn=ht["ease-in"]=ht["<"],ht.easeOut=ht["ease-out"]=ht[">"],ht.easeInOut=ht["ease-in-out"]=ht["<>"],ht["back-in"]=ht.backIn,ht["back-out"]=ht.backOut;var Qe=[],an=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){setTimeout(e,16)},jt=function(){for(var e=+new Date,t=0;t<Qe.length;t++){var s=Qe[t];if(!s.el.removed&&!s.paused){var i,h,m=e-s.start,w=s.ms,b=s.easing,k=s.from,q=s.diff,ae=s.to,ge=(s.t,s.el),ce={},re={};if(s.initstatus?(m=(s.initstatus*s.anim.top-s.prev)/(s.percent-s.prev)*w,s.status=s.initstatus,delete s.initstatus,s.stop&&Qe.splice(t--,1)):s.status=(s.prev+(s.percent-s.prev)*(m/w))/s.anim.top,!(m<0))if(m<w){var he=b(m/w);for(var xe in k)if(k[T](xe)){switch(j[xe]){case te:i=+k[xe]+he*w*q[xe];break;case"colour":i="rgb("+[Gt(g(k[xe].r+he*w*q[xe].r)),Gt(g(k[xe].g+he*w*q[xe].g)),Gt(g(k[xe].b+he*w*q[xe].b))].join(",")+")";break;case"path":i=[];for(var fe=0,le=k[xe].length;fe<le;fe++){i[fe]=[k[xe][fe][0]];for(var Ne=1,ve=k[xe][fe].length;Ne<ve;Ne++)i[fe][Ne]=+k[xe][fe][Ne]+he*w*q[xe][fe][Ne];i[fe]=i[fe].join(ke)}i=i.join(ke);break;case"transform":if(q[xe].real)for(i=[],fe=0,le=k[xe].length;fe<le;fe++)for(i[fe]=[k[xe][fe][0]],Ne=1,ve=k[xe][fe].length;Ne<ve;Ne++)i[fe][Ne]=k[xe][fe][Ne]+he*w*q[xe][fe][Ne];else{var _e=function(je){return+k[xe][je]+he*w*q[xe][je]};i=[["m",_e(0),_e(1),_e(2),_e(3),_e(4),_e(5)]]}break;case"csv":if(xe=="clip-rect")for(i=[],fe=4;fe--;)i[fe]=+k[xe][fe]+he*w*q[xe][fe];break;default:var ye=[][W](k[xe]);for(i=[],fe=ge.paper.customAttributes[xe].length;fe--;)i[fe]=+ye[fe]+he*w*q[xe][fe]}ce[xe]=i}ge.attr(ce),function(je,Oe,Ge){setTimeout(function(){l("raphael.anim.frame."+je,Oe,Ge)})}(ge.id,ge,s.anim)}else{if(function(je,Oe,Ge){setTimeout(function(){l("raphael.anim.frame."+Oe.id,Oe,Ge),l("raphael.anim.finish."+Oe.id,Oe,Ge),d.is(je,"function")&&je.call(Oe)})}(s.callback,ge,s.anim),ge.attr(ae),Qe.splice(t--,1),s.repeat>1&&!s.next){for(h in ae)ae[T](h)&&(re[h]=s.totalOrigin[h]);s.el.attr(re),Lt(s.anim,s.el,s.anim.percents[0],null,s.totalOrigin,s.repeat-1)}s.next&&!s.stop&&Lt(s.anim,s.el,s.next,null,s.totalOrigin,s.repeat)}}}Qe.length&&an(jt)},Gt=function(e){return e>255?255:e<0?0:e};function In(e,t,s,i,h,m){var w=3*t,b=3*(i-t)-w,k=1-w-b,q=3*s,ae=3*(h-s)-q,ge=1-q-ae;function ce(re){return((k*re+b)*re+w)*re}return function(re,he){var xe=function(fe,le){var Ne,ve,_e,ye,je,Oe;for(_e=fe,Oe=0;Oe<8;Oe++){if(ye=ce(_e)-fe,Re(ye)<le)return _e;if(Re(je=(3*k*_e+2*b)*_e+w)<1e-6)break;_e-=ye/je}if(ve=1,(_e=fe)<(Ne=0))return Ne;if(_e>ve)return ve;for(;Ne<ve;){if(ye=ce(_e),Re(ye-fe)<le)return _e;fe>ye?Ne=_e:ve=_e,_e=(ve-Ne)/2+Ne}return _e}(re,he);return((ge*xe+ae)*xe+q)*xe}(e,1/(200*m))}function gt(e,t){var s=[],i={};if(this.ms=t,this.times=1,e){for(var h in e)e[T](h)&&(i[S(h)]=e[h],s.push(S(h)));s.sort($e)}this.anim=i,this.top=s[s.length-1],this.percents=s}function Lt(e,t,s,i,h,m){s=S(s);var w,b,k,q,ae,ge,ce=e.ms,re={},he={},xe={};if(i)for(le=0,Ne=Qe.length;le<Ne;le++){var fe=Qe[le];if(fe.el.id==t.id&&fe.anim==e){fe.percent!=s?(Qe.splice(le,1),k=1):b=fe,t.attr(fe.totalOrigin);break}}else i=+he;for(var le=0,Ne=e.percents.length;le<Ne;le++){if(e.percents[le]==s||e.percents[le]>i*e.top){s=e.percents[le],ae=e.percents[le-1]||0,ce=ce/e.top*(s-ae),q=e.percents[le+1],w=e.anim[s];break}i&&t.attr(e.anim[e.percents[le]])}if(w){if(b)b.initstatus=i,b.start=new Date-b.ms*i;else{for(var ve in w)if(w[T](ve)&&(j[T](ve)||t.paper.customAttributes[T](ve)))switch(re[ve]=t.attr(ve),re[ve]==null&&(re[ve]=ne[ve]),he[ve]=w[ve],j[ve]){case te:xe[ve]=(he[ve]-re[ve])/ce;break;case"colour":re[ve]=d.getRGB(re[ve]);var _e=d.getRGB(he[ve]);xe[ve]={r:(_e.r-re[ve].r)/ce,g:(_e.g-re[ve].g)/ce,b:(_e.b-re[ve].b)/ce};break;case"path":var ye=mt(re[ve],he[ve]),je=ye[1];for(re[ve]=ye[0],xe[ve]=[],le=0,Ne=re[ve].length;le<Ne;le++){xe[ve][le]=[0];for(var Oe=1,Ge=re[ve][le].length;Oe<Ge;Oe++)xe[ve][le][Oe]=(je[le][Oe]-re[ve][le][Oe])/ce}break;case"transform":var kt=t._,Tt=Ln(kt[ve],he[ve]);if(Tt)for(re[ve]=Tt.from,he[ve]=Tt.to,xe[ve]=[],xe[ve].real=!0,le=0,Ne=re[ve].length;le<Ne;le++)for(xe[ve][le]=[re[ve][le][0]],Oe=1,Ge=re[ve][le].length;Oe<Ge;Oe++)xe[ve][le][Oe]=(he[ve][le][Oe]-re[ve][le][Oe])/ce;else{var ut=t.matrix||new bt,ft={_:{transform:kt.transform},getBBox:function(){return t.getBBox(1)}};re[ve]=[ut.a,ut.b,ut.c,ut.d,ut.e,ut.f],Kt(ft,he[ve]),he[ve]=ft._.transform,xe[ve]=[(ft.matrix.a-ut.a)/ce,(ft.matrix.b-ut.b)/ce,(ft.matrix.c-ut.c)/ce,(ft.matrix.d-ut.d)/ce,(ft.matrix.e-ut.e)/ce,(ft.matrix.f-ut.f)/ce]}break;case"csv":var St=se(w[ve])[Se](Y),At=se(re[ve])[Se](Y);if(ve=="clip-rect")for(re[ve]=At,xe[ve]=[],le=At.length;le--;)xe[ve][le]=(St[le]-re[ve][le])/ce;he[ve]=St;break;default:for(St=[][W](w[ve]),At=[][W](re[ve]),xe[ve]=[],le=t.paper.customAttributes[ve].length;le--;)xe[ve][le]=((St[le]||0)-(At[le]||0))/ce}var It=w.easing,xt=d.easing_formulas[It];if(!xt)if((xt=se(It).match(c))&&xt.length==5){var Ct=xt;xt=function(Dt){return In(Dt,+Ct[1],+Ct[2],+Ct[3],+Ct[4],ce)}}else xt=Ye;if(fe={anim:e,percent:s,timestamp:ge=w.start||e.start||+new Date,start:ge+(e.del||0),status:0,initstatus:i||0,stop:!1,ms:ce,easing:xt,from:re,diff:xe,to:he,el:t,callback:w.callback,prev:ae,next:q,repeat:m||e.times,origin:t.attr(),totalOrigin:h},Qe.push(fe),i&&!b&&!k&&(fe.stop=!0,fe.start=new Date-ce*i,Qe.length==1))return jt();k&&(fe.start=new Date-fe.ms*i),Qe.length==1&&an(jt)}l("raphael.anim.start."+t.id,t,e)}}function on(e){for(var t=0;t<Qe.length;t++)Qe[t].el.paper==e&&Qe.splice(t--,1)}Ze.animateWith=function(e,t,s,i,h,m){if(this.removed)return m&&m.call(this),this;var w=s instanceof gt?s:d.animation(s,i,h,m);Lt(w,this,w.percents[0],null,this.attr());for(var b=0,k=Qe.length;b<k;b++)if(Qe[b].anim==t&&Qe[b].el==e){Qe[k-1].start=Qe[b].start;break}return this},Ze.onAnimation=function(e){return e?l.on("raphael.anim.frame."+this.id,e):l.unbind("raphael.anim.frame."+this.id),this},gt.prototype.delay=function(e){var t=new gt(this.anim,this.ms);return t.times=this.times,t.del=+e||0,t},gt.prototype.repeat=function(e){var t=new gt(this.anim,this.ms);return t.del=this.del,t.times=Ee.floor(qe(e,0))||1,t},d.animation=function(e,t,s,i){if(e instanceof gt)return e;!d.is(s,"function")&&s||(i=i||s||null,s=null),e=Object(e),t=+t||0;var h,m,w={};for(m in e)e[T](m)&&S(m)!=m&&S(m)+"%"!=m&&(h=!0,w[m]=e[m]);if(h)return s&&(w.easing=s),i&&(w.callback=i),new gt({100:w},t);if(i){var b=0;for(var k in e){var q=N(k);e[T](k)&&q>b&&(b=q)}!e[b+="%"].callback&&(e[b].callback=i)}return new gt(e,t)},Ze.animate=function(e,t,s,i){if(this.removed)return i&&i.call(this),this;var h=e instanceof gt?e:d.animation(e,t,s,i);return Lt(h,this,h.percents[0],null,this.attr()),this},Ze.setTime=function(e,t){return e&&t!=null&&this.status(e,Z(t,e.ms)/e.ms),this},Ze.status=function(e,t){var s,i,h=[],m=0;if(t!=null)return Lt(e,this,-1,Z(t,1)),this;for(s=Qe.length;m<s;m++)if((i=Qe[m]).el.id==this.id&&(!e||i.anim==e)){if(e)return i.status;h.push({anim:i.anim,status:i.status})}return e?0:h},Ze.pause=function(e){for(var t=0;t<Qe.length;t++)Qe[t].el.id!=this.id||e&&Qe[t].anim!=e||l("raphael.anim.pause."+this.id,this,Qe[t].anim)!==!1&&(Qe[t].paused=!0);return this},Ze.resume=function(e){for(var t=0;t<Qe.length;t++)if(Qe[t].el.id==this.id&&(!e||Qe[t].anim==e)){var s=Qe[t];l("raphael.anim.resume."+this.id,this,s.anim)!==!1&&(delete s.paused,this.status(s.anim,s.status))}return this},Ze.stop=function(e){for(var t=0;t<Qe.length;t++)Qe[t].el.id!=this.id||e&&Qe[t].anim!=e||l("raphael.anim.stop."+this.id,this,Qe[t].anim)!==!1&&Qe.splice(t--,1);return this},l.on("raphael.remove",on),l.on("raphael.clear",on),Ze.toString=function(){return"RaphaÃ«lâ€™s object"};var ln,cn,wt,un,Rt=function(e){if(this.items=[],this.length=0,this.type="set",e)for(var t=0,s=e.length;t<s;t++)!e[t]||e[t].constructor!=Ze.constructor&&e[t].constructor!=Rt||(this[this.items.length]=this.items[this.items.length]=e[t],this.length++)},ot=Rt.prototype;for(var Xt in ot.push=function(){for(var e,t,s=0,i=arguments.length;s<i;s++)!(e=arguments[s])||e.constructor!=Ze.constructor&&e.constructor!=Rt||(this[t=this.items.length]=this.items[t]=e,this.length++);return this},ot.pop=function(){return this.length&&delete this[this.length--],this.items.pop()},ot.forEach=function(e,t){for(var s=0,i=this.items.length;s<i;s++)if(e.call(t,this.items[s],s)===!1)return this;return this},Ze)Ze[T](Xt)&&(ot[Xt]=function(e){return function(){var t=arguments;return this.forEach(function(s){s[e][Q](s,t)})}}(Xt));return ot.attr=function(e,t){if(e&&d.is(e,pe)&&d.is(e[0],"object"))for(var s=0,i=e.length;s<i;s++)this.items[s].attr(e[s]);else for(var h=0,m=this.items.length;h<m;h++)this.items[h].attr(e,t);return this},ot.clear=function(){for(;this.length;)this.pop()},ot.splice=function(e,t,s){e=e<0?qe(this.length+e,0):e,t=qe(0,Z(this.length-e,t));var i,h=[],m=[],w=[];for(i=2;i<arguments.length;i++)w.push(arguments[i]);for(i=0;i<t;i++)m.push(this[e+i]);for(;i<this.length-e;i++)h.push(this[e+i]);var b=w.length;for(i=0;i<b+h.length;i++)this.items[e+i]=this[e+i]=i<b?w[i]:h[i-b];for(i=this.items.length=this.length-=t-b;this[i];)delete this[i++];return new Rt(m)},ot.exclude=function(e){for(var t=0,s=this.length;t<s;t++)if(this[t]==e)return this.splice(t,1),!0},ot.animate=function(e,t,s,i){(d.is(s,"function")||!s)&&(i=s||null);var h,m,w=this.items.length,b=w,k=this;if(!w)return this;i&&(m=function(){!--w&&i.call(k)}),s=d.is(s,"string")?s:m;var q=d.animation(e,t,s,m);for(h=this.items[--b].animate(q);b--;)this.items[b]&&!this.items[b].removed&&this.items[b].animateWith(h,q,q),this.items[b]&&!this.items[b].removed||w--;return this},ot.insertAfter=function(e){for(var t=this.items.length;t--;)this.items[t].insertAfter(e);return this},ot.getBBox=function(){for(var e=[],t=[],s=[],i=[],h=this.items.length;h--;)if(!this.items[h].removed){var m=this.items[h].getBBox();e.push(m.x),t.push(m.y),s.push(m.x+m.width),i.push(m.y+m.height)}return{x:e=Z[Q](0,e),y:t=Z[Q](0,t),x2:s=qe[Q](0,s),y2:i=qe[Q](0,i),width:s-e,height:i-t}},ot.clone=function(e){e=this.paper.set();for(var t=0,s=this.items.length;t<s;t++)e.push(this.items[t].clone());return e},ot.toString=function(){return"RaphaÃ«lâ€˜s set"},ot.glow=function(e){var t=this.paper.set();return this.forEach(function(s,i){var h=s.glow(e);h!=null&&h.forEach(function(m,w){t.push(m)})}),t},ot.isPointInside=function(e,t){var s=!1;return this.forEach(function(i){if(i.isPointInside(e,t))return s=!0,!1}),s},d.registerFont=function(e){if(!e.face)return e;this.fonts=this.fonts||{};var t={w:e.w,face:{},glyphs:{}},s=e.face["font-family"];for(var i in e.face)e.face[T](i)&&(t.face[i]=e.face[i]);if(this.fonts[s]?this.fonts[s].push(t):this.fonts[s]=[t],!e.svg){for(var h in t.face["units-per-em"]=N(e.face["units-per-em"],10),e.glyphs)if(e.glyphs[T](h)){var m=e.glyphs[h];if(t.glyphs[h]={w:m.w,k:{},d:m.d&&"M"+m.d.replace(/[mlcxtrv]/g,function(b){return{l:"L",c:"C",x:"z",t:"m",r:"l",v:"c"}[b]||"M"})+"z"},m.k)for(var w in m.k)m[T](w)&&(t.glyphs[h].k[w]=m.k[w])}}return e},B.getFont=function(e,t,s,i){if(i=i||"normal",s=s||"normal",t=+t||{normal:400,bold:700,lighter:300,bolder:800}[t]||400,d.fonts){var h,m=d.fonts[e];if(!m){var w=new RegExp("(^|\\s)"+e.replace(/[^\w\d\s+!~.:_-]/g,be)+"(\\s|$)","i");for(var b in d.fonts)if(d.fonts[T](b)&&w.test(b)){m=d.fonts[b];break}}if(m)for(var k=0,q=m.length;k<q&&((h=m[k]).face["font-weight"]!=t||h.face["font-style"]!=s&&h.face["font-style"]||h.face["font-stretch"]!=i);k++);return h}},B.print=function(e,t,s,i,h,m,w,b){m=m||"middle",w=qe(Z(w||0,1),-1),b=qe(Z(b||1,3),1);var k,q=se(s)[Se](be),ae=0,ge=0,ce=be;if(d.is(i,"string")&&(i=this.getFont(i)),i){k=(h||16)/i.face["units-per-em"];for(var re=i.face.bbox[Se](Y),he=+re[0],xe=re[3]-re[1],fe=0,le=+re[1]+(m=="baseline"?xe+ +i.face.descent:xe/2),Ne=0,ve=q.length;Ne<ve;Ne++){if(q[Ne]==`
`)ae=0,ye=0,ge=0,fe+=xe*b;else{var _e=ge&&i.glyphs[q[Ne-1]]||{},ye=i.glyphs[q[Ne]];ae+=ge?(_e.w||i.w)+(_e.k&&_e.k[q[Ne]]||0)+i.w*w:0,ge=1}ye&&ye.d&&(ce+=d.transformPath(ye.d,["t",ae*k,fe*k,"s",k,k,he,le,"t",(e-he)/k,(t-le)/k]))}}return this.path(ce).attr({fill:"#000",stroke:"none"})},B.add=function(e){if(d.is(e,"array"))for(var t,s=this.set(),i=0,h=e.length;i<h;i++)t=e[i]||{},U[T](t.type)&&s.push(this[t.type]().attr(t));return s},d.format=function(e,t){var s=d.is(t,pe)?[0][W](t):arguments;return e&&d.is(e,"string")&&s.length-1&&(e=e.replace(F,function(i,h){return s[++h]==null?be:s[h]})),e||be},d.fullfill=(ln=/\{([^\}]+)\}/g,cn=/(?:(?:^|\.)(.+?)(?=\[|\.|$|\()|\[('|")(.+?)\2\])(\(\))?/g,function(e,t){return String(e).replace(ln,function(s,i){return function(h,m,w){var b=w;return m.replace(cn,function(k,q,ae,ge,ce){q=q||ge,b&&(q in b&&(b=b[q]),typeof b=="function"&&ce&&(b=b()))}),b=(b==null||b==w?h:b)+""}(s,i,t)})}),d.ninja=function(){if(ee.was)O.win.Raphael=ee.is;else{window.Raphael=void 0;try{delete window.Raphael}catch(e){}}return d},d.st=ot,l.on("raphael.DOMload",function(){x=!0}),(wt=document).readyState==null&&wt.addEventListener&&(wt.addEventListener("DOMContentLoaded",un=function(){wt.removeEventListener("DOMContentLoaded",un,!1),wt.readyState="complete"},!1),wt.readyState="loading"),function e(){/in/.test(wt.readyState)?setTimeout(e,9):d.eve("raphael.DOMload")}(),d}.apply(G,$))===void 0||(M.exports=I)},function(M,G,X){var $,I;$=[X(0),X(3),X(4)],(I=function(l){return l}.apply(G,$))===void 0||(M.exports=I)},function(M,G,X){var $,I,l,d,x,B,Y,U,F,T,O,ee,de,Q;d="hasOwnProperty",x=/[\.\/]/,B=/\s*,\s*/,Y=function(W,me){return W-me},U={n:{}},F=function(){for(var W=0,me=this.length;W<me;W++)if(this[W]!==void 0)return this[W]},T=function(){for(var W=this.length;--W;)if(this[W]!==void 0)return this[W]},O=Object.prototype.toString,ee=String,de=Array.isArray||function(W){return W instanceof Array||O.call(W)=="[object Array]"},(Q=function(W,me){var be,ke=l,se=Array.prototype.slice.call(arguments,2),Se=Q.listeners(W),Ie=0,We=[],De={},Ee=[],qe=I;Ee.firstDefined=F,Ee.lastDefined=T,I=W,l=0;for(var Z=0,Re=Se.length;Z<Re;Z++)"zIndex"in Se[Z]&&(We.push(Se[Z].zIndex),Se[Z].zIndex<0&&(De[Se[Z].zIndex]=Se[Z]));for(We.sort(Y);We[Ie]<0;)if(be=De[We[Ie++]],Ee.push(be.apply(me,se)),l)return l=ke,Ee;for(Z=0;Z<Re;Z++)if("zIndex"in(be=Se[Z]))if(be.zIndex==We[Ie]){if(Ee.push(be.apply(me,se)),l)break;do if((be=De[We[++Ie]])&&Ee.push(be.apply(me,se)),l)break;while(be)}else De[be.zIndex]=be;else if(Ee.push(be.apply(me,se)),l)break;return l=ke,I=qe,Ee})._events=U,Q.listeners=function(W){var me,be,ke,se,Se,Ie,We,De,Ee=de(W)?W:W.split(x),qe=U,Z=[qe],Re=[];for(se=0,Se=Ee.length;se<Se;se++){for(De=[],Ie=0,We=Z.length;Ie<We;Ie++)for(be=[(qe=Z[Ie].n)[Ee[se]],qe["*"]],ke=2;ke--;)(me=be[ke])&&(De.push(me),Re=Re.concat(me.f||[]));Z=De}return Re},Q.separator=function(W){W?(W="["+(W=ee(W).replace(/(?=[\.\^\]\[\-])/g,"\\"))+"]",x=new RegExp(W)):x=/[\.\/]/},Q.on=function(W,me){if(typeof me!="function")return function(){};for(var be=de(W)?de(W[0])?W:[W]:ee(W).split(B),ke=0,se=be.length;ke<se;ke++)(function(Se){for(var Ie,We=de(Se)?Se:ee(Se).split(x),De=U,Ee=0,qe=We.length;Ee<qe;Ee++)De=(De=De.n).hasOwnProperty(We[Ee])&&De[We[Ee]]||(De[We[Ee]]={n:{}});for(De.f=De.f||[],Ee=0,qe=De.f.length;Ee<qe;Ee++)if(De.f[Ee]==me){Ie=!0;break}!Ie&&De.f.push(me)})(be[ke]);return function(Se){+Se==+Se&&(me.zIndex=+Se)}},Q.f=function(W){var me=[].slice.call(arguments,1);return function(){Q.apply(null,[W,null].concat(me).concat([].slice.call(arguments,0)))}},Q.stop=function(){l=1},Q.nt=function(W){var me=de(I)?I.join("."):I;return W?new RegExp("(?:\\.|\\/|^)"+W+"(?:\\.|\\/|$)").test(me):me},Q.nts=function(){return de(I)?I:I.split(x)},Q.off=Q.unbind=function(W,me){if(W){var be=de(W)?de(W[0])?W:[W]:ee(W).split(B);if(be.length>1)for(var ke=0,se=be.length;ke<se;ke++)Q.off(be[ke],me);else{be=de(W)?W:ee(W).split(x);var Se,Ie,We,De,Ee,qe=[U];for(ke=0,se=be.length;ke<se;ke++)for(De=0;De<qe.length;De+=We.length-2){if(We=[De,1],Se=qe[De].n,be[ke]!="*")Se[be[ke]]&&We.push(Se[be[ke]]);else for(Ie in Se)Se[d](Ie)&&We.push(Se[Ie]);qe.splice.apply(qe,We)}for(ke=0,se=qe.length;ke<se;ke++)for(Se=qe[ke];Se.n;){if(me){if(Se.f){for(De=0,Ee=Se.f.length;De<Ee;De++)if(Se.f[De]==me){Se.f.splice(De,1);break}!Se.f.length&&delete Se.f}for(Ie in Se.n)if(Se.n[d](Ie)&&Se.n[Ie].f){var Z=Se.n[Ie].f;for(De=0,Ee=Z.length;De<Ee;De++)if(Z[De]==me){Z.splice(De,1);break}!Z.length&&delete Se.n[Ie].f}}else for(Ie in delete Se.f,Se.n)Se.n[d](Ie)&&Se.n[Ie].f&&delete Se.n[Ie].f;Se=Se.n}}}else Q._events=U={n:{}}},Q.once=function(W,me){var be=function(){return Q.off(W,be),me.apply(this,arguments)};return Q.on(W,be)},Q.version="0.5.0",Q.toString=function(){return"You are running Eve 0.5.0"},M.exports?M.exports=Q:($=function(){return Q}.apply(G,[]))===void 0||(M.exports=$)},function(M,G,X){var $,I;$=[X(0)],(I=function(l){if(!l||l.svg){var d="hasOwnProperty",x=String,B=parseFloat,Y=parseInt,U=Math,F=U.max,T=U.abs,O=U.pow,ee=/[, ]+/,de=l.eve,Q="",W=" ",me="http://www.w3.org/1999/xlink",be={block:"M5,0 0,2.5 5,5z",classic:"M5,0 0,2.5 5,5 3.5,3 3.5,2z",diamond:"M2.5,0 5,2.5 2.5,5 0,2.5z",open:"M6,1 1,3.5 6,6",oval:"M2.5,0A2.5,2.5,0,0,1,2.5,5 2.5,2.5,0,0,1,2.5,0z"},ke={};l.toString=function(){return`Your browser supports SVG.
You are running RaphaÃ«l `+this.version};var se=function(p,u){if(u)for(var c in typeof p=="string"&&(p=se(p)),u)u[d](c)&&(c.substring(0,6)=="xlink:"?p.setAttributeNS(me,c.substring(6),x(u[c])):p.setAttribute(c,x(u[c])));else(p=l._g.doc.createElementNS("http://www.w3.org/2000/svg",p)).style&&(p.style.webkitTapHighlightColor="rgba(0,0,0,0)");return p},Se=function(p,u){var c="linear",g=p.id+u,S=.5,N=.5,H=p.node,ne=p.paper,j=H.style,K=l._g.doc.getElementById(g);if(!K){if(u=(u=x(u).replace(l._radial_gradient,function($e,Ye,Fe){if(c="radial",Ye&&Fe){S=B(Ye);var et=2*((N=B(Fe))>.5)-1;O(S-.5,2)+O(N-.5,2)>.25&&(N=U.sqrt(.25-O(S-.5,2))*et+.5)&&N!=.5&&(N=N.toFixed(5)-1e-5*et)}return Q})).split(/\s*\-\s*/),c=="linear"){var ie=u.shift();if(ie=-B(ie),isNaN(ie))return null;var E=[0,0,U.cos(l.rad(ie)),U.sin(l.rad(ie))],Pe=1/(F(T(E[2]),T(E[3]))||1);E[2]*=Pe,E[3]*=Pe,E[2]<0&&(E[0]=-E[2],E[2]=0),E[3]<0&&(E[1]=-E[3],E[3]=0)}var L=l._parseDots(u);if(!L)return null;if(g=g.replace(/[\(\)\s,\xb0#]/g,"_"),p.gradient&&g!=p.gradient.id&&(ne.defs.removeChild(p.gradient),delete p.gradient),!p.gradient){K=se(c+"Gradient",{id:g}),p.gradient=K,se(K,c=="radial"?{fx:S,fy:N}:{x1:E[0],y1:E[1],x2:E[2],y2:E[3],gradientTransform:p.matrix.invert()}),ne.defs.appendChild(K);for(var Ae=0,He=L.length;Ae<He;Ae++)K.appendChild(se("stop",{offset:L[Ae].offset?L[Ae].offset:Ae?"100%":"0%","stop-color":L[Ae].color||"#fff","stop-opacity":isFinite(L[Ae].opacity)?L[Ae].opacity:1}))}}return se(H,{fill:Ie(g),opacity:1,"fill-opacity":1}),j.fill=Q,j.opacity=1,j.fillOpacity=1,1},Ie=function(p){if((u=document.documentMode)&&(u===9||u===10))return"url('#"+p+"')";var u,c=document.location;return"url('"+(c.protocol+"//"+c.host+c.pathname+c.search)+"#"+p+"')"},We=function(p){var u=p.getBBox(1);se(p.pattern,{patternTransform:p.matrix.invert()+" translate("+u.x+","+u.y+")"})},De=function(p,u,c){if(p.type=="path"){for(var g,S,N,H,ne,j=x(u).toLowerCase().split("-"),K=p.paper,ie=c?"end":"start",E=p.node,Pe=p.attrs,L=Pe["stroke-width"],Ae=j.length,He="classic",$e=3,Ye=3,Fe=5;Ae--;)switch(j[Ae]){case"block":case"classic":case"oval":case"diamond":case"open":case"none":He=j[Ae];break;case"wide":Ye=5;break;case"narrow":Ye=2;break;case"long":$e=5;break;case"short":$e=2}if(He=="open"?($e+=2,Ye+=2,Fe+=2,N=1,H=c?4:1,ne={fill:"none",stroke:Pe.stroke}):(H=N=$e/2,ne={fill:Pe.stroke,stroke:"none"}),p._.arrows?c?(p._.arrows.endPath&&ke[p._.arrows.endPath]--,p._.arrows.endMarker&&ke[p._.arrows.endMarker]--):(p._.arrows.startPath&&ke[p._.arrows.startPath]--,p._.arrows.startMarker&&ke[p._.arrows.startMarker]--):p._.arrows={},He!="none"){var et="raphael-marker-"+He,nt="raphael-marker-"+ie+He+$e+Ye+"-obj"+p.id;l._g.doc.getElementById(et)?ke[et]++:(K.defs.appendChild(se(se("path"),{"stroke-linecap":"round",d:be[He],id:et})),ke[et]=1);var at,Ke=l._g.doc.getElementById(nt);Ke?(ke[nt]++,at=Ke.getElementsByTagName("use")[0]):(Ke=se(se("marker"),{id:nt,markerHeight:Ye,markerWidth:$e,orient:"auto",refX:H,refY:Ye/2}),at=se(se("use"),{"xlink:href":"#"+et,transform:(c?"rotate(180 "+$e/2+" "+Ye/2+") ":Q)+"scale("+$e/Fe+","+Ye/Fe+")","stroke-width":(1/(($e/Fe+Ye/Fe)/2)).toFixed(4)}),Ke.appendChild(at),K.defs.appendChild(Ke),ke[nt]=1),se(at,ne);var n=N*(He!="diamond"&&He!="oval");c?(g=p._.arrows.startdx*L||0,S=l.getTotalLength(Pe.path)-n*L):(g=n*L,S=l.getTotalLength(Pe.path)-(p._.arrows.enddx*L||0)),(ne={})["marker-"+ie]="url(#"+nt+")",(S||g)&&(ne.d=l.getSubpath(Pe.path,g,S)),se(E,ne),p._.arrows[ie+"Path"]=et,p._.arrows[ie+"Marker"]=nt,p._.arrows[ie+"dx"]=n,p._.arrows[ie+"Type"]=He,p._.arrows[ie+"String"]=u}else c?(g=p._.arrows.startdx*L||0,S=l.getTotalLength(Pe.path)-g):(g=0,S=l.getTotalLength(Pe.path)-(p._.arrows.enddx*L||0)),p._.arrows[ie+"Path"]&&se(E,{d:l.getSubpath(Pe.path,g,S)}),delete p._.arrows[ie+"Path"],delete p._.arrows[ie+"Marker"],delete p._.arrows[ie+"dx"],delete p._.arrows[ie+"Type"],delete p._.arrows[ie+"String"];for(ne in ke)if(ke[d](ne)&&!ke[ne]){var r=l._g.doc.getElementById(ne);r&&r.parentNode.removeChild(r)}}},Ee={"-":[3,1],".":[1,1],"-.":[3,1,1,1],"-..":[3,1,1,1,1,1],". ":[1,3],"- ":[4,3],"--":[8,3],"- .":[4,3,1,3],"--.":[8,3,1,3],"--..":[8,3,1,3,1,3]},qe=function(p,u,c){if(u=Ee[x(u).toLowerCase()]){for(var g=p.attrs["stroke-width"]||"1",S={round:g,square:g,butt:0}[p.attrs["stroke-linecap"]||c["stroke-linecap"]]||0,N=[],H=u.length;H--;)N[H]=u[H]*g+(H%2?1:-1)*S;se(p.node,{"stroke-dasharray":N.join(",")})}else se(p.node,{"stroke-dasharray":"none"})},Z=function(p,u){var c=p.node,g=p.attrs,S=c.style.visibility;for(var N in c.style.visibility="hidden",u)if(u[d](N)){if(!l._availableAttrs[d](N))continue;var H=u[N];switch(g[N]=H,N){case"blur":p.blur(H);break;case"title":var ne=c.getElementsByTagName("title");if(ne.length&&(ne=ne[0]))ne.firstChild.nodeValue=H;else{ne=se("title");var j=l._g.doc.createTextNode(H);ne.appendChild(j),c.appendChild(ne)}break;case"href":case"target":var K=c.parentNode;if(K.tagName.toLowerCase()!="a"){var ie=se("a");K.insertBefore(ie,c),ie.appendChild(c),K=ie}N=="target"?K.setAttributeNS(me,"show",H=="blank"?"new":H):K.setAttributeNS(me,N,H);break;case"cursor":c.style.cursor=H;break;case"transform":p.transform(H);break;case"arrow-start":De(p,H);break;case"arrow-end":De(p,H,1);break;case"clip-rect":var E=x(H).split(ee);if(E.length==4){p.clip&&p.clip.parentNode.parentNode.removeChild(p.clip.parentNode);var Pe=se("clipPath"),L=se("rect");Pe.id=l.createUUID(),se(L,{x:E[0],y:E[1],width:E[2],height:E[3]}),Pe.appendChild(L),p.paper.defs.appendChild(Pe),se(c,{"clip-path":"url(#"+Pe.id+")"}),p.clip=L}if(!H){var Ae=c.getAttribute("clip-path");if(Ae){var He=l._g.doc.getElementById(Ae.replace(/(^url\(#|\)$)/g,Q));He&&He.parentNode.removeChild(He),se(c,{"clip-path":Q}),delete p.clip}}break;case"path":p.type=="path"&&(se(c,{d:H?g.path=l._pathToAbsolute(H):"M0,0"}),p._.dirty=1,p._.arrows&&("startString"in p._.arrows&&De(p,p._.arrows.startString),"endString"in p._.arrows&&De(p,p._.arrows.endString,1)));break;case"width":if(c.setAttribute(N,H),p._.dirty=1,!g.fx)break;N="x",H=g.x;case"x":g.fx&&(H=-g.x-(g.width||0));case"rx":if(N=="rx"&&p.type=="rect")break;case"cx":c.setAttribute(N,H),p.pattern&&We(p),p._.dirty=1;break;case"height":if(c.setAttribute(N,H),p._.dirty=1,!g.fy)break;N="y",H=g.y;case"y":g.fy&&(H=-g.y-(g.height||0));case"ry":if(N=="ry"&&p.type=="rect")break;case"cy":c.setAttribute(N,H),p.pattern&&We(p),p._.dirty=1;break;case"r":p.type=="rect"?se(c,{rx:H,ry:H}):c.setAttribute(N,H),p._.dirty=1;break;case"src":p.type=="image"&&c.setAttributeNS(me,"href",H);break;case"stroke-width":p._.sx==1&&p._.sy==1||(H/=F(T(p._.sx),T(p._.sy))||1),c.setAttribute(N,H),g["stroke-dasharray"]&&qe(p,g["stroke-dasharray"],u),p._.arrows&&("startString"in p._.arrows&&De(p,p._.arrows.startString),"endString"in p._.arrows&&De(p,p._.arrows.endString,1));break;case"stroke-dasharray":qe(p,H,u);break;case"fill":var $e=x(H).match(l._ISURL);if($e){Pe=se("pattern");var Ye=se("image");Pe.id=l.createUUID(),se(Pe,{x:0,y:0,patternUnits:"userSpaceOnUse",height:1,width:1}),se(Ye,{x:0,y:0,"xlink:href":$e[1]}),Pe.appendChild(Ye),function(Ke){l._preload($e[1],function(){var n=this.offsetWidth,r=this.offsetHeight;se(Ke,{width:n,height:r}),se(Ye,{width:n,height:r})})}(Pe),p.paper.defs.appendChild(Pe),se(c,{fill:"url(#"+Pe.id+")"}),p.pattern=Pe,p.pattern&&We(p);break}var Fe=l.getRGB(H);if(Fe.error){if((p.type=="circle"||p.type=="ellipse"||x(H).charAt()!="r")&&Se(p,H)){if("opacity"in g||"fill-opacity"in g){var et=l._g.doc.getElementById(c.getAttribute("fill").replace(/^url\(#|\)$/g,Q));if(et){var nt=et.getElementsByTagName("stop");se(nt[nt.length-1],{"stop-opacity":("opacity"in g?g.opacity:1)*("fill-opacity"in g?g["fill-opacity"]:1)})}}g.gradient=H,g.fill="none";break}}else delete u.gradient,delete g.gradient,!l.is(g.opacity,"undefined")&&l.is(u.opacity,"undefined")&&se(c,{opacity:g.opacity}),!l.is(g["fill-opacity"],"undefined")&&l.is(u["fill-opacity"],"undefined")&&se(c,{"fill-opacity":g["fill-opacity"]});Fe[d]("opacity")&&se(c,{"fill-opacity":Fe.opacity>1?Fe.opacity/100:Fe.opacity});case"stroke":Fe=l.getRGB(H),c.setAttribute(N,Fe.hex),N=="stroke"&&Fe[d]("opacity")&&se(c,{"stroke-opacity":Fe.opacity>1?Fe.opacity/100:Fe.opacity}),N=="stroke"&&p._.arrows&&("startString"in p._.arrows&&De(p,p._.arrows.startString),"endString"in p._.arrows&&De(p,p._.arrows.endString,1));break;case"gradient":(p.type=="circle"||p.type=="ellipse"||x(H).charAt()!="r")&&Se(p,H);break;case"opacity":g.gradient&&!g[d]("stroke-opacity")&&se(c,{"stroke-opacity":H>1?H/100:H});case"fill-opacity":if(g.gradient){(et=l._g.doc.getElementById(c.getAttribute("fill").replace(/^url\(#|\)$/g,Q)))&&(nt=et.getElementsByTagName("stop"),se(nt[nt.length-1],{"stop-opacity":H}));break}default:N=="font-size"&&(H=Y(H,10)+"px");var at=N.replace(/(\-.)/g,function(Ke){return Ke.substring(1).toUpperCase()});c.style[at]=H,p._.dirty=1,c.setAttribute(N,H)}}Re(p,u),c.style.visibility=S},Re=function(p,u){if(p.type=="text"&&(u[d]("text")||u[d]("font")||u[d]("font-size")||u[d]("x")||u[d]("y"))){var c=p.attrs,g=p.node,S=g.firstChild?Y(l._g.doc.defaultView.getComputedStyle(g.firstChild,Q).getPropertyValue("font-size"),10):10;if(u[d]("text")){for(c.text=u.text;g.firstChild;)g.removeChild(g.firstChild);for(var N,H=x(u.text).split(`
`),ne=[],j=0,K=H.length;j<K;j++)N=se("tspan"),j&&se(N,{dy:1.2*S,x:c.x}),N.appendChild(l._g.doc.createTextNode(H[j])),g.appendChild(N),ne[j]=N}else for(j=0,K=(ne=g.getElementsByTagName("tspan")).length;j<K;j++)j?se(ne[j],{dy:1.2*S,x:c.x}):se(ne[0],{dy:0});se(g,{x:c.x,y:c.y}),p._.dirty=1;var ie=p._getBBox(),E=c.y-(ie.y+ie.height/2);E&&l.is(E,"finite")&&se(ne[0],{dy:E})}},Me=function(p){return p.parentNode&&p.parentNode.tagName.toLowerCase()==="a"?p.parentNode:p},ue=function(p,u){this[0]=this.node=p,p.raphael=!0,this.id=("0000"+(Math.random()*Math.pow(36,5)<<0).toString(36)).slice(-5),p.raphaelid=this.id,this.matrix=l.matrix(),this.realPath=null,this.paper=u,this.attrs=this.attrs||{},this._={transform:[],sx:1,sy:1,deg:0,dx:0,dy:0,dirty:1},!u.bottom&&(u.bottom=this),this.prev=u.top,u.top&&(u.top.next=this),u.top=this,this.next=null},te=l.el;ue.prototype=te,te.constructor=ue,l._engine.path=function(p,u){var c=se("path");u.canvas&&u.canvas.appendChild(c);var g=new ue(c,u);return g.type="path",Z(g,{fill:"none",stroke:"#000",path:p}),g},te.rotate=function(p,u,c){if(this.removed)return this;if((p=x(p).split(ee)).length-1&&(u=B(p[1]),c=B(p[2])),p=B(p[0]),c==null&&(u=c),u==null||c==null){var g=this.getBBox(1);u=g.x+g.width/2,c=g.y+g.height/2}return this.transform(this._.transform.concat([["r",p,u,c]])),this},te.scale=function(p,u,c,g){if(this.removed)return this;if((p=x(p).split(ee)).length-1&&(u=B(p[1]),c=B(p[2]),g=B(p[3])),p=B(p[0]),u==null&&(u=p),g==null&&(c=g),c==null||g==null)var S=this.getBBox(1);return c=c==null?S.x+S.width/2:c,g=g==null?S.y+S.height/2:g,this.transform(this._.transform.concat([["s",p,u,c,g]])),this},te.translate=function(p,u){return this.removed?this:((p=x(p).split(ee)).length-1&&(u=B(p[1])),p=B(p[0])||0,u=+u||0,this.transform(this._.transform.concat([["t",p,u]])),this)},te.transform=function(p){var u=this._;if(p==null)return u.transform;if(l._extractTransform(this,p),this.clip&&se(this.clip,{transform:this.matrix.invert()}),this.pattern&&We(this),this.node&&se(this.node,{transform:this.matrix}),u.sx!=1||u.sy!=1){var c=this.attrs[d]("stroke-width")?this.attrs["stroke-width"]:1;this.attr({"stroke-width":c})}return this},te.hide=function(){return this.removed||(this.node.style.display="none"),this},te.show=function(){return this.removed||(this.node.style.display=""),this},te.remove=function(){var p=Me(this.node);if(!this.removed&&p.parentNode){var u=this.paper;for(var c in u.__set__&&u.__set__.exclude(this),de.unbind("raphael.*.*."+this.id),this.gradient&&u.defs.removeChild(this.gradient),l._tear(this,u),p.parentNode.removeChild(p),this.removeData(),this)this[c]=typeof this[c]=="function"?l._removedFactory(c):null;this.removed=!0}},te._getBBox=function(){if(this.node.style.display=="none"){this.show();var p=!0}var u,c=!1;this.paper.canvas.parentElement?u=this.paper.canvas.parentElement.style:this.paper.canvas.parentNode&&(u=this.paper.canvas.parentNode.style),u&&u.display=="none"&&(c=!0,u.display="");var g={};try{g=this.node.getBBox()}catch(S){g={x:this.node.clientLeft,y:this.node.clientTop,width:this.node.clientWidth,height:this.node.clientHeight}}finally{g=g||{},c&&(u.display="none")}return p&&this.hide(),g},te.attr=function(p,u){if(this.removed)return this;if(p==null){var c={};for(var g in this.attrs)this.attrs[d](g)&&(c[g]=this.attrs[g]);return c.gradient&&c.fill=="none"&&(c.fill=c.gradient)&&delete c.gradient,c.transform=this._.transform,c}if(u==null&&l.is(p,"string")){if(p=="fill"&&this.attrs.fill=="none"&&this.attrs.gradient)return this.attrs.gradient;if(p=="transform")return this._.transform;for(var S=p.split(ee),N={},H=0,ne=S.length;H<ne;H++)(p=S[H])in this.attrs?N[p]=this.attrs[p]:l.is(this.paper.customAttributes[p],"function")?N[p]=this.paper.customAttributes[p].def:N[p]=l._availableAttrs[p];return ne-1?N:N[S[0]]}if(u==null&&l.is(p,"array")){for(N={},H=0,ne=p.length;H<ne;H++)N[p[H]]=this.attr(p[H]);return N}if(u!=null){var j={};j[p]=u}else p!=null&&l.is(p,"object")&&(j=p);for(var K in j)de("raphael.attr."+K+"."+this.id,this,j[K]);for(K in this.paper.customAttributes)if(this.paper.customAttributes[d](K)&&j[d](K)&&l.is(this.paper.customAttributes[K],"function")){var ie=this.paper.customAttributes[K].apply(this,[].concat(j[K]));for(var E in this.attrs[K]=j[K],ie)ie[d](E)&&(j[E]=ie[E])}return Z(this,j),this},te.toFront=function(){if(this.removed)return this;var p=Me(this.node);p.parentNode.appendChild(p);var u=this.paper;return u.top!=this&&l._tofront(this,u),this},te.toBack=function(){if(this.removed)return this;var p=Me(this.node),u=p.parentNode;return u.insertBefore(p,u.firstChild),l._toback(this,this.paper),this.paper,this},te.insertAfter=function(p){if(this.removed||!p)return this;var u=Me(this.node),c=Me(p.node||p[p.length-1].node);return c.nextSibling?c.parentNode.insertBefore(u,c.nextSibling):c.parentNode.appendChild(u),l._insertafter(this,p,this.paper),this},te.insertBefore=function(p){if(this.removed||!p)return this;var u=Me(this.node),c=Me(p.node||p[0].node);return c.parentNode.insertBefore(u,c),l._insertbefore(this,p,this.paper),this},te.blur=function(p){var u=this;if(+p!=0){var c=se("filter"),g=se("feGaussianBlur");u.attrs.blur=p,c.id=l.createUUID(),se(g,{stdDeviation:+p||1.5}),c.appendChild(g),u.paper.defs.appendChild(c),u._blur=c,se(u.node,{filter:"url(#"+c.id+")"})}else u._blur&&(u._blur.parentNode.removeChild(u._blur),delete u._blur,delete u.attrs.blur),u.node.removeAttribute("filter");return u},l._engine.circle=function(p,u,c,g){var S=se("circle");p.canvas&&p.canvas.appendChild(S);var N=new ue(S,p);return N.attrs={cx:u,cy:c,r:g,fill:"none",stroke:"#000"},N.type="circle",se(S,N.attrs),N},l._engine.rect=function(p,u,c,g,S,N){var H=se("rect");p.canvas&&p.canvas.appendChild(H);var ne=new ue(H,p);return ne.attrs={x:u,y:c,width:g,height:S,rx:N||0,ry:N||0,fill:"none",stroke:"#000"},ne.type="rect",se(H,ne.attrs),ne},l._engine.ellipse=function(p,u,c,g,S){var N=se("ellipse");p.canvas&&p.canvas.appendChild(N);var H=new ue(N,p);return H.attrs={cx:u,cy:c,rx:g,ry:S,fill:"none",stroke:"#000"},H.type="ellipse",se(N,H.attrs),H},l._engine.image=function(p,u,c,g,S,N){var H=se("image");se(H,{x:c,y:g,width:S,height:N,preserveAspectRatio:"none"}),H.setAttributeNS(me,"href",u),p.canvas&&p.canvas.appendChild(H);var ne=new ue(H,p);return ne.attrs={x:c,y:g,width:S,height:N,src:u},ne.type="image",ne},l._engine.text=function(p,u,c,g){var S=se("text");p.canvas&&p.canvas.appendChild(S);var N=new ue(S,p);return N.attrs={x:u,y:c,"text-anchor":"middle",text:g,"font-family":l._availableAttrs["font-family"],"font-size":l._availableAttrs["font-size"],stroke:"none",fill:"#000"},N.type="text",Z(N,N.attrs),N},l._engine.setSize=function(p,u){return this.width=p||this.width,this.height=u||this.height,this.canvas.setAttribute("width",this.width),this.canvas.setAttribute("height",this.height),this._viewBox&&this.setViewBox.apply(this,this._viewBox),this},l._engine.create=function(){var p=l._getContainer.apply(0,arguments),u=p&&p.container;if(!u)throw new Error("SVG container not found.");var c,g=p.x,S=p.y,N=p.width,H=p.height,ne=se("svg"),j="overflow:hidden;";return g=g||0,S=S||0,se(ne,{height:H=H||342,version:1.1,width:N=N||512,xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink"}),u==1?(ne.style.cssText=j+"position:absolute;left:"+g+"px;top:"+S+"px",l._g.doc.body.appendChild(ne),c=1):(ne.style.cssText=j+"position:relative",u.firstChild?u.insertBefore(ne,u.firstChild):u.appendChild(ne)),(u=new l._Paper).width=N,u.height=H,u.canvas=ne,u.clear(),u._left=u._top=0,c&&(u.renderfix=function(){}),u.renderfix(),u},l._engine.setViewBox=function(p,u,c,g,S){de("raphael.setViewBox",this,this._viewBox,[p,u,c,g,S]);var N,H,ne=this.getSize(),j=F(c/ne.width,g/ne.height),K=this.top,ie=S?"xMidYMid meet":"xMinYMin";for(p==null?(this._vbSize&&(j=1),delete this._vbSize,N="0 0 "+this.width+W+this.height):(this._vbSize=j,N=p+W+u+W+c+W+g),se(this.canvas,{viewBox:N,preserveAspectRatio:ie});j&&K;)H="stroke-width"in K.attrs?K.attrs["stroke-width"]:1,K.attr({"stroke-width":H}),K._.dirty=1,K._.dirtyT=1,K=K.prev;return this._viewBox=[p,u,c,g,!!S],this},l.prototype.renderfix=function(){var p,u=this.canvas,c=u.style;try{p=u.getScreenCTM()||u.createSVGMatrix()}catch(N){p=u.createSVGMatrix()}var g=-p.e%1,S=-p.f%1;(g||S)&&(g&&(this._left=(this._left+g)%1,c.left=this._left+"px"),S&&(this._top=(this._top+S)%1,c.top=this._top+"px"))},l.prototype.clear=function(){l.eve("raphael.clear",this);for(var p=this.canvas;p.firstChild;)p.removeChild(p.firstChild);this.bottom=this.top=null,(this.desc=se("desc")).appendChild(l._g.doc.createTextNode("Created with RaphaÃ«l "+l.version)),p.appendChild(this.desc),p.appendChild(this.defs=se("defs"))},l.prototype.remove=function(){for(var p in de("raphael.remove",this),this.canvas.parentNode&&this.canvas.parentNode.removeChild(this.canvas),this)this[p]=typeof this[p]=="function"?l._removedFactory(p):null};var pe=l.st;for(var Ce in te)te[d](Ce)&&!pe[d](Ce)&&(pe[Ce]=function(p){return function(){var u=arguments;return this.forEach(function(c){c[p].apply(c,u)})}}(Ce))}}.apply(G,$))===void 0||(M.exports=I)},function(M,G,X){var $,I;$=[X(0)],(I=function(l){if(!l||l.vml){var d="hasOwnProperty",x=String,B=parseFloat,Y=Math,U=Y.round,F=Y.max,T=Y.min,O=Y.abs,ee=/[, ]+/,de=l.eve,Q=" ",W="",me={M:"m",L:"l",C:"c",Z:"x",m:"t",l:"r",c:"v",z:"x"},be=/([clmz]),?([^clmz]*)/gi,ke=/ progid:\S+Blur\([^\)]+\)/g,se=/-?[^,\s-]+/g,Se="position:absolute;left:0;top:0;width:1px;height:1px;behavior:url(#default#VML)",Ie=21600,We={path:1,rect:1,image:1},De={circle:1,ellipse:1},Ee=function(u,c,g){var S=l.matrix();return S.rotate(-u,.5,.5),{dx:S.x(c,g),dy:S.y(c,g)}},qe=function(u,c,g,S,N,H){var ne=u._,j=u.matrix,K=ne.fillpos,ie=u.node,E=ie.style,Pe=1,L="",Ae=Ie/c,He=Ie/g;if(E.visibility="hidden",c&&g){if(ie.coordsize=O(Ae)+Q+O(He),E.rotation=H*(c*g<0?-1:1),H){var $e=Ee(H,S,N);S=$e.dx,N=$e.dy}if(c<0&&(L+="x"),g<0&&(L+=" y")&&(Pe=-1),E.flip=L,ie.coordorigin=S*-Ae+Q+N*-He,K||ne.fillsize){var Ye=ie.getElementsByTagName("fill");Ye=Ye&&Ye[0],ie.removeChild(Ye),K&&($e=Ee(H,j.x(K[0],K[1]),j.y(K[0],K[1])),Ye.position=$e.dx*Pe+Q+$e.dy*Pe),ne.fillsize&&(Ye.size=ne.fillsize[0]*O(c)+Q+ne.fillsize[1]*O(g)),ie.appendChild(Ye)}E.visibility="visible"}};l.toString=function(){return`Your browser doesnâ€™t support SVG. Falling down to VML.
You are running RaphaÃ«l `+this.version};var Z,Re=function(u,c,g){for(var S=x(c).toLowerCase().split("-"),N=g?"end":"start",H=S.length,ne="classic",j="medium",K="medium";H--;)switch(S[H]){case"block":case"classic":case"oval":case"diamond":case"open":case"none":ne=S[H];break;case"wide":case"narrow":K=S[H];break;case"long":case"short":j=S[H]}var ie=u.node.getElementsByTagName("stroke")[0];ie[N+"arrow"]=ne,ie[N+"arrowlength"]=j,ie[N+"arrowwidth"]=K},Me=function(u,c){u.attrs=u.attrs||{};var g=u.node,S=u.attrs,N=g.style,H=We[u.type]&&(c.x!=S.x||c.y!=S.y||c.width!=S.width||c.height!=S.height||c.cx!=S.cx||c.cy!=S.cy||c.rx!=S.rx||c.ry!=S.ry||c.r!=S.r),ne=De[u.type]&&(S.cx!=c.cx||S.cy!=c.cy||S.r!=c.r||S.rx!=c.rx||S.ry!=c.ry),j=u;for(var K in c)c[d](K)&&(S[K]=c[K]);if(H&&(S.path=l._getPath[u.type](u),u._.dirty=1),c.href&&(g.href=c.href),c.title&&(g.title=c.title),c.target&&(g.target=c.target),c.cursor&&(N.cursor=c.cursor),"blur"in c&&u.blur(c.blur),(c.path&&u.type=="path"||H)&&(g.path=function(J){var oe=/[ahqstv]/gi,we=l._pathToAbsolute;if(x(J).match(oe)&&(we=l._path2curve),oe=/[clmz]/g,we==l._pathToAbsolute&&!x(J).match(oe)){var Le=x(J).replace(be,function(lt,rt,st){var it=[],ct=rt.toLowerCase()=="m",pt=me[rt];return st.replace(se,function(dt){ct&&it.length==2&&(pt+=it+me[rt=="m"?"l":"L"],it=[]),it.push(U(dt*Ie))}),pt+it});return Le}var Be,Te,ze=we(J);Le=[];for(var Ue=0,Xe=ze.length;Ue<Xe;Ue++){Be=ze[Ue],(Te=ze[Ue][0].toLowerCase())=="z"&&(Te="x");for(var Ve=1,Je=Be.length;Ve<Je;Ve++)Te+=U(Be[Ve]*Ie)+(Ve!=Je-1?",":W);Le.push(Te)}return Le.join(Q)}(~x(S.path).toLowerCase().indexOf("r")?l._pathToAbsolute(S.path):S.path),u._.dirty=1,u.type=="image"&&(u._.fillpos=[S.x,S.y],u._.fillsize=[S.width,S.height],qe(u,1,1,0,0,0))),"transform"in c&&u.transform(c.transform),ne){var ie=+S.cx,E=+S.cy,Pe=+S.rx||+S.r||0,L=+S.ry||+S.r||0;g.path=l.format("ar{0},{1},{2},{3},{4},{1},{4},{1}x",U((ie-Pe)*Ie),U((E-L)*Ie),U((ie+Pe)*Ie),U((E+L)*Ie),U(ie*Ie)),u._.dirty=1}if("clip-rect"in c){var Ae=x(c["clip-rect"]).split(ee);if(Ae.length==4){Ae[2]=+Ae[2]+ +Ae[0],Ae[3]=+Ae[3]+ +Ae[1];var He=g.clipRect||l._g.doc.createElement("div"),$e=He.style;$e.clip=l.format("rect({1}px {2}px {3}px {0}px)",Ae),g.clipRect||($e.position="absolute",$e.top=0,$e.left=0,$e.width=u.paper.width+"px",$e.height=u.paper.height+"px",g.parentNode.insertBefore(He,g),He.appendChild(g),g.clipRect=He)}c["clip-rect"]||g.clipRect&&(g.clipRect.style.clip="auto")}if(u.textpath){var Ye=u.textpath.style;c.font&&(Ye.font=c.font),c["font-family"]&&(Ye.fontFamily='"'+c["font-family"].split(",")[0].replace(/^['"]+|['"]+$/g,W)+'"'),c["font-size"]&&(Ye.fontSize=c["font-size"]),c["font-weight"]&&(Ye.fontWeight=c["font-weight"]),c["font-style"]&&(Ye.fontStyle=c["font-style"])}if("arrow-start"in c&&Re(j,c["arrow-start"]),"arrow-end"in c&&Re(j,c["arrow-end"],1),c.opacity!=null||c.fill!=null||c.src!=null||c.stroke!=null||c["stroke-width"]!=null||c["stroke-opacity"]!=null||c["fill-opacity"]!=null||c["stroke-dasharray"]!=null||c["stroke-miterlimit"]!=null||c["stroke-linejoin"]!=null||c["stroke-linecap"]!=null){var Fe=g.getElementsByTagName("fill");if(!(Fe=Fe&&Fe[0])&&(Fe=Z("fill")),u.type=="image"&&c.src&&(Fe.src=c.src),c.fill&&(Fe.on=!0),Fe.on!=null&&c.fill!="none"&&c.fill!==null||(Fe.on=!1),Fe.on&&c.fill){var et=x(c.fill).match(l._ISURL);if(et){Fe.parentNode==g&&g.removeChild(Fe),Fe.rotate=!0,Fe.src=et[1],Fe.type="tile";var nt=u.getBBox(1);Fe.position=nt.x+Q+nt.y,u._.fillpos=[nt.x,nt.y],l._preload(et[1],function(){u._.fillsize=[this.offsetWidth,this.offsetHeight]})}else Fe.color=l.getRGB(c.fill).hex,Fe.src=W,Fe.type="solid",l.getRGB(c.fill).error&&(j.type in{circle:1,ellipse:1}||x(c.fill).charAt()!="r")&&ue(j,c.fill,Fe)&&(S.fill="none",S.gradient=c.fill,Fe.rotate=!1)}if("fill-opacity"in c||"opacity"in c){var at=((+S["fill-opacity"]+1||2)-1)*((+S.opacity+1||2)-1)*((+l.getRGB(c.fill).o+1||2)-1);at=T(F(at,0),1),Fe.opacity=at,Fe.src&&(Fe.color="none")}g.appendChild(Fe);var Ke=g.getElementsByTagName("stroke")&&g.getElementsByTagName("stroke")[0],n=!1;!Ke&&(n=Ke=Z("stroke")),(c.stroke&&c.stroke!="none"||c["stroke-width"]||c["stroke-opacity"]!=null||c["stroke-dasharray"]||c["stroke-miterlimit"]||c["stroke-linejoin"]||c["stroke-linecap"])&&(Ke.on=!0),(c.stroke=="none"||c.stroke===null||Ke.on==null||c.stroke==0||c["stroke-width"]==0)&&(Ke.on=!1);var r=l.getRGB(c.stroke);Ke.on&&c.stroke&&(Ke.color=r.hex),at=((+S["stroke-opacity"]+1||2)-1)*((+S.opacity+1||2)-1)*((+r.o+1||2)-1);var a=.75*(B(c["stroke-width"])||1);if(at=T(F(at,0),1),c["stroke-width"]==null&&(a=S["stroke-width"]),c["stroke-width"]&&(Ke.weight=a),a&&a<1&&(at*=a)&&(Ke.weight=1),Ke.opacity=at,c["stroke-linejoin"]&&(Ke.joinstyle=c["stroke-linejoin"]||"miter"),Ke.miterlimit=c["stroke-miterlimit"]||8,c["stroke-linecap"]&&(Ke.endcap=c["stroke-linecap"]=="butt"?"flat":c["stroke-linecap"]=="square"?"square":"round"),"stroke-dasharray"in c){var o={"-":"shortdash",".":"shortdot","-.":"shortdashdot","-..":"shortdashdotdot",". ":"dot","- ":"dash","--":"longdash","- .":"dashdot","--.":"longdashdot","--..":"longdashdotdot"};Ke.dashstyle=o[d](c["stroke-dasharray"])?o[c["stroke-dasharray"]]:W}n&&g.appendChild(Ke)}if(j.type=="text"){j.paper.canvas.style.display=W;var f=j.paper.span,v=S.font&&S.font.match(/\d+(?:\.\d*)?(?=px)/);N=f.style,S.font&&(N.font=S.font),S["font-family"]&&(N.fontFamily=S["font-family"]),S["font-weight"]&&(N.fontWeight=S["font-weight"]),S["font-style"]&&(N.fontStyle=S["font-style"]),v=B(S["font-size"]||v&&v[0])||10,N.fontSize=100*v+"px",j.textpath.string&&(f.innerHTML=x(j.textpath.string).replace(/</g,"&#60;").replace(/&/g,"&#38;").replace(/\n/g,"<br>"));var P=f.getBoundingClientRect();j.W=S.w=(P.right-P.left)/100,j.H=S.h=(P.bottom-P.top)/100,j.X=S.x,j.Y=S.y+j.H/2,("x"in c||"y"in c)&&(j.path.v=l.format("m{0},{1}l{2},{1}",U(S.x*Ie),U(S.y*Ie),U(S.x*Ie)+1));for(var z=["x","y","text","font","font-family","font-weight","font-style","font-size"],D=0,V=z.length;D<V;D++)if(z[D]in c){j._.dirty=1;break}switch(S["text-anchor"]){case"start":j.textpath.style["v-text-align"]="left",j.bbx=j.W/2;break;case"end":j.textpath.style["v-text-align"]="right",j.bbx=-j.W/2;break;default:j.textpath.style["v-text-align"]="center",j.bbx=0}j.textpath.style["v-text-kern"]=!0}},ue=function(u,c,g){u.attrs=u.attrs||{},u.attrs;var S=Math.pow,N="linear",H=".5 .5";if(u.attrs.gradient=c,c=(c=x(c).replace(l._radial_gradient,function(Pe,L,Ae){return N="radial",L&&Ae&&(L=B(L),Ae=B(Ae),S(L-.5,2)+S(Ae-.5,2)>.25&&(Ae=Y.sqrt(.25-S(L-.5,2))*(2*(Ae>.5)-1)+.5),H=L+Q+Ae),W})).split(/\s*\-\s*/),N=="linear"){var ne=c.shift();if(ne=-B(ne),isNaN(ne))return null}var j=l._parseDots(c);if(!j)return null;if(u=u.shape||u.node,j.length){u.removeChild(g),g.on=!0,g.method="none",g.color=j[0].color,g.color2=j[j.length-1].color;for(var K=[],ie=0,E=j.length;ie<E;ie++)j[ie].offset&&K.push(j[ie].offset+Q+j[ie].color);g.colors=K.length?K.join():"0% "+g.color,N=="radial"?(g.type="gradientTitle",g.focus="100%",g.focussize="0 0",g.focusposition=H,g.angle=0):(g.type="gradient",g.angle=(270-ne)%360),u.appendChild(g)}return 1},te=function(u,c){this[0]=this.node=u,u.raphael=!0,this.id=l._oid++,u.raphaelid=this.id,this.X=0,this.Y=0,this.attrs={},this.paper=c,this.matrix=l.matrix(),this._={transform:[],sx:1,sy:1,dx:0,dy:0,deg:0,dirty:1,dirtyT:1},!c.bottom&&(c.bottom=this),this.prev=c.top,c.top&&(c.top.next=this),c.top=this,this.next=null},pe=l.el;te.prototype=pe,pe.constructor=te,pe.transform=function(u){if(u==null)return this._.transform;var c,g=this.paper._viewBoxShift,S=g?"s"+[g.scale,g.scale]+"-1-1t"+[g.dx,g.dy]:W;g&&(c=u=x(u).replace(/\.{3}|\u2026/g,this._.transform||W)),l._extractTransform(this,S+u);var N,H=this.matrix.clone(),ne=this.skew,j=this.node,K=~x(this.attrs.fill).indexOf("-"),ie=!x(this.attrs.fill).indexOf("url(");if(H.translate(1,1),ie||K||this.type=="image")if(ne.matrix="1 0 0 1",ne.offset="0 0",N=H.split(),K&&N.noRotation||!N.isSimple){j.style.filter=H.toFilter();var E=this.getBBox(),Pe=this.getBBox(1),L=E.x-Pe.x,Ae=E.y-Pe.y;j.coordorigin=L*-Ie+Q+Ae*-Ie,qe(this,1,1,L,Ae,0)}else j.style.filter=W,qe(this,N.scalex,N.scaley,N.dx,N.dy,N.rotate);else j.style.filter=W,ne.matrix=x(H),ne.offset=H.offset();return c!==null&&(this._.transform=c,l._extractTransform(this,c)),this},pe.rotate=function(u,c,g){if(this.removed)return this;if(u!=null){if((u=x(u).split(ee)).length-1&&(c=B(u[1]),g=B(u[2])),u=B(u[0]),g==null&&(c=g),c==null||g==null){var S=this.getBBox(1);c=S.x+S.width/2,g=S.y+S.height/2}return this._.dirtyT=1,this.transform(this._.transform.concat([["r",u,c,g]])),this}},pe.translate=function(u,c){return this.removed?this:((u=x(u).split(ee)).length-1&&(c=B(u[1])),u=B(u[0])||0,c=+c||0,this._.bbox&&(this._.bbox.x+=u,this._.bbox.y+=c),this.transform(this._.transform.concat([["t",u,c]])),this)},pe.scale=function(u,c,g,S){if(this.removed)return this;if((u=x(u).split(ee)).length-1&&(c=B(u[1]),g=B(u[2]),S=B(u[3]),isNaN(g)&&(g=null),isNaN(S)&&(S=null)),u=B(u[0]),c==null&&(c=u),S==null&&(g=S),g==null||S==null)var N=this.getBBox(1);return g=g==null?N.x+N.width/2:g,S=S==null?N.y+N.height/2:S,this.transform(this._.transform.concat([["s",u,c,g,S]])),this._.dirtyT=1,this},pe.hide=function(){return!this.removed&&(this.node.style.display="none"),this},pe.show=function(){return!this.removed&&(this.node.style.display=W),this},pe.auxGetBBox=l.el.getBBox,pe.getBBox=function(){var u=this.auxGetBBox();if(this.paper&&this.paper._viewBoxShift){var c={},g=1/this.paper._viewBoxShift.scale;return c.x=u.x-this.paper._viewBoxShift.dx,c.x*=g,c.y=u.y-this.paper._viewBoxShift.dy,c.y*=g,c.width=u.width*g,c.height=u.height*g,c.x2=c.x+c.width,c.y2=c.y+c.height,c}return u},pe._getBBox=function(){return this.removed?{}:{x:this.X+(this.bbx||0)-this.W/2,y:this.Y-this.H,width:this.W,height:this.H}},pe.remove=function(){if(!this.removed&&this.node.parentNode){for(var u in this.paper.__set__&&this.paper.__set__.exclude(this),l.eve.unbind("raphael.*.*."+this.id),l._tear(this,this.paper),this.node.parentNode.removeChild(this.node),this.shape&&this.shape.parentNode.removeChild(this.shape),this)this[u]=typeof this[u]=="function"?l._removedFactory(u):null;this.removed=!0}},pe.attr=function(u,c){if(this.removed)return this;if(u==null){var g={};for(var S in this.attrs)this.attrs[d](S)&&(g[S]=this.attrs[S]);return g.gradient&&g.fill=="none"&&(g.fill=g.gradient)&&delete g.gradient,g.transform=this._.transform,g}if(c==null&&l.is(u,"string")){if(u=="fill"&&this.attrs.fill=="none"&&this.attrs.gradient)return this.attrs.gradient;for(var N=u.split(ee),H={},ne=0,j=N.length;ne<j;ne++)(u=N[ne])in this.attrs?H[u]=this.attrs[u]:l.is(this.paper.customAttributes[u],"function")?H[u]=this.paper.customAttributes[u].def:H[u]=l._availableAttrs[u];return j-1?H:H[N[0]]}if(this.attrs&&c==null&&l.is(u,"array")){for(H={},ne=0,j=u.length;ne<j;ne++)H[u[ne]]=this.attr(u[ne]);return H}var K;for(var ie in c!=null&&((K={})[u]=c),c==null&&l.is(u,"object")&&(K=u),K)de("raphael.attr."+ie+"."+this.id,this,K[ie]);if(K){for(ie in this.paper.customAttributes)if(this.paper.customAttributes[d](ie)&&K[d](ie)&&l.is(this.paper.customAttributes[ie],"function")){var E=this.paper.customAttributes[ie].apply(this,[].concat(K[ie]));for(var Pe in this.attrs[ie]=K[ie],E)E[d](Pe)&&(K[Pe]=E[Pe])}K.text&&this.type=="text"&&(this.textpath.string=K.text),Me(this,K)}return this},pe.toFront=function(){return!this.removed&&this.node.parentNode.appendChild(this.node),this.paper&&this.paper.top!=this&&l._tofront(this,this.paper),this},pe.toBack=function(){return this.removed?this:(this.node.parentNode.firstChild!=this.node&&(this.node.parentNode.insertBefore(this.node,this.node.parentNode.firstChild),l._toback(this,this.paper)),this)},pe.insertAfter=function(u){return this.removed?this:(u.constructor==l.st.constructor&&(u=u[u.length-1]),u.node.nextSibling?u.node.parentNode.insertBefore(this.node,u.node.nextSibling):u.node.parentNode.appendChild(this.node),l._insertafter(this,u,this.paper),this)},pe.insertBefore=function(u){return this.removed?this:(u.constructor==l.st.constructor&&(u=u[0]),u.node.parentNode.insertBefore(this.node,u.node),l._insertbefore(this,u,this.paper),this)},pe.blur=function(u){var c=this.node.runtimeStyle,g=c.filter;return g=g.replace(ke,W),+u!=0?(this.attrs.blur=u,c.filter=g+Q+" progid:DXImageTransform.Microsoft.Blur(pixelradius="+(+u||1.5)+")",c.margin=l.format("-{0}px 0 0 -{0}px",U(+u||1.5))):(c.filter=g,c.margin=0,delete this.attrs.blur),this},l._engine.path=function(u,c){var g=Z("shape");g.style.cssText=Se,g.coordsize=Ie+Q+Ie,g.coordorigin=c.coordorigin;var S=new te(g,c),N={fill:"none",stroke:"#000"};u&&(N.path=u),S.type="path",S.path=[],S.Path=W,Me(S,N),c.canvas&&c.canvas.appendChild(g);var H=Z("skew");return H.on=!0,g.appendChild(H),S.skew=H,S.transform(W),S},l._engine.rect=function(u,c,g,S,N,H){var ne=l._rectPath(c,g,S,N,H),j=u.path(ne),K=j.attrs;return j.X=K.x=c,j.Y=K.y=g,j.W=K.width=S,j.H=K.height=N,K.r=H,K.path=ne,j.type="rect",j},l._engine.ellipse=function(u,c,g,S,N){var H=u.path();return H.attrs,H.X=c-S,H.Y=g-N,H.W=2*S,H.H=2*N,H.type="ellipse",Me(H,{cx:c,cy:g,rx:S,ry:N}),H},l._engine.circle=function(u,c,g,S){var N=u.path();return N.attrs,N.X=c-S,N.Y=g-S,N.W=N.H=2*S,N.type="circle",Me(N,{cx:c,cy:g,r:S}),N},l._engine.image=function(u,c,g,S,N,H){var ne=l._rectPath(g,S,N,H),j=u.path(ne).attr({stroke:"none"}),K=j.attrs,ie=j.node,E=ie.getElementsByTagName("fill")[0];return K.src=c,j.X=K.x=g,j.Y=K.y=S,j.W=K.width=N,j.H=K.height=H,K.path=ne,j.type="image",E.parentNode==ie&&ie.removeChild(E),E.rotate=!0,E.src=c,E.type="tile",j._.fillpos=[g,S],j._.fillsize=[N,H],ie.appendChild(E),qe(j,1,1,0,0,0),j},l._engine.text=function(u,c,g,S){var N=Z("shape"),H=Z("path"),ne=Z("textpath");c=c||0,g=g||0,S=S||"",H.v=l.format("m{0},{1}l{2},{1}",U(c*Ie),U(g*Ie),U(c*Ie)+1),H.textpathok=!0,ne.string=x(S),ne.on=!0,N.style.cssText=Se,N.coordsize=Ie+Q+Ie,N.coordorigin="0 0";var j=new te(N,u),K={fill:"#000",stroke:"none",font:l._availableAttrs.font,text:S};j.shape=N,j.path=H,j.textpath=ne,j.type="text",j.attrs.text=x(S),j.attrs.x=c,j.attrs.y=g,j.attrs.w=1,j.attrs.h=1,Me(j,K),N.appendChild(ne),N.appendChild(H),u.canvas.appendChild(N);var ie=Z("skew");return ie.on=!0,N.appendChild(ie),j.skew=ie,j.transform(W),j},l._engine.setSize=function(u,c){var g=this.canvas.style;return this.width=u,this.height=c,u==+u&&(u+="px"),c==+c&&(c+="px"),g.width=u,g.height=c,g.clip="rect(0 "+u+" "+c+" 0)",this._viewBox&&l._engine.setViewBox.apply(this,this._viewBox),this},l._engine.setViewBox=function(u,c,g,S,N){l.eve("raphael.setViewBox",this,this._viewBox,[u,c,g,S,N]);var H,ne,j=this.getSize(),K=j.width,ie=j.height;return N&&(g*(H=ie/S)<K&&(u-=(K-g*H)/2/H),S*(ne=K/g)<ie&&(c-=(ie-S*ne)/2/ne)),this._viewBox=[u,c,g,S,!!N],this._viewBoxShift={dx:-u,dy:-c,scale:j},this.forEach(function(E){E.transform("...")}),this},l._engine.initWin=function(u){var c=u.document;c.styleSheets.length<31?c.createStyleSheet().addRule(".rvml","behavior:url(#default#VML)"):c.styleSheets[0].addRule(".rvml","behavior:url(#default#VML)");try{!c.namespaces.rvml&&c.namespaces.add("rvml","urn:schemas-microsoft-com:vml"),Z=function(g){return c.createElement("<rvml:"+g+' class="rvml">')}}catch(g){Z=function(S){return c.createElement("<"+S+' xmlns="urn:schemas-microsoft.com:vml" class="rvml">')}}},l._engine.initWin(l._g.win),l._engine.create=function(){var u=l._getContainer.apply(0,arguments),c=u.container,g=u.height,S=u.width,N=u.x,H=u.y;if(!c)throw new Error("VML container not found.");var ne=new l._Paper,j=ne.canvas=l._g.doc.createElement("div"),K=j.style;return N=N||0,H=H||0,S=S||512,g=g||342,ne.width=S,ne.height=g,S==+S&&(S+="px"),g==+g&&(g+="px"),ne.coordsize=216e5+Q+216e5,ne.coordorigin="0 0",ne.span=l._g.doc.createElement("span"),ne.span.style.cssText="position:absolute;left:-9999em;top:-9999em;padding:0;margin:0;line-height:1;",j.appendChild(ne.span),K.cssText=l.format("top:0;left:0;width:{0};height:{1};display:inline-block;position:relative;clip:rect(0 {0} {1} 0);overflow:hidden",S,g),c==1?(l._g.doc.body.appendChild(j),K.left=N+"px",K.top=H+"px",K.position="absolute"):c.firstChild?c.insertBefore(j,c.firstChild):c.appendChild(j),ne.renderfix=function(){},ne},l.prototype.clear=function(){l.eve("raphael.clear",this),this.canvas.innerHTML=W,this.span=l._g.doc.createElement("span"),this.span.style.cssText="position:absolute;left:-9999em;top:-9999em;padding:0;margin:0;line-height:1;display:inline;",this.canvas.appendChild(this.span),this.bottom=this.top=null},l.prototype.remove=function(){for(var u in l.eve("raphael.remove",this),this.canvas.parentNode.removeChild(this.canvas),this)this[u]=typeof this[u]=="function"?l._removedFactory(u):null;return!0};var Ce=l.st;for(var p in pe)pe[d](p)&&!Ce[d](p)&&(Ce[p]=function(u){return function(){var c=arguments;return this.forEach(function(g){g[u].apply(g,c)})}}(p))}}.apply(G,$))===void 0||(M.exports=I)}])})}),Un=On(Vn),Nt=Un;var R={};R.Common={nodeIdIncrement:0,activeNode:0,roundFloat:function(A,C){for(var M=0,G=1;M<C;)G*=10,M++;return Math.round(A*G)/G},apply:function(A,C){if(A&&typeof C=="object")for(var M in C)A[M]=C[M];return A},addRaphEventHandler:function(A,C,M,G){try{A[C](function(X,$){return function(I,l){var d=$;d.e=I,X(d)}}(M,G))}catch(X){}},isInteger:function(A){return!isNaN(parseInt(A))},isXMLSerializerAvailable:function(){return typeof XMLSerializer=="function"},createSvgEl:function(A,C){if(A=document.createElementNS("http://www.w3.org/2000/svg",A),C)for(var M in C)C.hasOwnProperty(M)&&A.setAttribute(M,String(C[M]));return A},createGradientEl:function(A,C,M){if(C.type!="radialGradient")return!1;var G=R.Common.createSvgEl("radialGradient",{id:A,gradientUnits:"userSpaceOnUse",cx:M[0],cy:M[1],r:M[2],fx:M[0],fy:M[1]});if(C.stop)for(var X=C.stop,$=0;$<X.length;$++){var I=X[$];I["@attributes"]?G.appendChild(R.Common.createSvgEl("stop",I["@attributes"])):(I._attributes&&delete I._attributes,I._children&&delete I._children,I.__proto__&&delete I.__proto__,G.appendChild(R.Common.createSvgEl("stop",I)))}return G},setCssStyle:function(A,C){var M=document.styleSheets[0];M.addRule?M.addRule(A,C):M.insertRule&&M.insertRule(A+" { "+C+" }",M.cssRules.length)}};R.PhyloCanvas=function(){var A,C,M,G,X;return function($,I,l,d,x){if(this.getNewickObject=function(){return M},this.clear=function(){},this.scale=function(Y){G.svg.scale(Y)},this.getSvg=function(){return G},this.getPhylogram=function(){return A},this.getSvgSource=function(){if(Nt.svg&&R.Common.isXMLSerializerAvailable()){var Y=new XMLSerializer;return Y.serializeToString(G.svg.canvas)}else return!1},typeof $=="object")if($.xml){if($.fileSource)var B=$.xml;else var B=Et.textToXML($.xml);B=Et.xmlToJSON(B),X=new R.PhyloCanvas.PhyloxmlParse(B)}else if($.phyloxml){if($.fileSource)var B=$.phyloxml;else var B=Et.textToXML($.phyloxml);B=Et.xmlToJSON(B),X=new R.PhyloCanvas.PhyloxmlParse(B)}else if($.nexml){if($.fileSource)var B=$.nexml;else var B=Et.textToXML($.nexml);B=Et.xmlToJSON(B),X=new R.PhyloCanvas.NexmlParse(B,$)}else $.json?X=new R.PhyloCanvas.PhyloxmlParse($.json):$.newick?X=new R.PhyloCanvas.NewickParse($.newick):$.nexmlJson?X=new R.PhyloCanvas.NexmlJsonParse($):alert("Please set the format of input data");else X=new R.PhyloCanvas.NewickParse($);C=I,G=new R.PhyloCanvas.Render.SVG(C,l,d),x=="circular"?A=new R.PhyloCanvas.Render.CircularPhylogram(G,X):A=new R.PhyloCanvas.Render.Phylogram(G,X)}}();R.PhyloCanvas.prototype={};R.PhyloCanvas.Node=function(){return function(A,C){this.id=R.Common.nodeIdIncrement+=1,this.level=0,this.len=0,this.newickLen=0,this.name="",this.type="",this.chart={},this.img=[],A&&R.Common.apply(this,A),this._countAllChildren=!1,this._countImmediateChildren=!1,this._midBranchPosition=!1,this.children=new Array,C&&C.children.push(this)}}();R.PhyloCanvas.Node.prototype={getCountAllChildren:function(){if(this._countAllChildren!==!1)return this._countAllChildren;var A=0;for(var C in this.children)if(R.Common.isInteger(C)){var M=this.children[C];M.children&&M.children.length>0?A+=M.getCountAllChildren():A++}return this._countAllChildren=A,A},getCountImmediateChildren:function(){if(this._countImmediateChildren!==!1)return this._countImmediateChildren;var A=0;for(var C in this.children){var M=this.children[C];A+=M.length}return this._countImmediateChildren=A,A},getMidbranchPosition:function(A){if(this._midBranchPosition!==!1)return this._midBranchPosition;for(var C=[0,0],M=0;M<this.children.length;M++){var G=this.children[M];G.children&&G.children.length>0?M==0&&A?(C[0]=G.getMidbranchPosition(!0),C[1]+=G.getCountAllChildren()-1):M==0?(C[0]=G.getMidbranchPosition(),C[1]+=G.getCountAllChildren()):M==this.children.length-1?C[1]+=G.getMidbranchPosition():C[1]+=G.getCountAllChildren():M==0&&A?C[0]=0:M==0?(C[0]=1,C[1]+=1):(M==this.children.length-1,C[1]+=1)}return this._midBranchPosition=C[1]>=C[0]?(C[1]+C[0])/2:C[0],this._midBranchPosition}};R.PhyloCanvas.NewickParse=function(){var A,C,M,G=0,X=0,$,I,l=function(F){for(var T=new R.PhyloCanvas.Node;C!==")"&&C!==",";)C===":"?(Y(),T.len=R.Common.roundFloat(x(),4),T.len==0&&(T.len=1e-4)):C==="'"||C==='"'?(T.type="label",T.name=B(C)):(T.type="label",T.name=x());return T.level=F.level+1,T},d=function(F){var T=new R.PhyloCanvas.Node;for(F&&(T.level=F.level+1);C!==")";)Y(),C==="("?T.children.push(d(T)):T.children.push(l(T));return Y(),C!==":"&&C!==")"&&C!==","&&C!==";"&&(T.type="label",T.name=x()),C===":"&&(Y(),T.len=R.Common.roundFloat(x(),4),T.len==0&&(T.len=1e-4),T.type="stem"),T},x=function(){for(var F="";C!==":"&&C!==")"&&C!==","&&C!==";";)F+=C,Y();return F},B=function(F){for(var T="";C!==F;)T+=C,Y();return T},Y=function(){return C=A.charAt(M),M+=1,C},U=function(F,T){if(F.children&&F.children.length)for(var O=0;O<F.children.length;O++){var ee=F.children[O];ee.len===0&&(ee.len=1),ee.newickLen=R.Common.roundFloat(ee.len+F.newickLen,4),ee.level>G&&(G=ee.level),ee.newickLen>X&&(X=ee.newickLen),ee.children.length>0&&U(ee,F)}return F};return function(F){this.getRoot=function(){return $},this.getLevels=function(){return G},this.getNewickLen=function(){return X},this.getValidate=function(){return I},G=0,X=0,A=F,M=0,Y(),$=d(),$=U($)}}();R.PhyloCanvas.NewickParse.prototype={};R.PhyloCanvas.PhyloxmlParse=function(){var A=0,C=0,M,G,X=function(l,d){var x=new R.PhyloCanvas.Node;if(d&&(x.level=d.level+1),l.clade&&l.clade.length)for(var B=0;B<l.clade.length;B++){var Y=l.clade[B];x.children.push(X(Y,x))}if(l.branch_length&&(typeof l.branch_length=="object"&&(l.branch_length=l.branch_length[0].Text),x.len=R.Common.roundFloat(l.branch_length,4),x.len==0&&(x.len=1e-4)),l.color?(x.red=l.color[0].red[0].Text,x.green=l.color[0].green[0].Text,x.blue=l.color[0].blue[0].Text):(x.red=0,x.green=0,x.blue=0),l.property&&l.property[0].applies_to=="node"&&l.property[0].ref=="style:font_color"&&(x.font_color_hex=l.property[0].Text),l.name?(x.type="label",x.name=l.name[0].Text,l.name[0]&&l.name[0].style&&(x.style=l.name[0].style),l.name[0]&&l.name[0].bgStyle&&(x.bgStyle=l.name[0].bgStyle)):l.confidence&&(x.name=l.confidence[0].Text),l.sequence&&l.sequence[0]&&l.sequence[0].name&&l.sequence[0].name[0]&&l.sequence[0].name[0].Text&&(x.sequenceName=l.sequence[0].name[0].Text),l.taxonomy&&l.taxonomy[0]&&(l.taxonomy[0].scientific_name&&l.taxonomy[0].scientific_name[0]&&l.taxonomy[0].scientific_name[0].Text&&(x.taxonomyScientificName=l.taxonomy[0].scientific_name[0].Text),l.taxonomy[0].common_name&&l.taxonomy[0].common_name[0]&&l.taxonomy[0].common_name[0].Text&&(x.taxonomyCommonName=l.taxonomy[0].common_name[0].Text)),l.sequence&&l.sequence[0]&&l.sequence[0].accession&&l.sequence[0].accession[0]&&l.sequence[0].accession[0].Text&&(x.sequenceAccession=l.sequence[0].accession[0].Text),l.point&&(x.LatLong=[l.point[0].lat[0].Text,l.point[0].long[0].Text]),x.name||(x.sequenceName?x.name=x.sequenceName:x.taxonomyScientificName?x.name=x.taxonomyScientificName:x.taxonomyCommonName?x.name=x.taxonomyCommonName:x.sequenceAccession&&(x.name=x.sequenceAccession),x.name&&(x.type="label")),l.annotation&&(l.annotation[0]&&l.annotation[0].desc&&l.annotation[0].desc[0]&&l.annotation[0].desc[0].Text&&(x.description=l.annotation[0].desc[0].Text),l.annotation[0]&&l.annotation[0].uri&&l.annotation[0].uri[0]&&l.annotation[0].uri[0].Text&&(x.uri=l.annotation[0].uri[0].Text),l.annotation[0]&&l.annotation[0].img))for(var B in l.annotation[0].img)R.Common.isInteger(B)&&(x.img[B]=l.annotation[0].img[B].Text);if(l.chart&&l.chart[0])for(var B in l.chart[0])B!="Text"&&B!="_children"&&(x.chart[B]=l.chart[0][B][0].Text);return x&&x.level>1&&(x.len||(G="Error. Please include Branch Lengths - we only draw rooted phylogenetic trees.")),x},$=function(l,d){if(l.children&&l.children.length)for(var x=0;x<l.children.length;x++){var B=l.children[x];B.newickLen=Math.round((B.len+l.newickLen)*1e4)/1e4,B.level>A&&(A=B.level),B.newickLen>C&&(C=B.newickLen),B.children.length>0&&$(B,l)}return l},I=function(l,d){for(var x in l)x!="_children"&&x!="Text"&&(x=="rectangular"||x=="circular"?I(l[x][0],x):(R.PhyloCanvas.Render.Parameters[x]||(R.PhyloCanvas.Render.Parameters[x]={}),R.PhyloCanvas.Render.Parameters.set(x,l[x][0].Text,d)))};return function(l){if(this.getRoot=function(){return M},this.getLevels=function(){return A},this.getNewickLen=function(){return C},this.getValidate=function(){return G},l.phylogeny&&l.phylogeny[0]&&l.phylogeny[0].clade&&(M=X(l.phylogeny[0].clade[0])),l.phylogeny&&l.phylogeny[0]&&l.phylogeny[0].render&&l.phylogeny[0].render[0]){var d=l.phylogeny[0].render[0];if(d&&d.styles){var x=d.styles[0];for(var B in x)if(B!="_children"&&B!="Text")if(x[B][0].type&&x[B][0].type=="radialGradient"&&Nt.svg)x[B][0].name=B,R.PhyloCanvas.Render.Style[B]=x[B][0],R.PhyloCanvas.Render.Style.jsphylosvgGradientList||(R.PhyloCanvas.Render.Style.jsphylosvgGradientList=[]),R.PhyloCanvas.Render.Style.jsphylosvgGradientList.push(B);else{R.PhyloCanvas.Render.Style[B]||(R.PhyloCanvas.Render.Style[B]={});for(var Y in x[B][0])Y!="_attributes"&&Y!="_children"&&Y!="type"&&(R.PhyloCanvas.Render.Style[B][Y.replace("_","-")]=x[B][0][Y])}}if(d&&d.parameters&&I(d.parameters[0]),d&&d.charts){var U=d.charts[0];for(var B in U)if(B!="_children"&&B!="Text")for(var Y in U[B])U[B][Y].type=="binary"?(U[B][Y].chart=B,R.PhyloCanvas.Render.Parameters.binaryCharts.push(U[B][Y])):U[B][Y].type=="integratedBinary"?(U[B][Y].chart=B,R.PhyloCanvas.Render.Parameters.integratedBinaryCharts.push(U[B][Y])):U[B][Y].type=="bar"&&(U[B][Y].chart=B,R.PhyloCanvas.Render.Parameters.barCharts.length==1&&R.PhyloCanvas.Render.Parameters.barCharts.shift(),R.PhyloCanvas.Render.Parameters.barCharts.push(U[B][Y]))}}M=$(M)}}();R.PhyloCanvas.PhyloxmlParse.prototype={};R.PhyloCanvas.NexmlParse=function(){var A=0,C=0,M,G,X,$,I=function(x,B,Y){var U=new R.PhyloCanvas.Node;Y&&(U.level=Y.level+1);for(var F=0;F<X.length;F++)if(X[F].source==x.id)for(var T=0;T<$.length;T++)X[F].target==$[T].id&&U.children.push(I($[T],X[F].length,U));if(U&&U.level>0&&!U.len&&(U.len=1),B&&(U.len=R.Common.roundFloat(B,4),U.len==0&&(U.len=1e-4)),x.label&&(U.type="label",U.name=x.label,x.style&&(U.style=x.style)),x.color){let O=x.color.replace(/[a-z%\s\(\)]/g,"").split(",");U.red=O[0],U.green=O[1],U.blue=O[2]}else{let O=R.PhyloCanvas.Render.Style.line.stroke.replace(/[a-z%\s\(\)]/g,"").split(",");U.red=O[0],U.green=O[1],U.blue=O[2]}return U},l=function(x,B){if(x.children&&x.children.length)for(var Y=0;Y<x.children.length;Y++){var U=x.children[Y];U.newickLen=Math.round((U.len+x.newickLen)*1e4)/1e4,U.level>A&&(A=U.level),U.newickLen>C&&(C=U.newickLen),U.children.length>0&&l(U,x)}return x},d=function(x,B){for(var Y in x)Y!="_children"&&Y!="Text"&&(Y=="rectangular"||Y=="circular"?d(x[Y][0],Y):(R.PhyloCanvas.Render.Parameters[Y]||(R.PhyloCanvas.Render.Parameters[Y]={}),R.PhyloCanvas.Render.Parameters.set(Y,x[Y][0].Text,B)))};return function(x,B){this.getRoot=function(){return M},this.getLevels=function(){return A},this.getNewickLen=function(){return C},this.getValidate=function(){return G},B.tree&&x.trees[0]&&x.trees[0].tree[B.tree-1]?(X=x.trees[0].tree[B.tree-1].edge,$=x.trees[0].tree[B.tree-1].node):(X=x.trees[0].tree[0].edge,$=x.trees[0].tree[0].node);for(var Y=0;Y<$.length;Y++){var U=0;if($[Y].root&&$[Y].root=="true"){M=$[Y];break}for(var F=0;F<X.length;F++)X[F].target==$[Y].id&&U++;if(U==0){M=$[Y];break}}M?(M=I(M),M=l(M)):G="Error. Currently, only rooted NeXML trees are supported."}}();R.PhyloCanvas.NexmlParse.prototype={};R.PhyloCanvas.NexmlJsonParse=function(){var A=0,C=0,M,G,X=[],$=[],I=function(x,B,Y){var U=new R.PhyloCanvas.Node;Y&&(U.level=Y.level+1);for(var F=0;F<X.length;F++)if(X[F].source==x.id)for(var T=0;T<$.length;T++)X[F].target==$[T].id&&U.children.push(I($[T],X[F].length,U));return B&&(U.len=R.Common.roundFloat(B,4),U.len==0&&(U.len=1e-4)),x.label&&(U.type="label",U.name=x.label,x.accession&&(U.accession=x.accession),x.style&&(U.style=x.style),x.bgStyle&&(U.bgStyle=x.bgStyle)),x.chart&&(U.chart=x.chart),U&&U.level>1&&(U.len||(G="Error. Please include Branch Lengths - we only draw rooted phylogenetic trees.")),U},l=function(x,B){if(x.children&&x.children.length)for(var Y=0;Y<x.children.length;Y++){var U=x.children[Y];U.newickLen=Math.round((U.len+x.newickLen)*1e4)/1e4,U.level>A&&(A=U.level),U.newickLen>C&&(C=U.newickLen),U.children.length>0&&l(U,x)}return x},d=function(x,B){for(var Y in x)Y!="_children"&&Y!="Text"&&(Y=="rectangular"||Y=="circular"?d(x[Y],Y):(R.PhyloCanvas.Render.Parameters[Y]||(R.PhyloCanvas.Render.Parameters[Y]={}),R.PhyloCanvas.Render.Parameters.set(Y,x[Y],B)))};return function(x){this.getRoot=function(){return M},this.getLevels=function(){return A},this.getNewickLen=function(){return C},this.getValidate=function(){return G};var B=x.nexmlJson.nexml,Y=B.render;if(Y&&Y.styles){var U=Y.styles;for(var F in U)if(F!="_children"&&F!="Text")if(U[F]["@attributes"].type&&U[F]["@attributes"].type=="radialGradient"&&Nt.svg)U[F].name=F,U[F].type=U[F]["@attributes"].type,R.PhyloCanvas.Render.Style[F]=U[F],R.PhyloCanvas.Render.Style.jsphylosvgGradientList||(R.PhyloCanvas.Render.Style.jsphylosvgGradientList=[]),R.PhyloCanvas.Render.Style.jsphylosvgGradientList.push(F);else{R.PhyloCanvas.Render.Style[F]||(R.PhyloCanvas.Render.Style[F]={});for(var T in U[F]["@attributes"])T!="_attributes"&&T!="_children"&&T!="type"&&(R.PhyloCanvas.Render.Style[F][T.replace("_","-")]=U[F]["@attributes"][T])}}if(Y&&Y.parameters&&d(Y.parameters),Y&&Y.charts){var O=Y.charts;for(var F in O)O[F]["@attributes"].chart=F,O[F]["@attributes"].type=="binary"?R.PhyloCanvas.Render.Parameters.binaryCharts.push(O[F]["@attributes"]):O[F]["@attributes"].type=="integratedBinary"?R.PhyloCanvas.Render.Parameters.integratedBinaryCharts.push(O[F]["@attributes"]):O[F]["@attributes"].type=="bar"&&R.PhyloCanvas.Render.Parameters.barCharts.push(O[F]["@attributes"])}if(x.tree&&B.trees[0]&&B.trees[0].tree[x.tree-1])X=B.trees[0].tree[x.tree-1].edge,$=B.trees[0].tree[x.tree-1].node;else{for(var F=0;F<B.trees.tree.edge.length;F++)X.push(B.trees.tree.edge[F]["@attributes"]);for(var F=0;F<B.trees.tree.node.length;F++){var ee=B.trees.tree.node[F]["@attributes"];ee.label&&(ee.chart=B.trees.tree.node[F].chart),$.push(ee)}}for(var F=0;F<$.length;F++)$[F].root&&$[F].root=="true"&&(M=$[F]);M?(M=I(M),M=l(M)):G="Error. Currently, only rooted NeXML trees are supported."}}();R.PhyloCanvas.NexmlParse.prototype={};R.PhyloCanvas.Render={};R.PhyloCanvas.Render.Style={line:{stroke:"rgb(0,0,0)","stroke-width":1},text:{"font-family":"Verdana","font-size":12,"text-anchor":"start"},path:{stroke:"rgb(0,0,0)","stroke-width":1},connectedDash:{stroke:"rgb(200,200,200)","stroke-dasharray":". "},textSecantBg:{fill:"#EEE",stroke:"#DDD"},highlightedEdgeCircle:{fill:"black",stroke:"black"},barChart:{fill:"#003300",stroke:"#DDD"},getStyle:function(A,C){return this[A]?this[A]:this[C]}};R.PhyloCanvas.Render.Parameters={jsOverride:0,Rectangular:{bufferX:200,paddingX:10,paddingY:20,bufferInnerLabels:10,bufferOuterLabels:5,minHeightBetweenLeaves:10,alignPadding:0,alignRight:!1,showScaleBar:!1},Circular:{bufferRadius:.33,bufferAngle:20,initStartAngle:160,innerCircleRadius:0,minHeightBetweenLeaves:5,bufferInnerLabels:2,bufferOuterLabels:5},binaryCharts:[],integratedBinaryCharts:[],barCharts:[],binaryChartBufferInner:5,binaryChartBufferSiblings:.01,binaryChartThickness:15,binaryChartDisjointed:!1,barChartBufferInner:3,barChartHeight:50,barChartWidth:.5,set:function(A,C,M){this.jsOverride||(M?M=="circular"?this.Circular[A]=parseFloat(C):M=="rectangular"&&(this.Rectangular[A]=parseFloat(C)):this[A]=parseFloat(C))}};R.PhyloCanvas.Render.Line=function(){return function(A,C,M,G,X,$,I,l){this.type="line",this.attr=R.PhyloCanvas.Render.Style.line,this.attr.stroke=["rgb(",X,",",$,",",I,")"].join(""),this.x1=A,this.x2=C,this.y1=M,this.y2=G,l&&(R.Common.apply(this,l),l.attr&&(this.attr=l.attr))}}();R.PhyloCanvas.Render.Text=function(){return function(A,C,M,G){this.type="text",this.attr=R.PhyloCanvas.Render.Style.text,this.x=A,this.y=C,this.text=M,G&&(R.Common.apply(this,G),G.attr&&(this.attr=G.attr))}}();R.PhyloCanvas.Render.Path=function(){var A=R.PhyloCanvas.Render.Style.path;return function(C,M){this.type="path",this.attr=R.PhyloCanvas.Render.Style.path,this.path=C,M&&(R.Common.apply(this,M),M.attr&&(this.attr=M.attr))}}();R.PhyloCanvas.Render.Circle=function(){return function(A,C,M,G){this.type="circle",this.x=A,this.y=C,this.radius=M,G&&(R.Common.apply(this,G),G.attr&&(this.attr=G.attr))}}();R.PhyloCanvas.Render.SVG=function(){var A,C;return function(M,G,X){A=M,this.canvasSize=[G,X],this.svg=Nt(M,this.canvasSize[0],this.canvasSize[1])}}();R.PhyloCanvas.Render.SVG.prototype={render:function(){for(var A=this.phylogramObject.getDrawInstructs(),C=0;C<A.length;C++)if(A[C].type=="line")var M=this.svg.path(["M",A[C].x1,A[C].y1,"L",A[C].x2,A[C].y2]).attr(R.PhyloCanvas.Render.Style.line);else if(A[C].type=="path")var G=this.svg.path(A[C].path).attr(A[C].attr);else if(A[C].type=="circle")var G=this.svg.circle(A[C].x,A[C].y,A[C].radius).attr({stroke:"black",fill:"black"});else{var X=this.svg.text(A[C].x,A[C].y,A[C].text).attr(R.PhyloCanvas.Render.Style.text);A[C].attr&&X.attr(A[C].attr),A[C].rotate&&X.rotate(A[C].rotate);var $=X.getBBox(),I=Math.sqrt($.height*$.height+$.width*$.width)}},draw:function(A){var C,M;if(A.type=="line")C=this.svg.path(["M",A.x1,A.y1,"L",A.x2,A.y2]).attr(R.PhyloCanvas.Render.Style.line);else if(A.type=="path")C=this.svg.path(A.path).attr(A.attr);else if(A.type=="circle")C=this.svg.circle(A.x,A.y,A.radius).attr({stroke:"black",fill:"black"});else if(A.type=="text"){C=this.svg.text(A.x,A.y,A.text).attr(R.PhyloCanvas.Render.Style.text),A.attr&&C.attr(A.attr),A.rotate&&C.rotate(A.rotate);var G=C.getBBox();M=Math.sqrt(G.height*G.height+G.width*G.width)}return[C,M]}};R.PhyloCanvas.Render.Phylogram=function(){var A,C=R.PhyloCanvas.Render.Parameters.Rectangular,M,G,X,$,I,l,d=!0,x=0,B=0,Y,U,F,T,O,ee,de,Q,W,me,be,ke,se=[],Se=function(Z){return Z+Math.round(Z/4)},Ie=function(Z,Re,Me,ue){return["M",Z,Re,"L",Me,Re,"L",Me,ue,"L",Z,ue,"Z"]},We=function(Z,Re){if(Z.len&&d==!1&&Z.children.length==0&&(x=R.Common.roundFloat(x+$,4)),Z.children.length>0){var Me=[],ue,te,pe,Ce,p,u,c;if(Z.len&&(ue=Re,te=Re=R.Common.roundFloat(Re+X*Z.len,4),pe=x+Z.getMidbranchPosition(d)*$,Ce=pe,p=Z.red,u=Z.green,c=Z.blue,A.draw(new R.PhyloCanvas.Render.Line(ue,te,pe,Ce,p,u,c))),Z.name){var g={};if(g=R.PhyloCanvas.Render.Style.getStyle("bootstrap","text"),Z.font_color_hex?g.fill=Z.font_color_hex:g.fill="#000000",Z.uri&&(g.href=Z.uri),Z.description&&(g.title=Z.description),Z.level==0)var S=x+Z.getMidbranchPosition(d)*$;else var S=Ce;A.draw(new R.PhyloCanvas.Render.Text((te||Re)+5,S,Z.name,{attr:g}))}if(Z.children&&Z.children.length)for(var N=0;N<Z.children.length;N++){var H=Z.children[N];Me.push(We(H,Re))}for(var ne=[],N=0;N<Me.length;N++)Me[N][0]&&ne.push(Me[N][0]),Me[N][1]&&ne.push(Me[N][1]);for(var j=Math.min.apply(null,ne),K=Math.max.apply(null,ne),ie=(j+K)/2,E="",Pe="",L="",Ae=0,N=0;N<Z.children.length;++N){var He=Z.children[N];if(N==0)E=He.red,Pe=He.green,L=He.blue;else if(E==He.red&&Pe==He.green&&L==He.blue)Ae=1;else{Ae=0;break}}Ae==0?R.PhyloCanvas.Render.Style.line.stroke="black":(p=Z.children[0].red,u=Z.children[0].green,c=Z.children[0].blue,R.PhyloCanvas.Render.Style.line.stroke=["rgb(",p,",",u,",",c,")"].join("")),Z.children.length==2?(p=Z.children[0].red,u=Z.children[0].green,c=Z.children[0].blue,R.PhyloCanvas.Render.Style.line.stroke=["rgb(",p,",",u,",",c,")"].join(""),A.draw(new R.PhyloCanvas.Render.Path(["M",Re+1e-4,j,"L",Re,j,"L",Re,ie],{attr:R.PhyloCanvas.Render.Style.line})),p=Z.children[1].red,u=Z.children[1].green,c=Z.children[1].blue,R.PhyloCanvas.Render.Style.line.stroke=["rgb(",p,",",u,",",c,")"].join(""),A.draw(new R.PhyloCanvas.Render.Path(["M",Re,ie,"L",Re,K,"L",Re+1e-4,K],{attr:R.PhyloCanvas.Render.Style.line}))):A.draw(new R.PhyloCanvas.Render.Path(["M",Re+1e-4,j,"L",Re,j,"L",Re,K,"L",Re+1e-4,K],{attr:R.PhyloCanvas.Render.Style.line}))}else{if(ue=Re,te=R.Common.roundFloat(Re+X*Z.len,2),pe=x,Ce=x,p=Z.red,u=Z.green,c=Z.blue,Z.y=x,se.push(Z),A.draw(new R.PhyloCanvas.Render.Line(ue,te,pe,Ce,p,u,c)),C.alignRight&&A.draw(new R.PhyloCanvas.Render.Path(["M",te,pe,"L",C.alignPadding+I,Ce],{attr:R.PhyloCanvas.Render.Style.connectedDash})),Z.name){var g={};Z.style&&(g=R.PhyloCanvas.Render.Style.getStyle(Z.style,"text")),Z.font_color_hex?g.fill=Z.font_color_hex:g.fill="#000000",g["text-anchor"]="start",Z.uri&&(g.href=Z.uri),Z.description&&(g.title=Z.description);var $e=A.draw(new R.PhyloCanvas.Render.Text(C.alignRight?I+C.bufferInnerLabels+C.alignPadding:te+C.bufferInnerLabels,Ce,Z.name,{attr:g}));B=Math.max($e[1],B),R.PhyloCanvas.Render.Parameters.mouseRollOver&&R.Common.addRaphEventHandler($e[0],"mouseover",R.PhyloCanvas.Render.Parameters.mouseRollOver,{svg:A,node:Z,x:te,y:Ce,textEl:$e[0]}),R.PhyloCanvas.Render.Parameters.mouseRollOut&&R.Common.addRaphEventHandler($e[0],"mouseout",R.PhyloCanvas.Render.Parameters.mouseRollOut,{svg:A,node:Z,x:te,y:Ce,textEl:$e[0]}),R.PhyloCanvas.Render.Parameters.onClickAction&&R.Common.addRaphEventHandler($e[0],"click",R.PhyloCanvas.Render.Parameters.onClickAction,{svg:A,node:Z,x:te,y:Ce,textEl:$e[0]})}d&&(d=!1)}return[pe,Ce]},De=function(){y=x+$,T=0,O=C.showScaleBar*X,A.draw(new R.PhyloCanvas.Render.Line(T,O,y,y)),A.draw(new R.PhyloCanvas.Render.Text((T+O)/2,y-8,C.showScaleBar))},Ee=function(Z,Re,Me){for(var ue=(Me&&Me.bufferInner?Me.bufferInner:0)|R.PhyloCanvas.Render.Parameters.binaryChartBufferInner,te=(Me&&Me.bufferSiblings?Me.bufferSiblings*$:0)|(R.PhyloCanvas.Render.Parameters.binaryChartBufferSiblings<1?$*R.PhyloCanvas.Render.Parameters.binaryChartBufferSiblings:R.PhyloCanvas.Render.Parameters.binaryChartBufferSiblings),pe=(Me&&Me.thickness?Me.thickness:0)|R.PhyloCanvas.Render.Parameters.binaryChartThickness,Ce,p=0;p<se.length;p++){var u=se[p];A.draw(new R.PhyloCanvas.Render.Path(Ie(Z+ue,u.y-$/2+te/2,Z+ue+pe,u.y+$/2-te/2),{attr:R.PhyloCanvas.Render.Style.getStyle(u.chart[Re],"textSecantBg")}))}return Z+ue+pe},qe=function(Z,Re,Me){for(var ue=[],te,pe=Me&&Me.bufferInner?Me.bufferInner:0|R.PhyloCanvas.Render.Parameters.barChartBufferInner,Ce=Me&&Me.height?Me.height:0|R.PhyloCanvas.Render.Parameters.barChartHeight,p=Me&&Me.width?Me.width<1?$*Me.width:Me.width:0|(R.PhyloCanvas.Render.Parameters.barChartWidth<1?$*R.PhyloCanvas.Render.Parameters.barChartWidth:R.PhyloCanvas.Render.Parameters.barChartWidth),u=0,c=0;c<se.length;c++)ue.push(se[c].chart[Re]);te=Math.max.apply(null,ue),u=R.Common.roundFloat(Ce/te,4);for(var c=0;c<se.length;c++){var g=se[c];A.draw(new R.PhyloCanvas.Render.Path(Ie(Z+pe,g.y-p/2,Z+pe+u*g.chart[Re],g.y+p/2),{attr:R.PhyloCanvas.Render.Style.getStyle(g.chart[Re],"barChart")}))}return Z+pe+Ce};return function(Z,Re){this.getCanvasSize=function(){return[M,G]},this.getRoot=function(){return Re.getRoot()},Re.getValidate()&&A.draw(0,0,Re.getValidate()),d=!0,A=Z;var Me=Re.getRoot(),ue=Re.getNewickLen();if(M=A.canvasSize[0],G=A.canvasSize[1],me=C.bufferX,be=C.paddingX,ke=C.paddingY,l=C.minHeightBetweenLeaves,x=ke,X=Math.round((M-me-be*2)/ue),$=Math.round((G-ke*2)/(C.showScaleBar?Me.getCountAllChildren():Me.getCountAllChildren()-1)),$<l&&($=l),I=Math.round(M-me-be*2),(R.PhyloCanvas.Render.Parameters.binaryCharts.length||R.PhyloCanvas.Render.Parameters.barCharts.length)&&(C.alignRight=!0),We(Me,be),C.showScaleBar&&De(),Y=I+B+C.bufferInnerLabels,R.PhyloCanvas.Render.Parameters.binaryCharts.length){var te=R.PhyloCanvas.Render.Parameters.binaryCharts;for(var pe in te)Y=Ee(Y,te[pe].chart,te[pe])}if(R.PhyloCanvas.Render.Parameters.barCharts.length){var Ce=R.PhyloCanvas.Render.Parameters.barCharts;for(var pe in Ce)F=qe(Y,Ce[pe].chart,Ce[pe])}se=[],typeof bgLabelsHold!="undefined"&&(bgLabelsHold=[])}}();R.PhyloCanvas.Render.Phylogram.prototype={};R.PhyloCanvas.Render.CircularPhylogram=function(){var A,C=R.PhyloCanvas.Render.Parameters.Circular,M,G,X,$,I,l,d,x=!0,B=0,Y,U,F,T=[],O=[],ee,de,Q,W=0,me,be=Math.PI/180;function ke(ue,te){return te+=me,[R.Common.roundFloat(Y+ue*Math.sin(te*be),4),R.Common.roundFloat(U+ue*Math.cos(te*be),4)]}function se(ue){var te=We(90-ue-me);if(te>90&&te<270){te+=180;var pe="end"}else var pe="start";return[te,pe]}function Se(ue,te,pe,Ce){var p=ke(ue,te),u=ke(ue,pe),c=[],g,S=0;return Math.abs(We(pe-te))>180?g=1:g=-1,Ce&&Ce.invertSecant&&(g*=-1,S=1),Ce&&Ce.noMove||c.push("M"),c.push(p[0],p[1],"A",ue,ue,0,g<1?0:1,S,u[0],u[1]),c}function Ie(ue,te,pe,Ce){var p=[],u=ke(te,ue),c=ke(pe,ue);return Ce&&Ce.noMove||p.push("M"),p.push(u[0],u[1],"L",c[0],c[1]),p}function We(ue){for(;ue>360||ue<0;)ue>360?ue-=360:ue<0&&(ue+=360);return ue}function De(ue,te,pe,Ce){if(!te&&ue.length>1)var Ce=ue[3],pe=ue[2],te=ue[1],ue=ue[0];var p=qe("M",Se(ue,pe,Ce,{noMove:1,invertSecant:0}),"L",Se(te,Ce,pe,{noMove:1,invertSecant:1}),"Z");return p}function Ee(ue,te){if(te=te,ue.len&&(x?B=de||1:ue.children.length==0&&(B=R.Common.roundFloat(B+I,4))),ue.children.length>0){var pe=[],Ce,p,u,c;if(Ce=te,p=te+=R.Common.roundFloat($*ue.len,4),ue.name,ue.children&&ue.children.length)for(var g=0;g<ue.children.length;g++){var S=ue.children[g],N=Ee(S,te);N>0&&pe.push(N)}var H=R.Common.roundFloat(Math.min.apply(null,pe),4),ne=R.Common.roundFloat(Math.max.apply(null,pe),4);ue.level!=0&&A.draw(new R.PhyloCanvas.Render.Path(qe("M",ke(te+.01,H),"L",Se(te,H,ne,{noMove:!0}),"L",ke(te+.01,ne)))),ue.len&&(u=R.Common.roundFloat(H+(ne-H)/2,4),A.draw(new R.PhyloCanvas.Render.Path(Ie(u,Ce,p))))}else if(ue.y=B,T.push(ue),Ce=te,p=te=R.Common.roundFloat(te+$*ue.len),u=B,A.draw(new R.PhyloCanvas.Render.Path(Ie(u,Ce,p))),A.draw(new R.PhyloCanvas.Render.Path(Ie(u,p,F),{attr:R.PhyloCanvas.Render.Style.connectedDash})),ue.name){var j=ke(F+C.bufferInnerLabels,u),K=se(u),ie=K[0],E=K[1],Pe={};ue.style&&R.Common.apply(Pe,R.PhyloCanvas.Render.Style.getStyle(ue.style,"text")),ue.font_color_hex?Pe.fill=ue.font_color_hex:Pe.fill="#000000",Pe["text-anchor"]=E,ue.uri&&(Pe.href=ue.uri),ue.description&&(Pe.title=ue.description);var L=A.draw(new R.PhyloCanvas.Render.Text(j[0],j[1],ue.name,{attr:Pe,rotate:[ie,j[0],j[1]]}));ue.bgStyle&&O.push([ue.bgStyle,u]);var j=ke(p,u);R.PhyloCanvas.Render.Parameters.mouseRollOver&&R.Common.addRaphEventHandler(L[0],"mouseover",R.PhyloCanvas.Render.Parameters.mouseRollOver,{svg:A,node:ue,x:j[0],y:j[1],textEl:L[0]}),R.PhyloCanvas.Render.Parameters.mouseRollOut&&R.Common.addRaphEventHandler(L[0],"mouseout",R.PhyloCanvas.Render.Parameters.mouseRollOut,{svg:A,node:ue,x:j[0],y:j[1],textEl:L[0]}),R.PhyloCanvas.Render.Parameters.onClickAction&&R.Common.addRaphEventHandler(L[0],"click",R.PhyloCanvas.Render.Parameters.onClickAction,{svg:A,node:ue,x:j[0],y:j[1],textEl:L[0]}),W=Math.max(L[1],W)}return x&&(x=!1),u}function qe(ue){for(var te=ue,pe=1;pe<arguments.length;pe++)te=te.concat(arguments[pe]);return te}function Z(){var ue=[];if(O.length>0){if(R.PhyloCanvas.Render.Style.jsphylosvgGradientList)for(var te=0;te<R.PhyloCanvas.Render.Style.jsphylosvgGradientList.length;te++){var pe=R.PhyloCanvas.Render.Style.jsphylosvgGradientList[te],Ce=R.Common.createGradientEl(pe,R.PhyloCanvas.Render.Style[pe],[Y,U,F+W+C.bufferOuterLabels]);A.svg.defs.appendChild(Ce)}for(var te=0;te<O.length;te++){if(te!=O.length-1&&O[te][0]==O[te+1][0]){O[te+1][2]=O[te][2]?O[te][2]:O[te][1];continue}var ue=De(F,F+W+C.bufferOuterLabels,O[te][2]?O[te][2]-I/2:O[te][1]-I/2,O[te][1]+I/2),p=R.PhyloCanvas.Render.Style.getStyle(O[te][0],"textSecantBg"),u=A.draw(new R.PhyloCanvas.Render.Path(ue,{attr:p.type?{}:p}));p.type&&p.type=="radialGradient"&&u[0].node.setAttribute("fill","url(#"+p.name+")"),p.type&&p.type=="radialGradient"&&u[0].node.setAttribute("stroke","none"),u[0].toBack()}}var ue=De(F,F+W+C.bufferOuterLabels,(de||1)-I/2,360-I/2),u=A.draw(new R.PhyloCanvas.Render.Path(ue,{attr:R.PhyloCanvas.Render.Style.textSecantBg}));return u[0].toBack(),F+W+C.bufferOuterLabels}function Re(ue,te,pe){for(var Ce=pe&&pe.bufferInner?parseFloat(pe.bufferInner):R.PhyloCanvas.Render.Parameters.binaryChartBufferInner,p=(pe&&pe.bufferSiblings?pe.bufferSiblings*I:0)|(R.PhyloCanvas.Render.Parameters.binaryChartBufferSiblings<1?I*R.PhyloCanvas.Render.Parameters.binaryChartBufferSiblings:R.PhyloCanvas.Render.Parameters.binaryChartBufferSiblings),u=pe&&pe.thickness?parseFloat(pe.thickness):R.PhyloCanvas.Render.Parameters.binaryChartThickness,c=(pe&&pe.disjointed?pe.disjointed:!1)|R.PhyloCanvas.Render.Parameters.binaryChartDisjointed,g=pe&&pe.isInternal?pe.isInternal:!1,S=!0,N,H=0;H<T.length;H++){var ne=T[H];if((!T[H+1]||ne.chart[te]!==T[H+1].chart[te]||c)&&ne.chart[te]!="none"){var j=R.PhyloCanvas.Render.Style.getStyle(ne.chart[te],"textSecantBg");if(g)var K=[F-Ce-u,F-Ce,(N||ne.y)-I/2+(S&&!c?0:p/2),ne.y+I/2-(H==T.length-1&&!c?0:p/2)];else var K=[ue+Ce,ue+Ce+u,(N||ne.y)-I/2+(S&&!c?0:p/2),ne.y+I/2-(H==T.length-1&&!c?0:p/2)];if(j.label){var ie=R.PhyloCanvas.Render.Style.getStyle(j.labelStyle,"text"),E=ke((K[0]+K[1])/2,(K[2]+K[3])/2),Pe=se((K[2]+K[3])/2),L=We(Pe[0]+(ie.rotate?parseFloat(ie.rotate):0)),Ae=We(90-(K[2]+K[3])/2-me);Ae>90&&Ae<270&&(L+=180),ie["text-anchor"]||(ie["text-anchor"]="middle"),ne.font_color_hex?j.fill=ne.font_color_hex:j.fill="#000000";var He=A.draw(new R.PhyloCanvas.Render.Text(E[0],E[1],j.label,{attr:ie,rotate:L}));He[0].toBack()}if(j.borderStyle){var $e=R.PhyloCanvas.Render.Style.getStyle(j.borderStyle,"textSecantBg"),Ye=[F,$e.fullsize?K[1]:K[0],K[2],K[3]],Fe=A.draw(new R.PhyloCanvas.Render.Path(De(Ye),{attr:$e}));Fe[0].toBack()}var et=A.draw(new R.PhyloCanvas.Render.Path(De(K),{attr:j}));et[0].toBack(),N=0,S=!1}else N||(N=ne.y),ne.chart[te]=="none"&&(N=0);S=!1}return g?ue:ue+Ce+u}function Me(ue,te,pe){for(var Ce=[],p,u=pe&&pe.bufferInner?parseFloat(pe.bufferInner):R.PhyloCanvas.Render.Parameters.barChartBufferInner,c=pe&&pe.height?parseFloat(pe.height):R.PhyloCanvas.Render.Parameters.barChartHeight?R.PhyloCanvas.Render.Parameters.barChartHeight:0,g=pe&&pe.width?parseFloat(pe.width)<1?I*parseFloat(pe.width):parseFloat(pe.width):0|(R.PhyloCanvas.Render.Parameters.barChartWidth<1?I*R.PhyloCanvas.Render.Parameters.barChartWidth:R.PhyloCanvas.Render.Parameters.barChartWidth),S=0,N=0;N<T.length;N++)Ce.push(T[N].chart[te]);p=Math.max.apply(null,Ce),S=R.Common.roundFloat(c/p,4);for(var N=0;N<T.length;N++){var H=T[N];H.chart[te]>0&&A.draw(new R.PhyloCanvas.Render.Path(De(ue+u,ue+u+S*H.chart[te],H.y-g/2,H.y+g/2),{attr:R.PhyloCanvas.Render.Style.getStyle(H.chart[te],"barChart")}))}return ue+u+c}return function(ue,te,pe){if(this.getCanvasSize=function(){return[M,G]},this.getRoot=function(){return te.getRoot()},te.getValidate()){ue.draw({type:"text",x:0,y:ue.canvasSize[1]/3,text:te.getValidate()});return}A=ue;var Ce=te.getRoot(),p=te.getNewickLen();if(M=A.canvasSize[0],G=A.canvasSize[1],Y=M/2,U=G/2,X=Math.min.apply(null,[M,G]),pe=C.bufferRadius>1?C.bufferRadius:R.Common.roundFloat(X*C.bufferRadius,4),de=C.bufferAngle,d=C.innerCircleRadius,l=C.minHeightBetweenLeaves,me=C.initStartAngle,F=Math.round((X-pe-d)/2),$=(F-d)/p,I=R.Common.roundFloat((360-de)/Ce.getCountAllChildren(),4),Ee(Ce,d),Q=F+W+C.bufferOuterLabels,R.PhyloCanvas.Render.Parameters.integratedBinaryCharts.length){var u=R.PhyloCanvas.Render.Parameters.integratedBinaryCharts;for(var c in u){var g=u[c].bufferInner?u[c].bufferInner:R.PhyloCanvas.Render.Parameters.binaryChartBufferInner,S=u[c].thickness?u[c].thickness:R.PhyloCanvas.Render.Parameters.binaryChartThickness;Q=Re(Q-S-g,u[c].chart,u[c])}}if(Q=Z(),R.PhyloCanvas.Render.Parameters.binaryCharts.length){var N=R.PhyloCanvas.Render.Parameters.binaryCharts;for(var c in N)Q=Re(Q,N[c].chart,N[c])}if(R.PhyloCanvas.Render.Parameters.barCharts.length){var H=R.PhyloCanvas.Render.Parameters.barCharts;for(var c in H)Q=Me(Q,H[c].chart,H[c])}T=[],O=[]}}();R.PhyloCanvas.Render.CircularPhylogram.prototype={};var Et=function(){var A=function(G){if(!!G&&typeof G=="object"){let X=function(){};return X.prototype=G,new X}},C=function(G){var X="";!!G&&typeof G=="string"&&(X=G);var $=/^((-)?([0-9]*)((\.{0,1})([0-9]+))?$)/;return $.test(X)},M={xmlToJSON:function(G){try{let d=function(F){return F.replace(/^\s+|\s+$/gm,"")},x=function(F){var T=/-/g,O=String(F).replace(T,"_");return O},B=function(F,T){if(T.attributes.length>0){var O=T.attributes.length-1,ee;F._attributes=[];do ee=String(x(T.attributes[O].name)),F._attributes.push(ee),F[ee]=d(T.attributes[O].value);while(O--)}},Y=function(F){F.getNodeByAttribute=function(T,O){if(this.length>0){var ee,de=this.length-1;try{do if(ee=this[de],ee[T]==O)return ee;while(de--)}catch(Q){return!1}return!1}},F.contains=function(T,O){if(this.length>0){var ee=this.length-1;try{do if(this[ee][T]==O)return!0;while(ee--)}catch(de){return!1}return!1}},F.indexOf=function(T,O){var ee=-1;if(this.length>0){var de=this.length-1;try{do this[de][T]==O&&(ee=de);while(de--)}catch(Q){return-1}return ee}},F.SortByAttribute=function(T,O){if(this.length){let ee=function(Q,W){var me=Q[W];return me=C(me)?parseFloat(me):me,me},de=function(Q,W){var me=0,be,ke;return be=ee(Q,T),ke=ee(W,T),be<ke?me=-1:ke<be&&(me=1),O&&(me=O.toUpperCase()=="DESC"?0-me:me),me};this.sort(de)}},F.SortByValue=function(T){if(this.length){let O=function(de){var Q=de.Text;return Q=C(Q)?parseFloat(Q):Q,Q},ee=function(de,Q){var W=0,me,be;return me=O(de),be=O(Q),me<be?W=-1:be<me&&(W=1),T&&(W=T.toUpperCase()=="DESC"?0-W:W),W};this.sort(ee)}},F.SortByNode=function(T,O){if(this.length){let ee=function(Q,W){var me=Q[W][0].Text;return me=C(me)?parseFloat(me):me,me},de=function(Q,W){var me=0,be,ke;return be=ee(Q,T),ke=ee(W,T),be<ke?me=-1:ke<be&&(me=1),O&&(me=O.toUpperCase()=="DESC"?0-me:me),me};this.sort(de)}}},U=function(F,T){var O,ee,de,Q="";if(!T)return null;if(T.attributes.length>0&&B(F,T),F.Text="",T.hasChildNodes()){var W=T.childNodes.length-1,me=0;do switch(ee=T.childNodes[me],ee.nodeType){case 1:F._children=[],O=ee.localName?ee.localName:ee.baseName,O=x(O),Q!=O&&F._children.push(O),F[O]||(F[O]=[]),de={},F[O].push(de),ee.attributes.length>0&&B(de,ee),F[O].contains||Y(F[O]),Q=O,ee.hasChildNodes()&&U(de,ee);break;case 3:F.Text+=d(ee.nodeValue);break;case 4:F.Text+=ee.text?d(ee.text):d(ee.nodeValue);break}while(me++<W)}};if(!G)return null;var X={};X.typeOf="JSXBObject";var $=G.nodeType==9?G.documentElement:G;if(X.RootName=$.nodeName||"",G.nodeType==3||G.nodeType==4)return G.nodeValue;var I=function(){var F={activate:function(){var T=[];return T&&(T.getNodesByAttribute=function(O,ee){if(!!T&&T.length>0){var de=[],Q,W=T.length-1;try{do Q=T[W],Q[O]===ee&&de.push(Q);while(W--);return de.reverse(),de}catch(me){return null}return null}},T.getNodeByAttribute=function(O,ee){if(!!T&&T.length>0){var de,Q=T.length-1;try{do if(de=T[Q],de[O]===ee)return de;while(Q--)}catch(W){return null}return null}},T.getNodesByValue=function(O){if(!!T&&T.length>0){var ee=[],de,Q=T.length-1;try{do de=T[Q],!!de.Text&&de.Text===O&&ee.push(de);while(Q--);return ee}catch(W){return null}return null}},T.contains=function(O,ee){if(!!T&&T.length>0){var de=T.length-1;try{do if(T[de][O]===ee)return!0;while(de--)}catch(Q){return!1}return!1}},T.indexOf=function(O,ee){var de=-1;if(!!T&&T.length>0){var Q=T.length-1;try{do T[Q][O]===ee&&(de=Q);while(Q--)}catch(W){return-1}return de}},T.SortByAttribute=function(O,ee){if(!!T&&T.length>0){let de=function(W,me){var be=W[me];return be=bam.validation.isNumeric(be)?parseFloat(be):be,be},Q=function(W,me){var be,ke;be=de(W,O),ke=de(me,O);var se=be<ke?-1:ke<be?1:0;return ee&&(se=ee.toUpperCase()==="DESC"?0-se:se),se};T.sort(Q)}},T.SortByValue=function(O){if(!!T&&T.length>0){let ee=function(Q){var W=Q.Text;return W=bam.validation.isNumeric(W)?parseFloat(W):W,W},de=function(Q,W){var me,be;me=ee(Q),be=ee(W);var ke=me<be?-1:be<me?1:0;return O&&(ke=O.toUpperCase()==="DESC"?0-ke:ke),ke};T.sort(de)}},T.SortByNode=function(O,ee){if(!!T&&T.length>0){let de=function(W,me){var be=W[me][0].Text;return be=bam.validation.isNumeric(be)?parseFloat(be):be,be},Q=function(W,me){var be,ke;be=de(W,O),ke=de(me,O);var se=be<ke?-1:ke<be?1:0;return ee&&(se=ee.toUpperCase()==="DESC"?0-se:se),se};T.sort(Q)}}),T}};return F}(),l=function(){var F=A(I);return F.activate()};return U(X,$),G=null,$=null,X}catch(d){return null}},textToXML:function(G){var X=null;try{X=document.all?new ActiveXObject("Microsoft.XMLDOM"):new DOMParser,X.async=!1}catch(I){throw new Error("XML Parser could not be instantiated")}var $;try{document.all?$=X.loadXML(G)?X:!1:$=X.parseFromString(G,"text/xml")}catch(I){throw new Error("Error parsing XML string")}return $}};return M}();var Jt=`<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform" 
                xmlns:x="http://www.tei-c.org/ns/1.0"
                exclude-result-prefixes="x">
<xsl:output method="html"/>
<xsl:template match="x:w">
    <xsl:element name="span">
        <xsl:attribute name="data-n"><xsl:value-of select="@n"/></xsl:attribute>
        <xsl:if test="@lemma">
            <xsl:attribute name="data-normal"><xsl:value-of select="@lemma"/></xsl:attribute>
        </xsl:if>
        <xsl:if test="@emended">
            <xsl:attribute name="data-emended"><xsl:value-of select="@emended"/></xsl:attribute>
        </xsl:if>
       <xsl:choose>
           <xsl:when test="not(normalize-space(.))">
                <xsl:attribute name="class">lemma invisible</xsl:attribute>
                <xsl:text>&#x00A0;</xsl:text>
            </xsl:when>
            <xsl:otherwise>
                <xsl:attribute name="class">lemma</xsl:attribute>
            </xsl:otherwise>
        </xsl:choose>
        <xsl:apply-templates/>
    </xsl:element>
    <xsl:text>&#173;</xsl:text>
</xsl:template>
<xsl:template match="x:cl">
    <xsl:element name="span">
        <xsl:attribute name="class">group</xsl:attribute>
        <xsl:apply-templates/>
    </xsl:element>
</xsl:template>
<xsl:template match="x:pb">
    <xsl:element name="hr">
        <xsl:attribute name="data-n"><xsl:value-of select="@n"/></xsl:attribute>
    </xsl:element>
    <xsl:element name="img">
        <xsl:attribute name="class">editbutton</xsl:attribute>
        <xsl:attribute name="data-n"><xsl:value-of select="@n"/></xsl:attribute>
        <xsl:attribute name="src">edit_icon.svg</xsl:attribute>
    </xsl:element>
    <h3 class="pb" lang="en"><xsl:value-of select="@n"/></h3>
</xsl:template>

<xsl:template match="x:lb">
<br />
<span class="lb" lang="en"><xsl:value-of select="@n"/></span>
</xsl:template>

<xsl:template match="x:fw">
<div class="fw">(<i lang="en"><xsl:value-of select="@type"/>, <xsl:value-of select="@place"/></i>): <xsl:apply-templates/></div>
</xsl:template>

<xsl:template match="x:div[@type='story']">
    <span class="story" lang="en">(story no. <xsl:value-of select="@num"/>, <xsl:value-of select="@city"/>, <xsl:value-of select="@king"/>)</span>
    <xsl:apply-templates/>
</xsl:template>

<xsl:template match="x:div[@type='verse']">
    <span class="verse"><xsl:apply-templates /></span>
</xsl:template>

<xsl:template match="x:del">
    <xsl:variable name="rend" select="@rend"/>
    <xsl:element name="del">
        <xsl:attribute name="data-title">
            <xsl:text>deleted</xsl:text>
            <xsl:if test="string($rend)">
                <xsl:text> (</xsl:text>
                <xsl:value-of select="$rend"/>
                <xsl:text>)</xsl:text>
           </xsl:if>
        </xsl:attribute>
        <xsl:apply-templates/>
    </xsl:element>
</xsl:template>

<xsl:template match="x:add">
    <xsl:variable name="place" select="@place"/>
    <xsl:variable name="rend" select="@rend"/>
    <xsl:element name="ins">
        <xsl:attribute name="data-title">
            <xsl:text>added</xsl:text>
            <xsl:if test="string($rend) or string($place)">
                <xsl:text> (</xsl:text>
                <xsl:value-of select="$rend"/>
                <xsl:if test="string($rend) and string($place)">
                    <xsl:text>, </xsl:text>
                </xsl:if>
                <xsl:value-of select="$place"/>
                <xsl:text>)</xsl:text>
            </xsl:if>
        </xsl:attribute>
        <xsl:apply-templates/>
    </xsl:element>
</xsl:template>

<xsl:template match="x:subst">
    <span class="subst"><xsl:apply-templates /></span>
</xsl:template>

<xsl:template match="x:g">
    <xsl:element name="span">
        <xsl:attribute name="data-title"><xsl:value-of select="@rend"/></xsl:attribute>
        <xsl:attribute name="class">gaiji</xsl:attribute>
        <xsl:apply-templates/>
    </xsl:element>
</xsl:template>

<xsl:template match="x:lg">
  <xsl:element name="span">
    <xsl:attribute name="class">lg</xsl:attribute>
    <xsl:apply-templates/>
  </xsl:element>
</xsl:template>

<xsl:template match="x:l">
  <xsl:element name="span">
    <xsl:attribute name="class">l</xsl:attribute>
    <xsl:apply-templates/>
  </xsl:element>
</xsl:template>
</xsl:stylesheet>`;var wn=`<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
        xmlns:x="http://www.tei-c.org/ns/1.0"
        exclude-result-prefixes="x">
    <xsl:output indent="yes"/>
    <xsl:template match="x:span">
        <xsl:apply-templates/>
    </xsl:template>
    <xsl:template match="para[content-style][not(text())]">
        <xsl:value-of select="normalize-space(.)"/>
    </xsl:template>
    <xsl:template match="x:teiHeader">
        <xsl:text>&#10;&#32;&#32;&#32;&#32;</xsl:text>
            <xsl:copy><xsl:apply-templates select="node()|@*"/></xsl:copy>
    </xsl:template>
    <xsl:template match="x:xenoData">
        <xsl:text>&#10;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;</xsl:text>
            <xsl:copy><xsl:apply-templates select="node()|@*"/></xsl:copy>
        <xsl:text>&#10;&#32;&#32;&#32;&#32;</xsl:text>
    </xsl:template>
    <xsl:template match="x:TEI">
        <xsl:text>&#10;&#32;&#32;&#32;&#32;</xsl:text>
            <xsl:copy><xsl:apply-templates select="node()|@*"/></xsl:copy>
    </xsl:template>
    <xsl:template match="x:text">
        <xsl:text>&#10;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;</xsl:text>
            <xsl:copy><xsl:apply-templates select="node()|@*"/></xsl:copy>
        <xsl:text>&#10;&#32;&#32;&#32;&#32;</xsl:text>
    </xsl:template>
    <xsl:template match="x:w">
        <xsl:copy><xsl:apply-templates select="node()|@*"/></xsl:copy>
        <!--xsl:if test="not(position() = last())">
            <xsl:text>&#32;</xsl:text>
        </xsl:if-->
    </xsl:template>
    <xsl:template match="node()|@*">
        <xsl:copy>
            <xsl:apply-templates select="node()|@*"/>
        </xsl:copy>
    </xsl:template>
</xsl:stylesheet>`,Cn=`<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
        xmlns:x="http://www.tei-c.org/ns/1.0"
        exclude-result-prefixes="x">
<xsl:output method="text" omit-xml-declaration="yes"/>
    <xsl:strip-space elements="*"/>
    <xsl:template match="/">
        <xsl:apply-templates/>
    </xsl:template>
    <xsl:template match="para[content-style][not(text())]">
        <xsl:value-of select="normalize-space(.)"/>
    </xsl:template>
    <xsl:template match="x:teiCorpus">
        <xsl:apply-templates/>
    </xsl:template>
    <xsl:template match="x:TEI">
        <xsl:value-of select="@n"/><xsl:text>,</xsl:text>
        <xsl:apply-templates/>
        <xsl:text>&#xa;</xsl:text>
    </xsl:template>
    <xsl:template match="x:text">
        <xsl:apply-templates/>
    </xsl:template>
    <xsl:template match="x:w">
        <xsl:text>"</xsl:text><xsl:apply-templates/><xsl:text>"</xsl:text>
        <!--xsl:if test="not(position() = last())"-->
            <xsl:text>,</xsl:text>
        <!--/xsl:if-->
    </xsl:template>
    <!--xsl:template match="node()|@*">
        <xsl:copy>
            <xsl:apply-templates select="node()|@*"/>
        </xsl:copy>
    </xsl:template-->
</xsl:stylesheet>`,_n=`<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform" 
                xmlns:x="http://www.tei-c.org/ns/1.0"
                exclude-result-prefixes="x">
<xsl:output method="html"/>
<xsl:template match="x:teiCorpus">
    <xsl:element name="table">
        <xsl:apply-templates/>
    </xsl:element>
</xsl:template>
<xsl:template match="x:TEI">
    <xsl:apply-templates/>
</xsl:template>
<xsl:template match="x:text">
    <xsl:element name="tr">
        <xsl:attribute name="data-n"><xsl:value-of select="../@n"/></xsl:attribute>
        <xsl:if test="../@corresp">
            <xsl:attribute name="data-treename"><xsl:value-of select="../@corresp"/></xsl:attribute>
            <xsl:attribute name="data-nodename"><xsl:value-of select="../@select"/></xsl:attribute>
        </xsl:if>
        <xsl:element name="th">
            <xsl:attribute name="scope">row</xsl:attribute>
            <xsl:attribute name="draggable">true</xsl:attribute>
            <xsl:value-of select="../@n"/>
        </xsl:element>
        <xsl:apply-templates/>
    </xsl:element>
</xsl:template>
<xsl:template match="x:w">
    <xsl:element name="td">
        <xsl:choose>
            <xsl:when test="parent::x:cl">
                <xsl:choose>
                    <xsl:when test="position() = '1'">
                        <xsl:attribute name="class">lemma group-start</xsl:attribute>
                    </xsl:when>
                    <xsl:when test="position() = last()">
                        <xsl:attribute name="class">lemma group-end</xsl:attribute>
                    </xsl:when>
                    <xsl:otherwise>
                        <xsl:attribute name="class">lemma group-internal</xsl:attribute>
                    </xsl:otherwise>
                </xsl:choose>
            </xsl:when>
            <xsl:otherwise>
                <xsl:attribute name="class">lemma</xsl:attribute>
            </xsl:otherwise>
        </xsl:choose>
        <xsl:if test="@lemma">
            <xsl:attribute name="data-normal"><xsl:value-of select="@lemma"/></xsl:attribute>
        </xsl:if>
        <xsl:if test="@emended">
            <xsl:attribute name="data-emended">true</xsl:attribute>
        </xsl:if>
        <xsl:attribute name="data-n">
            <xsl:value-of select="@n"/>
        </xsl:attribute>
        <xsl:if test="@insignificant='true'">
            <xsl:attribute name="data-insignificant">true</xsl:attribute>
        </xsl:if>
        <xsl:if test="@binary='true'">
            <xsl:attribute name="data-binary">true</xsl:attribute>
        </xsl:if>
        <xsl:apply-templates/>
    </xsl:element>
</xsl:template>
</xsl:stylesheet>`;var kn=`<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform" 
                xmlns:x="http://www.w3.org/1999/xhtml"
                exclude-result-prefixes="x">
<xsl:output method="html" omit-xml-declaration="yes"/>

<xsl:template match="x:pb">
    <xsl:element name="hr">
        <xsl:attribute name="data-n"><xsl:value-of select="@n"/></xsl:attribute>
    </xsl:element>
    <xsl:element name="img">
        <xsl:attribute name="class">editbutton</xsl:attribute>
        <xsl:attribute name="data-n"><xsl:value-of select="@n"/></xsl:attribute>
        <xsl:attribute name="src">edit_icon.svg</xsl:attribute>
    </xsl:element>
    <h3 class="pb" lang="en"><xsl:value-of select="@n"/></h3>
</xsl:template>

<xsl:template match="x:lb">
<br />
<span class="lb" lang="en"><xsl:value-of select="@n"/></span>
</xsl:template>

<xsl:template match="x:fw">
<div class="fw">(<i lang="en"><xsl:value-of select="@type"/>, <xsl:value-of select="@place"/></i>): <xsl:apply-templates/></div>
</xsl:template>

<xsl:template match="x:div[@type='story']">
    <span class="story" lang="en">(story no. <xsl:value-of select="@num"/>, <xsl:value-of select="@city"/>, <xsl:value-of select="@king"/>)</span>
    <xsl:apply-templates/>
</xsl:template>

<xsl:template match="x:div[@type='verse']">
    <span class="verse"><xsl:apply-templates /></span>
</xsl:template>

<xsl:template match="x:del">
    <xsl:variable name="rend" select="@rend"/>
    <xsl:element name="del">
        <xsl:attribute name="data-title">
            <xsl:text>deleted</xsl:text>
            <xsl:if test="string($rend)">
                <xsl:text> (</xsl:text>
                <xsl:value-of select="$rend"/>
                <xsl:text>)</xsl:text>
           </xsl:if>
        </xsl:attribute>
        <xsl:apply-templates/>
    </xsl:element>
</xsl:template>

<xsl:template match="x:add">
    <xsl:variable name="place" select="@place"/>
    <xsl:variable name="rend" select="@rend"/>
    <xsl:element name="ins">
        <xsl:attribute name="data-title">
            <xsl:text>added</xsl:text>
            <xsl:if test="string($rend) or string($place)">
                <xsl:text> (</xsl:text>
                <xsl:value-of select="$rend"/>
                <xsl:if test="string($rend) and string($place)">
                    <xsl:text>, </xsl:text>
                </xsl:if>
                <xsl:value-of select="$place"/>
                <xsl:text>)</xsl:text>
            </xsl:if>
        </xsl:attribute>
        <xsl:apply-templates/>
    </xsl:element>
</xsl:template>

<xsl:template match="x:subst">
    <span class="subst"><xsl:apply-templates /></span>
</xsl:template>

<xsl:template match="x:g">
    <xsl:element name="span">
        <xsl:attribute name="data-title"><xsl:value-of select="@rend"/></xsl:attribute>
        <xsl:attribute name="class">gaiji</xsl:attribute>
        <xsl:apply-templates/>
    </xsl:element>
</xsl:template>

<xsl:template match="x:lg">
  <xsl:element name="span">
    <xsl:attribute name="class">tree-verse</xsl:attribute>
    <xsl:attribute name="lang">en</xsl:attribute>
    <xsl:text>[verse </xsl:text>
    <xsl:value-of select="@n"/>
    <xsl:text>]</xsl:text>
  </xsl:element>
</xsl:template>

<xsl:template match="x:l">
  <xsl:element name="span">
    <xsl:attribute name="class">l</xsl:attribute>
    <xsl:apply-templates/>
  </xsl:element>
</xsl:template>
</xsl:stylesheet>`,Sn=`<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform" 
                xmlns:x="http://www.w3.org/1999/xhtml"
                exclude-result-prefixes="x">
<xsl:output method="text" omit-xml-declaration="yes"/>
<xsl:template match="x:lg">
<xsl:value-of select="@n"/>
</xsl:template>
</xsl:stylesheet>
`;var An={id:"sa",leftmin:2,rightmin:2,patterns:{2:"a1e1i1o1u1Ã©1Ã­1Ã¯1Ã³1Ãº1Ã¼1Ä1Ä«1Å«1á¸·1á¸¹1á¹›1á¹1",3:"2b_2c_2d_2g_2h_2j_2k_2l_2m_2n_2p_2r_2s_2t_2v_2y_2Ã±_2Å›_2á¸_2á¸¥12á¸«12á¸·_2á¹12á¹ƒ12á¹…_2á¹‡_2á¹­_2áº–1lÌ¥1rÌ¥1",4:"2bh_2ch_2dh_2gh_2jh_2kh_2mÌ12ph_2rb_2rd_2rg_2rk_2rp_2rt_2rá¸_2rá¹­_2th_2á¸h_2á¹­h_a2i1a2u1a3Ã¯1a3Ã¼1lÌ¥Ì„1rÌ¥Ì„1"}};import{showSaveFilePicker as Qt}from"https://cdn.jsdelivr.net/npm/native-file-system-adapter/mod.js";function Ft(A){var C=[],M=0;if(this.trie=this.createTrie(A.patterns),this.leftMin=A.leftmin,this.rightMin=A.rightmin,this.exceptions={},A.exceptions)for(C=A.exceptions.split(/,\s?/g);M<C.length;M+=1)this.exceptions[C[M].replace(/\u2027/g,"").toLowerCase()]=new RegExp("("+C[M].split("â€§").join(")(")+")","i")}Ft.prototype.createTrie=function(A){var C=0,M=0,G=0,X=0,$=null,I=null,l=null,d=null,x={_points:[]},B;for(C in A)if(A.hasOwnProperty(C))for(B=A[C].match(new RegExp(".{1,"+ +C+"}","g")),M=0;M<B.length;M+=1){for($=B[M].replace(/[0-9]/g,"").split(""),I=B[M].split(/\D/),d=x,G=0;G<$.length;G+=1)l=$[G].charCodeAt(0),d[l]||(d[l]={}),d=d[l];for(d._points=[],X=0;X<I.length;X+=1)d._points[X]=I[X]||0}return x};Ft.prototype.hyphenateText=function(A,C){C=C||4;for(var M=A.split(/([a-zA-Z0-9_\u0027\u00AD\u00DF-\u00EA\u00EB\u00EC-\u00EF\u00F1-\u00F6\u00F8-\u00FD\u0101\u0103\u0105\u0107\u0109\u010D\u010F\u0111\u0113\u0117\u0119\u011B\u011D\u011F\u0123\u0125\u012B\u012F\u0131\u0135\u0137\u013C\u013E\u0142\u0144\u0146\u0148\u0151\u0153\u0155\u0159\u015B\u015D\u015F\u0161\u0165\u016B\u016D\u016F\u0171\u0173\u017A\u017C\u017E\u017F\u0219\u021B\u02BC\u0390\u03AC-\u03CE\u03F2\u0401\u0410-\u044F\u0451\u0454\u0456\u0457\u045E\u0491\u0531-\u0556\u0561-\u0587\u0902\u0903\u0905-\u090B\u090E-\u0910\u0912\u0914-\u0928\u092A-\u0939\u093E-\u0943\u0946-\u0948\u094A-\u094D\u0982\u0983\u0985-\u098B\u098F\u0990\u0994-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BE-\u09C3\u09C7\u09C8\u09CB-\u09CD\u09D7\u0A02\u0A03\u0A05-\u0A0A\u0A0F\u0A10\u0A14-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A82\u0A83\u0A85-\u0A8B\u0A8F\u0A90\u0A94-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABE-\u0AC3\u0AC7\u0AC8\u0ACB-\u0ACD\u0B02\u0B03\u0B05-\u0B0B\u0B0F\u0B10\u0B14-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3E-\u0B43\u0B47\u0B48\u0B4B-\u0B4D\u0B57\u0B82\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB5\u0BB7-\u0BB9\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD7\u0C02\u0C03\u0C05-\u0C0B\u0C0E-\u0C10\u0C12\u0C14-\u0C28\u0C2A-\u0C33\u0C35-\u0C39\u0C3E-\u0C43\u0C46-\u0C48\u0C4A-\u0C4D\u0C82\u0C83\u0C85-\u0C8B\u0C8E-\u0C90\u0C92\u0C94-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBE-\u0CC3\u0CC6-\u0CC8\u0CCA-\u0CCD\u0D02\u0D03\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D28\u0D2A-\u0D39\u0D3E-\u0D43\u0D46-\u0D48\u0D4A-\u0D4D\u0D57\u0D60\u0D61\u0D7A-\u0D7F\u1F00-\u1F07\u1F10-\u1F15\u1F20-\u1F27\u1F30-\u1F37\u1F40-\u1F45\u1F50-\u1F57\u1F60-\u1F67\u1F70-\u1F7D\u1F80-\u1F87\u1F90-\u1F97\u1FA0-\u1FA7\u1FB2-\u1FB4\u1FB6\u1FB7\u1FBD\u1FBF\u1FC2-\u1FC4\u1FC6\u1FC7\u1FD2\u1FD3\u1FD6\u1FD7\u1FE2-\u1FE7\u1FF2-\u1FF4\u1FF6\u1FF7\u200D\u2019]+)/gi),G=0;G<M.length;G+=1)M[G].indexOf("/")!==-1?G!==0&&G!==M.length-1&&!/\s+\/|\/\s+/.test(M[G])&&(M[G]+="â€‹"):M[G].length>C&&(M[G]=this.hyphenate(M[G]).join("Â­"));return M.join("")};Ft.prototype.hyphenate=function(A){var C,M=[],G,X,$,I,l,d=[],x,B=A.toLowerCase(),Y,U,F=Math.max,T=this.trie,O=[""];if(this.exceptions.hasOwnProperty(B))return A.match(this.exceptions[B]).slice(1);if(A.indexOf("Â­")!==-1)return[A];for(A="_"+A+"_",C=A.toLowerCase().split(""),G=A.split(""),x=C.length,X=0;X<x;X+=1)d[X]=0,M[X]=C[X].charCodeAt(0);for(X=0;X<x;X+=1)for(l=T,$=X;$<x&&(l=l[M[$]],l);$+=1)if(Y=l._points,Y)for(I=0,U=Y.length;I<U;I+=1)d[X+I]=F(d[X+I],Y[I]);for(X=1;X<x-1;X+=1)X>this.leftMin&&X<x-this.rightMin&&d[X]%2?O.push(G[X]):O[O.length-1]+=G[X];return O};var jn=Ft,Pn=jn;window.comboView=function(){"use strict";var A,C;let M="http://www.tei-c.org/ns/1.0";var G=new Map,X=[],$=[],I,l,d,x,B=[window],Y,U=[],F=[],T=!1,O=!1;let ee=["iast","devanagari","telugu","grantha","malayalam"],de=function(n){if(!n.startsWith("<lg"))return n;let r=Se(Sn);return Ie(n,r).firstChild.data.slice(1)},Q=function(n){return n.map(r=>de(r)).join(" ").replace(/\s+/g," ").trim()},W=function(n,r,a,o){var f=r,v=a,P=n;o&&(P=P*2,P>=1&&(P-=1,f=a,v=o));let z=v.red-f.red,D=v.green-f.green,V=v.blue-f.blue,J={red:parseInt(Math.floor(f.red+z*P),10),green:parseInt(Math.floor(f.green+D*P),10),blue:parseInt(Math.floor(f.blue+V*P),10)};return"rgb("+J.red+","+J.green+","+J.blue+")"},me={smush:function(n,r){return n.toLowerCase().replace(/([á¸drmvynhs]) ([aÄiÄ«uÅ«á¹›eoÃ©Ã³])/g,"$1$2"+r).replace(/([kgcjá¹­á¸tdpb]) h/g,"$1â€Œ"+r+"h").replace(/([kgcjÃ±á¸tdnpbmrlyvÅ›á¹£sá¹™]) ([kgcjá¹­á¸tdnpbmyrlvÅ›á¹£shá¸»])/g,"$1"+r+"$2").replace(/([oÃ³eÃ©Ä]) ([á¹ƒ'])/g,"$1"+r+"$2").replace(/^á¹ƒ/,"'â€á¹ƒ").replace(/^á¸¥/,"'â€á¸¥").replace(/^_y/,"'â€y").replace(/Ã¼/g,"â€Œu").replace(/Ã¯/g,"â€Œi").replace(/_{1,2}(?=\s*)/g,function(a){if(a==="__")return"â€";if(a==="_")return"â€Œ"})},iast:function(n,r){let a=r||"devanagari";return tt.t(n,a,"iast",{skip_sgml:!0})},devanagari:function(n,r){let a=r||"",o={skip_sgml:!0},f=n.replace(/á¹™/g,"r").replace(/^_Ä/,"à¤½â€à¤¾"),v=me.smush(f,a);return tt.t(v,"iast","devanagari",o).replace(/Â¯/g,"ê£»")},malayalam:function(n,r){let a=r||"",o={skip_sgml:!0},f={à´•:"àµ¿",à´¤:"àµ½",à´¨:"àµ»",à´®:"àµ”",à´°:"àµ¼"},v=n.replace(/^_Ä/,"à´½â€à´¾"),P=me.smush(v,a).replace(/e/g,"áº½").replace(/o/g,"Ãµ").replace(/á¹™/g,"r").replace(/á¹/g,"á¹ƒ").replace(/á¸¿/g,"á¹ƒ").replace(/Ã­/g,"i").replace(/Ãº/g,"u").replace(/Ã©/g,"e");return tt.t(P,"iast","malayalam",o).replace(/(^|[^àµ])à´°àµ(?=\S)/g,"$1àµ").replace(/([à´•à´¤à´¨à´®à´°])àµ(?![^\s\u200C,â€”â€™â€•])/g,function(D,V){return f[V]})},grantha:function(n,r){let a=r||"",o={skip_sgml:!0},f=new Map([["à´¸","î‡“"],["à´°","àµ¼"],["à´¯","î‡‹"],["à´š","î†¶"],["à´¦","î‡‚"],["à´¶","î‡’"]]),v=new RegExp("(["+[...f.keys()].join("")+"])àµ(?![^â€Œ ,â€”â€™â€•])","g"),P=n.replace(/^_Ä/,"à´½â€à´¾"),z=me.smush(P,a).replace(/e/g,"áº½").replace(/o/g,"Ãµ").replace(/á¹™/g,"r").replace(/á¹/g,"á¹ƒ").replace(/á¸¿/g,"á¹ƒ").replace(/Ã­/g,"i").replace(/Ãº/g,"u").replace(/Ã©/g,"e");return tt.t(z,"iast","malayalam",o).replace(/(^|[^àµ])à´°àµ(?=\S)/g,"$1àµ").replace(v,(V,J)=>f.get(J)).replace(/à´•àµà´·à´¿/g,"à®•à¯à®·à®¿")},telugu:function(n,r){var a=r||"";let o={skip_sgml:!0},f=n.replace(/^_Ä/,"à°½â€à°¾"),v=me.smush(f,a).replace(/e/g,"áº½").replace(/o/g,"Ãµ").replace(/á¹™/g,"râ€").replace(/á¹/g,"á¹ƒ").replace(/á¸¿/g,"á¹ƒ").replace(/Ã­/g,"i").replace(/Ãº/g,"u").replace(/Ã©/g,"e");return tt.t(v,"iast","telugu",o)}},be=function(n,r,a=!1,o="sa"){let f=me[r],v=n.cloneNode(!0),P=function(z,D){let V=z.childNodes;for(let J of V)if(J.nodeType!==8){if(J.nodeType===3){if(D!=="sa")continue;J.data=f(J.data,a)}else if(J.hasChildNodes()){let oe=J.getAttribute("lang")||D;oe==="sa"&&J.classList.contains("subst")&&We(J,r),P(J,oe)}}};return P(v,o),v},ke=function(n,r=!1){if(n.nodeType===3)return n;let a=document.createTreeWalker(n,NodeFilter.SHOW_TEXT,null,!1);if(r){let o;for(;a.nextNode();)o=a.currentNode;return o}else return a.nextNode},se=function(){let n=window.getSelection();if(n.isCollapsed)return!1;let r=n.rangeCount>1?n.getRangeAt(1).cloneContents():n.getRangeAt(0).cloneContents();if(!r)return!1;let a=new Set,o=r.querySelectorAll(".lemma");for(let f of o)a.add(f.dataset.n);return a},Se=function(n){var r=new DOMParser;let a=r.parseFromString(n,"text/xml"),o=new XSLTProcessor;return o.importStylesheet(a),o},Ie=function(n,r){let a=C.createElementNS(M,"ab");return a.innerHTML=n,r.transformToFragment(a,document)},We=function(n,r){if(n.firstChild.nodeType!==3&&n.lastChild.nodeType!==3)return;let a=n.childNodes,o=/^[aÄiÄ«uÅ«eoá¹›á¹á¸·á¹ƒá¸¥]/,f=/[kgá¹…cjÃ±á¹­á¸á¹‡tdnpbmyrlvá¹£Å›sh]$/,v=["Ä","i","Ä«","e","o","_","ai","au"],P=["h","k","Å›","y","g","gh","c","ch","jh","á¹­h","á¸","á¸h","t","th","d","dh","n","p","ph","bh","m","r","á¸»","v","á¹£","s"];var z=!1,D=[],V=[];let J=a[0].nodeType===3;for(let oe of a){if(oe.nodeType>3)continue;let we=oe.textContent.trim();if(we!==""){if(we==="a"){oe.textContent="";continue}if(we.match(f)){let Le=ke(oe,!0);Le.textContent=Le.textContent.replace(/\s+$/,"")+"a",r==="telugu"&&P.indexOf(we)>=0&&D.push(oe)}if(oe===n.lastChild&&oe.nodeType===3){let Le=document.createElement("span");Le.appendChild(oe.cloneNode(!1)),n.replaceChild(Le,oe),oe=Le,oe.classList.add("aalt")}else J&&we.match(o)&&oe.classList.add("aalt");switch(r){case"devanagari":(we==="i"||we==="Ã©")&&V.unshift(oe);break;case"grantha":case"malayalam":if(we==="e"||we==="ai")V.unshift(oe);else if(we==="o"){let Le=oe.cloneNode(!0);De("o","e",Le),V.unshift(Le),De("o","Ä",oe)}break;case"telugu":!z&&v.indexOf(we)>=0&&(z=!0);break}}}for(let oe of V)n.insertBefore(oe,n.firstChild);if(z)for(let oe of D){let we=ke(oe,!0);we.textContent=we.textContent+"â€à±"}},De=function(n,r,a){let o=document.createTreeWalker(a,NodeFilter.SHOW_TEXT,null,!1);for(;o.nextNode();)o.currentNode.textContent.match(n)&&(o.currentNode.textContent=r)},Ee=function(){let n=document.getElementById("tooltip");n&&n.remove()},qe=function(){let n=document.getElementById("left_menu");n.innerHTML=`<div id="matrixmenu" class="menubox">
    <div class="heading">Matrix</div>
      <ul>
        <li>select CSV/XML file(s): <input type="file" id="file" name="file" accept=".xml,.csv" multiple/></li>
      </ul>
</div>
<div style="display: none" id="mssmenu" class="menubox">
    <div class="heading">Texts</div>
    <ul class="ms">
    </ul>
</div>
<div style="display: none" id="treemenu" class="menubox">
    <div class="heading">Trees</div>
        <ul class="tree">
            <li>select NeXML file: <input type="file" id="treefile" name="treefile" accept=".xml"/></li>
        </ul>
    </div>
`;let r=document.getElementById("menu");r.addEventListener("mouseover",ie.menuMouseover),r.addEventListener("mouseout",ie.menuMouseout),r.addEventListener("click",ie.menuClick),r.querySelector("#file").addEventListener("change",p.bind(null,u),!1),r.querySelector("#treefile").addEventListener("change",p.bind(null,c),!1)},Z={matrix:function(){return I=new at,I.init(),I.show(),document.getElementById("matrixmenu").style.display="none",Re(),Ce.rehighlight(),I},text:function(n){let r=new nt(n);return $.push(r),r.init(),r.show(),Re(),Ce.rehighlight(),document.querySelector(".highlit")||ie.textClick({target:r.boxdiv.querySelector(".lemma:not(.invisible)")}),r},tree:function(n,r){let a=new et(n,r);return X.push(a),a.init(),a.show(),Re(),Ce.rehighlight(),a}},Re=function(){for(let n of X)n.draw()},Me=function(){let n=window.getSelection?window.getSelection():document.selection;n&&(n.removeAllRanges?n.removeAllRanges():n.empty&&n.empty())},ue=function(n){if(!n||n.size===0)return;Ce.unHighlightAll();let[r,a]=L.lowhigh(n);if(a!==void 0)for(let o=r;o<=a;o++)Ce.highlightLemma(o,!0);else Ce.highlightLemma(r);Ce.repopulateTrees(r,a);for(let o of l.querySelectorAll(".text-box"))o.querySelector(".highlit")||o.querySelector('[data-n="'+r+'"]').classList.add("highlit");Pe.xScroll(r)},te=function(n){let r=document.createTreeWalker(n,NodeFilter.SHOW_TEXT);for(;r.nextNode();){let a=pe(r.currentNode.nodeValue);r.currentNode.nodeValue=a}},pe=function(n){return new Pn(An).hyphenate(n.replace(/ \|/g,"Â |").replace(/\| (?=\d)/g,"|Â ").replace(/\|\|/g,"à¥¥").replace(/\|/g,"à¥¤"))},Ce={getAllWindows:function(){return window.mainWindow?window.mainWindow.comboView.getWindows():B},forEachWindow:function(n){let r=Ce.getAllWindows();for(let a of r)if(!a.closed&&n(a)===!1)break},highlightLemma:function(n,r){var a=!!r;Ce.forEachWindow(o=>{let f=o.comboView.getViewdiv().querySelectorAll('[data-n="'+n+'"]');for(let P of f)(!a||!P.classList.contains("invisible"))&&P.classList.add("highlit");let v=o.comboView.getViewdiv().querySelectorAll('[data-n-trans="'+n+'"]');for(let P of v)P.classList.add("translit")})},highlightAll:function(){Ae.anyhighlit()?Ce.unHighlightAll():ue(new Set([0,L.maxlemma()]))},unHighlightAll:function(){Ce.forEachWindow(n=>{let r=n.comboView.getViewdiv().querySelectorAll(".highlit");for(let o of r)o.classList.remove("highlit");let a=n.comboView.getViewdiv().querySelectorAll(".translit");for(let o of a)o.classList.remove("translit");Ce.unCelllightAll()})},unCelllightAll:function(){Ce.forEachWindow(n=>{let r=n.comboView.getViewdiv().querySelectorAll(".highlitcell");for(let a of r)a.classList.remove("highlitcell")})},rehighlight:function(){var n;if(Ce.forEachWindow(a=>{if(n=a.document.querySelectorAll(".highlit"),n.length>0)return!1}),n.length>0){var r=new Set;for(let a of n)r.add(a.dataset.n);ue(r)}},clearTrees:function(){Ce.forEachWindow(n=>{let r=n.comboView.getTrees();for(let a of r)a.clearlemmata()})},repopulateTrees:function(n,r){Ce.forEachWindow(a=>{let o=a.comboView.getTrees();for(let f of o)f.populate(n,r),f.colourizeVariants(n,r),f.updatescript()})},highlightTreeLemma:function(n){Ce.forEachWindow(r=>{let a=r.comboView.getTrees();for(let o of a){let f=o.boxdiv.querySelector('.tree-lemma[data-id="'+n+'"]'),v=o.boxdiv.querySelectorAll(".tree-lemma");for(let P of v)(f.dataset.nodes&&P.dataset.nodes===f.dataset.nodes||!f.dataset.nodes&&P.dataset.id===f.dataset.id)&&P.classList.add("highlit");o.clearLabels()}})},unhighlightTrees:function(){Ce.forEachWindow(n=>{let r=n.comboView.getViewdiv().querySelectorAll(".tree-lemma.highlit");for(let o of r)o.classList.remove("highlit");let a=n.comboView.getTrees();for(let o of a)o.clearLabels()})}},p=function(n,r){let a=r.target.files[0],o=[...r.target.files].slice(1),f=new FileReader;f.onload=n.bind(null,a,o),f.readAsText(a)},u=function(n,r,a){A=n.name,document.title=document.title+`: ${A}`,A.split(".").pop()==="csv"?S(n,r,a):N(n,r,a)},c=function(n,r,a){let o=a.target.result,v=new DOMParser().parseFromString(o,"text/xml"),P=C.querySelector("teiHeader > xenoData")||function(){let D=C.querySelector("teiHeader")||function(){let J=C.createElementNS(M,"teiHeader");return C.documentElement.appendChild(J),J}(),V=C.createElementNS(M,"xenoData");return D.appendChild(V),V}(),z=C.createElementNS(M,"stemma");z.setAttribute("format","nexml"),z.id="stemma"+[...P.querySelectorAll("stemma")].length,z.appendChild(v.firstChild.cloneNode(!0)),P.appendChild(z),g(v,z.id)},g=function(n,r,a=!0){let o=n.querySelectorAll("tree"),f=document.querySelector("#treemenu ul");for(let v of o){let P=v.id,z=n.cloneNode(!0);for(let J of z.querySelectorAll("tree"))J.id!==P&&J.parentNode.removeChild(J);let D=v.getAttribute("label")||"New Tree "+G.size;G.set(`#${r} #${P}`,z);let V=document.createElement("li");V.dataset.name=D,V.dataset.treeid=P,V.dataset.stemmaid=r,V.appendChild(document.createTextNode(D)),f.insertBefore(V,f.lastElementChild),a&&Z.tree(r,P)}},S=function(n,r,a){let o=Yt.parse(a.target.result,{delimiter:","});C=document.implementation.createDocument(M,"",null);let f=C.createElementNS(M,"teiCorpus"),v=C.createElementNS(M,"teiHeader");f.appendChild(v),C.appendChild(f);for(let P of o){let z=P[0],D=P.slice(1),V=C.createElementNS(M,"TEI");V.setAttribute("n",z);let J=C.createElementNS(M,"text");for(let oe=0;oe<D.length;oe++){let we=D[oe],Le=C.createElementNS(M,"w");we&&Le.appendChild(document.createTextNode(we)),Le.setAttribute("n",oe),J.appendChild(Le)}V.appendChild(J),f.appendChild(V)}C.normalize(),x=L.maxlemma(),j()},N=function(n,r,a){C=new DOMParser().parseFromString(a.target.result,"text/xml");let f=C.querySelectorAll("teiHeader xenoData stemma nexml");for(let v of f){let P=document.implementation.createDocument("http://www.nexml.org/2009","",null);P.appendChild(v.cloneNode(!0)),g(P,v.closest("stemma").id,!1)}x=L.maxlemma(),r.length>0?H(r):j()},H=function(n){let r=n[0],a=n.slice(1),o=function(P,z){let D=new Set(P);for(let V of z)D.delete(V);return D},f=function(P,z){let V=new DOMParser().parseFromString(z.target.result,"text/xml"),J=new Map;for(let Ve of L.teis()){let Je=Ve.getAttribute("n");J.set(Je,Ve)}let oe=new Set(J.keys()),we=new Map;for(let Ve of V.querySelectorAll("TEI")){let Je=Ve.getAttribute("n");we.set(Je,Ve)}let Le=new Set(we.keys()),Be=o(oe,Le),Te=o(Le,oe);for(let Ve of Te)He.tei(Ve);let ze=[...V.querySelector("text").querySelectorAll("w[n]")].length,Ue=x+ze;for(let[Ve,Je]of we)if(J.has(Ve)){let lt=J.get(Ve).querySelector("text"),st=Je.querySelector("text").querySelectorAll("w[n]");var Xe=x+1;for(let it of st)it.setAttribute("n",Xe),lt.appendChild(it),Xe=Xe+1}else{let lt=C.createElementNS(M,"TEI");lt.setAttribute("n",Ve);let rt=C.createElementNS(M,"text");He.emptywords(rt,Ue,0),lt.appendChild(rt),C.documentElement.appendChild(lt)}for(let Ve of Be){let Je=J.get(Ve).querySelector("text");He.emptywords(Je,Ue,x+1)}x=L.maxlemma(),P.length>0?H(P):j()},v=new FileReader;v.onload=f.bind(null,a),v.readAsText(r)},ne=function(){var n="";let r=[...L.teis()].map(a=>a.getAttribute("n"));for(let a of r)n+=`<li data-name="${a}">${a}</li>`;document.getElementById("menu").querySelector(".ms").innerHTML=n},j=function(){ne();let n=new Ye("Export");n.populate([{text:"TEI corpus",func:K.showOptions.bind(null,K.xml,K.options)},{text:"TEI apparatus",func:K.showOptions.bind(null,K.xml,K.appOptions)},{text:"CSV",func:K.showOptions.bind(null,K.csv,K.options)},{text:"NEXUS",func:K.showOptions.bind(null,K.nexus,K.options)}]);let r=new Ye("Edit");r.populate([{text:"Undo",greyout:Ae.undo,func:E.undo},{text:"Redo",greyout:Ae.redo,func:E.redo},{text:"Select all",alt:"Deselect all",toggle:Ae.anyhighlit,func:Ce.highlightAll},{text:"(Re)normalize columns",greyout:Ae.anyhighlit,func:E.startRenormalize.bind(null,!1)},{text:"Delete column",greyout:Ae.anyhighlit,func:E.startRemoveCol.bind(null,!1)},{text:"Delete empty columns",func:E.startRemoveEmpty},{text:"Merge columns",greyout:Ae.manyhighlit,func:E.startMerge.bind(null,!1)},{text:"Group columns",alt:"Ungroup columns",greyout:Ae.oneGrouped,toggle:Ae.grouped,func:E.startGroup.bind(null,!1)},{text:"Group words",func:E.doGroupWords},{text:"Edit cell",greyout:Ae.highlitcell,func:E.startEditCell.bind(null,!1)},{text:"Insert row",func:E.startNewRow},{text:"Insert column",greyout:Ae.anyhighlit,func:E.startInsertCol},{text:"Mark insignificant",checkbox:Ae.checkbox.bind(null,"insignificant",!1),greyout:Ae.anyhighlit,func:E.startMarkAs.bind(null,"insignificant",!1)},{text:"Mark binary",checkbox:Ae.checkbox.bind(null,"binary",!1),greyout:Ae.anyhighlit,func:E.startMarkAs.bind(null,"binary",!1)}]);let a=new Ye("View");a.populate([{text:"Header",checkbox:Ae.headerView,func:Pe.toggleHeader},{text:"Normalized",checkbox:Ae.normalizedView,greyout:Ae.anyNormalized,func:Pe.toggleNormalize}]);let o=document.getElementById("left_menu");o.appendChild(a.box),o.appendChild(r.box),o.appendChild(n.box);let f=document.getElementById("views");f.style.justifyContent="flex-start",f.removeChild(f.querySelector("#splash")),Z.matrix();let v=document.getElementById("matrixmenu");v.addEventListener("click",Z.matrix),v.removeChild(v.querySelector("ul")),document.getElementById("mssmenu").style.display="block",document.getElementById("treemenu").style.display="block"},K={write:async function(n,r){let a=await r.createWritable();a.write(n),a.close()},xml:async function(n){let r=Se(wn),a=new XMLSerializer().serializeToString(r.transformToDocument(n)),o=new Blob([a],{type:"text/xml;charset=utf-8"}),f=L.basename()+".xml",v=await Qt({_preferPolyfill:!1,suggestedName:f,types:[{description:"TEI XML",accept:{"text/xml":[".xml"]}}]});K.write(o,v)},csv:async function(n){let a=Se(Cn).transformToDocument(n).documentElement.textContent,o=new Blob([a],{type:"text/csv;charset=utf-8"}),f=L.basename()+".csv",v=await Qt({_preferPolyfill:!1,suggestedName:f,types:[{description:"CSV file",accept:{"text/csv":[".csv"]}}]});K.write(o,v)},nexus:async function(n){let r=[...L.texts(n)],a=r.length,o="0 1 2 3 4 5 6 7 8 9 A B C D E F G H K L M N P Q R S T U V W X Y Z a b c d e f g h k l m n p q r s t u v w x y z",[f,...v]=o.split(" "),P="-",z=r.map(Xe=>"'"+Xe.parentElement.getAttribute("n")+"'"),D=r.map(Xe=>L.textWalker(Xe)),V=r[0].querySelectorAll("w").length,J=[],oe=z.map(Xe=>[Xe+" "]);for(let Xe=0;Xe<V;Xe++){let Ve=new Set,Je=[];for(let rt=0;rt<D.length;rt++){let it=D[rt].nextNode(),ct=tt.t(it.textContent.trim().toLowerCase(),"iast","hk").replace(/'/g,"()");Je.push(ct),ct!==""&&ct!=="[]"&&Ve.add(ct)}J.push(["[]",...Ve]);let lt=new Map([...Ve].map((rt,st)=>[rt,v[st]]));for(let rt=0;rt<Je.length;rt++){let st=(it=>{switch(Je[it]){case"":return P;case"[]":return f;default:return lt.get(Je[it])}})(rt);oe[rt].push(st)}}let we=J.map((Xe,Ve)=>Ve+1+" / "+[...Xe].map(Je=>`'${Je}'`).join(" ")).join(`,
`),Le=oe.map(Xe=>Xe.join("")).map(Xe=>Xe.replace(/0{8,}/g,Ve=>Ve.replace(/0/g,"-"))).reduce((Xe,Ve)=>Xe+`
`+Ve),Be=`#NEXUS

BEGIN TAXA;
  DIMENSIONS NTAX=${a};
  TAXLABELS ${z.join(" ")};
END;

BEGIN CHARACTERS;
  DIMENSIONS
    NCHAR=${V};
  FORMAT 
    DATATYPE=STANDARD 
    RESPECTCASE 
    GAP=${P} 
    MISSING=? 
    SYMBOLS="${o}";
  CHARSTATELABELS
${we}
;
MATRIX
${Le}
;
END;
`,Te=new Blob([Be],{type:"text/nexus;charset=iso8859-1"}),ze=L.basename()+".nex",Ue=await Qt({_preferPolyfill:!1,suggestedName:ze,types:[{description:"NEXUS file",accept:{"text/nexus":[".nex"]}}]});K.write(Te,Ue)},processOptions:function(n){let r=C.cloneNode(!0);if(n.get("option_normalize")){let a=r.querySelectorAll("w[lemma]");for(let o of a)o.textContent=o.getAttribute("lemma")}if(n.get("option_mergegroups")){let a=r.querySelectorAll("cl");for(let o of a){let f=o.removeChild(o.firstChild);for(;o.firstChild;){let v=f.getAttribute("lemma")||f.textContent,P=o.firstChild.getAttribute("lemma")||o.firstChild.textContent;for(f.setAttribute("lemma",v+P);o.firstChild.firstChild;)f.appendChild(o.firstChild.firstChild);o.firstChild.remove()}f.getAttribute("lemma")===f.textContent&&f.removeAttribute("lemma"),o.parentNode.insertBefore(f,o),o.parentNode.removeChild(o)}}if(n.get("option_insignificant")){let a=r.querySelectorAll('w[insignificant="true"]');for(let o of a)o.parentNode.removeChild(o)}if(n.get("option_binary")){let o=[...L.firsttext().querySelectorAll('w[binary="true"]')].map(f=>f.getAttribute("n"));for(let f of o){let v=r.querySelectorAll(`w[n="${f}"]:not(:empty)`);if(v.length===0)continue;let P=`[${v[0].textContent}]`;for(let z of v)z.textContent=P}}if(n.get("option_noempty")){let a=r.querySelectorAll("w:empty");for(let o of a)o.textContent="[]"}return n.get("option_basetext")?K.makeApp(n,r):r},makeHeader(n,r){let a=n.createElementNS(M,"teiHeader"),o=n.createElementNS(M,"fileDesc"),f=n.createElementNS(M,"sourceDesc"),v=n.createElementNS(M,"listWit");for(let P of L.teis(r)){let z=P.getAttribute("n"),D=n.createElementNS(M,"witness");D.setAttribute("xml:id",z);let V=n.createElementNS(M,"idno");V.setAttribute("type","siglum"),V.append(z),D.appendChild(V),v.appendChild(D)}return f.appendChild(v),o.appendChild(f),a.appendChild(o),a},makeApp(n,r){let a=n.get("option_basetext"),o=L.tei(a,r),f=n.get("option_app_normalize"),v=document.implementation.createDocument(M,"",null);v.appendChild(o);let P=K.makeHeader(v,r);o.insertBefore(P,o.firstChild);let z=L.words(!1,o);for(let D of z){let V=D.getAttribute("n"),J=f&&D.getAttribute("lemma")||D.textContent,oe=[],we=new Map,Le=L.words(V,r);for(let Be of Le){let Te=Be.closest("TEI").getAttribute("n");if(f&&Be.getAttribute("lemma")===J)oe.push(Te);else if(Be.textContent===J)oe.push(Te);else{let ze=Be.textContent===""?"[om.]":Be.textContent,Ue=we.get(ze)||[];Ue.push(Te),we.set(ze,Ue)}}if(we.size===0)for(;D.firstChild;)D.parentElement.insertBefore(D.firstChild,D);else{let Be=v.createElementNS(M,"app");Be.setAttribute("n",V);let Te=v.createElementNS(M,"lem"),ze=oe.map(Ue=>`#${Ue}`).join(" ");for(ze!==""&&Te.setAttribute("wit",ze);D.firstChild;)Te.appendChild(D.firstChild);Be.appendChild(Te);for(let[Ue,Xe]of we){let Ve=v.createElementNS(M,"rdg"),Je=Xe.map(lt=>`#${lt}`).join(" ");Ve.setAttribute("wit",Je),Ve.append(Ue),Be.appendChild(Ve)}D.parentElement.insertBefore(Be,D),Te.textContent.match(/\s$/)&&D.parentElement.insertBefore(v.createTextNode(" "),D)}D.remove()}return v},options(){return document.createRange().createContextualFragment(`<div id="exportoptions" class="popup">
    <form id="exportform">
      <div style="font-weight: bold">Export</div>
      <div>
        <input type="checkbox" id="option_insignificant" name="option_insignificant"><label for="option_insignificant">Remove insignifiant lemmata</label>
      </div>
      <div>
        <input type="checkbox" id="option_binary" name="option_binary"><label for="option_binary">Binarize marked lemmata</label>
      </div>
      <div>
        <input type="checkbox" id="option_noempty" name="option_noempty"><label for="option_noempty">Gaps are significant</label>
      </div>
      <div>
        <input type="checkbox" id="option_mergegroups" name="option_mergegroups"><label for="option_mergegroups">Merge groups</label>
      </div>
      <div>
        <input type="checkbox" id="option_normalize" name="option_normalize"><label for="option_normalize">Normalize spellings</label>
      </div>
      <div>
        <button type="submit">Export</button>
      </div>
    </form>
</div>`)},appOptions(){let n=document.createRange().createContextualFragment(`<div id="exportoptions" class="popup">
    <form id="exportform">
      <div style="font-weight: bold">Export</div>
      <div>
        <label for="option__basetext">Base text</label>
        <select id="option__basetext" name="option_basetext"></select>
      </div>
      <div>
        <input type="checkbox" id="option__app_insignificant" name="option_app_insignificant"><label for="option_app_insignificant">Ignore insignifiant lemmata</label>
      </div>
      <div>
        <input type="checkbox" id="option_mergegroups" name="option_mergegroups" checked><label for="option_mergegroups">Merge groups</label>
      </div>
      <div>
        <input type="checkbox" id="option_app_normalize" name="option_app_normalize" checked><label for="option_app_normalize">Normalized spellings in positive apparatus</label>
      </div>
      <div>
        <input type="checkbox" id="option_normalize" name="option_normalize"><label for="option_normalize">Normalize spellings in negative apparatus</label>
      </div>
      <div>
        <button type="submit">Export</button>
      </div>
    </form>
</div>`),r=n.getElementById("option__basetext"),a=[...L.trs()].map(o=>o.dataset.n);for(let o of a){let f=document.createElement("option");f.value=o,f.append(o),r.appendChild(f)}return n},showOptions:function(n,r){let a=r(),o=document.createElement("div");o.id="blackout",o.appendChild(a),document.body.appendChild(o);let f=function(P){P.preventDefault();var z=[];let D=document.getElementById("exportform").elements;for(let J of D)J.type==="checkbox"?z.push([J.name,J.checked]):z.push([J.name,J.value]);let V=K.processOptions(new Map(z));n(V),document.body.removeChild(o)};return o.querySelector("button").addEventListener("click",f),o.addEventListener("click",K.blackoutClick),o},blackoutClick:function(n){if(!n.target.closest(".popup")){let a=document.querySelector("#blackout");a.parentNode.removeChild(a)}}},ie={selectAll(n){let r=document.createRange();r.selectNodeContents(n);let a=window.getSelection();a.removeAllRanges(),a.addRange(r)},deselect(){let n=window.getSelection();n.removeAllRanges?n.removeAllRanges():n.empty&&n.empty()},treeMouseover(n){let r=n.target.classList.contains("tree-lemma")?n.target:n.target.closest(".tree-lemma");r&&(Ce.highlightTreeLemma(r.dataset.id),r.addEventListener("mouseout",Ce.unhighlightTrees));let a=n.target.dataset.reconstructed;if(!a)return;let o=document.createElement("div");o.id="tooltip",o.style.top=n.pageY+"px",o.style.left=n.pageX+"px",o.style.opacity=0,o.style.transition="opacity 0.2s ease-in",l.parentElement.appendChild(o);let f=document.createElement("div");if(f.appendChild(document.createTextNode(a)),this.script!==0?o.appendChild(be(f,ee[this.script])):o.appendChild(f),n.target.classList.contains("reconstructed")){let v=n.target.parentNode.querySelector("span.tree-lemma");if(v&&v.dataset.hasOwnProperty("emended")){let P=document.createElement("div");P.classList.add("emphasis"),P.appendChild(document.createTextNode(v.textContent)),this.script!==0?o.prepend(be(P,ee[this.script])):o.prepend(P)}}window.getComputedStyle(o).opacity,o.style.opacity=1,n.target.addEventListener("mouseout",Ee)},treeClick(n){n.target.classList.contains("witness")?Z.text(n.target.dataset.key):n.target.classList.contains("reconstructed")?Z.text(n.target.dataset.label):n.target.classList.contains("internal")&&E.startReconstruction(n),Ee()},keyDown(n){if(!T&&n.key.substring(0,5)==="Arrow")ie.cycleVariant(n);else if(n.ctrlKey||n.metaKey)n.key==="Z"?E.redo():n.key==="z"&&E.undo();else if(!T&&I&&!I.closed&n.key==="Enter"){let r=L.highlitcell();r&&(n.preventDefault(),E.startEditCell(r))}},cycleVariant(n){let r=L.highlitcell()||l.querySelector("td.highlit")||l.querySelector('td[data-n="0"]');switch(n.key){case"ArrowRight":{if(!I.closed&&r){let a=r.nextElementSibling;a&&ie.textClick({target:a})}else{let a=l.querySelector(".highlit"),o=a?a.dataset.n:0,f=parseInt(o)+1;for(;f<=x;){let v=l.querySelectorAll('[data-n="'+f+'"]');for(let P of v)if(P&&!P.classList.contains("invisible")){ie.textClick({target:P});return}f++}}break}case"ArrowLeft":{if(!I.closed&&r){let a=r.previousElementSibling;a&&ie.textClick({target:a})}else{let a=l.querySelector(".highlit"),o=a?a.dataset.n:0,f=parseInt(o)-1;for(;f>=0;){let v=l.querySelectorAll('[data-n="'+f+'"]');for(let P of v)if(P&&!P.classList.contains("invisible")){ie.textClick({target:P});return}if(f--,r){ie.textClick({target:r.previousElementSibling});return}}}break}case"ArrowUp":{if(I.closed||!r)return;let o=r.closest("tr").previousElementSibling;if(!o||!o.dataset.n)return;let f=o.querySelector(`td[data-n="${r.dataset.n}"]`);ie.textClick({target:f});break}case"ArrowDown":{if(I.closed||!r)return;let o=r.closest("tr").nextElementSibling;if(!o||o.tagName!=="TR")return;let f=o.querySelector(`td[data-n="${r.dataset.n}"]`);ie.textClick({target:f})}}},textClick(n,r=!1){if(n.target.closest("tr.header")){ie.matrixHeaderClick(n);return}let a=n.target.classList.contains("lemma")?n.target:n.target.closest(".lemma");if(a){if(!r&&n.ctrlKey){ie.rightClick(n);return}let o=a.dataset.n,f=L.highlitrow();if(Ce.unHighlightAll(),Ce.highlightLemma(o),Ce.repopulateTrees(o),Pe.xScroll(o,f),a.tagName==="TD")a.classList.add("highlitcell");else{let v=a.closest(".text-box");if(v){let P=v.dataset.id;L.tr(P).querySelector(`td[data-n="${o}"]`).classList.add("highlitcell")}}}},textMouseup(){let n=se();ue(n),Me()},menuMouseover(n){let r=n.target.classList.contains("menubox")?n.target:n.target.closest(".menubox");if(r){let a=r.querySelector("ul");a&&(a.style.display="block"),r.classList.add("open")}},menuMouseout(n){let r=n.target.classList.contains("menubox")?n.target:n.target.closest(".menubox");if(r){let a=r.querySelector("ul");a&&(a.style.display="none"),r.classList.remove("open")}},menuClick(n){!n.target.parentElement||(n.target.parentElement.className==="ms"&&(ie.menuMouseout(n),Z.text(n.target.dataset.name)),n.target.parentElement.className==="tree"&&(ie.menuMouseout(n),n.target.closest("li[data-name]")&&Z.tree(n.target.dataset.stemmaid,n.target.dataset.treeid)))},thDragStart(n){n.dataTransfer.setData("text/plain",n.target.textContent),E.startMoveRow(n.target.parentNode,n)},trDragEnter(n){let r=n.target.nodeType===1?n.target.closest("tr"):n.target.parentElement.closest("tr");r&&r.classList.add("dragenter")},trDragLeave(n){let r=n.target.nodeType===1?n.target.closest("tr"):n.target.parentElement.closest("tr");r&&r.classList.remove("dragenter")},trDragDrop(n){n.preventDefault(),E.finishMoveRow(n)},matrixMousedown(n){if(n.button!==0)return;if(n.ctrlKey){ie.rightClick(n);return}let r=n.target.nodeType===1?n.target.closest(".lemma"):n.target.parentElement.closest(".lemma");if(r){if(r.isContentEditable)return;Ce.unHighlightAll(),Ce.highlightLemma(r.dataset.n);let a=I.boxdiv.querySelector("table");a.addEventListener("mouseover",ie.matrixMouseover),a.addEventListener("mouseup",ie.matrixMouseup)}},matrixMouseup(){let n=L.highlit();ue(n);let r=I.boxdiv.querySelector("table");r.removeEventListener("mouseover",ie.matrixMouseover),r.removeEventListener("mouseup",ie.matrixMouseup)},matrixMouseover(n){let r=n.target.nodeType===1?n.target.closest(".lemma"):n.target.parentElement.closest(".lemma");r&&Ce.highlightLemma(r.dataset.n)},matrixHeaderClick(n){if(n.target.tagName!=="INPUT")return;let r=n.target.className;if(r!=="insignificant"&&r!=="binary")return;let a=n.target.closest("th").dataset.ref,o=L.firsttd(a).dataset[r]!=="true",f=new Map([[a,o]]);E.doMarkAs(r,f)},rightClick(n){let r=n.target.nodeType===1?n.target.closest("tr[data-n] th"):n.target.parentElement.closest("tr[data-n] th");if(r){n.preventDefault(),$e.remove();let o=$e.create(n),f=[{text:"move row",func:E.startMoveRow.bind(null,r.parentNode)},{text:"delete row",func:E.doDeleteRow.bind(null,r.parentNode.dataset.n)}];$e.populate(o,f),$e.show(o);return}let a=n.target.nodeType===1?n.target.closest("td.lemma"):n.target.parentElement.closest("td.lemma");if(a){n.preventDefault();let o=a.classList.contains("highlit")?function(){let P=L.highlit();return P.size===1&&!a.classList.contains("highlitcell")&&(Ce.unCelllightAll(),a.classList.add("highlitcell")),P}():(ie.textClick(n,!0),new Set([a.dataset.n])),f=o.size>1?[{text:"merge columns",func:E.startMerge.bind(null,o)},{text:"ungroup columns",alt:"group columns",toggle:Ae.grouped,func:E.startGroup.bind(null,!1)},{text:"delete columns",func:E.startRemoveCol.bind(null,o)}]:[{text:"edit cell",func:E.startEditCell.bind(null,a)},{text:"delete column",func:E.startRemoveCol.bind(null,o)},{text:"insert column",func:E.startInsertCol}];$e.remove();let v=$e.create(n);$e.populate(v,f),$e.show(v)}}},E={undo:function(){let n=U.pop();n&&n[0](...n[1])},redo:function(){let n=F.pop();n&&n[0](...n[1])},doStack:function(n,r="do"){r==="undo"?(n[1].push("redo"),F.push(n)):r==="redo"?(n[1].push("undo"),U.push(n)):(n[1].push("undo"),U.push(n),F=[])},doMulti:function(n,r){let a=[];for(let o of n){let f=o[0](...o[1],"multido");a.unshift(f)}E.doStack([E.doMulti,[a]],r)},startMoveRow:function(n,r){if(Y=n,Y.classList.add("dragging"),r.type!=="dragstart"){for(let a of L.trs())a.classList.add("moveinprogress");I.boxdiv.querySelector("table").addEventListener("mousedown",E.finishMoveRow)}},startMerge:function(n){let r=n===!1?L.highlit():n,a=L.clauses(r,!0);if(!a)E.doMerge(r,"do");else if(a[0]===null){let o=a.filter(f=>f!==null).map(f=>[E.doUngroup,[f]]).concat([[E.doMerge,[r]]]);E.doMulti(o,"do")}else{let o=L.clausesToRemove(a,r);if(!o)E.doMerge(r,"do");else{let f=o.map(v=>[E.doUngroup,[v]]).concat([[E.doMerge,[r]]]);E.doMulti(f,"do")}}},startGroup:function(n){let r=n===!1?L.highlit():n;Ae.grouped()?E.startUngroup(r):E.doGroup(r,"do")},startUngroup:function(n){let a=[...L.clauses(n)].map(o=>[E.doUngroup,[o]]);E.doMulti(a,"do")},startInsertCol:function(){let n=Math.max([...L.highlit()])||x;E.doInsertCol(n)},startRemoveCol:function(n){let r=n===!1?L.highlit():n,a=L.clauses(r);if(!a)E.doRemoveCol(r,"do");else{let o=L.clausesToRemove(a,r,1);if(!o)E.doRemoveCol(r,"do");else{let f=o.map(v=>[E.doUngroup,[v]]).concat([[E.doRemoveCol,[r]]]);E.doMulti(f,"do")}}},startRemoveEmpty:function(){let n=L.empty(),r=L.clauses(n);if(!r)E.doRemoveCol(n,"do");else{let a=L.clausesToRemove(r,n,1);if(!a)E.doRemoveCol(n,"do");else{let o=a.map(f=>[E.doUngroup,[f]]).concat([[E.doRemoveCol,[n]]]);E.doMulti(o,"do")}}},startEditCell:function(n){let r=n||L.highlitcell();!r||(E.unnormalize(r),r.dataset.oldContent=r.textContent,r.contentEditable="true",r.focus(),T=!0,ie.selectAll(r),r.addEventListener("blur",E.finishEditCell),r.addEventListener("keydown",E.cellKeyDown))},cellKeyDown:function(n){switch(n.key){case"Enter":E.finishEditCell(n);break;case"Escape":E.finishEditCell(n,!0);break;case"ArrowRight":{let r=L.cursorPos(n.target);r[0]===r[1]&&(n.preventDefault(),E.finishEditCell(n),ie.cycleVariant({key:"ArrowRight"}),E.startEditCell(L.highlitcell()));break}case"ArrowLeft":{L.cursorPos(n.target)[0]===0&&(n.preventDefault(),E.finishEditCell(n),ie.cycleVariant({key:"ArrowLeft"}),E.startEditCell(L.highlitcell()));break}}},startMarkAs:function(n,r,a){let o=a.target.tagName==="INPUT"?a.target:a.target.querySelector("input"),f=r===!1?L.highlit():r,v=new Map([...f].map(P=>[P,!o.checked]));E.doMarkAs(n,v)},startNewRow:function(){let n=He.row("new row"),r=n.querySelector("th");r.contentEditable=!0,r.addEventListener("blur",E.finishNewRow),r.addEventListener("keydown",E.thKeyDown),I.boxdiv.querySelector("tbody").appendChild(n),r.scrollIntoView(),r.focus(),document.execCommand("selectAll",!1,null),T=!0},startRenameRow:function(){},startReconstruction:function(n){let r=n.target.dataset.key,a=n.target.closest(".tree-box").myTree,o=a.desc,f=document.createElement("div");f.id="blackout";let v=document.createRange().createContextualFragment(`<div id="reconstructionoptions" class="popup">
    <form id="reconstructionform">
      <div>
        <label for="reconstructed_node_name">Label for node:</label>
        <input type="text" id="reconstructed_node_name" name="reconstructed_node_name" placeholder="${o}-${r}" size="15">
      </div>
      <div style="width: 100%; display: flex; justify-content: center;padding-top: 1em;">
        <button type="submit">Add to matrix</button>
      </div>
    </form>
</div>`);f.appendChild(v),document.body.appendChild(f);let P=function(D){D.preventDefault();let V=f.querySelector("input"),J=V.value?V.value:V.placeholder;E.doReconstruction(a,r,J),document.body.removeChild(f)};f.querySelector("button").addEventListener("click",P),f.addEventListener("click",K.blackoutClick)},thKeyDown:function(n){n.key==="Enter"&&E.finishNewRow(n)},finishNewRow:function(n){let r=n.target,a=r.textContent;r.closest("tr").dataset.n=a;let o=He.tei(a);C.documentElement.appendChild(o),T=!1,r.contentEditable=!1,r.removeEventListener("blur",E.finishNewRow),r.removeEventListener("keydown",E.thKeyDown),E.doStack([E.doDeleteRow,[a]],"do")},finishEditCell:function(n,r=!1){let a=n.target;T=!1,a.contentEditable="false",a.removeEventListener("blur",E.finishEditCell),a.removeEventListener("keydown",E.cellKeyDown),a.blur(),ie.deselect();let o=a.textContent;if(o===""){let z=a.querySelector("br");z&&z.remove()}if(r||o===a.dataset.oldContent)return;a.hasOwnProperty("IAST")||(a.IAST=a.cloneNode(!0)),a.IAST.textContent=o;let f=parseInt(a.dataset.n),v=a.closest("tr"),P=v.dataset.n;if(E.xmlChangeCell(f,P,o),v.dataset.hasOwnProperty("treename")&&!a.dataset.hasOwnProperty("emended")){let z=E.doEmend(f,P,"multido"),D=[];D.push([E.doChangeCell,[f,P,a.dataset.oldContent]]),D.push(z),E.doStack([E.doMulti,[D]],"do")}else E.doStack([E.doChangeCell,[f,P,a.dataset.oldContent]],"do");delete a.dataset.oldContent,E.refresh(),Pe.updateAllHeaders(!0),a.classList.add("highlitcell")},finishMoveRow:function(n){let r=n.target.nodeType===1?n.target.closest("tr"):n.target.parentElement.closest("tr");if(r&&E.doMoveRow(Y,r,"do"),n.type!=="drop"){for(let a of L.trs())a.classList.remove("moveinprogress");I.boxdiv.querySelector("table").removeEventListener("mousedown",E.finishMoveRow)}else for(let a of L.trs())a.classList.remove("dragenter");Y.classList.remove("dragging"),Y=null},doReconstruction:function(n,r,a){let o=He.row(a,"pending");o.dataset.treename=n.name,o.dataset.nodename=r;let f=o.querySelector("th"),v=document.createElement("div");v.id="spinner",f.prepend(v);let P=He.tei(a);P.setAttribute("type","reconstructed"),P.setAttribute("corresp",n.name),P.setAttribute("select",`#${r}`);let z=[...L.tds(!1,o)],D=[...L.words(!1,P)];I.boxdiv.querySelector("tbody").appendChild(o),f.scrollIntoView();let V=new Blob(["("+Ke.fitch.toString()+")()"],{type:"application/javascript"}),J=new Worker(window.URL.createObjectURL(V)),oe=L.serializedtexts(n.nexml),we=L.serializedlevels(n.levels);J.postMessage({readings:oe,levels:we,num:0,id:r}),J.onmessage=function(Le){let Be=Le.data.n,Te=Le.data.result;if(z[Be].textContent=Te,z[Be].IAST=z[Be].cloneNode(!0),z[Be].classList.remove("pending"),D[Be].textContent=Te,Be<x)J.postMessage({readings:oe,levels:we,num:Be+1,id:r});else{f.removeChild(v),C.documentElement.appendChild(P),Pe.updateAllHeaders(),n.draw();let ze=L.highlit();ze.size>0&&Ce.repopulateTrees(...L.lowhigh(ze));let Ue=document.getElementById("menu").querySelector(".ms"),Xe=document.createElement("li");Xe.setAttribute("data-name",a),Xe.appendChild(document.createTextNode(a)),Ue.appendChild(Xe),E.doStack([E.doDeleteRow,[a]],"do")}}},doDeleteRow:function(n,r="do"){let a=L.tr(n),o=L.tei(n),v=[...L.teis()].indexOf(o);a.parentNode.removeChild(a),o.parentNode.removeChild(o),Pe.updateAllHeaders(),ne(),Re(),E.doStack([E.doUndeleteRow,[a,o,v]],r)},doUndeleteRow:function(n,r,a,o="do"){let f=r.getAttribute("n"),v=[...L.teis()];if(a===v.length)C.documentElement.appendChild(r),I.boxdiv.querySelector("tbody").appendChild(n);else{let P=[...L.trs()];C.documentElement.insertBefore(r,v[a]),P[a].parentNode.insertBefore(n,P[a])}Pe.updateAllHeaders(),ne(),Re(),E.doStack([E.doDeleteRow,[f]],o)},doMoveRow:function(n,r,a="do"){let o=n.parentNode,f=[...L.trs()],v=n.previousElementSibling,P=f.indexOf(n),z=r!==null?f.indexOf(r):null,D=function(){r===null?o.insertBefore(n,o.firstChild):r.nextElementSibling?o.insertBefore(n,r.nextElementSibling):o.appendChild(n)},V=function(){let J=C.documentElement,oe=[...L.teis()],we=oe[P];if(z===null)J.insertBefore(we,oe[0]);else{let Le=oe[z];Le.nextElementSibling?J.insertBefore(we,Le.nextElementSibling):J.appendChild(we)}};if(D(),V(),a==="multido")return[E.doMoveRow,[n,v]];E.doStack([E.doMoveRow,[n,v]],a)},doMerge:function(n,r="do"){let a=function(P,z,D){let V=P();var J=[];for(let oe of V){let we=[...D].map(Te=>z(Te,oe)),Le=we.map(Te=>Te.cloneNode(!0));J.push(Le);for(let Te of we)E.unnormalize(Te);let Be=we.reduce(function(Te,ze){if(ze.hasChildNodes())for(;ze.firstChild;)Te.appendChild(ze.firstChild);return ze.parentNode.removeChild(ze),Te});Be.normalize(),Be.dataset?(delete Be.dataset.normal,Be.IAST=Be.cloneNode(!0)):Be.removeAttribute("lemma")}return[P,z,J]},o=a(L.trs,L.firsttd,n),f=a(L.texts,L.firstword,n),v=parseInt([...n][0]);if(E.renumber(v),E.restyleGroups(n),E.refresh(),Pe.updateAllHeaders(),r==="multido")return[E.doUnmerge,[o,f]];E.doStack([E.doUnmerge,[o,f]],r)},doUnmerge:function(n,r,a="undo"){let o=function(z,D,V){let J=L.whichattr(V[0][0]),oe=V[0].map(Te=>Te.getAttribute(J)),we=oe[0],Le=z();for(var Be=0;Be<Le.length;Be++){let Te=V[Be].pop(),ze=D(we,Le[Be]);ze.parentNode.replaceChild(Te,ze);for(let Ue of V[Be])Te.parentNode.insertBefore(Ue,Te)}return oe};o(...n);let f=o(...r),P=[...f].sort((z,D)=>parseInt(z)-parseInt(D))[0];if(E.renumber(P),E.reIAST(f),E.refresh(),E.restyleGroups(f),Pe.updateAllHeaders(),a==="multido")return[E.doMerge,[f]];E.doStack([E.doMerge,[f]],a)},doGroup:function(n,r="do"){let a=[...n],o=a.shift(),f=L.texts();for(let P of f){let z=document.createElementNS("http://www.tei-c.org/ns/1.0","cl"),D=L.firstword(o,P);D.parentNode.insertBefore(z,D),z.appendChild(D);for(let V of n)z.appendChild(L.firstword(V,P))}let v=a.pop();for(let P of L.tds(o))P.classList.add("group-start");for(let P of L.tds(v))P.classList.add("group-end");for(let P of a)for(let z of L.tds(P))z.classList.add("group-internal");for(let P of $)P.refresh();if(r==="multido")return[E.doUngroup,[n]];E.doStack([E.doUngroup,[n]],r)},doUngroup:function(n,r="do"){let a=L.texts();for(let f of a){let v;for(let P of n){let z=L.firstword(P,f);v||(v=z.closest("cl")),v.parentNode.insertBefore(z,v)}v.parentNode.removeChild(v)}let o=[...n].map(f=>[...L.tds(f)]).reduce((f,v)=>f.concat(v),[]);for(let f of o)f.classList.remove("group-start","group-internal","group-end");for(let f of $)f.refresh();if(r==="multido")return[E.doGroup,[n]];E.doStack([E.doGroup,[n]],r)},doGroupWords:function(){let n=0,r=[];for(let a=0;a<=x;a++){let o=L.tds(a),f=o[0].classList;if(f.contains("group-start")||f.contains("group-internal")||f.contains("group-end")){n=a+1;continue}let v=o.length,P=0;if(a===x)P=v;else for(let z of o)(z.IAST?z.IAST.textContent:z.textContent).slice(-1)===" "&&P++;if(P/v>=.5)if(n===a){n++;continue}else{let z=L.range(n,a);r.push([E.doGroup,[z]]),n=a+1}}E.doMulti(r)},doRemoveCol:function(n,r="do"){let a=function(z,D,V){let J=z();var oe=[];for(let we of J){let Le=[...V].map(Te=>{let ze=D(Te,we);return E.unnormalize(ze),ze}),Be=Le.map(Te=>Te.cloneNode(!0));oe.push(Be);for(let Te of Le)Te.parentNode.removeChild(Te)}return[z,D,oe]},o=a(L.trs,L.firsttd,n),f=a(L.texts,L.firstword,n),v=[...n].sort((z,D)=>parseInt(z)-parseInt(D)),P=parseInt([...v][0])-1;if(E.renumber(P),E.refresh(),E.restyleGroups(n,!0),Pe.updateAllHeaders(),r==="multido")return[E.doUnremoveCol,[o,f]];E.doStack([E.doUnremoveCol,[o,f]],r)},doUnremoveCol:function(n,r,a){let o=function(D,V,J){let oe=L.whichattr(J[0][0]),we=J[0].map(ze=>ze.getAttribute(oe)),Le=we[0],Be=D();for(var Te=0;Te<Be.length;Te++){let ze=V(Le,Be[Te]);for(let Ue of J[Te])ze.parentNode.insertBefore(Ue,ze)}return we};o(...n);let f=o(...r),v=[...f].sort((D,V)=>parseInt(D)-parseInt(V)),P=parseInt(v[0])-1;E.renumber(P);let z=document.querySelectorAll(".highlitcell");for(let D of z)D.classList.remove("highlitcell");if(E.reIAST(f),E.refresh(),E.restyleGroups(f,!0),Pe.updateAllHeaders(),a==="multido")return[E.doRemoveCol,[f]];E.doStack([E.doRemoveCol,[f]],a)},doInsertCol:function(n,r="do"){let a=function(f,v,P,z){let D=f();for(let V of D){let J=v(z,V),oe=P(z+1);J.insertAdjacentElement("afterend",oe)}};a(L.trs,L.firsttd,He.emptycell,n),a(L.texts,L.firstword,He.emptyword,n),E.renumber(n),E.refresh(),E.restyleGroups([n,n+1],!0),Pe.updateAllHeaders();let o=[n+1];if(r==="multido")return[E.doRemoveCol,[o]];E.doStack([E.doRemoveCol,[o]],r)},doEmend:function(n,r,a="do"){let o=[...L.trs()][r],f=L.firsttd(n,o);f.dataset.emended=!0;let v=L.tei(r).querySelector("text");if(L.firstword(n,v).setAttribute("emended","true"),a==="multido")return[E.doUnemend,[n,r]];E.doStack([E.doUnemend,[n,r]],a)},doUnemend:function(n,r,a="do"){let o=[...L.trs()][r],f=L.firsttd(n,o);delete f.dataset.emended;let v=L.tei(r).querySelector("text");if(L.firstword(n,v).removeAttribute("emended"),a==="multido")return[E.doEmend,[n,r]];E.doStack([E.doEmend,[n,r]],a)},doChangeCell:function(n,r,a,o="do"){let f=E.xmlChangeCell(n,r,a),v=E.htmlChangeCell(n,r,a);if(E.refresh(),Pe.updateAllHeaders(!0),ie.textClick({target:v}),o==="multido")return[E.doChangeCell,[n,r,f]];E.doStack([E.doChangeCell,[n,r,f]],o)},htmlChangeCell:function(n,r,a){let o=L.tr(r),f=L.firsttd(n,o);return E.unnormalize(f),f.textContent=a,f.IAST&&(f.IAST=f.cloneNode(!0)),f},xmlChangeCell:function(n,r,a){let o=L.tei(r).querySelector("text"),f=L.firstword(n,o);E.unnormalize(f);let v=f.textContent;return f.childNodes.length===0?f.appendChild(document.createTextNode(a)):f.textContent=a,v},doMarkAs:function(n,r,a="do"){let o=[...r.keys()],f=L.attr(n,o);for(let v of o){let P=L.tds(v),z=L.words(v);if(r.get(v)===!0){for(let V of P)V.dataset[n]="true";for(let V of z)V.setAttribute(n,"true")}else{for(let V of P)delete V.dataset[n];for(let V of z)V.removeAttribute(n)}let D=L.checkbox(v,n);D.checked=r.get(v)}if(a==="multido")return[E.doMarkAs,[n,f]];E.doStack([E.doMarkAs,[n,f]],a)},refresh:function(){for(let n of $)n.refresh();Ce.rehighlight(),Ae.anyhighlit()?Ce.repopulateTrees(...L.lowhigh(L.highlit())):Ce.clearTrees()},renumber:function(n=0){let r=function(a,o,f){let v=a();for(let z of v){let D=[...o(!1,z)],V=L.whichattr(D[0]);for(var P=parseInt(f)+1;P<D.length;P++)D[P].setAttribute(V,P)}};r(L.trs,L.tds,n),r(()=>[!0],L.ths,n),r(L.texts,L.words,n),x=L.maxlemma()},reIAST:function(n){let r=[...n].map(a=>[...L.lemmata(a)]).flat();for(let a of r)a.IAST=a.cloneNode(!0)},restyleGroups:function(n,r=!1){let o=r?function(v){var P=[...v];let z=parseInt(n[0])-1,D=parseInt(n[n.length-1])+1;return P.unshift(z),P.push(D),P}(n):n,f=function(v,P=!1){let z=new Set(["group-start","group-internal","group-end"]);P&&z.delete(P);for(let D of v){for(let V of z)D.classList.remove(V);P&&D.classList.add(P)}};for(let v of o){let P=L.firstword(v),z=L.tds(v);if(z.length===0)continue;let D=P.closest("cl");D?P===D.firstElementChild?f(z,"group-start"):P===D.lastElementChild?f(z,"group-end"):f(z,"group-internal"):f(z)}},startRenormalize:function(n){let r=n===!1?L.highlit():n;E.doRenormalize(Math.min(...r),Math.max(...r))},doRenormalize:function(n,r,a=!1,o="do"){let f=Ae.normalizedView(),v=new Map,P=[...L.trs()],z=[...L.texts()],D=a?[a]:[...P.keys()];for(let V of D){let J=new Map,oe=z[V],we=[...L.words(!1,oe)],Le=L.firstword(n,oe),Be=L.firstword(r,oe),Te=we.indexOf(Le),ze=we.indexOf(Be),Ue=we.slice(Te,ze+1),Xe=P[V],Je=[...L.tds(!1,Xe)].slice(Te,ze+1),lt=Ue.map(st=>st.textContent),rt=bn(lt);for(let st=0;st<rt.length;st++){let it=Ue[st],ct=rt[st],pt=lt[st],dt=Je[st],mt=it.hasAttribute("lemma")?it.getAttribute("lemma"):!1;if(mt!==!1){if(mt===ct)continue;J.set(dt.dataset.n,mt),E.unnormalize(it),E.unnormalize(dt)}else J.set(dt.dataset.n,null);ct!==pt&&(it.setAttribute("lemma",ct),dt.dataset.normal=ct,f&&(dt.textContent=ct))}v.set(V,J)}Pe.updateAllHeaders(!0),Pe.xScrollToHighlit(),E.doStack([E.doUnrenormalize,[v]],o)},doUnrenormalize:function(n,r="undo"){let a=Ae.normalizedView(),o=new Map,f=[...L.trs()],v=[...L.texts()];for(let[P,z]of n.entries()){let D=f[P],V=v[P],J=new Map;for(let[oe,we]of z.entries()){let Le=L.firsttd(oe,D),Be=L.firstword(oe,V),Te=Be.hasAttribute("lemma")?Be.getAttribute("lemma"):null;J.set(oe,Te),we===null?(E.unnormalize(Le),E.unnormalize(Be)):(Le.dataset.normal=we,Be.setAttribute("lemma",we),a&&(Le.textContent=we))}o.set(P,J)}E.doStack([E.doUnrenormalize,[o]],r)},unnormalize:function(n){n.hasOwnProperty("IAST")&&(n.textContent=n.IAST.textContent),n.dataset&&n.dataset.hasOwnProperty("normal")&&delete n.dataset.normal,n.getAttribute("lemma")&&n.removeAttribute("lemma")}},Pe={toggleNormalize:function(){Ae.normalizedView()?Pe.showUnnormalized():Pe.showNormalized()},showNormalized:function(n){if(n)n.updatescript();else{document.getElementById("views").classList.add("normalized");for(let a of $)a.updatescript();I.updatescript(),Ae.anyhighlit()?Ce.repopulateTrees(...L.lowhigh(L.highlit())):Ce.clearTrees()}Pe.updateAllHeaders(!0),Pe.xScrollToHighlit()},showUnnormalized:function(){document.getElementById("views").classList.remove("normalized"),I.updatescript();for(let n of $)n.updatescript();Ae.anyhighlit()?Ce.repopulateTrees(...L.lowhigh(L.highlit())):Ce.clearTrees(),Pe.updateAllHeaders(!0),Pe.xScrollToHighlit()},toggleHeader:function(){let n=I.boxdiv.querySelector("tr.header");n.style.display==="none"?n.style.display="table-row":n.style.display="none"},updateHeaders(n){for(let r of n){let a=L.firstth(r),[o,f]=L.readings(r),v=a.querySelector("span.readings"),P=o<2?o:`${o}(${f.size})`;v.textContent=P}},updateAllHeaders(n=!1){let r=[...L.trs()],a=r.map(z=>L.trWalker(z)),o=[...L.tds(!1,r[0])],f=[...L.ths()],v=I.boxdiv.querySelector("tr.header"),P=function(){let z=document.createElement("th"),D=document.createElement("span");D.classList.add("readings"),z.appendChild(D);let V=document.createElement("form");return V.innerHTML='<div><input class="insignificant" type="checkbox">Insignificant</div><div><input class="binary" type="checkbox">Binary</div>',z.appendChild(V),v.appendChild(z),z};for(let z=0;z<o.length;z++){let D=z>=f.length?P():f[z],V=o[z];D.dataset.ref=V.dataset.n;let J=0,oe=new Set;for(let Le of a){let Be=Le.nextNode().textContent;Be!==""&&(J++,oe.add(Be))}let we=J<2?J:`${J}(${oe.size})`;D.querySelector("span.readings").textContent=we,n||(D.querySelector("input.insignificant").checked=!!V.dataset.insignificant,D.querySelector("input.binary").checked=!!V.dataset.binary)}if(f.length>o.length)for(let z=o.length;z<f.length;z++)v.removeChild(f[z])},xScrollToHighlit:function(){let n=L.highlit();n.size>0&&Pe.xScroll([...n][0])},xScroll:function(n,r){if(!n)return;let a=r||L.firsttr(),o=L.firsttd(n,a),f=o.getBoundingClientRect(),v=I.boxdiv,z=v.getBoundingClientRect().right,D=a.querySelector("th").getBoundingClientRect(),V=D.right,J=f.right>z,oe=f.left+.1<V;J&&o.scrollIntoView({inline:"end",block:"nearest"}),oe&&(o.scrollIntoView({inline:"start",block:"nearest"}),v.scroll({left:v.scrollLeft-D.width}))}},L={basename:function(){return A.split(/\.[^.]+$/)[0]},range:function(n,r){return Array.from(Array(parseInt(r)-parseInt(n)+1).keys(),a=>a+n)},maxlemma:function(){return[...L.firsttext().querySelectorAll("w[n]")].length-1},lemmata:function(n,r){let a=r||document.querySelector("#views");return n===!1?a.querySelectorAll(".lemma"):a.querySelectorAll(`.lemma[data-n="${n}"]`)},tds:function(n,r){let a=r||I.boxdiv;return n===!1?a.querySelectorAll("td[data-n]"):a.querySelectorAll(`td[data-n="${n}"]`)},firsttd:function(n,r){return(r||I.boxdiv).querySelector(`td[data-n="${n}"]`)},tr:function(n){return I.boxdiv.querySelector(`tr[data-n="${n}"]`)},trs:function(n){return(n||I.boxdiv).querySelectorAll("tr[data-n]")},firsttr:function(n){return(n||I.boxdiv).querySelector("tr[data-n]")},lasttr:function(n){return(n||I.boxdiv).querySelector("tr[data-n]:last-of-type")},trWalker:function(n){return document.createNodeIterator(n,NodeFilter.SHOW_ELEMENT,{acceptNode:function(r){if(r.tagName==="TD")return NodeFilter.FILTER_ACCEPT}},!1)},textWalker:function(n){return document.createNodeIterator(n,NodeFilter.SHOW_ELEMENT,{acceptNode:function(r){if(r.tagName.toLowerCase()==="w")return NodeFilter.FILTER_ACCEPT}},!1)},tei:function(n,r=C){return r.querySelector(`TEI[n="${n}"]`)},teis:function(n=C){return n.querySelectorAll("TEI")},texts:function(n){return(n||C).querySelectorAll("text")},serializedtexts:function(n){let r=[...n.querySelectorAll("otu[label]")].map(o=>o.getAttribute("label")),a=[...L.teis()].filter(o=>r.indexOf(o.getAttribute("n"))!==-1);return new Map(a.map(o=>[n.querySelector(`node[label="${o.getAttribute("n")}"]`).getAttribute("id"),[...o.querySelectorAll("w")].map(f=>Ae.normalizedView()&&f.hasAttribute("lemma")?f.getAttribute("lemma"):f.textContent)]))},serializedlevels:function(n){return n.map(r=>{if(r instanceof Map){let a=new Map;for(let[o,f]of r)a.set(o.getAttribute("id"),f.map(v=>v.getAttribute("id")));return a}else return r.map(a=>a.getAttribute("id"))})},firsttext:function(n){return n?C.querySelector(`[n="${n}"] text`):C.querySelector("text")},words:function(n,r){let a=r||C;return n===!1?a.querySelectorAll("w[n]"):a.querySelectorAll(`w[n="${n}"]`)},firstword:function(n,r){return(r||C).querySelector(`w[n="${n}"]`)},normal:function(n){return(n||document.getElementById("views")).querySelectorAll(".lemma[data-normal], .tree-lemma[data-normal]")},htmlreading:function(n){return Ae.normalizedView()&&n.dataset.normal?n.dataset.normal:n.IAST.textContent},xmlreading:function(n,r){let a=C.querySelector(`TEI[n="${n}"] > text > w[n="${r}"]`);return Ae.normalizedView()&&a.hasAttribute("lemma")?a.getAttribute("lemma"):a.textContent},xmlreadings:function(n){return[...C.querySelectorAll(`TEI[n="${n}"] > text > w`)].map(a=>{Ae.normalizedView()&&a.hasAttribute("lemma")?a.getAttribute("lemma"):a.textContent})},ths:function(){return I.boxdiv.querySelectorAll("th[data-ref]")},firstth:function(n){return I.boxdiv.querySelector(`th[data-ref="${n}"]`)},checkbox:function(n,r){return I.boxdiv.querySelector(`th[data-ref="${n}"] input.${r}`)},highlit:function(){let r=L.firsttr().querySelectorAll(".highlit"),a=new Set;for(let o of r)a.add(o.dataset.n);return a},highlitcell:function(){return I.boxdiv.querySelector("td.highlitcell")},highlitrow:function(){let n=L.highlitcell();return n?n.closest("tr"):!1},lowhigh:function(n){let r=[...n].sort((f,v)=>parseInt(f)-parseInt(v)),a=parseInt(r[0]),o=r.length>1?parseInt(r[r.length-1]):void 0;return[a,o]},readings:function(n,r){let a=r||I.boxdiv,o=L.tds(n,a);var f=0;let v=new Set;for(let P of o){let z=P.textContent;z!==""&&(f++,v.add(z))}return[f,v.size]},attr:function(n,r){let a=L.firsttr();var o=[];for(let f of r)L.firsttd(f,a).dataset[n]==="true"?o.push([f,!0]):o.push([f,!1]);return new Map(o)},whichattr:function(n){return n.hasAttribute("n")?"n":n.hasAttribute("data-n")?"data-n":n.hasAttribute("data-ref")?"data-ref":!1},clauses:function(n,r=!1){let a=L.firsttext();var o=!1;let f=new Set;for(let v of n){let z=L.firstword(v,a).closest("cl");z?f.add(z):r&&(o=!0)}if(f.size===0)return!1;{let v=[...f].map(P=>{let z=P.querySelectorAll("w");return new Set([...z].map(D=>D.getAttribute("n")))});return o?[null].concat(v):v}},clausesToRemove:function(n,r,a=0){let o=new Set;for(let f of n){let v=new Set(f);for(let P of r)v.delete(P);v.size<=a&&o.add(f)}return[...o]},empty:function(){let n=new Set,r=[...L.trs()],a=r.map(v=>L.trWalker(v)),o=r[0].querySelector("td:last-of-type").dataset.n;for(let v=0;v<=o;v++){var f=!0;for(let P of a){let z=P.nextNode();f&&z.textContent!==""&&(f=!1)}f&&n.add(v)}return n},prevNonempty:function(n,r){for(let a=n;a>=0;a--)if(r[a].textContent!=="")return a;return!1},nextNonempty:function(n,r){for(let a=n;a<r.length;a++)if(r[a].textContent!=="")return a;return!1},setIntersection:function(...n){let r=n[0];return new Set([...r].filter(a=>{for(let o=1;o<n.length;o++)if(!n[o].has(a))return!1;return!0}))},setUnion:function(...n){return new Set(n.reduce((r,a)=>(r=[...r,...a],r),[]))},cursorPos(n){let r=window.getSelection().getRangeAt(0),a=r.cloneRange();a.selectNodeContents(n);let o=a.toString().length;return a.setEnd(r.endContainer,r.endOffset),[a.toString().length,o]}},Ae={undo:function(){return U.length>0},redo:function(){return F.length>0},checkbox:function(n,r){if(!Ae.anyhighlit())return!1;let a=r===!1?L.highlit():r,o=L.attr(n,a);for(let f of o.values())if(f===!1)return!1;return!0},grouped:function(){let n=L.highlit();if(!n)return!1;let r=L.firsttr();for(let a of n){let o=L.firsttd(a,r);if(o.classList.contains("group-start")||o.classList.contains("group-internal")||o.classList.contains("group-end"))return!0}return!1},oneGrouped:function(){let n=L.highlit();if(n.size===0)return!1;if(n.size===1){let r=L.firsttr(),a=L.firsttd([...n][0],r);return!!(a.classList.contains("group-start")||a.classList.contains("group-end")||a.classList.contains("group-internal"))}return!0},anyhighlit:function(){return!!I.boxdiv.querySelector("td.highlit")},manyhighlit:function(){return L.highlit().size>1},highlitcell:function(){return!!I.boxdiv.querySelector("td.highlitcell")},normalizedView:function(){return document.getElementById("views").classList.contains("normalized")},anyNormalized:function(){return O||I.boxdiv.querySelector(".lemma[data-normal]")},headerView:function(){return I.boxdiv.querySelector("tr.header").style.display!=="none"}},He={tei:function(n){let r=C.createElementNS(M,"TEI");r.setAttribute("n",n);let a=L.firsttext().cloneNode(!0);r.appendChild(a);for(let o of L.words(!1,a))for(o.removeAttribute("lemma");o.firstChild;)o.firstChild.remove();return r},emptycell:function(n){let r=document.createElement("td");return r.className="lemma",r.dataset.n=n,r},emptyword:function(n,r=C){let a=r.createElementNS(M,"w");return a.setAttribute("n",n),a},emptywords:function(n,r,a){let o=r||x,f=a||0;for(let v=f;v<=o;v++){let P=He.emptyword(v);n.appendChild(P)}},row:function(n,r){let a=document.createElement("tr"),o=document.createElement("th");o.scope="row",o.draggable=!0,o.appendChild(document.createTextNode(n)),o.addEventListener("dragstart",ie.thDragStart),a.dataset.n=n,a.appendChild(o);let f=L.firsttr();for(let v of f.querySelectorAll("td")){let P=document.createElement("td");P.dataset.n=v.dataset.n,P.className=v.className,r&&P.classList.add(r),a.appendChild(P)}return a}},$e={create:function(n){let r=document.createElement("div");return r.classList.add("contextmenu"),r.style.left=n.clientX-12+"px",r.style.top=n.clientY-22+"px",r},remove:function(){for(let n of document.querySelectorAll(".contextmenu"))n.parentNode.removeChild(n)},show:function(n){document.body.appendChild(n)},populate:function(n,r){let a=document.createElement("ul");for(let o of r){let f=document.createElement("li");if(o.hasOwnProperty("cond")){let v=document.createRange().createContextualFragment('<form><input type="checkbox"'+(o.cond()?" checked":"")+"></form>");f.appendChild(v)}if(o.hasOwnProperty("toggle")){let v=o.toggle()?o.text:o.alt;f.appendChild(document.createTextNode(v))}else f.appendChild(document.createTextNode(o.text));f.addEventListener("mouseup",o.func),a.appendChild(f)}n.appendChild(a)}};class Ye{constructor(r){this.name=r,this.box=document.createElement("div"),this.box.classList.add("menubox");let a=document.createElement("div");a.classList.add("heading"),a.appendChild(document.createTextNode(r)),this.box.appendChild(a),a.addEventListener("mouseover",this.checkConditions.bind(this)),this.box.addEventListener("mouseup",this.click.bind(this)),this.items=new Map,this.conditions=new Map}populate(r){let a=this.box.querySelector("ul")||function(o){let f=document.createElement("ul");return o.box.appendChild(f),f}(this);for(let o of r){let f=document.createElement("li");if(o.hasOwnProperty("checkbox")){let v=document.createElement("form"),P=document.createElement("input");P.type="checkbox",P.addEventListener("click",z=>z.preventDefault()),v.appendChild(P),f.appendChild(v),f.appendChild(document.createTextNode(o.text)),this.conditions.set(P,o.checkbox)}else if(o.hasOwnProperty("toggle")){let v=document.createElement("span");v.appendChild(document.createTextNode(o.text)),v.dataset.text=o.text,v.dataset.alt=o.alt,this.conditions.set(v,o.toggle),f.appendChild(v)}else f.appendChild(document.createTextNode(o.text));o.hasOwnProperty("greyout")&&this.conditions.set(f,o.greyout),this.items.set(f,o.func),a.appendChild(f)}}click(r){let a=r.target.tagName==="LI"?r.target:r.target.closest("li");if(a&&!a.classList.contains("greyedout")){let o=this.items.get(a);o&&(o(r),this.checkConditions())}}checkConditions(){let r=new Map;for(let[a,o]of this.conditions){let f=r.get(o)||function(){let v=o();return r.set(o,v),v}();a.tagName==="INPUT"?a.checked=f:a.tagName==="SPAN"?f?a.textContent=a.dataset.alt:a.textContent=a.dataset.text:a.tagName==="LI"&&(f?a.classList.remove("greyedout"):a.classList.add("greyedout"))}}}class Fe{constructor(r){this.name=r,this.script=0}show(){d.appendChild(this.descbox),Ae.normalizedView()&&Pe.showNormalized(this),l.appendChild(this.boxdiv),this.closed=!1}clear(){for(;this.boxdiv.firstChild;)this.boxdiv.removeChild(this.boxdiv.firstChild);this.svgcontainer&&(this.clearsvg(),this.boxdiv.appendChild(this.svgcontainer))}destroy(){l.removeChild(this.boxdiv),d.removeChild(this.descbox);let r=X.indexOf(this);r>-1&&X.splice(r,1);let a=$.indexOf(this);a>-1&&$.splice(a,1),this.closed=!0,this.name==="Matrix"&&(document.getElementById("matrixmenu").style.display="block"),Re(),Ce.rehighlight()}pullout(){this.destroy();let r="menubar=no,location=no,status=no,height=620,width=620,scrollbars=yes,centerscreen=yes",a=window.mainWindow?window.mainWindow.comboView.getWindows().length:B.length,o=window.open("slave.html","slave"+a,r);o.mainWindow=window.mainWindow?window.mainWindow:window,o.startbox=this.text?{text:{name:this.name}}:{tree:this.name},o.mainWindow.comboView.addWindow(o)}makeDescBox(){let r=document.createElement("div"),a=document.createElement("div");a.classList.add("closer"),a.innerHTML="x",a.title="close";let o=document.createElement("div");o.classList.add("scripter"),o.innerHTML="A",o.title="change script",r.appendChild(a),r.appendChild(o),r.appendChild(document.createTextNode(this.desc)),this.descbox=r,a.addEventListener("click",this.destroy.bind(this)),o.addEventListener("click",this.cyclescript.bind(this))}cyclescript(){this.script=this.script+1,this.script===ee.length&&(this.script=0);let r=this.descbox.querySelector(".scripter");this.script===0?r.innerHTML="A":r.innerHTML=me[ee[this.script]]("a"),ee[this.script]==="grantha"?r.classList.add("grantha"):r.classList.remove("grantha"),this.updatescript()}updatescript(){let r=this.boxdiv.querySelectorAll(".lemma,.tree-lemma");for(let a of r){let o=a.dataset.hasOwnProperty("normal");if(!o&&a.textContent.trim()==="")continue;let f=function(){if(Ae.normalizedView()&&o){let P=document.createElement("span");return P.appendChild(document.createTextNode(a.dataset.normal)),P}else return a.IAST.cloneNode(!0)}(),v=this.script===0?f:be(f,ee[this.script]);for(a.innerHTML="";v.firstChild;)a.appendChild(v.firstChild)}ee[this.script]==="grantha"?this.boxdiv.classList.add("grantha"):this.boxdiv.classList.remove("grantha"),this.boxdiv.classList.contains("matrix")&&Pe.xScrollToHighlit()}}class et extends Fe{constructor(r,a){super(`#${r} #${a}`);this.stemmaid=r,this.id=a,this.nexml=G.get(this.name).cloneNode(!0),this.desc=this.nexml.querySelector("tree").getAttribute("label")}init(){this.makeDescBox();let r=document.createElement("div");r.classList.add("tree-box");var a,o=0;do a="tree"+o,o++;while(document.getElementById(a));r.id=a,this.boxdiv=r,this.boxdiv.addEventListener("mouseover",ie.treeMouseover.bind(this)),this.boxdiv.addEventListener("click",ie.treeClick),this.svgcontainer=document.createElement("div"),this.svgcontainer.id=this.boxdiv.id+"container",this.boxdiv.appendChild(this.svgcontainer),this.boxdiv.myTree=this,this.calcPaths(),this.jiggleroot(),this.findLevels(),this.labelInternal()}show(){d.appendChild(this.descbox),l.appendChild(this.boxdiv)}jiggleroot(){let r=this.nexml.evaluate('//nex:node[@root="true"]',this.nexml,this.nsResolver,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue,a=this.nexml.evaluate('//nex:edge[@source="'+r.id+'"]|//nex:edge[@target="'+r.id+'"]',this.nexml,this.nsResolver,XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE,null);if(a.snapshotLength===3){var o,f;for(let v=0;v<a.snapshotLength;v++){let P=a.snapshotItem(v),z=P.getAttribute("source"),D=P.getAttribute("target"),V=this.nexml.evaluate('//nex:node[@id="'+z+'"]',this.nexml,this.nsResolver,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue,J=this.nexml.evaluate('//nex:node[@id="'+D+'"]',this.nexml,this.nsResolver,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue;if(!V.hasAttribute("otu")&&!J.hasAttribute("otu")){o=P,f=D===r.id?"target":"source";break}}if(o){let v=this.nexml.createElementNS(r.namespaceURI,"node");v.id="fakeroot",v.setAttribute("root","true"),r.removeAttribute("root"),r.parentElement.insertBefore(v,r);let P=this.nexml.createElementNS(r.namespaceURI,"edge");P.id="newrootedge",P.setAttribute("length","0"),P.setAttribute("source","fakeroot"),P.setAttribute("target",r.id),r.parentElement.insertBefore(P,o),o.setAttribute(f,v.id)}}}findLevels(){let r=this.nexml.querySelectorAll("edge"),a=[...this.nexml.querySelectorAll("node[otu]")],o=this.nexml;this.levels=[a];let f=function(z,D){let V=z.map(ze=>ze.id),J=new Map,oe=new Map,we=[];for(let ze of D){let Ue=ze.getAttribute("target"),Xe=ze.getAttribute("source"),Ve=(()=>V.indexOf(Ue)!==-1?{ancestor:o.getElementById(Xe),child:o.getElementById(Ue)}:V.indexOf(Xe)!==-1?{ancestor:o.getElementById(Ue),child:o.getElementById(Xe)}:null)();if(Ve!==null)if(oe.has(Ve.ancestor)){let Je=oe.get(Ve.ancestor);J.set(Ve.ancestor,[Je.child,Ve.child]),we.push(ze),we.push(Je.edge)}else oe.set(Ve.ancestor,{child:Ve.child,edge:ze})}let Le=[...J.keys()],Be=[...oe.keys()].reduce((ze,Ue)=>(Le.indexOf(Ue)===-1&&ze.push(oe.get(Ue).child),ze),[]),Te=[...D].reduce((ze,Ue)=>(we.indexOf(Ue)===-1&&ze.push(Ue),ze),[]);return{match:J,remainder:[...new Set(Be)],edges:Te}};var v=a,P=r;do{let z=f(v,P);this.levels.push(z.match),v=[...z.match.keys(),...z.remainder],P=z.edges}while(P.length>0)}labelInternal(){for(let r of this.nexml.querySelectorAll("node:not([label])"))r.setAttribute("label",r.id)}fitch1(){let r=new Map;for(let a of this.levels[0]){let o=a.getAttribute("label"),f=this.boxdiv.querySelector(`span.tree-lemma[data-id="${o}"]`),v=f?[L.htmlreading(f)]:[];r.set(a,new Set(v))}for(let a=1;a<this.levels.length;a++)for(let[o,f]of this.levels[a]){let v=f.map(D=>r.get(D)),P=L.setIntersection(...v),z=P.size>0?P:L.setUnion(...v);r.set(o,z)}return r}fitch2(r){let a=[...this.nexml.querySelectorAll("node[otu]")],o=new Map;for(let[f]of this.levels[this.levels.length-1])o.set(f,r.get(f));for(let f=this.levels.length-1;f>1;f--)for(let[v,P]of this.levels[f]){let z=o.get(v);for(let D of P){if(a.indexOf(D)!==-1)continue;let V=r.get(D);if(V.size===1)o.set(D,V);else{let J=L.setIntersection(z,V),oe=J.size>0?J:V;o.set(D,oe)}}}return o}fitch(){let r=this.fitch1(),a=function(f){let v=[...f].map(P=>P.trim()===""?"_":P);return v.length===1?v[0]:"{"+v.join(", ")+"}"},o=this.fitch2(r);for(let[f,v]of o){let P=this.boxdiv.querySelector(`span.internal[data-key="${f.id}"]`);P.dataset.reconstructed=a(v)}}clearsvg(){for(;this.svgcontainer.firstChild;)this.svgcontainer.removeChild(this.svgcontainer.firstChild)}removecolors(){let r=this.nexml.querySelectorAll("node[color]");for(let a=0;a<r.snapshotLength;a++)r.snapshotItem(a).removeAttribute("color")}drawlines(r,a){if(this.removecolors(),r){let z=this.getPath(...r.split(";")).path,D=new Set;for(let V of z)D.add(V.getAttribute("target")),D.add(V.getAttribute("source"));for(let V of D){let J=this.nexml.evaluate('//nex:node[@id="'+V+'"]',this.nexml,this.nsResolver,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue;J.getAttribute("root")||J.setAttribute("color",a)}}let o=parseInt(window.getComputedStyle(this.svgcontainer,null).width)-15,f=parseInt(window.getComputedStyle(this.boxdiv,null).height)-10,v=function(){return f<600?600:f}();R.PhyloCanvas.Render.Style.line.stroke="rgb(162,164,170)",this.phylocanvas=new R.PhyloCanvas({nexml:this.nexml,fileSource:!0},this.svgcontainer.id,o,v);let P=this.svgcontainer.querySelectorAll('path:not([stroke="#a2a4aa"])');for(let z of P)z.style.strokeWidth="2"}draw(){this.clear(),this.drawlines(),this.makeLabels()}clearLabels(){for(let r of this.boxdiv.firstChild.querySelectorAll("text"))r.parentElement.removeChild(r)}makeLabels(){let r=[...L.texts()],a=new Set(r.map(f=>f.parentNode.getAttribute("n"))),o=new Map(r.filter(f=>f.parentNode.hasAttribute("corresp")&&f.parentNode.getAttribute("corresp")===this.name).map(f=>[f.parentNode.getAttribute("select").replace(/^#/,""),f.parentNode.getAttribute("n")]));for(let f of this.boxdiv.firstChild.querySelectorAll("text")){let v=document.createElement("div");v.setAttribute("class","tree-div");let P=parseInt(f.getAttribute("x")-5),z=parseInt(f.getAttribute("y"))-15;v.style.left=P+"px",v.style.top=z+"px";let D=f.textContent.trim();a.has(D)?v.innerHTML=`<span class="witness inactive" data-key="${D}">${D}</span><span class="tree-lemma ${D}" data-id="${D}"></span>`:D!=="fakeroot"?o.has(D)?v.innerHTML=`<span class="internal reconstructed" data-key="${D}" data-label="${o.get(D)}">${o.get(D)}</span><span class="tree-lemma invisible ${D}" data-id="${D}" data-label="${o.get(D)}"></span>`:v.innerHTML=`<span class="internal" data-key="${D}">0</span>`:v.innerHTML=`<span class="internal" data-key="${D}"></span>`,f.parentElement.removeChild(f),this.boxdiv.appendChild(v)}}clearlemmata(){for(let r of this.boxdiv.querySelectorAll("span.tree-lemma"))r.innerHTML="",r.dataset.hasOwnProperty("normal")&&delete r.dataset.normal,r.IAST=r.cloneNode(!0)}populate(r,a){let o=Se(kn),f=L.texts();for(let z of f){let D=z.parentNode.getAttribute("n"),V=this.boxdiv.querySelector(`span.tree-lemma[data-id="${D}"]`)||this.boxdiv.querySelector(`span.tree-lemma[data-label="${D}"]`);if(!!V){if(V.hasOwnProperty("IAST")||(V.IAST=V.cloneNode(!0)),V.IAST.innerHTML="",a){let J=[],oe=[];var v=!1;for(let we=r;we<=a;we++){let Le=L.firstword(we,z);J.push(Le.innerHTML),Le.hasAttribute("lemma")&&(oe[we-r]=Le.getAttribute("lemma")),Le.hasAttribute("emended")&&(v=!0)}if(V.IAST.appendChild(Ie(J.join(" ").replace(/\s+/g," ").trim(),o)),oe.length!==0){let we=J.slice(0).map((Be,Te)=>oe.hasOwnProperty(Te)?oe[Te]:Be),Le=document.createElement("span");Le.appendChild(Ie(we.join(" ").replace(/\s+/g," ").trim(),o)),V.dataset.normal=Le.innerHTML}v?V.dataset.emended=!0:V.dataset.hasOwnProperty("emended")&&delete V.dataset.emended}else{let J=L.firstword(r,z);V.IAST.appendChild(Ie(J.innerHTML,o)),J.hasAttribute("lemma")?V.dataset.normal=J.getAttribute("lemma"):delete V.dataset.normal,J.hasAttribute("emended")?V.dataset.emended=!0:V.dataset.hasOwnProperty("emended")&&delete V.dataset.emended}Ae.normalizedView()&&V.dataset.hasOwnProperty("normal")?V.innerHTML=V.dataset.normal:V.innerHTML=V.IAST.innerHTML}}let P=this.boxdiv.querySelectorAll(".inactive");for(let z of P)z.classList.remove("inactive");this.fitch()}calcPaths(){this.nodes=[],this.paths=[],this.longest={path:[]},this.nsResolver=this.nexml.createNSResolver(this.nexml.ownerDocument==null?this.nexml.documentElement:this.nexml.ownerDocument.documentElement);let r=this.nexml.evaluate("//nex:node[@label]",this.nexml,this.nsResolver,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE);for(let a=0;a<r.snapshotLength;a++)this.nodes.push(r.snapshotItem(a));for(let a=0;a<this.nodes.length;a++){let o=this.nodes[a],f=o.getAttribute("label"),v=o.id;for(let P=a+1;P<this.nodes.length;P++){let z=this.nodes[P],D=z.getAttribute("label"),V=z.id;this.paths.push({nodes:[f,D],path:this.pathFind(v,V)})}}for(let a of Object.keys(this.paths))this.paths[a].path.length>this.longest.path.length&&(this.longest=this.paths[a])}pathFind(r,a,o){o||(o=[]);let f=this.nexml.evaluate('//nex:edge[@source="'+r+'"]|//nex:edge[@target="'+r+'"]',this.nexml,this.nsResolver,XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE,null);var v;for(let P=0;P<f.snapshotLength;P++){let z=f.snapshotItem(P);if(v=[z],o.indexOf(z.id)!=-1)continue;o.push(z.id);let D=z.getAttribute("source")!==r?z.getAttribute("source"):z.getAttribute("target");if(D===a)return v;if(!this.nexml.evaluate('//nex:node[@id="'+D+'"]',this.nexml,this.nsResolver,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue.hasAttribute("otu")){let J=this.pathFind(D,a,o);if(J)return v.concat(J);continue}}return!1}analyzeVariants(r,a){let o=[],f=[],v=Ae.normalizedView()?function(D,V){let J=L.firstword(D,V);return J.hasAttribute("lemma")?J.getAttribute("lemma"):J.textContent}:function(D,V){return L.firstword(D,V).textContent};for(let D of L.texts()){let V=D.parentNode.getAttribute("n");if(!this.nexml.querySelector(`otu[label="${V}"]`))continue;let J=a?Q(L.range(r,a).map(oe=>v(oe,D))):de(v(r,D));J===""?o.hasOwnProperty("")?o[""].push(V):o[""]=[V]:o.hasOwnProperty(J)?o[J].push(V):o[J]=[V]}let P={};for(let D of Object.keys(o)){var z={length:0,branch_length:0,paths:[]};if(o[D].length===1)z=!1;else for(let V=0;V<o[D].length;V++)for(let J=V+1;J<o[D].length;J++){let oe=this.getPath(o[D][V],o[D][J]);if(oe.hasOwnProperty("path")||alert(oe),oe.path.length===z.length){let we=this.calcBranchLength(oe.path);we===z.branch_length?z.paths.push(oe):we>z.branch_length&&(z={length:oe.path.length,branch_length:we,paths:[oe]})}else oe.path.length>z.length&&(z={length:oe.path.length,branch_length:this.calcBranchLength(oe.path),paths:[oe]})}P[D]=z}for(let D of Object.keys(f))P[D]=f[D];return P}getPath(r,a){for(let o of this.paths)if(o.nodes.indexOf(r)>-1&&o.nodes.indexOf(a)>-1)return o;return!1}calcBranchLength(r){return r.map(a=>a.getAttribute("length")).reduce((a,o)=>parseFloat(a)+parseFloat(o))}colourizeVariants(r,a){let o=this.analyzeVariants(r,a);for(let f of this.boxdiv.querySelectorAll("span.tree-lemma")){let v=o.hasOwnProperty(f.dataset.id)?o[o[f.dataset.id]]:o[f.textContent],P={red:252,green:70,blue:107},z={red:63,green:94,blue:251};v?(f.style.color=W(v.length/this.longest.path.length,z,P),f.dataset.length=v.length,f.dataset.branch_length=v.branch_length,f.dataset.nodes=v.paths[0].nodes.join(";")):(f.style.color=W(1/this.longest.path.length,z,P),f.dataset.length=0,f.dataset.branch_length=0,f.dataset.nodes=""),f.textContent.trim()===""?(f.innerHTML='<span lang="en">Â Â Â </span>',f.style.backgroundColor=f.style.color):f.style.backgroundColor=""}}}class nt extends Fe{constructor(r){super(r);this.desc=r,this.text=L.firsttext(r)}init(){this.makeTextBox(),this.makeDescBox(),this.descbox.style.maxWidth="595px",this.descbox.style.paddingLeft="5px",this.boxdiv.addEventListener("mouseup",ie.textMouseup)}refresh(){this.boxdiv.innerHTML="";let r=Se(Jt);this.boxdiv.appendChild(r.transformToFragment(this.text,document)),te(this.boxdiv);for(let a of L.lemmata(!1,this.boxdiv))a.IAST=a.cloneNode(!0);this.updatescript()}makeTextBox(){let r=document.createElement("div");r.dataset.id=this.name,r.classList.add("text-box");let a=Se(Jt);r.appendChild(a.transformToFragment(this.text,document)),te(r);for(let o of L.lemmata(!1,r))o.IAST=o.cloneNode(!0);this.boxdiv=r}}class at extends Fe{constructor(){super(name);this.desc="Matrix",this.name="Matrix",this.makeDescBox(),this.makeViewBox(),this.descbox.style.maxWidth="100vw",this.descbox.style.paddingLeft="5px"}init(){this.makeTable()}makeViewBox(){let r=document.createElement("div");r.classList.add("matrix"),r.dataset.id=this.name,this.boxdiv=r}makeTable(){let r=document.createElement("div");r.classList.add("scroller");let a=Se(_n);r.append(a.transformToFragment(C,document));for(let V of r.getElementsByTagName("th"))V.addEventListener("dragstart",ie.thDragStart);r.addEventListener("dragenter",ie.trDragEnter),r.addEventListener("dragleave",ie.trDragLeave),r.addEventListener("dragover",V=>V.preventDefault()),r.addEventListener("drop",ie.trDragDrop),r.addEventListener("mousedown",ie.matrixMousedown);let o=document.createElement("tr");o.classList.add("header");let f=document.createElement("td");f.classList.add("anchor"),o.appendChild(f);let v=[...L.trs(r)],P=v.map(V=>L.trWalker(V)),z=L.tds(!1,v[0]);for(let V of z){let J=document.createElement("th");J.dataset.ref=V.dataset.n;let oe=0,we=new Set;for(let ze of P){let Ue=ze.nextNode();Ue.IAST=Ue.cloneNode(!0);let Xe=Ue.textContent;Xe!==""&&(oe++,we.add(Xe))}let Le=oe<2?oe:`${oe}(${we.size})`,Be=document.createElement("span");Be.classList.add("readings"),Be.appendChild(document.createTextNode(Le)),J.appendChild(Be);let Te=document.createElement("form");Te.innerHTML='<div><input class="insignificant" title="insignificant" type="checkbox"'+(V.dataset.insignificant?"checked":"")+'></div><div><input class="binary" title="binary" type="checkbox"'+(V.dataset.binary?"checked":"")+"></div>",J.appendChild(Te),o.appendChild(J)}let D=r.querySelector("tbody");D.insertBefore(o,D.firstChild),this.boxdiv.append(r)}}let Ke={fitch:function(){var n,r,a,o;let f={setIntersection:function(...D){let V=D[0];return new Set([...V].filter(J=>{for(let oe=1;oe<D.length;oe++)if(!D[oe].has(J))return!1;return!0}))},setUnion:function(...D){return new Set(D.reduce((V,J)=>(V=[...V,...J],V),[]))}},v=function(D,V){let J=new Map;for(let oe of r[0]){let we=n.get(oe),Le=we?[we[D]]:[];J.set(oe,new Set(Le))}for(let oe=1;oe<r.length;oe++)for(let[we,Le]of r[oe]){let Be=Le.map(Ue=>J.get(Ue)),Te=f.setIntersection(...Be);if(we===V&&Te.size===1)return[...Te][0];let ze=Te.size>0?Te:f.setUnion(...Be);J.set(we,ze)}return J},P=function(D,V){let J=r[0],oe=new Map;for(let we of r[r.length-1])oe.set(we[0],D.get(we[0]));for(let we=r.length-1;we>1;we--)for(let[Le,Be]of r[we]){let Te=oe.get(Le);for(let ze of Be){if(J.indexOf(ze)!==-1)continue;let Ue=D.get(ze),Xe=f.setIntersection(Te,Ue),Ve=Xe.size>0?Xe:Ue;if(ze===V)return Ve;oe.set(ze,Ve)}}return oe.get(V)},z=function(D,V){let J=v(V,D);return typeof J=="string"?J:function(we){if(we.size===1)return[...we][0].trim();let Le=[...we].map(Be=>Be.trim()===""?"_":Be);return Le.length===1?Le[0]:"{"+Le.join(", ")+"}"}(P(J,D))};onmessage=function(D){n=D.data.readings,r=D.data.levels,a=D.data.num,o=D.data.id,postMessage({n:a,result:z(o,a)})}}};return{slaveinit:function(){comboView.init(),window.startbox!==void 0&&(window.startbox.tree?Z.tree(window.startbox.tree.stemmaid,window.startbox.tree.id):window.startbox.text&&Z.text(window.startbox.text.name,window.startbox.text.map))},maininit:function(){document.getElementById("comboview").style.display="block",comboView.init(),qe()},init:function(){l=document.getElementById("views"),d=document.getElementById("descs"),l.addEventListener("click",ie.textClick),document.addEventListener("keydown",ie.keyDown,{capture:!0}),document.addEventListener("contextmenu",ie.rightClick),document.addEventListener("mouseup",$e.remove)},getWindows:function(){return B},addWindow:function(n){B.push(n)},getViewdiv:function(){return l},getTrees:function(){return X}}}();window.addEventListener("load",window.comboView.maininit);
//# sourceMappingURL=script.js.map
