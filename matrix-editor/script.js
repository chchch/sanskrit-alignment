"use strict";var et={};et.defaults={skip_sgml:!1,syncope:!1};var zt=et.schemes={balinese:{vowels:"á¬… á¬† á¬‡ á¬ˆ á¬‰ á¬Š á¬‹ á¬Œ á¬ á¬  á¬ á¬  á¬‘ á¬’".split(" "),vowel_marks:"á¬µ á¬¶ á¬· á¬¸ á¬¹ á¬º á¬» á¬¼ á¬½ á­‚ á¬¾ á¬¿ á­ƒ á­€ á­".split(" "),other_marks:["á¬‚","á¬„","á¬",""],virama:["á­„"],consonants:"á¬“ á¬” á¬• á¬– á¬— á¬˜ á¬™ á¬š á¬› á¬œ á¬ á¬ á¬Ÿ á¬  á¬¡ á¬¢ á¬£ á¬¤ á¬¥ á¬¦ á¬§ á¬¨ á¬© á¬ª á¬« á¬¬ á¬­ á¬® á¬¯ á¬° á¬± á¬² á¬³".split(" "),symbols:"á­ á­‘ á­’ á­“ á­” á­• á­– á­— á­˜ á­™   á­ á­Ÿ".split(" "),zwj:["â€"],skip:[""]},bengali:{vowels:"à¦… à¦† à¦‡ à¦ˆ à¦‰ à¦Š à¦‹ à§  à¦Œ à§¡  à¦ à¦  à¦“ à¦”".split(" "),vowel_marks:"à¦¾ à¦¿ à§€ à§ à§‚ à§ƒ à§„ à§¢ à§£  à§‡ à§ˆ  à§‹ à§Œ".split(" "),other_marks:"à¦‚ à¦ƒ à¦".split(" "),virama:["à§"],consonants:"à¦• à¦– à¦— à¦˜ à¦™ à¦š à¦› à¦œ à¦ à¦ à¦Ÿ à¦  à¦¡ à¦¢ à¦£ à¦¤ à¦¥ à¦¦ à¦§ à¦¨ à¦ª à¦« à¦¬ à¦­ à¦® à¦¯ à¦° à¦² à¦¬ à¦¶ à¦· à¦¸ à¦¹ à¤³ à¦•à§à¦· à¦œà§à¦".split(" "),symbols:"à§¦ à§§ à§¨ à§© à§ª à§« à§¬ à§­ à§® à§¯ à¥ à¦½ à¥¤ à¥¥".split(" "),other:"    à¦¡ à¦¢  à¦¯ ".split(" ")},newa:{vowels:["ğ‘€","ğ‘","ğ‘‚","ğ‘ƒ","ğ‘„","ğ‘…","ğ‘†","ğ‘‡","ğ‘ˆ","ğ‘‰","","ğ‘Š","ğ‘‹","","ğ‘Œ","ğ‘"],vowel_marks:["ğ‘µ","ğ‘¶","ğ‘·","ğ‘¸","ğ‘¹","ğ‘º","ğ‘»","ğ‘¼","ğ‘½","","ğ‘¾","ğ‘¿","","ğ‘‘€","ğ‘‘"],other_marks:["ğ‘‘„","ğ‘‘…","ğ‘‘ƒ","ğ‘‘ ","ğ‘‘¡",""],virama:["ğ‘‘‚"],consonants:["ğ‘","ğ‘","ğ‘","ğ‘‘","ğ‘’","ğ‘”","ğ‘•","ğ‘–","ğ‘—","ğ‘˜","ğ‘š","ğ‘›","ğ‘œ","ğ‘","ğ‘","ğ‘Ÿ","ğ‘ ","ğ‘¡","ğ‘¢","ğ‘£","ğ‘¥","ğ‘¦","ğ‘§","ğ‘¨","ğ‘©","ğ‘«","ğ‘¬","ğ‘®","ğ‘°","ğ‘±","ğ‘²","ğ‘³","ğ‘´"],symbols:["ğ‘‘","ğ‘‘‘","ğ‘‘’","ğ‘‘“","ğ‘‘”","ğ‘‘•","ğ‘‘–","ğ‘‘—","ğ‘‘˜","ğ‘‘™","ğ‘‘‰","ğ‘‘‡","ğ‘‘‹","ğ‘‘Œ"]},sarada:{vowels:["ğ‘†ƒ","ğ‘†„","ğ‘†…","ğ‘††","ğ‘†‡","ğ‘†ˆ","ğ‘†‰","ğ‘†Š","ğ‘†‹","ğ‘†Œ","","ğ‘†","ğ‘†","","ğ‘†","ğ‘†"],vowel_marks:["ğ‘†³","ğ‘†´","ğ‘†µ","ğ‘†¶","ğ‘†·","ğ‘†¸","ğ‘†¹","ğ‘†º","ğ‘†»","","ğ‘†¼","ğ‘†½","","ğ‘†¾","ğ‘†¿"],other_marks:["ğ‘†","ğ‘†‚","ğ‘†€","ğ‘‡‚","ğ‘‡ƒ"],virama:["ğ‘‡€"],consonants:["ğ‘†‘","ğ‘†’","ğ‘†“","ğ‘†”","ğ‘†•","ğ‘†–","ğ‘†—","ğ‘†˜","ğ‘†™","ğ‘†š","ğ‘†›","ğ‘†œ","ğ‘†","ğ‘†","ğ‘†Ÿ","ğ‘† ","ğ‘†¡","ğ‘†¢","ğ‘†£","ğ‘†¤","ğ‘†¥","ğ‘†¦","ğ‘†§","ğ‘†¨","ğ‘†©","ğ‘†ª","ğ‘†«","ğ‘†¬","ğ‘†®","ğ‘†¯","ğ‘†°","ğ‘†±","ğ‘†²","ğ‘†­"],symbols:["ğ‘‡","ğ‘‡‘","ğ‘‡’","ğ‘‡“","ğ‘‡”","ğ‘‡•","ğ‘‡–","ğ‘‡—","ğ‘‡˜","ğ‘‡™","ğ‘‡„","ğ‘‡","ğ‘‡…","ğ‘‡†"]},devanagari:{vowels:"à¤… à¤† à¤‡ à¤ˆ à¤‰ à¤Š à¤‹ à¥  à¤Œ à¥¡ à¤ à¤ à¤ à¤’ à¤“ à¤” à¤ à¤ à¤“".split(" "),vowel_marks:"à¤¾ à¤¿ à¥€ à¥ à¥‚ à¥ƒ à¥„ à¥¢ à¥£ à¥† à¥‡ à¥ˆ à¥Š à¥‹ à¥Œ à¥ à¥à¥‡ à¥à¤¾ à¥à¥‹ à¥† à¥".split(" "),other_marks:"à¤‚ à¤ƒ à¤ á³µ á³¶ ê£½".split(" "),virama:["à¥"],consonants:"à¤• à¤– à¤— à¤˜ à¤™ à¤š à¤› à¤œ à¤ à¤ à¤Ÿ à¤  à¤¡ à¤¢ à¤£ à¤¤ à¤¥ à¤¦ à¤§ à¤¨ à¤ª à¤« à¤¬ à¤­ à¤® à¤¯ à¤° à¤² à¤µ à¤¶ à¤· à¤¸ à¤¹ à¤³".split(" "),symbols:"à¥¦ à¥§ à¥¨ à¥© à¥ª à¥« à¥¬ à¥­ à¥® à¥¯ à¥ à¤½ à¥¤ à¥¥".split(" "),zwj:["â€"],skip:[""],accent:["à¥‘","à¥’"],combo_accent:"à¤ƒà¥‘ à¤ƒà¥’ à¤‚à¥‘ à¤‚à¥’".split(" "),candra:["à¥…"],other:"à¤•à¤¼ à¤–à¤¼ à¤—à¤¼ à¤œà¤¼ à¤¡à¤¼ à¤¢à¤¼ à¤«à¤¼ à¤¯à¤¼ à¤±".split(" ")},gujarati:{vowels:"àª… àª† àª‡ àªˆ àª‰ àªŠ àª‹ à«  àªŒ à«¡  àª àª  àª“ àª”".split(" "),vowel_marks:"àª¾ àª¿ à«€ à« à«‚ à«ƒ à«„ à«¢ à«£  à«‡ à«ˆ  à«‹ à«Œ".split(" "),other_marks:"àª‚ àªƒ àª".split(" "),virama:["à«"],consonants:"àª• àª– àª— àª˜ àª™ àªš àª› àªœ àª àª àªŸ àª  àª¡ àª¢ àª£ àª¤ àª¥ àª¦ àª§ àª¨ àªª àª« àª¬ àª­ àª® àª¯ àª° àª² àªµ àª¶ àª· àª¸ àª¹ àª³".split(" "),symbols:"à«¦ à«§ à«¨ à«© à«ª à«« à«¬ à«­ à«® à«¯ à« àª½ à«¤ à«¥".split(" "),candra:["à«…"]},gurmukhi:{vowels:"à¨… à¨† à¨‡ à¨ˆ à¨‰ à¨Š      à¨ à¨  à¨“ à¨”".split(" "),vowel_marks:"à¨¾ à¨¿ à©€ à© à©‚      à©‡ à©ˆ  à©‹ à©Œ".split(" "),other_marks:"à¨‚ à¨ƒ à¨".split(" "),virama:["à©"],consonants:"à¨• à¨– à¨— à¨˜ à¨™ à¨š à¨› à¨œ à¨ à¨ à¨Ÿ à¨  à¨¡ à¨¢ à¨£ à¨¤ à¨¥ à¨¦ à¨§ à¨¨ à¨ª à¨« à¨¬ à¨­ à¨® à¨¯ à¨° à¨² à¨µ à¨¶ à¨¶ à¨¸ à¨¹ à¨³".split(" "),symbols:"à©¦ à©§ à©¨ à©© à©ª à©« à©¬ à©­ à©® à©¯ à¥ à¤½ à¥¤ à¥¥".split(" "),other:" à¨– à¨— à¨œ à¨¡  à¨«  ".split(" ")},kannada:{vowels:"à²… à²† à²‡ à²ˆ à²‰ à²Š à²‹ à³  à²Œ à³¡ à² à² à² à²’ à²“ à²”".split(" "),vowel_marks:"à²¾ à²¿ à³€ à³ à³‚ à³ƒ à³„ à³¢ à³£ à³† à³‡ à³ˆ à³Š à³‹ à³Œ".split(" "),other_marks:"à²‚ à²ƒ à¤".split(" "),virama:["à³"],consonants:"à²• à²– à²— à²˜ à²™ à²š à²› à²œ à² à² à²Ÿ à²  à²¡ à²¢ à²£ à²¤ à²¥ à²¦ à²§ à²¨ à²ª à²« à²¬ à²­ à²® à²¯ à²° à²² à²µ à²¶ à²· à²¸ à²¹ à²³".split(" "),symbols:"à³¦ à³§ à³¨ à³© à³ª à³« à³¬ à³­ à³® à³¯ à²“à²‚ à²½ à¥¤ à¥¥".split(" "),other:"      à²«  à²±".split(" ")},malayalam:{vowels:"à´… à´† à´‡ à´ˆ à´‰ à´Š à´‹ àµ  à´Œ àµ¡ à´ à´ à´ à´’ à´“ à´”".split(" "),vowel_marks:"à´¾ à´¿ àµ€ àµ àµ‚ àµƒ àµ„ àµ¢ àµ£ àµ† àµ‡ àµˆ àµŠ àµ‹ àµŒ".split(" "),other_marks:"à´‚ à´ƒ à¤".split(" "),virama:["àµ"],consonants:"à´• à´– à´— à´˜ à´™ à´š à´› à´œ à´ à´ à´Ÿ à´  à´¡ à´¢ à´£ à´¤ à´¥ à´¦ à´§ à´¨ à´ª à´« à´¬ à´­ à´® à´¯ à´° à´² à´µ à´¶ à´· à´¸ à´¹ à´³".split(" "),symbols:"àµ¦ àµ§ àµ¨ àµ© àµª àµ« àµ¬ àµ­ àµ® àµ¯ à´“à´‚ à´½ à¥¤ à¥¥".split(" "),other:"        à´±".split(" ")},oriya:{vowels:"à¬… à¬† à¬‡ à¬ˆ à¬‰ à¬Š à¬‹ à­  à¬Œ à­¡  à¬ à¬  à¬“ à¬”".split(" "),vowel_marks:"à¬¾ à¬¿ à­€ à­ à­‚ à­ƒ à­„ à­¢ à­£  à­‡ à­ˆ  à­‹ à­Œ".split(" "),other_marks:"à¬‚ à¬ƒ à¬".split(" "),virama:["à­"],consonants:"à¬• à¬– à¬— à¬˜ à¬™ à¬š à¬› à¬œ à¬ à¬ à¬Ÿ à¬  à¬¡ à¬¢ à¬£ à¬¤ à¬¥ à¬¦ à¬§ à¬¨ à¬ª à¬« à¬¬ à¬­ à¬® à¬¯ à¬° à¬² à¬µ à¬¶ à¬· à¬¸ à¬¹ à¬³".split(" "),symbols:"à­¦ à­§ à­¨ à­© à­ª à­« à­¬ à­­ à­® à­¯ à¬“à¬‚ à¬½ à¥¤ à¥¥".split(" "),other:"    à¬¡ à¬¢  à¬¯ ".split(" ")},tamil:{vowels:"à®… à®† à®‡ à®ˆ à®‰ à®Š     à® à® à® à®’ à®“ à®”".split(" "),vowel_marks:"à®¾ à®¿ à¯€ à¯ à¯‚     à¯† à¯‡ à¯ˆ à¯Š à¯‹ à¯Œ".split(" "),other_marks:"à®‚ à®ƒ ".split(" "),virama:["à¯"],consonants:"à®• à®• à®• à®• à®™ à®š à®š à®œ à®š à® à®Ÿ à®Ÿ à®Ÿ à®Ÿ à®£ à®¤ à®¤ à®¤ à®¤ à®¨ à®ª à®ª à®ª à®ª à®® à®¯ à®° à®² à®µ à®¶ à®· à®¸ à®¹ à®³".split(" "),symbols:"à¯¦ à¯§ à¯¨ à¯© à¯ª à¯« à¯¬ à¯­ à¯® à¯¯ à¯ à¤½ à¥¤ à¥¥".split(" "),other:"        à®±".split(" ")},telugu:{vowels:"à°… à°† à°‡ à°ˆ à°‰ à°Š à°‹ à±  à°Œ à±¡ à° à° à° à°’ à°“ à°”".split(" "),vowel_marks:"à°¾ à°¿ à±€ à± à±‚ à±ƒ à±„ à±¢ à±£ à±† à±‡ à±ˆ à±Š à±‹ à±Œ".split(" "),other_marks:"à°‚ à°ƒ à° á³² á³²".split(" "),virama:["à±"],consonants:"à°• à°– à°— à°˜ à°™ à°š à°› à°œ à° à° à°Ÿ à°  à°¡ à°¢ à°£ à°¤ à°¥ à°¦ à°§ à°¨ à°ª à°« à°¬ à°­ à°® à°¯ à°° à°² à°µ à°¶ à°· à°¸ à°¹ à°³".split(" "),symbols:"à±¦ à±§ à±¨ à±© à±ª à±« à±¬ à±­ à±® à±¯ à°“à°‚ à°½ à¥¤ à¥¥".split(" "),other:"        à°±".split(" ")},iast:{vowels:"a Ä i Ä« u Å« á¹› á¹ á¸· á¸¹ áº½ e ai Ãµ o au Ãª aÃ® Ã´ aÃ»".split(" "),other_marks:["á¹ƒ","á¸¥","mÌ","áº–","á¸«","oá¸¿"],virama:[""],consonants:"k kh g gh á¹… c ch j jh Ã± á¹­ á¹­h á¸ á¸h á¹‡ t th d dh n p ph b bh m y r l v Å› á¹£ s h á¸»".split(" "),symbols:"0 1 2 3 4 5 6 7 8 9 oá¹ ' | ||".split(" ")},iso:{vowels:"a Ä i Ä« u Å« rÌ¥ rÌ¥Ì„ lÌ¥ lÌ¥Ì„ áº½ e ai Ãµ o au Ãª aÃ® Ã´ aÃ»".split(" "),other_marks:["á¹","á¸¥","mÌ","oá¸¿"],virama:[""],consonants:"k kh g gh á¹… c ch j jh Ã± á¹­ á¹­h á¸ á¸h á¹‡ t th d dh n p ph b bh m y r l v Å› á¹£ s h á¸· ká¹£ jÃ±".split(" "),symbols:"0 1 2 3 4 5 6 7 8 9 omÌ ' | ||".split(" ")},itrans:{vowels:"a A i I u U RRi RRI LLi LLI  e ai  o au".split(" "),other_marks:["M","H",".N"],virama:[""],consonants:"k kh g gh ~N ch Ch j jh ~n T Th D Dh N t th d dh n p ph b bh m y r l v sh Sh s h L kSh j~n".split(" "),symbols:"0 1 2 3 4 5 6 7 8 9 OM .a | ||".split(" "),candra:[".c"],zwj:["{}"],skip:"_",accent:["\\'","\\_"],combo_accent:"\\'H \\_H \\'M \\_M".split(" "),other:"q K G z .D .Dh f Y R".split(" ")},hk:{vowels:"a A i I u U R RR lR lRR  e ai  o au".split(" "),other_marks:"M H ~".split(" "),virama:[""],consonants:"k kh g gh G c ch j jh J T Th D Dh N t th d dh n p ph b bh m y r l v z S s h L kS jJ".split(" "),symbols:"0 1 2 3 4 5 6 7 8 9 OM ' | ||".split(" ")},slp1:{vowels:"a A i I u U f F x X áº½ e E Ãµ o O Ãª ÃŠ Ã´ Ã”".split(" "),other_marks:"M H mÌ áº– á¸« oá¸¿".split(" "),virama:[""],consonants:"k K g G N c C j J Y w W q Q R t T d D n p P b B m y r l v S z s h L".split(" "),symbols:"0 1 2 3 4 5 6 7 8 9 oá¹ ' | ||".split(" ")},velthuis:{vowels:"a aa i ii u uu .r .rr .li .ll  e ai  o au".split(" "),other_marks:".m .h ".split(" "),virama:[""],consonants:'k kh g gh "n c ch j jh ~n .t .th .d .d .n t th d dh n p ph b bh m y r l v ~s .s s h L k.s j~n'.split(" "),symbols:"0 1 2 3 4 5 6 7 8 9 o.m ' | ||".split(" ")},wx:{vowels:"a A i I u U q Q L   e E  o O".split(" "),other_marks:"M H z".split(" "),virama:[""],consonants:"k K g G f c C j J F t T d D N w W x X n p P b B m y r l v S R s h  kR jF".split(" "),symbols:"0 1 2 3 4 5 6 7 8 9 oM ' | ||".split(" ")}},vn={},Wt={iast:{á¹›:["rÌ¥"],á¹ƒ:["á¹"]},itrans:{A:["aa"],I:["ii","ee"],U:["uu","oo"],RRi:["R^i"],RRI:["R^I"],LLi:["L^i"],LLI:["L^I"],M:[".m",".n"],"~N":["N^"],ch:["c"],Ch:["C","chh"],"~n":["JN"],v:["w"],Sh:["S","shh"],kSh:["kS","x"],"j~n":["GY","dny"],OM:["AUM"],"\\_":["\\`"],"\\_H":["\\`H"],"\\'M":["\\'.m","\\'.n"],"\\_M":"\\_.m \\_.n \\`M \\`.m \\`.n".split(" "),".a":["~"],"|":["."],"||":[".."],z:["J"]}},Nt={};et.isRomanScheme=function(A){return vn.hasOwnProperty(A)};et.addBrahmicScheme=function(A,C){et.schemes[A]=C};et.addRomanScheme=function(A,C){"vowel_marks"in C||(C.vowel_marks=C.vowels.slice(1)),et.schemes[A]=C,vn[A]=!0};var yn=function(A){var C={};for(var M in A)!A.hasOwnProperty(M)||(C[M]=A[M].slice(0));return C};(function(){var A=zt.kolkata=yn(zt.iast),C="iast itrans hk kolkata slp1 velthuis wx".split(" ");A.vowels="a Ä i Ä« u Å« á¹› á¹ á¸· á¸¹ e Ä“ ai o Å au".split(" ");for(var M=0,G;G=C[M];M++)et.addRomanScheme(G,zt[G]);var X=yn(zt.itrans);X.vowels="a A i I u U Ri RRI LLi LLi e E ai o O au".split(" "),X.vowel_marks=X.vowels.slice(1),Wt.itrans_dravidian=Wt.itrans,et.addRomanScheme("itrans_dravidian",X)})();var qn=function(A,C){var M=Wt[A]||{},G={},X=et.schemes[A],V={},I=[],l={},d=et.schemes[C];for(var x in X)if(!!X.hasOwnProperty(x)){var B=X[x],W=d[x];if(W!==void 0)for(var U=0;U<B.length;U++){var F=B[U],T=W[U],O=M[F]||[],K=O.length,fe=0;for(I.push(F.length),fe=0;fe<K;fe++)I.push(O[fe].length);if(x==="vowel_marks"||x==="virama")for(l[F]=T,fe=0;fe<K;fe++)l[O[fe]]=T;else{for(V[F]=T,fe=0;fe<K;fe++)V[O[fe]]=T;if(x==="consonants"||x==="other")for(G[F]=T,fe=0;fe<K;fe++)G[O[fe]]=T}}}return{consonants:G,fromRoman:et.isRomanScheme(A),letters:V,marks:l,maxTokenLength:Math.max.apply(Math,I),toRoman:et.isRomanScheme(C),virama:d.virama}},zn=function(A,C,M){for(var G=[],X=C.consonants,V=A.length,I=!1,l=C.letters,d=C.marks,x=C.maxTokenLength,B=M.skip_sgml,W=M.syncope,U,F,T="",O=C.toRoman,K=C.virama,fe=!1,J=!1,Y=!1,me=0,Ce;(Ce=A.charAt(me))||T;me++){var ke=x-T.length;if(!(ke>0&&me<V&&(T+=Ce,ke>1)))for(var ee=0;ee<x;ee++){var Ae=T.substr(0,x-ee);if(fe===!0)fe=Ae!==">";else if(Ae==="<")fe=B;else if(Ae==="##"){Y=!Y,T=T.substr(2);break}if(J=fe||Y,(U=l[Ae])!==void 0&&!J){O?G.push(U):(I?(F=d[Ae])?G.push(F):Ae!=="a"&&(G.push(K),G.push(U)):G.push(U),I=Ae in X),T=T.substr(x-ee);break}else ee===x-1&&(I&&(I=!1,W||G.push(K)),G.push(Ae),T=T.substr(1))}}return I&&!W&&G.push(K),G.join("")},Fn=function(A,C){for(var M=[],G=C.consonants,X=!1,V=!1,I=C.letters,l=C.marks,d,x=C.toRoman,B=!1,W=0,U;U=A.charAt(W);W++){if(U==="#"){X?(B=!B,X=!1):X=!0,V&&(M.push("a"),V=!1);continue}else if(B){M.push(U);continue}(d=l[U])!==void 0?(M.push(d),V=!1):(X&&(M.push("#"),X=!1),V&&(M.push("a"),V=!1),(d=I[U])?(M.push(d),V=x&&U in G):M.push(U))}return V&&M.push("a"),M.join("")};et.t=function(A,C,M,G){G=G||{};var X=Nt.options||{},V=et.defaults,I=Nt.from===C&&Nt.to===M,l;for(var d in V)if(V.hasOwnProperty(d)){var x=V[d];d in G&&(x=G[d]),G[d]=x,x!==X[d]&&(I=!1)}return I?l=Nt.map:(l=qn(C,M,G),Nt={from:C,map:l,options:G,to:M}),C==="itrans"&&(A=A.replace(/\{\\m\+\}/g,".h.N"),A=A.replace(/\.h/g,""),A=A.replace(/\\([^'`_]|$)/g,"##$1##")),l.fromRoman?zn(A,l,G):Fn(A,l,G)};var bn=function(){let A=[{name:"valapalagilaka",search:"á¹™",replace:()=>"r"},{name:"short e",search:"áº½",replace:()=>"e"},{name:"short o",search:"Ãµ",replace:()=>"o"},{name:"pá¹›á¹£á¹­hamÄtrÄ e",search:"Ãª",replace:()=>"e"},{name:"pá¹›á¹£á¹­hamÄtrÄ o",search:"Ã´",replace:()=>"o"},{name:"pá¹›á¹£á¹­hamÄtrÄ ai",search:"ÃŠ",replace:()=>"E"},{name:"pá¹›á¹£á¹­hamÄtrÄ au",search:"Ã”",replace:()=>"O"},{name:"candrabindu",search:"mÌ",replace:()=>"M"},{name:"oá¹ƒkÄras",search:"oá¹",replace:()=>"oM"},{name:"additional punctuation",search:"[()\\[\\],;?!|_\\-=+\\d.'\\/]+",replace:()=>""},{name:"geminated aspirated consonants",search:"(?:kK|gG|cC|jJ|wW|qQ|tT|dD|pP|bB)",replace:I=>I[0].slice(-1)},{name:"geminated m after h",search:"(?:Mhm|hmm)",replace:()=>"hm"},{name:"geminated t",search:"([rfi]|p[aA])tt|tt(?=[rvy]\\S)",replace:I=>`${I[1]}t`},{name:"geminated consonants after r",search:"([rf]\\s*)([kgcjwqdpbRnmyvl])\\2{1,2}",replace:I=>`${I[1]}${I[2]}`},{name:"final nasal variants",search:"(?:M[lSs]|nn)(?!\\S)",replace:()=>"n"},{name:"internal nasal variants",search:"[mnNYR](?=[pPbBmdDtTnwWqQcCjJkKgG])",replace:()=>"M"},{name:"final anusvÄra variants",search:"M?[mN](?!\\S)|n(?=\\s+[tdn])|Y(?=\\s+[jc])",replace:()=>"M"},{name:"visarga aá¸¥ before voiced consonants",search:"(?<!\\sB)(?:a[Hr]|[o])(?=\\s+['gGjJqQdDnbBmrylvh])",replace:()=>"aH"},{name:"visarga aá¸¥ before vowels",search:"aH(?=\\s+[AiIeuUof])",replace:()=>"a"},{name:"visarga aá¸¥ before unvoiced consonants and space + anusvÄra",search:"o\\s+(?=[kKcCwWtTpPszSM])",replace:()=>"aH a"},{name:"visarga Äá¸¥ variants",search:"AH(?=\\s+[aAiIeEuUogGjJqQdDbBnmyrlvh])",replace:()=>"A"},{name:"other visarga variants",search:"H?[rszS](?!\\S)",replace:()=>"H"},{name:"avagrahas",search:"'",replace:()=>"a"},{name:"internal visarga variants",search:"z(?=[kK])|s(?=s)",replace:()=>"H"},{name:"final au/Äv",search:"Av(?!\\S)",replace:()=>"O"},{name:"final su",search:"(?<=[sz])v(?=\\s+[aAiIuUoOeE])",replace:()=>"u"},{name:"final i",search:"i(?=\\s+[aAuUoOeE])",replace:()=>"y"},{name:"kcch/kÅ›",search:"k(\\s*)(?:S|c?C)",replace:I=>`k${I[1]}S`},{name:"cÅ›/tÅ›",search:"[tc](\\s*)S",replace:I=>`c${I[1]}C`},{name:"cch/ch",search:"([aAiIuUeEoO])C",replace:I=>`${I[1]}cC`},{name:"final t + hi",search:"d(\\s+)D(?=[iy](?:\\s|$))",replace:I=>`t${I[1]}h`},{name:"final t + voiced syllable",search:"d(?=(?:\\s+[aAiIeEuUoOgGdDbByrv]|\\s*$))",replace:()=>"t"},{name:"final t + n/m",search:"([ai])n(?=\\s+[nm])",replace:I=>`${I[1]}t`},{name:"final t + c/j",search:"j(?=\\s+j)|c(?=\\s+c)",replace:()=>"t"},{name:"i/y + vowel",search:"y(?=\\s+[aAuUeEoO])",replace:()=>"i"},{name:"bhd for bdh",search:"Bd",replace:()=>"bD"}],C=[{name:"valapalagilaka",search:"á¹™",replace:()=>"r"},{name:"short e",search:"áº½",replace:()=>"e"},{name:"short o",search:"Ãµ",replace:()=>"o"},{name:"pá¹›á¹£á¹­hamÄtrÄ e",search:"Ãª",replace:()=>"e"},{name:"pá¹›á¹£á¹­hamÄtrÄ o",search:"Ã´",replace:()=>"o"},{name:"pá¹›á¹£á¹­hamÄtrÄ ai",search:"aÃ®",replace:()=>"ai"},{name:"pá¹›á¹£á¹­hamÄtrÄ au",search:"aÃ»",replace:()=>"au"},{name:"candrabindu",search:"mÌ",replace:()=>"á¹ƒ"},{name:"oá¹ƒkÄras",search:"oá¹",replace:()=>"oá¹ƒ"},{name:"additional punctuation",search:"[()\\[\\],;?!|_\\-=+\\d.'\\/]+",replace:()=>""},{name:"geminated aspirated consonants",search:"([kgcjá¹­á¸tdpb]){2}h",replace:I=>`${I[1]}h`},{name:"geminated m after h",search:"(?:á¹ƒhm|hmm)",replace:()=>"hm"},{name:"geminated t",search:"([rá¹›i]|p[aÄ])tt|tt(?=[rvy]\\S)",replace:I=>`${I[1]}t`},{name:"geminated consonants after r",search:"([rá¹›]\\s*)([kgcjá¹­á¸á¹‡tdnpbmyvl])\\2{1,2}",replace:I=>`${I[1]}${I[2]}`},{name:"final nasal variants",search:"(?:á¹ƒ[lá¹£s]|nn)(?!\\S)",replace:()=>"n"},{name:"internal nasal variants",search:"[mná¹…Ã±á¹‡](?=[pbmdtná¹­á¸cjkg])",replace:()=>"á¹ƒ"},{name:"final anusvÄra variants",search:"á¹ƒ?[má¹…](?!\\S)|n(?=\\s+[tdn])|Ã±(?=\\s+[jc])",replace:()=>"á¹ƒ"},{name:"visarga aá¸¥ before voiced consonants",search:"(?:a[á¸¥r]|[o])(?=\\s+['gjá¸dnbmyrlvh])",replace:()=>"aá¸¥"},{name:"visarga aá¸¥ before vowels",search:"aá¸¥(?=\\s+[ÄiÄ«euÅ«oá¹›])",replace:()=>"a"},{name:"visarga aá¸¥ before unvoiced consonants and space + anusvÄra",search:"o\\s+(?=[kcá¹­tpÅ›á¹£sá¹ƒ])",replace:()=>"aá¸¥ a"},{name:"visarga Äá¸¥ variants",search:"Äá¸¥(?=\\s+[aÄiÄ«euÅ«ogjá¸dnbmyrlvh])",replace:()=>"Ä"},{name:"other visarga variants",search:"á¸¥?[rÅ›á¹£s](?!\\S)",replace:()=>"á¸¥"},{name:"avagrahas",search:"'",replace:()=>"a"},{name:"internal visarga variants",search:"á¹£(?=k)|s(?=s)",replace:()=>"s"},{name:"final au/Äv",search:"Äv(?!\\S)",replace:()=>"au"},{name:"final su",search:"(?<=[sá¹£])v(?=\\s+[aÄiÄ«uÅ«oe])",replace:()=>"u"},{name:"final i",search:"i(?=\\s+[aÄuÅ«eo])",replace:()=>"y"},{name:"kcch/kÅ›",search:"k(\\s*)(?:Å›|c?ch)",replace:I=>`k${I[1]}Å›`},{name:"cÅ›/tÅ›",search:"[tc](\\s*)Å›",replace:I=>`c${I[1]}ch`},{name:"cch/ch",search:"([aÄiÄ«uÅ«eo])ch",replace:I=>`${I[1]}cch`},{name:"final t + hi",search:"d(\\s+)dh(?=[iy](?:\\s|$))",replace:I=>`t${I[1]}h`},{name:"final t + voiced syllable",search:"d(?=(?:\\s+[aÄiÄ«euÅ«ogdbyrv]|\\s*$))",replace:()=>"t"},{name:"final t + n/m",search:"([ai])n(?=\\s+[nm])",replace:I=>`${I[1]}t`},{name:"final t + c/j",search:"j(?=\\s+j)|c(?=\\s+c)",replace:()=>"t"},{name:"i/y + vowel",search:"y(?=\\s+[aÄuÅ«eo])",replace:()=>"i"},{name:"bhd for bdh",search:"bhd",replace:()=>"bdh"}],M={none:{name:"remove spaces",search:"\\s",replace:()=>""},collapse:{name:"collapse spaces",search:"\\s+",replace:()=>" "}},G=function(I,l){let d=l.join(""),x=[],B=[...d.matchAll(I.search)],W=0,U=null;for(let F of l){let T=W+F.length,O=F,K=0;if(U)if(U.length<=F.length)O=X(F,0,U.length,U.text),K=U.text.length-U.length,U=null;else{O=U.text.slice(0,F.length);let J=U.text.slice(F.length);U={length:U.length-F.length,text:J};continue}for(;B.length>0&&B[0].index<T;){let fe=B.shift(),J=fe.index-W+K,Y=I.replace(fe);if(fe.index+fe[0].length<T)O=X(O,J,fe[0].length,Y),K=K+Y.length-fe[0].length;else{let me=F.length-J+K,Ce=Y.slice(0,me);O=O.slice(0,J)+Ce;let ke=Y.slice(me);U={length:fe[0].length-me,text:ke}}}x.push(O),W=T}return x},X=function(I,l,d,x){return I.slice(0,l)+x+I.slice(l+d)};return function(I){let l=I.map(d=>et.t(d,"iast","slp1"));for(let d of[...A,M.none])l=G(d,l);return l.map(d=>et.t(d,"slp1","iast"))}}();var Yt={};(function(A){"use strict";A.__type__="csv";var C=typeof jQuery!="undefined"&&jQuery.Deferred||typeof _!="undefined"&&_.Deferred||function(){var l,d,x=new Promise(function(B,W){l=B,d=W});return{resolve:l,reject:d,promise:function(){return x}}};A.fetch=function(l){var d=new C;if(l.file){var x=new FileReader,B=l.encoding||"UTF-8";x.onload=function(F){var T=A.extractFields(A.parse(F.target.result,l),l);T.useMemoryStore=!0,T.metadata={filename:l.file.name},d.resolve(T)},x.onerror=function(F){d.reject({error:{message:"Failed to load file. Code: "+F.target.error.code}})},x.readAsText(l.file,B)}else if(l.data){var W=A.extractFields(A.parse(l.data,l),l);W.useMemoryStore=!0,d.resolve(W)}else if(l.url){var U=window.fetch||function(F){var T=jQuery.get(F),O={then:function(K){return T.done(K),O},catch:function(K){return T.fail(K),O}};return O};U(l.url).then(function(F){return F.text?F.text():F}).then(function(F){var T=A.extractFields(A.parse(F,l),l);T.useMemoryStore=!0,d.resolve(T)}).catch(function(F,T){d.reject({error:{message:"Failed to load file. "+F.statusText+". Code: "+F.status,request:F}})})}return d.promise()},A.extractFields=function(l,d){return d.noHeaderRow!==!0&&l.length>0?{fields:l[0],records:l.slice(1)}:{records:l}},A.normalizeDialectOptions=function(l){var d={delimiter:",",doublequote:!0,lineterminator:`
`,quotechar:'"',skipinitialspace:!0,skipinitialrows:0};for(var x in l)x==="trim"?d.skipinitialspace=l.trim:d[x.toLowerCase()]=l[x];return d},A.parse=function(l,d){(!d||d&&!d.lineterminator)&&(l=A.normalizeLineTerminator(l,d));var x=A.normalizeDialectOptions(d);l=I(l,x.lineterminator);var B="",W=!1,U=!1,F="",T=[],O=[],K,fe;for(fe=function(J){return U!==!0&&(J===""?J=null:x.skipinitialspace===!0&&(J=V(J)),M.test(J)?J=parseInt(J,10):G.test(J)&&(J=parseFloat(J,10))),J},K=0;K<l.length;K+=1)B=l.charAt(K),W===!1&&(B===x.delimiter||B===x.lineterminator)?(F=fe(F),T.push(F),B===x.lineterminator&&(O.push(T),T=[]),F="",U=!1):B!==x.quotechar?F+=B:W?l.charAt(K+1)===x.quotechar?(F+=x.quotechar,K+=1):W=!1:(W=!0,U=!0);return F=fe(F),T.push(F),O.push(T),x.skipinitialrows&&(O=O.slice(x.skipinitialrows)),O},A.normalizeLineTerminator=function(l,d){return d=d||{},d.lineterminator?l:l.replace(/(\r\n|\n|\r)/gm,`
`)},A.objectToArray=function(l){for(var d=[],x=[],B=[],W=0;W<l.fields.length;W++){var U=l.fields[W].id;B.push(U);var F=l.fields[W].label?l.fields[W].label:U;x.push(F)}d.push(x);for(var W=0;W<l.records.length;W++){for(var T=[],O=l.records[W],K=0;K<B.length;K++)T.push(O[B[K]]);d.push(T)}return d},A.serialize=function(l,d){var x=null;l instanceof Array?x=l:x=A.objectToArray(l);var B=A.normalizeDialectOptions(d),W="",U="",F="",T="",O,K,fe;for(fe=function(J){return J===null?J="":typeof J=="string"&&X.test(J)?(B.doublequote&&(J=J.replace(/"/g,'""')),J=B.quotechar+J+B.quotechar):typeof J=="number"&&(J=J.toString(10)),J},O=0;O<x.length;O+=1)for(W=x[O],K=0;K<W.length;K+=1)U=fe(W[K]),K===W.length-1?(F+=U,T+=F+B.lineterminator,F=""):F+=U+B.delimiter,U="";return T};var M=/^\d+$/,G=/^\d*\.\d+$|^\d+\.\d*$/,X=/^\s|\s$|,|"|\n/,V=function(){return String.prototype.trim?function(l){return l.trim()}:function(l){return l.replace(/^\s*/,"").replace(/\s*$/,"")}}();function I(l,d){return l.charAt(l.length-d.length)!==d?l:l.substring(0,l.length-d.length)}})(Yt);function On(A){return A&&A.__esModule&&Object.prototype.hasOwnProperty.call(A,"default")?A.default:A}function $n(A,C,M){return M={path:C,exports:{},require:function(G,X){return Hn(G,X==null?M.path:X)}},A(M,M.exports),M.exports}function Hn(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}var Vn=$n(function(A,C){(function(M,G){A.exports=G()})(window,function(){return function(M){var G={};function X(V){if(G[V])return G[V].exports;var I=G[V]={i:V,l:!1,exports:{}};return M[V].call(I.exports,I,I.exports,X),I.l=!0,I.exports}return X.m=M,X.c=G,X.d=function(V,I,l){X.o(V,I)||Object.defineProperty(V,I,{enumerable:!0,get:l})},X.r=function(V){typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(V,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(V,"__esModule",{value:!0})},X.t=function(V,I){if(1&I&&(V=X(V)),8&I||4&I&&typeof V=="object"&&V&&V.__esModule)return V;var l=Object.create(null);if(X.r(l),Object.defineProperty(l,"default",{enumerable:!0,value:V}),2&I&&typeof V!="string")for(var d in V)X.d(l,d,function(x){return V[x]}.bind(null,d));return l},X.n=function(V){var I=V&&V.__esModule?function(){return V.default}:function(){return V};return X.d(I,"a",I),I},X.o=function(V,I){return Object.prototype.hasOwnProperty.call(V,I)},X.p="",X(X.s=1)}([function(M,G,X){var V,I;V=[X(2)],(I=function(l){function d(e){if(d.is(e,"function"))return x?e():l.on("raphael.DOMload",e);if(d.is(e,he))return d._engine.create[J](d,e.splice(0,3+d.is(e[0],Z))).add(e);var t=Array.prototype.slice.call(arguments,0);if(d.is(t[t.length-1],"function")){var s=t.pop();return x?s.call(d._engine.create[J](d,t)):l.on("raphael.DOMload",function(){s.call(d._engine.create[J](d,t))})}return d._engine.create[J](d,arguments)}d.version="2.3.0",d.eve=l;var x,B,W=/[, ]+/,U={circle:1,rect:1,path:1,ellipse:1,text:1,image:1},F=/\{(\d+)\}/g,T="hasOwnProperty",O={doc:document,win:window},K={was:Object.prototype[T].call(O.win,"Raphael"),is:O.win.Raphael},fe=function(){this.ca=this.customAttributes={}},J="apply",Y="concat",me="ontouchstart"in window||window.TouchEvent||window.DocumentTouch&&document instanceof DocumentTouch,Ce="",ke=" ",ee=String,Ae="split",Ie="click dblclick mousedown mousemove mouseout mouseover mouseup touchstart touchmove touchend touchcancel"[Ae](ke),je={mousedown:"touchstart",mousemove:"touchmove",mouseup:"touchend"},qe=ee.prototype.toLowerCase,Se=Math,ze=Se.max,ne=Se.min,Ee=Se.abs,Be=Se.pow,ce=Se.PI,Z="number",he="array",De=Object.prototype.toString,f=(d._ISURL=/^url\(['"]?(.+?)['"]?\)$/i,/^\s*((#[a-f\d]{6})|(#[a-f\d]{3})|rgba?\(\s*([\d\.]+%?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+%?(?:\s*,\s*[\d\.]+%?)?)\s*\)|hsba?\(\s*([\d\.]+(?:deg|\xb0|%)?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+(?:%?\s*,\s*[\d\.]+)?)%?\s*\)|hsla?\(\s*([\d\.]+(?:deg|\xb0|%)?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+(?:%?\s*,\s*[\d\.]+)?)%?\s*\))\s*$/i),u={NaN:1,Infinity:1,"-Infinity":1},c=/^(?:cubic-)?bezier\(([^,]+),([^,]+),([^,]+),([^\)]+)\)/,g=Se.round,S=parseFloat,N=parseInt,$=ee.prototype.toUpperCase,re=d._availableAttrs={"arrow-end":"none","arrow-start":"none",blur:0,"clip-rect":"0 0 1e9 1e9",cursor:"default",cx:0,cy:0,fill:"#fff","fill-opacity":1,font:'10px "Arial"',"font-family":'"Arial"',"font-size":"10","font-style":"normal","font-weight":400,gradient:0,height:0,href:"http://raphaeljs.com/","letter-spacing":0,opacity:1,path:"M0,0",r:0,rx:0,ry:0,src:"",stroke:"#000","stroke-dasharray":"","stroke-linecap":"butt","stroke-linejoin":"butt","stroke-miterlimit":0,"stroke-opacity":1,"stroke-width":1,target:"_blank","text-anchor":"middle",title:"Raphael",transform:"",width:0,x:0,y:0,class:""},j=d._availableAnimAttrs={blur:Z,"clip-rect":"csv",cx:Z,cy:Z,fill:"colour","fill-opacity":Z,"font-size":Z,height:Z,opacity:Z,path:"path",r:Z,rx:Z,ry:Z,stroke:"colour","stroke-opacity":Z,"stroke-width":Z,transform:"transform",width:Z,x:Z,y:Z},ae=/[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*/,pe={hs:1,rg:1},ge=/,?([achlmqrstvxz]),?/gi,R=/([achlmrqstvz])[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029,]*((-?\d*\.?\d*(?:e[\-+]?\d+)?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*)+)/gi,Le=/([rstm])[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029,]*((-?\d*\.?\d*(?:e[\-+]?\d+)?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*)+)/gi,E=/(-?\d*\.?\d*(?:e[\-+]?\d+)?)[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*/gi,Re=(d._radial_gradient=/^r(?:\(([^,]+?)[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*([^\)]+?)\))?/,{}),Ve=function(e,t){return S(e)-S(t)},Ye=function(e){return e},Oe=d._rectPath=function(e,t,s,i,h){return h?[["M",e+h,t],["l",s-2*h,0],["a",h,h,0,0,1,h,h],["l",0,i-2*h],["a",h,h,0,0,1,-h,h],["l",2*h-s,0],["a",h,h,0,0,1,-h,-h],["l",0,2*h-i],["a",h,h,0,0,1,h,-h],["z"]]:[["M",e,t],["l",s,0],["l",0,i],["l",-s,0],["z"]]},Ze=function(e,t,s,i){return i==null&&(i=s),[["M",e,t],["m",0,-i],["a",s,i,0,1,1,0,2*i],["a",s,i,0,1,1,0,-2*i],["z"]]},tt=d._getPath={path:function(e){return e.attr("path")},circle:function(e){var t=e.attrs;return Ze(t.cx,t.cy,t.r)},ellipse:function(e){var t=e.attrs;return Ze(t.cx,t.cy,t.rx,t.ry)},rect:function(e){var t=e.attrs;return Oe(t.x,t.y,t.width,t.height,t.r)},image:function(e){var t=e.attrs;return Oe(t.x,t.y,t.width,t.height)},text:function(e){var t=e._getBBox();return Oe(t.x,t.y,t.width,t.height)},set:function(e){var t=e._getBBox();return Oe(t.x,t.y,t.width,t.height)}},at=d.mapPath=function(e,t){if(!t)return e;var s,i,h,m,w,b,k;for(h=0,w=(e=ft(e)).length;h<w;h++)for(m=1,b=(k=e[h]).length;m<b;m+=2)s=t.x(k[m],k[m+1]),i=t.y(k[m],k[m+1]),k[m]=s,k[m+1]=i;return e};if(d._g=O,d.type=O.win.SVGAngle||O.doc.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1")?"SVG":"VML",d.type=="VML"){var Qe,ut=O.doc.createElement("div");if(ut.innerHTML='<v:shape adj="1"/>',(Qe=ut.firstChild).style.behavior="url(#default#VML)",!Qe||typeof Qe.adj!="object")return d.type=Ce;ut=null}function n(e){if(typeof e=="function"||Object(e)!==e)return e;var t=new e.constructor;for(var s in e)e[T](s)&&(t[s]=n(e[s]));return t}d.svg=!(d.vml=d.type=="VML"),d._Paper=fe,d.fn=B=fe.prototype=d.prototype,d._id=0,d.is=function(e,t){return(t=qe.call(t))=="finite"?!u[T](+e):t=="array"?e instanceof Array:t=="null"&&e===null||t==typeof e&&e!==null||t=="object"&&e===Object(e)||t=="array"&&Array.isArray&&Array.isArray(e)||De.call(e).slice(8,-1).toLowerCase()==t},d.angle=function(e,t,s,i,h,m){if(h==null){var w=e-s,b=t-i;return w||b?(180+180*Se.atan2(-b,-w)/ce+360)%360:0}return d.angle(e,t,h,m)-d.angle(s,i,h,m)},d.rad=function(e){return e%360*ce/180},d.deg=function(e){return Math.round(180*e/ce%360*1e3)/1e3},d.snapTo=function(e,t,s){if(s=d.is(s,"finite")?s:10,d.is(e,he)){for(var i=e.length;i--;)if(Ee(e[i]-t)<=s)return e[i]}else{var h=t%(e=+e);if(h<s)return t-h;if(h>e-s)return t-h+e}return t};var r,a;d.createUUID=(r=/[xy]/g,a=function(e){var t=16*Se.random()|0;return(e=="x"?t:3&t|8).toString(16)},function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(r,a).toUpperCase()}),d.setWindow=function(e){l("raphael.setWindow",d,O.win,e),O.win=e,O.doc=O.win.document,d._engine.initWin&&d._engine.initWin(O.win)};var o=function(e){if(d.vml){var t,s=/^\s+|\s+$/g;try{var i=new ActiveXObject("htmlfile");i.write("<body>"),i.close(),t=i.body}catch(w){t=createPopup().document.body}var h=t.createTextRange();o=H(function(w){try{t.style.color=ee(w).replace(s,Ce);var b=h.queryCommandValue("ForeColor");return"#"+("000000"+(b=(255&b)<<16|65280&b|(16711680&b)>>>16).toString(16)).slice(-6)}catch(k){return"none"}})}else{var m=O.doc.createElement("i");m.title="RaphaÃ«l Colour Picker",m.style.display="none",O.doc.body.appendChild(m),o=H(function(w){return m.style.color=w,O.doc.defaultView.getComputedStyle(m,Ce).getPropertyValue("color")})}return o(e)},p=function(){return"hsb("+[this.h,this.s,this.b]+")"},v=function(){return"hsl("+[this.h,this.s,this.l]+")"},P=function(){return this.hex},z=function(e,t,s){if(t==null&&d.is(e,"object")&&"r"in e&&"g"in e&&"b"in e&&(s=e.b,t=e.g,e=e.r),t==null&&d.is(e,"string")){var i=d.getRGB(e);e=i.r,t=i.g,s=i.b}return(e>1||t>1||s>1)&&(e/=255,t/=255,s/=255),[e,t,s]},q=function(e,t,s,i){var h={r:e*=255,g:t*=255,b:s*=255,hex:d.rgb(e,t,s),toString:P};return d.is(i,"finite")&&(h.opacity=i),h};function H(e,t,s){return function i(){var h=Array.prototype.slice.call(arguments,0),m=h.join("â€"),w=i.cache=i.cache||{},b=i.count=i.count||[];return w[T](m)?(function(k,D){for(var se=0,xe=k.length;se<xe;se++)if(k[se]===D)return k.push(k.splice(se,1)[0])}(b,m),s?s(w[m]):w[m]):(b.length>=1e3&&delete w[b.shift()],b.push(m),w[m]=e[J](t,h),s?s(w[m]):w[m])}}d.color=function(e){var t;return d.is(e,"object")&&"h"in e&&"s"in e&&"b"in e?(t=d.hsb2rgb(e),e.r=t.r,e.g=t.g,e.b=t.b,e.hex=t.hex):d.is(e,"object")&&"h"in e&&"s"in e&&"l"in e?(t=d.hsl2rgb(e),e.r=t.r,e.g=t.g,e.b=t.b,e.hex=t.hex):(d.is(e,"string")&&(e=d.getRGB(e)),d.is(e,"object")&&"r"in e&&"g"in e&&"b"in e?(t=d.rgb2hsl(e),e.h=t.h,e.s=t.s,e.l=t.l,t=d.rgb2hsb(e),e.v=t.b):(e={hex:"none"}).r=e.g=e.b=e.h=e.s=e.v=e.l=-1),e.toString=P,e},d.hsb2rgb=function(e,t,s,i){var h,m,w,b,k;return this.is(e,"object")&&"h"in e&&"s"in e&&"b"in e&&(s=e.b,t=e.s,i=e.o,e=e.h),b=(k=s*t)*(1-Ee((e=(e*=360)%360/60)%2-1)),h=m=w=s-k,q(h+=[k,b,0,0,b,k][e=~~e],m+=[b,k,k,b,0,0][e],w+=[0,0,b,k,k,b][e],i)},d.hsl2rgb=function(e,t,s,i){var h,m,w,b,k;return this.is(e,"object")&&"h"in e&&"s"in e&&"l"in e&&(s=e.l,t=e.s,e=e.h),(e>1||t>1||s>1)&&(e/=360,t/=100,s/=100),b=(k=2*t*(s<.5?s:1-s))*(1-Ee((e=(e*=360)%360/60)%2-1)),h=m=w=s-k/2,q(h+=[k,b,0,0,b,k][e=~~e],m+=[b,k,k,b,0,0][e],w+=[0,0,b,k,k,b][e],i)},d.rgb2hsb=function(e,t,s){var i,h;return e=(s=z(e,t,s))[0],t=s[1],s=s[2],{h:(((h=(i=ze(e,t,s))-ne(e,t,s))==0?null:i==e?(t-s)/h:i==t?(s-e)/h+2:(e-t)/h+4)+360)%6*60/360,s:h==0?0:h/i,b:i,toString:p}},d.rgb2hsl=function(e,t,s){var i,h,m,w;return e=(s=z(e,t,s))[0],t=s[1],s=s[2],i=((h=ze(e,t,s))+(m=ne(e,t,s)))/2,{h:(((w=h-m)==0?null:h==e?(t-s)/w:h==t?(s-e)/w+2:(e-t)/w+4)+360)%6*60/360,s:w==0?0:i<.5?w/(2*i):w/(2-2*i),l:i,toString:v}},d._path2string=function(){return this.join(",").replace(ge,"$1")},d._preload=function(e,t){var s=O.doc.createElement("img");s.style.cssText="position:absolute;left:-9999em;top:-9999em",s.onload=function(){t.call(this),this.onload=null,O.doc.body.removeChild(this)},s.onerror=function(){O.doc.body.removeChild(this)},O.doc.body.appendChild(s),s.src=e};function Q(){return this.hex}function oe(e,t){for(var s=[],i=0,h=e.length;h-2*!t>i;i+=2){var m=[{x:+e[i-2],y:+e[i-1]},{x:+e[i],y:+e[i+1]},{x:+e[i+2],y:+e[i+3]},{x:+e[i+4],y:+e[i+5]}];t?i?h-4==i?m[3]={x:+e[0],y:+e[1]}:h-2==i&&(m[2]={x:+e[0],y:+e[1]},m[3]={x:+e[2],y:+e[3]}):m[0]={x:+e[h-2],y:+e[h-1]}:h-4==i?m[3]=m[2]:i||(m[0]={x:+e[i],y:+e[i+1]}),s.push(["C",(-m[0].x+6*m[1].x+m[2].x)/6,(-m[0].y+6*m[1].y+m[2].y)/6,(m[1].x+6*m[2].x-m[3].x)/6,(m[1].y+6*m[2].y-m[3].y)/6,m[2].x,m[2].y])}return s}d.getRGB=H(function(e){if(!e||(e=ee(e)).indexOf("-")+1)return{r:-1,g:-1,b:-1,hex:"none",error:1,toString:Q};if(e=="none")return{r:-1,g:-1,b:-1,hex:"none",toString:Q};!pe[T](e.toLowerCase().substring(0,2))&&e.charAt()!="#"&&(e=o(e));var t,s,i,h,m,w,b=e.match(f);return b?(b[2]&&(i=N(b[2].substring(5),16),s=N(b[2].substring(3,5),16),t=N(b[2].substring(1,3),16)),b[3]&&(i=N((m=b[3].charAt(3))+m,16),s=N((m=b[3].charAt(2))+m,16),t=N((m=b[3].charAt(1))+m,16)),b[4]&&(w=b[4][Ae](ae),t=S(w[0]),w[0].slice(-1)=="%"&&(t*=2.55),s=S(w[1]),w[1].slice(-1)=="%"&&(s*=2.55),i=S(w[2]),w[2].slice(-1)=="%"&&(i*=2.55),b[1].toLowerCase().slice(0,4)=="rgba"&&(h=S(w[3])),w[3]&&w[3].slice(-1)=="%"&&(h/=100)),b[5]?(w=b[5][Ae](ae),t=S(w[0]),w[0].slice(-1)=="%"&&(t*=2.55),s=S(w[1]),w[1].slice(-1)=="%"&&(s*=2.55),i=S(w[2]),w[2].slice(-1)=="%"&&(i*=2.55),(w[0].slice(-3)=="deg"||w[0].slice(-1)=="Â°")&&(t/=360),b[1].toLowerCase().slice(0,4)=="hsba"&&(h=S(w[3])),w[3]&&w[3].slice(-1)=="%"&&(h/=100),d.hsb2rgb(t,s,i,h)):b[6]?(w=b[6][Ae](ae),t=S(w[0]),w[0].slice(-1)=="%"&&(t*=2.55),s=S(w[1]),w[1].slice(-1)=="%"&&(s*=2.55),i=S(w[2]),w[2].slice(-1)=="%"&&(i*=2.55),(w[0].slice(-3)=="deg"||w[0].slice(-1)=="Â°")&&(t/=360),b[1].toLowerCase().slice(0,4)=="hsla"&&(h=S(w[3])),w[3]&&w[3].slice(-1)=="%"&&(h/=100),d.hsl2rgb(t,s,i,h)):((b={r:t,g:s,b:i,toString:Q}).hex="#"+(16777216|i|s<<8|t<<16).toString(16).slice(1),d.is(h,"finite")&&(b.opacity=h),b)):{r:-1,g:-1,b:-1,hex:"none",error:1,toString:Q}},d),d.hsb=H(function(e,t,s){return d.hsb2rgb(e,t,s).hex}),d.hsl=H(function(e,t,s){return d.hsl2rgb(e,t,s).hex}),d.rgb=H(function(e,t,s){function i(h){return h+.5|0}return"#"+(16777216|i(s)|i(t)<<8|i(e)<<16).toString(16).slice(1)}),d.getColor=function(e){var t=this.getColor.start=this.getColor.start||{h:0,s:1,b:e||.75},s=this.hsb2rgb(t.h,t.s,t.b);return t.h+=.075,t.h>1&&(t.h=0,t.s-=.2,t.s<=0&&(this.getColor.start={h:0,s:1,b:t.b})),s.hex},d.getColor.reset=function(){delete this.start},d.parsePathString=function(e){if(!e)return null;var t=we(e);if(t.arr)return He(t.arr);var s={a:7,c:6,h:1,l:2,m:2,r:4,q:4,s:4,t:2,v:1,z:0},i=[];return d.is(e,he)&&d.is(e[0],he)&&(i=He(e)),i.length||ee(e).replace(R,function(h,m,w){var b=[],k=m.toLowerCase();if(w.replace(E,function(D,se){se&&b.push(+se)}),k=="m"&&b.length>2&&(i.push([m][Y](b.splice(0,2))),k="l",m=m=="m"?"l":"L"),k=="r")i.push([m][Y](b));else for(;b.length>=s[k]&&(i.push([m][Y](b.splice(0,s[k]))),s[k]););}),i.toString=d._path2string,t.arr=He(i),i},d.parseTransformString=H(function(e){if(!e)return null;var t=[];return d.is(e,he)&&d.is(e[0],he)&&(t=He(e)),t.length||ee(e).replace(Le,function(s,i,h){var m=[];qe.call(i),h.replace(E,function(w,b){b&&m.push(+b)}),t.push([i][Y](m))}),t.toString=d._path2string,t},this,function(e){if(!e)return e;for(var t=[],s=0;s<e.length;s++){for(var i=[],h=0;h<e[s].length;h++)i.push(e[s][h]);t.push(i)}return t});var we=function(e){var t=we.ps=we.ps||{};return t[e]?t[e].sleep=100:t[e]={sleep:100},setTimeout(function(){for(var s in t)t[T](s)&&s!=e&&(t[s].sleep--,!t[s].sleep&&delete t[s])}),t[e]};function Te(e,t,s,i,h){return e*(e*(-3*t+9*s-9*i+3*h)+6*t-12*s+6*i)-3*t+3*s}function Pe(e,t,s,i,h,m,w,b,k){k==null&&(k=1);for(var D=(k=k>1?1:k<0?0:k)/2,se=[-.1252,.1252,-.3678,.3678,-.5873,.5873,-.7699,.7699,-.9041,.9041,-.9816,.9816],xe=[.2491,.2491,.2335,.2335,.2032,.2032,.1601,.1601,.1069,.1069,.0472,.0472],le=0,te=0;te<12;te++){var ue=D*se[te]+D,ve=Te(ue,e,s,h,w),de=Te(ue,t,i,m,b),ie=ve*ve+de*de;le+=xe[te]*Se.sqrt(ie)}return D*le}function Me(e,t,s,i,h,m,w,b){if(!(ze(e,s)<ne(h,w)||ne(e,s)>ze(h,w)||ze(t,i)<ne(m,b)||ne(t,i)>ze(m,b))){var k=(e-s)*(m-b)-(t-i)*(h-w);if(k){var D=((e*i-t*s)*(h-w)-(e-s)*(h*b-m*w))/k,se=((e*i-t*s)*(m-b)-(t-i)*(h*b-m*w))/k,xe=+D.toFixed(2),le=+se.toFixed(2);if(!(xe<+ne(e,s).toFixed(2)||xe>+ze(e,s).toFixed(2)||xe<+ne(h,w).toFixed(2)||xe>+ze(h,w).toFixed(2)||le<+ne(t,i).toFixed(2)||le>+ze(t,i).toFixed(2)||le<+ne(m,b).toFixed(2)||le>+ze(m,b).toFixed(2)))return{x:D,y:se}}}}function Fe(e,t,s){var i=d.bezierBBox(e),h=d.bezierBBox(t);if(!d.isBBoxIntersect(i,h))return s?0:[];for(var m=Pe.apply(0,e),w=Pe.apply(0,t),b=ze(~~(m/5),1),k=ze(~~(w/5),1),D=[],se=[],xe={},le=s?0:[],te=0;te<b+1;te++){var ue=d.findDotsAtSegment.apply(d,e.concat(te/b));D.push({x:ue.x,y:ue.y,t:te/b})}for(te=0;te<k+1;te++)ue=d.findDotsAtSegment.apply(d,t.concat(te/k)),se.push({x:ue.x,y:ue.y,t:te/k});for(te=0;te<b;te++)for(var ve=0;ve<k;ve++){var de=D[te],ie=D[te+1],Ne=se[ve],ye=se[ve+1],_e=Ee(ie.x-de.x)<.001?"y":"x",be=Ee(ye.x-Ne.x)<.001?"y":"x",Xe=Me(de.x,de.y,ie.x,ie.y,Ne.x,Ne.y,ye.x,ye.y);if(Xe){if(xe[Xe.x.toFixed(4)]==Xe.y.toFixed(4))continue;xe[Xe.x.toFixed(4)]=Xe.y.toFixed(4);var $e=de.t+Ee((Xe[_e]-de[_e])/(ie[_e]-de[_e]))*(ie.t-de.t),We=Ne.t+Ee((Xe[be]-Ne[be])/(ye[be]-Ne[be]))*(ye.t-Ne.t);$e>=0&&$e<=1.001&&We>=0&&We<=1.001&&(s?le++:le.push({x:Xe.x,y:Xe.y,t1:ne($e,1),t2:ne(We,1)}))}}return le}function Ge(e,t,s){e=d._path2curve(e),t=d._path2curve(t);for(var i,h,m,w,b,k,D,se,xe,le,te=s?0:[],ue=0,ve=e.length;ue<ve;ue++){var de=e[ue];if(de[0]=="M")i=b=de[1],h=k=de[2];else{de[0]=="C"?(xe=[i,h].concat(de.slice(1)),i=xe[6],h=xe[7]):(xe=[i,h,i,h,b,k,b,k],i=b,h=k);for(var ie=0,Ne=t.length;ie<Ne;ie++){var ye=t[ie];if(ye[0]=="M")m=D=ye[1],w=se=ye[2];else{ye[0]=="C"?(le=[m,w].concat(ye.slice(1)),m=le[6],w=le[7]):(le=[m,w,m,w,D,se,D,se],m=D,w=se);var _e=Fe(xe,le,s);if(s)te+=_e;else{for(var be=0,Xe=_e.length;be<Xe;be++)_e[be].segment1=ue,_e[be].segment2=ie,_e[be].bez1=xe,_e[be].bez2=le;te=te.concat(_e)}}}}}return te}d.findDotsAtSegment=function(e,t,s,i,h,m,w,b,k){var D=1-k,se=Be(D,3),xe=Be(D,2),le=k*k,te=le*k,ue=se*e+3*xe*k*s+3*D*k*k*h+te*w,ve=se*t+3*xe*k*i+3*D*k*k*m+te*b,de=e+2*k*(s-e)+le*(h-2*s+e),ie=t+2*k*(i-t)+le*(m-2*i+t),Ne=s+2*k*(h-s)+le*(w-2*h+s),ye=i+2*k*(m-i)+le*(b-2*m+i),_e=D*e+k*s,be=D*t+k*i,Xe=D*h+k*w,$e=D*m+k*b,We=90-180*Se.atan2(de-Ne,ie-ye)/ce;return(de>Ne||ie<ye)&&(We+=180),{x:ue,y:ve,m:{x:de,y:ie},n:{x:Ne,y:ye},start:{x:_e,y:be},end:{x:Xe,y:$e},alpha:We}},d.bezierBBox=function(e,t,s,i,h,m,w,b){d.is(e,"array")||(e=[e,t,s,i,h,m,w,b]);var k=_t.apply(null,e);return{x:k.min.x,y:k.min.y,x2:k.max.x,y2:k.max.y,width:k.max.x-k.min.x,height:k.max.y-k.min.y}},d.isPointInsideBBox=function(e,t,s){return t>=e.x&&t<=e.x2&&s>=e.y&&s<=e.y2},d.isBBoxIntersect=function(e,t){var s=d.isPointInsideBBox;return s(t,e.x,e.y)||s(t,e.x2,e.y)||s(t,e.x,e.y2)||s(t,e.x2,e.y2)||s(e,t.x,t.y)||s(e,t.x2,t.y)||s(e,t.x,t.y2)||s(e,t.x2,t.y2)||(e.x<t.x2&&e.x>t.x||t.x<e.x2&&t.x>e.x)&&(e.y<t.y2&&e.y>t.y||t.y<e.y2&&t.y>e.y)},d.pathIntersection=function(e,t){return Ge(e,t)},d.pathIntersectionNumber=function(e,t){return Ge(e,t,1)},d.isPointInsidePath=function(e,t,s){var i=d.pathBBox(e);return d.isPointInsideBBox(i,t,s)&&Ge(e,[["M",t,s],["H",i.x2+10]],1)%2==1},d._removedFactory=function(e){return function(){l("raphael.log",null,"RaphaÃ«l: you are calling to method â€œ"+e+"â€ of removed object",e)}};var Ue=d.pathBBox=function(e){var t=we(e);if(t.bbox)return n(t.bbox);if(!e)return{x:0,y:0,width:0,height:0,x2:0,y2:0};for(var s,i=0,h=0,m=[],w=[],b=0,k=(e=ft(e)).length;b<k;b++)if((s=e[b])[0]=="M")i=s[1],h=s[2],m.push(i),w.push(h);else{var D=_t(i,h,s[1],s[2],s[3],s[4],s[5],s[6]);m=m[Y](D.min.x,D.max.x),w=w[Y](D.min.y,D.max.y),i=s[5],h=s[6]}var se=ne[J](0,m),xe=ne[J](0,w),le=ze[J](0,m),te=ze[J](0,w),ue=le-se,ve=te-xe,de={x:se,y:xe,x2:le,y2:te,width:ue,height:ve,cx:se+ue/2,cy:xe+ve/2};return t.bbox=n(de),de},He=function(e){var t=n(e);return t.toString=d._path2string,t},nt=d._pathToRelative=function(e){var t=we(e);if(t.rel)return He(t.rel);d.is(e,he)&&d.is(e&&e[0],he)||(e=d.parsePathString(e));var s=[],i=0,h=0,m=0,w=0,b=0;e[0][0]=="M"&&(m=i=e[0][1],w=h=e[0][2],b++,s.push(["M",i,h]));for(var k=b,D=e.length;k<D;k++){var se=s[k]=[],xe=e[k];if(xe[0]!=qe.call(xe[0]))switch(se[0]=qe.call(xe[0]),se[0]){case"a":se[1]=xe[1],se[2]=xe[2],se[3]=xe[3],se[4]=xe[4],se[5]=xe[5],se[6]=+(xe[6]-i).toFixed(3),se[7]=+(xe[7]-h).toFixed(3);break;case"v":se[1]=+(xe[1]-h).toFixed(3);break;case"m":m=xe[1],w=xe[2];default:for(var le=1,te=xe.length;le<te;le++)se[le]=+(xe[le]-(le%2?i:h)).toFixed(3)}else{se=s[k]=[],xe[0]=="m"&&(m=xe[1]+i,w=xe[2]+h);for(var ue=0,ve=xe.length;ue<ve;ue++)s[k][ue]=xe[ue]}var de=s[k].length;switch(s[k][0]){case"z":i=m,h=w;break;case"h":i+=+s[k][de-1];break;case"v":h+=+s[k][de-1];break;default:i+=+s[k][de-2],h+=+s[k][de-1]}}return s.toString=d._path2string,t.rel=He(s),s},it=d._pathToAbsolute=function(e){var t=we(e);if(t.abs)return He(t.abs);if(d.is(e,he)&&d.is(e&&e[0],he)||(e=d.parsePathString(e)),!e||!e.length)return[["M",0,0]];var s=[],i=0,h=0,m=0,w=0,b=0;e[0][0]=="M"&&(m=i=+e[0][1],w=h=+e[0][2],b++,s[0]=["M",i,h]);for(var k,D,se=e.length==3&&e[0][0]=="M"&&e[1][0].toUpperCase()=="R"&&e[2][0].toUpperCase()=="Z",xe=b,le=e.length;xe<le;xe++){if(s.push(k=[]),(D=e[xe])[0]!=$.call(D[0]))switch(k[0]=$.call(D[0]),k[0]){case"A":k[1]=D[1],k[2]=D[2],k[3]=D[3],k[4]=D[4],k[5]=D[5],k[6]=+(D[6]+i),k[7]=+(D[7]+h);break;case"V":k[1]=+D[1]+h;break;case"H":k[1]=+D[1]+i;break;case"R":for(var te=[i,h][Y](D.slice(1)),ue=2,ve=te.length;ue<ve;ue++)te[ue]=+te[ue]+i,te[++ue]=+te[ue]+h;s.pop(),s=s[Y](oe(te,se));break;case"M":m=+D[1]+i,w=+D[2]+h;default:for(ue=1,ve=D.length;ue<ve;ue++)k[ue]=+D[ue]+(ue%2?i:h)}else if(D[0]=="R")te=[i,h][Y](D.slice(1)),s.pop(),s=s[Y](oe(te,se)),k=["R"][Y](D.slice(-2));else for(var de=0,ie=D.length;de<ie;de++)k[de]=D[de];switch(k[0]){case"Z":i=m,h=w;break;case"H":i=k[1];break;case"V":h=k[1];break;case"M":m=k[k.length-2],w=k[k.length-1];default:i=k[k.length-2],h=k[k.length-1]}}return s.toString=d._path2string,t.abs=He(s),s},rt=function(e,t,s,i){return[e,t,s,i,s,i]},st=function(e,t,s,i,h,m){return[1/3*e+2/3*s,1/3*t+2/3*i,1/3*h+2/3*s,1/3*m+2/3*i,h,m]},lt=function(e,t,s,i,h,m,w,b,k,D){var se,xe=120*ce/180,le=ce/180*(+h||0),te=[],ue=H(function(gn,xn,qt){return{x:gn*Se.cos(qt)-xn*Se.sin(qt),y:gn*Se.sin(qt)+xn*Se.cos(qt)}});if(D)$e=D[0],We=D[1],be=D[2],Xe=D[3];else{e=(se=ue(e,t,-le)).x,t=se.y,b=(se=ue(b,k,-le)).x,k=se.y;var ve=(e-b)/2,de=(t-k)/2,ie=ve*ve/(s*s)+de*de/(i*i);ie>1&&(s*=ie=Se.sqrt(ie),i*=ie);var Ne=s*s,ye=i*i,_e=(m==w?-1:1)*Se.sqrt(Ee((Ne*ye-Ne*de*de-ye*ve*ve)/(Ne*de*de+ye*ve*ve))),be=_e*s*de/i+(e+b)/2,Xe=_e*-i*ve/s+(t+k)/2,$e=Se.asin(((t-Xe)/i).toFixed(9)),We=Se.asin(((k-Xe)/i).toFixed(9));($e=e<be?ce-$e:$e)<0&&($e=2*ce+$e),(We=b<be?ce-We:We)<0&&(We=2*ce+We),w&&$e>We&&($e-=2*ce),!w&&We>$e&&(We-=2*ce)}var St=We-$e;if(Ee(St)>xe){var Bt=We,ht=b,pt=k;We=$e+xe*(w&&We>$e?1:-1),b=be+s*Se.cos(We),k=Xe+i*Se.sin(We),te=lt(b,k,s,i,h,0,w,ht,pt,[We,Bt,be,Xe])}St=We-$e;var At=Se.cos($e),Pt=Se.sin($e),It=Se.cos(We),gt=Se.sin(We),Ct=Se.tan(St/4),Dt=4/3*s*Ct,hn=4/3*i*Ct,dn=[e,t],Et=[e+Dt*Pt,t-hn*At],fn=[b+Dt*gt,k-hn*It],pn=[b,k];if(Et[0]=2*dn[0]-Et[0],Et[1]=2*dn[1]-Et[1],D)return[Et,fn,pn][Y](te);for(var mn=[],yt=0,Dn=(te=[Et,fn,pn][Y](te).join()[Ae](",")).length;yt<Dn;yt++)mn[yt]=yt%2?ue(te[yt-1],te[yt],le).y:ue(te[yt],te[yt+1],le).x;return mn},ot=function(e,t,s,i,h,m,w,b,k){var D=1-k;return{x:Be(D,3)*e+3*Be(D,2)*k*s+3*D*k*k*h+Be(k,3)*w,y:Be(D,3)*t+3*Be(D,2)*k*i+3*D*k*k*m+Be(k,3)*b}},_t=H(function(e,t,s,i,h,m,w,b){var k,D=h-2*s+e-(w-2*h+s),se=2*(s-e)-2*(h-s),xe=e-s,le=(-se+Se.sqrt(se*se-4*D*xe))/2/D,te=(-se-Se.sqrt(se*se-4*D*xe))/2/D,ue=[t,b],ve=[e,w];return Ee(le)>"1e12"&&(le=.5),Ee(te)>"1e12"&&(te=.5),le>0&&le<1&&(k=ot(e,t,s,i,h,m,w,b,le),ve.push(k.x),ue.push(k.y)),te>0&&te<1&&(k=ot(e,t,s,i,h,m,w,b,te),ve.push(k.x),ue.push(k.y)),D=m-2*i+t-(b-2*m+i),xe=t-i,le=(-(se=2*(i-t)-2*(m-i))+Se.sqrt(se*se-4*D*xe))/2/D,te=(-se-Se.sqrt(se*se-4*D*xe))/2/D,Ee(le)>"1e12"&&(le=.5),Ee(te)>"1e12"&&(te=.5),le>0&&le<1&&(k=ot(e,t,s,i,h,m,w,b,le),ve.push(k.x),ue.push(k.y)),te>0&&te<1&&(k=ot(e,t,s,i,h,m,w,b,te),ve.push(k.x),ue.push(k.y)),{min:{x:ne[J](0,ve),y:ne[J](0,ue)},max:{x:ze[J](0,ve),y:ze[J](0,ue)}}}),ft=d._path2curve=H(function(e,t){var s=!t&&we(e);if(!t&&s.curve)return He(s.curve);for(var i=it(e),h=t&&it(t),m={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},w={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},b=function(_e,be,Xe){var $e,We;if(!_e)return["C",be.x,be.y,be.x,be.y,be.x,be.y];switch(!(_e[0]in{T:1,Q:1})&&(be.qx=be.qy=null),_e[0]){case"M":be.X=_e[1],be.Y=_e[2];break;case"A":_e=["C"][Y](lt[J](0,[be.x,be.y][Y](_e.slice(1))));break;case"S":Xe=="C"||Xe=="S"?($e=2*be.x-be.bx,We=2*be.y-be.by):($e=be.x,We=be.y),_e=["C",$e,We][Y](_e.slice(1));break;case"T":Xe=="Q"||Xe=="T"?(be.qx=2*be.x-be.qx,be.qy=2*be.y-be.qy):(be.qx=be.x,be.qy=be.y),_e=["C"][Y](st(be.x,be.y,be.qx,be.qy,_e[1],_e[2]));break;case"Q":be.qx=_e[1],be.qy=_e[2],_e=["C"][Y](st(be.x,be.y,_e[1],_e[2],_e[3],_e[4]));break;case"L":_e=["C"][Y](rt(be.x,be.y,_e[1],_e[2]));break;case"H":_e=["C"][Y](rt(be.x,be.y,_e[1],be.y));break;case"V":_e=["C"][Y](rt(be.x,be.y,be.x,_e[1]));break;case"Z":_e=["C"][Y](rt(be.x,be.y,be.X,be.Y))}return _e},k=function(_e,be){if(_e[be].length>7){_e[be].shift();for(var Xe=_e[be];Xe.length;)se[be]="A",h&&(xe[be]="A"),_e.splice(be++,0,["C"][Y](Xe.splice(0,6)));_e.splice(be,1),ve=ze(i.length,h&&h.length||0)}},D=function(_e,be,Xe,$e,We){_e&&be&&_e[We][0]=="M"&&be[We][0]!="M"&&(be.splice(We,0,["M",$e.x,$e.y]),Xe.bx=0,Xe.by=0,Xe.x=_e[We][1],Xe.y=_e[We][2],ve=ze(i.length,h&&h.length||0))},se=[],xe=[],le="",te="",ue=0,ve=ze(i.length,h&&h.length||0);ue<ve;ue++){i[ue]&&(le=i[ue][0]),le!="C"&&(se[ue]=le,ue&&(te=se[ue-1])),i[ue]=b(i[ue],m,te),se[ue]!="A"&&le=="C"&&(se[ue]="C"),k(i,ue),h&&(h[ue]&&(le=h[ue][0]),le!="C"&&(xe[ue]=le,ue&&(te=xe[ue-1])),h[ue]=b(h[ue],w,te),xe[ue]!="A"&&le=="C"&&(xe[ue]="C"),k(h,ue)),D(i,h,m,w,ue),D(h,i,w,m,ue);var de=i[ue],ie=h&&h[ue],Ne=de.length,ye=h&&ie.length;m.x=de[Ne-2],m.y=de[Ne-1],m.bx=S(de[Ne-4])||m.x,m.by=S(de[Ne-3])||m.y,w.bx=h&&(S(ie[ye-4])||w.x),w.by=h&&(S(ie[ye-3])||w.y),w.x=h&&ie[ye-2],w.y=h&&ie[ye-1]}return h||(s.curve=He(i)),h?[i,h]:i},null,He),xt=(d._parseDots=H(function(e){for(var t=[],s=0,i=e.length;s<i;s++){var h={},m=e[s].match(/^([^:]*):?([\d\.]*)/);if(h.color=d.getRGB(m[1]),h.color.error)return null;h.opacity=h.color.opacity,h.color=h.color.hex,m[2]&&(h.offset=m[2]+"%"),t.push(h)}for(s=1,i=t.length-1;s<i;s++)if(!t[s].offset){for(var w=S(t[s-1].offset||0),b=0,k=s+1;k<i;k++)if(t[k].offset){b=t[k].offset;break}b||(b=100,k=i);for(var D=((b=S(b))-w)/(k-s+1);s<k;s++)w+=D,t[s].offset=w+"%"}return t}),d._tear=function(e,t){e==t.top&&(t.top=e.prev),e==t.bottom&&(t.bottom=e.next),e.next&&(e.next.prev=e.prev),e.prev&&(e.prev.next=e.next)}),En=(d._tofront=function(e,t){t.top!==e&&(xt(e,t),e.next=null,e.prev=t.top,t.top.next=e,t.top=e)},d._toback=function(e,t){t.bottom!==e&&(xt(e,t),e.next=t.bottom,e.prev=null,t.bottom.prev=e,t.bottom=e)},d._insertafter=function(e,t,s){xt(e,s),t==s.top&&(s.top=e),t.next&&(t.next.prev=e),e.next=t.next,e.prev=t,t.next=e},d._insertbefore=function(e,t,s){xt(e,s),t==s.bottom&&(s.bottom=e),t.prev&&(t.prev.next=e),e.prev=t.prev,t.prev=e,e.next=t},d.toMatrix=function(e,t){var s=Ue(e),i={_:{transform:Ce},getBBox:function(){return s}};return Kt(i,t),i.matrix}),Kt=(d.transformPath=function(e,t){return at(e,En(e,t))},d._extractTransform=function(e,t){if(t==null)return e._.transform;t=ee(t).replace(/\.{3}|\u2026/g,e._.transform||Ce);var s,i,h=d.parseTransformString(t),m=0,w=1,b=1,k=e._,D=new bt;if(k.transform=h||[],h)for(var se=0,xe=h.length;se<xe;se++){var le,te,ue,ve,de,ie=h[se],Ne=ie.length,ye=ee(ie[0]).toLowerCase(),_e=ie[0]!=ye,be=_e?D.invert():0;ye=="t"&&Ne==3?_e?(le=be.x(0,0),te=be.y(0,0),ue=be.x(ie[1],ie[2]),ve=be.y(ie[1],ie[2]),D.translate(ue-le,ve-te)):D.translate(ie[1],ie[2]):ye=="r"?Ne==2?(de=de||e.getBBox(1),D.rotate(ie[1],de.x+de.width/2,de.y+de.height/2),m+=ie[1]):Ne==4&&(_e?(ue=be.x(ie[2],ie[3]),ve=be.y(ie[2],ie[3]),D.rotate(ie[1],ue,ve)):D.rotate(ie[1],ie[2],ie[3]),m+=ie[1]):ye=="s"?Ne==2||Ne==3?(de=de||e.getBBox(1),D.scale(ie[1],ie[Ne-1],de.x+de.width/2,de.y+de.height/2),w*=ie[1],b*=ie[Ne-1]):Ne==5&&(_e?(ue=be.x(ie[3],ie[4]),ve=be.y(ie[3],ie[4]),D.scale(ie[1],ie[2],ue,ve)):D.scale(ie[1],ie[2],ie[3],ie[4]),w*=ie[1],b*=ie[2]):ye=="m"&&Ne==7&&D.add(ie[1],ie[2],ie[3],ie[4],ie[5],ie[6]),k.dirtyT=1,e.matrix=D}e.matrix=D,k.sx=w,k.sy=b,k.deg=m,k.dx=s=D.e,k.dy=i=D.f,w==1&&b==1&&!m&&k.bbox?(k.bbox.x+=+s,k.bbox.y+=+i):k.dirtyT=1}),Zt=function(e){var t=e[0];switch(t.toLowerCase()){case"t":return[t,0,0];case"m":return[t,1,0,0,1,0,0];case"r":return e.length==4?[t,0,e[2],e[3]]:[t,0];case"s":return e.length==5?[t,1,1,e[3],e[4]]:e.length==3?[t,1,1]:[t,1]}},Ln=d._equaliseTransform=function(e,t){t=ee(t).replace(/\.{3}|\u2026/g,e),e=d.parseTransformString(e)||[],t=d.parseTransformString(t)||[];for(var s,i,h,m,w=ze(e.length,t.length),b=[],k=[],D=0;D<w;D++){if(h=e[D]||Zt(t[D]),m=t[D]||Zt(h),h[0]!=m[0]||h[0].toLowerCase()=="r"&&(h[2]!=m[2]||h[3]!=m[3])||h[0].toLowerCase()=="s"&&(h[3]!=m[3]||h[4]!=m[4]))return;for(b[D]=[],k[D]=[],s=0,i=ze(h.length,m.length);s<i;s++)s in h&&(b[D][s]=h[s]),s in m&&(k[D][s]=m[s])}return{from:b,to:k}};function bt(e,t,s,i,h,m){e!=null?(this.a=+e,this.b=+t,this.c=+s,this.d=+i,this.e=+h,this.f=+m):(this.a=1,this.b=0,this.c=0,this.d=1,this.e=0,this.f=0)}d._getContainer=function(e,t,s,i){var h;if((h=i!=null||d.is(e,"object")?e:O.doc.getElementById(e))!=null)return h.tagName?t==null?{container:h,width:h.style.pixelWidth||h.offsetWidth,height:h.style.pixelHeight||h.offsetHeight}:{container:h,width:t,height:s}:{container:1,x:e,y:t,width:s,height:i}},d.pathToRelative=nt,d._engine={},d.path2curve=ft,d.matrix=function(e,t,s,i,h,m){return new bt(e,t,s,i,h,m)},function(e){function t(i){return i[0]*i[0]+i[1]*i[1]}function s(i){var h=Se.sqrt(t(i));i[0]&&(i[0]/=h),i[1]&&(i[1]/=h)}e.add=function(i,h,m,w,b,k){var D,se,xe,le,te=[[],[],[]],ue=[[this.a,this.c,this.e],[this.b,this.d,this.f],[0,0,1]],ve=[[i,m,b],[h,w,k],[0,0,1]];for(i&&i instanceof bt&&(ve=[[i.a,i.c,i.e],[i.b,i.d,i.f],[0,0,1]]),D=0;D<3;D++)for(se=0;se<3;se++){for(le=0,xe=0;xe<3;xe++)le+=ue[D][xe]*ve[xe][se];te[D][se]=le}this.a=te[0][0],this.b=te[1][0],this.c=te[0][1],this.d=te[1][1],this.e=te[0][2],this.f=te[1][2]},e.invert=function(){var i=this,h=i.a*i.d-i.b*i.c;return new bt(i.d/h,-i.b/h,-i.c/h,i.a/h,(i.c*i.f-i.d*i.e)/h,(i.b*i.e-i.a*i.f)/h)},e.clone=function(){return new bt(this.a,this.b,this.c,this.d,this.e,this.f)},e.translate=function(i,h){this.add(1,0,0,1,i,h)},e.scale=function(i,h,m,w){h==null&&(h=i),(m||w)&&this.add(1,0,0,1,m,w),this.add(i,0,0,h,0,0),(m||w)&&this.add(1,0,0,1,-m,-w)},e.rotate=function(i,h,m){i=d.rad(i),h=h||0,m=m||0;var w=+Se.cos(i).toFixed(9),b=+Se.sin(i).toFixed(9);this.add(w,b,-b,w,h,m),this.add(1,0,0,1,-h,-m)},e.x=function(i,h){return i*this.a+h*this.c+this.e},e.y=function(i,h){return i*this.b+h*this.d+this.f},e.get=function(i){return+this[ee.fromCharCode(97+i)].toFixed(4)},e.toString=function(){return d.svg?"matrix("+[this.get(0),this.get(1),this.get(2),this.get(3),this.get(4),this.get(5)].join()+")":[this.get(0),this.get(2),this.get(1),this.get(3),0,0].join()},e.toFilter=function(){return"progid:DXImageTransform.Microsoft.Matrix(M11="+this.get(0)+", M12="+this.get(2)+", M21="+this.get(1)+", M22="+this.get(3)+", Dx="+this.get(4)+", Dy="+this.get(5)+", sizingmethod='auto expand')"},e.offset=function(){return[this.e.toFixed(4),this.f.toFixed(4)]},e.split=function(){var i={};i.dx=this.e,i.dy=this.f;var h=[[this.a,this.c],[this.b,this.d]];i.scalex=Se.sqrt(t(h[0])),s(h[0]),i.shear=h[0][0]*h[1][0]+h[0][1]*h[1][1],h[1]=[h[1][0]-h[0][0]*i.shear,h[1][1]-h[0][1]*i.shear],i.scaley=Se.sqrt(t(h[1])),s(h[1]),i.shear/=i.scaley;var m=-h[0][1],w=h[1][1];return w<0?(i.rotate=d.deg(Se.acos(w)),m<0&&(i.rotate=360-i.rotate)):i.rotate=d.deg(Se.asin(m)),i.isSimple=!(+i.shear.toFixed(9)||i.scalex.toFixed(9)!=i.scaley.toFixed(9)&&i.rotate),i.isSuperSimple=!+i.shear.toFixed(9)&&i.scalex.toFixed(9)==i.scaley.toFixed(9)&&!i.rotate,i.noRotation=!+i.shear.toFixed(9)&&!i.rotate,i},e.toTransformString=function(i){var h=i||this[Ae]();return h.isSimple?(h.scalex=+h.scalex.toFixed(4),h.scaley=+h.scaley.toFixed(4),h.rotate=+h.rotate.toFixed(4),(h.dx||h.dy?"t"+[h.dx,h.dy]:Ce)+(h.scalex!=1||h.scaley!=1?"s"+[h.scalex,h.scaley,0,0]:Ce)+(h.rotate?"r"+[h.rotate,0,0]:Ce)):"m"+[this.get(0),this.get(1),this.get(2),this.get(3),this.get(4),this.get(5)]}}(bt.prototype);for(var Rn=function(){this.returnValue=!1},Tn=function(){return this.originalEvent.preventDefault()},Bn=function(){this.cancelBubble=!0},Nn=function(){return this.originalEvent.stopPropagation()},en=function(e){var t=O.doc.documentElement.scrollTop||O.doc.body.scrollTop,s=O.doc.documentElement.scrollLeft||O.doc.body.scrollLeft;return{x:e.clientX+s,y:e.clientY+t}},Mn=O.doc.addEventListener?function(e,t,s,i){var h=function(w){var b=en(w);return s.call(i,w,b.x,b.y)};if(e.addEventListener(t,h,!1),me&&je[t]){var m=function(w){for(var b=en(w),k=w,D=0,se=w.targetTouches&&w.targetTouches.length;D<se;D++)if(w.targetTouches[D].target==e){(w=w.targetTouches[D]).originalEvent=k,w.preventDefault=Tn,w.stopPropagation=Nn;break}return s.call(i,w,b.x,b.y)};e.addEventListener(je[t],m,!1)}return function(){return e.removeEventListener(t,h,!1),me&&je[t]&&e.removeEventListener(je[t],m,!1),!0}}:O.doc.attachEvent?function(e,t,s,i){var h=function(m){m=m||O.win.event;var w=O.doc.documentElement.scrollTop||O.doc.body.scrollTop,b=O.doc.documentElement.scrollLeft||O.doc.body.scrollLeft,k=m.clientX+b,D=m.clientY+w;return m.preventDefault=m.preventDefault||Rn,m.stopPropagation=m.stopPropagation||Bn,s.call(i,m,k,D)};return e.attachEvent("on"+t,h),function(){return e.detachEvent("on"+t,h),!0}}:void 0,vt=[],Ot=function(e){for(var t,s=e.clientX,i=e.clientY,h=O.doc.documentElement.scrollTop||O.doc.body.scrollTop,m=O.doc.documentElement.scrollLeft||O.doc.body.scrollLeft,w=vt.length;w--;){if(t=vt[w],me&&e.touches){for(var b,k=e.touches.length;k--;)if((b=e.touches[k]).identifier==t.el._drag.id){s=b.clientX,i=b.clientY,(e.originalEvent?e.originalEvent:e).preventDefault();break}}else e.preventDefault();var D,se=t.el.node,xe=se.nextSibling,le=se.parentNode,te=se.style.display;O.win.opera&&le.removeChild(se),se.style.display="none",D=t.el.paper.getElementByPoint(s,i),se.style.display=te,O.win.opera&&(xe?le.insertBefore(se,xe):le.appendChild(se)),D&&l("raphael.drag.over."+t.el.id,t.el,D),s+=m,i+=h,l("raphael.drag.move."+t.el.id,t.move_scope||t.el,s-t.el._drag.x,i-t.el._drag.y,s,i,e)}},Ht=function(e){d.unmousemove(Ot).unmouseup(Ht);for(var t,s=vt.length;s--;)(t=vt[s]).el._drag={},l("raphael.drag.end."+t.el.id,t.end_scope||t.start_scope||t.move_scope||t.el,e);vt=[]},Ke=d.el={},tn=Ie.length;tn--;)(function(e){d[e]=Ke[e]=function(t,s){return d.is(t,"function")&&(this.events=this.events||[],this.events.push({name:e,f:t,unbind:Mn(this.shape||this.node||O.doc,e,t,s||this)})),this},d["un"+e]=Ke["un"+e]=function(t){for(var s=this.events||[],i=s.length;i--;)s[i].name!=e||!d.is(t,"undefined")&&s[i].f!=t||(s[i].unbind(),s.splice(i,1),!s.length&&delete this.events);return this}})(Ie[tn]);Ke.data=function(e,t){var s=Re[this.id]=Re[this.id]||{};if(arguments.length==0)return s;if(arguments.length==1){if(d.is(e,"object")){for(var i in e)e[T](i)&&this.data(i,e[i]);return this}return l("raphael.data.get."+this.id,this,s[e],e),s[e]}return s[e]=t,l("raphael.data.set."+this.id,this,t,e),this},Ke.removeData=function(e){return e==null?delete Re[this.id]:Re[this.id]&&delete Re[this.id][e],this},Ke.getData=function(){return n(Re[this.id]||{})},Ke.hover=function(e,t,s,i){return this.mouseover(e,s).mouseout(t,i||s)},Ke.unhover=function(e,t){return this.unmouseover(e).unmouseout(t)};var kt=[];Ke.drag=function(e,t,s,i,h,m){function w(b){(b.originalEvent||b).preventDefault();var k=b.clientX,D=b.clientY,se=O.doc.documentElement.scrollTop||O.doc.body.scrollTop,xe=O.doc.documentElement.scrollLeft||O.doc.body.scrollLeft;if(this._drag.id=b.identifier,me&&b.touches){for(var le,te=b.touches.length;te--;)if(le=b.touches[te],this._drag.id=le.identifier,le.identifier==this._drag.id){k=le.clientX,D=le.clientY;break}}this._drag.x=k+xe,this._drag.y=D+se,!vt.length&&d.mousemove(Ot).mouseup(Ht),vt.push({el:this,move_scope:i,start_scope:h,end_scope:m}),t&&l.on("raphael.drag.start."+this.id,t),e&&l.on("raphael.drag.move."+this.id,e),s&&l.on("raphael.drag.end."+this.id,s),l("raphael.drag.start."+this.id,h||i||this,this._drag.x,this._drag.y,b)}return this._drag={},kt.push({el:this,start:w}),this.mousedown(w),this},Ke.onDragOver=function(e){e?l.on("raphael.drag.over."+this.id,e):l.unbind("raphael.drag.over."+this.id)},Ke.undrag=function(){for(var e=kt.length;e--;)kt[e].el==this&&(this.unmousedown(kt[e].start),kt.splice(e,1),l.unbind("raphael.drag.*."+this.id));!kt.length&&d.unmousemove(Ot).unmouseup(Ht),vt=[]},B.circle=function(e,t,s){var i=d._engine.circle(this,e||0,t||0,s||0);return this.__set__&&this.__set__.push(i),i},B.rect=function(e,t,s,i,h){var m=d._engine.rect(this,e||0,t||0,s||0,i||0,h||0);return this.__set__&&this.__set__.push(m),m},B.ellipse=function(e,t,s,i){var h=d._engine.ellipse(this,e||0,t||0,s||0,i||0);return this.__set__&&this.__set__.push(h),h},B.path=function(e){e&&!d.is(e,"string")&&!d.is(e[0],he)&&(e+=Ce);var t=d._engine.path(d.format[J](d,arguments),this);return this.__set__&&this.__set__.push(t),t},B.image=function(e,t,s,i,h){var m=d._engine.image(this,e||"about:blank",t||0,s||0,i||0,h||0);return this.__set__&&this.__set__.push(m),m},B.text=function(e,t,s){var i=d._engine.text(this,e||0,t||0,ee(s));return this.__set__&&this.__set__.push(i),i},B.set=function(e){!d.is(e,"array")&&(e=Array.prototype.splice.call(arguments,0,arguments.length));var t=new Tt(e);return this.__set__&&this.__set__.push(t),t.paper=this,t.type="set",t},B.setStart=function(e){this.__set__=e||this.set()},B.setFinish=function(e){var t=this.__set__;return delete this.__set__,t},B.getSize=function(){var e=this.canvas.parentNode;return{width:e.offsetWidth,height:e.offsetHeight}},B.setSize=function(e,t){return d._engine.setSize.call(this,e,t)},B.setViewBox=function(e,t,s,i,h){return d._engine.setViewBox.call(this,e,t,s,i,h)},B.top=B.bottom=null,B.raphael=d;function nn(){return this.x+ke+this.y+ke+this.width+" Ã— "+this.height}B.getElementByPoint=function(e,t){var s,i,h,m,w,b,k,D=this.canvas,se=O.doc.elementFromPoint(e,t);if(O.win.opera&&se.tagName=="svg"){var xe=(i=(s=D).getBoundingClientRect(),h=s.ownerDocument,m=h.body,w=h.documentElement,b=w.clientTop||m.clientTop||0,k=w.clientLeft||m.clientLeft||0,{y:i.top+(O.win.pageYOffset||w.scrollTop||m.scrollTop)-b,x:i.left+(O.win.pageXOffset||w.scrollLeft||m.scrollLeft)-k}),le=D.createSVGRect();le.x=e-xe.x,le.y=t-xe.y,le.width=le.height=1;var te=D.getIntersectionList(le,null);te.length&&(se=te[te.length-1])}if(!se)return null;for(;se.parentNode&&se!=D.parentNode&&!se.raphael;)se=se.parentNode;return se==this.canvas.parentNode&&(se=D),se=se&&se.raphael?this.getById(se.raphaelid):null},B.getElementsByBBox=function(e){var t=this.set();return this.forEach(function(s){d.isBBoxIntersect(s.getBBox(),e)&&t.push(s)}),t},B.getById=function(e){for(var t=this.bottom;t;){if(t.id==e)return t;t=t.next}return null},B.forEach=function(e,t){for(var s=this.bottom;s;){if(e.call(t,s)===!1)return this;s=s.next}return this},B.getElementsByPoint=function(e,t){var s=this.set();return this.forEach(function(i){i.isPointInside(e,t)&&s.push(i)}),s},Ke.isPointInside=function(e,t){var s=this.realPath=tt[this.type](this);return this.attr("transform")&&this.attr("transform").length&&(s=d.transformPath(s,this.attr("transform"))),d.isPointInsidePath(s,e,t)},Ke.getBBox=function(e){if(this.removed)return{};var t=this._;return e?(!t.dirty&&t.bboxwt||(this.realPath=tt[this.type](this),t.bboxwt=Ue(this.realPath),t.bboxwt.toString=nn,t.dirty=0),t.bboxwt):((t.dirty||t.dirtyT||!t.bbox)&&(!t.dirty&&this.realPath||(t.bboxwt=0,this.realPath=tt[this.type](this)),t.bbox=Ue(at(this.realPath,this.matrix)),t.bbox.toString=nn,t.dirty=t.dirtyT=0),t.bbox)},Ke.clone=function(){if(this.removed)return null;var e=this.paper[this.type]().attr(this.attr());return this.__set__&&this.__set__.push(e),e},Ke.glow=function(e){if(this.type=="text")return null;var t={width:((e=e||{}).width||10)+(+this.attr("stroke-width")||1),fill:e.fill||!1,opacity:e.opacity==null?.5:e.opacity,offsetx:e.offsetx||0,offsety:e.offsety||0,color:e.color||"#000"},s=t.width/2,i=this.paper,h=i.set(),m=this.realPath||tt[this.type](this);m=this.matrix?at(m,this.matrix):m;for(var w=1;w<s+1;w++)h.push(i.path(m).attr({stroke:t.color,fill:t.fill?t.color:"none","stroke-linejoin":"round","stroke-linecap":"round","stroke-width":+(t.width/s*w).toFixed(3),opacity:+(t.opacity/s).toFixed(3)}));return h.insertBefore(this).translate(t.offsetx,t.offsety)};var $t=function(e,t,s,i,h,m,w,b,k){return k==null?Pe(e,t,s,i,h,m,w,b):d.findDotsAtSegment(e,t,s,i,h,m,w,b,function(D,se,xe,le,te,ue,ve,de,ie){if(!(ie<0||Pe(D,se,xe,le,te,ue,ve,de)<ie)){var Ne,ye=.5,_e=1-ye;for(Ne=Pe(D,se,xe,le,te,ue,ve,de,_e);Ee(Ne-ie)>.01;)Ne=Pe(D,se,xe,le,te,ue,ve,de,_e+=(Ne<ie?1:-1)*(ye/=2));return _e}}(e,t,s,i,h,m,w,b,k))},Vt=function(e,t){return function(s,i,h){for(var m,w,b,k,D,se="",xe={},le=0,te=0,ue=(s=ft(s)).length;te<ue;te++){if((b=s[te])[0]=="M")m=+b[1],w=+b[2];else{if(le+(k=$t(m,w,b[1],b[2],b[3],b[4],b[5],b[6]))>i){if(t&&!xe.start){if(se+=["C"+(D=$t(m,w,b[1],b[2],b[3],b[4],b[5],b[6],i-le)).start.x,D.start.y,D.m.x,D.m.y,D.x,D.y],h)return se;xe.start=se,se=["M"+D.x,D.y+"C"+D.n.x,D.n.y,D.end.x,D.end.y,b[5],b[6]].join(),le+=k,m=+b[5],w=+b[6];continue}if(!e&&!t)return{x:(D=$t(m,w,b[1],b[2],b[3],b[4],b[5],b[6],i-le)).x,y:D.y,alpha:D.alpha}}le+=k,m=+b[5],w=+b[6]}se+=b.shift()+b}return xe.end=se,(D=e?le:t?xe:d.findDotsAtSegment(m,w,b[0],b[1],b[2],b[3],b[4],b[5],1)).alpha&&(D={x:D.x,y:D.y,alpha:D.alpha}),D}},rn=Vt(1),sn=Vt(),Ut=Vt(0,1);d.getTotalLength=rn,d.getPointAtLength=sn,d.getSubpath=function(e,t,s){if(this.getTotalLength(e)-s<1e-6)return Ut(e,t).end;var i=Ut(e,s,1);return t?Ut(i,t).end:i},Ke.getTotalLength=function(){var e=this.getPath();if(e)return this.node.getTotalLength?this.node.getTotalLength():rn(e)},Ke.getPointAtLength=function(e){var t=this.getPath();if(t)return sn(t,e)},Ke.getPath=function(){var e,t=d._getPath[this.type];if(this.type!="text"&&this.type!="set")return t&&(e=t(this)),e},Ke.getSubpath=function(e,t){var s=this.getPath();if(s)return d.getSubpath(s,e,t)};var dt=d.easing_formulas={linear:function(e){return e},"<":function(e){return Be(e,1.7)},">":function(e){return Be(e,.48)},"<>":function(e){var t=.48-e/1.04,s=Se.sqrt(.1734+t*t),i=s-t,h=-s-t,m=Be(Ee(i),1/3)*(i<0?-1:1)+Be(Ee(h),1/3)*(h<0?-1:1)+.5;return 3*(1-m)*m*m+m*m*m},backIn:function(e){var t=1.70158;return e*e*((t+1)*e-t)},backOut:function(e){var t=1.70158;return(e-=1)*e*((t+1)*e+t)+1},elastic:function(e){return e==!!e?e:Be(2,-10*e)*Se.sin(2*ce*(e-.075)/.3)+1},bounce:function(e){var t=7.5625,s=2.75;return e<1/s?t*e*e:e<2/s?t*(e-=1.5/s)*e+.75:e<2.5/s?t*(e-=2.25/s)*e+.9375:t*(e-=2.625/s)*e+.984375}};dt.easeIn=dt["ease-in"]=dt["<"],dt.easeOut=dt["ease-out"]=dt[">"],dt.easeInOut=dt["ease-in-out"]=dt["<>"],dt["back-in"]=dt.backIn,dt["back-out"]=dt.backOut;var Je=[],an=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){setTimeout(e,16)},jt=function(){for(var e=+new Date,t=0;t<Je.length;t++){var s=Je[t];if(!s.el.removed&&!s.paused){var i,h,m=e-s.start,w=s.ms,b=s.easing,k=s.from,D=s.diff,se=s.to,xe=(s.t,s.el),le={},te={};if(s.initstatus?(m=(s.initstatus*s.anim.top-s.prev)/(s.percent-s.prev)*w,s.status=s.initstatus,delete s.initstatus,s.stop&&Je.splice(t--,1)):s.status=(s.prev+(s.percent-s.prev)*(m/w))/s.anim.top,!(m<0))if(m<w){var ue=b(m/w);for(var ve in k)if(k[T](ve)){switch(j[ve]){case Z:i=+k[ve]+ue*w*D[ve];break;case"colour":i="rgb("+[Gt(g(k[ve].r+ue*w*D[ve].r)),Gt(g(k[ve].g+ue*w*D[ve].g)),Gt(g(k[ve].b+ue*w*D[ve].b))].join(",")+")";break;case"path":i=[];for(var de=0,ie=k[ve].length;de<ie;de++){i[de]=[k[ve][de][0]];for(var Ne=1,ye=k[ve][de].length;Ne<ye;Ne++)i[de][Ne]=+k[ve][de][Ne]+ue*w*D[ve][de][Ne];i[de]=i[de].join(ke)}i=i.join(ke);break;case"transform":if(D[ve].real)for(i=[],de=0,ie=k[ve].length;de<ie;de++)for(i[de]=[k[ve][de][0]],Ne=1,ye=k[ve][de].length;Ne<ye;Ne++)i[de][Ne]=k[ve][de][Ne]+ue*w*D[ve][de][Ne];else{var _e=function(Xe){return+k[ve][Xe]+ue*w*D[ve][Xe]};i=[["m",_e(0),_e(1),_e(2),_e(3),_e(4),_e(5)]]}break;case"csv":if(ve=="clip-rect")for(i=[],de=4;de--;)i[de]=+k[ve][de]+ue*w*D[ve][de];break;default:var be=[][Y](k[ve]);for(i=[],de=xe.paper.customAttributes[ve].length;de--;)i[de]=+be[de]+ue*w*D[ve][de]}le[ve]=i}xe.attr(le),function(Xe,$e,We){setTimeout(function(){l("raphael.anim.frame."+Xe,$e,We)})}(xe.id,xe,s.anim)}else{if(function(Xe,$e,We){setTimeout(function(){l("raphael.anim.frame."+$e.id,$e,We),l("raphael.anim.finish."+$e.id,$e,We),d.is(Xe,"function")&&Xe.call($e)})}(s.callback,xe,s.anim),xe.attr(se),Je.splice(t--,1),s.repeat>1&&!s.next){for(h in se)se[T](h)&&(te[h]=s.totalOrigin[h]);s.el.attr(te),Rt(s.anim,s.el,s.anim.percents[0],null,s.totalOrigin,s.repeat-1)}s.next&&!s.stop&&Rt(s.anim,s.el,s.next,null,s.totalOrigin,s.repeat)}}}Je.length&&an(jt)},Gt=function(e){return e>255?255:e<0?0:e};function In(e,t,s,i,h,m){var w=3*t,b=3*(i-t)-w,k=1-w-b,D=3*s,se=3*(h-s)-D,xe=1-D-se;function le(te){return((k*te+b)*te+w)*te}return function(te,ue){var ve=function(de,ie){var Ne,ye,_e,be,Xe,$e;for(_e=de,$e=0;$e<8;$e++){if(be=le(_e)-de,Ee(be)<ie)return _e;if(Ee(Xe=(3*k*_e+2*b)*_e+w)<1e-6)break;_e-=be/Xe}if(ye=1,(_e=de)<(Ne=0))return Ne;if(_e>ye)return ye;for(;Ne<ye;){if(be=le(_e),Ee(be-de)<ie)return _e;de>be?Ne=_e:ye=_e,_e=(ye-Ne)/2+Ne}return _e}(te,ue);return((xe*ve+se)*ve+D)*ve}(e,1/(200*m))}function mt(e,t){var s=[],i={};if(this.ms=t,this.times=1,e){for(var h in e)e[T](h)&&(i[S(h)]=e[h],s.push(S(h)));s.sort(Ve)}this.anim=i,this.top=s[s.length-1],this.percents=s}function Rt(e,t,s,i,h,m){s=S(s);var w,b,k,D,se,xe,le=e.ms,te={},ue={},ve={};if(i)for(ie=0,Ne=Je.length;ie<Ne;ie++){var de=Je[ie];if(de.el.id==t.id&&de.anim==e){de.percent!=s?(Je.splice(ie,1),k=1):b=de,t.attr(de.totalOrigin);break}}else i=+ue;for(var ie=0,Ne=e.percents.length;ie<Ne;ie++){if(e.percents[ie]==s||e.percents[ie]>i*e.top){s=e.percents[ie],se=e.percents[ie-1]||0,le=le/e.top*(s-se),D=e.percents[ie+1],w=e.anim[s];break}i&&t.attr(e.anim[e.percents[ie]])}if(w){if(b)b.initstatus=i,b.start=new Date-b.ms*i;else{for(var ye in w)if(w[T](ye)&&(j[T](ye)||t.paper.customAttributes[T](ye)))switch(te[ye]=t.attr(ye),te[ye]==null&&(te[ye]=re[ye]),ue[ye]=w[ye],j[ye]){case Z:ve[ye]=(ue[ye]-te[ye])/le;break;case"colour":te[ye]=d.getRGB(te[ye]);var _e=d.getRGB(ue[ye]);ve[ye]={r:(_e.r-te[ye].r)/le,g:(_e.g-te[ye].g)/le,b:(_e.b-te[ye].b)/le};break;case"path":var be=ft(te[ye],ue[ye]),Xe=be[1];for(te[ye]=be[0],ve[ye]=[],ie=0,Ne=te[ye].length;ie<Ne;ie++){ve[ye][ie]=[0];for(var $e=1,We=te[ye][ie].length;$e<We;$e++)ve[ye][ie][$e]=(Xe[ie][$e]-te[ye][ie][$e])/le}break;case"transform":var St=t._,Bt=Ln(St[ye],ue[ye]);if(Bt)for(te[ye]=Bt.from,ue[ye]=Bt.to,ve[ye]=[],ve[ye].real=!0,ie=0,Ne=te[ye].length;ie<Ne;ie++)for(ve[ye][ie]=[te[ye][ie][0]],$e=1,We=te[ye][ie].length;$e<We;$e++)ve[ye][ie][$e]=(ue[ye][ie][$e]-te[ye][ie][$e])/le;else{var ht=t.matrix||new bt,pt={_:{transform:St.transform},getBBox:function(){return t.getBBox(1)}};te[ye]=[ht.a,ht.b,ht.c,ht.d,ht.e,ht.f],Kt(pt,ue[ye]),ue[ye]=pt._.transform,ve[ye]=[(pt.matrix.a-ht.a)/le,(pt.matrix.b-ht.b)/le,(pt.matrix.c-ht.c)/le,(pt.matrix.d-ht.d)/le,(pt.matrix.e-ht.e)/le,(pt.matrix.f-ht.f)/le]}break;case"csv":var At=ee(w[ye])[Ae](W),Pt=ee(te[ye])[Ae](W);if(ye=="clip-rect")for(te[ye]=Pt,ve[ye]=[],ie=Pt.length;ie--;)ve[ye][ie]=(At[ie]-te[ye][ie])/le;ue[ye]=At;break;default:for(At=[][Y](w[ye]),Pt=[][Y](te[ye]),ve[ye]=[],ie=t.paper.customAttributes[ye].length;ie--;)ve[ye][ie]=((At[ie]||0)-(Pt[ie]||0))/le}var It=w.easing,gt=d.easing_formulas[It];if(!gt)if((gt=ee(It).match(c))&&gt.length==5){var Ct=gt;gt=function(Dt){return In(Dt,+Ct[1],+Ct[2],+Ct[3],+Ct[4],le)}}else gt=Ye;if(de={anim:e,percent:s,timestamp:xe=w.start||e.start||+new Date,start:xe+(e.del||0),status:0,initstatus:i||0,stop:!1,ms:le,easing:gt,from:te,diff:ve,to:ue,el:t,callback:w.callback,prev:se,next:D,repeat:m||e.times,origin:t.attr(),totalOrigin:h},Je.push(de),i&&!b&&!k&&(de.stop=!0,de.start=new Date-le*i,Je.length==1))return jt();k&&(de.start=new Date-de.ms*i),Je.length==1&&an(jt)}l("raphael.anim.start."+t.id,t,e)}}function on(e){for(var t=0;t<Je.length;t++)Je[t].el.paper==e&&Je.splice(t--,1)}Ke.animateWith=function(e,t,s,i,h,m){if(this.removed)return m&&m.call(this),this;var w=s instanceof mt?s:d.animation(s,i,h,m);Rt(w,this,w.percents[0],null,this.attr());for(var b=0,k=Je.length;b<k;b++)if(Je[b].anim==t&&Je[b].el==e){Je[k-1].start=Je[b].start;break}return this},Ke.onAnimation=function(e){return e?l.on("raphael.anim.frame."+this.id,e):l.unbind("raphael.anim.frame."+this.id),this},mt.prototype.delay=function(e){var t=new mt(this.anim,this.ms);return t.times=this.times,t.del=+e||0,t},mt.prototype.repeat=function(e){var t=new mt(this.anim,this.ms);return t.del=this.del,t.times=Se.floor(ze(e,0))||1,t},d.animation=function(e,t,s,i){if(e instanceof mt)return e;!d.is(s,"function")&&s||(i=i||s||null,s=null),e=Object(e),t=+t||0;var h,m,w={};for(m in e)e[T](m)&&S(m)!=m&&S(m)+"%"!=m&&(h=!0,w[m]=e[m]);if(h)return s&&(w.easing=s),i&&(w.callback=i),new mt({100:w},t);if(i){var b=0;for(var k in e){var D=N(k);e[T](k)&&D>b&&(b=D)}!e[b+="%"].callback&&(e[b].callback=i)}return new mt(e,t)},Ke.animate=function(e,t,s,i){if(this.removed)return i&&i.call(this),this;var h=e instanceof mt?e:d.animation(e,t,s,i);return Rt(h,this,h.percents[0],null,this.attr()),this},Ke.setTime=function(e,t){return e&&t!=null&&this.status(e,ne(t,e.ms)/e.ms),this},Ke.status=function(e,t){var s,i,h=[],m=0;if(t!=null)return Rt(e,this,-1,ne(t,1)),this;for(s=Je.length;m<s;m++)if((i=Je[m]).el.id==this.id&&(!e||i.anim==e)){if(e)return i.status;h.push({anim:i.anim,status:i.status})}return e?0:h},Ke.pause=function(e){for(var t=0;t<Je.length;t++)Je[t].el.id!=this.id||e&&Je[t].anim!=e||l("raphael.anim.pause."+this.id,this,Je[t].anim)!==!1&&(Je[t].paused=!0);return this},Ke.resume=function(e){for(var t=0;t<Je.length;t++)if(Je[t].el.id==this.id&&(!e||Je[t].anim==e)){var s=Je[t];l("raphael.anim.resume."+this.id,this,s.anim)!==!1&&(delete s.paused,this.status(s.anim,s.status))}return this},Ke.stop=function(e){for(var t=0;t<Je.length;t++)Je[t].el.id!=this.id||e&&Je[t].anim!=e||l("raphael.anim.stop."+this.id,this,Je[t].anim)!==!1&&Je.splice(t--,1);return this},l.on("raphael.remove",on),l.on("raphael.clear",on),Ke.toString=function(){return"RaphaÃ«lâ€™s object"};var ln,cn,wt,un,Tt=function(e){if(this.items=[],this.length=0,this.type="set",e)for(var t=0,s=e.length;t<s;t++)!e[t]||e[t].constructor!=Ke.constructor&&e[t].constructor!=Tt||(this[this.items.length]=this.items[this.items.length]=e[t],this.length++)},ct=Tt.prototype;for(var Xt in ct.push=function(){for(var e,t,s=0,i=arguments.length;s<i;s++)!(e=arguments[s])||e.constructor!=Ke.constructor&&e.constructor!=Tt||(this[t=this.items.length]=this.items[t]=e,this.length++);return this},ct.pop=function(){return this.length&&delete this[this.length--],this.items.pop()},ct.forEach=function(e,t){for(var s=0,i=this.items.length;s<i;s++)if(e.call(t,this.items[s],s)===!1)return this;return this},Ke)Ke[T](Xt)&&(ct[Xt]=function(e){return function(){var t=arguments;return this.forEach(function(s){s[e][J](s,t)})}}(Xt));return ct.attr=function(e,t){if(e&&d.is(e,he)&&d.is(e[0],"object"))for(var s=0,i=e.length;s<i;s++)this.items[s].attr(e[s]);else for(var h=0,m=this.items.length;h<m;h++)this.items[h].attr(e,t);return this},ct.clear=function(){for(;this.length;)this.pop()},ct.splice=function(e,t,s){e=e<0?ze(this.length+e,0):e,t=ze(0,ne(this.length-e,t));var i,h=[],m=[],w=[];for(i=2;i<arguments.length;i++)w.push(arguments[i]);for(i=0;i<t;i++)m.push(this[e+i]);for(;i<this.length-e;i++)h.push(this[e+i]);var b=w.length;for(i=0;i<b+h.length;i++)this.items[e+i]=this[e+i]=i<b?w[i]:h[i-b];for(i=this.items.length=this.length-=t-b;this[i];)delete this[i++];return new Tt(m)},ct.exclude=function(e){for(var t=0,s=this.length;t<s;t++)if(this[t]==e)return this.splice(t,1),!0},ct.animate=function(e,t,s,i){(d.is(s,"function")||!s)&&(i=s||null);var h,m,w=this.items.length,b=w,k=this;if(!w)return this;i&&(m=function(){!--w&&i.call(k)}),s=d.is(s,"string")?s:m;var D=d.animation(e,t,s,m);for(h=this.items[--b].animate(D);b--;)this.items[b]&&!this.items[b].removed&&this.items[b].animateWith(h,D,D),this.items[b]&&!this.items[b].removed||w--;return this},ct.insertAfter=function(e){for(var t=this.items.length;t--;)this.items[t].insertAfter(e);return this},ct.getBBox=function(){for(var e=[],t=[],s=[],i=[],h=this.items.length;h--;)if(!this.items[h].removed){var m=this.items[h].getBBox();e.push(m.x),t.push(m.y),s.push(m.x+m.width),i.push(m.y+m.height)}return{x:e=ne[J](0,e),y:t=ne[J](0,t),x2:s=ze[J](0,s),y2:i=ze[J](0,i),width:s-e,height:i-t}},ct.clone=function(e){e=this.paper.set();for(var t=0,s=this.items.length;t<s;t++)e.push(this.items[t].clone());return e},ct.toString=function(){return"RaphaÃ«lâ€˜s set"},ct.glow=function(e){var t=this.paper.set();return this.forEach(function(s,i){var h=s.glow(e);h!=null&&h.forEach(function(m,w){t.push(m)})}),t},ct.isPointInside=function(e,t){var s=!1;return this.forEach(function(i){if(i.isPointInside(e,t))return s=!0,!1}),s},d.registerFont=function(e){if(!e.face)return e;this.fonts=this.fonts||{};var t={w:e.w,face:{},glyphs:{}},s=e.face["font-family"];for(var i in e.face)e.face[T](i)&&(t.face[i]=e.face[i]);if(this.fonts[s]?this.fonts[s].push(t):this.fonts[s]=[t],!e.svg){for(var h in t.face["units-per-em"]=N(e.face["units-per-em"],10),e.glyphs)if(e.glyphs[T](h)){var m=e.glyphs[h];if(t.glyphs[h]={w:m.w,k:{},d:m.d&&"M"+m.d.replace(/[mlcxtrv]/g,function(b){return{l:"L",c:"C",x:"z",t:"m",r:"l",v:"c"}[b]||"M"})+"z"},m.k)for(var w in m.k)m[T](w)&&(t.glyphs[h].k[w]=m.k[w])}}return e},B.getFont=function(e,t,s,i){if(i=i||"normal",s=s||"normal",t=+t||{normal:400,bold:700,lighter:300,bolder:800}[t]||400,d.fonts){var h,m=d.fonts[e];if(!m){var w=new RegExp("(^|\\s)"+e.replace(/[^\w\d\s+!~.:_-]/g,Ce)+"(\\s|$)","i");for(var b in d.fonts)if(d.fonts[T](b)&&w.test(b)){m=d.fonts[b];break}}if(m)for(var k=0,D=m.length;k<D&&((h=m[k]).face["font-weight"]!=t||h.face["font-style"]!=s&&h.face["font-style"]||h.face["font-stretch"]!=i);k++);return h}},B.print=function(e,t,s,i,h,m,w,b){m=m||"middle",w=ze(ne(w||0,1),-1),b=ze(ne(b||1,3),1);var k,D=ee(s)[Ae](Ce),se=0,xe=0,le=Ce;if(d.is(i,"string")&&(i=this.getFont(i)),i){k=(h||16)/i.face["units-per-em"];for(var te=i.face.bbox[Ae](W),ue=+te[0],ve=te[3]-te[1],de=0,ie=+te[1]+(m=="baseline"?ve+ +i.face.descent:ve/2),Ne=0,ye=D.length;Ne<ye;Ne++){if(D[Ne]==`
`)se=0,be=0,xe=0,de+=ve*b;else{var _e=xe&&i.glyphs[D[Ne-1]]||{},be=i.glyphs[D[Ne]];se+=xe?(_e.w||i.w)+(_e.k&&_e.k[D[Ne]]||0)+i.w*w:0,xe=1}be&&be.d&&(le+=d.transformPath(be.d,["t",se*k,de*k,"s",k,k,ue,ie,"t",(e-ue)/k,(t-ie)/k]))}}return this.path(le).attr({fill:"#000",stroke:"none"})},B.add=function(e){if(d.is(e,"array"))for(var t,s=this.set(),i=0,h=e.length;i<h;i++)t=e[i]||{},U[T](t.type)&&s.push(this[t.type]().attr(t));return s},d.format=function(e,t){var s=d.is(t,he)?[0][Y](t):arguments;return e&&d.is(e,"string")&&s.length-1&&(e=e.replace(F,function(i,h){return s[++h]==null?Ce:s[h]})),e||Ce},d.fullfill=(ln=/\{([^\}]+)\}/g,cn=/(?:(?:^|\.)(.+?)(?=\[|\.|$|\()|\[('|")(.+?)\2\])(\(\))?/g,function(e,t){return String(e).replace(ln,function(s,i){return function(h,m,w){var b=w;return m.replace(cn,function(k,D,se,xe,le){D=D||xe,b&&(D in b&&(b=b[D]),typeof b=="function"&&le&&(b=b()))}),b=(b==null||b==w?h:b)+""}(s,i,t)})}),d.ninja=function(){if(K.was)O.win.Raphael=K.is;else{window.Raphael=void 0;try{delete window.Raphael}catch(e){}}return d},d.st=ct,l.on("raphael.DOMload",function(){x=!0}),(wt=document).readyState==null&&wt.addEventListener&&(wt.addEventListener("DOMContentLoaded",un=function(){wt.removeEventListener("DOMContentLoaded",un,!1),wt.readyState="complete"},!1),wt.readyState="loading"),function e(){/in/.test(wt.readyState)?setTimeout(e,9):d.eve("raphael.DOMload")}(),d}.apply(G,V))===void 0||(M.exports=I)},function(M,G,X){var V,I;V=[X(0),X(3),X(4)],(I=function(l){return l}.apply(G,V))===void 0||(M.exports=I)},function(M,G,X){var V,I,l,d,x,B,W,U,F,T,O,K,fe,J;d="hasOwnProperty",x=/[\.\/]/,B=/\s*,\s*/,W=function(Y,me){return Y-me},U={n:{}},F=function(){for(var Y=0,me=this.length;Y<me;Y++)if(this[Y]!==void 0)return this[Y]},T=function(){for(var Y=this.length;--Y;)if(this[Y]!==void 0)return this[Y]},O=Object.prototype.toString,K=String,fe=Array.isArray||function(Y){return Y instanceof Array||O.call(Y)=="[object Array]"},(J=function(Y,me){var Ce,ke=l,ee=Array.prototype.slice.call(arguments,2),Ae=J.listeners(Y),Ie=0,je=[],qe={},Se=[],ze=I;Se.firstDefined=F,Se.lastDefined=T,I=Y,l=0;for(var ne=0,Ee=Ae.length;ne<Ee;ne++)"zIndex"in Ae[ne]&&(je.push(Ae[ne].zIndex),Ae[ne].zIndex<0&&(qe[Ae[ne].zIndex]=Ae[ne]));for(je.sort(W);je[Ie]<0;)if(Ce=qe[je[Ie++]],Se.push(Ce.apply(me,ee)),l)return l=ke,Se;for(ne=0;ne<Ee;ne++)if("zIndex"in(Ce=Ae[ne]))if(Ce.zIndex==je[Ie]){if(Se.push(Ce.apply(me,ee)),l)break;do if((Ce=qe[je[++Ie]])&&Se.push(Ce.apply(me,ee)),l)break;while(Ce)}else qe[Ce.zIndex]=Ce;else if(Se.push(Ce.apply(me,ee)),l)break;return l=ke,I=ze,Se})._events=U,J.listeners=function(Y){var me,Ce,ke,ee,Ae,Ie,je,qe,Se=fe(Y)?Y:Y.split(x),ze=U,ne=[ze],Ee=[];for(ee=0,Ae=Se.length;ee<Ae;ee++){for(qe=[],Ie=0,je=ne.length;Ie<je;Ie++)for(Ce=[(ze=ne[Ie].n)[Se[ee]],ze["*"]],ke=2;ke--;)(me=Ce[ke])&&(qe.push(me),Ee=Ee.concat(me.f||[]));ne=qe}return Ee},J.separator=function(Y){Y?(Y="["+(Y=K(Y).replace(/(?=[\.\^\]\[\-])/g,"\\"))+"]",x=new RegExp(Y)):x=/[\.\/]/},J.on=function(Y,me){if(typeof me!="function")return function(){};for(var Ce=fe(Y)?fe(Y[0])?Y:[Y]:K(Y).split(B),ke=0,ee=Ce.length;ke<ee;ke++)(function(Ae){for(var Ie,je=fe(Ae)?Ae:K(Ae).split(x),qe=U,Se=0,ze=je.length;Se<ze;Se++)qe=(qe=qe.n).hasOwnProperty(je[Se])&&qe[je[Se]]||(qe[je[Se]]={n:{}});for(qe.f=qe.f||[],Se=0,ze=qe.f.length;Se<ze;Se++)if(qe.f[Se]==me){Ie=!0;break}!Ie&&qe.f.push(me)})(Ce[ke]);return function(Ae){+Ae==+Ae&&(me.zIndex=+Ae)}},J.f=function(Y){var me=[].slice.call(arguments,1);return function(){J.apply(null,[Y,null].concat(me).concat([].slice.call(arguments,0)))}},J.stop=function(){l=1},J.nt=function(Y){var me=fe(I)?I.join("."):I;return Y?new RegExp("(?:\\.|\\/|^)"+Y+"(?:\\.|\\/|$)").test(me):me},J.nts=function(){return fe(I)?I:I.split(x)},J.off=J.unbind=function(Y,me){if(Y){var Ce=fe(Y)?fe(Y[0])?Y:[Y]:K(Y).split(B);if(Ce.length>1)for(var ke=0,ee=Ce.length;ke<ee;ke++)J.off(Ce[ke],me);else{Ce=fe(Y)?Y:K(Y).split(x);var Ae,Ie,je,qe,Se,ze=[U];for(ke=0,ee=Ce.length;ke<ee;ke++)for(qe=0;qe<ze.length;qe+=je.length-2){if(je=[qe,1],Ae=ze[qe].n,Ce[ke]!="*")Ae[Ce[ke]]&&je.push(Ae[Ce[ke]]);else for(Ie in Ae)Ae[d](Ie)&&je.push(Ae[Ie]);ze.splice.apply(ze,je)}for(ke=0,ee=ze.length;ke<ee;ke++)for(Ae=ze[ke];Ae.n;){if(me){if(Ae.f){for(qe=0,Se=Ae.f.length;qe<Se;qe++)if(Ae.f[qe]==me){Ae.f.splice(qe,1);break}!Ae.f.length&&delete Ae.f}for(Ie in Ae.n)if(Ae.n[d](Ie)&&Ae.n[Ie].f){var ne=Ae.n[Ie].f;for(qe=0,Se=ne.length;qe<Se;qe++)if(ne[qe]==me){ne.splice(qe,1);break}!ne.length&&delete Ae.n[Ie].f}}else for(Ie in delete Ae.f,Ae.n)Ae.n[d](Ie)&&Ae.n[Ie].f&&delete Ae.n[Ie].f;Ae=Ae.n}}}else J._events=U={n:{}}},J.once=function(Y,me){var Ce=function(){return J.off(Y,Ce),me.apply(this,arguments)};return J.on(Y,Ce)},J.version="0.5.0",J.toString=function(){return"You are running Eve 0.5.0"},M.exports?M.exports=J:(V=function(){return J}.apply(G,[]))===void 0||(M.exports=V)},function(M,G,X){var V,I;V=[X(0)],(I=function(l){if(!l||l.svg){var d="hasOwnProperty",x=String,B=parseFloat,W=parseInt,U=Math,F=U.max,T=U.abs,O=U.pow,K=/[, ]+/,fe=l.eve,J="",Y=" ",me="http://www.w3.org/1999/xlink",Ce={block:"M5,0 0,2.5 5,5z",classic:"M5,0 0,2.5 5,5 3.5,3 3.5,2z",diamond:"M2.5,0 5,2.5 2.5,5 0,2.5z",open:"M6,1 1,3.5 6,6",oval:"M2.5,0A2.5,2.5,0,0,1,2.5,5 2.5,2.5,0,0,1,2.5,0z"},ke={};l.toString=function(){return`Your browser supports SVG.
You are running RaphaÃ«l `+this.version};var ee=function(f,u){if(u)for(var c in typeof f=="string"&&(f=ee(f)),u)u[d](c)&&(c.substring(0,6)=="xlink:"?f.setAttributeNS(me,c.substring(6),x(u[c])):f.setAttribute(c,x(u[c])));else(f=l._g.doc.createElementNS("http://www.w3.org/2000/svg",f)).style&&(f.style.webkitTapHighlightColor="rgba(0,0,0,0)");return f},Ae=function(f,u){var c="linear",g=f.id+u,S=.5,N=.5,$=f.node,re=f.paper,j=$.style,ae=l._g.doc.getElementById(g);if(!ae){if(u=(u=x(u).replace(l._radial_gradient,function(Ve,Ye,Oe){if(c="radial",Ye&&Oe){S=B(Ye);var Ze=2*((N=B(Oe))>.5)-1;O(S-.5,2)+O(N-.5,2)>.25&&(N=U.sqrt(.25-O(S-.5,2))*Ze+.5)&&N!=.5&&(N=N.toFixed(5)-1e-5*Ze)}return J})).split(/\s*\-\s*/),c=="linear"){var pe=u.shift();if(pe=-B(pe),isNaN(pe))return null;var ge=[0,0,U.cos(l.rad(pe)),U.sin(l.rad(pe))],R=1/(F(T(ge[2]),T(ge[3]))||1);ge[2]*=R,ge[3]*=R,ge[2]<0&&(ge[0]=-ge[2],ge[2]=0),ge[3]<0&&(ge[1]=-ge[3],ge[3]=0)}var Le=l._parseDots(u);if(!Le)return null;if(g=g.replace(/[\(\)\s,\xb0#]/g,"_"),f.gradient&&g!=f.gradient.id&&(re.defs.removeChild(f.gradient),delete f.gradient),!f.gradient){ae=ee(c+"Gradient",{id:g}),f.gradient=ae,ee(ae,c=="radial"?{fx:S,fy:N}:{x1:ge[0],y1:ge[1],x2:ge[2],y2:ge[3],gradientTransform:f.matrix.invert()}),re.defs.appendChild(ae);for(var E=0,Re=Le.length;E<Re;E++)ae.appendChild(ee("stop",{offset:Le[E].offset?Le[E].offset:E?"100%":"0%","stop-color":Le[E].color||"#fff","stop-opacity":isFinite(Le[E].opacity)?Le[E].opacity:1}))}}return ee($,{fill:Ie(g),opacity:1,"fill-opacity":1}),j.fill=J,j.opacity=1,j.fillOpacity=1,1},Ie=function(f){if((u=document.documentMode)&&(u===9||u===10))return"url('#"+f+"')";var u,c=document.location;return"url('"+(c.protocol+"//"+c.host+c.pathname+c.search)+"#"+f+"')"},je=function(f){var u=f.getBBox(1);ee(f.pattern,{patternTransform:f.matrix.invert()+" translate("+u.x+","+u.y+")"})},qe=function(f,u,c){if(f.type=="path"){for(var g,S,N,$,re,j=x(u).toLowerCase().split("-"),ae=f.paper,pe=c?"end":"start",ge=f.node,R=f.attrs,Le=R["stroke-width"],E=j.length,Re="classic",Ve=3,Ye=3,Oe=5;E--;)switch(j[E]){case"block":case"classic":case"oval":case"diamond":case"open":case"none":Re=j[E];break;case"wide":Ye=5;break;case"narrow":Ye=2;break;case"long":Ve=5;break;case"short":Ve=2}if(Re=="open"?(Ve+=2,Ye+=2,Oe+=2,N=1,$=c?4:1,re={fill:"none",stroke:R.stroke}):($=N=Ve/2,re={fill:R.stroke,stroke:"none"}),f._.arrows?c?(f._.arrows.endPath&&ke[f._.arrows.endPath]--,f._.arrows.endMarker&&ke[f._.arrows.endMarker]--):(f._.arrows.startPath&&ke[f._.arrows.startPath]--,f._.arrows.startMarker&&ke[f._.arrows.startMarker]--):f._.arrows={},Re!="none"){var Ze="raphael-marker-"+Re,tt="raphael-marker-"+pe+Re+Ve+Ye+"-obj"+f.id;l._g.doc.getElementById(Ze)?ke[Ze]++:(ae.defs.appendChild(ee(ee("path"),{"stroke-linecap":"round",d:Ce[Re],id:Ze})),ke[Ze]=1);var at,Qe=l._g.doc.getElementById(tt);Qe?(ke[tt]++,at=Qe.getElementsByTagName("use")[0]):(Qe=ee(ee("marker"),{id:tt,markerHeight:Ye,markerWidth:Ve,orient:"auto",refX:$,refY:Ye/2}),at=ee(ee("use"),{"xlink:href":"#"+Ze,transform:(c?"rotate(180 "+Ve/2+" "+Ye/2+") ":J)+"scale("+Ve/Oe+","+Ye/Oe+")","stroke-width":(1/((Ve/Oe+Ye/Oe)/2)).toFixed(4)}),Qe.appendChild(at),ae.defs.appendChild(Qe),ke[tt]=1),ee(at,re);var ut=N*(Re!="diamond"&&Re!="oval");c?(g=f._.arrows.startdx*Le||0,S=l.getTotalLength(R.path)-ut*Le):(g=ut*Le,S=l.getTotalLength(R.path)-(f._.arrows.enddx*Le||0)),(re={})["marker-"+pe]="url(#"+tt+")",(S||g)&&(re.d=l.getSubpath(R.path,g,S)),ee(ge,re),f._.arrows[pe+"Path"]=Ze,f._.arrows[pe+"Marker"]=tt,f._.arrows[pe+"dx"]=ut,f._.arrows[pe+"Type"]=Re,f._.arrows[pe+"String"]=u}else c?(g=f._.arrows.startdx*Le||0,S=l.getTotalLength(R.path)-g):(g=0,S=l.getTotalLength(R.path)-(f._.arrows.enddx*Le||0)),f._.arrows[pe+"Path"]&&ee(ge,{d:l.getSubpath(R.path,g,S)}),delete f._.arrows[pe+"Path"],delete f._.arrows[pe+"Marker"],delete f._.arrows[pe+"dx"],delete f._.arrows[pe+"Type"],delete f._.arrows[pe+"String"];for(re in ke)if(ke[d](re)&&!ke[re]){var n=l._g.doc.getElementById(re);n&&n.parentNode.removeChild(n)}}},Se={"-":[3,1],".":[1,1],"-.":[3,1,1,1],"-..":[3,1,1,1,1,1],". ":[1,3],"- ":[4,3],"--":[8,3],"- .":[4,3,1,3],"--.":[8,3,1,3],"--..":[8,3,1,3,1,3]},ze=function(f,u,c){if(u=Se[x(u).toLowerCase()]){for(var g=f.attrs["stroke-width"]||"1",S={round:g,square:g,butt:0}[f.attrs["stroke-linecap"]||c["stroke-linecap"]]||0,N=[],$=u.length;$--;)N[$]=u[$]*g+($%2?1:-1)*S;ee(f.node,{"stroke-dasharray":N.join(",")})}else ee(f.node,{"stroke-dasharray":"none"})},ne=function(f,u){var c=f.node,g=f.attrs,S=c.style.visibility;for(var N in c.style.visibility="hidden",u)if(u[d](N)){if(!l._availableAttrs[d](N))continue;var $=u[N];switch(g[N]=$,N){case"blur":f.blur($);break;case"title":var re=c.getElementsByTagName("title");if(re.length&&(re=re[0]))re.firstChild.nodeValue=$;else{re=ee("title");var j=l._g.doc.createTextNode($);re.appendChild(j),c.appendChild(re)}break;case"href":case"target":var ae=c.parentNode;if(ae.tagName.toLowerCase()!="a"){var pe=ee("a");ae.insertBefore(pe,c),pe.appendChild(c),ae=pe}N=="target"?ae.setAttributeNS(me,"show",$=="blank"?"new":$):ae.setAttributeNS(me,N,$);break;case"cursor":c.style.cursor=$;break;case"transform":f.transform($);break;case"arrow-start":qe(f,$);break;case"arrow-end":qe(f,$,1);break;case"clip-rect":var ge=x($).split(K);if(ge.length==4){f.clip&&f.clip.parentNode.parentNode.removeChild(f.clip.parentNode);var R=ee("clipPath"),Le=ee("rect");R.id=l.createUUID(),ee(Le,{x:ge[0],y:ge[1],width:ge[2],height:ge[3]}),R.appendChild(Le),f.paper.defs.appendChild(R),ee(c,{"clip-path":"url(#"+R.id+")"}),f.clip=Le}if(!$){var E=c.getAttribute("clip-path");if(E){var Re=l._g.doc.getElementById(E.replace(/(^url\(#|\)$)/g,J));Re&&Re.parentNode.removeChild(Re),ee(c,{"clip-path":J}),delete f.clip}}break;case"path":f.type=="path"&&(ee(c,{d:$?g.path=l._pathToAbsolute($):"M0,0"}),f._.dirty=1,f._.arrows&&("startString"in f._.arrows&&qe(f,f._.arrows.startString),"endString"in f._.arrows&&qe(f,f._.arrows.endString,1)));break;case"width":if(c.setAttribute(N,$),f._.dirty=1,!g.fx)break;N="x",$=g.x;case"x":g.fx&&($=-g.x-(g.width||0));case"rx":if(N=="rx"&&f.type=="rect")break;case"cx":c.setAttribute(N,$),f.pattern&&je(f),f._.dirty=1;break;case"height":if(c.setAttribute(N,$),f._.dirty=1,!g.fy)break;N="y",$=g.y;case"y":g.fy&&($=-g.y-(g.height||0));case"ry":if(N=="ry"&&f.type=="rect")break;case"cy":c.setAttribute(N,$),f.pattern&&je(f),f._.dirty=1;break;case"r":f.type=="rect"?ee(c,{rx:$,ry:$}):c.setAttribute(N,$),f._.dirty=1;break;case"src":f.type=="image"&&c.setAttributeNS(me,"href",$);break;case"stroke-width":f._.sx==1&&f._.sy==1||($/=F(T(f._.sx),T(f._.sy))||1),c.setAttribute(N,$),g["stroke-dasharray"]&&ze(f,g["stroke-dasharray"],u),f._.arrows&&("startString"in f._.arrows&&qe(f,f._.arrows.startString),"endString"in f._.arrows&&qe(f,f._.arrows.endString,1));break;case"stroke-dasharray":ze(f,$,u);break;case"fill":var Ve=x($).match(l._ISURL);if(Ve){R=ee("pattern");var Ye=ee("image");R.id=l.createUUID(),ee(R,{x:0,y:0,patternUnits:"userSpaceOnUse",height:1,width:1}),ee(Ye,{x:0,y:0,"xlink:href":Ve[1]}),R.appendChild(Ye),function(Qe){l._preload(Ve[1],function(){var ut=this.offsetWidth,n=this.offsetHeight;ee(Qe,{width:ut,height:n}),ee(Ye,{width:ut,height:n})})}(R),f.paper.defs.appendChild(R),ee(c,{fill:"url(#"+R.id+")"}),f.pattern=R,f.pattern&&je(f);break}var Oe=l.getRGB($);if(Oe.error){if((f.type=="circle"||f.type=="ellipse"||x($).charAt()!="r")&&Ae(f,$)){if("opacity"in g||"fill-opacity"in g){var Ze=l._g.doc.getElementById(c.getAttribute("fill").replace(/^url\(#|\)$/g,J));if(Ze){var tt=Ze.getElementsByTagName("stop");ee(tt[tt.length-1],{"stop-opacity":("opacity"in g?g.opacity:1)*("fill-opacity"in g?g["fill-opacity"]:1)})}}g.gradient=$,g.fill="none";break}}else delete u.gradient,delete g.gradient,!l.is(g.opacity,"undefined")&&l.is(u.opacity,"undefined")&&ee(c,{opacity:g.opacity}),!l.is(g["fill-opacity"],"undefined")&&l.is(u["fill-opacity"],"undefined")&&ee(c,{"fill-opacity":g["fill-opacity"]});Oe[d]("opacity")&&ee(c,{"fill-opacity":Oe.opacity>1?Oe.opacity/100:Oe.opacity});case"stroke":Oe=l.getRGB($),c.setAttribute(N,Oe.hex),N=="stroke"&&Oe[d]("opacity")&&ee(c,{"stroke-opacity":Oe.opacity>1?Oe.opacity/100:Oe.opacity}),N=="stroke"&&f._.arrows&&("startString"in f._.arrows&&qe(f,f._.arrows.startString),"endString"in f._.arrows&&qe(f,f._.arrows.endString,1));break;case"gradient":(f.type=="circle"||f.type=="ellipse"||x($).charAt()!="r")&&Ae(f,$);break;case"opacity":g.gradient&&!g[d]("stroke-opacity")&&ee(c,{"stroke-opacity":$>1?$/100:$});case"fill-opacity":if(g.gradient){(Ze=l._g.doc.getElementById(c.getAttribute("fill").replace(/^url\(#|\)$/g,J)))&&(tt=Ze.getElementsByTagName("stop"),ee(tt[tt.length-1],{"stop-opacity":$}));break}default:N=="font-size"&&($=W($,10)+"px");var at=N.replace(/(\-.)/g,function(Qe){return Qe.substring(1).toUpperCase()});c.style[at]=$,f._.dirty=1,c.setAttribute(N,$)}}Ee(f,u),c.style.visibility=S},Ee=function(f,u){if(f.type=="text"&&(u[d]("text")||u[d]("font")||u[d]("font-size")||u[d]("x")||u[d]("y"))){var c=f.attrs,g=f.node,S=g.firstChild?W(l._g.doc.defaultView.getComputedStyle(g.firstChild,J).getPropertyValue("font-size"),10):10;if(u[d]("text")){for(c.text=u.text;g.firstChild;)g.removeChild(g.firstChild);for(var N,$=x(u.text).split(`
`),re=[],j=0,ae=$.length;j<ae;j++)N=ee("tspan"),j&&ee(N,{dy:1.2*S,x:c.x}),N.appendChild(l._g.doc.createTextNode($[j])),g.appendChild(N),re[j]=N}else for(j=0,ae=(re=g.getElementsByTagName("tspan")).length;j<ae;j++)j?ee(re[j],{dy:1.2*S,x:c.x}):ee(re[0],{dy:0});ee(g,{x:c.x,y:c.y}),f._.dirty=1;var pe=f._getBBox(),ge=c.y-(pe.y+pe.height/2);ge&&l.is(ge,"finite")&&ee(re[0],{dy:ge})}},Be=function(f){return f.parentNode&&f.parentNode.tagName.toLowerCase()==="a"?f.parentNode:f},ce=function(f,u){this[0]=this.node=f,f.raphael=!0,this.id=("0000"+(Math.random()*Math.pow(36,5)<<0).toString(36)).slice(-5),f.raphaelid=this.id,this.matrix=l.matrix(),this.realPath=null,this.paper=u,this.attrs=this.attrs||{},this._={transform:[],sx:1,sy:1,deg:0,dx:0,dy:0,dirty:1},!u.bottom&&(u.bottom=this),this.prev=u.top,u.top&&(u.top.next=this),u.top=this,this.next=null},Z=l.el;ce.prototype=Z,Z.constructor=ce,l._engine.path=function(f,u){var c=ee("path");u.canvas&&u.canvas.appendChild(c);var g=new ce(c,u);return g.type="path",ne(g,{fill:"none",stroke:"#000",path:f}),g},Z.rotate=function(f,u,c){if(this.removed)return this;if((f=x(f).split(K)).length-1&&(u=B(f[1]),c=B(f[2])),f=B(f[0]),c==null&&(u=c),u==null||c==null){var g=this.getBBox(1);u=g.x+g.width/2,c=g.y+g.height/2}return this.transform(this._.transform.concat([["r",f,u,c]])),this},Z.scale=function(f,u,c,g){if(this.removed)return this;if((f=x(f).split(K)).length-1&&(u=B(f[1]),c=B(f[2]),g=B(f[3])),f=B(f[0]),u==null&&(u=f),g==null&&(c=g),c==null||g==null)var S=this.getBBox(1);return c=c==null?S.x+S.width/2:c,g=g==null?S.y+S.height/2:g,this.transform(this._.transform.concat([["s",f,u,c,g]])),this},Z.translate=function(f,u){return this.removed?this:((f=x(f).split(K)).length-1&&(u=B(f[1])),f=B(f[0])||0,u=+u||0,this.transform(this._.transform.concat([["t",f,u]])),this)},Z.transform=function(f){var u=this._;if(f==null)return u.transform;if(l._extractTransform(this,f),this.clip&&ee(this.clip,{transform:this.matrix.invert()}),this.pattern&&je(this),this.node&&ee(this.node,{transform:this.matrix}),u.sx!=1||u.sy!=1){var c=this.attrs[d]("stroke-width")?this.attrs["stroke-width"]:1;this.attr({"stroke-width":c})}return this},Z.hide=function(){return this.removed||(this.node.style.display="none"),this},Z.show=function(){return this.removed||(this.node.style.display=""),this},Z.remove=function(){var f=Be(this.node);if(!this.removed&&f.parentNode){var u=this.paper;for(var c in u.__set__&&u.__set__.exclude(this),fe.unbind("raphael.*.*."+this.id),this.gradient&&u.defs.removeChild(this.gradient),l._tear(this,u),f.parentNode.removeChild(f),this.removeData(),this)this[c]=typeof this[c]=="function"?l._removedFactory(c):null;this.removed=!0}},Z._getBBox=function(){if(this.node.style.display=="none"){this.show();var f=!0}var u,c=!1;this.paper.canvas.parentElement?u=this.paper.canvas.parentElement.style:this.paper.canvas.parentNode&&(u=this.paper.canvas.parentNode.style),u&&u.display=="none"&&(c=!0,u.display="");var g={};try{g=this.node.getBBox()}catch(S){g={x:this.node.clientLeft,y:this.node.clientTop,width:this.node.clientWidth,height:this.node.clientHeight}}finally{g=g||{},c&&(u.display="none")}return f&&this.hide(),g},Z.attr=function(f,u){if(this.removed)return this;if(f==null){var c={};for(var g in this.attrs)this.attrs[d](g)&&(c[g]=this.attrs[g]);return c.gradient&&c.fill=="none"&&(c.fill=c.gradient)&&delete c.gradient,c.transform=this._.transform,c}if(u==null&&l.is(f,"string")){if(f=="fill"&&this.attrs.fill=="none"&&this.attrs.gradient)return this.attrs.gradient;if(f=="transform")return this._.transform;for(var S=f.split(K),N={},$=0,re=S.length;$<re;$++)(f=S[$])in this.attrs?N[f]=this.attrs[f]:l.is(this.paper.customAttributes[f],"function")?N[f]=this.paper.customAttributes[f].def:N[f]=l._availableAttrs[f];return re-1?N:N[S[0]]}if(u==null&&l.is(f,"array")){for(N={},$=0,re=f.length;$<re;$++)N[f[$]]=this.attr(f[$]);return N}if(u!=null){var j={};j[f]=u}else f!=null&&l.is(f,"object")&&(j=f);for(var ae in j)fe("raphael.attr."+ae+"."+this.id,this,j[ae]);for(ae in this.paper.customAttributes)if(this.paper.customAttributes[d](ae)&&j[d](ae)&&l.is(this.paper.customAttributes[ae],"function")){var pe=this.paper.customAttributes[ae].apply(this,[].concat(j[ae]));for(var ge in this.attrs[ae]=j[ae],pe)pe[d](ge)&&(j[ge]=pe[ge])}return ne(this,j),this},Z.toFront=function(){if(this.removed)return this;var f=Be(this.node);f.parentNode.appendChild(f);var u=this.paper;return u.top!=this&&l._tofront(this,u),this},Z.toBack=function(){if(this.removed)return this;var f=Be(this.node),u=f.parentNode;return u.insertBefore(f,u.firstChild),l._toback(this,this.paper),this.paper,this},Z.insertAfter=function(f){if(this.removed||!f)return this;var u=Be(this.node),c=Be(f.node||f[f.length-1].node);return c.nextSibling?c.parentNode.insertBefore(u,c.nextSibling):c.parentNode.appendChild(u),l._insertafter(this,f,this.paper),this},Z.insertBefore=function(f){if(this.removed||!f)return this;var u=Be(this.node),c=Be(f.node||f[0].node);return c.parentNode.insertBefore(u,c),l._insertbefore(this,f,this.paper),this},Z.blur=function(f){var u=this;if(+f!=0){var c=ee("filter"),g=ee("feGaussianBlur");u.attrs.blur=f,c.id=l.createUUID(),ee(g,{stdDeviation:+f||1.5}),c.appendChild(g),u.paper.defs.appendChild(c),u._blur=c,ee(u.node,{filter:"url(#"+c.id+")"})}else u._blur&&(u._blur.parentNode.removeChild(u._blur),delete u._blur,delete u.attrs.blur),u.node.removeAttribute("filter");return u},l._engine.circle=function(f,u,c,g){var S=ee("circle");f.canvas&&f.canvas.appendChild(S);var N=new ce(S,f);return N.attrs={cx:u,cy:c,r:g,fill:"none",stroke:"#000"},N.type="circle",ee(S,N.attrs),N},l._engine.rect=function(f,u,c,g,S,N){var $=ee("rect");f.canvas&&f.canvas.appendChild($);var re=new ce($,f);return re.attrs={x:u,y:c,width:g,height:S,rx:N||0,ry:N||0,fill:"none",stroke:"#000"},re.type="rect",ee($,re.attrs),re},l._engine.ellipse=function(f,u,c,g,S){var N=ee("ellipse");f.canvas&&f.canvas.appendChild(N);var $=new ce(N,f);return $.attrs={cx:u,cy:c,rx:g,ry:S,fill:"none",stroke:"#000"},$.type="ellipse",ee(N,$.attrs),$},l._engine.image=function(f,u,c,g,S,N){var $=ee("image");ee($,{x:c,y:g,width:S,height:N,preserveAspectRatio:"none"}),$.setAttributeNS(me,"href",u),f.canvas&&f.canvas.appendChild($);var re=new ce($,f);return re.attrs={x:c,y:g,width:S,height:N,src:u},re.type="image",re},l._engine.text=function(f,u,c,g){var S=ee("text");f.canvas&&f.canvas.appendChild(S);var N=new ce(S,f);return N.attrs={x:u,y:c,"text-anchor":"middle",text:g,"font-family":l._availableAttrs["font-family"],"font-size":l._availableAttrs["font-size"],stroke:"none",fill:"#000"},N.type="text",ne(N,N.attrs),N},l._engine.setSize=function(f,u){return this.width=f||this.width,this.height=u||this.height,this.canvas.setAttribute("width",this.width),this.canvas.setAttribute("height",this.height),this._viewBox&&this.setViewBox.apply(this,this._viewBox),this},l._engine.create=function(){var f=l._getContainer.apply(0,arguments),u=f&&f.container;if(!u)throw new Error("SVG container not found.");var c,g=f.x,S=f.y,N=f.width,$=f.height,re=ee("svg"),j="overflow:hidden;";return g=g||0,S=S||0,ee(re,{height:$=$||342,version:1.1,width:N=N||512,xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink"}),u==1?(re.style.cssText=j+"position:absolute;left:"+g+"px;top:"+S+"px",l._g.doc.body.appendChild(re),c=1):(re.style.cssText=j+"position:relative",u.firstChild?u.insertBefore(re,u.firstChild):u.appendChild(re)),(u=new l._Paper).width=N,u.height=$,u.canvas=re,u.clear(),u._left=u._top=0,c&&(u.renderfix=function(){}),u.renderfix(),u},l._engine.setViewBox=function(f,u,c,g,S){fe("raphael.setViewBox",this,this._viewBox,[f,u,c,g,S]);var N,$,re=this.getSize(),j=F(c/re.width,g/re.height),ae=this.top,pe=S?"xMidYMid meet":"xMinYMin";for(f==null?(this._vbSize&&(j=1),delete this._vbSize,N="0 0 "+this.width+Y+this.height):(this._vbSize=j,N=f+Y+u+Y+c+Y+g),ee(this.canvas,{viewBox:N,preserveAspectRatio:pe});j&&ae;)$="stroke-width"in ae.attrs?ae.attrs["stroke-width"]:1,ae.attr({"stroke-width":$}),ae._.dirty=1,ae._.dirtyT=1,ae=ae.prev;return this._viewBox=[f,u,c,g,!!S],this},l.prototype.renderfix=function(){var f,u=this.canvas,c=u.style;try{f=u.getScreenCTM()||u.createSVGMatrix()}catch(N){f=u.createSVGMatrix()}var g=-f.e%1,S=-f.f%1;(g||S)&&(g&&(this._left=(this._left+g)%1,c.left=this._left+"px"),S&&(this._top=(this._top+S)%1,c.top=this._top+"px"))},l.prototype.clear=function(){l.eve("raphael.clear",this);for(var f=this.canvas;f.firstChild;)f.removeChild(f.firstChild);this.bottom=this.top=null,(this.desc=ee("desc")).appendChild(l._g.doc.createTextNode("Created with RaphaÃ«l "+l.version)),f.appendChild(this.desc),f.appendChild(this.defs=ee("defs"))},l.prototype.remove=function(){for(var f in fe("raphael.remove",this),this.canvas.parentNode&&this.canvas.parentNode.removeChild(this.canvas),this)this[f]=typeof this[f]=="function"?l._removedFactory(f):null};var he=l.st;for(var De in Z)Z[d](De)&&!he[d](De)&&(he[De]=function(f){return function(){var u=arguments;return this.forEach(function(c){c[f].apply(c,u)})}}(De))}}.apply(G,V))===void 0||(M.exports=I)},function(M,G,X){var V,I;V=[X(0)],(I=function(l){if(!l||l.vml){var d="hasOwnProperty",x=String,B=parseFloat,W=Math,U=W.round,F=W.max,T=W.min,O=W.abs,K=/[, ]+/,fe=l.eve,J=" ",Y="",me={M:"m",L:"l",C:"c",Z:"x",m:"t",l:"r",c:"v",z:"x"},Ce=/([clmz]),?([^clmz]*)/gi,ke=/ progid:\S+Blur\([^\)]+\)/g,ee=/-?[^,\s-]+/g,Ae="position:absolute;left:0;top:0;width:1px;height:1px;behavior:url(#default#VML)",Ie=21600,je={path:1,rect:1,image:1},qe={circle:1,ellipse:1},Se=function(u,c,g){var S=l.matrix();return S.rotate(-u,.5,.5),{dx:S.x(c,g),dy:S.y(c,g)}},ze=function(u,c,g,S,N,$){var re=u._,j=u.matrix,ae=re.fillpos,pe=u.node,ge=pe.style,R=1,Le="",E=Ie/c,Re=Ie/g;if(ge.visibility="hidden",c&&g){if(pe.coordsize=O(E)+J+O(Re),ge.rotation=$*(c*g<0?-1:1),$){var Ve=Se($,S,N);S=Ve.dx,N=Ve.dy}if(c<0&&(Le+="x"),g<0&&(Le+=" y")&&(R=-1),ge.flip=Le,pe.coordorigin=S*-E+J+N*-Re,ae||re.fillsize){var Ye=pe.getElementsByTagName("fill");Ye=Ye&&Ye[0],pe.removeChild(Ye),ae&&(Ve=Se($,j.x(ae[0],ae[1]),j.y(ae[0],ae[1])),Ye.position=Ve.dx*R+J+Ve.dy*R),re.fillsize&&(Ye.size=re.fillsize[0]*O(c)+J+re.fillsize[1]*O(g)),pe.appendChild(Ye)}ge.visibility="visible"}};l.toString=function(){return`Your browser doesnâ€™t support SVG. Falling down to VML.
You are running RaphaÃ«l `+this.version};var ne,Ee=function(u,c,g){for(var S=x(c).toLowerCase().split("-"),N=g?"end":"start",$=S.length,re="classic",j="medium",ae="medium";$--;)switch(S[$]){case"block":case"classic":case"oval":case"diamond":case"open":case"none":re=S[$];break;case"wide":case"narrow":ae=S[$];break;case"long":case"short":j=S[$]}var pe=u.node.getElementsByTagName("stroke")[0];pe[N+"arrow"]=re,pe[N+"arrowlength"]=j,pe[N+"arrowwidth"]=ae},Be=function(u,c){u.attrs=u.attrs||{};var g=u.node,S=u.attrs,N=g.style,$=je[u.type]&&(c.x!=S.x||c.y!=S.y||c.width!=S.width||c.height!=S.height||c.cx!=S.cx||c.cy!=S.cy||c.rx!=S.rx||c.ry!=S.ry||c.r!=S.r),re=qe[u.type]&&(S.cx!=c.cx||S.cy!=c.cy||S.r!=c.r||S.rx!=c.rx||S.ry!=c.ry),j=u;for(var ae in c)c[d](ae)&&(S[ae]=c[ae]);if($&&(S.path=l._getPath[u.type](u),u._.dirty=1),c.href&&(g.href=c.href),c.title&&(g.title=c.title),c.target&&(g.target=c.target),c.cursor&&(N.cursor=c.cursor),"blur"in c&&u.blur(c.blur),(c.path&&u.type=="path"||$)&&(g.path=function(H){var Q=/[ahqstv]/gi,oe=l._pathToAbsolute;if(x(H).match(Q)&&(oe=l._path2curve),Q=/[clmz]/g,oe==l._pathToAbsolute&&!x(H).match(Q)){var we=x(H).replace(Ce,function(nt,it,rt){var st=[],lt=it.toLowerCase()=="m",ot=me[it];return rt.replace(ee,function(_t){lt&&st.length==2&&(ot+=st+me[it=="m"?"l":"L"],st=[]),st.push(U(_t*Ie))}),ot+st});return we}var Te,Pe,Me=oe(H);we=[];for(var Fe=0,Ge=Me.length;Fe<Ge;Fe++){Te=Me[Fe],(Pe=Me[Fe][0].toLowerCase())=="z"&&(Pe="x");for(var Ue=1,He=Te.length;Ue<He;Ue++)Pe+=U(Te[Ue]*Ie)+(Ue!=He-1?",":Y);we.push(Pe)}return we.join(J)}(~x(S.path).toLowerCase().indexOf("r")?l._pathToAbsolute(S.path):S.path),u._.dirty=1,u.type=="image"&&(u._.fillpos=[S.x,S.y],u._.fillsize=[S.width,S.height],ze(u,1,1,0,0,0))),"transform"in c&&u.transform(c.transform),re){var pe=+S.cx,ge=+S.cy,R=+S.rx||+S.r||0,Le=+S.ry||+S.r||0;g.path=l.format("ar{0},{1},{2},{3},{4},{1},{4},{1}x",U((pe-R)*Ie),U((ge-Le)*Ie),U((pe+R)*Ie),U((ge+Le)*Ie),U(pe*Ie)),u._.dirty=1}if("clip-rect"in c){var E=x(c["clip-rect"]).split(K);if(E.length==4){E[2]=+E[2]+ +E[0],E[3]=+E[3]+ +E[1];var Re=g.clipRect||l._g.doc.createElement("div"),Ve=Re.style;Ve.clip=l.format("rect({1}px {2}px {3}px {0}px)",E),g.clipRect||(Ve.position="absolute",Ve.top=0,Ve.left=0,Ve.width=u.paper.width+"px",Ve.height=u.paper.height+"px",g.parentNode.insertBefore(Re,g),Re.appendChild(g),g.clipRect=Re)}c["clip-rect"]||g.clipRect&&(g.clipRect.style.clip="auto")}if(u.textpath){var Ye=u.textpath.style;c.font&&(Ye.font=c.font),c["font-family"]&&(Ye.fontFamily='"'+c["font-family"].split(",")[0].replace(/^['"]+|['"]+$/g,Y)+'"'),c["font-size"]&&(Ye.fontSize=c["font-size"]),c["font-weight"]&&(Ye.fontWeight=c["font-weight"]),c["font-style"]&&(Ye.fontStyle=c["font-style"])}if("arrow-start"in c&&Ee(j,c["arrow-start"]),"arrow-end"in c&&Ee(j,c["arrow-end"],1),c.opacity!=null||c.fill!=null||c.src!=null||c.stroke!=null||c["stroke-width"]!=null||c["stroke-opacity"]!=null||c["fill-opacity"]!=null||c["stroke-dasharray"]!=null||c["stroke-miterlimit"]!=null||c["stroke-linejoin"]!=null||c["stroke-linecap"]!=null){var Oe=g.getElementsByTagName("fill");if(!(Oe=Oe&&Oe[0])&&(Oe=ne("fill")),u.type=="image"&&c.src&&(Oe.src=c.src),c.fill&&(Oe.on=!0),Oe.on!=null&&c.fill!="none"&&c.fill!==null||(Oe.on=!1),Oe.on&&c.fill){var Ze=x(c.fill).match(l._ISURL);if(Ze){Oe.parentNode==g&&g.removeChild(Oe),Oe.rotate=!0,Oe.src=Ze[1],Oe.type="tile";var tt=u.getBBox(1);Oe.position=tt.x+J+tt.y,u._.fillpos=[tt.x,tt.y],l._preload(Ze[1],function(){u._.fillsize=[this.offsetWidth,this.offsetHeight]})}else Oe.color=l.getRGB(c.fill).hex,Oe.src=Y,Oe.type="solid",l.getRGB(c.fill).error&&(j.type in{circle:1,ellipse:1}||x(c.fill).charAt()!="r")&&ce(j,c.fill,Oe)&&(S.fill="none",S.gradient=c.fill,Oe.rotate=!1)}if("fill-opacity"in c||"opacity"in c){var at=((+S["fill-opacity"]+1||2)-1)*((+S.opacity+1||2)-1)*((+l.getRGB(c.fill).o+1||2)-1);at=T(F(at,0),1),Oe.opacity=at,Oe.src&&(Oe.color="none")}g.appendChild(Oe);var Qe=g.getElementsByTagName("stroke")&&g.getElementsByTagName("stroke")[0],ut=!1;!Qe&&(ut=Qe=ne("stroke")),(c.stroke&&c.stroke!="none"||c["stroke-width"]||c["stroke-opacity"]!=null||c["stroke-dasharray"]||c["stroke-miterlimit"]||c["stroke-linejoin"]||c["stroke-linecap"])&&(Qe.on=!0),(c.stroke=="none"||c.stroke===null||Qe.on==null||c.stroke==0||c["stroke-width"]==0)&&(Qe.on=!1);var n=l.getRGB(c.stroke);Qe.on&&c.stroke&&(Qe.color=n.hex),at=((+S["stroke-opacity"]+1||2)-1)*((+S.opacity+1||2)-1)*((+n.o+1||2)-1);var r=.75*(B(c["stroke-width"])||1);if(at=T(F(at,0),1),c["stroke-width"]==null&&(r=S["stroke-width"]),c["stroke-width"]&&(Qe.weight=r),r&&r<1&&(at*=r)&&(Qe.weight=1),Qe.opacity=at,c["stroke-linejoin"]&&(Qe.joinstyle=c["stroke-linejoin"]||"miter"),Qe.miterlimit=c["stroke-miterlimit"]||8,c["stroke-linecap"]&&(Qe.endcap=c["stroke-linecap"]=="butt"?"flat":c["stroke-linecap"]=="square"?"square":"round"),"stroke-dasharray"in c){var a={"-":"shortdash",".":"shortdot","-.":"shortdashdot","-..":"shortdashdotdot",". ":"dot","- ":"dash","--":"longdash","- .":"dashdot","--.":"longdashdot","--..":"longdashdotdot"};Qe.dashstyle=a[d](c["stroke-dasharray"])?a[c["stroke-dasharray"]]:Y}ut&&g.appendChild(Qe)}if(j.type=="text"){j.paper.canvas.style.display=Y;var o=j.paper.span,p=S.font&&S.font.match(/\d+(?:\.\d*)?(?=px)/);N=o.style,S.font&&(N.font=S.font),S["font-family"]&&(N.fontFamily=S["font-family"]),S["font-weight"]&&(N.fontWeight=S["font-weight"]),S["font-style"]&&(N.fontStyle=S["font-style"]),p=B(S["font-size"]||p&&p[0])||10,N.fontSize=100*p+"px",j.textpath.string&&(o.innerHTML=x(j.textpath.string).replace(/</g,"&#60;").replace(/&/g,"&#38;").replace(/\n/g,"<br>"));var v=o.getBoundingClientRect();j.W=S.w=(v.right-v.left)/100,j.H=S.h=(v.bottom-v.top)/100,j.X=S.x,j.Y=S.y+j.H/2,("x"in c||"y"in c)&&(j.path.v=l.format("m{0},{1}l{2},{1}",U(S.x*Ie),U(S.y*Ie),U(S.x*Ie)+1));for(var P=["x","y","text","font","font-family","font-weight","font-style","font-size"],z=0,q=P.length;z<q;z++)if(P[z]in c){j._.dirty=1;break}switch(S["text-anchor"]){case"start":j.textpath.style["v-text-align"]="left",j.bbx=j.W/2;break;case"end":j.textpath.style["v-text-align"]="right",j.bbx=-j.W/2;break;default:j.textpath.style["v-text-align"]="center",j.bbx=0}j.textpath.style["v-text-kern"]=!0}},ce=function(u,c,g){u.attrs=u.attrs||{},u.attrs;var S=Math.pow,N="linear",$=".5 .5";if(u.attrs.gradient=c,c=(c=x(c).replace(l._radial_gradient,function(R,Le,E){return N="radial",Le&&E&&(Le=B(Le),E=B(E),S(Le-.5,2)+S(E-.5,2)>.25&&(E=W.sqrt(.25-S(Le-.5,2))*(2*(E>.5)-1)+.5),$=Le+J+E),Y})).split(/\s*\-\s*/),N=="linear"){var re=c.shift();if(re=-B(re),isNaN(re))return null}var j=l._parseDots(c);if(!j)return null;if(u=u.shape||u.node,j.length){u.removeChild(g),g.on=!0,g.method="none",g.color=j[0].color,g.color2=j[j.length-1].color;for(var ae=[],pe=0,ge=j.length;pe<ge;pe++)j[pe].offset&&ae.push(j[pe].offset+J+j[pe].color);g.colors=ae.length?ae.join():"0% "+g.color,N=="radial"?(g.type="gradientTitle",g.focus="100%",g.focussize="0 0",g.focusposition=$,g.angle=0):(g.type="gradient",g.angle=(270-re)%360),u.appendChild(g)}return 1},Z=function(u,c){this[0]=this.node=u,u.raphael=!0,this.id=l._oid++,u.raphaelid=this.id,this.X=0,this.Y=0,this.attrs={},this.paper=c,this.matrix=l.matrix(),this._={transform:[],sx:1,sy:1,dx:0,dy:0,deg:0,dirty:1,dirtyT:1},!c.bottom&&(c.bottom=this),this.prev=c.top,c.top&&(c.top.next=this),c.top=this,this.next=null},he=l.el;Z.prototype=he,he.constructor=Z,he.transform=function(u){if(u==null)return this._.transform;var c,g=this.paper._viewBoxShift,S=g?"s"+[g.scale,g.scale]+"-1-1t"+[g.dx,g.dy]:Y;g&&(c=u=x(u).replace(/\.{3}|\u2026/g,this._.transform||Y)),l._extractTransform(this,S+u);var N,$=this.matrix.clone(),re=this.skew,j=this.node,ae=~x(this.attrs.fill).indexOf("-"),pe=!x(this.attrs.fill).indexOf("url(");if($.translate(1,1),pe||ae||this.type=="image")if(re.matrix="1 0 0 1",re.offset="0 0",N=$.split(),ae&&N.noRotation||!N.isSimple){j.style.filter=$.toFilter();var ge=this.getBBox(),R=this.getBBox(1),Le=ge.x-R.x,E=ge.y-R.y;j.coordorigin=Le*-Ie+J+E*-Ie,ze(this,1,1,Le,E,0)}else j.style.filter=Y,ze(this,N.scalex,N.scaley,N.dx,N.dy,N.rotate);else j.style.filter=Y,re.matrix=x($),re.offset=$.offset();return c!==null&&(this._.transform=c,l._extractTransform(this,c)),this},he.rotate=function(u,c,g){if(this.removed)return this;if(u!=null){if((u=x(u).split(K)).length-1&&(c=B(u[1]),g=B(u[2])),u=B(u[0]),g==null&&(c=g),c==null||g==null){var S=this.getBBox(1);c=S.x+S.width/2,g=S.y+S.height/2}return this._.dirtyT=1,this.transform(this._.transform.concat([["r",u,c,g]])),this}},he.translate=function(u,c){return this.removed?this:((u=x(u).split(K)).length-1&&(c=B(u[1])),u=B(u[0])||0,c=+c||0,this._.bbox&&(this._.bbox.x+=u,this._.bbox.y+=c),this.transform(this._.transform.concat([["t",u,c]])),this)},he.scale=function(u,c,g,S){if(this.removed)return this;if((u=x(u).split(K)).length-1&&(c=B(u[1]),g=B(u[2]),S=B(u[3]),isNaN(g)&&(g=null),isNaN(S)&&(S=null)),u=B(u[0]),c==null&&(c=u),S==null&&(g=S),g==null||S==null)var N=this.getBBox(1);return g=g==null?N.x+N.width/2:g,S=S==null?N.y+N.height/2:S,this.transform(this._.transform.concat([["s",u,c,g,S]])),this._.dirtyT=1,this},he.hide=function(){return!this.removed&&(this.node.style.display="none"),this},he.show=function(){return!this.removed&&(this.node.style.display=Y),this},he.auxGetBBox=l.el.getBBox,he.getBBox=function(){var u=this.auxGetBBox();if(this.paper&&this.paper._viewBoxShift){var c={},g=1/this.paper._viewBoxShift.scale;return c.x=u.x-this.paper._viewBoxShift.dx,c.x*=g,c.y=u.y-this.paper._viewBoxShift.dy,c.y*=g,c.width=u.width*g,c.height=u.height*g,c.x2=c.x+c.width,c.y2=c.y+c.height,c}return u},he._getBBox=function(){return this.removed?{}:{x:this.X+(this.bbx||0)-this.W/2,y:this.Y-this.H,width:this.W,height:this.H}},he.remove=function(){if(!this.removed&&this.node.parentNode){for(var u in this.paper.__set__&&this.paper.__set__.exclude(this),l.eve.unbind("raphael.*.*."+this.id),l._tear(this,this.paper),this.node.parentNode.removeChild(this.node),this.shape&&this.shape.parentNode.removeChild(this.shape),this)this[u]=typeof this[u]=="function"?l._removedFactory(u):null;this.removed=!0}},he.attr=function(u,c){if(this.removed)return this;if(u==null){var g={};for(var S in this.attrs)this.attrs[d](S)&&(g[S]=this.attrs[S]);return g.gradient&&g.fill=="none"&&(g.fill=g.gradient)&&delete g.gradient,g.transform=this._.transform,g}if(c==null&&l.is(u,"string")){if(u=="fill"&&this.attrs.fill=="none"&&this.attrs.gradient)return this.attrs.gradient;for(var N=u.split(K),$={},re=0,j=N.length;re<j;re++)(u=N[re])in this.attrs?$[u]=this.attrs[u]:l.is(this.paper.customAttributes[u],"function")?$[u]=this.paper.customAttributes[u].def:$[u]=l._availableAttrs[u];return j-1?$:$[N[0]]}if(this.attrs&&c==null&&l.is(u,"array")){for($={},re=0,j=u.length;re<j;re++)$[u[re]]=this.attr(u[re]);return $}var ae;for(var pe in c!=null&&((ae={})[u]=c),c==null&&l.is(u,"object")&&(ae=u),ae)fe("raphael.attr."+pe+"."+this.id,this,ae[pe]);if(ae){for(pe in this.paper.customAttributes)if(this.paper.customAttributes[d](pe)&&ae[d](pe)&&l.is(this.paper.customAttributes[pe],"function")){var ge=this.paper.customAttributes[pe].apply(this,[].concat(ae[pe]));for(var R in this.attrs[pe]=ae[pe],ge)ge[d](R)&&(ae[R]=ge[R])}ae.text&&this.type=="text"&&(this.textpath.string=ae.text),Be(this,ae)}return this},he.toFront=function(){return!this.removed&&this.node.parentNode.appendChild(this.node),this.paper&&this.paper.top!=this&&l._tofront(this,this.paper),this},he.toBack=function(){return this.removed?this:(this.node.parentNode.firstChild!=this.node&&(this.node.parentNode.insertBefore(this.node,this.node.parentNode.firstChild),l._toback(this,this.paper)),this)},he.insertAfter=function(u){return this.removed?this:(u.constructor==l.st.constructor&&(u=u[u.length-1]),u.node.nextSibling?u.node.parentNode.insertBefore(this.node,u.node.nextSibling):u.node.parentNode.appendChild(this.node),l._insertafter(this,u,this.paper),this)},he.insertBefore=function(u){return this.removed?this:(u.constructor==l.st.constructor&&(u=u[0]),u.node.parentNode.insertBefore(this.node,u.node),l._insertbefore(this,u,this.paper),this)},he.blur=function(u){var c=this.node.runtimeStyle,g=c.filter;return g=g.replace(ke,Y),+u!=0?(this.attrs.blur=u,c.filter=g+J+" progid:DXImageTransform.Microsoft.Blur(pixelradius="+(+u||1.5)+")",c.margin=l.format("-{0}px 0 0 -{0}px",U(+u||1.5))):(c.filter=g,c.margin=0,delete this.attrs.blur),this},l._engine.path=function(u,c){var g=ne("shape");g.style.cssText=Ae,g.coordsize=Ie+J+Ie,g.coordorigin=c.coordorigin;var S=new Z(g,c),N={fill:"none",stroke:"#000"};u&&(N.path=u),S.type="path",S.path=[],S.Path=Y,Be(S,N),c.canvas&&c.canvas.appendChild(g);var $=ne("skew");return $.on=!0,g.appendChild($),S.skew=$,S.transform(Y),S},l._engine.rect=function(u,c,g,S,N,$){var re=l._rectPath(c,g,S,N,$),j=u.path(re),ae=j.attrs;return j.X=ae.x=c,j.Y=ae.y=g,j.W=ae.width=S,j.H=ae.height=N,ae.r=$,ae.path=re,j.type="rect",j},l._engine.ellipse=function(u,c,g,S,N){var $=u.path();return $.attrs,$.X=c-S,$.Y=g-N,$.W=2*S,$.H=2*N,$.type="ellipse",Be($,{cx:c,cy:g,rx:S,ry:N}),$},l._engine.circle=function(u,c,g,S){var N=u.path();return N.attrs,N.X=c-S,N.Y=g-S,N.W=N.H=2*S,N.type="circle",Be(N,{cx:c,cy:g,r:S}),N},l._engine.image=function(u,c,g,S,N,$){var re=l._rectPath(g,S,N,$),j=u.path(re).attr({stroke:"none"}),ae=j.attrs,pe=j.node,ge=pe.getElementsByTagName("fill")[0];return ae.src=c,j.X=ae.x=g,j.Y=ae.y=S,j.W=ae.width=N,j.H=ae.height=$,ae.path=re,j.type="image",ge.parentNode==pe&&pe.removeChild(ge),ge.rotate=!0,ge.src=c,ge.type="tile",j._.fillpos=[g,S],j._.fillsize=[N,$],pe.appendChild(ge),ze(j,1,1,0,0,0),j},l._engine.text=function(u,c,g,S){var N=ne("shape"),$=ne("path"),re=ne("textpath");c=c||0,g=g||0,S=S||"",$.v=l.format("m{0},{1}l{2},{1}",U(c*Ie),U(g*Ie),U(c*Ie)+1),$.textpathok=!0,re.string=x(S),re.on=!0,N.style.cssText=Ae,N.coordsize=Ie+J+Ie,N.coordorigin="0 0";var j=new Z(N,u),ae={fill:"#000",stroke:"none",font:l._availableAttrs.font,text:S};j.shape=N,j.path=$,j.textpath=re,j.type="text",j.attrs.text=x(S),j.attrs.x=c,j.attrs.y=g,j.attrs.w=1,j.attrs.h=1,Be(j,ae),N.appendChild(re),N.appendChild($),u.canvas.appendChild(N);var pe=ne("skew");return pe.on=!0,N.appendChild(pe),j.skew=pe,j.transform(Y),j},l._engine.setSize=function(u,c){var g=this.canvas.style;return this.width=u,this.height=c,u==+u&&(u+="px"),c==+c&&(c+="px"),g.width=u,g.height=c,g.clip="rect(0 "+u+" "+c+" 0)",this._viewBox&&l._engine.setViewBox.apply(this,this._viewBox),this},l._engine.setViewBox=function(u,c,g,S,N){l.eve("raphael.setViewBox",this,this._viewBox,[u,c,g,S,N]);var $,re,j=this.getSize(),ae=j.width,pe=j.height;return N&&(g*($=pe/S)<ae&&(u-=(ae-g*$)/2/$),S*(re=ae/g)<pe&&(c-=(pe-S*re)/2/re)),this._viewBox=[u,c,g,S,!!N],this._viewBoxShift={dx:-u,dy:-c,scale:j},this.forEach(function(ge){ge.transform("...")}),this},l._engine.initWin=function(u){var c=u.document;c.styleSheets.length<31?c.createStyleSheet().addRule(".rvml","behavior:url(#default#VML)"):c.styleSheets[0].addRule(".rvml","behavior:url(#default#VML)");try{!c.namespaces.rvml&&c.namespaces.add("rvml","urn:schemas-microsoft-com:vml"),ne=function(g){return c.createElement("<rvml:"+g+' class="rvml">')}}catch(g){ne=function(S){return c.createElement("<"+S+' xmlns="urn:schemas-microsoft.com:vml" class="rvml">')}}},l._engine.initWin(l._g.win),l._engine.create=function(){var u=l._getContainer.apply(0,arguments),c=u.container,g=u.height,S=u.width,N=u.x,$=u.y;if(!c)throw new Error("VML container not found.");var re=new l._Paper,j=re.canvas=l._g.doc.createElement("div"),ae=j.style;return N=N||0,$=$||0,S=S||512,g=g||342,re.width=S,re.height=g,S==+S&&(S+="px"),g==+g&&(g+="px"),re.coordsize=216e5+J+216e5,re.coordorigin="0 0",re.span=l._g.doc.createElement("span"),re.span.style.cssText="position:absolute;left:-9999em;top:-9999em;padding:0;margin:0;line-height:1;",j.appendChild(re.span),ae.cssText=l.format("top:0;left:0;width:{0};height:{1};display:inline-block;position:relative;clip:rect(0 {0} {1} 0);overflow:hidden",S,g),c==1?(l._g.doc.body.appendChild(j),ae.left=N+"px",ae.top=$+"px",ae.position="absolute"):c.firstChild?c.insertBefore(j,c.firstChild):c.appendChild(j),re.renderfix=function(){},re},l.prototype.clear=function(){l.eve("raphael.clear",this),this.canvas.innerHTML=Y,this.span=l._g.doc.createElement("span"),this.span.style.cssText="position:absolute;left:-9999em;top:-9999em;padding:0;margin:0;line-height:1;display:inline;",this.canvas.appendChild(this.span),this.bottom=this.top=null},l.prototype.remove=function(){for(var u in l.eve("raphael.remove",this),this.canvas.parentNode.removeChild(this.canvas),this)this[u]=typeof this[u]=="function"?l._removedFactory(u):null;return!0};var De=l.st;for(var f in he)he[d](f)&&!De[d](f)&&(De[f]=function(u){return function(){var c=arguments;return this.forEach(function(g){g[u].apply(g,c)})}}(f))}}.apply(G,V))===void 0||(M.exports=I)}])})}),Un=On(Vn),Mt=Un;var L={};L.Common={nodeIdIncrement:0,activeNode:0,roundFloat:function(A,C){for(var M=0,G=1;M<C;)G*=10,M++;return Math.round(A*G)/G},apply:function(A,C){if(A&&typeof C=="object")for(var M in C)A[M]=C[M];return A},addRaphEventHandler:function(A,C,M,G){try{A[C](function(X,V){return function(I,l){var d=V;d.e=I,X(d)}}(M,G))}catch(X){}},isInteger:function(A){return!isNaN(parseInt(A))},isXMLSerializerAvailable:function(){return typeof XMLSerializer=="function"},createSvgEl:function(A,C){if(A=document.createElementNS("http://www.w3.org/2000/svg",A),C)for(var M in C)C.hasOwnProperty(M)&&A.setAttribute(M,String(C[M]));return A},createGradientEl:function(A,C,M){if(C.type!="radialGradient")return!1;var G=L.Common.createSvgEl("radialGradient",{id:A,gradientUnits:"userSpaceOnUse",cx:M[0],cy:M[1],r:M[2],fx:M[0],fy:M[1]});if(C.stop)for(var X=C.stop,V=0;V<X.length;V++){var I=X[V];I["@attributes"]?G.appendChild(L.Common.createSvgEl("stop",I["@attributes"])):(I._attributes&&delete I._attributes,I._children&&delete I._children,I.__proto__&&delete I.__proto__,G.appendChild(L.Common.createSvgEl("stop",I)))}return G},setCssStyle:function(A,C){var M=document.styleSheets[0];M.addRule?M.addRule(A,C):M.insertRule&&M.insertRule(A+" { "+C+" }",M.cssRules.length)}};L.PhyloCanvas=function(){var A,C,M,G,X;return function(V,I,l,d,x){if(this.getNewickObject=function(){return M},this.clear=function(){},this.scale=function(W){G.svg.scale(W)},this.getSvg=function(){return G},this.getPhylogram=function(){return A},this.getSvgSource=function(){if(Mt.svg&&L.Common.isXMLSerializerAvailable()){var W=new XMLSerializer;return W.serializeToString(G.svg.canvas)}else return!1},typeof V=="object")if(V.xml){if(V.fileSource)var B=V.xml;else var B=Lt.textToXML(V.xml);B=Lt.xmlToJSON(B),X=new L.PhyloCanvas.PhyloxmlParse(B)}else if(V.phyloxml){if(V.fileSource)var B=V.phyloxml;else var B=Lt.textToXML(V.phyloxml);B=Lt.xmlToJSON(B),X=new L.PhyloCanvas.PhyloxmlParse(B)}else if(V.nexml){if(V.fileSource)var B=V.nexml;else var B=Lt.textToXML(V.nexml);B=Lt.xmlToJSON(B),X=new L.PhyloCanvas.NexmlParse(B,V)}else V.json?X=new L.PhyloCanvas.PhyloxmlParse(V.json):V.newick?X=new L.PhyloCanvas.NewickParse(V.newick):V.nexmlJson?X=new L.PhyloCanvas.NexmlJsonParse(V):alert("Please set the format of input data");else X=new L.PhyloCanvas.NewickParse(V);C=I,G=new L.PhyloCanvas.Render.SVG(C,l,d),x=="circular"?A=new L.PhyloCanvas.Render.CircularPhylogram(G,X):A=new L.PhyloCanvas.Render.Phylogram(G,X)}}();L.PhyloCanvas.prototype={};L.PhyloCanvas.Node=function(){return function(A,C){this.id=L.Common.nodeIdIncrement+=1,this.level=0,this.len=0,this.newickLen=0,this.name="",this.type="",this.chart={},this.img=[],A&&L.Common.apply(this,A),this._countAllChildren=!1,this._countImmediateChildren=!1,this._midBranchPosition=!1,this.children=new Array,C&&C.children.push(this)}}();L.PhyloCanvas.Node.prototype={getCountAllChildren:function(){if(this._countAllChildren!==!1)return this._countAllChildren;var A=0;for(var C in this.children)if(L.Common.isInteger(C)){var M=this.children[C];M.children&&M.children.length>0?A+=M.getCountAllChildren():A++}return this._countAllChildren=A,A},getCountImmediateChildren:function(){if(this._countImmediateChildren!==!1)return this._countImmediateChildren;var A=0;for(var C in this.children){var M=this.children[C];A+=M.length}return this._countImmediateChildren=A,A},getMidbranchPosition:function(A){if(this._midBranchPosition!==!1)return this._midBranchPosition;for(var C=[0,0],M=0;M<this.children.length;M++){var G=this.children[M];G.children&&G.children.length>0?M==0&&A?(C[0]=G.getMidbranchPosition(!0),C[1]+=G.getCountAllChildren()-1):M==0?(C[0]=G.getMidbranchPosition(),C[1]+=G.getCountAllChildren()):M==this.children.length-1?C[1]+=G.getMidbranchPosition():C[1]+=G.getCountAllChildren():M==0&&A?C[0]=0:M==0?(C[0]=1,C[1]+=1):(M==this.children.length-1,C[1]+=1)}return this._midBranchPosition=C[1]>=C[0]?(C[1]+C[0])/2:C[0],this._midBranchPosition}};L.PhyloCanvas.NewickParse=function(){var A,C,M,G=0,X=0,V,I,l=function(F){for(var T=new L.PhyloCanvas.Node;C!==")"&&C!==",";)C===":"?(W(),T.len=L.Common.roundFloat(x(),4),T.len==0&&(T.len=1e-4)):C==="'"||C==='"'?(T.type="label",T.name=B(C)):(T.type="label",T.name=x());return T.level=F.level+1,T},d=function(F){var T=new L.PhyloCanvas.Node;for(F&&(T.level=F.level+1);C!==")";)W(),C==="("?T.children.push(d(T)):T.children.push(l(T));return W(),C!==":"&&C!==")"&&C!==","&&C!==";"&&(T.type="label",T.name=x()),C===":"&&(W(),T.len=L.Common.roundFloat(x(),4),T.len==0&&(T.len=1e-4),T.type="stem"),T},x=function(){for(var F="";C!==":"&&C!==")"&&C!==","&&C!==";";)F+=C,W();return F},B=function(F){for(var T="";C!==F;)T+=C,W();return T},W=function(){return C=A.charAt(M),M+=1,C},U=function(F,T){if(F.children&&F.children.length)for(var O=0;O<F.children.length;O++){var K=F.children[O];K.len===0&&(K.len=1),K.newickLen=L.Common.roundFloat(K.len+F.newickLen,4),K.level>G&&(G=K.level),K.newickLen>X&&(X=K.newickLen),K.children.length>0&&U(K,F)}return F};return function(F){this.getRoot=function(){return V},this.getLevels=function(){return G},this.getNewickLen=function(){return X},this.getValidate=function(){return I},G=0,X=0,A=F,M=0,W(),V=d(),V=U(V)}}();L.PhyloCanvas.NewickParse.prototype={};L.PhyloCanvas.PhyloxmlParse=function(){var A=0,C=0,M,G,X=function(l,d){var x=new L.PhyloCanvas.Node;if(d&&(x.level=d.level+1),l.clade&&l.clade.length)for(var B=0;B<l.clade.length;B++){var W=l.clade[B];x.children.push(X(W,x))}if(l.branch_length&&(typeof l.branch_length=="object"&&(l.branch_length=l.branch_length[0].Text),x.len=L.Common.roundFloat(l.branch_length,4),x.len==0&&(x.len=1e-4)),l.color?(x.red=l.color[0].red[0].Text,x.green=l.color[0].green[0].Text,x.blue=l.color[0].blue[0].Text):(x.red=0,x.green=0,x.blue=0),l.property&&l.property[0].applies_to=="node"&&l.property[0].ref=="style:font_color"&&(x.font_color_hex=l.property[0].Text),l.name?(x.type="label",x.name=l.name[0].Text,l.name[0]&&l.name[0].style&&(x.style=l.name[0].style),l.name[0]&&l.name[0].bgStyle&&(x.bgStyle=l.name[0].bgStyle)):l.confidence&&(x.name=l.confidence[0].Text),l.sequence&&l.sequence[0]&&l.sequence[0].name&&l.sequence[0].name[0]&&l.sequence[0].name[0].Text&&(x.sequenceName=l.sequence[0].name[0].Text),l.taxonomy&&l.taxonomy[0]&&(l.taxonomy[0].scientific_name&&l.taxonomy[0].scientific_name[0]&&l.taxonomy[0].scientific_name[0].Text&&(x.taxonomyScientificName=l.taxonomy[0].scientific_name[0].Text),l.taxonomy[0].common_name&&l.taxonomy[0].common_name[0]&&l.taxonomy[0].common_name[0].Text&&(x.taxonomyCommonName=l.taxonomy[0].common_name[0].Text)),l.sequence&&l.sequence[0]&&l.sequence[0].accession&&l.sequence[0].accession[0]&&l.sequence[0].accession[0].Text&&(x.sequenceAccession=l.sequence[0].accession[0].Text),l.point&&(x.LatLong=[l.point[0].lat[0].Text,l.point[0].long[0].Text]),x.name||(x.sequenceName?x.name=x.sequenceName:x.taxonomyScientificName?x.name=x.taxonomyScientificName:x.taxonomyCommonName?x.name=x.taxonomyCommonName:x.sequenceAccession&&(x.name=x.sequenceAccession),x.name&&(x.type="label")),l.annotation&&(l.annotation[0]&&l.annotation[0].desc&&l.annotation[0].desc[0]&&l.annotation[0].desc[0].Text&&(x.description=l.annotation[0].desc[0].Text),l.annotation[0]&&l.annotation[0].uri&&l.annotation[0].uri[0]&&l.annotation[0].uri[0].Text&&(x.uri=l.annotation[0].uri[0].Text),l.annotation[0]&&l.annotation[0].img))for(var B in l.annotation[0].img)L.Common.isInteger(B)&&(x.img[B]=l.annotation[0].img[B].Text);if(l.chart&&l.chart[0])for(var B in l.chart[0])B!="Text"&&B!="_children"&&(x.chart[B]=l.chart[0][B][0].Text);return x&&x.level>1&&(x.len||(G="Error. Please include Branch Lengths - we only draw rooted phylogenetic trees.")),x},V=function(l,d){if(l.children&&l.children.length)for(var x=0;x<l.children.length;x++){var B=l.children[x];B.newickLen=Math.round((B.len+l.newickLen)*1e4)/1e4,B.level>A&&(A=B.level),B.newickLen>C&&(C=B.newickLen),B.children.length>0&&V(B,l)}return l},I=function(l,d){for(var x in l)x!="_children"&&x!="Text"&&(x=="rectangular"||x=="circular"?I(l[x][0],x):(L.PhyloCanvas.Render.Parameters[x]||(L.PhyloCanvas.Render.Parameters[x]={}),L.PhyloCanvas.Render.Parameters.set(x,l[x][0].Text,d)))};return function(l){if(this.getRoot=function(){return M},this.getLevels=function(){return A},this.getNewickLen=function(){return C},this.getValidate=function(){return G},l.phylogeny&&l.phylogeny[0]&&l.phylogeny[0].clade&&(M=X(l.phylogeny[0].clade[0])),l.phylogeny&&l.phylogeny[0]&&l.phylogeny[0].render&&l.phylogeny[0].render[0]){var d=l.phylogeny[0].render[0];if(d&&d.styles){var x=d.styles[0];for(var B in x)if(B!="_children"&&B!="Text")if(x[B][0].type&&x[B][0].type=="radialGradient"&&Mt.svg)x[B][0].name=B,L.PhyloCanvas.Render.Style[B]=x[B][0],L.PhyloCanvas.Render.Style.jsphylosvgGradientList||(L.PhyloCanvas.Render.Style.jsphylosvgGradientList=[]),L.PhyloCanvas.Render.Style.jsphylosvgGradientList.push(B);else{L.PhyloCanvas.Render.Style[B]||(L.PhyloCanvas.Render.Style[B]={});for(var W in x[B][0])W!="_attributes"&&W!="_children"&&W!="type"&&(L.PhyloCanvas.Render.Style[B][W.replace("_","-")]=x[B][0][W])}}if(d&&d.parameters&&I(d.parameters[0]),d&&d.charts){var U=d.charts[0];for(var B in U)if(B!="_children"&&B!="Text")for(var W in U[B])U[B][W].type=="binary"?(U[B][W].chart=B,L.PhyloCanvas.Render.Parameters.binaryCharts.push(U[B][W])):U[B][W].type=="integratedBinary"?(U[B][W].chart=B,L.PhyloCanvas.Render.Parameters.integratedBinaryCharts.push(U[B][W])):U[B][W].type=="bar"&&(U[B][W].chart=B,L.PhyloCanvas.Render.Parameters.barCharts.length==1&&L.PhyloCanvas.Render.Parameters.barCharts.shift(),L.PhyloCanvas.Render.Parameters.barCharts.push(U[B][W]))}}M=V(M)}}();L.PhyloCanvas.PhyloxmlParse.prototype={};L.PhyloCanvas.NexmlParse=function(){var A=0,C=0,M,G,X,V,I=function(x,B,W){var U=new L.PhyloCanvas.Node;W&&(U.level=W.level+1);for(var F=0;F<X.length;F++)if(X[F].source==x.id)for(var T=0;T<V.length;T++)X[F].target==V[T].id&&U.children.push(I(V[T],X[F].length,U));if(U&&U.level>0&&!U.len&&(U.len=1),B&&(U.len=L.Common.roundFloat(B,4),U.len==0&&(U.len=1e-4)),x.label&&(U.type="label",U.name=x.label,x.style&&(U.style=x.style)),x.color){let O=x.color.replace(/[a-z%\s\(\)]/g,"").split(",");U.red=O[0],U.green=O[1],U.blue=O[2]}else{let O=L.PhyloCanvas.Render.Style.line.stroke.replace(/[a-z%\s\(\)]/g,"").split(",");U.red=O[0],U.green=O[1],U.blue=O[2]}return U},l=function(x,B){if(x.children&&x.children.length)for(var W=0;W<x.children.length;W++){var U=x.children[W];U.newickLen=Math.round((U.len+x.newickLen)*1e4)/1e4,U.level>A&&(A=U.level),U.newickLen>C&&(C=U.newickLen),U.children.length>0&&l(U,x)}return x},d=function(x,B){for(var W in x)W!="_children"&&W!="Text"&&(W=="rectangular"||W=="circular"?d(x[W][0],W):(L.PhyloCanvas.Render.Parameters[W]||(L.PhyloCanvas.Render.Parameters[W]={}),L.PhyloCanvas.Render.Parameters.set(W,x[W][0].Text,B)))};return function(x,B){this.getRoot=function(){return M},this.getLevels=function(){return A},this.getNewickLen=function(){return C},this.getValidate=function(){return G},B.tree&&x.trees[0]&&x.trees[0].tree[B.tree-1]?(X=x.trees[0].tree[B.tree-1].edge,V=x.trees[0].tree[B.tree-1].node):(X=x.trees[0].tree[0].edge,V=x.trees[0].tree[0].node);for(var W=0;W<V.length;W++){var U=0;if(V[W].root&&V[W].root=="true"){M=V[W];break}for(var F=0;F<X.length;F++)X[F].target==V[W].id&&U++;if(U==0){M=V[W];break}}M?(M=I(M),M=l(M)):G="Error. Currently, only rooted NeXML trees are supported."}}();L.PhyloCanvas.NexmlParse.prototype={};L.PhyloCanvas.NexmlJsonParse=function(){var A=0,C=0,M,G,X=[],V=[],I=function(x,B,W){var U=new L.PhyloCanvas.Node;W&&(U.level=W.level+1);for(var F=0;F<X.length;F++)if(X[F].source==x.id)for(var T=0;T<V.length;T++)X[F].target==V[T].id&&U.children.push(I(V[T],X[F].length,U));return B&&(U.len=L.Common.roundFloat(B,4),U.len==0&&(U.len=1e-4)),x.label&&(U.type="label",U.name=x.label,x.accession&&(U.accession=x.accession),x.style&&(U.style=x.style),x.bgStyle&&(U.bgStyle=x.bgStyle)),x.chart&&(U.chart=x.chart),U&&U.level>1&&(U.len||(G="Error. Please include Branch Lengths - we only draw rooted phylogenetic trees.")),U},l=function(x,B){if(x.children&&x.children.length)for(var W=0;W<x.children.length;W++){var U=x.children[W];U.newickLen=Math.round((U.len+x.newickLen)*1e4)/1e4,U.level>A&&(A=U.level),U.newickLen>C&&(C=U.newickLen),U.children.length>0&&l(U,x)}return x},d=function(x,B){for(var W in x)W!="_children"&&W!="Text"&&(W=="rectangular"||W=="circular"?d(x[W],W):(L.PhyloCanvas.Render.Parameters[W]||(L.PhyloCanvas.Render.Parameters[W]={}),L.PhyloCanvas.Render.Parameters.set(W,x[W],B)))};return function(x){this.getRoot=function(){return M},this.getLevels=function(){return A},this.getNewickLen=function(){return C},this.getValidate=function(){return G};var B=x.nexmlJson.nexml,W=B.render;if(W&&W.styles){var U=W.styles;for(var F in U)if(F!="_children"&&F!="Text")if(U[F]["@attributes"].type&&U[F]["@attributes"].type=="radialGradient"&&Mt.svg)U[F].name=F,U[F].type=U[F]["@attributes"].type,L.PhyloCanvas.Render.Style[F]=U[F],L.PhyloCanvas.Render.Style.jsphylosvgGradientList||(L.PhyloCanvas.Render.Style.jsphylosvgGradientList=[]),L.PhyloCanvas.Render.Style.jsphylosvgGradientList.push(F);else{L.PhyloCanvas.Render.Style[F]||(L.PhyloCanvas.Render.Style[F]={});for(var T in U[F]["@attributes"])T!="_attributes"&&T!="_children"&&T!="type"&&(L.PhyloCanvas.Render.Style[F][T.replace("_","-")]=U[F]["@attributes"][T])}}if(W&&W.parameters&&d(W.parameters),W&&W.charts){var O=W.charts;for(var F in O)O[F]["@attributes"].chart=F,O[F]["@attributes"].type=="binary"?L.PhyloCanvas.Render.Parameters.binaryCharts.push(O[F]["@attributes"]):O[F]["@attributes"].type=="integratedBinary"?L.PhyloCanvas.Render.Parameters.integratedBinaryCharts.push(O[F]["@attributes"]):O[F]["@attributes"].type=="bar"&&L.PhyloCanvas.Render.Parameters.barCharts.push(O[F]["@attributes"])}if(x.tree&&B.trees[0]&&B.trees[0].tree[x.tree-1])X=B.trees[0].tree[x.tree-1].edge,V=B.trees[0].tree[x.tree-1].node;else{for(var F=0;F<B.trees.tree.edge.length;F++)X.push(B.trees.tree.edge[F]["@attributes"]);for(var F=0;F<B.trees.tree.node.length;F++){var K=B.trees.tree.node[F]["@attributes"];K.label&&(K.chart=B.trees.tree.node[F].chart),V.push(K)}}for(var F=0;F<V.length;F++)V[F].root&&V[F].root=="true"&&(M=V[F]);M?(M=I(M),M=l(M)):G="Error. Currently, only rooted NeXML trees are supported."}}();L.PhyloCanvas.NexmlParse.prototype={};L.PhyloCanvas.Render={};L.PhyloCanvas.Render.Style={line:{stroke:"rgb(0,0,0)","stroke-width":1},text:{"font-family":"Verdana","font-size":12,"text-anchor":"start"},path:{stroke:"rgb(0,0,0)","stroke-width":1},connectedDash:{stroke:"rgb(200,200,200)","stroke-dasharray":". "},textSecantBg:{fill:"#EEE",stroke:"#DDD"},highlightedEdgeCircle:{fill:"black",stroke:"black"},barChart:{fill:"#003300",stroke:"#DDD"},getStyle:function(A,C){return this[A]?this[A]:this[C]}};L.PhyloCanvas.Render.Parameters={jsOverride:0,Rectangular:{bufferX:200,paddingX:10,paddingY:20,bufferInnerLabels:10,bufferOuterLabels:5,minHeightBetweenLeaves:10,alignPadding:0,alignRight:!1,showScaleBar:!1},Circular:{bufferRadius:.33,bufferAngle:20,initStartAngle:160,innerCircleRadius:0,minHeightBetweenLeaves:5,bufferInnerLabels:2,bufferOuterLabels:5},binaryCharts:[],integratedBinaryCharts:[],barCharts:[],binaryChartBufferInner:5,binaryChartBufferSiblings:.01,binaryChartThickness:15,binaryChartDisjointed:!1,barChartBufferInner:3,barChartHeight:50,barChartWidth:.5,set:function(A,C,M){this.jsOverride||(M?M=="circular"?this.Circular[A]=parseFloat(C):M=="rectangular"&&(this.Rectangular[A]=parseFloat(C)):this[A]=parseFloat(C))}};L.PhyloCanvas.Render.Line=function(){return function(A,C,M,G,X,V,I,l){this.type="line",this.attr=L.PhyloCanvas.Render.Style.line,this.attr.stroke=["rgb(",X,",",V,",",I,")"].join(""),this.x1=A,this.x2=C,this.y1=M,this.y2=G,l&&(L.Common.apply(this,l),l.attr&&(this.attr=l.attr))}}();L.PhyloCanvas.Render.Text=function(){return function(A,C,M,G){this.type="text",this.attr=L.PhyloCanvas.Render.Style.text,this.x=A,this.y=C,this.text=M,G&&(L.Common.apply(this,G),G.attr&&(this.attr=G.attr))}}();L.PhyloCanvas.Render.Path=function(){var A=L.PhyloCanvas.Render.Style.path;return function(C,M){this.type="path",this.attr=L.PhyloCanvas.Render.Style.path,this.path=C,M&&(L.Common.apply(this,M),M.attr&&(this.attr=M.attr))}}();L.PhyloCanvas.Render.Circle=function(){return function(A,C,M,G){this.type="circle",this.x=A,this.y=C,this.radius=M,G&&(L.Common.apply(this,G),G.attr&&(this.attr=G.attr))}}();L.PhyloCanvas.Render.SVG=function(){var A,C;return function(M,G,X){A=M,this.canvasSize=[G,X],this.svg=Mt(M,this.canvasSize[0],this.canvasSize[1])}}();L.PhyloCanvas.Render.SVG.prototype={render:function(){for(var A=this.phylogramObject.getDrawInstructs(),C=0;C<A.length;C++)if(A[C].type=="line")var M=this.svg.path(["M",A[C].x1,A[C].y1,"L",A[C].x2,A[C].y2]).attr(L.PhyloCanvas.Render.Style.line);else if(A[C].type=="path")var G=this.svg.path(A[C].path).attr(A[C].attr);else if(A[C].type=="circle")var G=this.svg.circle(A[C].x,A[C].y,A[C].radius).attr({stroke:"black",fill:"black"});else{var X=this.svg.text(A[C].x,A[C].y,A[C].text).attr(L.PhyloCanvas.Render.Style.text);A[C].attr&&X.attr(A[C].attr),A[C].rotate&&X.rotate(A[C].rotate);var V=X.getBBox(),I=Math.sqrt(V.height*V.height+V.width*V.width)}},draw:function(A){var C,M;if(A.type=="line")C=this.svg.path(["M",A.x1,A.y1,"L",A.x2,A.y2]).attr(L.PhyloCanvas.Render.Style.line);else if(A.type=="path")C=this.svg.path(A.path).attr(A.attr);else if(A.type=="circle")C=this.svg.circle(A.x,A.y,A.radius).attr({stroke:"black",fill:"black"});else if(A.type=="text"){C=this.svg.text(A.x,A.y,A.text).attr(L.PhyloCanvas.Render.Style.text),A.attr&&C.attr(A.attr),A.rotate&&C.rotate(A.rotate);var G=C.getBBox();M=Math.sqrt(G.height*G.height+G.width*G.width)}return[C,M]}};L.PhyloCanvas.Render.Phylogram=function(){var A,C=L.PhyloCanvas.Render.Parameters.Rectangular,M,G,X,V,I,l,d=!0,x=0,B=0,W,U,F,T,O,K,fe,J,Y,me,Ce,ke,ee=[],Ae=function(ne){return ne+Math.round(ne/4)},Ie=function(ne,Ee,Be,ce){return["M",ne,Ee,"L",Be,Ee,"L",Be,ce,"L",ne,ce,"Z"]},je=function(ne,Ee){if(ne.len&&d==!1&&ne.children.length==0&&(x=L.Common.roundFloat(x+V,4)),ne.children.length>0){var Be=[],ce,Z,he,De,f,u,c;if(ne.len&&(ce=Ee,Z=Ee=L.Common.roundFloat(Ee+X*ne.len,4),he=x+ne.getMidbranchPosition(d)*V,De=he,f=ne.red,u=ne.green,c=ne.blue,A.draw(new L.PhyloCanvas.Render.Line(ce,Z,he,De,f,u,c))),ne.name){var g={};if(g=L.PhyloCanvas.Render.Style.getStyle("bootstrap","text"),ne.font_color_hex?g.fill=ne.font_color_hex:g.fill="#000000",ne.uri&&(g.href=ne.uri),ne.description&&(g.title=ne.description),ne.level==0)var S=x+ne.getMidbranchPosition(d)*V;else var S=De;A.draw(new L.PhyloCanvas.Render.Text((Z||Ee)+5,S,ne.name,{attr:g}))}if(ne.children&&ne.children.length)for(var N=0;N<ne.children.length;N++){var $=ne.children[N];Be.push(je($,Ee))}for(var re=[],N=0;N<Be.length;N++)Be[N][0]&&re.push(Be[N][0]),Be[N][1]&&re.push(Be[N][1]);for(var j=Math.min.apply(null,re),ae=Math.max.apply(null,re),pe=(j+ae)/2,ge="",R="",Le="",E=0,N=0;N<ne.children.length;++N){var Re=ne.children[N];if(N==0)ge=Re.red,R=Re.green,Le=Re.blue;else if(ge==Re.red&&R==Re.green&&Le==Re.blue)E=1;else{E=0;break}}E==0?L.PhyloCanvas.Render.Style.line.stroke="black":(f=ne.children[0].red,u=ne.children[0].green,c=ne.children[0].blue,L.PhyloCanvas.Render.Style.line.stroke=["rgb(",f,",",u,",",c,")"].join("")),ne.children.length==2?(f=ne.children[0].red,u=ne.children[0].green,c=ne.children[0].blue,L.PhyloCanvas.Render.Style.line.stroke=["rgb(",f,",",u,",",c,")"].join(""),A.draw(new L.PhyloCanvas.Render.Path(["M",Ee+1e-4,j,"L",Ee,j,"L",Ee,pe],{attr:L.PhyloCanvas.Render.Style.line})),f=ne.children[1].red,u=ne.children[1].green,c=ne.children[1].blue,L.PhyloCanvas.Render.Style.line.stroke=["rgb(",f,",",u,",",c,")"].join(""),A.draw(new L.PhyloCanvas.Render.Path(["M",Ee,pe,"L",Ee,ae,"L",Ee+1e-4,ae],{attr:L.PhyloCanvas.Render.Style.line}))):A.draw(new L.PhyloCanvas.Render.Path(["M",Ee+1e-4,j,"L",Ee,j,"L",Ee,ae,"L",Ee+1e-4,ae],{attr:L.PhyloCanvas.Render.Style.line}))}else{if(ce=Ee,Z=L.Common.roundFloat(Ee+X*ne.len,2),he=x,De=x,f=ne.red,u=ne.green,c=ne.blue,ne.y=x,ee.push(ne),A.draw(new L.PhyloCanvas.Render.Line(ce,Z,he,De,f,u,c)),C.alignRight&&A.draw(new L.PhyloCanvas.Render.Path(["M",Z,he,"L",C.alignPadding+I,De],{attr:L.PhyloCanvas.Render.Style.connectedDash})),ne.name){var g={};ne.style&&(g=L.PhyloCanvas.Render.Style.getStyle(ne.style,"text")),ne.font_color_hex?g.fill=ne.font_color_hex:g.fill="#000000",g["text-anchor"]="start",ne.uri&&(g.href=ne.uri),ne.description&&(g.title=ne.description);var Ve=A.draw(new L.PhyloCanvas.Render.Text(C.alignRight?I+C.bufferInnerLabels+C.alignPadding:Z+C.bufferInnerLabels,De,ne.name,{attr:g}));B=Math.max(Ve[1],B),L.PhyloCanvas.Render.Parameters.mouseRollOver&&L.Common.addRaphEventHandler(Ve[0],"mouseover",L.PhyloCanvas.Render.Parameters.mouseRollOver,{svg:A,node:ne,x:Z,y:De,textEl:Ve[0]}),L.PhyloCanvas.Render.Parameters.mouseRollOut&&L.Common.addRaphEventHandler(Ve[0],"mouseout",L.PhyloCanvas.Render.Parameters.mouseRollOut,{svg:A,node:ne,x:Z,y:De,textEl:Ve[0]}),L.PhyloCanvas.Render.Parameters.onClickAction&&L.Common.addRaphEventHandler(Ve[0],"click",L.PhyloCanvas.Render.Parameters.onClickAction,{svg:A,node:ne,x:Z,y:De,textEl:Ve[0]})}d&&(d=!1)}return[he,De]},qe=function(){y=x+V,T=0,O=C.showScaleBar*X,A.draw(new L.PhyloCanvas.Render.Line(T,O,y,y)),A.draw(new L.PhyloCanvas.Render.Text((T+O)/2,y-8,C.showScaleBar))},Se=function(ne,Ee,Be){for(var ce=(Be&&Be.bufferInner?Be.bufferInner:0)|L.PhyloCanvas.Render.Parameters.binaryChartBufferInner,Z=(Be&&Be.bufferSiblings?Be.bufferSiblings*V:0)|(L.PhyloCanvas.Render.Parameters.binaryChartBufferSiblings<1?V*L.PhyloCanvas.Render.Parameters.binaryChartBufferSiblings:L.PhyloCanvas.Render.Parameters.binaryChartBufferSiblings),he=(Be&&Be.thickness?Be.thickness:0)|L.PhyloCanvas.Render.Parameters.binaryChartThickness,De,f=0;f<ee.length;f++){var u=ee[f];A.draw(new L.PhyloCanvas.Render.Path(Ie(ne+ce,u.y-V/2+Z/2,ne+ce+he,u.y+V/2-Z/2),{attr:L.PhyloCanvas.Render.Style.getStyle(u.chart[Ee],"textSecantBg")}))}return ne+ce+he},ze=function(ne,Ee,Be){for(var ce=[],Z,he=Be&&Be.bufferInner?Be.bufferInner:0|L.PhyloCanvas.Render.Parameters.barChartBufferInner,De=Be&&Be.height?Be.height:0|L.PhyloCanvas.Render.Parameters.barChartHeight,f=Be&&Be.width?Be.width<1?V*Be.width:Be.width:0|(L.PhyloCanvas.Render.Parameters.barChartWidth<1?V*L.PhyloCanvas.Render.Parameters.barChartWidth:L.PhyloCanvas.Render.Parameters.barChartWidth),u=0,c=0;c<ee.length;c++)ce.push(ee[c].chart[Ee]);Z=Math.max.apply(null,ce),u=L.Common.roundFloat(De/Z,4);for(var c=0;c<ee.length;c++){var g=ee[c];A.draw(new L.PhyloCanvas.Render.Path(Ie(ne+he,g.y-f/2,ne+he+u*g.chart[Ee],g.y+f/2),{attr:L.PhyloCanvas.Render.Style.getStyle(g.chart[Ee],"barChart")}))}return ne+he+De};return function(ne,Ee){this.getCanvasSize=function(){return[M,G]},this.getRoot=function(){return Ee.getRoot()},Ee.getValidate()&&A.draw(0,0,Ee.getValidate()),d=!0,A=ne;var Be=Ee.getRoot(),ce=Ee.getNewickLen();if(M=A.canvasSize[0],G=A.canvasSize[1],me=C.bufferX,Ce=C.paddingX,ke=C.paddingY,l=C.minHeightBetweenLeaves,x=ke,X=Math.round((M-me-Ce*2)/ce),V=Math.round((G-ke*2)/(C.showScaleBar?Be.getCountAllChildren():Be.getCountAllChildren()-1)),V<l&&(V=l),I=Math.round(M-me-Ce*2),(L.PhyloCanvas.Render.Parameters.binaryCharts.length||L.PhyloCanvas.Render.Parameters.barCharts.length)&&(C.alignRight=!0),je(Be,Ce),C.showScaleBar&&qe(),W=I+B+C.bufferInnerLabels,L.PhyloCanvas.Render.Parameters.binaryCharts.length){var Z=L.PhyloCanvas.Render.Parameters.binaryCharts;for(var he in Z)W=Se(W,Z[he].chart,Z[he])}if(L.PhyloCanvas.Render.Parameters.barCharts.length){var De=L.PhyloCanvas.Render.Parameters.barCharts;for(var he in De)F=ze(W,De[he].chart,De[he])}ee=[],typeof bgLabelsHold!="undefined"&&(bgLabelsHold=[])}}();L.PhyloCanvas.Render.Phylogram.prototype={};L.PhyloCanvas.Render.CircularPhylogram=function(){var A,C=L.PhyloCanvas.Render.Parameters.Circular,M,G,X,V,I,l,d,x=!0,B=0,W,U,F,T=[],O=[],K,fe,J,Y=0,me,Ce=Math.PI/180;function ke(ce,Z){return Z+=me,[L.Common.roundFloat(W+ce*Math.sin(Z*Ce),4),L.Common.roundFloat(U+ce*Math.cos(Z*Ce),4)]}function ee(ce){var Z=je(90-ce-me);if(Z>90&&Z<270){Z+=180;var he="end"}else var he="start";return[Z,he]}function Ae(ce,Z,he,De){var f=ke(ce,Z),u=ke(ce,he),c=[],g,S=0;return Math.abs(je(he-Z))>180?g=1:g=-1,De&&De.invertSecant&&(g*=-1,S=1),De&&De.noMove||c.push("M"),c.push(f[0],f[1],"A",ce,ce,0,g<1?0:1,S,u[0],u[1]),c}function Ie(ce,Z,he,De){var f=[],u=ke(Z,ce),c=ke(he,ce);return De&&De.noMove||f.push("M"),f.push(u[0],u[1],"L",c[0],c[1]),f}function je(ce){for(;ce>360||ce<0;)ce>360?ce-=360:ce<0&&(ce+=360);return ce}function qe(ce,Z,he,De){if(!Z&&ce.length>1)var De=ce[3],he=ce[2],Z=ce[1],ce=ce[0];var f=ze("M",Ae(ce,he,De,{noMove:1,invertSecant:0}),"L",Ae(Z,De,he,{noMove:1,invertSecant:1}),"Z");return f}function Se(ce,Z){if(Z=Z,ce.len&&(x?B=fe||1:ce.children.length==0&&(B=L.Common.roundFloat(B+I,4))),ce.children.length>0){var he=[],De,f,u,c;if(De=Z,f=Z+=L.Common.roundFloat(V*ce.len,4),ce.name,ce.children&&ce.children.length)for(var g=0;g<ce.children.length;g++){var S=ce.children[g],N=Se(S,Z);N>0&&he.push(N)}var $=L.Common.roundFloat(Math.min.apply(null,he),4),re=L.Common.roundFloat(Math.max.apply(null,he),4);ce.level!=0&&A.draw(new L.PhyloCanvas.Render.Path(ze("M",ke(Z+.01,$),"L",Ae(Z,$,re,{noMove:!0}),"L",ke(Z+.01,re)))),ce.len&&(u=L.Common.roundFloat($+(re-$)/2,4),A.draw(new L.PhyloCanvas.Render.Path(Ie(u,De,f))))}else if(ce.y=B,T.push(ce),De=Z,f=Z=L.Common.roundFloat(Z+V*ce.len),u=B,A.draw(new L.PhyloCanvas.Render.Path(Ie(u,De,f))),A.draw(new L.PhyloCanvas.Render.Path(Ie(u,f,F),{attr:L.PhyloCanvas.Render.Style.connectedDash})),ce.name){var j=ke(F+C.bufferInnerLabels,u),ae=ee(u),pe=ae[0],ge=ae[1],R={};ce.style&&L.Common.apply(R,L.PhyloCanvas.Render.Style.getStyle(ce.style,"text")),ce.font_color_hex?R.fill=ce.font_color_hex:R.fill="#000000",R["text-anchor"]=ge,ce.uri&&(R.href=ce.uri),ce.description&&(R.title=ce.description);var Le=A.draw(new L.PhyloCanvas.Render.Text(j[0],j[1],ce.name,{attr:R,rotate:[pe,j[0],j[1]]}));ce.bgStyle&&O.push([ce.bgStyle,u]);var j=ke(f,u);L.PhyloCanvas.Render.Parameters.mouseRollOver&&L.Common.addRaphEventHandler(Le[0],"mouseover",L.PhyloCanvas.Render.Parameters.mouseRollOver,{svg:A,node:ce,x:j[0],y:j[1],textEl:Le[0]}),L.PhyloCanvas.Render.Parameters.mouseRollOut&&L.Common.addRaphEventHandler(Le[0],"mouseout",L.PhyloCanvas.Render.Parameters.mouseRollOut,{svg:A,node:ce,x:j[0],y:j[1],textEl:Le[0]}),L.PhyloCanvas.Render.Parameters.onClickAction&&L.Common.addRaphEventHandler(Le[0],"click",L.PhyloCanvas.Render.Parameters.onClickAction,{svg:A,node:ce,x:j[0],y:j[1],textEl:Le[0]}),Y=Math.max(Le[1],Y)}return x&&(x=!1),u}function ze(ce){for(var Z=ce,he=1;he<arguments.length;he++)Z=Z.concat(arguments[he]);return Z}function ne(){var ce=[];if(O.length>0){if(L.PhyloCanvas.Render.Style.jsphylosvgGradientList)for(var Z=0;Z<L.PhyloCanvas.Render.Style.jsphylosvgGradientList.length;Z++){var he=L.PhyloCanvas.Render.Style.jsphylosvgGradientList[Z],De=L.Common.createGradientEl(he,L.PhyloCanvas.Render.Style[he],[W,U,F+Y+C.bufferOuterLabels]);A.svg.defs.appendChild(De)}for(var Z=0;Z<O.length;Z++){if(Z!=O.length-1&&O[Z][0]==O[Z+1][0]){O[Z+1][2]=O[Z][2]?O[Z][2]:O[Z][1];continue}var ce=qe(F,F+Y+C.bufferOuterLabels,O[Z][2]?O[Z][2]-I/2:O[Z][1]-I/2,O[Z][1]+I/2),f=L.PhyloCanvas.Render.Style.getStyle(O[Z][0],"textSecantBg"),u=A.draw(new L.PhyloCanvas.Render.Path(ce,{attr:f.type?{}:f}));f.type&&f.type=="radialGradient"&&u[0].node.setAttribute("fill","url(#"+f.name+")"),f.type&&f.type=="radialGradient"&&u[0].node.setAttribute("stroke","none"),u[0].toBack()}}var ce=qe(F,F+Y+C.bufferOuterLabels,(fe||1)-I/2,360-I/2),u=A.draw(new L.PhyloCanvas.Render.Path(ce,{attr:L.PhyloCanvas.Render.Style.textSecantBg}));return u[0].toBack(),F+Y+C.bufferOuterLabels}function Ee(ce,Z,he){for(var De=he&&he.bufferInner?parseFloat(he.bufferInner):L.PhyloCanvas.Render.Parameters.binaryChartBufferInner,f=(he&&he.bufferSiblings?he.bufferSiblings*I:0)|(L.PhyloCanvas.Render.Parameters.binaryChartBufferSiblings<1?I*L.PhyloCanvas.Render.Parameters.binaryChartBufferSiblings:L.PhyloCanvas.Render.Parameters.binaryChartBufferSiblings),u=he&&he.thickness?parseFloat(he.thickness):L.PhyloCanvas.Render.Parameters.binaryChartThickness,c=(he&&he.disjointed?he.disjointed:!1)|L.PhyloCanvas.Render.Parameters.binaryChartDisjointed,g=he&&he.isInternal?he.isInternal:!1,S=!0,N,$=0;$<T.length;$++){var re=T[$];if((!T[$+1]||re.chart[Z]!==T[$+1].chart[Z]||c)&&re.chart[Z]!="none"){var j=L.PhyloCanvas.Render.Style.getStyle(re.chart[Z],"textSecantBg");if(g)var ae=[F-De-u,F-De,(N||re.y)-I/2+(S&&!c?0:f/2),re.y+I/2-($==T.length-1&&!c?0:f/2)];else var ae=[ce+De,ce+De+u,(N||re.y)-I/2+(S&&!c?0:f/2),re.y+I/2-($==T.length-1&&!c?0:f/2)];if(j.label){var pe=L.PhyloCanvas.Render.Style.getStyle(j.labelStyle,"text"),ge=ke((ae[0]+ae[1])/2,(ae[2]+ae[3])/2),R=ee((ae[2]+ae[3])/2),Le=je(R[0]+(pe.rotate?parseFloat(pe.rotate):0)),E=je(90-(ae[2]+ae[3])/2-me);E>90&&E<270&&(Le+=180),pe["text-anchor"]||(pe["text-anchor"]="middle"),re.font_color_hex?j.fill=re.font_color_hex:j.fill="#000000";var Re=A.draw(new L.PhyloCanvas.Render.Text(ge[0],ge[1],j.label,{attr:pe,rotate:Le}));Re[0].toBack()}if(j.borderStyle){var Ve=L.PhyloCanvas.Render.Style.getStyle(j.borderStyle,"textSecantBg"),Ye=[F,Ve.fullsize?ae[1]:ae[0],ae[2],ae[3]],Oe=A.draw(new L.PhyloCanvas.Render.Path(qe(Ye),{attr:Ve}));Oe[0].toBack()}var Ze=A.draw(new L.PhyloCanvas.Render.Path(qe(ae),{attr:j}));Ze[0].toBack(),N=0,S=!1}else N||(N=re.y),re.chart[Z]=="none"&&(N=0);S=!1}return g?ce:ce+De+u}function Be(ce,Z,he){for(var De=[],f,u=he&&he.bufferInner?parseFloat(he.bufferInner):L.PhyloCanvas.Render.Parameters.barChartBufferInner,c=he&&he.height?parseFloat(he.height):L.PhyloCanvas.Render.Parameters.barChartHeight?L.PhyloCanvas.Render.Parameters.barChartHeight:0,g=he&&he.width?parseFloat(he.width)<1?I*parseFloat(he.width):parseFloat(he.width):0|(L.PhyloCanvas.Render.Parameters.barChartWidth<1?I*L.PhyloCanvas.Render.Parameters.barChartWidth:L.PhyloCanvas.Render.Parameters.barChartWidth),S=0,N=0;N<T.length;N++)De.push(T[N].chart[Z]);f=Math.max.apply(null,De),S=L.Common.roundFloat(c/f,4);for(var N=0;N<T.length;N++){var $=T[N];$.chart[Z]>0&&A.draw(new L.PhyloCanvas.Render.Path(qe(ce+u,ce+u+S*$.chart[Z],$.y-g/2,$.y+g/2),{attr:L.PhyloCanvas.Render.Style.getStyle($.chart[Z],"barChart")}))}return ce+u+c}return function(ce,Z,he){if(this.getCanvasSize=function(){return[M,G]},this.getRoot=function(){return Z.getRoot()},Z.getValidate()){ce.draw({type:"text",x:0,y:ce.canvasSize[1]/3,text:Z.getValidate()});return}A=ce;var De=Z.getRoot(),f=Z.getNewickLen();if(M=A.canvasSize[0],G=A.canvasSize[1],W=M/2,U=G/2,X=Math.min.apply(null,[M,G]),he=C.bufferRadius>1?C.bufferRadius:L.Common.roundFloat(X*C.bufferRadius,4),fe=C.bufferAngle,d=C.innerCircleRadius,l=C.minHeightBetweenLeaves,me=C.initStartAngle,F=Math.round((X-he-d)/2),V=(F-d)/f,I=L.Common.roundFloat((360-fe)/De.getCountAllChildren(),4),Se(De,d),J=F+Y+C.bufferOuterLabels,L.PhyloCanvas.Render.Parameters.integratedBinaryCharts.length){var u=L.PhyloCanvas.Render.Parameters.integratedBinaryCharts;for(var c in u){var g=u[c].bufferInner?u[c].bufferInner:L.PhyloCanvas.Render.Parameters.binaryChartBufferInner,S=u[c].thickness?u[c].thickness:L.PhyloCanvas.Render.Parameters.binaryChartThickness;J=Ee(J-S-g,u[c].chart,u[c])}}if(J=ne(),L.PhyloCanvas.Render.Parameters.binaryCharts.length){var N=L.PhyloCanvas.Render.Parameters.binaryCharts;for(var c in N)J=Ee(J,N[c].chart,N[c])}if(L.PhyloCanvas.Render.Parameters.barCharts.length){var $=L.PhyloCanvas.Render.Parameters.barCharts;for(var c in $)J=Be(J,$[c].chart,$[c])}T=[],O=[]}}();L.PhyloCanvas.Render.CircularPhylogram.prototype={};var Lt=function(){var A=function(G){if(!!G&&typeof G=="object"){let X=function(){};return X.prototype=G,new X}},C=function(G){var X="";!!G&&typeof G=="string"&&(X=G);var V=/^((-)?([0-9]*)((\.{0,1})([0-9]+))?$)/;return V.test(X)},M={xmlToJSON:function(G){try{let d=function(F){return F.replace(/^\s+|\s+$/gm,"")},x=function(F){var T=/-/g,O=String(F).replace(T,"_");return O},B=function(F,T){if(T.attributes.length>0){var O=T.attributes.length-1,K;F._attributes=[];do K=String(x(T.attributes[O].name)),F._attributes.push(K),F[K]=d(T.attributes[O].value);while(O--)}},W=function(F){F.getNodeByAttribute=function(T,O){if(this.length>0){var K,fe=this.length-1;try{do if(K=this[fe],K[T]==O)return K;while(fe--)}catch(J){return!1}return!1}},F.contains=function(T,O){if(this.length>0){var K=this.length-1;try{do if(this[K][T]==O)return!0;while(K--)}catch(fe){return!1}return!1}},F.indexOf=function(T,O){var K=-1;if(this.length>0){var fe=this.length-1;try{do this[fe][T]==O&&(K=fe);while(fe--)}catch(J){return-1}return K}},F.SortByAttribute=function(T,O){if(this.length){let K=function(J,Y){var me=J[Y];return me=C(me)?parseFloat(me):me,me},fe=function(J,Y){var me=0,Ce,ke;return Ce=K(J,T),ke=K(Y,T),Ce<ke?me=-1:ke<Ce&&(me=1),O&&(me=O.toUpperCase()=="DESC"?0-me:me),me};this.sort(fe)}},F.SortByValue=function(T){if(this.length){let O=function(fe){var J=fe.Text;return J=C(J)?parseFloat(J):J,J},K=function(fe,J){var Y=0,me,Ce;return me=O(fe),Ce=O(J),me<Ce?Y=-1:Ce<me&&(Y=1),T&&(Y=T.toUpperCase()=="DESC"?0-Y:Y),Y};this.sort(K)}},F.SortByNode=function(T,O){if(this.length){let K=function(J,Y){var me=J[Y][0].Text;return me=C(me)?parseFloat(me):me,me},fe=function(J,Y){var me=0,Ce,ke;return Ce=K(J,T),ke=K(Y,T),Ce<ke?me=-1:ke<Ce&&(me=1),O&&(me=O.toUpperCase()=="DESC"?0-me:me),me};this.sort(fe)}}},U=function(F,T){var O,K,fe,J="";if(!T)return null;if(T.attributes.length>0&&B(F,T),F.Text="",T.hasChildNodes()){var Y=T.childNodes.length-1,me=0;do switch(K=T.childNodes[me],K.nodeType){case 1:F._children=[],O=K.localName?K.localName:K.baseName,O=x(O),J!=O&&F._children.push(O),F[O]||(F[O]=[]),fe={},F[O].push(fe),K.attributes.length>0&&B(fe,K),F[O].contains||W(F[O]),J=O,K.hasChildNodes()&&U(fe,K);break;case 3:F.Text+=d(K.nodeValue);break;case 4:F.Text+=K.text?d(K.text):d(K.nodeValue);break}while(me++<Y)}};if(!G)return null;var X={};X.typeOf="JSXBObject";var V=G.nodeType==9?G.documentElement:G;if(X.RootName=V.nodeName||"",G.nodeType==3||G.nodeType==4)return G.nodeValue;var I=function(){var F={activate:function(){var T=[];return T&&(T.getNodesByAttribute=function(O,K){if(!!T&&T.length>0){var fe=[],J,Y=T.length-1;try{do J=T[Y],J[O]===K&&fe.push(J);while(Y--);return fe.reverse(),fe}catch(me){return null}return null}},T.getNodeByAttribute=function(O,K){if(!!T&&T.length>0){var fe,J=T.length-1;try{do if(fe=T[J],fe[O]===K)return fe;while(J--)}catch(Y){return null}return null}},T.getNodesByValue=function(O){if(!!T&&T.length>0){var K=[],fe,J=T.length-1;try{do fe=T[J],!!fe.Text&&fe.Text===O&&K.push(fe);while(J--);return K}catch(Y){return null}return null}},T.contains=function(O,K){if(!!T&&T.length>0){var fe=T.length-1;try{do if(T[fe][O]===K)return!0;while(fe--)}catch(J){return!1}return!1}},T.indexOf=function(O,K){var fe=-1;if(!!T&&T.length>0){var J=T.length-1;try{do T[J][O]===K&&(fe=J);while(J--)}catch(Y){return-1}return fe}},T.SortByAttribute=function(O,K){if(!!T&&T.length>0){let fe=function(Y,me){var Ce=Y[me];return Ce=bam.validation.isNumeric(Ce)?parseFloat(Ce):Ce,Ce},J=function(Y,me){var Ce,ke;Ce=fe(Y,O),ke=fe(me,O);var ee=Ce<ke?-1:ke<Ce?1:0;return K&&(ee=K.toUpperCase()==="DESC"?0-ee:ee),ee};T.sort(J)}},T.SortByValue=function(O){if(!!T&&T.length>0){let K=function(J){var Y=J.Text;return Y=bam.validation.isNumeric(Y)?parseFloat(Y):Y,Y},fe=function(J,Y){var me,Ce;me=K(J),Ce=K(Y);var ke=me<Ce?-1:Ce<me?1:0;return O&&(ke=O.toUpperCase()==="DESC"?0-ke:ke),ke};T.sort(fe)}},T.SortByNode=function(O,K){if(!!T&&T.length>0){let fe=function(Y,me){var Ce=Y[me][0].Text;return Ce=bam.validation.isNumeric(Ce)?parseFloat(Ce):Ce,Ce},J=function(Y,me){var Ce,ke;Ce=fe(Y,O),ke=fe(me,O);var ee=Ce<ke?-1:ke<Ce?1:0;return K&&(ee=K.toUpperCase()==="DESC"?0-ee:ee),ee};T.sort(J)}}),T}};return F}(),l=function(){var F=A(I);return F.activate()};return U(X,V),G=null,V=null,X}catch(d){return null}},textToXML:function(G){var X=null;try{X=document.all?new ActiveXObject("Microsoft.XMLDOM"):new DOMParser,X.async=!1}catch(I){throw new Error("XML Parser could not be instantiated")}var V;try{document.all?V=X.loadXML(G)?X:!1:V=X.parseFromString(G,"text/xml")}catch(I){throw new Error("Error parsing XML string")}return V}};return M}();var Jt=`<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform" 
                xmlns:x="http://www.tei-c.org/ns/1.0"
                exclude-result-prefixes="x">
<xsl:output method="html"/>
<xsl:template match="x:w">
    <xsl:element name="span">
        <xsl:attribute name="data-n"><xsl:value-of select="@n"/></xsl:attribute>
        <xsl:if test="@lemma">
            <xsl:attribute name="data-normal"><xsl:value-of select="@lemma"/></xsl:attribute>
        </xsl:if>
        <xsl:if test="@emended">
            <xsl:attribute name="data-emended"><xsl:value-of select="@emended"/></xsl:attribute>
        </xsl:if>
       <xsl:choose>
           <xsl:when test="not(normalize-space(.))">
                <xsl:attribute name="class">lemma invisible</xsl:attribute>
                <xsl:text>&#x00A0;</xsl:text>
            </xsl:when>
            <xsl:otherwise>
                <xsl:attribute name="class">lemma</xsl:attribute>
            </xsl:otherwise>
        </xsl:choose>
        <xsl:apply-templates/>
    </xsl:element>
    <xsl:text>&#173;</xsl:text>
</xsl:template>
<xsl:template match="x:cl">
    <xsl:element name="span">
        <xsl:attribute name="class">group</xsl:attribute>
        <xsl:apply-templates/>
    </xsl:element>
</xsl:template>
<xsl:template match="x:pb">
    <xsl:element name="hr">
        <xsl:attribute name="data-n"><xsl:value-of select="@n"/></xsl:attribute>
    </xsl:element>
    <xsl:element name="img">
        <xsl:attribute name="class">editbutton</xsl:attribute>
        <xsl:attribute name="data-n"><xsl:value-of select="@n"/></xsl:attribute>
        <xsl:attribute name="src">edit_icon.svg</xsl:attribute>
    </xsl:element>
    <h3 class="pb" lang="en"><xsl:value-of select="@n"/></h3>
</xsl:template>

<xsl:template match="x:lb">
<br />
<span class="lb" lang="en"><xsl:value-of select="@n"/></span>
</xsl:template>

<xsl:template match="x:fw">
<div class="fw">(<i lang="en"><xsl:value-of select="@type"/>, <xsl:value-of select="@place"/></i>): <xsl:apply-templates/></div>
</xsl:template>

<xsl:template match="x:div[@type='story']">
    <span class="story" lang="en">(story no. <xsl:value-of select="@num"/>, <xsl:value-of select="@city"/>, <xsl:value-of select="@king"/>)</span>
    <xsl:apply-templates/>
</xsl:template>

<xsl:template match="x:div[@type='verse']">
    <span class="verse"><xsl:apply-templates /></span>
</xsl:template>

<xsl:template match="x:del">
    <xsl:variable name="rend" select="@rend"/>
    <xsl:element name="del">
        <xsl:attribute name="data-title">
            <xsl:text>deleted</xsl:text>
            <xsl:if test="string($rend)">
                <xsl:text> (</xsl:text>
                <xsl:value-of select="$rend"/>
                <xsl:text>)</xsl:text>
           </xsl:if>
        </xsl:attribute>
        <xsl:apply-templates/>
    </xsl:element>
</xsl:template>

<xsl:template match="x:add">
    <xsl:variable name="place" select="@place"/>
    <xsl:variable name="rend" select="@rend"/>
    <xsl:element name="ins">
        <xsl:attribute name="data-title">
            <xsl:text>added</xsl:text>
            <xsl:if test="string($rend) or string($place)">
                <xsl:text> (</xsl:text>
                <xsl:value-of select="$rend"/>
                <xsl:if test="string($rend) and string($place)">
                    <xsl:text>, </xsl:text>
                </xsl:if>
                <xsl:value-of select="$place"/>
                <xsl:text>)</xsl:text>
            </xsl:if>
        </xsl:attribute>
        <xsl:apply-templates/>
    </xsl:element>
</xsl:template>

<xsl:template match="x:subst">
    <span class="subst"><xsl:apply-templates /></span>
</xsl:template>

<xsl:template match="x:g">
    <xsl:element name="span">
        <xsl:attribute name="data-title"><xsl:value-of select="@rend"/></xsl:attribute>
        <xsl:attribute name="class">gaiji</xsl:attribute>
        <xsl:apply-templates/>
    </xsl:element>
</xsl:template>

<xsl:template match="x:lg">
  <xsl:element name="span">
    <xsl:attribute name="class">lg</xsl:attribute>
    <xsl:apply-templates/>
  </xsl:element>
</xsl:template>

<xsl:template match="x:l">
  <xsl:element name="span">
    <xsl:attribute name="class">l</xsl:attribute>
    <xsl:apply-templates/>
  </xsl:element>
</xsl:template>
</xsl:stylesheet>`;var wn=`<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
        xmlns:x="http://www.tei-c.org/ns/1.0"
        exclude-result-prefixes="x">
    <xsl:output indent="yes"/>
    <xsl:template match="x:span">
        <xsl:apply-templates/>
    </xsl:template>
    <xsl:template match="para[content-style][not(text())]">
        <xsl:value-of select="normalize-space(.)"/>
    </xsl:template>
    <xsl:template match="x:teiHeader">
        <xsl:text>&#10;&#32;&#32;&#32;&#32;</xsl:text>
            <xsl:copy><xsl:apply-templates select="node()|@*"/></xsl:copy>
    </xsl:template>
    <xsl:template match="x:xenoData">
        <xsl:text>&#10;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;</xsl:text>
            <xsl:copy><xsl:apply-templates select="node()|@*"/></xsl:copy>
        <xsl:text>&#10;&#32;&#32;&#32;&#32;</xsl:text>
    </xsl:template>
    <xsl:template match="x:TEI">
        <xsl:text>&#10;&#32;&#32;&#32;&#32;</xsl:text>
            <xsl:copy><xsl:apply-templates select="node()|@*"/></xsl:copy>
    </xsl:template>
    <xsl:template match="x:text">
        <xsl:text>&#10;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;</xsl:text>
            <xsl:copy><xsl:apply-templates select="node()|@*"/></xsl:copy>
        <xsl:text>&#10;&#32;&#32;&#32;&#32;</xsl:text>
    </xsl:template>
    <xsl:template match="x:w">
        <xsl:copy><xsl:apply-templates select="node()|@*"/></xsl:copy>
        <!--xsl:if test="not(position() = last())">
            <xsl:text>&#32;</xsl:text>
        </xsl:if-->
    </xsl:template>
    <xsl:template match="node()|@*">
        <xsl:copy>
            <xsl:apply-templates select="node()|@*"/>
        </xsl:copy>
    </xsl:template>
</xsl:stylesheet>`,Cn=`<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
        xmlns:x="http://www.tei-c.org/ns/1.0"
        exclude-result-prefixes="x">
<xsl:output method="text" omit-xml-declaration="yes"/>
    <xsl:strip-space elements="*"/>
    <xsl:template match="/">
        <xsl:apply-templates/>
    </xsl:template>
    <xsl:template match="para[content-style][not(text())]">
        <xsl:value-of select="normalize-space(.)"/>
    </xsl:template>
    <xsl:template match="x:teiCorpus">
        <xsl:apply-templates/>
    </xsl:template>
    <xsl:template match="x:TEI">
        <xsl:value-of select="@n"/><xsl:text>,</xsl:text>
        <xsl:apply-templates/>
        <xsl:text>&#xa;</xsl:text>
    </xsl:template>
    <xsl:template match="x:text">
        <xsl:apply-templates/>
    </xsl:template>
    <xsl:template match="x:w">
        <xsl:text>"</xsl:text><xsl:apply-templates/><xsl:text>"</xsl:text>
        <!--xsl:if test="not(position() = last())"-->
            <xsl:text>,</xsl:text>
        <!--/xsl:if-->
    </xsl:template>
    <!--xsl:template match="node()|@*">
        <xsl:copy>
            <xsl:apply-templates select="node()|@*"/>
        </xsl:copy>
    </xsl:template-->
</xsl:stylesheet>`,_n=`<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform" 
                xmlns:x="http://www.tei-c.org/ns/1.0"
                exclude-result-prefixes="x">
<xsl:output method="html"/>
<xsl:template match="x:teiCorpus">
    <xsl:element name="table">
        <xsl:apply-templates/>
    </xsl:element>
</xsl:template>
<xsl:template match="x:TEI">
    <xsl:apply-templates/>
</xsl:template>
<xsl:template match="x:text">
    <xsl:element name="tr">
        <xsl:attribute name="data-n"><xsl:value-of select="../@n"/></xsl:attribute>
        <xsl:if test="../@corresp">
            <xsl:attribute name="data-treename"><xsl:value-of select="../@corresp"/></xsl:attribute>
            <xsl:attribute name="data-nodename"><xsl:value-of select="../@select"/></xsl:attribute>
        </xsl:if>
        <xsl:element name="th">
            <xsl:attribute name="scope">row</xsl:attribute>
            <xsl:attribute name="draggable">true</xsl:attribute>
            <xsl:value-of select="../@n"/>
        </xsl:element>
        <xsl:apply-templates/>
    </xsl:element>
</xsl:template>
<xsl:template match="x:w">
    <xsl:element name="td">
        <xsl:choose>
            <xsl:when test="parent::x:cl">
                <xsl:choose>
                    <xsl:when test="position() = '1'">
                        <xsl:attribute name="class">lemma group-start</xsl:attribute>
                    </xsl:when>
                    <xsl:when test="position() = last()">
                        <xsl:attribute name="class">lemma group-end</xsl:attribute>
                    </xsl:when>
                    <xsl:otherwise>
                        <xsl:attribute name="class">lemma group-internal</xsl:attribute>
                    </xsl:otherwise>
                </xsl:choose>
            </xsl:when>
            <xsl:otherwise>
                <xsl:attribute name="class">lemma</xsl:attribute>
            </xsl:otherwise>
        </xsl:choose>
        <xsl:if test="@lemma">
            <xsl:attribute name="data-normal"><xsl:value-of select="@lemma"/></xsl:attribute>
        </xsl:if>
        <xsl:if test="@emended">
            <xsl:attribute name="data-emended">true</xsl:attribute>
        </xsl:if>
        <xsl:attribute name="data-n">
            <xsl:value-of select="@n"/>
        </xsl:attribute>
        <xsl:if test="@insignificant='true'">
            <xsl:attribute name="data-insignificant">true</xsl:attribute>
        </xsl:if>
        <xsl:if test="@binary='true'">
            <xsl:attribute name="data-binary">true</xsl:attribute>
        </xsl:if>
        <xsl:apply-templates/>
    </xsl:element>
</xsl:template>
</xsl:stylesheet>`;var kn=`<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform" 
                xmlns:x="http://www.w3.org/1999/xhtml"
                exclude-result-prefixes="x">
<xsl:output method="html" omit-xml-declaration="yes"/>

<xsl:template match="x:pb">
    <xsl:element name="hr">
        <xsl:attribute name="data-n"><xsl:value-of select="@n"/></xsl:attribute>
    </xsl:element>
    <xsl:element name="img">
        <xsl:attribute name="class">editbutton</xsl:attribute>
        <xsl:attribute name="data-n"><xsl:value-of select="@n"/></xsl:attribute>
        <xsl:attribute name="src">edit_icon.svg</xsl:attribute>
    </xsl:element>
    <h3 class="pb" lang="en"><xsl:value-of select="@n"/></h3>
</xsl:template>

<xsl:template match="x:lb">
<br />
<span class="lb" lang="en"><xsl:value-of select="@n"/></span>
</xsl:template>

<xsl:template match="x:fw">
<div class="fw">(<i lang="en"><xsl:value-of select="@type"/>, <xsl:value-of select="@place"/></i>): <xsl:apply-templates/></div>
</xsl:template>

<xsl:template match="x:div[@type='story']">
    <span class="story" lang="en">(story no. <xsl:value-of select="@num"/>, <xsl:value-of select="@city"/>, <xsl:value-of select="@king"/>)</span>
    <xsl:apply-templates/>
</xsl:template>

<xsl:template match="x:div[@type='verse']">
    <span class="verse"><xsl:apply-templates /></span>
</xsl:template>

<xsl:template match="x:del">
    <xsl:variable name="rend" select="@rend"/>
    <xsl:element name="del">
        <xsl:attribute name="data-title">
            <xsl:text>deleted</xsl:text>
            <xsl:if test="string($rend)">
                <xsl:text> (</xsl:text>
                <xsl:value-of select="$rend"/>
                <xsl:text>)</xsl:text>
           </xsl:if>
        </xsl:attribute>
        <xsl:apply-templates/>
    </xsl:element>
</xsl:template>

<xsl:template match="x:add">
    <xsl:variable name="place" select="@place"/>
    <xsl:variable name="rend" select="@rend"/>
    <xsl:element name="ins">
        <xsl:attribute name="data-title">
            <xsl:text>added</xsl:text>
            <xsl:if test="string($rend) or string($place)">
                <xsl:text> (</xsl:text>
                <xsl:value-of select="$rend"/>
                <xsl:if test="string($rend) and string($place)">
                    <xsl:text>, </xsl:text>
                </xsl:if>
                <xsl:value-of select="$place"/>
                <xsl:text>)</xsl:text>
            </xsl:if>
        </xsl:attribute>
        <xsl:apply-templates/>
    </xsl:element>
</xsl:template>

<xsl:template match="x:subst">
    <span class="subst"><xsl:apply-templates /></span>
</xsl:template>

<xsl:template match="x:g">
    <xsl:element name="span">
        <xsl:attribute name="data-title"><xsl:value-of select="@rend"/></xsl:attribute>
        <xsl:attribute name="class">gaiji</xsl:attribute>
        <xsl:apply-templates/>
    </xsl:element>
</xsl:template>

<xsl:template match="x:lg">
  <xsl:element name="span">
    <xsl:attribute name="class">tree-verse</xsl:attribute>
    <xsl:attribute name="lang">en</xsl:attribute>
    <xsl:text>[verse </xsl:text>
    <xsl:value-of select="@n"/>
    <xsl:text>]</xsl:text>
  </xsl:element>
</xsl:template>

<xsl:template match="x:l">
  <xsl:element name="span">
    <xsl:attribute name="class">l</xsl:attribute>
    <xsl:apply-templates/>
  </xsl:element>
</xsl:template>
</xsl:stylesheet>`,Sn=`<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform" 
                xmlns:x="http://www.w3.org/1999/xhtml"
                exclude-result-prefixes="x">
<xsl:output method="text" omit-xml-declaration="yes"/>
<xsl:template match="x:lg">
<xsl:value-of select="@n"/>
</xsl:template>
</xsl:stylesheet>
`;var An={id:"sa",leftmin:2,rightmin:2,patterns:{2:"a1e1i1o1u1Ã©1Ã­1Ã¯1Ã³1Ãº1Ã¼1Ä1Ä«1Å«1á¸·1á¸¹1á¹›1á¹1",3:"2b_2c_2d_2g_2h_2j_2k_2l_2m_2n_2p_2r_2s_2t_2v_2y_2Ã±_2Å›_2á¸_2á¸¥12á¸«12á¸·_2á¹12á¹ƒ12á¹…_2á¹‡_2á¹­_2áº–1lÌ¥1rÌ¥1",4:"2bh_2ch_2dh_2gh_2jh_2kh_2mÌ12ph_2rb_2rd_2rg_2rk_2rp_2rt_2rá¸_2rá¹­_2th_2á¸h_2á¹­h_a2i1a2u1a3Ã¯1a3Ã¼1lÌ¥Ì„1rÌ¥Ì„1"}};import{showSaveFilePicker as Qt}from"https://cdn.jsdelivr.net/npm/native-file-system-adapter/mod.js";function Ft(A){var C=[],M=0;if(this.trie=this.createTrie(A.patterns),this.leftMin=A.leftmin,this.rightMin=A.rightmin,this.exceptions={},A.exceptions)for(C=A.exceptions.split(/,\s?/g);M<C.length;M+=1)this.exceptions[C[M].replace(/\u2027/g,"").toLowerCase()]=new RegExp("("+C[M].split("â€§").join(")(")+")","i")}Ft.prototype.createTrie=function(A){var C=0,M=0,G=0,X=0,V=null,I=null,l=null,d=null,x={_points:[]},B;for(C in A)if(A.hasOwnProperty(C))for(B=A[C].match(new RegExp(".{1,"+ +C+"}","g")),M=0;M<B.length;M+=1){for(V=B[M].replace(/[0-9]/g,"").split(""),I=B[M].split(/\D/),d=x,G=0;G<V.length;G+=1)l=V[G].charCodeAt(0),d[l]||(d[l]={}),d=d[l];for(d._points=[],X=0;X<I.length;X+=1)d._points[X]=I[X]||0}return x};Ft.prototype.hyphenateText=function(A,C){C=C||4;for(var M=A.split(/([a-zA-Z0-9_\u0027\u00AD\u00DF-\u00EA\u00EB\u00EC-\u00EF\u00F1-\u00F6\u00F8-\u00FD\u0101\u0103\u0105\u0107\u0109\u010D\u010F\u0111\u0113\u0117\u0119\u011B\u011D\u011F\u0123\u0125\u012B\u012F\u0131\u0135\u0137\u013C\u013E\u0142\u0144\u0146\u0148\u0151\u0153\u0155\u0159\u015B\u015D\u015F\u0161\u0165\u016B\u016D\u016F\u0171\u0173\u017A\u017C\u017E\u017F\u0219\u021B\u02BC\u0390\u03AC-\u03CE\u03F2\u0401\u0410-\u044F\u0451\u0454\u0456\u0457\u045E\u0491\u0531-\u0556\u0561-\u0587\u0902\u0903\u0905-\u090B\u090E-\u0910\u0912\u0914-\u0928\u092A-\u0939\u093E-\u0943\u0946-\u0948\u094A-\u094D\u0982\u0983\u0985-\u098B\u098F\u0990\u0994-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BE-\u09C3\u09C7\u09C8\u09CB-\u09CD\u09D7\u0A02\u0A03\u0A05-\u0A0A\u0A0F\u0A10\u0A14-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A82\u0A83\u0A85-\u0A8B\u0A8F\u0A90\u0A94-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABE-\u0AC3\u0AC7\u0AC8\u0ACB-\u0ACD\u0B02\u0B03\u0B05-\u0B0B\u0B0F\u0B10\u0B14-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3E-\u0B43\u0B47\u0B48\u0B4B-\u0B4D\u0B57\u0B82\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB5\u0BB7-\u0BB9\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD7\u0C02\u0C03\u0C05-\u0C0B\u0C0E-\u0C10\u0C12\u0C14-\u0C28\u0C2A-\u0C33\u0C35-\u0C39\u0C3E-\u0C43\u0C46-\u0C48\u0C4A-\u0C4D\u0C82\u0C83\u0C85-\u0C8B\u0C8E-\u0C90\u0C92\u0C94-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBE-\u0CC3\u0CC6-\u0CC8\u0CCA-\u0CCD\u0D02\u0D03\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D28\u0D2A-\u0D39\u0D3E-\u0D43\u0D46-\u0D48\u0D4A-\u0D4D\u0D57\u0D60\u0D61\u0D7A-\u0D7F\u1F00-\u1F07\u1F10-\u1F15\u1F20-\u1F27\u1F30-\u1F37\u1F40-\u1F45\u1F50-\u1F57\u1F60-\u1F67\u1F70-\u1F7D\u1F80-\u1F87\u1F90-\u1F97\u1FA0-\u1FA7\u1FB2-\u1FB4\u1FB6\u1FB7\u1FBD\u1FBF\u1FC2-\u1FC4\u1FC6\u1FC7\u1FD2\u1FD3\u1FD6\u1FD7\u1FE2-\u1FE7\u1FF2-\u1FF4\u1FF6\u1FF7\u200D\u2019]+)/gi),G=0;G<M.length;G+=1)M[G].indexOf("/")!==-1?G!==0&&G!==M.length-1&&!/\s+\/|\/\s+/.test(M[G])&&(M[G]+="â€‹"):M[G].length>C&&(M[G]=this.hyphenate(M[G]).join("Â­"));return M.join("")};Ft.prototype.hyphenate=function(A){var C,M=[],G,X,V,I,l,d=[],x,B=A.toLowerCase(),W,U,F=Math.max,T=this.trie,O=[""];if(this.exceptions.hasOwnProperty(B))return A.match(this.exceptions[B]).slice(1);if(A.indexOf("Â­")!==-1)return[A];for(A="_"+A+"_",C=A.toLowerCase().split(""),G=A.split(""),x=C.length,X=0;X<x;X+=1)d[X]=0,M[X]=C[X].charCodeAt(0);for(X=0;X<x;X+=1)for(l=T,V=X;V<x&&(l=l[M[V]],l);V+=1)if(W=l._points,W)for(I=0,U=W.length;I<U;I+=1)d[X+I]=F(d[X+I],W[I]);for(X=1;X<x-1;X+=1)X>this.leftMin&&X<x-this.rightMin&&d[X]%2?O.push(G[X]):O[O.length-1]+=G[X];return O};var jn=Ft,Pn=jn;window.comboView=function(){"use strict";var A,C;let M="http://www.tei-c.org/ns/1.0";var G=new Map,X=[],V=[],I,l,d,x,B=[window],W,U=[],F=[],T=!1,O=!1;let K=["iast","devanagari","telugu","grantha","malayalam"],fe=new Pn(An),J=function(n){if(!n.startsWith("<lg"))return n;let r=Ie(Sn);return je(n,r).firstChild.data.slice(1)},Y=function(n){return n.map(r=>J(r)).join(" ").replace(/\s+/g," ").trim()},me=function(n,r,a,o){var p=r,v=a,P=n;o&&(P=P*2,P>=1&&(P-=1,p=a,v=o));let z=v.red-p.red,q=v.green-p.green,H=v.blue-p.blue,Q={red:parseInt(Math.floor(p.red+z*P),10),green:parseInt(Math.floor(p.green+q*P),10),blue:parseInt(Math.floor(p.blue+H*P),10)};return"rgb("+Q.red+","+Q.green+","+Q.blue+")"},Ce={smush:function(n,r){return n.toLowerCase().replace(/([á¸drmvynhs]) ([aÄiÄ«uÅ«á¹›eoÃ©Ã³])/g,"$1$2"+r).replace(/([kgcjá¹­á¸tdpb]) h/g,"$1â€Œ"+r+"h").replace(/([kgcjÃ±á¸tdnpbmrlyvÅ›á¹£sá¹™]) ([kgcjá¹­á¸tdnpbmyrlvÅ›á¹£shá¸»])/g,"$1"+r+"$2").replace(/([oÃ³eÃ©Ä]) ([á¹ƒ'])/g,"$1"+r+"$2").replace(/^á¹ƒ/,"'â€á¹ƒ").replace(/^á¸¥/,"'â€á¸¥").replace(/^_y/,"'â€y").replace(/Ã¼/g,"â€Œu").replace(/Ã¯/g,"â€Œi").replace(/_{1,2}(?=\s*)/g,function(a){if(a==="__")return"â€";if(a==="_")return"â€Œ"})},iast:function(n,r){let a=r||"devanagari";return et.t(n,a,"iast",{skip_sgml:!0})},devanagari:function(n,r){let a=r||"",o={skip_sgml:!0},p=n.replace(/á¹™/g,"r").replace(/^_Ä/,"à¤½â€à¤¾"),v=Ce.smush(p,a);return et.t(v,"iast","devanagari",o).replace(/Â¯/g,"ê£»")},malayalam:function(n,r){let a=r||"",o={skip_sgml:!0},p={à´•:"àµ¿",à´¤:"àµ½",à´¨:"àµ»",à´®:"àµ”",à´°:"àµ¼"},v=n.replace(/^_Ä/,"à´½â€à´¾"),P=Ce.smush(v,a).replace(/e/g,"áº½").replace(/o/g,"Ãµ").replace(/á¹™/g,"r").replace(/á¹/g,"á¹ƒ").replace(/á¸¿/g,"á¹ƒ").replace(/Ã­/g,"i").replace(/Ãº/g,"u").replace(/Ã©/g,"e");return et.t(P,"iast","malayalam",o).replace(/(^|[^àµ])à´°àµ(?=\S)/g,"$1àµ").replace(/([à´•à´¤à´¨à´®à´°])àµ(?![^\s\u200C,â€”â€™â€•])/g,function(q,H){return p[H]})},grantha:function(n,r){let a=r||"",o={skip_sgml:!0},p=new Map([["à´¸","î‡“"],["à´°","àµ¼"],["à´¯","î‡‹"],["à´š","î†¶"],["à´¦","î‡‚"],["à´¶","î‡’"]]),v=new RegExp("(["+[...p.keys()].join("")+"])àµ(?![^â€Œ ,â€”â€™â€•])","g"),P=n.replace(/^_Ä/,"à´½â€à´¾"),z=Ce.smush(P,a).replace(/e/g,"áº½").replace(/o/g,"Ãµ").replace(/á¹™/g,"r").replace(/á¹/g,"á¹ƒ").replace(/á¸¿/g,"á¹ƒ").replace(/Ã­/g,"i").replace(/Ãº/g,"u").replace(/Ã©/g,"e");return et.t(z,"iast","malayalam",o).replace(/(^|[^àµ])à´°àµ(?=\S)/g,"$1àµ").replace(v,(H,Q)=>p.get(Q)).replace(/à´•àµà´·à´¿/g,"à®•à¯à®·à®¿")},telugu:function(n,r){var a=r||"";let o={skip_sgml:!0},p=n.replace(/^_Ä/,"à°½â€à°¾"),v=Ce.smush(p,a).replace(/e/g,"áº½").replace(/o/g,"Ãµ").replace(/á¹™/g,"râ€").replace(/á¹/g,"á¹ƒ").replace(/á¸¿/g,"á¹ƒ").replace(/Ã­/g,"i").replace(/Ãº/g,"u").replace(/Ã©/g,"e");return et.t(v,"iast","telugu",o)}},ke=function(n,r,a=!1,o="sa"){let p=Ce[r],v=n.cloneNode(!0),P=function(z,q){let H=z.childNodes;for(let Q of H)if(Q.nodeType!==8){if(Q.nodeType===3){if(q!=="sa")continue;Q.data=p(Q.data,a)}else if(Q.hasChildNodes()){let oe=Q.getAttribute("lang")||q;oe==="sa"&&Q.classList.contains("subst")&&qe(Q,r),P(Q,oe)}}};return P(v,o),v},ee=function(n,r=!1){if(n.nodeType===3)return n;let a=document.createTreeWalker(n,NodeFilter.SHOW_TEXT,null,!1);if(r){let o;for(;a.nextNode();)o=a.currentNode;return o}else return a.nextNode},Ae=function(){let n=window.getSelection();if(n.isCollapsed)return!1;let r=n.rangeCount>1?n.getRangeAt(1).cloneContents():n.getRangeAt(0).cloneContents();if(!r)return!1;let a=new Set,o=r.querySelectorAll(".lemma");for(let p of o)a.add(p.dataset.n);return a},Ie=function(n){var r=new DOMParser;let a=r.parseFromString(n,"text/xml"),o=new XSLTProcessor;return o.importStylesheet(a),o},je=function(n,r){let a=C.createElementNS(M,"ab");return a.innerHTML=n,r.transformToFragment(a,document)},qe=function(n,r){if(n.firstChild.nodeType!==3&&n.lastChild.nodeType!==3)return;let a=n.childNodes,o=/^[aÄiÄ«uÅ«eoá¹›á¹á¸·á¹ƒá¸¥]/,p=/[kgá¹…cjÃ±á¹­á¸á¹‡tdnpbmyrlvá¹£Å›sh]$/,v=["Ä","i","Ä«","e","o","_","ai","au"],P=["h","k","Å›","y","g","gh","c","ch","jh","á¹­h","á¸","á¸h","t","th","d","dh","n","p","ph","bh","m","r","á¸»","v","á¹£","s"];var z=!1,q=[],H=[];let Q=a[0].nodeType===3;for(let oe of a){if(oe.nodeType>3)continue;let we=oe.textContent.trim();if(we!==""){if(we==="a"){oe.textContent="";continue}if(we.match(p)){let Te=ee(oe,!0);Te.textContent=Te.textContent.replace(/\s+$/,"")+"a",r==="telugu"&&P.indexOf(we)>=0&&q.push(oe)}if(oe===n.lastChild&&oe.nodeType===3){let Te=document.createElement("span");Te.appendChild(oe.cloneNode(!1)),n.replaceChild(Te,oe),oe=Te,oe.classList.add("aalt")}else Q&&we.match(o)&&oe.classList.add("aalt");switch(r){case"devanagari":(we==="i"||we==="Ã©")&&H.unshift(oe);break;case"grantha":case"malayalam":if(we==="e"||we==="ai")H.unshift(oe);else if(we==="o"){let Te=oe.cloneNode(!0);Se("o","e",Te),H.unshift(Te),Se("o","Ä",oe)}break;case"telugu":!z&&v.indexOf(we)>=0&&(z=!0);break}}}for(let oe of H)n.insertBefore(oe,n.firstChild);if(z)for(let oe of q){let we=ee(oe,!0);we.textContent=we.textContent+"â€à±"}},Se=function(n,r,a){let o=document.createTreeWalker(a,NodeFilter.SHOW_TEXT,null,!1);for(;o.nextNode();)o.currentNode.textContent.match(n)&&(o.currentNode.textContent=r)},ze=function(){let n=document.getElementById("tooltip");n&&n.remove()},ne=function(){let n=document.getElementById("left_menu");n.innerHTML=`<div id="matrixmenu" class="menubox">
    <div class="heading">Matrix</div>
      <ul>
        <li>select CSV/XML file(s): <input type="file" id="file" name="file" accept=".xml,.csv" multiple/></li>
      </ul>
</div>
<div style="display: none" id="mssmenu" class="menubox">
    <div class="heading">Texts</div>
    <ul class="ms">
    </ul>
</div>
<div style="display: none" id="treemenu" class="menubox">
    <div class="heading">Trees</div>
        <ul class="tree">
            <li>select NeXML file: <input type="file" id="treefile" name="treefile" accept=".xml"/></li>
        </ul>
    </div>
`;let r=document.getElementById("menu");r.addEventListener("mouseover",ge.menuMouseover),r.addEventListener("mouseout",ge.menuMouseout),r.addEventListener("click",ge.menuClick),r.querySelector("#file").addEventListener("change",u.bind(null,c),!1),r.querySelector("#treefile").addEventListener("change",u.bind(null,g),!1)},Ee={matrix:function(){return I=new Qe,I.init(),I.show(),document.getElementById("matrixmenu").style.display="none",Be(),f.rehighlight(),I},text:function(n){let r=new at(n);return V.push(r),r.init(),r.show(),Be(),f.rehighlight(),document.querySelector(".highlit")||ge.textClick({target:r.boxdiv.querySelector(".lemma:not(.invisible)")}),r},tree:function(n,r){let a=new tt(n,r);return X.push(a),a.init(),a.show(),Be(),f.rehighlight(),a}},Be=function(){for(let n of X)n.draw()},ce=function(){let n=window.getSelection?window.getSelection():document.selection;n&&(n.removeAllRanges?n.removeAllRanges():n.empty&&n.empty())},Z=function(n){if(!n||n.size===0)return;f.unHighlightAll();let[r,a]=E.lowhigh(n);if(a!==void 0)for(let o=r;o<=a;o++)f.highlightLemma(o,!0);else f.highlightLemma(r);f.repopulateTrees(r,a);for(let o of l.querySelectorAll(".text-box"))o.querySelector(".highlit")||o.querySelector('[data-n="'+r+'"]').classList.add("highlit");Le.xScroll(r)},he=function(n){let r=document.createTreeWalker(n,NodeFilter.SHOW_TEXT);for(;r.nextNode();){let a=De(r.currentNode.nodeValue);r.currentNode.nodeValue=a}},De=function(n){return fe.hyphenateText(n.replace(/ \|/g,"Â |").replace(/\| (?=\d)/g,"|Â ").replace(/\|\|/g,"à¥¥").replace(/\|/g,"à¥¤"))},f={getAllWindows:function(){return window.mainWindow?window.mainWindow.comboView.getWindows():B},forEachWindow:function(n){let r=f.getAllWindows();for(let a of r)if(!a.closed&&n(a)===!1)break},highlightLemma:function(n,r){var a=!!r;f.forEachWindow(o=>{let p=o.comboView.getViewdiv().querySelectorAll('[data-n="'+n+'"]');for(let P of p)(!a||!P.classList.contains("invisible"))&&P.classList.add("highlit");let v=o.comboView.getViewdiv().querySelectorAll('[data-n-trans="'+n+'"]');for(let P of v)P.classList.add("translit")})},highlightAll:function(){Re.anyhighlit()?f.unHighlightAll():Z(new Set([0,E.maxlemma()]))},unHighlightAll:function(){f.forEachWindow(n=>{let r=n.comboView.getViewdiv().querySelectorAll(".highlit");for(let o of r)o.classList.remove("highlit");let a=n.comboView.getViewdiv().querySelectorAll(".translit");for(let o of a)o.classList.remove("translit");f.unCelllightAll()})},unCelllightAll:function(){f.forEachWindow(n=>{let r=n.comboView.getViewdiv().querySelectorAll(".highlitcell");for(let a of r)a.classList.remove("highlitcell")})},rehighlight:function(){var n;if(f.forEachWindow(a=>{if(n=a.document.querySelectorAll(".highlit"),n.length>0)return!1}),n.length>0){var r=new Set;for(let a of n)r.add(a.dataset.n);Z(r)}},clearTrees:function(){f.forEachWindow(n=>{let r=n.comboView.getTrees();for(let a of r)a.clearlemmata()})},repopulateTrees:function(n,r){f.forEachWindow(a=>{let o=a.comboView.getTrees();for(let p of o)p.populate(n,r),p.colourizeVariants(n,r),p.updatescript()})},highlightTreeLemma:function(n){f.forEachWindow(r=>{let a=r.comboView.getTrees();for(let o of a){let p=o.boxdiv.querySelector('.tree-lemma[data-id="'+n+'"]'),v=o.boxdiv.querySelectorAll(".tree-lemma");for(let P of v)(p.dataset.nodes&&P.dataset.nodes===p.dataset.nodes||!p.dataset.nodes&&P.dataset.id===p.dataset.id)&&P.classList.add("highlit");o.clearLabels()}})},unhighlightTrees:function(){f.forEachWindow(n=>{let r=n.comboView.getViewdiv().querySelectorAll(".tree-lemma.highlit");for(let o of r)o.classList.remove("highlit");let a=n.comboView.getTrees();for(let o of a)o.clearLabels()})}},u=function(n,r){let a=r.target.files[0],o=[...r.target.files].slice(1),p=new FileReader;p.onload=n.bind(null,a,o),p.readAsText(a)},c=function(n,r,a){A=n.name,document.title=document.title+`: ${A}`,A.split(".").pop()==="csv"?N(n,r,a):$(n,r,a)},g=function(n,r,a){let o=a.target.result,v=new DOMParser().parseFromString(o,"text/xml"),P=C.querySelector("teiHeader > xenoData")||function(){let q=C.querySelector("teiHeader")||function(){let Q=C.createElementNS(M,"teiHeader");return C.documentElement.appendChild(Q),Q}(),H=C.createElementNS(M,"xenoData");return q.appendChild(H),H}(),z=C.createElementNS(M,"stemma");z.setAttribute("format","nexml"),z.id="stemma"+[...P.querySelectorAll("stemma")].length,z.appendChild(v.firstChild.cloneNode(!0)),P.appendChild(z),S(v,z.id)},S=function(n,r,a=!0){let o=n.querySelectorAll("tree"),p=document.querySelector("#treemenu ul");for(let v of o){let P=v.id,z=n.cloneNode(!0);for(let Q of z.querySelectorAll("tree"))Q.id!==P&&Q.parentNode.removeChild(Q);let q=v.getAttribute("label")||"New Tree "+G.size;G.set(`#${r} #${P}`,z);let H=document.createElement("li");H.dataset.name=q,H.dataset.treeid=P,H.dataset.stemmaid=r,H.appendChild(document.createTextNode(q)),p.insertBefore(H,p.lastElementChild),a&&Ee.tree(r,P)}},N=function(n,r,a){let o=Yt.parse(a.target.result,{delimiter:","});C=document.implementation.createDocument(M,"",null);let p=C.createElementNS(M,"teiCorpus"),v=C.createElementNS(M,"teiHeader");p.appendChild(v),C.appendChild(p);for(let P of o){let z=P[0],q=P.slice(1),H=C.createElementNS(M,"TEI");H.setAttribute("n",z);let Q=C.createElementNS(M,"text");for(let oe=0;oe<q.length;oe++){let we=q[oe],Te=C.createElementNS(M,"w");we&&Te.appendChild(document.createTextNode(we)),Te.setAttribute("n",oe),Q.appendChild(Te)}H.appendChild(Q),p.appendChild(H)}C.normalize(),x=E.maxlemma(),ae()},$=function(n,r,a){C=new DOMParser().parseFromString(a.target.result,"text/xml");let p=C.querySelectorAll("teiHeader xenoData stemma nexml");for(let v of p){let P=document.implementation.createDocument("http://www.nexml.org/2009","",null);P.appendChild(v.cloneNode(!0)),S(P,v.closest("stemma").id,!1)}x=E.maxlemma(),r.length>0?re(r):ae()},re=function(n){let r=n[0],a=n.slice(1),o=function(P,z){let q=new Set(P);for(let H of z)q.delete(H);return q},p=function(P,z){let H=new DOMParser().parseFromString(z.target.result,"text/xml"),Q=new Map;for(let He of E.teis()){let nt=He.getAttribute("n");Q.set(nt,He)}let oe=new Set(Q.keys()),we=new Map;for(let He of H.querySelectorAll("TEI")){let nt=He.getAttribute("n");we.set(nt,He)}let Te=new Set(we.keys()),Pe=o(oe,Te),Me=o(Te,oe);for(let He of Me)Ve.tei(He);let Fe=[...H.querySelector("text").querySelectorAll("w[n]")].length,Ge=x+Fe;for(let[He,nt]of we)if(Q.has(He)){let it=Q.get(He).querySelector("text"),st=nt.querySelector("text").querySelectorAll("w[n]");var Ue=x+1;for(let lt of st)lt.setAttribute("n",Ue),it.appendChild(lt),Ue=Ue+1}else{let it=C.createElementNS(M,"TEI");it.setAttribute("n",He);let rt=C.createElementNS(M,"text");Ve.emptywords(rt,Ge,0),it.appendChild(rt),C.documentElement.appendChild(it)}for(let He of Pe){let nt=Q.get(He).querySelector("text");Ve.emptywords(nt,Ge,x+1)}x=E.maxlemma(),P.length>0?re(P):ae()},v=new FileReader;v.onload=p.bind(null,a),v.readAsText(r)},j=function(){var n="";let r=[...E.teis()].map(a=>a.getAttribute("n"));for(let a of r)n+=`<li data-name="${a}">${a}</li>`;document.getElementById("menu").querySelector(".ms").innerHTML=n},ae=function(){j();let n=new Oe("Export");n.populate([{text:"TEI corpus",func:pe.showOptions.bind(null,pe.xml,pe.options)},{text:"TEI apparatus",func:pe.showOptions.bind(null,pe.xml,pe.appOptions)},{text:"CSV",func:pe.showOptions.bind(null,pe.csv,pe.options)},{text:"NEXUS",func:pe.showOptions.bind(null,pe.nexus,pe.options)}]);let r=new Oe("Edit");r.populate([{text:"Undo",greyout:Re.undo,func:R.undo},{text:"Redo",greyout:Re.redo,func:R.redo},{text:"Select all",alt:"Deselect all",toggle:Re.anyhighlit,func:f.highlightAll},{text:"(Re)normalize columns",greyout:Re.anyhighlit,func:R.startRenormalize.bind(null,!1)},{text:"Delete column",greyout:Re.anyhighlit,func:R.startRemoveCol.bind(null,!1)},{text:"Delete empty columns",func:R.startRemoveEmpty},{text:"Merge columns",greyout:Re.manyhighlit,func:R.startMerge.bind(null,!1)},{text:"Group columns",alt:"Ungroup columns",greyout:Re.oneGrouped,toggle:Re.grouped,func:R.startGroup.bind(null,!1)},{text:"Group words",func:R.doGroupWords},{text:"Edit cell",greyout:Re.highlitcell,func:R.startEditCell.bind(null,!1)},{text:"Insert row",func:R.startNewRow},{text:"Insert column",greyout:Re.anyhighlit,func:R.startInsertCol},{text:"Mark insignificant",checkbox:Re.checkbox.bind(null,"insignificant",!1),greyout:Re.anyhighlit,func:R.startMarkAs.bind(null,"insignificant",!1)},{text:"Mark binary",checkbox:Re.checkbox.bind(null,"binary",!1),greyout:Re.anyhighlit,func:R.startMarkAs.bind(null,"binary",!1)}]);let a=new Oe("View");a.populate([{text:"Header",checkbox:Re.headerView,func:Le.toggleHeader},{text:"Normalized",checkbox:Re.normalizedView,greyout:Re.anyNormalized,func:Le.toggleNormalize}]);let o=document.getElementById("left_menu");o.appendChild(a.box),o.appendChild(r.box),o.appendChild(n.box);let p=document.getElementById("views");p.style.justifyContent="flex-start",p.removeChild(p.querySelector("#splash")),Ee.matrix();let v=document.getElementById("matrixmenu");v.addEventListener("click",Ee.matrix),v.removeChild(v.querySelector("ul")),document.getElementById("mssmenu").style.display="block",document.getElementById("treemenu").style.display="block"},pe={write:async function(n,r){let a=await r.createWritable();a.write(n),a.close()},xml:async function(n){let r=Ie(wn),a=new XMLSerializer().serializeToString(r.transformToDocument(n)),o=new Blob([a],{type:"text/xml;charset=utf-8"}),p=E.basename()+".xml",v=await Qt({_preferPolyfill:!1,suggestedName:p,types:[{description:"TEI XML",accept:{"text/xml":[".xml"]}}]});pe.write(o,v)},csv:async function(n){let a=Ie(Cn).transformToDocument(n).documentElement.textContent,o=new Blob([a],{type:"text/csv;charset=utf-8"}),p=E.basename()+".csv",v=await Qt({_preferPolyfill:!1,suggestedName:p,types:[{description:"CSV file",accept:{"text/csv":[".csv"]}}]});pe.write(o,v)},nexus:async function(n){let r=[...E.texts(n)],a=r.length,o="0 1 2 3 4 5 6 7 8 9 A B C D E F G H K L M N P Q R S T U V W X Y Z a b c d e f g h k l m n p q r s t u v w x y z",[p,...v]=o.split(" "),P="-",z=r.map(Ue=>"'"+Ue.parentElement.getAttribute("n")+"'"),q=r.map(Ue=>E.textWalker(Ue)),H=r[0].querySelectorAll("w").length,Q=[],oe=z.map(Ue=>[Ue+" "]);for(let Ue=0;Ue<H;Ue++){let He=new Set,nt=[];for(let rt=0;rt<q.length;rt++){let lt=q[rt].nextNode(),ot=et.t(lt.textContent.trim().toLowerCase(),"iast","hk").replace(/'/g,"()");nt.push(ot),ot!==""&&ot!=="[]"&&He.add(ot)}Q.push(["[]",...He]);let it=new Map([...He].map((rt,st)=>[rt,v[st]]));for(let rt=0;rt<nt.length;rt++){let st=(lt=>{switch(nt[lt]){case"":return P;case"[]":return p;default:return it.get(nt[lt])}})(rt);oe[rt].push(st)}}let we=Q.map((Ue,He)=>He+1+" / "+[...Ue].map(nt=>`'${nt}'`).join(" ")).join(`,
`),Te=oe.map(Ue=>Ue.join("")).map(Ue=>Ue.replace(/0{8,}/g,He=>He.replace(/0/g,"-"))).reduce((Ue,He)=>Ue+`
`+He),Pe=`#NEXUS

BEGIN TAXA;
  DIMENSIONS NTAX=${a};
  TAXLABELS ${z.join(" ")};
END;

BEGIN CHARACTERS;
  DIMENSIONS
    NCHAR=${H};
  FORMAT 
    DATATYPE=STANDARD 
    RESPECTCASE 
    GAP=${P} 
    MISSING=? 
    SYMBOLS="${o}";
  CHARSTATELABELS
${we}
;
MATRIX
${Te}
;
END;
`,Me=new Blob([Pe],{type:"text/nexus;charset=iso8859-1"}),Fe=E.basename()+".nex",Ge=await Qt({_preferPolyfill:!1,suggestedName:Fe,types:[{description:"NEXUS file",accept:{"text/nexus":[".nex"]}}]});pe.write(Me,Ge)},processOptions:function(n){let r=C.cloneNode(!0);if(n.get("option_normalize")){let a=r.querySelectorAll("w[lemma]");for(let o of a)o.textContent=o.getAttribute("lemma")}if(n.get("option_mergegroups")){let a=r.querySelectorAll("cl");for(let o of a){let p=o.removeChild(o.firstChild);for(;o.firstChild;){let v=p.getAttribute("lemma")||p.textContent,P=o.firstChild.getAttribute("lemma")||o.firstChild.textContent;for(p.setAttribute("lemma",v+P);o.firstChild.firstChild;)p.appendChild(o.firstChild.firstChild);o.firstChild.remove()}p.getAttribute("lemma")===p.textContent&&p.removeAttribute("lemma"),o.parentNode.insertBefore(p,o),o.parentNode.removeChild(o)}}if(n.get("option_insignificant")){let a=r.querySelectorAll('w[insignificant="true"]');for(let o of a)o.parentNode.removeChild(o)}if(n.get("option_binary")){let o=[...E.firsttext().querySelectorAll('w[binary="true"]')].map(p=>p.getAttribute("n"));for(let p of o){let v=r.querySelectorAll(`w[n="${p}"]:not(:empty)`);if(v.length===0)continue;let P=`[${v[0].textContent}]`;for(let z of v)z.textContent=P}}if(n.get("option_noempty")){let a=r.querySelectorAll("w:empty");for(let o of a)o.textContent="[]"}return n.get("option_basetext")?pe.makeApp(n,r):r},makeHeader(n,r){let a=n.createElementNS(M,"teiHeader"),o=n.createElementNS(M,"fileDesc"),p=n.createElementNS(M,"sourceDesc"),v=n.createElementNS(M,"listWit");for(let P of E.teis(r)){let z=P.getAttribute("n"),q=n.createElementNS(M,"witness");q.setAttribute("xml:id",z);let H=n.createElementNS(M,"idno");H.setAttribute("type","siglum"),H.append(z),q.appendChild(H),v.appendChild(q)}return p.appendChild(v),o.appendChild(p),a.appendChild(o),a},makeApp(n,r){let a=n.get("option_basetext"),o=E.tei(a,r),p=n.get("option_app_normalize"),v=document.implementation.createDocument(M,"",null);v.appendChild(o);let P=pe.makeHeader(v,r);o.insertBefore(P,o.firstChild);let z=E.words(!1,o);for(let q of z){let H=q.getAttribute("n"),Q=p&&q.getAttribute("lemma")||q.textContent,oe=[],we=new Map,Te=E.words(H,r);for(let Pe of Te){let Me=Pe.closest("TEI").getAttribute("n");if(p&&Pe.getAttribute("lemma")===Q)oe.push(Me);else if(Pe.textContent===Q)oe.push(Me);else{let Fe=Pe.textContent===""?"[om.]":Pe.textContent,Ge=we.get(Fe)||[];Ge.push(Me),we.set(Fe,Ge)}}if(we.size===0)for(;q.firstChild;)q.parentElement.insertBefore(q.firstChild,q);else{let Pe=v.createElementNS(M,"app");Pe.setAttribute("n",H);let Me=v.createElementNS(M,"lem"),Fe=oe.map(Ge=>`#${Ge}`).join(" ");for(Fe!==""&&Me.setAttribute("wit",Fe);q.firstChild;)Me.appendChild(q.firstChild);Pe.appendChild(Me);for(let[Ge,Ue]of we){let He=v.createElementNS(M,"rdg"),nt=Ue.map(it=>`#${it}`).join(" ");He.setAttribute("wit",nt),He.append(Ge),Pe.appendChild(He)}q.parentElement.insertBefore(Pe,q),Me.textContent.match(/\s$/)&&q.parentElement.insertBefore(v.createTextNode(" "),q)}q.remove()}return v},options(){return document.createRange().createContextualFragment(`<div id="exportoptions" class="popup">
    <form id="exportform">
      <div style="font-weight: bold">Export</div>
      <div>
        <input type="checkbox" id="option_insignificant" name="option_insignificant"><label for="option_insignificant">Remove insignifiant lemmata</label>
      </div>
      <div>
        <input type="checkbox" id="option_binary" name="option_binary"><label for="option_binary">Binarize marked lemmata</label>
      </div>
      <div>
        <input type="checkbox" id="option_noempty" name="option_noempty"><label for="option_noempty">Gaps are significant</label>
      </div>
      <div>
        <input type="checkbox" id="option_mergegroups" name="option_mergegroups"><label for="option_mergegroups">Merge groups</label>
      </div>
      <div>
        <input type="checkbox" id="option_normalize" name="option_normalize"><label for="option_normalize">Normalize spellings</label>
      </div>
      <div>
        <button type="submit">Export</button>
      </div>
    </form>
</div>`)},appOptions(){let n=document.createRange().createContextualFragment(`<div id="exportoptions" class="popup">
    <form id="exportform">
      <div style="font-weight: bold">Export</div>
      <div>
        <label for="option__basetext">Base text</label>
        <select id="option__basetext" name="option_basetext"></select>
      </div>
      <div>
        <input type="checkbox" id="option__app_insignificant" name="option_app_insignificant"><label for="option_app_insignificant">Ignore insignifiant lemmata</label>
      </div>
      <div>
        <input type="checkbox" id="option_mergegroups" name="option_mergegroups" checked><label for="option_mergegroups">Merge groups</label>
      </div>
      <div>
        <input type="checkbox" id="option_app_normalize" name="option_app_normalize" checked><label for="option_app_normalize">Normalized spellings in positive apparatus</label>
      </div>
      <div>
        <input type="checkbox" id="option_normalize" name="option_normalize"><label for="option_normalize">Normalize spellings in negative apparatus</label>
      </div>
      <div>
        <button type="submit">Export</button>
      </div>
    </form>
</div>`),r=n.getElementById("option__basetext"),a=[...E.trs()].map(o=>o.dataset.n);for(let o of a){let p=document.createElement("option");p.value=o,p.append(o),r.appendChild(p)}return n},showOptions:function(n,r){let a=r(),o=document.createElement("div");o.id="blackout",o.appendChild(a),document.body.appendChild(o);let p=function(P){P.preventDefault();var z=[];let q=document.getElementById("exportform").elements;for(let Q of q)Q.type==="checkbox"?z.push([Q.name,Q.checked]):z.push([Q.name,Q.value]);let H=pe.processOptions(new Map(z));n(H),document.body.removeChild(o)};return o.querySelector("button").addEventListener("click",p),o.addEventListener("click",pe.blackoutClick),o},blackoutClick:function(n){if(!n.target.closest(".popup")){let a=document.querySelector("#blackout");a.parentNode.removeChild(a)}}},ge={selectAll(n){let r=document.createRange();r.selectNodeContents(n);let a=window.getSelection();a.removeAllRanges(),a.addRange(r)},deselect(){let n=window.getSelection();n.removeAllRanges?n.removeAllRanges():n.empty&&n.empty()},treeMouseover(n){let r=n.target.classList.contains("tree-lemma")?n.target:n.target.closest(".tree-lemma");r&&(f.highlightTreeLemma(r.dataset.id),r.addEventListener("mouseout",f.unhighlightTrees));let a=n.target.dataset.reconstructed;if(!a)return;let o=document.createElement("div");o.id="tooltip",o.style.top=n.pageY+"px",o.style.left=n.pageX+"px",o.style.opacity=0,o.style.transition="opacity 0.2s ease-in",l.parentElement.appendChild(o);let p=document.createElement("div");if(p.appendChild(document.createTextNode(a)),this.script!==0?o.appendChild(ke(p,K[this.script])):o.appendChild(p),n.target.classList.contains("reconstructed")){let v=n.target.parentNode.querySelector("span.tree-lemma");if(v&&v.dataset.hasOwnProperty("emended")){let P=document.createElement("div");P.classList.add("emphasis"),P.appendChild(document.createTextNode(v.textContent)),this.script!==0?o.prepend(ke(P,K[this.script])):o.prepend(P)}}window.getComputedStyle(o).opacity,o.style.opacity=1,n.target.addEventListener("mouseout",ze)},treeClick(n){n.target.classList.contains("witness")?Ee.text(n.target.dataset.key):n.target.classList.contains("reconstructed")?Ee.text(n.target.dataset.label):n.target.classList.contains("internal")&&R.startReconstruction(n),ze()},keyDown(n){if(!T&&n.key.substring(0,5)==="Arrow")ge.cycleVariant(n);else if(n.ctrlKey||n.metaKey)n.key==="Z"?R.redo():n.key==="z"&&R.undo();else if(!T&&I&&!I.closed&n.key==="Enter"){let r=E.highlitcell();r&&(n.preventDefault(),R.startEditCell(r))}},cycleVariant(n){let r=E.highlitcell()||l.querySelector("td.highlit")||l.querySelector('td[data-n="0"]');switch(n.key){case"ArrowRight":{if(!I.closed&&r){let a=r.nextElementSibling;a&&ge.textClick({target:a})}else{let a=l.querySelector(".highlit"),o=a?a.dataset.n:0,p=parseInt(o)+1;for(;p<=x;){let v=l.querySelectorAll('[data-n="'+p+'"]');for(let P of v)if(P&&!P.classList.contains("invisible")){ge.textClick({target:P});return}p++}}break}case"ArrowLeft":{if(!I.closed&&r){let a=r.previousElementSibling;a&&ge.textClick({target:a})}else{let a=l.querySelector(".highlit"),o=a?a.dataset.n:0,p=parseInt(o)-1;for(;p>=0;){let v=l.querySelectorAll('[data-n="'+p+'"]');for(let P of v)if(P&&!P.classList.contains("invisible")){ge.textClick({target:P});return}if(p--,r){ge.textClick({target:r.previousElementSibling});return}}}break}case"ArrowUp":{if(I.closed||!r)return;let o=r.closest("tr").previousElementSibling;if(!o||!o.dataset.n)return;let p=o.querySelector(`td[data-n="${r.dataset.n}"]`);ge.textClick({target:p});break}case"ArrowDown":{if(I.closed||!r)return;let o=r.closest("tr").nextElementSibling;if(!o||o.tagName!=="TR")return;let p=o.querySelector(`td[data-n="${r.dataset.n}"]`);ge.textClick({target:p})}}},textClick(n,r=!1){if(n.target.closest("tr.header")){ge.matrixHeaderClick(n);return}let a=n.target.classList.contains("lemma")?n.target:n.target.closest(".lemma");if(a){if(!r&&n.ctrlKey){ge.rightClick(n);return}let o=a.dataset.n,p=E.highlitrow();if(f.unHighlightAll(),f.highlightLemma(o),f.repopulateTrees(o),Le.xScroll(o,p),a.tagName==="TD")a.classList.add("highlitcell");else{let v=a.closest(".text-box");if(v){let P=v.dataset.id;E.tr(P).querySelector(`td[data-n="${o}"]`).classList.add("highlitcell")}}}},textMouseup(){let n=Ae();Z(n),ce()},menuMouseover(n){let r=n.target.classList.contains("menubox")?n.target:n.target.closest(".menubox");if(r){let a=r.querySelector("ul");a&&(a.style.display="block"),r.classList.add("open")}},menuMouseout(n){let r=n.target.classList.contains("menubox")?n.target:n.target.closest(".menubox");if(r){let a=r.querySelector("ul");a&&(a.style.display="none"),r.classList.remove("open")}},menuClick(n){!n.target.parentElement||(n.target.parentElement.className==="ms"&&(ge.menuMouseout(n),Ee.text(n.target.dataset.name)),n.target.parentElement.className==="tree"&&(ge.menuMouseout(n),n.target.closest("li[data-name]")&&Ee.tree(n.target.dataset.stemmaid,n.target.dataset.treeid)))},thDragStart(n){n.dataTransfer.setData("text/plain",n.target.textContent),R.startMoveRow(n.target.parentNode,n)},trDragEnter(n){let r=n.target.nodeType===1?n.target.closest("tr"):n.target.parentElement.closest("tr");r&&r.classList.add("dragenter")},trDragLeave(n){let r=n.target.nodeType===1?n.target.closest("tr"):n.target.parentElement.closest("tr");r&&r.classList.remove("dragenter")},trDragDrop(n){n.preventDefault(),R.finishMoveRow(n)},matrixMousedown(n){if(n.button!==0)return;if(n.ctrlKey){ge.rightClick(n);return}let r=n.target.nodeType===1?n.target.closest(".lemma"):n.target.parentElement.closest(".lemma");if(r){if(r.isContentEditable)return;f.unHighlightAll(),f.highlightLemma(r.dataset.n);let a=I.boxdiv.querySelector("table");a.addEventListener("mouseover",ge.matrixMouseover),a.addEventListener("mouseup",ge.matrixMouseup)}},matrixMouseup(){let n=E.highlit();Z(n);let r=I.boxdiv.querySelector("table");r.removeEventListener("mouseover",ge.matrixMouseover),r.removeEventListener("mouseup",ge.matrixMouseup)},matrixMouseover(n){let r=n.target.nodeType===1?n.target.closest(".lemma"):n.target.parentElement.closest(".lemma");r&&f.highlightLemma(r.dataset.n)},matrixHeaderClick(n){if(n.target.tagName!=="INPUT")return;let r=n.target.className;if(r!=="insignificant"&&r!=="binary")return;let a=n.target.closest("th").dataset.ref,o=E.firsttd(a).dataset[r]!=="true",p=new Map([[a,o]]);R.doMarkAs(r,p)},rightClick(n){let r=n.target.nodeType===1?n.target.closest("tr[data-n] th"):n.target.parentElement.closest("tr[data-n] th");if(r){n.preventDefault(),Ye.remove();let o=Ye.create(n),p=[{text:"move row",func:R.startMoveRow.bind(null,r.parentNode)},{text:"delete row",func:R.doDeleteRow.bind(null,r.parentNode.dataset.n)}];Ye.populate(o,p),Ye.show(o);return}let a=n.target.nodeType===1?n.target.closest("td.lemma"):n.target.parentElement.closest("td.lemma");if(a){n.preventDefault();let o=a.classList.contains("highlit")?function(){let P=E.highlit();return P.size===1&&!a.classList.contains("highlitcell")&&(f.unCelllightAll(),a.classList.add("highlitcell")),P}():(ge.textClick(n,!0),new Set([a.dataset.n])),p=o.size>1?[{text:"merge columns",func:R.startMerge.bind(null,o)},{text:"ungroup columns",alt:"group columns",toggle:Re.grouped,func:R.startGroup.bind(null,!1)},{text:"delete columns",func:R.startRemoveCol.bind(null,o)}]:[{text:"edit cell",func:R.startEditCell.bind(null,a)},{text:"delete column",func:R.startRemoveCol.bind(null,o)},{text:"insert column",func:R.startInsertCol}];Ye.remove();let v=Ye.create(n);Ye.populate(v,p),Ye.show(v)}}},R={undo:function(){let n=U.pop();n&&n[0](...n[1])},redo:function(){let n=F.pop();n&&n[0](...n[1])},doStack:function(n,r="do"){r==="undo"?(n[1].push("redo"),F.push(n)):r==="redo"?(n[1].push("undo"),U.push(n)):(n[1].push("undo"),U.push(n),F=[])},doMulti:function(n,r){let a=[];for(let o of n){let p=o[0](...o[1],"multido");a.unshift(p)}R.doStack([R.doMulti,[a]],r)},startMoveRow:function(n,r){if(W=n,W.classList.add("dragging"),r.type!=="dragstart"){for(let a of E.trs())a.classList.add("moveinprogress");I.boxdiv.querySelector("table").addEventListener("mousedown",R.finishMoveRow)}},startMerge:function(n){let r=n===!1?E.highlit():n,a=E.clauses(r,!0);if(!a)R.doMerge(r,"do");else if(a[0]===null){let o=a.filter(p=>p!==null).map(p=>[R.doUngroup,[p]]).concat([[R.doMerge,[r]]]);R.doMulti(o,"do")}else{let o=E.clausesToRemove(a,r);if(!o)R.doMerge(r,"do");else{let p=o.map(v=>[R.doUngroup,[v]]).concat([[R.doMerge,[r]]]);R.doMulti(p,"do")}}},startGroup:function(n){let r=n===!1?E.highlit():n;Re.grouped()?R.startUngroup(r):R.doGroup(r,"do")},startUngroup:function(n){let a=[...E.clauses(n)].map(o=>[R.doUngroup,[o]]);R.doMulti(a,"do")},startInsertCol:function(){let n=Math.max([...E.highlit()])||x;R.doInsertCol(n)},startRemoveCol:function(n){let r=n===!1?E.highlit():n,a=E.clauses(r);if(!a)R.doRemoveCol(r,"do");else{let o=E.clausesToRemove(a,r,1);if(!o)R.doRemoveCol(r,"do");else{let p=o.map(v=>[R.doUngroup,[v]]).concat([[R.doRemoveCol,[r]]]);R.doMulti(p,"do")}}},startRemoveEmpty:function(){let n=E.empty(),r=E.clauses(n);if(!r)R.doRemoveCol(n,"do");else{let a=E.clausesToRemove(r,n,1);if(!a)R.doRemoveCol(n,"do");else{let o=a.map(p=>[R.doUngroup,[p]]).concat([[R.doRemoveCol,[n]]]);R.doMulti(o,"do")}}},startEditCell:function(n){let r=n||E.highlitcell();!r||(R.unnormalize(r),r.dataset.oldContent=r.textContent,r.contentEditable="true",r.focus(),T=!0,ge.selectAll(r),r.addEventListener("blur",R.finishEditCell),r.addEventListener("keydown",R.cellKeyDown))},cellKeyDown:function(n){switch(n.key){case"Enter":R.finishEditCell(n);break;case"Escape":R.finishEditCell(n,!0);break;case"ArrowRight":{let r=E.cursorPos(n.target);r[0]===r[1]&&(n.preventDefault(),R.finishEditCell(n),ge.cycleVariant({key:"ArrowRight"}),R.startEditCell(E.highlitcell()));break}case"ArrowLeft":{E.cursorPos(n.target)[0]===0&&(n.preventDefault(),R.finishEditCell(n),ge.cycleVariant({key:"ArrowLeft"}),R.startEditCell(E.highlitcell()));break}}},startMarkAs:function(n,r,a){let o=a.target.tagName==="INPUT"?a.target:a.target.querySelector("input"),p=r===!1?E.highlit():r,v=new Map([...p].map(P=>[P,!o.checked]));R.doMarkAs(n,v)},startNewRow:function(){let n=Ve.row("new row"),r=n.querySelector("th");r.contentEditable=!0,r.addEventListener("blur",R.finishNewRow),r.addEventListener("keydown",R.thKeyDown),I.boxdiv.querySelector("tbody").appendChild(n),r.scrollIntoView(),r.focus(),document.execCommand("selectAll",!1,null),T=!0},startRenameRow:function(){},startReconstruction:function(n){let r=n.target.dataset.key,a=n.target.closest(".tree-box").myTree,o=a.desc,p=document.createElement("div");p.id="blackout";let v=document.createRange().createContextualFragment(`<div id="reconstructionoptions" class="popup">
    <form id="reconstructionform">
      <div>
        <label for="reconstructed_node_name">Label for node:</label>
        <input type="text" id="reconstructed_node_name" name="reconstructed_node_name" placeholder="${o}-${r}" size="15">
      </div>
      <div style="width: 100%; display: flex; justify-content: center;padding-top: 1em;">
        <button type="submit">Add to matrix</button>
      </div>
    </form>
</div>`);p.appendChild(v),document.body.appendChild(p);let P=function(q){q.preventDefault();let H=p.querySelector("input"),Q=H.value?H.value:H.placeholder;R.doReconstruction(a,r,Q),document.body.removeChild(p)};p.querySelector("button").addEventListener("click",P),p.addEventListener("click",pe.blackoutClick)},thKeyDown:function(n){n.key==="Enter"&&R.finishNewRow(n)},finishNewRow:function(n){let r=n.target,a=r.textContent;r.closest("tr").dataset.n=a;let o=Ve.tei(a);C.documentElement.appendChild(o),T=!1,r.contentEditable=!1,r.removeEventListener("blur",R.finishNewRow),r.removeEventListener("keydown",R.thKeyDown),R.doStack([R.doDeleteRow,[a]],"do")},finishEditCell:function(n,r=!1){let a=n.target;T=!1,a.contentEditable="false",a.removeEventListener("blur",R.finishEditCell),a.removeEventListener("keydown",R.cellKeyDown),a.blur(),ge.deselect();let o=a.textContent;if(o===""){let z=a.querySelector("br");z&&z.remove()}if(r||o===a.dataset.oldContent)return;a.hasOwnProperty("IAST")||(a.IAST=a.cloneNode(!0)),a.IAST.textContent=o;let p=parseInt(a.dataset.n),v=a.closest("tr"),P=v.dataset.n;if(R.xmlChangeCell(p,P,o),v.dataset.hasOwnProperty("treename")&&!a.dataset.hasOwnProperty("emended")){let z=R.doEmend(p,P,"multido"),q=[];q.push([R.doChangeCell,[p,P,a.dataset.oldContent]]),q.push(z),R.doStack([R.doMulti,[q]],"do")}else R.doStack([R.doChangeCell,[p,P,a.dataset.oldContent]],"do");delete a.dataset.oldContent,R.refresh(),Le.updateAllHeaders(!0),a.classList.add("highlitcell")},finishMoveRow:function(n){let r=n.target.nodeType===1?n.target.closest("tr"):n.target.parentElement.closest("tr");if(r&&R.doMoveRow(W,r,"do"),n.type!=="drop"){for(let a of E.trs())a.classList.remove("moveinprogress");I.boxdiv.querySelector("table").removeEventListener("mousedown",R.finishMoveRow)}else for(let a of E.trs())a.classList.remove("dragenter");W.classList.remove("dragging"),W=null},doReconstruction:function(n,r,a){let o=Ve.row(a,"pending");o.dataset.treename=n.name,o.dataset.nodename=r;let p=o.querySelector("th"),v=document.createElement("div");v.id="spinner",p.prepend(v);let P=Ve.tei(a);P.setAttribute("type","reconstructed"),P.setAttribute("corresp",n.name),P.setAttribute("select",`#${r}`);let z=[...E.tds(!1,o)],q=[...E.words(!1,P)];I.boxdiv.querySelector("tbody").appendChild(o),p.scrollIntoView();let H=new Blob(["("+ut.fitch.toString()+")()"],{type:"application/javascript"}),Q=new Worker(window.URL.createObjectURL(H)),oe=E.serializedtexts(n.nexml),we=E.serializedlevels(n.levels);Q.postMessage({readings:oe,levels:we,num:0,id:r}),Q.onmessage=function(Te){let Pe=Te.data.n,Me=Te.data.result;if(z[Pe].textContent=Me,z[Pe].IAST=z[Pe].cloneNode(!0),z[Pe].classList.remove("pending"),q[Pe].textContent=Me,Pe<x)Q.postMessage({readings:oe,levels:we,num:Pe+1,id:r});else{p.removeChild(v),C.documentElement.appendChild(P),Le.updateAllHeaders(),n.draw();let Fe=E.highlit();Fe.size>0&&f.repopulateTrees(...E.lowhigh(Fe));let Ge=document.getElementById("menu").querySelector(".ms"),Ue=document.createElement("li");Ue.setAttribute("data-name",a),Ue.appendChild(document.createTextNode(a)),Ge.appendChild(Ue),R.doStack([R.doDeleteRow,[a]],"do")}}},doDeleteRow:function(n,r="do"){let a=E.tr(n),o=E.tei(n),v=[...E.teis()].indexOf(o);a.parentNode.removeChild(a),o.parentNode.removeChild(o),Le.updateAllHeaders(),j(),Be(),R.doStack([R.doUndeleteRow,[a,o,v]],r)},doUndeleteRow:function(n,r,a,o="do"){let p=r.getAttribute("n"),v=[...E.teis()];if(a===v.length)C.documentElement.appendChild(r),I.boxdiv.querySelector("tbody").appendChild(n);else{let P=[...E.trs()];C.documentElement.insertBefore(r,v[a]),P[a].parentNode.insertBefore(n,P[a])}Le.updateAllHeaders(),j(),Be(),R.doStack([R.doDeleteRow,[p]],o)},doMoveRow:function(n,r,a="do"){let o=n.parentNode,p=[...E.trs()],v=n.previousElementSibling,P=p.indexOf(n),z=r!==null?p.indexOf(r):null,q=function(){r===null?o.insertBefore(n,o.firstChild):r.nextElementSibling?o.insertBefore(n,r.nextElementSibling):o.appendChild(n)},H=function(){let Q=C.documentElement,oe=[...E.teis()],we=oe[P];if(z===null)Q.insertBefore(we,oe[0]);else{let Te=oe[z];Te.nextElementSibling?Q.insertBefore(we,Te.nextElementSibling):Q.appendChild(we)}};if(q(),H(),a==="multido")return[R.doMoveRow,[n,v]];R.doStack([R.doMoveRow,[n,v]],a)},doMerge:function(n,r="do"){let a=function(P,z,q){let H=P();var Q=[];for(let oe of H){let we=[...q].map(Me=>z(Me,oe)),Te=we.map(Me=>Me.cloneNode(!0));Q.push(Te);for(let Me of we)R.unnormalize(Me);let Pe=we.reduce(function(Me,Fe){if(Fe.hasChildNodes())for(;Fe.firstChild;)Me.appendChild(Fe.firstChild);return Fe.parentNode.removeChild(Fe),Me});Pe.normalize(),Pe.dataset?(delete Pe.dataset.normal,Pe.IAST=Pe.cloneNode(!0)):Pe.removeAttribute("lemma")}return[P,z,Q]},o=a(E.trs,E.firsttd,n),p=a(E.texts,E.firstword,n),v=parseInt([...n][0]);if(R.renumber(v),R.restyleGroups(n),R.refresh(),Le.updateAllHeaders(),r==="multido")return[R.doUnmerge,[o,p]];R.doStack([R.doUnmerge,[o,p]],r)},doUnmerge:function(n,r,a="undo"){let o=function(z,q,H){let Q=E.whichattr(H[0][0]),oe=H[0].map(Me=>Me.getAttribute(Q)),we=oe[0],Te=z();for(var Pe=0;Pe<Te.length;Pe++){let Me=H[Pe].pop(),Fe=q(we,Te[Pe]);Fe.parentNode.replaceChild(Me,Fe);for(let Ge of H[Pe])Me.parentNode.insertBefore(Ge,Me)}return oe};o(...n);let p=o(...r),P=[...p].sort((z,q)=>parseInt(z)-parseInt(q))[0];if(R.renumber(P),R.reIAST(p),R.refresh(),R.restyleGroups(p),Le.updateAllHeaders(),a==="multido")return[R.doMerge,[p]];R.doStack([R.doMerge,[p]],a)},doGroup:function(n,r="do"){let a=[...n],o=a.shift(),p=E.texts();for(let P of p){let z=document.createElementNS("http://www.tei-c.org/ns/1.0","cl"),q=E.firstword(o,P);q.parentNode.insertBefore(z,q),z.appendChild(q);for(let H of n)z.appendChild(E.firstword(H,P))}let v=a.pop();for(let P of E.tds(o))P.classList.add("group-start");for(let P of E.tds(v))P.classList.add("group-end");for(let P of a)for(let z of E.tds(P))z.classList.add("group-internal");for(let P of V)P.refresh();if(r==="multido")return[R.doUngroup,[n]];R.doStack([R.doUngroup,[n]],r)},doUngroup:function(n,r="do"){let a=E.texts();for(let p of a){let v;for(let P of n){let z=E.firstword(P,p);v||(v=z.closest("cl")),v.parentNode.insertBefore(z,v)}v.parentNode.removeChild(v)}let o=[...n].map(p=>[...E.tds(p)]).reduce((p,v)=>p.concat(v),[]);for(let p of o)p.classList.remove("group-start","group-internal","group-end");for(let p of V)p.refresh();if(r==="multido")return[R.doGroup,[n]];R.doStack([R.doGroup,[n]],r)},doGroupWords:function(){let n=0,r=[];for(let a=0;a<=x;a++){let o=E.tds(a),p=o[0].classList;if(p.contains("group-start")||p.contains("group-internal")||p.contains("group-end")){n=a+1;continue}let v=o.length,P=0;if(a===x)P=v;else for(let z of o)(z.IAST?z.IAST.textContent:z.textContent).slice(-1)===" "&&P++;if(P/v>=.5)if(n===a){n++;continue}else{let z=E.range(n,a);r.push([R.doGroup,[z]]),n=a+1}}R.doMulti(r)},doRemoveCol:function(n,r="do"){let a=function(z,q,H){let Q=z();var oe=[];for(let we of Q){let Te=[...H].map(Me=>{let Fe=q(Me,we);return R.unnormalize(Fe),Fe}),Pe=Te.map(Me=>Me.cloneNode(!0));oe.push(Pe);for(let Me of Te)Me.parentNode.removeChild(Me)}return[z,q,oe]},o=a(E.trs,E.firsttd,n),p=a(E.texts,E.firstword,n),v=[...n].sort((z,q)=>parseInt(z)-parseInt(q)),P=parseInt([...v][0])-1;if(R.renumber(P),R.refresh(),R.restyleGroups(n,!0),Le.updateAllHeaders(),r==="multido")return[R.doUnremoveCol,[o,p]];R.doStack([R.doUnremoveCol,[o,p]],r)},doUnremoveCol:function(n,r,a){let o=function(q,H,Q){let oe=E.whichattr(Q[0][0]),we=Q[0].map(Fe=>Fe.getAttribute(oe)),Te=we[0],Pe=q();for(var Me=0;Me<Pe.length;Me++){let Fe=H(Te,Pe[Me]);for(let Ge of Q[Me])Fe.parentNode.insertBefore(Ge,Fe)}return we};o(...n);let p=o(...r),v=[...p].sort((q,H)=>parseInt(q)-parseInt(H)),P=parseInt(v[0])-1;R.renumber(P);let z=document.querySelectorAll(".highlitcell");for(let q of z)q.classList.remove("highlitcell");if(R.reIAST(p),R.refresh(),R.restyleGroups(p,!0),Le.updateAllHeaders(),a==="multido")return[R.doRemoveCol,[p]];R.doStack([R.doRemoveCol,[p]],a)},doInsertCol:function(n,r="do"){let a=function(p,v,P,z){let q=p();for(let H of q){let Q=v(z,H),oe=P(z+1);Q.insertAdjacentElement("afterend",oe)}};a(E.trs,E.firsttd,Ve.emptycell,n),a(E.texts,E.firstword,Ve.emptyword,n),R.renumber(n),R.refresh(),R.restyleGroups([n,n+1],!0),Le.updateAllHeaders();let o=[n+1];if(r==="multido")return[R.doRemoveCol,[o]];R.doStack([R.doRemoveCol,[o]],r)},doEmend:function(n,r,a="do"){let o=[...E.trs()][r],p=E.firsttd(n,o);p.dataset.emended=!0;let v=E.tei(r).querySelector("text");if(E.firstword(n,v).setAttribute("emended","true"),a==="multido")return[R.doUnemend,[n,r]];R.doStack([R.doUnemend,[n,r]],a)},doUnemend:function(n,r,a="do"){let o=[...E.trs()][r],p=E.firsttd(n,o);delete p.dataset.emended;let v=E.tei(r).querySelector("text");if(E.firstword(n,v).removeAttribute("emended"),a==="multido")return[R.doEmend,[n,r]];R.doStack([R.doEmend,[n,r]],a)},doChangeCell:function(n,r,a,o="do"){let p=R.xmlChangeCell(n,r,a),v=R.htmlChangeCell(n,r,a);if(R.refresh(),Le.updateAllHeaders(!0),ge.textClick({target:v}),o==="multido")return[R.doChangeCell,[n,r,p]];R.doStack([R.doChangeCell,[n,r,p]],o)},htmlChangeCell:function(n,r,a){let o=E.tr(r),p=E.firsttd(n,o);return R.unnormalize(p),p.textContent=a,p.IAST&&(p.IAST=p.cloneNode(!0)),p},xmlChangeCell:function(n,r,a){let o=E.tei(r).querySelector("text"),p=E.firstword(n,o);R.unnormalize(p);let v=p.textContent;return p.childNodes.length===0?p.appendChild(document.createTextNode(a)):p.textContent=a,v},doMarkAs:function(n,r,a="do"){let o=[...r.keys()],p=E.attr(n,o);for(let v of o){let P=E.tds(v),z=E.words(v);if(r.get(v)===!0){for(let H of P)H.dataset[n]="true";for(let H of z)H.setAttribute(n,"true")}else{for(let H of P)delete H.dataset[n];for(let H of z)H.removeAttribute(n)}let q=E.checkbox(v,n);q.checked=r.get(v)}if(a==="multido")return[R.doMarkAs,[n,p]];R.doStack([R.doMarkAs,[n,p]],a)},refresh:function(){for(let n of V)n.refresh();f.rehighlight(),Re.anyhighlit()?f.repopulateTrees(...E.lowhigh(E.highlit())):f.clearTrees()},renumber:function(n=0){let r=function(a,o,p){let v=a();for(let z of v){let q=[...o(!1,z)],H=E.whichattr(q[0]);for(var P=parseInt(p)+1;P<q.length;P++)q[P].setAttribute(H,P)}};r(E.trs,E.tds,n),r(()=>[!0],E.ths,n),r(E.texts,E.words,n),x=E.maxlemma()},reIAST:function(n){let r=[...n].map(a=>[...E.lemmata(a)]).flat();for(let a of r)a.IAST=a.cloneNode(!0)},restyleGroups:function(n,r=!1){let o=r?function(v){var P=[...v];let z=parseInt(n[0])-1,q=parseInt(n[n.length-1])+1;return P.unshift(z),P.push(q),P}(n):n,p=function(v,P=!1){let z=new Set(["group-start","group-internal","group-end"]);P&&z.delete(P);for(let q of v){for(let H of z)q.classList.remove(H);P&&q.classList.add(P)}};for(let v of o){let P=E.firstword(v),z=E.tds(v);if(z.length===0)continue;let q=P.closest("cl");q?P===q.firstElementChild?p(z,"group-start"):P===q.lastElementChild?p(z,"group-end"):p(z,"group-internal"):p(z)}},startRenormalize:function(n){let r=n===!1?E.highlit():n;R.doRenormalize(Math.min(...r),Math.max(...r))},doRenormalize:function(n,r,a=!1,o="do"){let p=Re.normalizedView(),v=new Map,P=[...E.trs()],z=[...E.texts()],q=a?[a]:[...P.keys()];for(let H of q){let Q=new Map,oe=z[H],we=[...E.words(!1,oe)],Te=E.firstword(n,oe),Pe=E.firstword(r,oe),Me=we.indexOf(Te),Fe=we.indexOf(Pe),Ge=we.slice(Me,Fe+1),Ue=P[H],nt=[...E.tds(!1,Ue)].slice(Me,Fe+1),it=Ge.map(st=>st.textContent),rt=bn(it);for(let st=0;st<rt.length;st++){let lt=Ge[st],ot=rt[st],_t=it[st],ft=nt[st],xt=lt.hasAttribute("lemma")?lt.getAttribute("lemma"):!1;if(xt!==!1){if(xt===ot)continue;Q.set(ft.dataset.n,xt),R.unnormalize(lt),R.unnormalize(ft)}else Q.set(ft.dataset.n,null);ot!==_t&&(lt.setAttribute("lemma",ot),ft.dataset.normal=ot,p&&(ft.textContent=ot))}v.set(H,Q)}Le.updateAllHeaders(!0),Le.xScrollToHighlit(),R.doStack([R.doUnrenormalize,[v]],o)},doUnrenormalize:function(n,r="undo"){let a=Re.normalizedView(),o=new Map,p=[...E.trs()],v=[...E.texts()];for(let[P,z]of n.entries()){let q=p[P],H=v[P],Q=new Map;for(let[oe,we]of z.entries()){let Te=E.firsttd(oe,q),Pe=E.firstword(oe,H),Me=Pe.hasAttribute("lemma")?Pe.getAttribute("lemma"):null;Q.set(oe,Me),we===null?(R.unnormalize(Te),R.unnormalize(Pe)):(Te.dataset.normal=we,Pe.setAttribute("lemma",we),a&&(Te.textContent=we))}o.set(P,Q)}R.doStack([R.doUnrenormalize,[o]],r)},unnormalize:function(n){n.hasOwnProperty("IAST")&&(n.textContent=n.IAST.textContent),n.dataset&&n.dataset.hasOwnProperty("normal")&&delete n.dataset.normal,n.getAttribute("lemma")&&n.removeAttribute("lemma")}},Le={toggleNormalize:function(){Re.normalizedView()?Le.showUnnormalized():Le.showNormalized()},showNormalized:function(n){if(n)n.updatescript();else{document.getElementById("views").classList.add("normalized");for(let a of V)a.updatescript();I.updatescript(),Re.anyhighlit()?f.repopulateTrees(...E.lowhigh(E.highlit())):f.clearTrees()}Le.updateAllHeaders(!0),Le.xScrollToHighlit()},showUnnormalized:function(){document.getElementById("views").classList.remove("normalized"),I.updatescript();for(let n of V)n.updatescript();Re.anyhighlit()?f.repopulateTrees(...E.lowhigh(E.highlit())):f.clearTrees(),Le.updateAllHeaders(!0),Le.xScrollToHighlit()},toggleHeader:function(){let n=I.boxdiv.querySelector("tr.header");n.style.display==="none"?n.style.display="table-row":n.style.display="none"},updateHeaders(n){for(let r of n){let a=E.firstth(r),[o,p]=E.readings(r),v=a.querySelector("span.readings"),P=o<2?o:`${o}(${p.size})`;v.textContent=P}},updateAllHeaders(n=!1){let r=[...E.trs()],a=r.map(z=>E.trWalker(z)),o=[...E.tds(!1,r[0])],p=[...E.ths()],v=I.boxdiv.querySelector("tr.header"),P=function(){let z=document.createElement("th"),q=document.createElement("span");q.classList.add("readings"),z.appendChild(q);let H=document.createElement("form");return H.innerHTML='<div><input class="insignificant" type="checkbox">Insignificant</div><div><input class="binary" type="checkbox">Binary</div>',z.appendChild(H),v.appendChild(z),z};for(let z=0;z<o.length;z++){let q=z>=p.length?P():p[z],H=o[z];q.dataset.ref=H.dataset.n;let Q=0,oe=new Set;for(let Te of a){let Pe=Te.nextNode().textContent;Pe!==""&&(Q++,oe.add(Pe))}let we=Q<2?Q:`${Q}(${oe.size})`;q.querySelector("span.readings").textContent=we,n||(q.querySelector("input.insignificant").checked=!!H.dataset.insignificant,q.querySelector("input.binary").checked=!!H.dataset.binary)}if(p.length>o.length)for(let z=o.length;z<p.length;z++)v.removeChild(p[z])},xScrollToHighlit:function(){let n=E.highlit();n.size>0&&Le.xScroll([...n][0])},xScroll:function(n,r){if(!n)return;let a=r||E.firsttr(),o=E.firsttd(n,a),p=o.getBoundingClientRect(),v=I.boxdiv,z=v.getBoundingClientRect().right,q=a.querySelector("th").getBoundingClientRect(),H=q.right,Q=p.right>z,oe=p.left+.1<H;Q&&o.scrollIntoView({inline:"end",block:"nearest"}),oe&&(o.scrollIntoView({inline:"start",block:"nearest"}),v.scroll({left:v.scrollLeft-q.width}))}},E={basename:function(){return A.split(/\.[^.]+$/)[0]},range:function(n,r){return Array.from(Array(parseInt(r)-parseInt(n)+1).keys(),a=>a+n)},maxlemma:function(){return[...E.firsttext().querySelectorAll("w[n]")].length-1},lemmata:function(n,r){let a=r||document.querySelector("#views");return n===!1?a.querySelectorAll(".lemma"):a.querySelectorAll(`.lemma[data-n="${n}"]`)},tds:function(n,r){let a=r||I.boxdiv;return n===!1?a.querySelectorAll("td[data-n]"):a.querySelectorAll(`td[data-n="${n}"]`)},firsttd:function(n,r){return(r||I.boxdiv).querySelector(`td[data-n="${n}"]`)},tr:function(n){return I.boxdiv.querySelector(`tr[data-n="${n}"]`)},trs:function(n){return(n||I.boxdiv).querySelectorAll("tr[data-n]")},firsttr:function(n){return(n||I.boxdiv).querySelector("tr[data-n]")},lasttr:function(n){return(n||I.boxdiv).querySelector("tr[data-n]:last-of-type")},trWalker:function(n){return document.createNodeIterator(n,NodeFilter.SHOW_ELEMENT,{acceptNode:function(r){if(r.tagName==="TD")return NodeFilter.FILTER_ACCEPT}},!1)},textWalker:function(n){return document.createNodeIterator(n,NodeFilter.SHOW_ELEMENT,{acceptNode:function(r){if(r.tagName.toLowerCase()==="w")return NodeFilter.FILTER_ACCEPT}},!1)},tei:function(n,r=C){return r.querySelector(`TEI[n="${n}"]`)},teis:function(n=C){return n.querySelectorAll("TEI")},texts:function(n){return(n||C).querySelectorAll("text")},serializedtexts:function(n){let r=[...n.querySelectorAll("otu[label]")].map(o=>o.getAttribute("label")),a=[...E.teis()].filter(o=>r.indexOf(o.getAttribute("n"))!==-1);return new Map(a.map(o=>[n.querySelector(`node[label="${o.getAttribute("n")}"]`).getAttribute("id"),[...o.querySelectorAll("w")].map(p=>Re.normalizedView()&&p.hasAttribute("lemma")?p.getAttribute("lemma"):p.textContent)]))},serializedlevels:function(n){return n.map(r=>{if(r instanceof Map){let a=new Map;for(let[o,p]of r)a.set(o.getAttribute("id"),p.map(v=>v.getAttribute("id")));return a}else return r.map(a=>a.getAttribute("id"))})},firsttext:function(n){return n?C.querySelector(`[n="${n}"] text`):C.querySelector("text")},words:function(n,r){let a=r||C;return n===!1?a.querySelectorAll("w[n]"):a.querySelectorAll(`w[n="${n}"]`)},firstword:function(n,r){return(r||C).querySelector(`w[n="${n}"]`)},normal:function(n){return(n||document.getElementById("views")).querySelectorAll(".lemma[data-normal], .tree-lemma[data-normal]")},htmlreading:function(n){return Re.normalizedView()&&n.dataset.normal?n.dataset.normal:n.IAST.textContent},xmlreading:function(n,r){let a=C.querySelector(`TEI[n="${n}"] > text > w[n="${r}"]`);return Re.normalizedView()&&a.hasAttribute("lemma")?a.getAttribute("lemma"):a.textContent},xmlreadings:function(n){return[...C.querySelectorAll(`TEI[n="${n}"] > text > w`)].map(a=>{Re.normalizedView()&&a.hasAttribute("lemma")?a.getAttribute("lemma"):a.textContent})},ths:function(){return I.boxdiv.querySelectorAll("th[data-ref]")},firstth:function(n){return I.boxdiv.querySelector(`th[data-ref="${n}"]`)},checkbox:function(n,r){return I.boxdiv.querySelector(`th[data-ref="${n}"] input.${r}`)},highlit:function(){let r=E.firsttr().querySelectorAll(".highlit"),a=new Set;for(let o of r)a.add(o.dataset.n);return a},highlitcell:function(){return I.boxdiv.querySelector("td.highlitcell")},highlitrow:function(){let n=E.highlitcell();return n?n.closest("tr"):!1},lowhigh:function(n){let r=[...n].sort((p,v)=>parseInt(p)-parseInt(v)),a=parseInt(r[0]),o=r.length>1?parseInt(r[r.length-1]):void 0;return[a,o]},readings:function(n,r){let a=r||I.boxdiv,o=E.tds(n,a);var p=0;let v=new Set;for(let P of o){let z=P.textContent;z!==""&&(p++,v.add(z))}return[p,v.size]},attr:function(n,r){let a=E.firsttr();var o=[];for(let p of r)E.firsttd(p,a).dataset[n]==="true"?o.push([p,!0]):o.push([p,!1]);return new Map(o)},whichattr:function(n){return n.hasAttribute("n")?"n":n.hasAttribute("data-n")?"data-n":n.hasAttribute("data-ref")?"data-ref":!1},clauses:function(n,r=!1){let a=E.firsttext();var o=!1;let p=new Set;for(let v of n){let z=E.firstword(v,a).closest("cl");z?p.add(z):r&&(o=!0)}if(p.size===0)return!1;{let v=[...p].map(P=>{let z=P.querySelectorAll("w");return new Set([...z].map(q=>q.getAttribute("n")))});return o?[null].concat(v):v}},clausesToRemove:function(n,r,a=0){let o=new Set;for(let p of n){let v=new Set(p);for(let P of r)v.delete(P);v.size<=a&&o.add(p)}return[...o]},empty:function(){let n=new Set,r=[...E.trs()],a=r.map(v=>E.trWalker(v)),o=r[0].querySelector("td:last-of-type").dataset.n;for(let v=0;v<=o;v++){var p=!0;for(let P of a){let z=P.nextNode();p&&z.textContent!==""&&(p=!1)}p&&n.add(v)}return n},prevNonempty:function(n,r){for(let a=n;a>=0;a--)if(r[a].textContent!=="")return a;return!1},nextNonempty:function(n,r){for(let a=n;a<r.length;a++)if(r[a].textContent!=="")return a;return!1},setIntersection:function(...n){let r=n[0];return new Set([...r].filter(a=>{for(let o=1;o<n.length;o++)if(!n[o].has(a))return!1;return!0}))},setUnion:function(...n){return new Set(n.reduce((r,a)=>(r=[...r,...a],r),[]))},cursorPos(n){let r=window.getSelection().getRangeAt(0),a=r.cloneRange();a.selectNodeContents(n);let o=a.toString().length;return a.setEnd(r.endContainer,r.endOffset),[a.toString().length,o]}},Re={undo:function(){return U.length>0},redo:function(){return F.length>0},checkbox:function(n,r){if(!Re.anyhighlit())return!1;let a=r===!1?E.highlit():r,o=E.attr(n,a);for(let p of o.values())if(p===!1)return!1;return!0},grouped:function(){let n=E.highlit();if(!n)return!1;let r=E.firsttr();for(let a of n){let o=E.firsttd(a,r);if(o.classList.contains("group-start")||o.classList.contains("group-internal")||o.classList.contains("group-end"))return!0}return!1},oneGrouped:function(){let n=E.highlit();if(n.size===0)return!1;if(n.size===1){let r=E.firsttr(),a=E.firsttd([...n][0],r);return!!(a.classList.contains("group-start")||a.classList.contains("group-end")||a.classList.contains("group-internal"))}return!0},anyhighlit:function(){return!!I.boxdiv.querySelector("td.highlit")},manyhighlit:function(){return E.highlit().size>1},highlitcell:function(){return!!I.boxdiv.querySelector("td.highlitcell")},normalizedView:function(){return document.getElementById("views").classList.contains("normalized")},anyNormalized:function(){return O||I.boxdiv.querySelector(".lemma[data-normal]")},headerView:function(){return I.boxdiv.querySelector("tr.header").style.display!=="none"}},Ve={tei:function(n){let r=C.createElementNS(M,"TEI");r.setAttribute("n",n);let a=E.firsttext().cloneNode(!0);r.appendChild(a);for(let o of E.words(!1,a))for(o.removeAttribute("lemma");o.firstChild;)o.firstChild.remove();return r},emptycell:function(n){let r=document.createElement("td");return r.className="lemma",r.dataset.n=n,r},emptyword:function(n,r=C){let a=r.createElementNS(M,"w");return a.setAttribute("n",n),a},emptywords:function(n,r,a){let o=r||x,p=a||0;for(let v=p;v<=o;v++){let P=Ve.emptyword(v);n.appendChild(P)}},row:function(n,r){let a=document.createElement("tr"),o=document.createElement("th");o.scope="row",o.draggable=!0,o.appendChild(document.createTextNode(n)),o.addEventListener("dragstart",ge.thDragStart),a.dataset.n=n,a.appendChild(o);let p=E.firsttr();for(let v of p.querySelectorAll("td")){let P=document.createElement("td");P.dataset.n=v.dataset.n,P.className=v.className,r&&P.classList.add(r),a.appendChild(P)}return a}},Ye={create:function(n){let r=document.createElement("div");return r.classList.add("contextmenu"),r.style.left=n.clientX-12+"px",r.style.top=n.clientY-22+"px",r},remove:function(){for(let n of document.querySelectorAll(".contextmenu"))n.parentNode.removeChild(n)},show:function(n){document.body.appendChild(n)},populate:function(n,r){let a=document.createElement("ul");for(let o of r){let p=document.createElement("li");if(o.hasOwnProperty("cond")){let v=document.createRange().createContextualFragment('<form><input type="checkbox"'+(o.cond()?" checked":"")+"></form>");p.appendChild(v)}if(o.hasOwnProperty("toggle")){let v=o.toggle()?o.text:o.alt;p.appendChild(document.createTextNode(v))}else p.appendChild(document.createTextNode(o.text));p.addEventListener("mouseup",o.func),a.appendChild(p)}n.appendChild(a)}};class Oe{constructor(r){this.name=r,this.box=document.createElement("div"),this.box.classList.add("menubox");let a=document.createElement("div");a.classList.add("heading"),a.appendChild(document.createTextNode(r)),this.box.appendChild(a),a.addEventListener("mouseover",this.checkConditions.bind(this)),this.box.addEventListener("mouseup",this.click.bind(this)),this.items=new Map,this.conditions=new Map}populate(r){let a=this.box.querySelector("ul")||function(o){let p=document.createElement("ul");return o.box.appendChild(p),p}(this);for(let o of r){let p=document.createElement("li");if(o.hasOwnProperty("checkbox")){let v=document.createElement("form"),P=document.createElement("input");P.type="checkbox",P.addEventListener("click",z=>z.preventDefault()),v.appendChild(P),p.appendChild(v),p.appendChild(document.createTextNode(o.text)),this.conditions.set(P,o.checkbox)}else if(o.hasOwnProperty("toggle")){let v=document.createElement("span");v.appendChild(document.createTextNode(o.text)),v.dataset.text=o.text,v.dataset.alt=o.alt,this.conditions.set(v,o.toggle),p.appendChild(v)}else p.appendChild(document.createTextNode(o.text));o.hasOwnProperty("greyout")&&this.conditions.set(p,o.greyout),this.items.set(p,o.func),a.appendChild(p)}}click(r){let a=r.target.tagName==="LI"?r.target:r.target.closest("li");if(a&&!a.classList.contains("greyedout")){let o=this.items.get(a);o&&(o(r),this.checkConditions())}}checkConditions(){let r=new Map;for(let[a,o]of this.conditions){let p=r.get(o)||function(){let v=o();return r.set(o,v),v}();a.tagName==="INPUT"?a.checked=p:a.tagName==="SPAN"?p?a.textContent=a.dataset.alt:a.textContent=a.dataset.text:a.tagName==="LI"&&(p?a.classList.remove("greyedout"):a.classList.add("greyedout"))}}}class Ze{constructor(r){this.name=r,this.script=0}show(){d.appendChild(this.descbox),Re.normalizedView()&&Le.showNormalized(this),l.appendChild(this.boxdiv),this.closed=!1}clear(){for(;this.boxdiv.firstChild;)this.boxdiv.removeChild(this.boxdiv.firstChild);this.svgcontainer&&(this.clearsvg(),this.boxdiv.appendChild(this.svgcontainer))}destroy(){l.removeChild(this.boxdiv),d.removeChild(this.descbox);let r=X.indexOf(this);r>-1&&X.splice(r,1);let a=V.indexOf(this);a>-1&&V.splice(a,1),this.closed=!0,this.name==="Matrix"&&(document.getElementById("matrixmenu").style.display="block"),Be(),f.rehighlight()}pullout(){this.destroy();let r="menubar=no,location=no,status=no,height=620,width=620,scrollbars=yes,centerscreen=yes",a=window.mainWindow?window.mainWindow.comboView.getWindows().length:B.length,o=window.open("slave.html","slave"+a,r);o.mainWindow=window.mainWindow?window.mainWindow:window,o.startbox=this.text?{text:{name:this.name}}:{tree:this.name},o.mainWindow.comboView.addWindow(o)}makeDescBox(){let r=document.createElement("div"),a=document.createElement("div");a.classList.add("closer"),a.innerHTML="x",a.title="close";let o=document.createElement("div");o.classList.add("scripter"),o.innerHTML="A",o.title="change script",r.appendChild(a),r.appendChild(o),r.appendChild(document.createTextNode(this.desc)),this.descbox=r,a.addEventListener("click",this.destroy.bind(this)),o.addEventListener("click",this.cyclescript.bind(this))}cyclescript(){this.script=this.script+1,this.script===K.length&&(this.script=0);let r=this.descbox.querySelector(".scripter");this.script===0?r.innerHTML="A":r.innerHTML=Ce[K[this.script]]("a"),K[this.script]==="grantha"?r.classList.add("grantha"):r.classList.remove("grantha"),this.updatescript()}updatescript(){let r=this.boxdiv.querySelectorAll(".lemma,.tree-lemma");for(let a of r){let o=a.dataset.hasOwnProperty("normal");if(!o&&a.textContent.trim()==="")continue;let p=function(){if(Re.normalizedView()&&o){let P=document.createElement("span");return P.appendChild(document.createTextNode(a.dataset.normal)),P}else return a.IAST.cloneNode(!0)}(),v=this.script===0?p:ke(p,K[this.script]);for(a.innerHTML="";v.firstChild;)a.appendChild(v.firstChild)}K[this.script]==="grantha"?this.boxdiv.classList.add("grantha"):this.boxdiv.classList.remove("grantha"),this.boxdiv.classList.contains("matrix")&&Le.xScrollToHighlit()}}class tt extends Ze{constructor(r,a){super(`#${r} #${a}`);this.stemmaid=r,this.id=a,this.nexml=G.get(this.name).cloneNode(!0),this.desc=this.nexml.querySelector("tree").getAttribute("label")}init(){this.makeDescBox();let r=document.createElement("div");r.classList.add("tree-box");var a,o=0;do a="tree"+o,o++;while(document.getElementById(a));r.id=a,this.boxdiv=r,this.boxdiv.addEventListener("mouseover",ge.treeMouseover.bind(this)),this.boxdiv.addEventListener("click",ge.treeClick),this.svgcontainer=document.createElement("div"),this.svgcontainer.id=this.boxdiv.id+"container",this.boxdiv.appendChild(this.svgcontainer),this.boxdiv.myTree=this,this.calcPaths(),this.jiggleroot(),this.findLevels(),this.labelInternal()}show(){d.appendChild(this.descbox),l.appendChild(this.boxdiv)}jiggleroot(){let r=this.nexml.evaluate('//nex:node[@root="true"]',this.nexml,this.nsResolver,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue,a=this.nexml.evaluate('//nex:edge[@source="'+r.id+'"]|//nex:edge[@target="'+r.id+'"]',this.nexml,this.nsResolver,XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE,null);if(a.snapshotLength===3){var o,p;for(let v=0;v<a.snapshotLength;v++){let P=a.snapshotItem(v),z=P.getAttribute("source"),q=P.getAttribute("target"),H=this.nexml.evaluate('//nex:node[@id="'+z+'"]',this.nexml,this.nsResolver,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue,Q=this.nexml.evaluate('//nex:node[@id="'+q+'"]',this.nexml,this.nsResolver,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue;if(!H.hasAttribute("otu")&&!Q.hasAttribute("otu")){o=P,p=q===r.id?"target":"source";break}}if(o){let v=this.nexml.createElementNS(r.namespaceURI,"node");v.id="fakeroot",v.setAttribute("root","true"),r.removeAttribute("root"),r.parentElement.insertBefore(v,r);let P=this.nexml.createElementNS(r.namespaceURI,"edge");P.id="newrootedge",P.setAttribute("length","0"),P.setAttribute("source","fakeroot"),P.setAttribute("target",r.id),r.parentElement.insertBefore(P,o),o.setAttribute(p,v.id)}}}findLevels(){let r=this.nexml.querySelectorAll("edge"),a=[...this.nexml.querySelectorAll("node[otu]")],o=this.nexml;this.levels=[a];let p=function(z,q){let H=z.map(Fe=>Fe.id),Q=new Map,oe=new Map,we=[];for(let Fe of q){let Ge=Fe.getAttribute("target"),Ue=Fe.getAttribute("source"),He=(()=>H.indexOf(Ge)!==-1?{ancestor:o.getElementById(Ue),child:o.getElementById(Ge)}:H.indexOf(Ue)!==-1?{ancestor:o.getElementById(Ge),child:o.getElementById(Ue)}:null)();if(He!==null)if(oe.has(He.ancestor)){let nt=oe.get(He.ancestor);Q.set(He.ancestor,[nt.child,He.child]),we.push(Fe),we.push(nt.edge)}else oe.set(He.ancestor,{child:He.child,edge:Fe})}let Te=[...Q.keys()],Pe=[...oe.keys()].reduce((Fe,Ge)=>(Te.indexOf(Ge)===-1&&Fe.push(oe.get(Ge).child),Fe),[]),Me=[...q].reduce((Fe,Ge)=>(we.indexOf(Ge)===-1&&Fe.push(Ge),Fe),[]);return{match:Q,remainder:[...new Set(Pe)],edges:Me}};var v=a,P=r;do{let z=p(v,P);this.levels.push(z.match),v=[...z.match.keys(),...z.remainder],P=z.edges}while(P.length>0)}labelInternal(){for(let r of this.nexml.querySelectorAll("node:not([label])"))r.setAttribute("label",r.id)}fitch1(){let r=new Map;for(let a of this.levels[0]){let o=a.getAttribute("label"),p=this.boxdiv.querySelector(`span.tree-lemma[data-id="${o}"]`),v=p?[E.htmlreading(p)]:[];r.set(a,new Set(v))}for(let a=1;a<this.levels.length;a++)for(let[o,p]of this.levels[a]){let v=p.map(q=>r.get(q)),P=E.setIntersection(...v),z=P.size>0?P:E.setUnion(...v);r.set(o,z)}return r}fitch2(r){let a=[...this.nexml.querySelectorAll("node[otu]")],o=new Map;for(let[p]of this.levels[this.levels.length-1])o.set(p,r.get(p));for(let p=this.levels.length-1;p>1;p--)for(let[v,P]of this.levels[p]){let z=o.get(v);for(let q of P){if(a.indexOf(q)!==-1)continue;let H=r.get(q);if(H.size===1)o.set(q,H);else{let Q=E.setIntersection(z,H),oe=Q.size>0?Q:H;o.set(q,oe)}}}return o}fitch(){let r=this.fitch1(),a=function(p){let v=[...p].map(P=>P.trim()===""?"_":P);return v.length===1?v[0]:"{"+v.join(", ")+"}"},o=this.fitch2(r);for(let[p,v]of o){let P=this.boxdiv.querySelector(`span.internal[data-key="${p.id}"]`);P.dataset.reconstructed=a(v)}}clearsvg(){for(;this.svgcontainer.firstChild;)this.svgcontainer.removeChild(this.svgcontainer.firstChild)}removecolors(){let r=this.nexml.querySelectorAll("node[color]");for(let a=0;a<r.snapshotLength;a++)r.snapshotItem(a).removeAttribute("color")}drawlines(r,a){if(this.removecolors(),r){let z=this.getPath(...r.split(";")).path,q=new Set;for(let H of z)q.add(H.getAttribute("target")),q.add(H.getAttribute("source"));for(let H of q){let Q=this.nexml.evaluate('//nex:node[@id="'+H+'"]',this.nexml,this.nsResolver,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue;Q.getAttribute("root")||Q.setAttribute("color",a)}}let o=parseInt(window.getComputedStyle(this.svgcontainer,null).width)-15,p=parseInt(window.getComputedStyle(this.boxdiv,null).height)-10,v=function(){return p<600?600:p}();L.PhyloCanvas.Render.Style.line.stroke="rgb(162,164,170)",this.phylocanvas=new L.PhyloCanvas({nexml:this.nexml,fileSource:!0},this.svgcontainer.id,o,v);let P=this.svgcontainer.querySelectorAll('path:not([stroke="#a2a4aa"])');for(let z of P)z.style.strokeWidth="2"}draw(){this.clear(),this.drawlines(),this.makeLabels()}clearLabels(){for(let r of this.boxdiv.firstChild.querySelectorAll("text"))r.parentElement.removeChild(r)}makeLabels(){let r=[...E.texts()],a=new Set(r.map(p=>p.parentNode.getAttribute("n"))),o=new Map(r.filter(p=>p.parentNode.hasAttribute("corresp")&&p.parentNode.getAttribute("corresp")===this.name).map(p=>[p.parentNode.getAttribute("select").replace(/^#/,""),p.parentNode.getAttribute("n")]));for(let p of this.boxdiv.firstChild.querySelectorAll("text")){let v=document.createElement("div");v.setAttribute("class","tree-div");let P=parseInt(p.getAttribute("x")-5),z=parseInt(p.getAttribute("y"))-15;v.style.left=P+"px",v.style.top=z+"px";let q=p.textContent.trim();a.has(q)?v.innerHTML=`<span class="witness inactive" data-key="${q}">${q}</span><span class="tree-lemma ${q}" data-id="${q}"></span>`:q!=="fakeroot"?o.has(q)?v.innerHTML=`<span class="internal reconstructed" data-key="${q}" data-label="${o.get(q)}">${o.get(q)}</span><span class="tree-lemma invisible ${q}" data-id="${q}" data-label="${o.get(q)}"></span>`:v.innerHTML=`<span class="internal" data-key="${q}">0</span>`:v.innerHTML=`<span class="internal" data-key="${q}"></span>`,p.parentElement.removeChild(p),this.boxdiv.appendChild(v)}}clearlemmata(){for(let r of this.boxdiv.querySelectorAll("span.tree-lemma"))r.innerHTML="",r.dataset.hasOwnProperty("normal")&&delete r.dataset.normal,r.IAST=r.cloneNode(!0)}populate(r,a){let o=Ie(kn),p=E.texts();for(let z of p){let q=z.parentNode.getAttribute("n"),H=this.boxdiv.querySelector(`span.tree-lemma[data-id="${q}"]`)||this.boxdiv.querySelector(`span.tree-lemma[data-label="${q}"]`);if(!!H){if(H.hasOwnProperty("IAST")||(H.IAST=H.cloneNode(!0)),H.IAST.innerHTML="",a){let Q=[],oe=[];var v=!1;for(let we=r;we<=a;we++){let Te=E.firstword(we,z);Q.push(Te.innerHTML),Te.hasAttribute("lemma")&&(oe[we-r]=Te.getAttribute("lemma")),Te.hasAttribute("emended")&&(v=!0)}if(H.IAST.appendChild(je(Q.join(" ").replace(/\s+/g," ").trim(),o)),oe.length!==0){let we=Q.slice(0).map((Pe,Me)=>oe.hasOwnProperty(Me)?oe[Me]:Pe),Te=document.createElement("span");Te.appendChild(je(we.join(" ").replace(/\s+/g," ").trim(),o)),H.dataset.normal=Te.innerHTML}v?H.dataset.emended=!0:H.dataset.hasOwnProperty("emended")&&delete H.dataset.emended}else{let Q=E.firstword(r,z);H.IAST.appendChild(je(Q.innerHTML,o)),Q.hasAttribute("lemma")?H.dataset.normal=Q.getAttribute("lemma"):delete H.dataset.normal,Q.hasAttribute("emended")?H.dataset.emended=!0:H.dataset.hasOwnProperty("emended")&&delete H.dataset.emended}Re.normalizedView()&&H.dataset.hasOwnProperty("normal")?H.innerHTML=H.dataset.normal:H.innerHTML=H.IAST.innerHTML}}let P=this.boxdiv.querySelectorAll(".inactive");for(let z of P)z.classList.remove("inactive");this.fitch()}calcPaths(){this.nodes=[],this.paths=[],this.longest={path:[]},this.nsResolver=this.nexml.createNSResolver(this.nexml.ownerDocument==null?this.nexml.documentElement:this.nexml.ownerDocument.documentElement);let r=this.nexml.evaluate("//nex:node[@label]",this.nexml,this.nsResolver,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE);for(let a=0;a<r.snapshotLength;a++)this.nodes.push(r.snapshotItem(a));for(let a=0;a<this.nodes.length;a++){let o=this.nodes[a],p=o.getAttribute("label"),v=o.id;for(let P=a+1;P<this.nodes.length;P++){let z=this.nodes[P],q=z.getAttribute("label"),H=z.id;this.paths.push({nodes:[p,q],path:this.pathFind(v,H)})}}for(let a of Object.keys(this.paths))this.paths[a].path.length>this.longest.path.length&&(this.longest=this.paths[a])}pathFind(r,a,o){o||(o=[]);let p=this.nexml.evaluate('//nex:edge[@source="'+r+'"]|//nex:edge[@target="'+r+'"]',this.nexml,this.nsResolver,XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE,null);var v;for(let P=0;P<p.snapshotLength;P++){let z=p.snapshotItem(P);if(v=[z],o.indexOf(z.id)!=-1)continue;o.push(z.id);let q=z.getAttribute("source")!==r?z.getAttribute("source"):z.getAttribute("target");if(q===a)return v;if(!this.nexml.evaluate('//nex:node[@id="'+q+'"]',this.nexml,this.nsResolver,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue.hasAttribute("otu")){let Q=this.pathFind(q,a,o);if(Q)return v.concat(Q);continue}}return!1}analyzeVariants(r,a){let o=[],p=[],v=Re.normalizedView()?function(q,H){let Q=E.firstword(q,H);return Q.hasAttribute("lemma")?Q.getAttribute("lemma"):Q.textContent}:function(q,H){return E.firstword(q,H).textContent};for(let q of E.texts()){let H=q.parentNode.getAttribute("n");if(!this.nexml.querySelector(`otu[label="${H}"]`))continue;let Q=a?Y(E.range(r,a).map(oe=>v(oe,q))):J(v(r,q));Q===""?o.hasOwnProperty("")?o[""].push(H):o[""]=[H]:o.hasOwnProperty(Q)?o[Q].push(H):o[Q]=[H]}let P={};for(let q of Object.keys(o)){var z={length:0,branch_length:0,paths:[]};if(o[q].length===1)z=!1;else for(let H=0;H<o[q].length;H++)for(let Q=H+1;Q<o[q].length;Q++){let oe=this.getPath(o[q][H],o[q][Q]);if(oe.hasOwnProperty("path")||alert(oe),oe.path.length===z.length){let we=this.calcBranchLength(oe.path);we===z.branch_length?z.paths.push(oe):we>z.branch_length&&(z={length:oe.path.length,branch_length:we,paths:[oe]})}else oe.path.length>z.length&&(z={length:oe.path.length,branch_length:this.calcBranchLength(oe.path),paths:[oe]})}P[q]=z}for(let q of Object.keys(p))P[q]=p[q];return P}getPath(r,a){for(let o of this.paths)if(o.nodes.indexOf(r)>-1&&o.nodes.indexOf(a)>-1)return o;return!1}calcBranchLength(r){return r.map(a=>a.getAttribute("length")).reduce((a,o)=>parseFloat(a)+parseFloat(o))}colourizeVariants(r,a){let o=this.analyzeVariants(r,a);for(let p of this.boxdiv.querySelectorAll("span.tree-lemma")){let v=o.hasOwnProperty(p.dataset.id)?o[o[p.dataset.id]]:o[p.textContent],P={red:252,green:70,blue:107},z={red:63,green:94,blue:251};v?(p.style.color=me(v.length/this.longest.path.length,z,P),p.dataset.length=v.length,p.dataset.branch_length=v.branch_length,p.dataset.nodes=v.paths[0].nodes.join(";")):(p.style.color=me(1/this.longest.path.length,z,P),p.dataset.length=0,p.dataset.branch_length=0,p.dataset.nodes=""),p.textContent.trim()===""?(p.innerHTML='<span lang="en">Â Â Â </span>',p.style.backgroundColor=p.style.color):p.style.backgroundColor=""}}}class at extends Ze{constructor(r){super(r);this.desc=r,this.text=E.firsttext(r)}init(){this.makeTextBox(),this.makeDescBox(),this.descbox.style.maxWidth="595px",this.descbox.style.paddingLeft="5px",this.boxdiv.addEventListener("mouseup",ge.textMouseup)}refresh(){this.boxdiv.innerHTML="";let r=Ie(Jt);this.boxdiv.appendChild(r.transformToFragment(this.text,document)),he(this.boxdiv);for(let a of E.lemmata(!1,this.boxdiv))a.IAST=a.cloneNode(!0);this.updatescript()}makeTextBox(){let r=document.createElement("div");r.dataset.id=this.name,r.classList.add("text-box");let a=Ie(Jt);r.appendChild(a.transformToFragment(this.text,document)),he(r);for(let o of E.lemmata(!1,r))o.IAST=o.cloneNode(!0);this.boxdiv=r}}class Qe extends Ze{constructor(){super(name);this.desc="Matrix",this.name="Matrix",this.makeDescBox(),this.makeViewBox(),this.descbox.style.maxWidth="100vw",this.descbox.style.paddingLeft="5px"}init(){this.makeTable()}makeViewBox(){let r=document.createElement("div");r.classList.add("matrix"),r.dataset.id=this.name,this.boxdiv=r}makeTable(){let r=document.createElement("div");r.classList.add("scroller");let a=Ie(_n);r.append(a.transformToFragment(C,document));for(let H of r.getElementsByTagName("th"))H.addEventListener("dragstart",ge.thDragStart);r.addEventListener("dragenter",ge.trDragEnter),r.addEventListener("dragleave",ge.trDragLeave),r.addEventListener("dragover",H=>H.preventDefault()),r.addEventListener("drop",ge.trDragDrop),r.addEventListener("mousedown",ge.matrixMousedown);let o=document.createElement("tr");o.classList.add("header");let p=document.createElement("td");p.classList.add("anchor"),o.appendChild(p);let v=[...E.trs(r)],P=v.map(H=>E.trWalker(H)),z=E.tds(!1,v[0]);for(let H of z){let Q=document.createElement("th");Q.dataset.ref=H.dataset.n;let oe=0,we=new Set;for(let Fe of P){let Ge=Fe.nextNode();Ge.IAST=Ge.cloneNode(!0);let Ue=Ge.textContent;Ue!==""&&(oe++,we.add(Ue))}let Te=oe<2?oe:`${oe}(${we.size})`,Pe=document.createElement("span");Pe.classList.add("readings"),Pe.appendChild(document.createTextNode(Te)),Q.appendChild(Pe);let Me=document.createElement("form");Me.innerHTML='<div><input class="insignificant" title="insignificant" type="checkbox"'+(H.dataset.insignificant?"checked":"")+'></div><div><input class="binary" title="binary" type="checkbox"'+(H.dataset.binary?"checked":"")+"></div>",Q.appendChild(Me),o.appendChild(Q)}let q=r.querySelector("tbody");q.insertBefore(o,q.firstChild),this.boxdiv.append(r)}}let ut={fitch:function(){var n,r,a,o;let p={setIntersection:function(...q){let H=q[0];return new Set([...H].filter(Q=>{for(let oe=1;oe<q.length;oe++)if(!q[oe].has(Q))return!1;return!0}))},setUnion:function(...q){return new Set(q.reduce((H,Q)=>(H=[...H,...Q],H),[]))}},v=function(q,H){let Q=new Map;for(let oe of r[0]){let we=n.get(oe),Te=we?[we[q]]:[];Q.set(oe,new Set(Te))}for(let oe=1;oe<r.length;oe++)for(let[we,Te]of r[oe]){let Pe=Te.map(Ge=>Q.get(Ge)),Me=p.setIntersection(...Pe);if(we===H&&Me.size===1)return[...Me][0];let Fe=Me.size>0?Me:p.setUnion(...Pe);Q.set(we,Fe)}return Q},P=function(q,H){let Q=r[0],oe=new Map;for(let we of r[r.length-1])oe.set(we[0],q.get(we[0]));for(let we=r.length-1;we>1;we--)for(let[Te,Pe]of r[we]){let Me=oe.get(Te);for(let Fe of Pe){if(Q.indexOf(Fe)!==-1)continue;let Ge=q.get(Fe),Ue=p.setIntersection(Me,Ge),He=Ue.size>0?Ue:Ge;if(Fe===H)return He;oe.set(Fe,He)}}return oe.get(H)},z=function(q,H){let Q=v(H,q);return typeof Q=="string"?Q:function(we){if(we.size===1)return[...we][0].trim();let Te=[...we].map(Pe=>Pe.trim()===""?"_":Pe);return Te.length===1?Te[0]:"{"+Te.join(", ")+"}"}(P(Q,q))};onmessage=function(q){n=q.data.readings,r=q.data.levels,a=q.data.num,o=q.data.id,postMessage({n:a,result:z(o,a)})}}};return{slaveinit:function(){comboView.init(),window.startbox!==void 0&&(window.startbox.tree?Ee.tree(window.startbox.tree.stemmaid,window.startbox.tree.id):window.startbox.text&&Ee.text(window.startbox.text.name,window.startbox.text.map))},maininit:function(){document.getElementById("comboview").style.display="block",comboView.init(),ne()},init:function(){l=document.getElementById("views"),d=document.getElementById("descs"),l.addEventListener("click",ge.textClick),document.addEventListener("keydown",ge.keyDown,{capture:!0}),document.addEventListener("contextmenu",ge.rightClick),document.addEventListener("mouseup",Ye.remove)},getWindows:function(){return B},addWindow:function(n){B.push(n)},getViewdiv:function(){return l},getTrees:function(){return X}}}();window.addEventListener("load",window.comboView.maininit);
//# sourceMappingURL=script.js.map
